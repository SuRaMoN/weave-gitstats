(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _WeaveApp=require("weaveapp/WeaveApp");var _WeaveApp2=_interopRequireDefault(_WeaveApp);var _LandingPage=require("weaveapp/dialog/LandingPage");var _LandingPage2=_interopRequireDefault(_LandingPage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}var Weave=weavejs.Weave;var WeaveArchive=weavejs.core.WeaveArchive;var map_session_url_instance=new Map;function embed(element,weave,sessionUrl,path,appMode){if((typeof element==="undefined"?"undefined":_typeof(element))==_typeof("")){element=window.document.getElementById(element)}if(typeof Symbol==="undefined")return ReactDOM.render(React.createElement("span",null,"Browser not supported"),element);if(sessionUrl)WeaveArchive.setSessionFromUrl(weave,sessionUrl);if(path)return ReactDOM.render(React.createElement(_WeaveApp2.default,{weave:weave,renderPath:path,forceMenuBar:false}),element);else if(appMode=="splash"||appMode=="file")return ReactDOM.render(React.createElement(_LandingPage2.default,{weave:weave,initialView:appMode,weaveAppRef:function weaveAppRef(weaveApp){window.weaveApp=weaveApp}}),element);return ReactDOM.render(React.createElement(_WeaveApp2.default,{weave:weave,readUrlParams:true}),element)};$(function(){var weave_elements=$(".weave");weave_elements.map(function(index,weave_element){var weave_instance;var appMode=$(weave_element).data("appmode");var sessionUrl=$(weave_element).data("sessionurl");var path=$(weave_element).data("path");weave_instance=map_session_url_instance.get(sessionUrl);if(!weave_instance){weave_instance=new Weave;map_session_url_instance.set(sessionUrl,weave_instance)}embed(weave_element,weave_instance,sessionUrl,path,appMode)})});window.embed=embed;

},{"react":"react","react-dom":"react-dom","weaveapp/WeaveApp":2,"weaveapp/dialog/LandingPage":17,"weavejs":136}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _WeaveProperties=require("weaveapp/WeaveProperties");var _WeaveProperties2=_interopRequireDefault(_WeaveProperties);var _WeaveMenus=require("weaveapp/menu/WeaveMenus");var _WeaveMenus2=_interopRequireDefault(_WeaveMenus);var _WeaveToolEditor=require("weaveapp/editor/WeaveToolEditor");var _WeaveToolEditor2=_interopRequireDefault(_WeaveToolEditor);var _WeaveTool=require("weaveapp/layout/WeaveTool");var _WeaveTool2=_interopRequireDefault(_WeaveTool);var _SessionStateEditor=require("weaveapp/editor/SessionStateEditor");var _SessionStateEditor2=_interopRequireDefault(_SessionStateEditor);var _TabLayout=require("weaveapp/layout/TabLayout");var _TabLayout2=_interopRequireDefault(_TabLayout);var _AbstractLayout=require("weaveapp/layout/AbstractLayout");var _FlexibleLayout=require("weaveapp/layout/FlexibleLayout");var _FlexibleLayout2=_interopRequireDefault(_FlexibleLayout);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _WindowLayout=require("weaveapp/layout/WindowLayout");var _WindowLayout2=_interopRequireDefault(_WindowLayout);var _WeaveProgressBar=require("weaveapp/ui/WeaveProgressBar");var _WeaveProgressBar2=_interopRequireDefault(_WeaveProgressBar);var _InteractiveTour=require("weaveapp/dialog/InteractiveTour");var _InteractiveTour2=_interopRequireDefault(_InteractiveTour);var _DataSourceManager=require("weaveapp/editor/manager/DataSourceManager");var _DataSourceManager2=_interopRequireDefault(_DataSourceManager);var _WeaveMenuBar=require("weaveapp/menu/WeaveMenuBar");var _WeaveMenuBar2=_interopRequireDefault(_WeaveMenuBar);var _NotifcationSystem=require("weaveapp/modules/NotifcationSystem");var _NotifcationSystem2=_interopRequireDefault(_NotifcationSystem);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var prefixer=weavejs.css.prefixer;var SideBarContainer=weavejs.ui.SideBarContainer;var VBox=weavejs.ui.flexbox.VBox;var WeaveComponentRenderer=weavejs.ui.WeaveComponentRenderer;var MiscUtils=weavejs.util.MiscUtils;var ContextMenu=weavejs.ui.menu.ContextMenu;var ReactUtils=weavejs.util.ReactUtils;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var LinkableBoolean=weavejs.core.LinkableBoolean;var LinkablePlaceholder=weavejs.core.LinkablePlaceholder;var ColumnUtils=weavejs.data.ColumnUtils;var IColumnReference=weavejs.api.data.IColumnReference;var StandardLib=weavejs.util.StandardLib;var DynamicState=weavejs.api.core.DynamicState;window.$=_jquery2.default;window.jQuery=_jquery2.default;var WeaveApp=function(_React$Component){_inherits(WeaveApp,_React$Component);function WeaveApp(props){_classCallCheck(this,WeaveApp);var _this=_possibleConstructorReturn(this,(WeaveApp.__proto__||Object.getPrototypeOf(WeaveApp)).call(this,props));_this.enableMenuBarWatcher=WeaveReactUtils.forceUpdateWatcher(_this,LinkableBoolean,["WeaveProperties","enableMenuBar"]);_this._popout_windows=new Set;_this.handleSideBarClose=function(editor){if(_this.props.weave.getObject(_this.state.toolPathToEdit)==editor.tool)_this.setState({toolPathToEdit:null})};_this.handleUnload=function(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_this.popout_windows[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _window=_step.value;_window.close()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}};_this.handleBeforeUnload=function(event){if(_this.popout_windows.size){var confirmationMessage=_weavejs.Weave.lang("You are about to close multiple Weave windows.");event.returnValue=confirmationMessage;return confirmationMessage}};_this.handleGearClick=function(tool){var path=tool.props.path;var obj=_this.props.weave.getObject(path);if(obj&&!obj.renderEditor){var toolName=path[0];_SessionStateEditor2.default.openInstance(_this,obj);return}_this.setState({toolPathToEdit:path})};_this.restoreTabs=function(tabLayoutPath){var weave=_this.props.weave;var oldTabLayout=_weavejs.Weave.AS(weave.getObject(tabLayoutPath),_TabLayout2.default);var rootTabLayout=_weavejs.Weave.AS(weave.getObject(_this.getRootLayoutPath()),_TabLayout2.default);var tabIds=oldTabLayout?oldTabLayout.getPanelIds():[];tabIds.map(function(id){rootTabLayout.addPanel(id);rootTabLayout.setTabLabel(id,oldTabLayout.getTabLabel(id))});weave.removeObject(tabLayoutPath)};_this.handlePopoutClick=function(layoutPath,oldTabLayoutPath){if(_this.props.rootApp)return _this.props.rootApp.handlePopoutClick(layoutPath,oldTabLayoutPath);var newTabLayoutPath=[_this.props.weave.root.generateUniqueName("Tabs")];var oldTabLayout=_this.props.weave.getObject(oldTabLayoutPath);oldTabLayout.removePanel(layoutPath);WeaveReactUtils.requestObject(_this.props.weave,newTabLayoutPath,_TabLayout2.default,function(tabLayout){_weavejs.Weave.getCallbacks(tabLayout).addDisposeCallback(_this,function(){var window=ReactUtils.getWindow(tabLayout);if(window){try{_this.popout_windows.delete(window);window.close()}catch(e){}}});tabLayout.addPanel(layoutPath)});var content=React.createElement(WeaveApp,{rootApp:_this,weave:_this.props.weave,renderPath:newTabLayoutPath,externalTools:_this.props.externalTools,initializeTabs:false,style:{width:"100%",height:"100%"}});var options={transferStyle:true};_this.popout_windows.add(ReactUtils.openPopout(content,_.noop,function(){return _this.restoreTabs(newTabLayoutPath)},options))};_this.renderTab=function(path,panelProps,panelRenderer){var sideBarUI=null;var toolToEdit=_this.props.weave.getObject(_this.state.toolPathToEdit);if(toolToEdit&&toolToEdit.renderEditor)sideBarUI=React.createElement(_WeaveToolEditor2.default,{tool:toolToEdit,onCloseHandler:_this.handleSideBarClose,style:{flex:1},className:"weave-ToolEditor"});return React.createElement(SideBarContainer,{barSize:.4,leftChildren:sideBarUI},React.createElement(WeaveComponentRenderer,{weave:_this.props.weave,path:path,style:{width:"100%"},props:{panelRenderer:_this.renderTool}}))};_this.renderTool=function(path,panelProps,panelRenderer){return React.createElement(_WeaveTool2.default,{ref:_this.handleWeaveTool,weave:_this.props.weave,path:path,props:{panelRenderer:_this.renderTool},style:{width:"100%",height:"100%",left:"0",top:"0"},maximized:panelProps.maximized,onGearClick:_this.handleGearClick})};_this.toolSet=new Set;_this.handleWeaveTool=function(tool){if(tool)_this.toolSet.add(tool)};_this.enableDataManagerItem=function(){return!!_this.tabLayout&&_this.tabLayout.activeTabIndex!=-1};_this.openDataManager=function(){_this.tabLayout.activeTabIndex=-1};_this.createObject=function(type){var weave=_this.props.weave;var firstDataSet=ColumnUtils.map_root_firstDataSet.get(weave.root);var baseName=_weavejs.WeaveAPI.ClassRegistry.getDisplayName(type);var path=[weave.root.generateUniqueName(baseName)];weave.requestObject(path,type);var possiblePlaceholder=weave.getObject(path);var resultType=LinkablePlaceholder.getClass(possiblePlaceholder);if(resultType!=type)return;if(React.Component.isPrototypeOf(type)){_this.setState({toolPathToEdit:path});var tabLayout=_this.tabLayout;if(tabLayout.activeTabIndex<0)tabLayout.activeTabIndex=0;var tabPath=tabLayout.getPanelIds()[tabLayout.activeTabIndex];if(!tabPath){tabPath=_this.getDefaultLayoutPath();weave.requestObject(tabPath,_FlexibleLayout2.default);tabLayout.addPanel(tabPath)}LinkablePlaceholder.whenReady(_this,weave.getObject(tabLayout.activePanelId),function(layout){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=layout.getPanelIds()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var id=_step2.value;layout.maximizePanel(id,false)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}layout.addPanel(path)});LinkablePlaceholder.whenReady(_this,possiblePlaceholder,function(instance){var INIT="initSelectableAttributes";if(instance[INIT]){var refs=firstDataSet?firstDataSet.concat():ColumnUtils.findFirstDataSet(_this.props.weave.root).concat();var sortedRefs=_this.prioritizeNumericColumns(refs);instance[INIT](sortedRefs)}_this.forceUpdate()})}};_this.onSessionLoaded=function(){var weave=_this.props.weave;weave.requestObject(_this.getRootLayoutPath(),_TabLayout2.default);var mainTabLayout=weave.getObject(_this.getRootLayoutPath());var allTabLayouts=_this.getTabLayouts();allTabLayouts.forEach(function(tabLayout){_TabLayout2.default.mergeLayout(mainTabLayout,tabLayout);weave.removeObject(_weavejs.Weave.getPath(tabLayout).getPath())})};_this.initializeTabs=function(tabLayout){if(!_this.props.initializeTabs)return;var tabLayoutState=tabLayout.getSessionState();var tabs=tabLayoutState&&tabLayoutState.tabs;var activeTabIndex=tabLayoutState&&tabLayoutState.activeTabIndex||(_this.urlParams.file?0:-1);var title=tabLayoutState&&tabLayoutState.title;if(!tabs||tabs&&!tabs.length){var layouts=_this.getNonTabLayouts();if(layouts.length){activeTabIndex=0}else{var archive=_this.menus.fileMenu.archive;var history=archive&&archive.objects.get("history.amf");if(history&&history.currentState){activeTabIndex=0;WeaveReactUtils.requestObject(_this.props.weave,_this.getDefaultLayoutPath(),_WindowLayout2.default,function(windowLayout){var ids=_this.props.weave.root.getNames(_IVisTool2.default,true).map(function(name){return[name]});windowLayout.setSessionState({panels:ids.map(function(id){var state=DynamicState.traverseState(history.currentState,id);return{id:id,position:state?{left:state.panelX,top:state.panelY,width:state.panelWidth,height:state.panelHeight}:_WindowLayout2.default.generatePosition(),maximized:state&&state.maximized}}),title:null})})}else{_this.props.weave.requestObject(_this.getDefaultLayoutPath(),_FlexibleLayout2.default)}layouts=_this.getNonTabLayouts()}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=layouts[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var layout=_step3.value;tabLayout.addPanel(_weavejs.Weave.findPath(_this.props.weave.root,layout))}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}tabLayout.activeTabIndex=activeTabIndex};_this.addNewTab=function(type){var weave=_this.props.weave;var layoutName=weave.root.generateUniqueName("Layout");var path=[layoutName];weave.requestObject(path,type);_this.tabLayout.addPanel(path)};_this.removeExistingTab=function(id){_this.tabLayout.removePanel(id);_this.props.weave.removeObject(id)};_this.onTabClick=function(panelPath,event){if(event.button==1){event.preventDefault();_this.removeExistingTab(panelPath)}};_this.state={toolPathToEdit:null};_WeaveProperties2.default.getProperties(_this.props.weave);_this.enableMenuBarWatcher.root=_this.props.weave&&_this.props.weave.root;if(_this.props.rootApp){_this.urlParams=_this.props.rootApp.urlParams}else{_this.urlParams=MiscUtils.getUrlParams()}_this.menus=new _WeaveMenus2.default(_this,_this.props.weave,_this.createObject,_this.onSessionLoaded,_this.openDataManager,_this.enableDataManagerItem,_this.props.externalTools);_this.menus.showFileMenu=_this.urlParams.hasOwnProperty("fileMenu");return _this}_createClass(WeaveApp,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){_WeaveProperties2.default.getProperties(this.props.weave);this.enableMenuBarWatcher.root=this.props.weave&&this.props.weave.root}},{key:"getRenderPath",value:function getRenderPath(){var renderPath=null;if(this.props.readUrlParams)renderPath=_weavejs.WeaveAPI.CSVParser.parseCSVRow(this.urlParams.layout);return renderPath||this.props.renderPath||WeaveApp.defaultProps.renderPath}},{key:"getRootLayoutPath",value:function getRootLayoutPath(){return["Tabs"]}},{key:"getDefaultLayoutPath",value:function getDefaultLayoutPath(){return["Layout"]}},{key:"getRenderedComponent",value:function getRenderedComponent(){if(!this.props.weave)return null;return this.props.weave.getObject(this.getRenderPath())}},{key:"componentDidMount",value:function componentDidMount(){if(_.isEqual(this.getRenderPath(),this.getRootLayoutPath())){var _window2=ReactUtils.getWindow(this);_window2.weave=this.props.weave;_window2.addEventListener("beforeunload",this.handleBeforeUnload);_window2.addEventListener("unload",this.handleUnload)}if(this.props.readUrlParams){this.urlParams.editable=StandardLib.asBoolean(this.urlParams.editable)||this.openedFromAdminConsole;var weaveExternalTools=_weavejs.Weave.getDefinition("window.opener.WeaveExternalTools");if(this.urlParams.file){this.menus.fileMenu.load(this.urlParams.file)}else if(weaveExternalTools&&weaveExternalTools[window.name]){var ownerPath=weaveExternalTools[window.name].path;var content=atob(ownerPath.getValue("btoa(Weave.createWeaveFileContent())"));this.menus.fileMenu.handleOpenedFileContent("export.weave",content);this.forceUpdate()}}if(this.props.showFileDialog)this.menus.fileMenu.openFileDialog();this.setState({enableTour:this.props.enableTour})}},{key:"prioritizeNumericColumns",value:function prioritizeNumericColumns(columnRefs){var sortedRefs=_.sortBy(columnRefs,function(item){var ref=_weavejs.Weave.AS(item,IColumnReference);var meta=ref&&ref.getColumnMetadata();var dataType=meta&&meta["dataType"];switch(dataType){case"number":return 0;default:return 1;case"geometry":return 2;}});return sortedRefs.reverse()}},{key:"getTabLayouts",value:function getTabLayouts(){return this.props.weave.root.getObjects(_TabLayout2.default,true)}},{key:"getNonTabLayouts",value:function getNonTabLayouts(){return this.props.weave.root.getObjects(_AbstractLayout.AbstractLayout,true).filter(function(obj){if(LinkablePlaceholder.getClass(obj)==_TabLayout2.default)return false;return true})}},{key:"componentWillUpdate",value:function componentWillUpdate(nextProps,nextState){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.toolSet[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var tool=_step4.value;if(_weavejs.Weave.wasDisposed(tool))this.toolSet.delete(tool);else tool.setState({highlightTitle:_.isEqual(nextState.toolPathToEdit,tool.props.path)})}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"componentWillUnmount",value:function componentWillUnmount(){ReactUtils.getWindow(this).removeEventListener("beforeunload",this.handleUnload)}},{key:"render",value:function render(){var _this2=this;var weave=this.props.weave;var renderPath=this.getRenderPath();if(!weave){return React.createElement(VBox,{style:{flex:1,justifyContent:"center",alignItems:"center",padding:10}},React.createElement("span",null,_weavejs.Weave.lang("Cannot render WeaveApp without an instance of Weave.")))}var weaveTabbedComponent=null;var menuBarUI=null;var progressBarUI=null;var blankPageIntroScreen=null;var interactiveTourComponent=null;weaveTabbedComponent=React.createElement(WeaveComponentRenderer,{weave:weave,path:renderPath,defaultType:_TabLayout2.default,style:{width:"100%"},onCreate:this.initializeTabs,props:{panelRenderer:this.renderTab,leadingTabs:[{label:"Data Sources",content:React.createElement(_DataSourceManager2.default,{weave:this.props.weave,fileMenu:this.menus.fileMenu})}],onAdd:[{label:_weavejs.Weave.lang("Window Layout"),click:function click(){return _this2.addNewTab(_WindowLayout2.default)}},{label:_weavejs.Weave.lang("Flexible Layout"),click:function click(){return _this2.addNewTab(_FlexibleLayout2.default)}}],onRemove:this.removeExistingTab,onTabClick:this.onTabClick,onTabDoubleClick:function onTabDoubleClick(layoutPath){return _this2.handlePopoutClick(layoutPath,renderPath)}}});var menuBarEnabled=!this.enableMenuBar||this.enableMenuBar.value||this.urlParams&&this.urlParams.editable;if(this.props.forceMenuBar===true||this.props.forceMenuBar===false){menuBarEnabled=this.props.forceMenuBar}menuBarUI=menuBarEnabled?React.createElement(_WeaveMenuBar2.default,{style:prefixer({opacity:!this.enableMenuBar||this.enableMenuBar.value?1:0.5}),weave:weave,menus:this.menus}):null;progressBarUI=React.createElement(_WeaveProgressBar2.default,null);if(this.state.enableTour){interactiveTourComponent=React.createElement(_InteractiveTour2.default,{onClose:this.props.onClose})}return React.createElement(VBox,_extends({className:"weave"},this.props,{style:_.merge({flex:1},this.props.style),onContextMenu:ContextMenu.open}),menuBarUI,progressBarUI,weaveTabbedComponent,interactiveTourComponent,React.createElement(_NotifcationSystem2.default,{ref:function ref(c){_WeaveProperties2.default.getProperties(_this2.props.weave).notificationSystem=c}}))}},{key:"popout_windows",get:function get(){return(this.props.rootApp||this)._popout_windows}},{key:"openedFromAdminConsole",get:function get(){try{return!!window.opener.document.getElementById("AdminConsole")}catch(e){return false}}},{key:"tabLayout",get:function get(){return _weavejs.Weave.AS(this.props.weave.getObject(this.getRenderPath()),_TabLayout2.default)}},{key:"enableMenuBar",get:function get(){return this.enableMenuBarWatcher.target}}]);return WeaveApp}(React.Component);exports.default=WeaveApp;WeaveApp.defaultProps={weave:null,showFileDialog:false,renderPath:["Tabs"],readUrlParams:false,initializeTabs:true};

},{"lodash":"lodash","react":"react","weaveapp/WeaveProperties":3,"weaveapp/api/ui/IVisTool":11,"weaveapp/dialog/InteractiveTour":16,"weaveapp/editor/SessionStateEditor":42,"weaveapp/editor/WeaveToolEditor":45,"weaveapp/editor/manager/DataSourceManager":46,"weaveapp/layout/AbstractLayout":47,"weaveapp/layout/FlexibleLayout":48,"weaveapp/layout/TabLayout":49,"weaveapp/layout/WeaveTool":50,"weaveapp/layout/WindowLayout":51,"weaveapp/menu/WeaveMenuBar":58,"weaveapp/menu/WeaveMenus":59,"weaveapp/modules/NotifcationSystem":60,"weaveapp/modules/jquery":63,"weaveapp/ui/WeaveProgressBar":125,"weavejs":136}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AccessibilityProperties=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LinkableBoolean=weavejs.core.LinkableBoolean;var LinkableHashMap=weavejs.core.LinkableHashMap;var ILinkableObject=weavejs.api.core.ILinkableObject;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var KeySet=weavejs.data.key.KeySet;var KeyFilter=weavejs.data.key.KeyFilter;var ColorColumn=weavejs.data.column.ColorColumn;var BinnedColumn=weavejs.data.column.BinnedColumn;var FilteredColumn=weavejs.data.column.FilteredColumn;var AccessibilityProperties=exports.AccessibilityProperties=function AccessibilityProperties(){_classCallCheck(this,AccessibilityProperties);this.enableAccessibilityFeatures=_weavejs.Weave.linkableChild(this,LinkableBoolean);this.enableCaptioning=_weavejs.Weave.linkableChild(this,LinkableBoolean)};AccessibilityProperties.WEAVE_INFO=_weavejs.Weave.setClassInfo(AccessibilityProperties,{id:"weavejs.app.AccessibilityProperties"});var WeaveProperties=function(){function WeaveProperties(){_classCallCheck(this,WeaveProperties);this.enableMenuBar=_weavejs.Weave.linkableChild(this,new LinkableBoolean(true));this.showSessionHistorySlider=_weavejs.Weave.linkableChild(this,new LinkableBoolean(false));this.enableSessionHistoryControls=_weavejs.Weave.linkableChild(this,new LinkableBoolean(true));this.toolInteractions=_weavejs.Weave.linkableChild(this,LinkableHashMap);this.accessibility=_weavejs.Weave.linkableChild(this,AccessibilityProperties);this.enableGeometryProbing=_weavejs.Weave.linkableChild(this,new LinkableBoolean(true));this.macros=_weavejs.Weave.linkableChild(this,LinkableHashMap)}_createClass(WeaveProperties,[{key:"init",value:function init(){this.defaultColorDataColumn.filter.target=this.defaultSubsetKeyFilter;this.defaultProbeKeySet;this.defaultSelectionKeySet}},{key:"weave",get:function get(){return this._weave||(this._weave=_weavejs.Weave.getWeave(this))}},{key:"defaultProbeKeySet",get:function get(){return this.weave.root.requestObject(WeaveProperties.DEFAULT_PROBE_KEYSET,KeySet,true)}},{key:"defaultSelectionKeySet",get:function get(){return this.weave.root.requestObject(WeaveProperties.DEFAULT_SELECTION_KEYSET,KeySet,true)}},{key:"defaultSubsetKeyFilter",get:function get(){return this.weave.root.requestObject(WeaveProperties.DEFAULT_SUBSET_KEYFILTER,KeyFilter,true)}},{key:"defaultColorColumn",get:function get(){return this.weave.root.requestObject(WeaveProperties.DEFAULT_COLOR_COLUMN,ColorColumn,true)}},{key:"defaultColorBinColumn",get:function get(){return this.defaultColorColumn.internalDynamicColumn.requestGlobalObject(WeaveProperties.DEFAULT_COLOR_BIN_COLUMN,BinnedColumn,true)}},{key:"defaultColorDataColumn",get:function get(){return this.defaultColorBinColumn.internalDynamicColumn.requestGlobalObject(WeaveProperties.DEFAULT_COLOR_DATA_COLUMN,FilteredColumn,true)}},{key:"deprecatedStateMapping",get:function get(){return{}}}],[{key:"getProperties",value:function getProperties(context){if(!(context instanceof _weavejs.Weave))context=_weavejs.Weave.getWeave(context);var weave=context;var wp=_weavejs.Weave.AS(weave.root.getObject(WeaveProperties.WEAVE_PROPERTIES),WeaveProperties);if(!wp){wp=weave.root.requestObject(WeaveProperties.WEAVE_PROPERTIES,WeaveProperties,true);wp.init()}return wp}},{key:"notify",value:function notify(weave,level,message){WeaveProperties.getProperties(weave).notificationSystem.addNotification({level:level,message:message,position:"br"})}}]);return WeaveProperties}();exports.default=WeaveProperties;WeaveProperties.WEAVE_INFO=_weavejs.Weave.setClassInfo(WeaveProperties,{id:"weavejs.app.WeaveProperties",interfaces:[ILinkableObject,ILinkableObjectWithNewProperties],deprecatedIds:["weave::WeaveProperties"]});WeaveProperties.WEAVE_PROPERTIES="WeaveProperties";WeaveProperties.DEFAULT_COLOR_COLUMN="defaultColorColumn";WeaveProperties.DEFAULT_COLOR_BIN_COLUMN="defaultColorBinColumn";WeaveProperties.DEFAULT_COLOR_DATA_COLUMN="defaultColorDataColumn";WeaveProperties.DEFAULT_SUBSET_KEYFILTER="defaultSubsetKeyFilter";WeaveProperties.DEFAULT_SELECTION_KEYSET="defaultSelectionKeySet";WeaveProperties.DEFAULT_PROBE_KEYSET="defaultProbeKeySet";WeaveProperties.ALWAYS_HIGHLIGHT_KEYSET="alwaysHighlightKeySet";WeaveProperties.SAVED_SELECTION_KEYSETS="savedSelections";WeaveProperties.SAVED_SUBSETS_KEYFILTERS="savedSubsets";

},{"weavejs":136}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _ConnectionEditor=require("weaveapp/admin/ConnectionEditor");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Checkbox=weavejs.ui.Checkbox;var ComboBox=weavejs.ui.ComboBox;var Button=weavejs.ui.Button;var PopupWindow=weavejs.ui.PopupWindow;var SmartComponent=weavejs.ui.SmartComponent;var HelpIcon=weavejs.ui.HelpIcon;var LogComponent=weavejs.ui.LogComponent;var ConfigurationStorageEditor=function(_SmartComponent){_inherits(ConfigurationStorageEditor,_SmartComponent);function ConfigurationStorageEditor(props){_classCallCheck(this,ConfigurationStorageEditor);var _this=_possibleConstructorReturn(this,(ConfigurationStorageEditor.__proto__||Object.getPrototypeOf(ConfigurationStorageEditor)).call(this,props));_this.handleError=function(error){_this.setState({errors:_this.state.errors.concat([error.toString()])})};_this.handleMessage=function(message){_this.setState({messages:_this.state.messages.concat([message.toString()])})};_this.save=function(){var idFields=_weavejs.WeaveAPI.CSVParser.parseCSVRow(_this.state.metadataIdFields);_this.props.service.setDatabaseConfigInfo(_this.state.connectionName,_this.state.connectionPassword,_this.state.schemaName,idFields).then(_this.handleMessage,_this.handleError)};_this.state={errors:[],messages:[]};return _this}_createClass(ConfigurationStorageEditor,[{key:"updateCurrentConnection",value:function updateCurrentConnection(){var _this2=this;this.props.service.getConnectionNames().then(function(connectionNames){_this2.setState({connectionNames:connectionNames})},this.handleError);this.props.service.getDatabaseConfigInfo().then(function(info){_this2.setState({currentConnectionName:info.connection,connectionName:info.connection,schemaName:info.schema,metadataIdFields:_weavejs.WeaveAPI.CSVParser.createCSVRow(info.idFields||[])})},this.handleError)}},{key:"componentDidUpdate",value:function componentDidUpdate(){console.log(this.state)}},{key:"componentDidMount",value:function componentDidMount(){this.updateCurrentConnection()}},{key:"render",value:function render(){var _this3=this;var metadataIdRowStyle=this.state.showAdvancedOptions?{}:{display:"none"};return React.createElement(VBox,{className:"weave-ToolEditor",style:{flex:1,justifyContent:"space-between"}},React.createElement(VBox,{style:{flex:1,overflow:"auto"}},React.createElement("p",null,_weavejs.Weave.lang("Configuration info for Weave must be stored in an SQL database.")),React.createElement("p",null,this.state.currentConnectionName?_weavejs.Weave.lang("You are currently using the \"{0}\" connection to store configuration data.",this.state.currentConnectionName):""),React.createElement("p",null,this.state.currentConnectionName?_weavejs.Weave.lang("You may switch to a different location, but the existing configuration data will not be copied over."):""),React.createElement("div",{className:"ui left aligned grid"},React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Connection to use"))),React.createElement("div",{className:"twelve wide column"},React.createElement(ComboBox,{style:{flex:1},value:this.state.connectionName,options:this.state.connectionNames||[],onChange:function onChange(value){_this3.setState({connectionName:value})}}))),React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Password"))),React.createElement("div",{className:"twelve wide column"},React.createElement(_ConnectionEditor.LinkedInput,{field:"connectionPassword",type:"password",outerComponent:this}))),React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Database schema"))),React.createElement("div",{className:"twelve wide column"},React.createElement(_ConnectionEditor.LinkedInput,{field:"schemaName",type:"text",outerComponent:this}))),React.createElement("div",{className:"one column row"},React.createElement("div",{className:"sixteen wide right aligned column"},React.createElement(Checkbox,{label:_weavejs.Weave.lang("Show advanced options"),value:this.state.showAdvancedOptions,onChange:function onChange(value){return _this3.setState({showAdvancedOptions:value})}}))),React.createElement("div",{className:"two column row",style:metadataIdRowStyle},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Metadata ID field(s)"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Use this only if you want to use your own custom properties to uniquely identify data columns.")))),React.createElement("div",{className:"twelve wide column"},React.createElement(_ConnectionEditor.LinkedInput,{field:"metadataIdFields",type:"text",outerComponent:this}))),React.createElement("div",{className:"one column row"},React.createElement("div",{className:"sixteen wide column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("The following tables will be created in the schema specified above:"),_weavejs.Weave.lang("\tweave_hiearchy, weave_meta_private, weave_meta_public"),_weavejs.Weave.lang("If they already exist, no changes will be made.")))),React.createElement("div",{className:"one column row"},React.createElement(LogComponent,{style:{width:"100%"},header:_weavejs.Weave.lang("Server error"),messages:this.state.errors,clearFunc:function clearFunc(){_this3.setState({errors:[]})}}),React.createElement(LogComponent,{style:{width:"100%"},uiClass:"positive",header:_weavejs.Weave.lang("Completed"),messages:this.state.messages,clearFunc:function clearFunc(){_this3.setState({messages:[]})}})))),React.createElement(HBox,{style:{justifyContent:"flex-end"}},React.createElement(Button,{colorClass:"primary",onClick:this.save},_weavejs.Weave.lang("Store Weave configuration at this location")),React.createElement(Button,{colorClass:"secondary",style:{marginLeft:8},onClick:function onClick(){return PopupWindow.close(_this3)}},_weavejs.Weave.lang("Cancel"))))}}]);return ConfigurationStorageEditor}(SmartComponent);exports.default=ConfigurationStorageEditor;

},{"react":"react","weaveapp/admin/ConnectionEditor":5,"weavejs":136}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LinkedInput=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Checkbox=weavejs.ui.Checkbox;var ComboBox=weavejs.ui.ComboBox;var Button=weavejs.ui.Button;var Accordion=weavejs.ui.Accordion;var SmartComponent=weavejs.ui.SmartComponent;var Input=weavejs.ui.Input;var HelpIcon=weavejs.ui.HelpIcon;var ConnectionInfo=weavejs.net.beans.ConnectionInfo;var StandardLib=weavejs.util.StandardLib;var LinkedInput=exports.LinkedInput=function(_React$Component){_inherits(LinkedInput,_React$Component);function LinkedInput(props){_classCallCheck(this,LinkedInput);return _possibleConstructorReturn(this,(LinkedInput.__proto__||Object.getPrototypeOf(LinkedInput)).call(this,props))}_createClass(LinkedInput,[{key:"render",value:function render(){var _this2=this;return React.createElement(Input,{fluid:true,value:this.props.outerComponent.state[this.props.field],type:this.props.type||"text",onChange:function onChange(evt){return _this2.props.outerComponent.setState(_defineProperty({},_this2.props.field,evt.target.value))}})}}]);return LinkedInput}(React.Component);var CUSTOM="custom";var EDITOR_MODES=[{label:_weavejs.Weave.lang("MySQL"),value:ConnectionInfo.MYSQL},{label:_weavejs.Weave.lang("PostGreSQL"),value:ConnectionInfo.POSTGRESQL},{label:_weavejs.Weave.lang("Microsoft SQL Server"),value:ConnectionInfo.SQLSERVER},{label:_weavejs.Weave.lang("Oracle"),value:ConnectionInfo.ORACLE},{label:_weavejs.Weave.lang("SQLite"),value:ConnectionInfo.SQLITE},{label:_weavejs.Weave.lang("Custom"),value:CUSTOM}];var ConnectionEditor=function(_SmartComponent){_inherits(ConnectionEditor,_SmartComponent);function ConnectionEditor(props){_classCallCheck(this,ConnectionEditor);var _this3=_possibleConstructorReturn(this,(ConnectionEditor.__proto__||Object.getPrototypeOf(ConnectionEditor)).call(this,props));_this3.saveConnection=function(overwrite){var info=new ConnectionInfo;info.is_superuser=!!_this3.state.is_superuser;info.name=_this3.state.name;info.pass=_this3.state.pass;info.folderName=_this3.state.folderName;info.connectString=_this3.connectString;var savePromise=void 0;savePromise=_this3.props.service.saveConnectionInfo(info,info.name===_this3.props.connectionName||overwrite);savePromise.then(_this3.props.handleMessage,_this3.props.handleError).then(function(){return _this3.props.handleSuccessfulSave(info.name,info.pass)})};_this3.loadFromConnection=function(connectionName){_this3.props.service.getConnectionInfo(connectionName).then(function(info){_this3.setState({is_superuser:info?info.is_superuser:false,name:info?info.name:"",pass:info?info.pass:"",folderName:info?info.folderName:"",connectString:info?info.connectString:"",editorMode:CUSTOM})},_this3.props.handleError)};_this3.renderLinkedInput=function(entry){var _entry=_slicedToArray(entry,5),label=_entry[0],field=_entry[1],type=_entry[2],helpText=_entry[3],placeholder=_entry[4];var showPass=_this3.state[field+"Show"];var displayType=type==="password"&&!showPass?"password":"text";var showPassIcon=null;var leftColumn=label;if(helpText){leftColumn=React.createElement("span",null,label,React.createElement(HelpIcon,null,helpText))}if(type==="password"){var iconName=showPass?"fa fa-eye fa-lg":"fa fa-eye-slash fa-lg";showPassIcon=React.createElement("button",{title:showPass?_weavejs.Weave.lang("Hide password"):_weavejs.Weave.lang("Show password"),className:"ui button",onClick:function onClick(){var option={};option[field+"Show"]=!_this3.state[field+"Show"];_this3.setState(option)}},React.createElement("i",{className:iconName}))}return[leftColumn,React.createElement(Input,{placeholder:placeholder,className:type==="password"?"action":"",key:field,fluid:true,value:_this3.state[field],type:displayType,onChange:function onChange(evt){return _this3.setState(_defineProperty({},field,evt.target.value))}},showPassIcon)]};_this3.state={name:"",pass:"",folderName:"",editorMode:"custom",dbPasswordShow:false,passShow:false};return _this3}_createClass(ConnectionEditor,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.connectionName!=nextProps.connectionName){this.loadFromConnection(nextProps.connectionName)}}},{key:"render",value:function render(){var _this4=this;var connectionPropertyEditorDefs=[["Connection Name","name","text",null],["Password","pass","password",null],["Folder Name","folderName","text","Specify the folder relative to the docroot to store configurations files created by this user."]];var connectionPropertyEditors=connectionPropertyEditorDefs.map(this.renderLinkedInput);connectionPropertyEditors.unshift([React.createElement("span",null,_weavejs.Weave.lang("Superuser"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Grant this connection superuser privileges."))),React.createElement(Checkbox,{label:" ",value:this.state.is_superuser,onChange:function onChange(value){return _this4.setState({is_superuser:value})}})]);var dbEditorDefs=void 0;switch(this.state.editorMode){case ConnectionInfo.SQLITE:dbEditorDefs=[["SQLite Database File","dbDatabaseName","text",_weavejs.Weave.lang("An absolute path to an SQLite database file. Ensure that your application server has permission to access this file"),null]];break;case ConnectionInfo.MYSQL:case ConnectionInfo.ORACLE:case ConnectionInfo.POSTGRESQL:dbEditorDefs=[["Server Address","dbServerAddress","text",_weavejs.Weave.lang(ConnectionEditor.ADDRESS_MESSAGE),null],["Server Port","dbServerPort","text",_weavejs.Weave.lang(ConnectionEditor.PORT_MESSAGE),String(ConnectionInfo.getDefaultPort(this.state.editorMode))],["Database Name","dbDatabaseName","text",_weavejs.Weave.lang(ConnectionEditor.DBNAME_MESSAGE),null],["Username","dbUsername","text",null,null],["Password","dbPassword","password",null,null]];break;case ConnectionInfo.SQLSERVER:dbEditorDefs=[["Server Address","dbServerAddress","text",_weavejs.Weave.lang(ConnectionEditor.ADDRESS_MESSAGE),null],["Server Port","dbServerPort","text",_weavejs.Weave.lang(ConnectionEditor.PORT_MESSAGE),String(ConnectionInfo.getDefaultPort(this.state.editorMode))],["Instance Name","dbDatabaseName","text",_weavejs.Weave.lang(ConnectionEditor.DBNAME_MESSAGE),null],["Domain","dbDomain","text",null,null],["Username","dbUsername","text",null,null],["Password","dbPassword","password",null,null]];break;case CUSTOM:default:dbEditorDefs=[["JDBC Connect String","connectString","password",null,null]];};var dbEditors=dbEditorDefs.map(this.renderLinkedInput);dbEditors.unshift([_weavejs.Weave.lang("Database Type"),React.createElement(ComboBox,{options:EDITOR_MODES,value:this.state.editorMode,onChange:function onChange(value){return _this4.setState({editorMode:value})}})]);return React.createElement(VBox,{className:"weave-ToolEditor",style:{flex:0.66,justifyContent:"space-between"}},React.createElement(HBox,{style:{overflow:"auto",flex:1}},Accordion.render([_weavejs.Weave.lang("Connection Properties"),connectionPropertyEditors],[_weavejs.Weave.lang("Database Configuration"),dbEditors])),React.createElement(HBox,{style:{alignSelf:"flex-end"}},React.createElement(Button,{colorClass:"primary",onClick:function onClick(){return _this4.saveConnection(false)}},_weavejs.Weave.lang("Save changes")),React.createElement(Button,{style:{marginLeft:8},colorClass:"secondary",onClick:function onClick(){return _this4.loadFromConnection(_this4.props.connectionName)}},_weavejs.Weave.lang("Discard changes"))))}},{key:"connectString",get:function get(){if(this.state.editorMode==CUSTOM){return this.state.connectString}else{return ConnectionEditor.getConnectString(this.state.editorMode,this.state.dbServerAddress||"",this.state.dbServerPort||"",this.state.dbDatabaseName||"",this.state.dbUsername||"",this.state.dbPassword||"",this.state.dbDomain||"")}}}],[{key:"getConnectString",value:function getConnectString(dbms,ip,port,database,user,pass,domain){var host;if(!port)host=ip;else host=ip+":"+port;var format=null;if(dbms==ConnectionInfo.SQLSERVER){dbms="sqlserver";if(user||pass)format="jdbc:jtds:{0}://{1}/;instance={2};domain={5};user={3};password={4}";else format="jdbc:jtds:{0}://{1}/;instance={2};domain={5}"}else if(dbms==ConnectionInfo.SQLITE){format="jdbc:{0}:{2}"}else if(dbms==ConnectionInfo.ORACLE){if(user||pass)format="jdbc:{0}:thin:{3}/{4}@{1}:{2}";else format="jdbc:{0}:thin:{1}:{2}"}else{if(user||pass)format="jdbc:{0}://{1}/{2}?user={3}&password={4}";else format="jdbc:{0}://{1}/{2}"}if(dbms==ConnectionInfo.MYSQL){database=encodeURIComponent(database);user=encodeURIComponent(user);pass=encodeURIComponent(pass)}var result=StandardLib.substitute(format,dbms.toLowerCase(),host,database,user,pass,domain);return result}}]);return ConnectionEditor}(SmartComponent);exports.default=ConnectionEditor;ConnectionEditor.DBNAME_MESSAGE="This field is optional.\nYou can specify the name of a default database to connect to.\nFor SQL Server, this is an instance name.\nSimilarly in PostGreSQL, databases are different from schemas.\nMySQL does not differentiate between the two.";ConnectionEditor.ADDRESS_MESSAGE="The hostname or IP address of the database server to connect to.";ConnectionEditor.PORT_MESSAGE="The port on the database server to connect to. If left blank, the default port for the database type selected will be used.";

},{"react":"react","weavejs":136}],6:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _ConfigurationStorageEditor=require("weaveapp/admin/ConfigurationStorageEditor");var _ConfigurationStorageEditor2=_interopRequireDefault(_ConfigurationStorageEditor);var _ConfirmationDialog=require("weaveapp/dialog/ConfirmationDialog");var _ConfirmationDialog2=_interopRequireDefault(_ConfirmationDialog);var _ServiceLogin=require("weaveapp/admin/ServiceLogin");var _ServiceLogin2=_interopRequireDefault(_ServiceLogin);var _ConnectionEditor=require("weaveapp/admin/ConnectionEditor");var _ConnectionEditor2=_interopRequireDefault(_ConnectionEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Button=weavejs.ui.Button;var PopupWindow=weavejs.ui.PopupWindow;var SmartComponent=weavejs.ui.SmartComponent;var List=weavejs.ui.List;var LogComponent=weavejs.ui.LogComponent;var WeaveAdminService=weavejs.net.WeaveAdminService;var ConnectionManager=function(_SmartComponent){_inherits(ConnectionManager,_SmartComponent);function ConnectionManager(props){_classCallCheck(this,ConnectionManager);var _this=_possibleConstructorReturn(this,(ConnectionManager.__proto__||Object.getPrototypeOf(ConnectionManager)).call(this,props));_this.handleError=function(error){if(error.message.startsWith(WeaveAdminService.WEAVE_AUTHENTICATION_EXCEPTION)||error.message.startsWith("RemoteException: Incorrect username or password.")){if(_this.login)_this.login.open(_this.updateConnectionsAndUser)}else{_this.setState({errors:_this.state.errors.concat([error.toString()])})}};_this.handleMessage=function(message){_this.setState({messages:_this.state.messages.concat([message.toString()])})};_this.updateConnectionsAndUser=function(){_this.props.service.getConnectionNames().then(function(connections){return _this.setState({connections:connections})},_this.handleError);_this.props.service.getDatabaseConfigInfo().then(function(dbConfigInfo){return _this.setState({dbConfigInfo:dbConfigInfo})},_this.handleError);_this.props.service.getAuthenticatedUser().then(function(user){return _this.setState({user:user})})};_this.connectionToOption=function(connection){var isConfigConnection=_this.state.dbConfigInfo&&_this.state.dbConfigInfo.connection==connection;var style={fontWeight:isConfigConnection?"bold":"normal"};var title=isConfigConnection?_weavejs.Weave.lang("Connection {0} is the current configuration storage location.",connection):_weavejs.Weave.lang("Connection {0}",connection);return{value:connection,label:React.createElement("span",{title:title,style:style},connection)}};_this.createNewConnection=function(){_this.setState({selected:null})};_this.openConfigurationStorageEditor=PopupWindow.generateOpener(function(){return{context:_this,title:_weavejs.Weave.lang("Configuration Storage"),content:React.createElement(_ConfigurationStorageEditor2.default,{service:_this.props.service}),modal:true,resizable:true,width:600,height:600,footerContent:React.createElement("div",null)}});_this.handleSuccessfulSave=function(connectionName,password){_this.props.service.getAuthenticatedUser().then(function(user){_this.setState({user:user});if(!user){return _this.props.service.authenticate(connectionName,password).then(function(){_this.setState({selected:connectionName});_this.props.service.checkDatabaseConfigExists().then(function(exists){if(!exists){}})},function(){return _this.handleError(_weavejs.Weave.lang("Failed to log in with new connection. Check your server configuration."))})}else{_this.setState({selected:connectionName})}}).then(function(){return _this.updateConnectionsAndUser()})};_this.removeSelectedConnection=function(){var confirmationMessage=_weavejs.Weave.lang("Are you sure you want to delete the connection '{0}'?",_this.state.selected);_ConfirmationDialog2.default.open(_this,confirmationMessage,_this.removeSelectedConnection)};_this.removeConnection=function(connection){_this.props.service.removeConnectionInfo(connection).then(_this.updateConnectionsAndUser,_this.handleError)};_this.state={errors:[],messages:[],connections:[],dbConfigInfo:null,selected:null};_this.login=new _ServiceLogin2.default(_this,_this.props.service);return _this}_createClass(ConnectionManager,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;this.element=ReactDOM.findDOMNode(this);this.updateConnectionsAndUser();this.props.service.getAuthenticatedUser().then(function(user){return _this2.setState({user:user})},function(error){return _this2.setState({user:null})})}},{key:"render",value:function render(){var _this3=this;var options=this.state.connections.map(this.connectionToOption);return React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1,overflow:"auto"}},React.createElement(HBox,{className:"weave-padded-hbox",style:{flex:1}},React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:0.33}},React.createElement("div",null,this.state.user?_weavejs.Weave.lang("Signed in as '{0}'.",this.state.user):_weavejs.Weave.lang("Not signed in.")),React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1,padding:0}},React.createElement("span",{style:{fontWeight:"bold"}},_weavejs.Weave.lang("Connections:")),React.createElement(VBox,{style:{flex:1,padding:0},className:"weave-container"},React.createElement(List,{selectedValues:[this.state.selected],options:options,onChange:function onChange(selectedValues){return _this3.setState({selected:selectedValues[0]})}}))),React.createElement(HBox,null,React.createElement(Button,{title:_weavejs.Weave.lang("Create new connection"),style:{flex:"1",borderTopRightRadius:0,borderBottomRightRadius:0},onClick:this.createNewConnection},React.createElement("i",{className:"fa fa-plus fa-fw"})),React.createElement(Button,{disabled:!this.state.selected,title:_weavejs.Weave.lang("Remove selected connection"),style:{flex:"1",borderRadius:0},onClick:this.removeSelectedConnection},React.createElement("i",{className:"fa fa-minus fa-fw"})),React.createElement(Button,{title:_weavejs.Weave.lang("Refresh connection names."),style:{flex:"1",borderTopLeftRadius:0,borderBottomLeftRadius:0},onClick:this.updateConnectionsAndUser},React.createElement("i",{className:"fa fa-refresh fa-fw"}))),React.createElement(Button,{style:{marginTop:8},title:_weavejs.Weave.lang("Manage configuration storage..."),onClick:this.openConfigurationStorageEditor},_weavejs.Weave.lang("Manage configuration storage..."))),React.createElement(_ConnectionEditor2.default,{handleSuccessfulSave:this.handleSuccessfulSave,service:this.props.service,connectionName:this.state.selected,handleError:this.handleError,handleMessage:this.handleMessage})),React.createElement(LogComponent,{uiClass:"positive",header:_weavejs.Weave.lang("Operation Completed"),messages:this.state.messages,clearFunc:function clearFunc(){_this3.setState({messages:[]})}}),React.createElement(LogComponent,{header:_weavejs.Weave.lang("Server error"),messages:this.state.errors,clearFunc:function clearFunc(){_this3.setState({errors:[]})}}))}}]);return ConnectionManager}(SmartComponent);exports.default=ConnectionManager;

},{"react":"react","react-dom":"react-dom","weaveapp/admin/ConfigurationStorageEditor":4,"weaveapp/admin/ConnectionEditor":5,"weaveapp/admin/ServiceLogin":8,"weaveapp/dialog/ConfirmationDialog":13,"weavejs":136}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VBox=weavejs.ui.flexbox.VBox;var Button=weavejs.ui.Button;var Login=function(_React$Component){_inherits(Login,_React$Component);function Login(props){_classCallCheck(this,Login);return _possibleConstructorReturn(this,(Login.__proto__||Object.getPrototypeOf(Login)).call(this,props))}_createClass(Login,[{key:"invalid",value:function invalid(){var selector=(0,_jquery2.default)(this.form);selector.form("clear");selector.form("add errors",{username:_weavejs.Weave.lang("Incorrect username or password")});this.username.focus()}},{key:"componentDidMount",value:function componentDidMount(){var _this2=this;this.element=ReactDOM.findDOMNode(this);var selector=(0,_jquery2.default)(this.form);selector.form({onSuccess:function onSuccess(event,fields){var user=_this2.username.value;var password=_this2.password.value;_this2.props.onLogin&&_this2.props.onLogin({username:user,password:password})},fields:{username:{identifier:"username",rules:[{type:"empty",prompt:_weavejs.Weave.lang("Please enter your username")}]},password:{identifier:"password",rules:[{type:"empty",prompt:_weavejs.Weave.lang("Please enter your password")}]}}});selector.submit(function(e){e.preventDefault();return false})}},{key:"render",value:function render(){var _this3=this;return React.createElement(VBox,{style:{flex:1,padding:"1.5em"}},React.createElement("div",{className:"ui header"},React.createElement("div",{className:"sub header"},_weavejs.Weave.lang("Enter your credentials to access files on the Weave server"))),React.createElement("div",{ref:function ref(c){return _this3.form=c},className:"ui form"},React.createElement("div",{className:"field"},React.createElement("div",{className:"ui fluid left icon input"},React.createElement("i",{className:"user icon"}),React.createElement("input",{ref:function ref(c){return _this3.username=c},type:"text",name:"username",placeholder:_weavejs.Weave.lang("User name")}))),React.createElement("div",{className:"field"},React.createElement("div",{className:"ui fluid left icon input"},React.createElement("i",{className:"lock icon"}),React.createElement("input",{ref:function ref(c){return _this3.password=c},type:"password",name:"password",placeholder:_weavejs.Weave.lang("Password")}))),React.createElement(Button,{colorClass:"primary",className:"right floated submit"},_weavejs.Weave.lang("Sign in")),React.createElement("div",{className:"ui error message",style:{marginTop:60}})))}}]);return Login}(React.Component);exports.default=Login;

},{"react":"react","react-dom":"react-dom","weaveapp/modules/jquery":63,"weavejs":136}],8:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _Login=require("weaveapp/admin/Login");var _Login2=_interopRequireDefault(_Login);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PopupWindow=weavejs.ui.PopupWindow;var ServiceLogin=function(){function ServiceLogin(context,service){var _this=this;_classCallCheck(this,ServiceLogin);this.open=function(onSuccess,onCancel){_this.onSuccess=onSuccess;_this.onCancel=onCancel;return _this.show()};this.show=PopupWindow.generateOpener(function(){return{context:_this.context,title:_weavejs.Weave.lang("Weave Server Sign-In"),content:React.createElement(_Login2.default,{ref:function ref(c){return _this.login=c},onLogin:function onLogin(fields){return _this.handleLogin(fields,_this.onSuccess)}}),footerContent:React.createElement("div",null),resizable:false,draggable:false,modal:true,suspendEnter:true,width:400}});this.handleLogin=function(fields,onSuccess){_this.service.authenticate(fields.username,fields.password).then(function(){PopupWindow.close(_this.login);if(onSuccess)onSuccess(fields.username)},function(error){_this.login.invalid()})};this.context=context;this.service=service}_createClass(ServiceLogin,[{key:"conditionalOpen",value:function conditionalOpen(onSuccess,onCancel){var _this2=this;this.service.getAuthenticatedUser().then(function(username){if(username){onSuccess&&onSuccess(username)}else{_this2.open(onSuccess,onCancel)}})}}]);return ServiceLogin}();exports.default=ServiceLogin;

},{"react":"react","weaveapp/admin/Login":7,"weavejs":136}],9:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _ServiceLogin=require("weaveapp/admin/ServiceLogin");var _ServiceLogin2=_interopRequireDefault(_ServiceLogin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Checkbox=weavejs.ui.Checkbox;var ComboBox=weavejs.ui.ComboBox;var Button=weavejs.ui.Button;var PopupWindow=weavejs.ui.PopupWindow;var SmartComponent=weavejs.ui.SmartComponent;var Input=weavejs.ui.Input;var HelpIcon=weavejs.ui.HelpIcon;var LogComponent=weavejs.ui.LogComponent;var Admin=weavejs.net.Admin;var WeaveAdminService=weavejs.net.WeaveAdminService;var SqlImport=function(_SmartComponent){_inherits(SqlImport,_SmartComponent);function SqlImport(props){_classCallCheck(this,SqlImport);var _this=_possibleConstructorReturn(this,(SqlImport.__proto__||Object.getPrototypeOf(SqlImport)).call(this,props));_this.updateSchemas=function(){Admin.service.getSQLSchemaNames().then(function(schemaNames){return _this.setState({schemaOptions:schemaNames})},_this.handleError)};_this.updateTables=function(schema){if(schema)_this.props.service.getSQLTableNames(schema).then(function(tableOptions){return _this.setState({tableOptions:tableOptions})},_this.handleError)};_this.updateColumns=function(schema,table){if(schema&&table)_this.props.service.getSQLColumnNames(schema,table).then(function(columnOptions){return _this.setState({columnOptions:columnOptions})},_this.handleError)};_this.updateKeyTypeSuggestions=function(){_this.props.service.getKeyTypes().then(function(keyTypeSuggestions){return _this.setState({keyTypeSuggestions:keyTypeSuggestions})},_this.handleError)};_this.handleError=function(error){if(error.message.startsWith(WeaveAdminService.WEAVE_AUTHENTICATION_EXCEPTION)||error.message.startsWith("RemoteException: Incorrect username or password.")){if(_this.login)_this.login.open(function(){return _this.updateSchemas()})}else{_this.setState({errors:_this.state.errors.concat([error.toString()])})}};_this.testKeyColumn=function(){if(_this.state.schema&&_this.state.table&&_this.state.keyColumn){_this.setState({keyColumnTestInProgress:true});var columnCheck=_this.props.service.checkKeyColumnsForSQLImport(_this.state.schema,_this.state.table,[_this.state.keyColumn]);columnCheck.then(function(){_this.setState({keyColumnValid:true,keyColumnTestInProgress:false})},function(error){if(error&&error.message.startsWith("RemoteException: Values in the selected column do not uniquely identify rows in the table.")){_this.setState({keyColumnValid:false,keyColumnTestInProgress:false})}else{_this.setState({keyColumnValid:null,keyColumnTestInProgress:false});_this.handleError(error)}})}};_this.onImportClick=function(){_this.setState({importInProgress:true});_this.props.service.checkKeyColumnsForSQLImport(_this.state.schema,_this.state.table,[_this.state.keyColumn]).then(function(){return _this.props.service.importSQL(_this.state.schema,_this.state.table,_this.state.keyColumn,null,_this.state.displayName,_this.state.keyType,_this.state.filteredKeyColumns,_this.state.append)}).then(function(newId){_this.setState({importInProgress:false});;_this.props.selectIdFunc(newId);PopupWindow.close(_this)},function(error){_this.setState({importInProgress:false});_this.handleError(error)})};_this.state={append:false,schema:null,table:null,displayName:null,keyColumn:null,keyColumnValid:null,keyType:null,filteredKeyColumns:[],schemaOptions:[],tableOptions:[],columnOptions:[],keyTypeSuggestions:[],importInProgress:false,errors:[]};_this.login=new _ServiceLogin2.default(_this,_this.props.service);_this.updateKeyTypeSuggestions();return _this}_createClass(SqlImport,[{key:"componentDidMount",value:function componentDidMount(){this.element=ReactDOM.findDOMNode(this);this.updateSchemas()}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(prevState){if(this.state.schema!=prevState.schema){this.updateTables(this.state.schema)}if(this.state.table!=prevState.table){this.updateColumns(this.state.schema,this.state.table)}}}},{key:"render",value:function render(){var _this2=this;var validityButtonText=void 0;var iconColor=void 0;var keyColumnTestIconClass=void 0;if(this.state.keyColumnTestInProgress){keyColumnTestIconClass="fa fa-fw fa-circle-o-notch fa-spinner";validityButtonText=_weavejs.Weave.lang("The selected column is currently being tested for value uniqueness.")}else{if(this.state.keyColumnValid===true){keyColumnTestIconClass="fa fa-fw fa-check-circle-o";iconColor="green";validityButtonText=_weavejs.Weave.lang("The selected column contains unique values.")}else if(this.state.keyColumnValid===false){keyColumnTestIconClass="fa fa-fw fa-exclamation-circle";iconColor="red";validityButtonText=_weavejs.Weave.lang("The selected column does not contain unique values.")}else{keyColumnTestIconClass="fa fa-fw fa-circle-o";iconColor=null;validityButtonText=_weavejs.Weave.lang("The selected column has not been tested for value uniqueness. Click to test.")}}return React.createElement(VBox,{className:"weave-ToolEditor",style:{justifyContent:"space-between",flex:1}},React.createElement("div",{style:{overflow:"auto",flex:1}},React.createElement("div",{className:"ui dividing header"},_weavejs.Weave.lang("Table")),React.createElement("div",{className:"ui left aligned grid"},React.createElement("div",{className:"one column row",style:{paddingBottom:0}},React.createElement("div",{className:"sixteen wide right aligned column"},React.createElement(Checkbox,{label:_weavejs.Weave.lang("Create a new Weave table entry even if a matching one already exists."),value:!this.state.append,onChange:function onChange(value){return _this2.setState({append:!value})}}))),React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("SQL schema"))),React.createElement("div",{className:"twelve wide column"},React.createElement(HBox,{overflow:true,style:{flex:1}},React.createElement(ComboBox,{style:{flex:1},value:this.state.schema,options:this.state.schemaOptions,onChange:function onChange(schema){_this2.setState({schema:schema})},fluid:false}),React.createElement(Button,{className:"attached",title:_weavejs.Weave.lang("Refresh"),onClick:this.updateSchemas},React.createElement("i",{className:"fa fa-refresh"}))))),React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("SQL table"))),React.createElement("div",{className:"twelve wide column"},React.createElement(HBox,{overflow:true,style:{flex:1}},React.createElement(ComboBox,{value:this.state.table,options:this.state.tableOptions,onChange:function onChange(table){_this2.setState({table:table})}}),React.createElement(Button,{className:"attached",title:_weavejs.Weave.lang("Refresh"),onClick:this.updateSchemas},React.createElement("i",{className:"fa fa-refresh"}))))),React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Table display name"))),React.createElement("div",{className:"twelve wide column"},React.createElement(Input,{type:"text",value:this.state.displayName,onChange:function onChange(evt){return _this2.setState({displayName:evt.target.value})}})))),React.createElement("div",{className:"ui dividing header"},_weavejs.Weave.lang("Data")),React.createElement("div",{className:"ui left aligned grid"},React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Key column")+" ",React.createElement(HelpIcon,null,_weavejs.Weave.lang("A Column that can uniquely identify each row in the data.")))),React.createElement("div",{className:"twelve wide column"},React.createElement(HBox,{overflow:true,style:{flex:1}},React.createElement(ComboBox,{value:this.state.keyColumn,options:this.state.columnOptions,onChange:function onChange(value){if(value!=_this2.state.keyColumn)_this2.setState({keyColumn:value,keyColumnValid:null})}}),React.createElement(Button,{disabled:!this.state.keyColumn,title:validityButtonText,className:"attached",onClick:this.testKeyColumn},React.createElement("span",{style:{whiteSpace:"nowrap"}},React.createElement("i",{style:{color:iconColor},className:keyColumnTestIconClass}),_weavejs.Weave.lang("Test")))))),React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Key namespace")+" ",React.createElement(HelpIcon,null,_weavejs.Weave.lang("Key namespaces are used to link tables using matching key columns.")))),React.createElement("div",{className:"twelve wide column"},React.createElement(HBox,{overflow:true,style:{flex:1}},React.createElement(ComboBox,{allowAdditions:true,type:"search",onNew:function onNew(keyType){_this2.setState({keyType:keyType})},value:this.state.keyType,options:this.state.keyTypeSuggestions,onChange:function onChange(value){return _this2.setState({keyType:value})}}),React.createElement(Button,{className:"attached",title:_weavejs.Weave.lang("Refresh"),onClick:this.updateKeyTypeSuggestions},React.createElement("i",{className:"fa fa-refresh"}))))),React.createElement("div",{className:"two column row",style:{paddingBottom:0}},React.createElement("div",{className:"four wide right aligned column"},React.createElement("div",{className:"ui basic segment"},_weavejs.Weave.lang("Filter columns"))),React.createElement("div",{className:"twelve wide column"},React.createElement(HBox,{overflow:true,style:{flex:1}},React.createElement(ComboBox,{type:"multiple",value:this.state.filteredKeyColumns,options:this.state.columnOptions,onChange:function onChange(value){return _this2.setState({filteredKeyColumns:value})}})))),React.createElement("div",{className:"one column row"},React.createElement(LogComponent,{clearFunc:function clearFunc(){return _this2.setState({errors:[]})},header:"Server error",messages:this.state.errors})))),React.createElement(HBox,{style:{alignSelf:"flex-end"}},React.createElement(Button,{colorClass:"primary",disabled:this.state.importInProgress,onClick:this.onImportClick},_weavejs.Weave.lang("Import")),React.createElement(Button,{colorClass:"secondary",disabled:this.state.importInProgress,onClick:function onClick(){return PopupWindow.close(_this2)}},_weavejs.Weave.lang("Cancel"))))}}]);return SqlImport}(SmartComponent);exports.default=SqlImport;

},{"react":"react","react-dom":"react-dom","weaveapp/admin/ServiceLogin":8,"weavejs":136}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.IAltTextConfig=undefined;var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LinkableString=weavejs.core.LinkableString;var LinkableBoolean=weavejs.core.LinkableBoolean;var IAltTextConfig=exports.IAltTextConfig=function IAltTextConfig(){_classCallCheck(this,IAltTextConfig);this.text=_weavejs.Weave.linkableChild(this,LinkableString);this.showAsCaption=_weavejs.Weave.linkableChild(this,new LinkableBoolean(false))};IAltTextConfig.WEAVE_INFO=_weavejs.Weave.setClassInfo(IAltTextConfig,{id:"weavejs.api.ui.IAltTextConfig"});var IAltText=function IAltText(){_classCallCheck(this,IAltText);this.altText=_weavejs.Weave.linkableChild(this,IAltTextConfig)};exports.default=IAltText;IAltText.WEAVE_INFO=_weavejs.Weave.setClassInfo(IAltText,{id:"weavejs.api.ui.IAltText"});

},{"weavejs":136}],11:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _SelectableAttributeComponent=require("weaveapp/ui/SelectableAttributeComponent");var _SelectableAttributeComponent2=_interopRequireDefault(_SelectableAttributeComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var JS=weavejs.util.JS;var IVisTool=function(_ISelectableAttribute){_inherits(IVisTool,_ISelectableAttribute);function IVisTool(){_classCallCheck(this,IVisTool);return _possibleConstructorReturn(this,(IVisTool.__proto__||Object.getPrototypeOf(IVisTool)).apply(this,arguments))}_createClass(IVisTool,null,[{key:"renderSelectableAttributes",value:function renderSelectableAttributes(selectableAttributes,pushCrumb){return JS.mapEntries(selectableAttributes).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return[_weavejs.Weave.lang(key),React.createElement(_SelectableAttributeComponent2.default,{attributeName:key,attributes:selectableAttributes,pushCrumb:pushCrumb})]})}}]);return IVisTool}(ISelectableAttributes);exports.default=IVisTool;IVisTool.WEAVE_INFO=_weavejs.Weave.setClassInfo(IVisTool,{id:"weavejs.api.ui.IVisTool",interfaces:[ISelectableAttributes]});

},{"react":"react","weaveapp/ui/SelectableAttributeComponent":123,"weavejs":136}],12:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ColumnMetadata=weavejs.api.data.ColumnMetadata;var IDataSource=weavejs.api.data.IDataSource;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var LinkableString=weavejs.core.LinkableString;var ColumnUtils=weavejs.data.ColumnUtils;var DynamicColumn=weavejs.data.column.DynamicColumn;var StringColumn=weavejs.data.column.StringColumn;var ColumnTreeNode=weavejs.data.hierarchy.ColumnTreeNode;var DataSourceUtils=weavejs.data.DataSourceUtils;var ArrayUtils=weavejs.util.ArrayUtils;var AbstractDataSource=weavejs.data.source.AbstractDataSource;var Feature=ol.Feature;var Vector=ol.source.Vector;var GeoJSON=ol.format.GeoJSON;var SpatialJoinTransform=function(_AbstractDataSource){_inherits(SpatialJoinTransform,_AbstractDataSource);function SpatialJoinTransform(){_classCallCheck(this,SpatialJoinTransform);var _this=_possibleConstructorReturn(this,(SpatialJoinTransform.__proto__||Object.getPrototypeOf(SpatialJoinTransform)).call(this));_this.geometryColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.xColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.yColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.pointProjection=_weavejs.Weave.linkableChild(_this,LinkableString);_this._source=new Vector({});_this._parser=new GeoJSON;return _this}_createClass(SpatialJoinTransform,[{key:"initialize",value:function initialize(){var forceRefresh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_get(SpatialJoinTransform.prototype.__proto__||Object.getPrototypeOf(SpatialJoinTransform.prototype),"initialize",this).call(this,true)}},{key:"getHierarchyRoot",value:function getHierarchyRoot(){if(!this._rootNode){this._rootNode=new ColumnTreeNode({dataSource:this,data:this,"label":this.getLabel,hasChildBranches:false,children:[this.generateHierarchyNode({})]})}return this._rootNode}},{key:"generateHierarchyNode",value:function generateHierarchyNode(metadata){metadata[ColumnMetadata.TITLE]=ColumnUtils.getTitle(this.geometryColumn);metadata[ColumnMetadata.KEY_TYPE]=this.xColumn.getMetadata(ColumnMetadata.KEY_TYPE);metadata[ColumnMetadata.DATA_TYPE]=this.geometryColumn.getMetadata(ColumnMetadata.KEY_TYPE);return new ColumnTreeNode({dataSource:this,idFields:[],data:metadata})}},{key:"requestColumnFromSource",value:function requestColumnFromSource(proxyColumn){var metadata=proxyColumn.getProxyMetadata();var geomKeys=this.geometryColumn.keys;var rawGeometries=weavejs.data.ColumnUtils.getGeoJsonGeometries(this.geometryColumn,this.geometryColumn.keys);var key;var feature;this._source.clear();for(var idx=0;idx<geomKeys.length;idx++){var rawGeom=rawGeometries[idx];key=geomKeys[idx];var geometry=this._parser.readGeometry(rawGeom,{dataProjection:ol.proj.get(this.geometryColumn.getMetadata(ColumnMetadata.PROJECTION)),featureProjection:ol.proj.get(this.pointProjection.value)});if(geometry.getExtent().some(_.isNaN)){console.error("Dropping feature",key,"due to containing NaN coordinates. Possibly misconfigured projection?");continue}feature=new Feature(geometry);feature.setId(key);this._source.addFeature(feature)}var keys=[];var data=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=ArrayUtils.union(this.xColumn.keys,this.yColumn.keys)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){key=_step.value;var x=this.xColumn.getValueFromKey(key,Number);var y=this.yColumn.getValueFromKey(key,Number);var features=this._source.getFeaturesAtCoordinate([x,y]);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=features[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){feature=_step2.value;var featureKey=feature.getId();keys.push(key);data.push(featureKey.localName)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var column=new StringColumn(metadata);column.setRecords(keys,data);proxyColumn.setInternalColumn(column)}},{key:"isLocal",get:function get(){return!DataSourceUtils.hasRemoteColumnDependencies(this)}},{key:"selectableAttributes",get:function get(){return new Map().set("Join Geometry",this.geometryColumn).set("Datapoint X",this.xColumn).set("Datapoint Y",this.yColumn)}}]);return SpatialJoinTransform}(AbstractDataSource);exports.default=SpatialJoinTransform;SpatialJoinTransform.WEAVE_INFO=_weavejs.Weave.setClassInfo(SpatialJoinTransform,{id:"weavejs.data.source.SpatialJoinTransform",label:"Spatial Join Transform",interfaces:[IDataSource,ISelectableAttributes]});

},{"lodash":"lodash","openlayers":"openlayers","weavejs":136}],13:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var PopupWindow=weavejs.ui.PopupWindow;var ConfirmationDialog=function(){function ConfirmationDialog(){_classCallCheck(this,ConfirmationDialog)}_createClass(ConfirmationDialog,null,[{key:"open",value:function open(context,message,onOk,onCancel){PopupWindow.open({context:context,title:_weavejs.Weave.lang("Load Session"),content:React.createElement(VBox,{style:{flex:1,justifyContent:"center"}},React.createElement(HBox,{style:{flex:1,alignItems:"center"}},React.createElement("i",{style:{fontSize:50,marginLeft:15},className:"fa fa-exclamation-triangle weave-exclamation-triangle"}),React.createElement("div",{style:{margin:0,marginLeft:5},className:"ui basic segment"},React.createElement("div",{className:"ui basic header"},message)))),resizable:false,modal:true,width:480,height:230,onOk:onOk,onCancel:onCancel})}}]);return ConfirmationDialog}();exports.default=ConfirmationDialog;

},{"react":"react","weavejs":136}],14:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _ConfirmationDialog=require("weaveapp/dialog/ConfirmationDialog");var _ConfirmationDialog2=_interopRequireDefault(_ConfirmationDialog);var _LocalFileOpenComponent=require("weaveapp/dialog/LocalFileOpenComponent");var _LocalFileOpenComponent2=_interopRequireDefault(_LocalFileOpenComponent);var _WeaveServerFileOpenComponent=require("weaveapp/dialog/WeaveServerFileOpenComponent");var _WeaveServerFileOpenComponent2=_interopRequireDefault(_WeaveServerFileOpenComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var SmartComponent=weavejs.ui.SmartComponent;var CenteredIcon=weavejs.ui.CenteredIcon;var List=weavejs.ui.List;var PopupWindow=weavejs.ui.PopupWindow;var FileDialog=function(_SmartComponent){_inherits(FileDialog,_SmartComponent);function FileDialog(props){_classCallCheck(this,FileDialog);var _this=_possibleConstructorReturn(this,(FileDialog.__proto__||Object.getPrototypeOf(FileDialog)).call(this,props));_this.confirmOpenHandler=function(file){if(!_this.props.skipConfirmation){var confirmationMessage=file?_weavejs.Weave.lang("Are you sure you want to open this session? This will overwrite your current workspace."):_weavejs.Weave.lang("Are you sure you want start a new session? This will overwrite your current workspace.");_ConfirmationDialog2.default.open(_this,confirmationMessage,function(){_this.props.openHandler(file);PopupWindow.close(_this)})}else{_this.props.openHandler(file);PopupWindow.close(_this)}};_this.state={selected:FileDialog.MY_COMPUTER};return _this}_createClass(FileDialog,[{key:"componentDidMount",value:function componentDidMount(){}},{key:"render",value:function render(){var _this2=this;var editorJsx=void 0;var fileSource=this.state.selected;var EditorClass=FileDialog.storageRegistry.get(fileSource);if(EditorClass)editorJsx=React.createElement(EditorClass,{openHandler:this.confirmOpenHandler,context:this.props.context});var listOptions=FileDialog.listItems.map(function(fileSource){return{label:React.createElement(HBox,{className:"weave-padded-hbox",style:{padding:15,alignItems:"center"}},React.createElement(HBox,null,React.createElement(CenteredIcon,{className:" ",iconProps:{className:fileSource.iconClass,title:fileSource.label},style:{fontSize:26}}),fileSource.isNewFile?React.createElement("div",{style:{position:"relative"}},React.createElement("i",{className:"fa fa-asterisk",style:{fontSize:"0.5em",position:"absolute",right:0}})):null),React.createElement("span",{style:{overflow:"hidden",marginLeft:20}},fileSource.label)),value:fileSource}}).filter(_.identity);return React.createElement("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"row"}},React.createElement(VBox,{className:"ui attached inverted segment",style:{width:250,padding:0,marginBottom:0}},React.createElement(List,{options:listOptions,multiple:false,selectedValues:[fileSource],onChange:function onChange(selectedValues){if(selectedValues[0]==FileDialog.NEW_SESSION){_this2.forceUpdate();_weavejs.WeaveAPI.Scheduler.callLater(_this2,_this2.confirmOpenHandler,[null])}else{_this2.setState({selected:selectedValues[0]})}}})),React.createElement("div",{className:"ui basic segment weave-file-picker-editor",style:{display:"flex",flex:1,marginTop:0,padding:0}},editorJsx))}}]);return FileDialog}(SmartComponent);exports.default=FileDialog;FileDialog.NEW_SESSION={label:"New Session",iconClass:"fa fa-fw fa-file",isNewFile:true};FileDialog.MY_COMPUTER={label:"My Computer",iconClass:"fa fa-fw fa-desktop"};FileDialog.WEAVE_SERVER={label:"Weave Server",iconClass:"fa fa-fw fa-server"};FileDialog.listItems=[FileDialog.NEW_SESSION,FileDialog.MY_COMPUTER,FileDialog.WEAVE_SERVER];FileDialog.storageRegistry=new Map().set(FileDialog.MY_COMPUTER,_LocalFileOpenComponent2.default).set(FileDialog.WEAVE_SERVER,_WeaveServerFileOpenComponent2.default);

},{"lodash":"lodash","react":"react","weaveapp/dialog/ConfirmationDialog":13,"weaveapp/dialog/LocalFileOpenComponent":18,"weaveapp/dialog/WeaveServerFileOpenComponent":19,"weavejs":136}],15:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _InteractiveTour=require("weaveapp/dialog/InteractiveTour");var _InteractiveTour2=_interopRequireDefault(_InteractiveTour);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var MiscUtils=weavejs.util.MiscUtils;var GetStartedComponent=function(_React$Component){_inherits(GetStartedComponent,_React$Component);function GetStartedComponent(props){_classCallCheck(this,GetStartedComponent);var _this=_possibleConstructorReturn(this,(GetStartedComponent.__proto__||Object.getPrototypeOf(GetStartedComponent)).call(this,props));_this.enableInteractiveTourList=function(){_this.setState({showInteractiveTourList:true})};_this.items={csvToViz:{steps:["CSV file","Location","Preview","Charts","Charts menu","Tool editor"],stepPointers:["CSV file","Open file",null,"Charts","Charts menu",null],contents:["Click on CSV file to load rows of data for visualization","Click on open a file button to load CSV file from your local machine","In this table you can see the data","Click on charts menu to see the available options","Click on one of the desired charts to view your data in chart","Change chart parameters here to understand your data"]}};_this.interactiveListItemClick=function(itemName){var item=_this.items[itemName];_InteractiveTour2.default.startTour(item.steps,item.contents,item.stepPointers);if(_this.props.onViewSelect)_this.props.onViewSelect("tour")};_this.state={showInteractiveTourList:props.showInteractiveTourList!=undefined?props.showInteractiveTourList:false};return _this}_createClass(GetStartedComponent,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.showInteractiveTourList!=nextProps.showInteractiveTourList){this.setState({showInteractiveTourList:nextProps.showInteractiveTourList!=undefined?nextProps.showInteractiveTourList:false})}}},{key:"render",value:function render(){var _this2=this;var urlParams=MiscUtils.getUrlParams();var containerStyle={position:"absolute",left:0,top:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around"};var overlayStyle={position:"absolute",left:0,top:0,width:"100%",height:"100%"};var interactiveTourListUI=null;if(this.state.showInteractiveTourList){interactiveTourListUI=React.createElement(VBox,{style:{position:"relative",fontFamily:"inherit"},className:"weave-guidance-list"},React.createElement("span",{className:"weave-guidance-list-item",onClick:function onClick(){return _this2.interactiveListItemClick("csvToViz")}},"1. CSV Data to Visualization"))}var styleObj=_.merge({},this.props.style,{position:"relative"});var itemTextStyle={textAlign:"center"};var disableStyle={borderColor:"grey",color:"grey",textAlign:"center"};var emptyDiv=interactiveTourListUI?null:React.createElement("div",null);return React.createElement("div",{style:styleObj},React.createElement("div",{style:containerStyle,className:"weave-getstarted"},React.createElement("div",{style:overlayStyle,className:"weave-getstarted-overlay"}),React.createElement("h1",{style:{position:"relative",whiteSpace:"nowrap"},className:"weave-getstarted-logo"},"Weave ",React.createElement("span",{style:{color:"rgb(236, 131, 89)"}},"2")),React.createElement(HBox,{style:{width:"100%",justifyContent:"space-around",position:"relative",flexWrap:"wrap"}},React.createElement(VBox,{key:"data",className:"weave-getstarted-item",onClick:function onClick(){return _this2.props.onViewSelect("default")}},React.createElement("div",{className:"weave-getstarted-item-icon"},React.createElement("i",{className:"fa fa-database"})),React.createElement("span",{style:itemTextStyle}," Load ",React.createElement("span",{style:{color:"rgb(236, 131, 89)"}}," Data"))),React.createElement(VBox,{key:"charts",className:"weave-getstarted-item",onClick:function onClick(){return _this2.props.onViewSelect("file")}},React.createElement("div",{className:"weave-getstarted-item-icon"},React.createElement("i",{className:"fa fa-file"})),React.createElement("span",{style:itemTextStyle}," Load ",React.createElement("span",{style:{color:"rgb(236, 131, 89)"}}," Session"))),React.createElement(VBox,{key:"tutorials",className:"weave-getstarted-item",style:Boolean(urlParams.enableTour)?{cursor:"pointer"}:{cursor:"default"},onClick:Boolean(urlParams.enableTour)?this.enableInteractiveTourList:null},React.createElement("div",{style:Boolean(urlParams.enableTour)?{}:disableStyle,className:"weave-getstarted-item-icon"},React.createElement("i",{className:"fa fa-book"})),React.createElement("span",{style:Boolean(urlParams.enableTour)?itemTextStyle:disableStyle},"Interactive ",React.createElement("span",{style:Boolean(urlParams.enableTour)?{color:"rgb(236, 131, 89)"}:disableStyle}," Tour")))),emptyDiv,interactiveTourListUI))}}]);return GetStartedComponent}(React.Component);exports.default=GetStartedComponent;

},{"lodash":"lodash","react":"react","weaveapp/dialog/InteractiveTour":16,"weavejs":136}],16:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LinkableString=weavejs.core.LinkableString;var InteractiveTour=function(_React$Component){_inherits(InteractiveTour,_React$Component);function InteractiveTour(props){_classCallCheck(this,InteractiveTour);var _this=_possibleConstructorReturn(this,(InteractiveTour.__proto__||Object.getPrototypeOf(InteractiveTour)).call(this,props));_this.targetMountedNode=null;_this.pointerMountedNode=null;_this.updateNextComponentName=function(){var nextStepName=InteractiveTour.stepName.value;if(nextStepName==""){_this.setState({visible:false});InteractiveTour.reset();if(_this.props.onClose){_this.props.onClose()}}else{var stepIndex=InteractiveTour.steps.indexOf(nextStepName);var nextPointerName=InteractiveTour.stepPointers[stepIndex];var mountedElement=InteractiveTour.stepComponentMap[nextStepName];if(mountedElement){_this.targetMountedNode=ReactDOM.findDOMNode(mountedElement);if(InteractiveTour.stepComponentMap[nextStepName]===InteractiveTour.pointerComponentMap[nextPointerName]){_this.pointerMountedNode=_this.targetMountedNode}else{var pointerElement=InteractiveTour.pointerComponentMap[nextPointerName];_this.pointerMountedNode=ReactDOM.findDOMNode(pointerElement)}}_this.setState({activeStepName:nextStepName})}};_this.closeHandler=function(){_this.setState({visible:false});InteractiveTour.reset();if(_this.props.onClose){_this.props.onClose()}};InteractiveTour.stepName.addGroupedCallback(_this,_this.updateNextComponentName,true);_this.state={visible:true,activeStepName:null,tooltipHeight:null,tooltipWidth:null};return _this}_createClass(InteractiveTour,[{key:"render",value:function render(){if(!this.state.activeStepName||!this.state.visible){return React.createElement("div",{style:{position:"fixed"}})}var highlighterStyle={position:"fixed",pointerEvents:"none",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5), 0 0 15px rgba(0, 0, 0, 0.5)",border:"1px solid yellow"};var pointerStyleInner={position:"relative",height:"50%",left:"50%",top:"50%",borderRadius:"50%",transform:"translate(-50%,-50%)",width:"50%"};var pointerStyleOuter={position:"absolute",height:"100%",left:"0",top:"0",borderRadius:"50%",transform:"transform: translateY(-50%)",transformOrigin:"center",width:"100%"};var mountedElementRect=this.targetMountedNode.getBoundingClientRect();highlighterStyle.left=mountedElementRect.left;highlighterStyle.top=mountedElementRect.top;highlighterStyle.width=mountedElementRect.width;highlighterStyle.height=mountedElementRect.height;var leftOverlayStyle={position:"fixed",left:0,top:0,width:mountedElementRect.left,height:"100%",background:"transparent"};var rightOverlayStyle={position:"fixed",left:mountedElementRect.right,top:0,right:0,height:"100%",background:"transparent"};var topOverlayStyle={position:"fixed",left:0,top:0,height:mountedElementRect.top,width:"100%",background:"transparent"};var bottomOverlayStyle={position:"fixed",left:0,bottom:0,top:mountedElementRect.bottom,width:"100%",background:"transparent"};var maxSpace=null;var leftSpace=mountedElementRect.left;var rightSpace=window.innerWidth-mountedElementRect.right;var toolTipPosition=null;toolTipPosition=rightSpace>=leftSpace?InteractiveTourToolTip.RIGHT:InteractiveTourToolTip.LEFT;maxSpace=rightSpace>=leftSpace?rightSpace:leftSpace;var topSpace=mountedElementRect.top;toolTipPosition=maxSpace>=topSpace?toolTipPosition:InteractiveTourToolTip.TOP;maxSpace=maxSpace>=topSpace?maxSpace:topSpace;var bottomSpace=window.innerHeight-mountedElementRect.bottom;toolTipPosition=maxSpace>=bottomSpace?toolTipPosition:InteractiveTourToolTip.BOTTOM;maxSpace=maxSpace>=bottomSpace?maxSpace:bottomSpace;var pxToShift=0;var toolTipPositionStyle={position:"absolute"};if(toolTipPosition==InteractiveTourToolTip.LEFT){toolTipPositionStyle.left=mountedElementRect.left;toolTipPositionStyle.top=mountedElementRect.top+mountedElementRect.height/2;if(this.state.tooltipHeight){toolTipPositionStyle.top=toolTipPositionStyle.top-this.state.tooltipHeight/2;if(toolTipPositionStyle.top<0){toolTipPosition=InteractiveTourToolTip.LEFT_TOP;pxToShift=this.state.tooltipHeight/2-mountedElementRect.height/2}else if(toolTipPositionStyle.top+this.state.tooltipHeight>window.innerHeight){toolTipPosition=InteractiveTourToolTip.LEFT_BOTTOM;pxToShift=-this.state.tooltipHeight/2+mountedElementRect.height/2}}if(this.state.tooltipWidth){toolTipPositionStyle.left=toolTipPositionStyle.left-this.state.tooltipWidth}}else if(toolTipPosition==InteractiveTourToolTip.RIGHT){toolTipPositionStyle.left=mountedElementRect.right;toolTipPositionStyle.top=mountedElementRect.top+mountedElementRect.height/2;if(this.state.tooltipHeight){toolTipPositionStyle.top=toolTipPositionStyle.top-this.state.tooltipHeight/2;if(toolTipPositionStyle.top<0){toolTipPosition=InteractiveTourToolTip.RIGHT_TOP;pxToShift=this.state.tooltipHeight/2-mountedElementRect.height/2}else if(toolTipPositionStyle.top+this.state.tooltipHeight>window.innerHeight){toolTipPosition=InteractiveTourToolTip.RIGHT_BOTTOM;pxToShift=-this.state.tooltipHeight/2+mountedElementRect.height/2}}}else if(toolTipPosition==InteractiveTourToolTip.TOP){toolTipPositionStyle.left=mountedElementRect.left+mountedElementRect.width/2;toolTipPositionStyle.top=mountedElementRect.top;if(this.state.tooltipWidth){toolTipPositionStyle.left=toolTipPositionStyle.left-this.state.tooltipWidth/2;if(toolTipPositionStyle.left<0){toolTipPosition=InteractiveTourToolTip.TOP_LEFT;pxToShift=this.state.tooltipWidth/2-mountedElementRect.width/2}else if(toolTipPositionStyle.left+this.state.tooltipWidth>window.innerWidth){toolTipPosition=InteractiveTourToolTip.TOP_RIGHT;pxToShift=-this.state.tooltipWidth/2+mountedElementRect.width/2}}if(this.state.tooltipHeight){toolTipPositionStyle.top=toolTipPositionStyle.top-this.state.tooltipHeight}}else if(toolTipPosition==InteractiveTourToolTip.BOTTOM){toolTipPositionStyle.left=mountedElementRect.left+mountedElementRect.width/2;toolTipPositionStyle.top=mountedElementRect.bottom;if(this.state.tooltipWidth){toolTipPositionStyle.left=toolTipPositionStyle.left-this.state.tooltipWidth/2;if(toolTipPositionStyle.left<0){toolTipPosition=InteractiveTourToolTip.TOP_LEFT;pxToShift=this.state.tooltipWidth/2-mountedElementRect.width/2}else if(toolTipPositionStyle.left+this.state.tooltipWidth>window.innerWidth){toolTipPosition=InteractiveTourToolTip.TOP_RIGHT;pxToShift=-this.state.tooltipWidth/2+mountedElementRect.width/2}}}var type=null;if(InteractiveTour.steps.indexOf(this.state.activeStepName)==0)type=InteractiveTourToolTip.START;else if(InteractiveTour.steps.indexOf(this.state.activeStepName)==InteractiveTour.steps.length-1)type=InteractiveTourToolTip.DONE;else type=InteractiveTourToolTip.NEXT;var currentStepIndex=InteractiveTour.steps.indexOf(this.state.activeStepName);var contents=InteractiveTour.stepContents[currentStepIndex];var interactionState=InteractiveTour.stepPointers[currentStepIndex]?true:false;var pointerUI=null;if(this.pointerMountedNode){var pointerElementRect=this.targetMountedNode==this.pointerMountedNode?mountedElementRect:this.pointerMountedNode.getBoundingClientRect();var pointerStyle={position:"fixed",pointerEvents:"none",zIndex:1,width:32,height:32};pointerStyle.left=pointerElementRect.left+pointerElementRect.width/2-16;pointerStyle.top=pointerElementRect.top+pointerElementRect.height/2-16;pointerUI=React.createElement("div",{style:pointerStyle},React.createElement("div",{style:pointerStyleInner,className:"weave-guidance-pointer-inner"}),React.createElement("div",{style:pointerStyleOuter,className:"weave-guidance-pointer-outer"}))}return React.createElement("div",null,React.createElement("div",{style:leftOverlayStyle}),React.createElement("div",{style:rightOverlayStyle}),React.createElement("div",{style:topOverlayStyle}),React.createElement("div",{style:bottomOverlayStyle}),React.createElement("div",{style:highlighterStyle}),pointerUI,React.createElement(InteractiveTourToolTip,{ref:"toolTip",style:toolTipPositionStyle,location:toolTipPosition,onNextClick:!interactionState?InteractiveTour.targetComponentOnClick:null,onDoneClick:InteractiveTour.isLastStep(currentStepIndex)?this.closeHandler:null,enableFooter:!interactionState,type:type,stepIndex:currentStepIndex,shift:pxToShift,title:this.state.activeStepName,onClose:this.closeHandler},contents))}},{key:"componentDidUpdate",value:function componentDidUpdate(){var mountedToolTip=this.refs["toolTip"];if(mountedToolTip){var toolTipDOMNode=ReactDOM.findDOMNode(mountedToolTip);var toolTipRect=toolTipDOMNode.getBoundingClientRect();if(this.state.tooltipHeight!=toolTipRect.height||this.state.tooltipWidth!=toolTipRect.width){this.setState({tooltipHeight:toolTipRect.height,tooltipWidth:toolTipRect.width})}}}}],[{key:"startTour",value:function startTour(steps,stepContents,stepPointers){InteractiveTour.enable=true;InteractiveTour.steps=steps;InteractiveTour.stepContents=stepContents;InteractiveTour.stepPointers=stepPointers;InteractiveTour.stepComponentMap={};InteractiveTour.pointerComponentMap={};InteractiveTour.stepComponentRefCallbackMap=new Map;InteractiveTour.stepPointerRefCallbackMap=new Map;function registerMountedComponentToStepName(stepName,mountedElement){if(!mountedElement){if(InteractiveTour.stepComponentMap)InteractiveTour.stepComponentMap[stepName]=null;return}if(InteractiveTour.steps&&InteractiveTour.steps.length>0){var stepIndex=InteractiveTour.steps.indexOf(stepName);if(stepIndex>-1){InteractiveTour.stepComponentMap[stepName]=mountedElement;if(stepIndex==0){InteractiveTour.stepName.value=stepName}if(InteractiveTour.steps[stepIndex]==InteractiveTour.stepPointers[stepIndex]){InteractiveTour.pointerComponentMap[stepName]=mountedElement}if(InteractiveTour.unMountedStepName&&InteractiveTour.unMountedStepName==stepName){InteractiveTour.unMountedStepName=null;InteractiveTour.stepName.value=stepName}}}}function registerPointerComponentToStepName(stepName,mountedElement){if(!mountedElement){if(InteractiveTour.pointerComponentMap)InteractiveTour.pointerComponentMap[stepName]=null;return}if(InteractiveTour.stepPointers&&InteractiveTour.stepPointers.length>0){if(InteractiveTour.stepPointers.indexOf(stepName)>-1){InteractiveTour.pointerComponentMap[stepName]=mountedElement}}}steps.map(function(stepName,index){InteractiveTour.stepComponentRefCallbackMap.set(stepName,registerMountedComponentToStepName.bind(null,stepName))});stepPointers.map(function(stepName,index){if(stepName)InteractiveTour.stepPointerRefCallbackMap.set(stepName,registerPointerComponentToStepName.bind(null,stepName))})}},{key:"callComponentRefCallback",value:function callComponentRefCallback(stepName,classInstance){var func=InteractiveTour.getComponentRefCallback(stepName);if(func)func(classInstance)}},{key:"getComponentRefCallback",value:function getComponentRefCallback(stepName){return InteractiveTour.stepComponentRefCallbackMap&&InteractiveTour.stepComponentRefCallbackMap.get(stepName)}},{key:"getPointerRefCallback",value:function getPointerRefCallback(stepName){return InteractiveTour.stepPointerRefCallbackMap&&InteractiveTour.stepPointerRefCallbackMap.get(stepName)}},{key:"isLastStep",value:function isLastStep(index){return InteractiveTour.steps&&InteractiveTour.steps.length==index+1}},{key:"reset",value:function reset(){InteractiveTour.enable=false;InteractiveTour.steps=null;InteractiveTour.stepContents=null;InteractiveTour.stepPointers=null;InteractiveTour.unMountedStepName=null;InteractiveTour.stepComponentMap=null;InteractiveTour.pointerComponentMap=null;InteractiveTour.stepComponentRefCallbackMap=null;InteractiveTour.stepPointerRefCallbackMap=null}},{key:"targetComponentOnClick",value:function targetComponentOnClick(stepName){if(!InteractiveTour.enable)return;if(InteractiveTour.steps&&InteractiveTour.steps.length>0&&InteractiveTour.steps.indexOf(stepName)!=-1){var currentStepIndex=InteractiveTour.steps.indexOf(stepName);var nextStepName=InteractiveTour.steps[currentStepIndex+1];if(nextStepName){if(InteractiveTour.stepComponentMap[nextStepName]){InteractiveTour.stepName.value=nextStepName}else{InteractiveTour.unMountedStepName=nextStepName}}else InteractiveTour.stepName.value=""}}}]);return InteractiveTour}(React.Component);exports.default=InteractiveTour;InteractiveTour.stepName=new LinkableString;InteractiveTour.unMountedStepName=null;InteractiveTour.enable=false;InteractiveTour.steps=null;InteractiveTour.stepContents=null;InteractiveTour.stepPointers=null;InteractiveTour.stepComponentMap=null;InteractiveTour.pointerComponentMap=null;InteractiveTour.stepComponentRefCallbackMap=null;InteractiveTour.stepPointerRefCallbackMap=null;var InteractiveTourToolTip=function(_React$Component2){_inherits(InteractiveTourToolTip,_React$Component2);function InteractiveTourToolTip(props){_classCallCheck(this,InteractiveTourToolTip);var _this2=_possibleConstructorReturn(this,(InteractiveTourToolTip.__proto__||Object.getPrototypeOf(InteractiveTourToolTip)).call(this,props));_this2.closeHandler=function(){_this2.props.onClose&&_this2.props.onClose()};_this2.nextHandler=function(){_this2.props.onNextClick&&_this2.props.onNextClick(_this2.props.title)};_this2.state={visible:true};return _this2}_createClass(InteractiveTourToolTip,[{key:"render",value:function render(){var styleObject=_.merge({},this.props.style,{display:"flex",alignItems:"center",minWidth:"200px",maxWidth:"300px"});var containerStyle={padding:"8px"};var arrowStyle={};if(this.props.location==InteractiveTourToolTip.BOTTOM||this.props.location==InteractiveTourToolTip.BOTTOM_LEFT||this.props.location==InteractiveTourToolTip.BOTTOM_RIGHT){styleObject.flexDirection="column";arrowStyle.borderTopColor="transparent";arrowStyle.borderLeftColor="transparent";arrowStyle.borderRightColor="transparent";if(this.props.location!=InteractiveTourToolTip.BOTTOM){containerStyle.position="relative";containerStyle.left=this.props.shift}}else if(this.props.location==InteractiveTourToolTip.TOP||this.props.location==InteractiveTourToolTip.TOP_LEFT||this.props.location==InteractiveTourToolTip.TOP_RIGHT){styleObject.flexDirection="column-reverse";arrowStyle["borderBottomColor"]="transparent";arrowStyle.borderLeftColor="transparent";arrowStyle.borderRightColor="transparent";if(this.props.location!=InteractiveTourToolTip.TOP){containerStyle.position="relative";containerStyle.left=this.props.shift}}else if(this.props.location==InteractiveTourToolTip.RIGHT||this.props.location==InteractiveTourToolTip.RIGHT_BOTTOM||this.props.location==InteractiveTourToolTip.RIGHT_TOP){styleObject.flexDirection="row";arrowStyle.borderTopColor="transparent";arrowStyle["borderBottomColor"]="transparent";arrowStyle.borderLeftColor="transparent";if(this.props.location!=InteractiveTourToolTip.RIGHT){containerStyle.position="relative";containerStyle.top=this.props.shift}}else if(this.props.location==InteractiveTourToolTip.LEFT||this.props.location==InteractiveTourToolTip.LEFT_BOTTOM||this.props.location==InteractiveTourToolTip.LEFT_TOP){styleObject.flexDirection="row-reverse";arrowStyle.borderTopColor="transparent";arrowStyle["borderBottomColor"]="transparent";arrowStyle.borderRightColor="transparent";if(this.props.location!=InteractiveTourToolTip.LEFT){containerStyle.position="relative";containerStyle.top=this.props.shift}}var tooltipHeader={display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #FFBE00",paddingBottom:"8px"};var buttonStyle={cursor:"pointer",color:"#FFBE00"};var footerUI=null;var closeButtonUI=null;if(this.props.enableFooter){var tooltipFooter={display:"flex",justifyContent:"flex-end",borderTop:"1px solid #FFBE00",paddingTop:"8px"};var nextButtonUI=this.props.onNextClick?React.createElement("div",{style:buttonStyle,onClick:this.nextHandler},"Next"):null;var doneButtonUI=this.props.onDoneClick?React.createElement("div",{style:buttonStyle,onClick:this.closeHandler},"Done"):null;if(this.props.onDoneClick){nextButtonUI=null}footerUI=React.createElement("div",{style:tooltipFooter},nextButtonUI,doneButtonUI)}if(!this.props.onDoneClick){closeButtonUI=React.createElement("div",{style:buttonStyle,onClick:this.closeHandler},"\u2715")}var contentStyle={padding:"8px"};return React.createElement("div",{style:styleObject},React.createElement("div",{style:arrowStyle,className:"weave-guidance-toolTip-arrow"}),React.createElement("div",{style:containerStyle,className:"weave-guidance-toolTip"},React.createElement("div",{style:tooltipHeader},React.createElement("div",null,React.createElement("span",{style:{color:"#FFBE00"}},"Step (",this.props.stepIndex+1," of ",InteractiveTour.steps.length,") : "),this.props.title),closeButtonUI),React.createElement("div",{style:contentStyle},this.props.children),footerUI))}}]);return InteractiveTourToolTip}(React.Component);InteractiveTourToolTip.START="Start";InteractiveTourToolTip.NEXT="Next";InteractiveTourToolTip.DONE="Done";InteractiveTourToolTip.BOTTOM="bottom";InteractiveTourToolTip.BOTTOM_LEFT="bottom left";InteractiveTourToolTip.BOTTOM_RIGHT="bottom right";InteractiveTourToolTip.TOP="top";InteractiveTourToolTip.TOP_LEFT="top left";InteractiveTourToolTip.TOP_RIGHT="top right";InteractiveTourToolTip.LEFT="left";InteractiveTourToolTip.LEFT_TOP="left top";InteractiveTourToolTip.LEFT_BOTTOM="left bottom";InteractiveTourToolTip.RIGHT="right";InteractiveTourToolTip.RIGHT_TOP="right top";InteractiveTourToolTip.RIGHT_BOTTOM="right bottom";

},{"lodash":"lodash","react":"react","react-dom":"react-dom","weavejs":136}],17:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _WeaveApp=require("weaveapp/WeaveApp");var _WeaveApp2=_interopRequireDefault(_WeaveApp);var _GetStartedComponent=require("weaveapp/dialog/GetStartedComponent");var _GetStartedComponent2=_interopRequireDefault(_GetStartedComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MiscUtils=weavejs.util.MiscUtils;var WEAVE_EXTERNAL_TOOLS="WeaveExternalTools";var LandingPage=function(_React$Component){_inherits(LandingPage,_React$Component);function LandingPage(props){_classCallCheck(this,LandingPage);var _this=_possibleConstructorReturn(this,(LandingPage.__proto__||Object.getPrototypeOf(LandingPage)).call(this,props));_this.loadGetStartedComponentWithTourList=function(){_this.props.weave.history.clearHistory();_this.props.weave.root.removeAllObjects();_this.setState({view:"tour list"})};_this.urlParams=MiscUtils.getUrlParams();var weaveExternalTools;try{weaveExternalTools=window&&window.opener&&window.opener[WEAVE_EXTERNAL_TOOLS]}catch(e){weaveExternalTools=null}var view=props.initialView;var exportedFromFlash=weaveExternalTools&&weaveExternalTools[window.name];if(_this.urlParams.skipIntro||_this.urlParams.file||exportedFromFlash)view="default";_this.state={view:view};return _this}_createClass(LandingPage,[{key:"render",value:function render(){var _this2=this;if(this.state.view=="splash"||this.state.view=="tour list"){return React.createElement(_GetStartedComponent2.default,{style:{width:"100%",height:"100%"},showInteractiveTourList:this.state.view=="tour list",onViewSelect:function onViewSelect(view){_this2.setState({view:view})}})}return React.createElement(_WeaveApp2.default,{ref:this.props.weaveAppRef,weave:this.props.weave,style:{width:"100%",height:"100%"},showFileDialog:this.state.view=="file",enableTour:this.state.view=="tour",readUrlParams:true,onClose:this.loadGetStartedComponentWithTourList})}}]);return LandingPage}(React.Component);exports.default=LandingPage;

},{"react":"react","weaveapp/WeaveApp":2,"weaveapp/dialog/GetStartedComponent":15,"weavejs":136}],18:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _reactDropzone=require("weaveapp/modules/react-dropzone");var _reactDropzone2=_interopRequireDefault(_reactDropzone);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VBox=weavejs.ui.flexbox.VBox;var LocalFileOpenComponent=function(_React$Component){_inherits(LocalFileOpenComponent,_React$Component);function LocalFileOpenComponent(props){_classCallCheck(this,LocalFileOpenComponent);var _this=_possibleConstructorReturn(this,(LocalFileOpenComponent.__proto__||Object.getPrototypeOf(LocalFileOpenComponent)).call(this,props));_this.handleFileChange=function(event){var file=event.target.files[0];if(file)_this.props.openHandler(file)};_this.state={rejected:false};return _this}_createClass(LocalFileOpenComponent,[{key:"render",value:function render(){var _this2=this;return React.createElement(VBox,{className:"weave-file-picker-container",style:{flex:1,padding:10}},React.createElement(VBox,{style:{flex:1,alignItems:"center"}},React.createElement(_reactDropzone2.default,{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,fontSize:24},className:this.state.rejected?"weave-dropzone-file-error":"weave-dropzone-file",activeStyle:{border:"8px solid #CCC"},onDropAccepted:function onDropAccepted(files){files.map(function(file){_this2.props.openHandler(file)})},onDropRejected:function onDropRejected(files){_this2.setState({rejected:true})},accept:".weave",disableClick:false},React.createElement("span",null,_weavejs.Weave.lang("Click to open a .weave file")),React.createElement("div",{className:"ui horizontal divider",style:{width:"50%"}},_weavejs.Weave.lang("Or")),React.createElement(VBox,{style:{alignItems:"center"}},React.createElement("span",null,_weavejs.Weave.lang("Drag it here")),this.state.rejected?React.createElement("span",null,_weavejs.Weave.lang("The specified file could not be imported. Only files with the following extensions are allowed: weave")):""))))}}]);return LocalFileOpenComponent}(React.Component);exports.default=LocalFileOpenComponent;

},{"react":"react","weaveapp/modules/react-dropzone":67,"weavejs":136}],19:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataTable=require("weaveapp/ui/DataTable");var _DataTable2=_interopRequireDefault(_DataTable);var _ServiceLogin=require("weaveapp/admin/ServiceLogin");var _ServiceLogin2=_interopRequireDefault(_ServiceLogin);var _FileInfoView=require("weaveapp/ui/FileInfoView");var _FileInfoView2=_interopRequireDefault(_FileInfoView);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Label=weavejs.ui.flexbox.Label;var SmartComponent=weavejs.ui.SmartComponent;var CenteredIcon=weavejs.ui.CenteredIcon;var Button=weavejs.ui.Button;var Admin=weavejs.net.Admin;var WeaveServerFileOpenComponent=function(_SmartComponent){_inherits(WeaveServerFileOpenComponent,_SmartComponent);function WeaveServerFileOpenComponent(props){_classCallCheck(this,WeaveServerFileOpenComponent);var _this=_possibleConstructorReturn(this,(WeaveServerFileOpenComponent.__proto__||Object.getPrototypeOf(WeaveServerFileOpenComponent)).call(this,props));_this.handleSuccess=function(fields){_this.getWeaveFiles()};_this.getWeaveFiles=function(){Admin.service.getWeaveFileNames(_this.state.allFiles).then(function(fileNames){_this.setState({fileNames:fileNames})},function(error){_this.setState({fileNames:[],fileInfo:null});_this.openLogin()})};_this.openLogin=function(){if(_this.element)_this.login.open(_this.handleSuccess,_this.handleCancel)};_this.handleCancel=function(){_this.setState({fileNames:[],fileInfo:null})};_this.state={fileInfo:null,fileNames:[],allFiles:true};_this.login=new _ServiceLogin2.default(_this.props.context,Admin.service);return _this}_createClass(WeaveServerFileOpenComponent,[{key:"componentDidMount",value:function componentDidMount(){this.element=ReactDOM.findDOMNode(this);this.getWeaveFiles()}},{key:"componentDidUpdate",value:function componentDidUpdate(){}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.element=null}},{key:"render",value:function render(){var _this2=this;this.dimmerSelector=this.element;var fileList=this.state.fileNames.map(function(file){return{label:React.createElement(Label,{style:{flex:1}},file),value:file}});var rows=fileList.map(function(file){return{filename:file.value,filelabel:React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},React.createElement(CenteredIcon,{iconProps:{className:"fa fa-file-text-o fa-fw"}}),React.createElement(Label,{style:{flex:1}},file.value))}});var columnIds=["filelabel"];var columnTitles={};var fileLocationForm=React.createElement("div",{className:"ui form",style:{paddingLeft:"1rem"}},React.createElement("div",{className:"inline fields"},React.createElement("div",{className:"ui grid",style:{flex:1}},React.createElement("div",{className:"two column row"},React.createElement("div",{className:"right floated column"},React.createElement("div",{className:"field"},React.createElement("div",{className:"ui radio checkbox"},React.createElement("input",{type:"radio",checked:!this.state.allFiles,onChange:function onChange(e){_this2.setState({allFiles:false})}}),React.createElement(Label,null,_weavejs.Weave.lang("My files"))))),React.createElement("div",{className:"column"},React.createElement("div",{className:"field"},React.createElement("div",{className:"ui radio checkbox"},React.createElement("input",{type:"radio",checked:this.state.allFiles,onChange:function onChange(e){_this2.setState({allFiles:true})}}),React.createElement(Label,null,_weavejs.Weave.lang("All files")))))))));return React.createElement(VBox,{className:"weave-file-picker-container",style:{flex:1,padding:10}},React.createElement(HBox,{className:"weave-server-file-view",style:{flex:1}},React.createElement(VBox,{style:{flex:1}},fileLocationForm,React.createElement(VBox,{style:{flex:1,border:"1px solid #D6D6D6"}},React.createElement(_DataTable2.default,{rows:rows,columnIds:columnIds,idProperty:"filename",columnTitles:columnTitles,onCellDoubleClick:function onCellDoubleClick(fileName){_this2.props.openHandler("/"+fileName)},multiple:false,disableSort:true,headerHeight:0,rowHeight:40,onSelection:function onSelection(selectedFiles){if(selectedFiles[0])Admin.service.getWeaveFileInfo(selectedFiles[0]).then(function(fileInfo){if(_this2.element)_this2.setState({fileInfo:fileInfo})},_this2.openLogin)}}))),React.createElement(VBox,{style:{flex:1,paddingLeft:20}},React.createElement("span",{style:{alignSelf:"flex-end"}},Admin.instance.userHasAuthenticated?_weavejs.Weave.lang("Signed in as {0}",Admin.instance.activeConnectionName):_weavejs.Weave.lang("Not signed in")),React.createElement(Button,{colorClass:"primary",onClick:function onClick(){if(Admin.instance.userHasAuthenticated){Admin.service.authenticate("","").then(function(){_this2.setState({fileNames:[],fileInfo:null})},function(){_this2.setState({fileNames:[],fileInfo:null})})}else{_this2.openLogin()}},style:{alignSelf:"flex-end"}},Admin.instance.userHasAuthenticated?_weavejs.Weave.lang("Sign Out"):_weavejs.Weave.lang("Sign in")),React.createElement(_FileInfoView2.default,{fileInfo:this.state.fileInfo},this.state.fileInfo?React.createElement(Button,{onClick:function onClick(){_this2.props.openHandler("/"+_this2.state.fileInfo.fileName)},style:{marginLeft:8}},_weavejs.Weave.lang("Load Session")):null))))}}]);return WeaveServerFileOpenComponent}(SmartComponent);exports.default=WeaveServerFileOpenComponent;

},{"react":"react","react-dom":"react-dom","weaveapp/admin/ServiceLogin":8,"weaveapp/ui/DataTable":117,"weaveapp/ui/FileInfoView":118,"weavejs":136}],20:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LinkableBoolean=weavejs.core.LinkableBoolean;var ColumnDataFilter=weavejs.data.key.ColumnDataFilter;var IColumnStatistics=weavejs.api.data.IColumnStatistics;var LinkableWatcher=weavejs.core.LinkableWatcher;var AbstractFilterEditor=function(_React$Component){_inherits(AbstractFilterEditor,_React$Component);function AbstractFilterEditor(props){_classCallCheck(this,AbstractFilterEditor);var _this=_possibleConstructorReturn(this,(AbstractFilterEditor.__proto__||Object.getPrototypeOf(AbstractFilterEditor)).call(this,props));_this.showPlayButton=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.showToggle=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(true));_this.showToggleLabel=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.filterWatcher=_weavejs.Weave.privateLinkableChild(_this,new LinkableWatcher(ColumnDataFilter),_this.handleFilter);_this.statsWatcher=_weavejs.Weave.privateLinkableChild(_this,new LinkableWatcher(IColumnStatistics),_this.handleColumn);_this.options=[];_weavejs.Weave.getCallbacks(_this).addGroupedCallback(_this,_this.forceUpdate);return _this}_createClass(AbstractFilterEditor,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){this.filterWatcher.target=props.filter;this.statsWatcher.target=this.column?_weavejs.WeaveAPI.StatisticsCache.getColumnStatistics(this.column):null}},{key:"handleFilter",value:function handleFilter(){}},{key:"handleColumn",value:function handleColumn(){}},{key:"componentDidMount",value:function componentDidMount(){}},{key:"onChange",value:function onChange(selectedValues){var filter=this.filter;if(filter)filter.values.state=Array.isArray(selectedValues)?selectedValues:[selectedValues]}},{key:"filter",get:function get(){return this.filterWatcher.target},set:function set(columnDataFilter){this.filterWatcher.target=columnDataFilter}},{key:"column",get:function get(){var filter=this.filter;return filter?filter.column:null}},{key:"stats",get:function get(){return this.statsWatcher.target}},{key:"deprecatedStateMapping",get:function get(){return{"showPlayButton":this.showPlayButton,"showToggle":this.showToggle,"showToggleLabel":this.showToggleLabel}}}]);return AbstractFilterEditor}(React.Component);exports.default=AbstractFilterEditor;

},{"react":"react","weavejs":136}],21:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BinningDefinitionSelector=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _ColumnSelector=require("weaveapp/ui/ColumnSelector");var _ColumnSelector2=_interopRequireDefault(_ColumnSelector);var _SelectableAttributeComponent=require("weaveapp/ui/SelectableAttributeComponent");var _SelectableAttributeComponent2=_interopRequireDefault(_SelectableAttributeComponent);var _BinNamesList=require("weaveapp/ui/BinNamesList");var _BinNamesList2=_interopRequireDefault(_BinNamesList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var StatefulTextField=weavejs.ui.StatefulTextField;var HelpIcon=weavejs.ui.HelpIcon;var Checkbox=weavejs.ui.Checkbox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ReactUtils=weavejs.util.ReactUtils;var Button=weavejs.ui.Button;var ComboBox=weavejs.ui.ComboBox;var SmartComponent=weavejs.ui.SmartComponent;var BinnedColumn=weavejs.data.column.BinnedColumn;var SimpleBinningDefinition=weavejs.data.bin.SimpleBinningDefinition;var CustomSplitBinningDefinition=weavejs.data.bin.CustomSplitBinningDefinition;var QuantileBinningDefinition=weavejs.data.bin.QuantileBinningDefinition;var EqualIntervalBinningDefinition=weavejs.data.bin.EqualIntervalBinningDefinition;var StandardDeviationBinningDefinition=weavejs.data.bin.StandardDeviationBinningDefinition;var CategoryBinningDefinition=weavejs.data.bin.CategoryBinningDefinition;var NaturalJenksBinningDefinition=weavejs.data.bin.NaturalJenksBinningDefinition;function Weave_linkState(a,b){if(a!=b)_weavejs.Weave.linkState(a,b)}var BinningDefinitionEditor=function(_React$Component){_inherits(BinningDefinitionEditor,_React$Component);function BinningDefinitionEditor(props){_classCallCheck(this,BinningDefinitionEditor);var _this=_possibleConstructorReturn(this,(BinningDefinitionEditor.__proto__||Object.getPrototypeOf(BinningDefinitionEditor)).call(this,props));_this.onBinButtonClick=function(event){if(_this.props.pushCrumb){_this.props.pushCrumb("Binning",_this.renderBinningDefinitionSelectorForEditor,null)}else if(_this.props.onButtonClick){_this.props.onButtonClick(event)}};_this.renderBinningDefinitionSelectorForEditor=function(){var _ColumnSelector$findS=_ColumnSelector2.default.findSelectableAttributes(_this.props.binnedColumn),_ColumnSelector$findS2=_slicedToArray(_ColumnSelector$findS,2),attributeName=_ColumnSelector$findS2[0],attributes=_ColumnSelector$findS2[1];return React.createElement(BinningDefinitionSelector,{showNoneOption:_this.props.showNoneOption,attributeName:attributeName,attributes:attributes,pushCrumb:_this.props.pushCrumb})};return _this}_createClass(BinningDefinitionEditor,[{key:"renderCompactView",value:function renderCompactView(){var binDef=this.props.binnedColumn.binningDefinition.target;var binLabel=binDef?BinningDefinitionEditor.binClassToBinLabel.get(binDef.constructor):"None";var tableStyles={table:{width:"100%",fontSize:"inherit"},td:[{textAlign:"right",whiteSpace:"nowrap",paddingRight:8},{paddingBottom:8,width:"100%",paddingLeft:8}]};return React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},React.createElement("span",{style:{flex:1,textAlign:"right"}},binLabel),React.createElement(Button,{onClick:this.onBinButtonClick},React.createElement("i",{className:"fa fa-angle-right","aria-hidden":"true",style:{fontWeight:"bold"}})))}},{key:"renderFullView",value:function renderFullView(){var _ColumnSelector$findS3=_ColumnSelector2.default.findSelectableAttributes(this.props.binnedColumn),_ColumnSelector$findS4=_slicedToArray(_ColumnSelector$findS3,2),attributeName=_ColumnSelector$findS4[0],attributes=_ColumnSelector$findS4[1];return React.createElement(BinningDefinitionSelector,{showNoneOption:this.props.showNoneOption,attributeName:attributeName,attributes:attributes,pushCrumb:this.props.pushCrumb,insertTableRows:this.props.insertTableRows})}},{key:"render",value:function render(){return this.props.compact?this.renderCompactView():this.renderFullView()}}]);return BinningDefinitionEditor}(React.Component);exports.default=BinningDefinitionEditor;BinningDefinitionEditor.binClassToBinLabel=new Map().set(SimpleBinningDefinition,"Equally spaced").set(CustomSplitBinningDefinition,"Custom breaks").set(QuantileBinningDefinition,"Quantile").set(EqualIntervalBinningDefinition,"Equal interval").set(StandardDeviationBinningDefinition,"Standard deviations").set(NaturalJenksBinningDefinition,"Natural breaks").set(CategoryBinningDefinition,"All categories (string values)");var BinningDefinitionSelector=exports.BinningDefinitionSelector=function(_SmartComponent){_inherits(BinningDefinitionSelector,_SmartComponent);function BinningDefinitionSelector(props){_classCallCheck(this,BinningDefinitionSelector);var _this2=_possibleConstructorReturn(this,(BinningDefinitionSelector.__proto__||Object.getPrototypeOf(BinningDefinitionSelector)).call(this,props));_this2._simple=_weavejs.Weave.disposableChild(_this2,SimpleBinningDefinition);_this2._customSplit=_weavejs.Weave.disposableChild(_this2,CustomSplitBinningDefinition);_this2._quantile=_weavejs.Weave.disposableChild(_this2,QuantileBinningDefinition);_this2._equalInterval=_weavejs.Weave.disposableChild(_this2,EqualIntervalBinningDefinition);_this2._stdDev=_weavejs.Weave.disposableChild(_this2,StandardDeviationBinningDefinition);_this2._category=_weavejs.Weave.disposableChild(_this2,CategoryBinningDefinition);_this2._jenks=_weavejs.Weave.disposableChild(_this2,NaturalJenksBinningDefinition);_this2._allBinDefs=[_this2._simple,_this2._customSplit,_this2._quantile,_this2._equalInterval,_this2._stdDev,_this2._category,_this2._jenks];_this2.binLabelToBin=new Map().set("Equally spaced",_this2._simple).set("Custom breaks",_this2._customSplit).set("Quantile",_this2._quantile).set("Equal interval",_this2._equalInterval).set("Standard deviations",_this2._stdDev).set("Natural breaks",_this2._jenks).set("All categories (string values)",_this2._category).set("None",null);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_this2._allBinDefs[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var def=_step.value;_weavejs.Weave.getCallbacks(def).addGroupedCallback(_this2,_this2.updateTargetBinningDef)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(_this2.column){_this2.column.binningDefinition.addGroupedCallback(_this2,_this2.forceUpdate);_this2.handleBinnedColumnChange(_this2.column)}return _this2}_createClass(BinningDefinitionSelector,[{key:"getColumn",value:function getColumn(props){var icw=props.attributes.get(props.attributeName);return _weavejs.Weave.AS(icw,BinnedColumn)||_weavejs.Weave.getDescendants(icw,BinnedColumn)[0]}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var newColumn=this.getColumn(nextProps);if(this.column!==newColumn){if(this.column)this.column.binningDefinition.removeCallback(this,this.forceUpdate);if(newColumn){newColumn.binningDefinition.addGroupedCallback(this,this.forceUpdate);this.handleBinnedColumnChange(newColumn)}}}},{key:"handleBinnedColumnChange",value:function handleBinnedColumnChange(binnedColumn){var selectedBinDefn=binnedColumn.binningDefinition.target;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this._allBinDefs[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var localDef=_step2.value;if(this.compareTargetBinningType(localDef))_weavejs.Weave.copyState(selectedBinDefn,localDef)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"compareTargetBinningType",value:function compareTargetBinningType(localDef){var selectedBinDefn=this.column.binningDefinition.target;if(localDef==null&&selectedBinDefn==null)return true;if(localDef&&selectedBinDefn)return localDef.constructor==selectedBinDefn.constructor;return false}},{key:"updateTargetBinningDef",value:function updateTargetBinningDef(){var targetDef=this.column.binningDefinition.target;if(targetDef){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this._allBinDefs[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var localDef=_step3.value;if(this.compareTargetBinningType(localDef))_weavejs.Weave.copyState(localDef,targetDef)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}},{key:"linkOverride",value:function linkOverride(property){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this._allBinDefs[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var def=_step4.value;var abd=def;if(abd[property]&&this.compareTargetBinningType(def)){return WeaveReactUtils.linkReactStateRef(this,{value:abd[property]},500)}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"setBinningDefinition",value:function setBinningDefinition(localDef){var targetDef=this.column.binningDefinition.target;if(localDef){if(targetDef&&localDef.constructor==targetDef.constructor)return;this.column.binningDefinition.requestLocalObjectCopy(localDef);targetDef=this.column.binningDefinition.target;_weavejs.Weave.linkState(targetDef,localDef)}else{this.column.binningDefinition.target=null}}},{key:"linkBinningDefinition",value:function linkBinningDefinition(value){return WeaveReactUtils.linkReactStateRef(this,{value:value},500)}},{key:"hasOverrideMinAndMax",value:function hasOverrideMinAndMax(){var binDef=this.column.binningDefinition.target;return!!(binDef&&binDef.overrideInputMin&&binDef.overrideInputMax)}},{key:"getBinDefRenderProps",value:function getBinDefRenderProps(binDef){var renderObj={sessionObjectToLink:null,sessionObjectLabel:"",helpMessage:"",style:{width:60}};if(binDef instanceof SimpleBinningDefinition){Weave_linkState(binDef,this._simple);renderObj.sessionObjectToLink=binDef.numberOfBins;renderObj.sessionObjectLabel="Number of bins";renderObj.helpMessage="Example: If your data is between 0 and 100 and you specify 4 bins, the following bins will be created: [0,25] [25,50] [50,75] [75,100]"}else if(binDef instanceof EqualIntervalBinningDefinition){Weave_linkState(binDef,this._equalInterval);renderObj.sessionObjectToLink=binDef.dataInterval;renderObj.sessionObjectLabel="Data interval";renderObj.helpMessage="Example: If your data is between 0 and 100 and you specify an interval of 25, four bins will be created: [0,25] [25,50] [50,75] [75,100]"}else if(binDef instanceof QuantileBinningDefinition){Weave_linkState(binDef,this._quantile);renderObj.sessionObjectToLink=binDef.refQuantile;renderObj.sessionObjectLabel="Reference quantile";renderObj.helpMessage="Example: If you specify 0.25, four bins will be created that each contain 25% of your data in sorted order"}else if(binDef instanceof NaturalJenksBinningDefinition){Weave_linkState(binDef,this._jenks);renderObj.sessionObjectToLink=binDef.numOfBins;renderObj.sessionObjectLabel="Number of bins";renderObj.helpMessage="The Jenks optimization method, also called the Jenks natural breaks classification method, is a data classification method designed to determine the best arrangement of values into different classes. See http://en.wikipedia.org/wiki/Jenks_natural_breaks_optimization"}else if(binDef instanceof CustomSplitBinningDefinition){Weave_linkState(binDef,this._customSplit);renderObj.sessionObjectToLink=binDef.splitValues;renderObj.sessionObjectLabel="Break values";renderObj.helpMessage="Enter comma-separated custom break values for dividing the data into bins. Example: 0,50,100 will create two bins: [0,50] and [50,100]";renderObj.style={flex:5}}else if(binDef instanceof StandardDeviationBinningDefinition){Weave_linkState(binDef,this._stdDev);renderObj.helpMessage="Six bins will be created for standard deviations above and below the mean value."}return renderObj}},{key:"render",value:function render(){var _this3=this;var options=Array.from(this.binLabelToBin.keys());if(!this.props.showNoneOption)options=options.filter(function(key){return!!_this3.binLabelToBin.get(key)});var selectedBinDefn=this.column.binningDefinition.target;var selectedDefinitionName=selectedBinDefn?BinningDefinitionEditor.binClassToBinLabel.get(selectedBinDefn.constructor):"None";if(this.props.pushCrumb){var renderProps=this.getBinDefRenderProps(selectedBinDefn);return React.createElement(VBox,{overflow:true,className:"weave-padded-vbox"},ReactUtils.generateTable({body:[].concat(this.props.insertTableRows||[],[[_weavejs.Weave.lang(this.props.attributeName),React.createElement(_SelectableAttributeComponent2.default,{attributeName:this.props.attributeName,attributes:this.props.attributes,pushCrumb:this.props.pushCrumb})],[_weavejs.Weave.lang("Binning method"),React.createElement(HBox,{overflow:true,className:"weave-padded-hbox",style:{alignItems:"center"}},React.createElement(ComboBox,{style:{flex:1},options:options,value:selectedDefinitionName,onChange:function onChange(binLabel){return _this3.setBinningDefinition(_this3.binLabelToBin.get(binLabel))}}),React.createElement(HelpIcon,{style:{fontSize:"initial"}},_weavejs.Weave.lang(renderProps.helpMessage)))],renderProps.sessionObjectToLink&&[React.createElement("span",{style:{whiteSpace:"nowrap"}}," ",_weavejs.Weave.lang(renderProps.sessionObjectLabel)," "),React.createElement(StatefulTextField,{style:{flex:1},type:"text",ref:this.linkBinningDefinition(renderProps.sessionObjectToLink)})],this.hasOverrideMinAndMax()&&[React.createElement("span",{style:{whiteSpace:"nowrap"}}," ",_weavejs.Weave.lang("Override data range")),React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},React.createElement(StatefulTextField,{type:"number",placeholder:"min",style:{flex:1},ref:this.linkOverride("overrideInputMin")}),React.createElement(StatefulTextField,{type:"number",placeholder:"max",style:{flex:1},ref:this.linkOverride("overrideInputMax")}))]]),classes:{td:["weave-left-cell","weave-right-cell"]}}),selectedBinDefn?React.createElement(HBox,{style:{flex:1}},React.createElement(_BinNamesList2.default,{binningDefinition:selectedBinDefn})):null)}var binUIs=[];var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{var _loop=function _loop(){var _step5$value=_slicedToArray(_step5.value,2),key=_step5$value[0],binDefn=_step5$value[1];if(!binDefn&&!_this3.props.showNoneOption)return"continue";var isSelected=_this3.compareTargetBinningType(binDefn);var renderProps=_this3.getBinDefRenderProps(binDefn);binUIs.push(React.createElement(HBox,{padded:true,overflow:true,key:key,style:{alignItems:"center"}},React.createElement(Checkbox,{type:"radio",name:"binningDefinitions",value:isSelected,label:_weavejs.Weave.lang(key),onChange:function onChange(value){return value?_this3.setBinningDefinition(binDefn):null}}),React.createElement("span",{style:{flex:1}}),renderProps.sessionObjectToLink?[React.createElement("span",{key:"0",style:{opacity:isSelected?1:0.5,whiteSpace:"nowrap"}}," ",_weavejs.Weave.lang(renderProps.sessionObjectLabel)," "),React.createElement(StatefulTextField,{key:"1",style:renderProps.style,disabled:!isSelected,type:"text",ref:_this3.linkBinningDefinition(renderProps.sessionObjectToLink)})]:null,React.createElement(HelpIcon,{style:{fontSize:"initial"}}," ",_weavejs.Weave.lang(renderProps.helpMessage)," ")))};for(var _iterator5=this.binLabelToBin.entries()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _ret=_loop();if(_ret==="continue")continue}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}return React.createElement(HBox,{padded:true,style:{flex:1}},React.createElement(VBox,{padded:true,style:{flex:1,justifyContent:"space-between"},className:"weave-container"},_weavejs.Weave.lang("Binning type:"),binUIs),React.createElement(VBox,{padded:true,className:"weave-container",style:{flex:1,padding:8,overflow:"auto"}},this.hasOverrideMinAndMax()?React.createElement(HBox,{padded:true,style:{alignItems:"center"}},React.createElement("span",{style:{whiteSpace:"nowrap"}}," ",_weavejs.Weave.lang("Override data range")),React.createElement(StatefulTextField,{type:"number",style:{flex:1},ref:this.linkOverride("overrideInputMin"),placeholder:"min"}),React.createElement(StatefulTextField,{type:"number",style:{flex:1},ref:this.linkOverride("overrideInputMax"),placeholder:"max"})):null,React.createElement(HBox,{style:{flex:1}},React.createElement(_BinNamesList2.default,{binningDefinition:selectedBinDefn}))))}},{key:"column",get:function get(){return this.getColumn(this.props)}}]);return BinningDefinitionSelector}(SmartComponent);BinningDefinitionSelector.defaultProps={showNoneOption:true,attributeName:undefined,attributes:undefined};

},{"react":"react","weaveapp/ui/BinNamesList":111,"weaveapp/ui/ColumnSelector":116,"weaveapp/ui/SelectableAttributeComponent":123,"weavejs":136}],22:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StatefulTextField=weavejs.ui.StatefulTextField;var Checkbox=weavejs.ui.Checkbox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var CKANDataSourceEditor=function(_DataSourceEditor){_inherits(CKANDataSourceEditor,_DataSourceEditor);function CKANDataSourceEditor(props){_classCallCheck(this,CKANDataSourceEditor);return _possibleConstructorReturn(this,(CKANDataSourceEditor.__proto__||Object.getPrototypeOf(CKANDataSourceEditor)).call(this,props))}_createClass(CKANDataSourceEditor,[{key:"editorFields",get:function get(){var ds=this.props.dataSource;var editorFields=[this.getLabelEditor(ds.label),[_weavejs.Weave.lang("Source URL *"),React.createElement(StatefulTextField,{selectOnFocus:true,style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.url})})],[_weavejs.Weave.lang("Items to show in hierarchy"),React.createElement(HBox,{className:"weave-padded-hbox"},React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.showPackages}),label:_weavejs.Weave.lang("Packages")}),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.showGroups}),label:_weavejs.Weave.lang("Groups")}),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.showTags}),label:_weavejs.Weave.lang("Tags")}))],[_weavejs.Weave.lang("API Version"),React.createElement(StatefulTextField,{style:{flex:1},ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.apiVersion}),type:"number",min:"1",max:"3",step:"1"})],[null,React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.useHttpPost}),label:_weavejs.Weave.lang("Use HTTP POST")})],[null,React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.useDataStore}),label:_weavejs.Weave.lang("Use Data Store if available")})]];return _get(CKANDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(CKANDataSourceEditor.prototype),"editorFields",this).concat(editorFields)}}]);return CKANDataSourceEditor}(_DataSourceEditor3.default);exports.default=CKANDataSourceEditor;

},{"react":"react","weaveapp/editor/DataSourceEditor":32,"weavejs":136}],23:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _CSVMetadataEditor=require("weaveapp/editor/CSVMetadataEditor");var _CSVMetadataEditor2=_interopRequireDefault(_CSVMetadataEditor);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _InteractiveTour=require("weaveapp/dialog/InteractiveTour");var _InteractiveTour2=_interopRequireDefault(_InteractiveTour);var _KeyTypeInput=require("weaveapp/ui/KeyTypeInput");var _KeyTypeInput2=_interopRequireDefault(_KeyTypeInput);var _FileSelector=require("weaveapp/ui/FileSelector");var _FileSelector2=_interopRequireDefault(_FileSelector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ComboBox=weavejs.ui.ComboBox;var HelpIcon=weavejs.ui.HelpIcon;var ColumnUtils=weavejs.data.ColumnUtils;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var PopupWindow=weavejs.ui.PopupWindow;var Button=weavejs.ui.Button;var CSVDataSourceEditor=function(_DataSourceEditor){_inherits(CSVDataSourceEditor,_DataSourceEditor);function CSVDataSourceEditor(props){_classCallCheck(this,CSVDataSourceEditor);var _this=_possibleConstructorReturn(this,(CSVDataSourceEditor.__proto__||Object.getPrototypeOf(CSVDataSourceEditor)).call(this,props));_this.handleMetadataUpdate=function(newMeta,selectedIds){var ds=_this.props.dataSource;var newState=ds.metadata.getSessionState()||{};selectedIds.forEach(function(id,index){var currentMeta=ds.generateMetadataForColumnId(id);newState[id]=_weavejs.WeaveAPI.SessionManager.combineDiff(currentMeta,newMeta);_.forEach(newState[id],function(value,key){if(!newState[id][key])delete newState[id][key]})});ds.metadata.setSessionState(newState)};_this.openMetadataEditor=PopupWindow.generateOpener(function(){return{context:_this,title:_weavejs.Weave.lang("Edit Column Metadata"),content:React.createElement(_CSVMetadataEditor2.default,{datasource:_this.props.dataSource,onChangeCallback:_this.handleMetadataUpdate}),resizable:true,width:920,footerContent:React.createElement("div",null),height:675,suspendEnter:true}});return _this}_createClass(CSVDataSourceEditor,[{key:"onUrlChange",value:function onUrlChange(){var ds=this.props.dataSource;if(ds.url.value){this.setState({guideToTab:"Browse"})}if(ds.keyType.value===null&&ds.url.value){ds.keyType.value=ds.url.value;this.forceUpdate()}}},{key:"handleProps",value:function handleProps(props){_get(CSVDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(CSVDataSourceEditor.prototype),"handleProps",this).call(this,props);var ds=props.dataSource;if(this.props.dataSource){var old_ds=this.props.dataSource;_weavejs.Weave.getCallbacks(old_ds.url).removeCallback(this,this.onUrlChange)}_weavejs.Weave.getCallbacks(ds.url).addGroupedCallback(this,this.onUrlChange)}},{key:"renderChildEditor",value:function renderChildEditor(){var ds=this.props.dataSource;var idProperty="";var columnNames=ds.getColumnNames();var columns=columnNames.map(function(name){return ds.getColumnByName(name)});if(_weavejs.WeaveAPI.Locale.reverseLayout){columns.reverse();columnNames.reverse()}var format=_.zipObject(columnNames,columns);format[idProperty]=IQualifiedKey;var keys=ColumnUtils.getAllKeys(columns);var records=ColumnUtils.getRecords(format,keys,String);var titles=columns.map(function(column){return _weavejs.Weave.lang(column.getMetadata("title"))});var columnTitles=_.zipObject(columnNames,titles);return React.createElement("div",{style:{flex:1,position:"relative"}},React.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"scroll"}}))}},{key:"editorFields",get:function get(){var ds=this.props.dataSource;var keysAreUnique=ds.keysAreUnique;var validExtension=void 0;var acceptExtension="text/csv,.csv";if(ds.url.value){var extension=ds.url.value.split(".").pop();validExtension=_.includes(acceptExtension.split(","),"."+extension)}else{validExtension=true}var columnIds=ds.getColumnIds().map(function(id,index){return{label:ds.getColumnTitle(id),value:id}});columnIds.unshift({label:_weavejs.Weave.lang("Auto-generated keys"),value:null});var editorFields=[[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Location"),React.createElement(HelpIcon,{className:validExtension?"":"fa-exclamation-triangle",style:{color:validExtension?null:"#794B02"}},React.createElement(VBox,null,validExtension?_weavejs.Weave.lang("The location of the CSV file for this data source"):_weavejs.Weave.lang("Warning: The file you have chosen has an extension that does not match the expected extension.")))),React.createElement(_FileSelector2.default,{targetUrl:ds.url,ref:_InteractiveTour2.default.getComponentRefCallback("Location"),onFileChange:function onFileChange(){return _InteractiveTour2.default.targetComponentOnClick("Location")},placeholder:_weavejs.Weave.lang("http://www.example.com/example.csv"),style:{width:"100%"},accept:acceptExtension})],this.getLabelEditor(ds.label),[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Key column"),React.createElement(HelpIcon,{className:keysAreUnique?"":"fa-exclamation-triangle",style:{color:keysAreUnique?null:"#A34341"}},React.createElement(VBox,null,keysAreUnique?_weavejs.Weave.lang("A Column that can uniquely identify each row in the data. If there are no such columns, choose \"Auto-generated keys\""):_weavejs.Weave.lang("Warning: You have chosen a key column that is not unique.")))),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.keyColumn}),options:columnIds,placeholder:_weavejs.Weave.lang("Auto-generated keys"),className:keysAreUnique?"":"error"})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Key namespace"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Key namespaces are used to link tables using matching key columns."))),React.createElement(_KeyTypeInput2.default,{keyTypeProperty:ds.keyType})],[_weavejs.Weave.lang("Edit Metadata"),React.createElement(Button,{onClick:this.openMetadataEditor},_weavejs.Weave.lang("Edit Column Metadata..."))]];return _get(CSVDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(CSVDataSourceEditor.prototype),"editorFields",this).concat(editorFields)}}]);return CSVDataSourceEditor}(_DataSourceEditor3.default);exports.default=CSVDataSourceEditor;

},{"lodash":"lodash","react":"react","weaveapp/dialog/InteractiveTour":16,"weaveapp/editor/CSVMetadataEditor":24,"weaveapp/editor/DataSourceEditor":32,"weaveapp/ui/FileSelector":119,"weaveapp/ui/KeyTypeInput":121,"weavejs":136}],24:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _MetadataGrid=require("weaveapp/editor/MetadataGrid");var _MetadataGrid2=_interopRequireDefault(_MetadataGrid);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var List=weavejs.ui.List;var VBox=weavejs.ui.flexbox.VBox;var HBox=weavejs.ui.flexbox.HBox;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var CSVMetadataEditor=function(_React$Component){_inherits(CSVMetadataEditor,_React$Component);function CSVMetadataEditor(props){_classCallCheck(this,CSVMetadataEditor);var _this=_possibleConstructorReturn(this,(CSVMetadataEditor.__proto__||Object.getPrototypeOf(CSVMetadataEditor)).call(this,props));_this.setSelectedColumnIds=function(columnIds){_this.setState({selected:columnIds})};_this.handleMetadataChange=function(entry){_this.props.onChangeCallback(entry,_this.getSelectedColumnIds());_this.forceUpdate()};_this.state={columnIds:props.datasource.getColumnIds()};_weavejs.Weave.getCallbacks(props.datasource).addGroupedCallback(_this,_this.forceUpdate);return _this}_createClass(CSVMetadataEditor,[{key:"getSelectedColumnIds",value:function getSelectedColumnIds(){var _this2=this;var selected=this.state.selected;var columnIds=this.state.columnIds;if(!selected){return columnIds&&[columnIds[0]]}return this.state.columnIds&&_.remove(this.state.columnIds.map(function(columnId,index){if(_.includes(selected,columnId)){return _this2.state.columnIds&&_this2.state.columnIds[index]}}),_.identity)}},{key:"render",value:function render(){var _this3=this;var listOptions=this.state.columnIds.map(function(columnId){return{label:_this3.props.datasource.getColumnById(columnId).getMetadata(ColumnMetadata.TITLE),value:columnId}});var columnIds=this.getSelectedColumnIds();var entries=columnIds&&columnIds.map(function(columnId,index){var column=_this3.props.datasource.getColumnById(columnId);var metadataProps=column.getMetadataPropertyNames();return _.zipObject(metadataProps,metadataProps.map(function(prop){return column.getMetadata(prop)}))});return React.createElement(HBox,{className:"ui bottom attached segments",style:{flex:1,border:"none"},onMouseEnter:function onMouseEnter(){return _this3.forceUpdate()}},React.createElement(VBox,{style:{width:250}},React.createElement(VBox,{className:"ui vertical attached segments",style:{flex:1,justifyContent:"space-between",border:"none",borderRadius:0}},React.createElement(VBox,{className:"ui basic segment",style:{flex:1,overflow:"auto",padding:0,border:"none",borderRadius:0}},React.createElement("div",{className:"ui medium header",style:{padding:0,paddingLeft:14,paddingTop:14}},_weavejs.Weave.lang("Columns")),React.createElement(VBox,{style:{alignItems:listOptions.length?null:"center"}},listOptions.length?React.createElement(List,{options:listOptions,multiple:true,selectedValues:this.state.selected||[this.state.columnIds[0]],onChange:function onChange(selectedValues){_this3.setSelectedColumnIds(selectedValues)}}):React.createElement("div",{className:"weave-list-item",style:{alignSelf:"flex-start",cursor:"default",pointerEvents:"none"}},_weavejs.Weave.lang("(None)")))))),React.createElement(_MetadataGrid2.default,{entries:entries,onChangeCallback:this.handleMetadataChange}))}}]);return CSVMetadataEditor}(React.Component);exports.default=CSVMetadataEditor;

},{"lodash":"lodash","react":"react","weaveapp/editor/MetadataGrid":38,"weavejs":136}],25:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Button=weavejs.ui.Button;var CachedDataSourceEditor=function(_DataSourceEditor){_inherits(CachedDataSourceEditor,_DataSourceEditor);function CachedDataSourceEditor(){_classCallCheck(this,CachedDataSourceEditor);return _possibleConstructorReturn(this,(CachedDataSourceEditor.__proto__||Object.getPrototypeOf(CachedDataSourceEditor)).apply(this,arguments))}_createClass(CachedDataSourceEditor,[{key:"editorFields",get:function get(){var ds=this.props.dataSource;return[[_weavejs.Weave.lang("This data source is using cached data."),React.createElement(Button,{onClick:function onClick(){return ds.hierarchyRefresh.triggerCallbacks()}},_weavejs.Weave.lang("Restore this data source"))]]}}]);return CachedDataSourceEditor}(_DataSourceEditor3.default);exports.default=CachedDataSourceEditor;CachedDataSourceEditor.WEAVE_INFO=_weavejs.Weave.setClassInfo(CachedDataSourceEditor,{id:"weavejs.editor.CachedDataSourceEditor",linkable:false});

},{"react":"react","weaveapp/editor/DataSourceEditor":32,"weavejs":136}],26:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _CensusGeographyFilter=require("weaveapp/editor/CensusGeographyFilter");var _KeyTypeInput=require("weaveapp/ui/KeyTypeInput");var _KeyTypeInput2=_interopRequireDefault(_KeyTypeInput);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Weave=weavejs.Weave;var StatefulTextField=weavejs.ui.StatefulTextField;var ComboBox=weavejs.ui.ComboBox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var HelpIcon=weavejs.ui.HelpIcon;var CensusDataSourceEditor=function(_DataSourceEditor){_inherits(CensusDataSourceEditor,_DataSourceEditor);function CensusDataSourceEditor(props){_classCallCheck(this,CensusDataSourceEditor);var _this=_possibleConstructorReturn(this,(CensusDataSourceEditor.__proto__||Object.getPrototypeOf(CensusDataSourceEditor)).call(this,props));_this.updateRequiresAndOptional=function(){var ds=_this.props.dataSource;_this.api.getGeographies(ds.dataSet.value).then(function(geographies){var geography=geographies[ds.geographicScope.value];if(geography){_this.setState({optional:geography.optionalWithWCFor,requires:geography.requires})}})};_this.state={};_this.dataFamilyChanged=function(selectedItem){_this.setState({dataFamily:selectedItem})};_this.dataVintageChanged=function(selectedItem){_this.setState({dataVintage:selectedItem})};var ds=_this.props.dataSource;_this.api=ds.getAPI();_this.api.getDatasets().then(function(result){_this.state={datasets:result.dataset}});ds.dataSet.addGroupedCallback(_this,_this.getGeographies,true);ds.geographicScope.addGroupedCallback(_this,_this.updateRequiresAndOptional,true);return _this}_createClass(CensusDataSourceEditor,[{key:"getDataFamilies",value:function getDataFamilies(){var raw_datasets=this.state.datasets;if(!raw_datasets)return["All"];var families_set=new Set(_.flatten(_.map(raw_datasets,function(d){return d.c_dataset})).filter(CensusDataSourceEditor.isUsableFamily));var families_list=_.sortBy(Array.from(families_set));families_list.unshift("All");return families_list}},{key:"getDataVintages",value:function getDataVintages(family){var raw_datasets=this.state.datasets;if(!raw_datasets||!family)return["All"];var datasetsInFamily=raw_datasets.filter(CensusDataSourceEditor.isInFamily.bind(null,family));var vintages_set=new Set(datasetsInFamily.map(function(d){return d.c_vintage!==undefined&&d.c_vintage.toString()}));var vintages_list=_.sortBy(Array.from(vintages_set));vintages_list.unshift("All");return vintages_list}},{key:"getDatasets",value:function getDatasets(family,vintage){var raw_datasets=this.state.datasets;var ds=this.props.dataSource;if(!raw_datasets||!family||!vintage)return[{value:ds.dataSet.value,label:ds.dataSet.value}];var filterFunc=function filterFunc(dataset){return CensusDataSourceEditor.isInFamily(family,dataset)&&CensusDataSourceEditor.isOfVintage(vintage,dataset)};var makeEntry=function makeEntry(dataset){return{value:dataset.identifier,label:dataset.title}};return _.sortBy(raw_datasets.filter(filterFunc).map(makeEntry),"label")}},{key:"getDataset",value:function getDataset(datasetName){var raw_datasets=this.state.datasets;if(!raw_datasets)return null;return raw_datasets.filter(function(dataset){return dataset.identifier===datasetName})}},{key:"getGeographies",value:function getGeographies(dataSet){var _this2=this;var ds=this.props.dataSource;this.api.getGeographies(ds.dataSet.value).then(function(geographies){var tempGeographies=new Array;for(var id in geographies){tempGeographies.push({value:id,label:geographies[id].name})}tempGeographies=_.sortBy(tempGeographies,"value");if(!_.isEqual(_this2.state.geographies,tempGeographies))_this2.setState({geographies:tempGeographies})})}},{key:"renderFields",value:function renderFields(){return React.createElement(VBox,null,_get(CensusDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(CensusDataSourceEditor.prototype),"renderFields",this).call(this),React.createElement(_CensusGeographyFilter.CensusGeographyFilter,{filterLinkableVariable:this.props.dataSource.geographicFilters,optional:this.state.optional,requires:this.state.requires||null}))}},{key:"editorFields",get:function get(){var ds=this.props.dataSource;this.api=ds.getAPI();var datasets=this.getDatasets("All","All");var dataset=_.first(this.getDataset(ds.dataSet.value));var datasetLabel=dataset?dataset.title:"";return[this.getLabelEditor(ds.label),[Weave.lang("API key"),React.createElement(StatefulTextField,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{content:ds.apiKey})})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},Weave.lang("Key namespace"),React.createElement(HelpIcon,null,Weave.lang("Key namespaces are used to link tables using matching key columns."))),React.createElement(_KeyTypeInput2.default,{style:{width:"100%"},keyTypeProperty:ds.keyType})],[Weave.lang("Dataset"),React.createElement(ComboBox,{className:"search",style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.dataSet}),selectFirstOnInvalid:true,options:datasets||[{value:dataset,label:datasetLabel}]})],[Weave.lang("Geographic scope"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.geographicScope}),selectFirstOnInvalid:true,options:this.state.geographies||[{value:ds.geographicScope.value,label:ds.geographicScope.value}]})]]}}],[{key:"isUsableFamily",value:function isUsableFamily(family){return family&&(family.indexOf("acs")==0||family.indexOf("sf")==0)}},{key:"isInFamily",value:function isInFamily(family,dataset){return family&&dataset&&(family=="All"||dataset.c_dataset.indexOf(family)!=-1)}},{key:"isOfVintage",value:function isOfVintage(vintage,dataset){return vintage&&dataset&&(vintage=="All"||dataset.c_vintage!==undefined&&dataset.c_vintage.toString()==vintage)}}]);return CensusDataSourceEditor}(_DataSourceEditor3.default);exports.default=CensusDataSourceEditor;

},{"lodash":"lodash","react":"react","weaveapp/editor/CensusGeographyFilter":27,"weaveapp/editor/DataSourceEditor":32,"weaveapp/ui/KeyTypeInput":121,"weavejs":136}],27:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CensusGeographyFilterColumn=exports.CensusGeographyFilter=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var CensusApi=weavejs.data.source.CensusApi;var CensusGeographyFilter=exports.CensusGeographyFilter=function(_React$Component){_inherits(CensusGeographyFilter,_React$Component);function CensusGeographyFilter(props){_classCallCheck(this,CensusGeographyFilter);var _this=_possibleConstructorReturn(this,(CensusGeographyFilter.__proto__||Object.getPrototypeOf(CensusGeographyFilter)).call(this,props));_this.onFilterChange=function(geoLevel,value){var oldFilters=_this.props.filterLinkableVariable.state;var newFilters={};if(oldFilters){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_this.props.requires[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _level=_step.value;newFilters[_level]=oldFilters[_level];if(!newFilters[_level])delete newFilters[_level]}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}newFilters[geoLevel]=value;if(!value)delete newFilters[geoLevel];_this.props.filterLinkableVariable.state=newFilters};_this.renderFilter=function(scope){var filters=_this.props.filterLinkableVariable.state||{};var parentGeoKey=void 0;if(scope=="county")parentGeoKey="state";var options=[];if(scope=="state"){options=_.sortBy(Object.keys(_this.state_fips),function(key){return _this.state_fips[key]}).map(function(key){return{fips:key,name:_this.state_fips[key]}})}else if(scope="county"){var county_fips=_this.county_fips[filters[parentGeoKey]]||{};options=_.sortBy(Object.keys(county_fips),function(key){return county_fips[key]}).map(function(key){return{fips:key,name:county_fips[key]}})}return React.createElement(CensusGeographyFilterColumn,{key:scope,geoLevel:scope,options:options,required:_this.props.optional!==undefined?scope!=_this.props.optional:true,parentGeo:parentGeoKey&&filters[parentGeoKey],selection:(typeof filters==="undefined"?"undefined":_typeof(filters))==_typeof({})?filters[scope]:null,onChange:_this.onFilterChange})};_this.state_fips=CensusApi.state_fips;_this.county_fips=CensusApi.county_fips;_this.props.filterLinkableVariable.addGroupedCallback(_this,_this.forceUpdate,true);return _this}_createClass(CensusGeographyFilter,[{key:"render",value:function render(){this.props.filterLinkableVariable.addGroupedCallback(this,this.forceUpdate);return React.createElement(HBox,null,this.props.requires?this.props.requires.map(this.renderFilter):"")}}]);return CensusGeographyFilter}(React.Component);var CensusGeographyFilterColumn=exports.CensusGeographyFilterColumn=function(_React$Component2){_inherits(CensusGeographyFilterColumn,_React$Component2);function CensusGeographyFilterColumn(props){_classCallCheck(this,CensusGeographyFilterColumn);var _this2=_possibleConstructorReturn(this,(CensusGeographyFilterColumn.__proto__||Object.getPrototypeOf(CensusGeographyFilterColumn)).call(this,props));_this2.state={selection:null};_this2.updateEnabled=function(event){var element=event.target;_this2.setState({enabled:element.checked})};_this2.updateSelection=function(event){var element=event.target;_this2.setState({selection:element.value})};_this2.state={enabled:props.required||!!props.selection,selection:props.selection};return _this2}_createClass(CensusGeographyFilterColumn,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(!nextProps)return;if(nextProps.required){this.setState({enabled:true})}if(nextProps.selection){this.setState({selection:nextProps.selection,enabled:true})}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){this.props.onChange(this.props.geoLevel,this.state.enabled?this.state.selection:null)}},{key:"render",value:function render(){var check=React.createElement("label",null,React.createElement("input",{type:"checkbox",onChange:this.updateEnabled,onInput:this.updateEnabled,disabled:this.props.required,checked:this.props.required||this.state.enabled}),this.props.geoLevel);var inputDisabled=!this.state.enabled&&!this.props.required;var selection=this.props.selection||this.state.enabled&&this.state.selection||null;if(this.props.geoLevel=="state"||this.props.geoLevel=="county"){return React.createElement(VBox,{style:{flex:1}},check,React.createElement("select",{size:5,disabled:inputDisabled,onClick:this.updateSelection,onChange:this.updateSelection,onInput:this.updateSelection,value:selection},this.props.options.map(function(option){return React.createElement("option",{disabled:inputDisabled,key:option.fips,value:option.fips},option.name)})))}else{return React.createElement(VBox,{style:{flex:1}},check,React.createElement("input",{onChange:this.updateSelection,onInput:this.updateSelection,disabled:inputDisabled,type:"text",value:selection}))}}}]);return CensusGeographyFilterColumn}(React.Component);

},{"lodash":"lodash","react":"react","weavejs":136}],28:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _ColorRampEditor=require("weaveapp/editor/ColorRampEditor");var _ColorRampEditor2=_interopRequireDefault(_ColorRampEditor);var _SelectableAttributeComponent=require("weaveapp/ui/SelectableAttributeComponent");var _SelectableAttributeComponent2=_interopRequireDefault(_SelectableAttributeComponent);var _BinningDefinitionEditor=require("weaveapp/editor/BinningDefinitionEditor");var _BinningDefinitionEditor2=_interopRequireDefault(_BinningDefinitionEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Tabs=weavejs.ui.Tabs;var Checkbox=weavejs.ui.Checkbox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ColorController=function(_React$Component){_inherits(ColorController,_React$Component);function ColorController(props){_classCallCheck(this,ColorController);var _this=_possibleConstructorReturn(this,(ColorController.__proto__||Object.getPrototypeOf(ColorController)).call(this,props));_this.tabLabels=["Color theme","Binning"];_this.attributes=new Map;_this.handleFilterCheck=function(value){if(value)_this.dataColumn.filter.targetPath=["defaultSubsetKeyFilter"];else _this.dataColumn.filter.targetPath=null};_this.attributes.set("Color data",_this.props.colorColumn);return _this}_createClass(ColorController,[{key:"render",value:function render(){return React.createElement(VBox,{overflow:true,style:{flex:1}},React.createElement(Tabs,{initialActiveTabIndex:0,labels:this.tabLabels,tabs:[React.createElement(VBox,{key:this.tabLabels[1],style:{flex:1,padding:8},className:"weave-padded-vbox"},React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.colorColumn.rampCenterAtZero}),label:_weavejs.Weave.lang("Center color ramp at zero (when binning is disabled)")}),React.createElement(_ColorRampEditor2.default,{colorRamp:this.props.colorColumn.ramp})),React.createElement(VBox,{overflow:true,className:"weave-padded-vbox",key:this.tabLabels[0],style:{flex:1,padding:8}},React.createElement(HBox,{overflow:true,className:"weave-padded-hbox",style:{alignItems:"center"}},_weavejs.Weave.lang("Color data"),React.createElement(_SelectableAttributeComponent2.default,{attributes:this.attributes,attributeName:"Color data"})),React.createElement(_BinningDefinitionEditor2.default,{binnedColumn:this.binnedColumn}),React.createElement(Checkbox,{onChange:this.handleFilterCheck,label:_weavejs.Weave.lang("Filter records prior to binning")}))]}))}},{key:"binnedColumn",get:function get(){return this.props.colorColumn&&this.props.colorColumn.getInternalColumn()}},{key:"dataColumn",get:function get(){return this.binnedColumn&&this.binnedColumn.internalDynamicColumn.target}}]);return ColorController}(React.Component);exports.default=ColorController;

},{"react":"react","weaveapp/editor/BinningDefinitionEditor":21,"weaveapp/editor/ColorRampEditor":29,"weaveapp/ui/SelectableAttributeComponent":123,"weavejs":136}],29:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _ColorRampComponent=require("weaveapp/ui/ColorRampComponent");var _ColorRampComponent2=_interopRequireDefault(_ColorRampComponent);var _ColorRampList=require("weaveapp/ui/ColorRampList");var _ColorRampList2=_interopRequireDefault(_ColorRampList);var _ColorPicker=require("weaveapp/ui/ColorPicker");var _ColorPicker2=_interopRequireDefault(_ColorPicker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Label=weavejs.ui.flexbox.Label;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ColorRamp=weavejs.util.ColorRamp;var StandardLib=weavejs.util.StandardLib;var SmartComponent=weavejs.ui.SmartComponent;var Button=weavejs.ui.Button;var ComboBox=weavejs.ui.ComboBox;var CenteredIcon=weavejs.ui.CenteredIcon;var List=weavejs.ui.List;var ALL="All";var ColorRampEditor=function(_React$Component){_inherits(ColorRampEditor,_React$Component);function ColorRampEditor(props){_classCallCheck(this,ColorRampEditor);var _this=_possibleConstructorReturn(this,(ColorRampEditor.__proto__||Object.getPrototypeOf(ColorRampEditor)).call(this,props));_this.colorRampWatcher=WeaveReactUtils.forceUpdateWatcher(_this,ColorRamp);_this.onButtonClick=function(event){if(_this.props.pushCrumb){_this.props.pushCrumb("Color Ramp",_this.renderColorRampSelectorForEditor,null)}else if(_this.props.onButtonClick){_this.props.onButtonClick(event)}};_this.renderColorRampSelectorForEditor=function(){return React.createElement(ColorRampSelector,{colorRamp:_this.props.colorRamp,pushCrumb:_this.props.pushCrumb})};_this.colorRamp=props.colorRamp;return _this}_createClass(ColorRampEditor,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.colorRamp!==nextProps.colorRamp){this.colorRamp=nextProps.colorRamp}}},{key:"renderCompactView",value:function renderCompactView(){return React.createElement(HBox,{className:"weave-padded-hbox"},React.createElement(_ColorRampComponent2.default,{style:{flex:1,border:"none"},ramp:this.colorRamp&&this.colorRamp.getHexColors(),direction:"right"}),React.createElement(Button,{onClick:this.onButtonClick,title:"Click to change the color ramp",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0}},React.createElement("i",{className:"fa fa-angle-right","aria-hidden":"true",style:{fontWeight:"bold"}})))}},{key:"renderFullView",value:function renderFullView(){return React.createElement(ColorRampSelector,{colorRamp:this.colorRamp})}},{key:"render",value:function render(){return this.props.compact?this.renderCompactView():this.renderFullView()}},{key:"colorRamp",get:function get(){return this.colorRampWatcher.target},set:function set(value){this.colorRampWatcher.target=value}}]);return ColorRampEditor}(React.Component);exports.default=ColorRampEditor;var ColorRampSelector=function(_SmartComponent){_inherits(ColorRampSelector,_SmartComponent);function ColorRampSelector(props){_classCallCheck(this,ColorRampSelector);var _this2=_possibleConstructorReturn(this,(ColorRampSelector.__proto__||Object.getPrototypeOf(ColorRampSelector)).call(this,props));_this2.reverseColors=function(){if(_this2.props.colorRamp)_this2.props.colorRamp.reverse()};_this2.addColor=function(color,eventType){var colors=_this2.props.colorRamp.getColors();if(eventType=="onClick"){colors.push(StandardLib.asNumber(color))}else if(eventType=="onChange"){colors[colors.length-1]=StandardLib.asNumber(color)}_this2.props.colorRamp.setSessionState(colors)};_this2.handleColorRampSelectionChange=function(newColors){if(_this2.props.colorRamp)_this2.props.colorRamp.setSessionState(newColors)};_this2.onCustomizeButtonClick=function(event){if(_this2.props.pushCrumb){_this2.props.pushCrumb("Customize",_this2.renderColorRampCustomizerForEditor,null)}};_this2.renderColorRampCustomizerForEditor=function(){return React.createElement(ColorRampCustomizer,{style:{border:"1px solid lightgrey"},colorRamp:_this2.props.colorRamp,pushCrumb:_this2.props.pushCrumb})};if(_this2.props.colorRamp)_this2.props.colorRamp.addGroupedCallback(_this2,_this2.forceUpdate);_this2.state={selectedFilter:ALL};_this2.filterOptions=[];var tagsLookup={};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=ColorRamp.allColorRamps[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var ramp=_step.value;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=ramp.tags.split(",")[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var tag=_step2.value;if(!tagsLookup[tag])_this2.filterOptions.push(tagsLookup[tag]=tag)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_this2.filterOptions.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())});_this2.filterOptions.unshift(ALL);return _this2}_createClass(ColorRampSelector,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.colorRamp!==nextProps.colorRamp){if(this.props.colorRamp)this.props.colorRamp.removeCallback(this,this.forceUpdate);if(nextProps.colorRamp)nextProps.colorRamp.addGroupedCallback(this,this.forceUpdate)}}},{key:"render",value:function render(){var _this3=this;var colors=this.props.colorRamp?this.props.colorRamp.getColors():[];var hexColors=this.props.colorRamp?this.props.colorRamp.getHexColors():[];var filteredRamps=this.state.selectedFilter==ALL?ColorRamp.allColorRamps:ColorRamp.allColorRamps.filter(function(v){return v.tags.indexOf(_this3.state.selectedFilter)>=0});if(this.props.pushCrumb){return React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1},disabled:!this.props.colorRamp},React.createElement(VBox,{className:"weave-padded-vbox"},React.createElement(HBox,{style:{overflow:"auto"},className:"weave-padded-hbox"},React.createElement(_ColorRampComponent2.default,{style:{flex:1,border:"none"},direction:"right",ramp:hexColors}),React.createElement(Button,{onClick:this.reverseColors,title:"Click to reverse colors",style:{borderRadius:0,borderLeft:"none"}},"\u2193\u2191"),React.createElement(Button,{onClick:this.onCustomizeButtonClick,title:"Click to customize colors",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none"}},React.createElement("i",{className:"fa fa-angle-right","aria-hidden":"true",style:{fontWeight:"bold"}})))),React.createElement(_ColorRampList2.default,{selectedColors:colors,allColorRamps:filteredRamps,onChange:this.handleColorRampSelectionChange}),React.createElement(HBox,{overflow:true,padded:true,style:{alignItems:"center"},className:"weave-padded-hbox"},_weavejs.Weave.lang("Filter:"),React.createElement(ComboBox,{fluid:false,value:this.state.selectedFilter,options:this.filterOptions,onChange:function onChange(value){return _this3.setState({selectedFilter:value})},direction:"upward"})))}else{return React.createElement(VBox,{padded:true,overflow:true,style:{flex:1},disabled:!this.props.colorRamp},React.createElement(HBox,{padded:true,style:{flex:1}},React.createElement(HBox,{style:{flex:.7}},React.createElement(_ColorRampList2.default,{selectedColors:colors,allColorRamps:filteredRamps,onChange:this.handleColorRampSelectionChange})),React.createElement(VBox,{padded:true,style:{flex:.3,padding:"4px",border:"1px solid lightgrey"}},React.createElement("label",{style:{marginTop:5,fontWeight:"bold"}},_weavejs.Weave.lang("Customize")),React.createElement(ColorRampCustomizer,{colorRamp:this.props.colorRamp}))),React.createElement(HBox,{padded:true,overflow:true},React.createElement(HBox,{padded:true,overflow:true,style:{flex:.7,alignItems:"center"}},_weavejs.Weave.lang("Filter:"),React.createElement(ComboBox,{fluid:false,value:this.state.selectedFilter,options:this.filterOptions,onChange:function onChange(value){return _this3.setState({selectedFilter:value})},direction:"upward"})),React.createElement(HBox,{overflow:true,style:{flex:.3,justifyContent:"space-between"}},React.createElement(CenteredIcon,{onClick:this.reverseColors},"\u2193\u2191"),React.createElement(_ColorPicker2.default,{buttonMode:true,direction:_ColorPicker2.default.TOP_LEFT,buttonLabel:"Add color",onChange:function onChange(newColor){return _this3.addColor(newColor,"onChange")},onClick:function onClick(newColor){return _this3.addColor(newColor,"onClick")}}))))}}}]);return ColorRampSelector}(SmartComponent);var ColorRampCustomizer=function(_SmartComponent2){_inherits(ColorRampCustomizer,_SmartComponent2);function ColorRampCustomizer(props){_classCallCheck(this,ColorRampCustomizer);var _this4=_possibleConstructorReturn(this,(ColorRampCustomizer.__proto__||Object.getPrototypeOf(ColorRampCustomizer)).call(this,props));_this4.addColor=function(color,eventType){var colors=_this4.props.colorRamp.getColors();if(eventType=="onClick"){colors.push(StandardLib.asNumber(color))}else if(eventType=="onChange"){colors[colors.length-1]=StandardLib.asNumber(color)}_this4.props.colorRamp.setSessionState(colors)};_this4.handleColorRampSelectionChange=function(newColors){if(_this4.props.colorRamp)_this4.props.colorRamp.setSessionState(newColors)};if(_this4.props.colorRamp)_this4.props.colorRamp.addGroupedCallback(_this4,_this4.forceUpdate);return _this4}_createClass(ColorRampCustomizer,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.colorRamp!==nextProps.colorRamp){if(this.props.colorRamp)this.props.colorRamp.removeCallback(this,this.forceUpdate);if(nextProps.colorRamp)nextProps.colorRamp.addGroupedCallback(this,this.forceUpdate)}}},{key:"updateColorsAtIndex",value:function updateColorsAtIndex(index,color){if(this.props.colorRamp){var colors=this.props.colorRamp.getColors();if(index!=null){colors[index]=StandardLib.asNumber(color)}else{colors.push(StandardLib.asNumber(color))}this.props.colorRamp.setSessionState(colors)}}},{key:"removeColorAtIndex",value:function removeColorAtIndex(index){if(this.props.colorRamp){var colors=this.props.colorRamp.getColors();colors.splice(index,1);this.props.colorRamp.setSessionState(colors)}}},{key:"render",value:function render(){var _this5=this;var colors=this.props.colorRamp?this.props.colorRamp.getColors():[];var hexColors=this.props.colorRamp?this.props.colorRamp.getHexColors():[];var listOptions=hexColors.map(function(hexColor,index){return{value:index,label:React.createElement(HBox,{padded:true,style:{flex:1,justifyContent:"space-between",alignItems:"center",overflow:"hidden"}},React.createElement(_ColorPicker2.default,{hexColor:hexColor,onChange:function onChange(newColor){return _this5.updateColorsAtIndex(index,newColor)}}),React.createElement(Label,{style:{flex:1,fontFamily:"monospace"},children:hexColor.toUpperCase()}),React.createElement(CenteredIcon,{iconProps:{className:"fa fa-times fa-fw"},onClick:function onClick(){return _this5.removeColorAtIndex(index)}}))}});var styleObj=_.merge({},this.props.style,{overflow:"auto",padding:"4px",flex:1});if(this.props.pushCrumb){return React.createElement(VBox,{padded:true},React.createElement("div",{style:{alignSelf:"flex-end"}},React.createElement(HBox,null,React.createElement(_ColorPicker2.default,{buttonMode:true,buttonLabel:"Add color",direction:_ColorPicker2.default.BOTTOM_LEFT,onChange:function onChange(newColor){return _this5.addColor(newColor,"onChange")},onClick:function onClick(newColor){return _this5.addColor(newColor,"onClick")}}))),React.createElement(HBox,{padded:true,style:styleObj},React.createElement(_ColorRampComponent2.default,{style:{width:30},direction:"bottom",ramp:hexColors}),React.createElement(List,{style:{flex:1},options:listOptions})))}else{return React.createElement(HBox,{padded:true,style:styleObj},React.createElement(_ColorRampComponent2.default,{style:{width:30},direction:"bottom",ramp:hexColors}),React.createElement(List,{style:{flex:1},options:listOptions}))}}}]);return ColorRampCustomizer}(SmartComponent);

},{"lodash":"lodash","react":"react","weaveapp/ui/ColorPicker":113,"weaveapp/ui/ColorRampComponent":114,"weaveapp/ui/ColorRampList":115,"weavejs":136}],30:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Dictionary2D=weavejs.util.Dictionary2D;var PopupWindow=weavejs.ui.PopupWindow;var ControlPanel=function(_PopupWindow){_inherits(ControlPanel,_PopupWindow);function ControlPanel(){_classCallCheck(this,ControlPanel);return _possibleConstructorReturn(this,(ControlPanel.__proto__||Object.getPrototypeOf(ControlPanel)).apply(this,arguments))}_createClass(ControlPanel,null,[{key:"openInstance",value:function openInstance(weave,ComponentType){var popupProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var componentProps=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var popup=ControlPanel.d2d_weave_class_popup.get(weave,ComponentType);if(popup)popup.close();popup=PopupWindow.open(_.merge({title:_weavejs.WeaveAPI.ClassRegistry.getDisplayName(ComponentType),width:900,height:600},popupProps,{modal:false,content:React.createElement(ComponentType,componentProps),onClose:function onClose(){return ControlPanel.d2d_weave_class_popup.remove(weave,ComponentType)}}));ControlPanel.d2d_weave_class_popup.set(weave,ComponentType,popup);return popup}}]);return ControlPanel}(PopupWindow);exports.default=ControlPanel;ControlPanel.d2d_weave_class_popup=new Dictionary2D(true,true);

},{"lodash":"lodash","react":"react","weavejs":136}],31:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _KeyTypeInput=require("weaveapp/ui/KeyTypeInput");var _KeyTypeInput2=_interopRequireDefault(_KeyTypeInput);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _FileSelector=require("weaveapp/ui/FileSelector");var _FileSelector2=_interopRequireDefault(_FileSelector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ComboBox=weavejs.ui.ComboBox;var HelpIcon=weavejs.ui.HelpIcon;var DBFDataSourceEditor=function(_DataSourceEditor){_inherits(DBFDataSourceEditor,_DataSourceEditor);function DBFDataSourceEditor(){_classCallCheck(this,DBFDataSourceEditor);return _possibleConstructorReturn(this,(DBFDataSourceEditor.__proto__||Object.getPrototypeOf(DBFDataSourceEditor)).apply(this,arguments))}_createClass(DBFDataSourceEditor,[{key:"editorFields",get:function get(){var dataSource=this.props.dataSource;var dbfValidExtension=void 0;var shpValidExtension=void 0;var dbfAcceptExtension=".dbf,application/dbf";var shpAcceptExtension=".shp,application/octec-stream";if(dataSource.dbfUrl.value){var extension=dataSource.dbfUrl.value.split(".").pop();dbfValidExtension=_.includes(dbfAcceptExtension.split(","),"."+extension)}else{dbfValidExtension=true}if(dataSource.shpUrl.value){var _extension=dataSource.shpUrl.value.split(".").pop();shpValidExtension=_.includes(shpAcceptExtension.split(","),"."+_extension)}else{shpValidExtension=true}var editorFields=[this.getLabelEditor(dataSource.label),[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("DBF URL"),React.createElement(HelpIcon,{className:dbfValidExtension?"":"fa-exclamation-triangle",style:{color:dbfValidExtension?null:"#794B02"}},React.createElement(VBox,null,dbfValidExtension?_weavejs.Weave.lang("The URL of the dbf file to be used"):_weavejs.Weave.lang("Warning: The file you have chosen has an extension that does not match the expected extension.")))),React.createElement(_FileSelector2.default,{style:{width:"100%"},targetUrl:dataSource.dbfUrl,placeholder:_weavejs.Weave.lang("http://www.example.com/example.dbf"),accept:dbfAcceptExtension})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("SHP URL"),React.createElement(HelpIcon,{className:shpValidExtension?"":"fa-exclamation-triangle",style:{color:shpValidExtension?null:"#794B02"}},React.createElement(VBox,null,shpValidExtension?_weavejs.Weave.lang("The URL of the shp file to be used"):_weavejs.Weave.lang("Warning: The file you have chosen has an extension that does not match the expected extension.")))),React.createElement(_FileSelector2.default,{style:{width:"100%"},targetUrl:dataSource.shpUrl,placeholder:_weavejs.Weave.lang("http://www.example.com/example.shp"),accept:shpAcceptExtension})],[_weavejs.Weave.lang("Projection"),React.createElement(StatefulTextField,{style:{width:"100%"},selectOnFocus:true,placeholder:_weavejs.Weave.lang("Example: EPSG:4326"),ref:WeaveReactUtils.linkReactStateRef(this,{value:dataSource.projection})})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Key column"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("A Column that can uniquely identify each row in the data. If there are no such columns, choose \"Auto-generated keys\""))),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:dataSource.keyColName}),placeholder:_weavejs.Weave.lang("Auto-generated keys"),options:dataSource.getColumnNames()})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Key namespace"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Key namespaces are used to link tables using matching key columns."))),React.createElement(_KeyTypeInput2.default,{style:{width:"100%"},keyTypeProperty:dataSource.keyType})]];return _get(DBFDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(DBFDataSourceEditor.prototype),"editorFields",this).concat(editorFields)}}]);return DBFDataSourceEditor}(_DataSourceEditor3.default);exports.default=DBFDataSourceEditor;

},{"lodash":"lodash","react":"react","weaveapp/editor/DataSourceEditor":32,"weaveapp/ui/FileSelector":119,"weaveapp/ui/KeyTypeInput":121,"weavejs":136}],32:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BROWSE=exports.METADATA=exports.PREVIEW=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _InteractiveTour=require("weaveapp/dialog/InteractiveTour");var _InteractiveTour2=_interopRequireDefault(_InteractiveTour);var _TableTool=require("weaveapp/tool/TableTool");var _TableTool2=_interopRequireDefault(_TableTool);var _WeaveDataTree=require("weaveapp/ui/WeaveDataTree");var _WeaveDataTree2=_interopRequireDefault(_WeaveDataTree);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Section=weavejs.ui.flexbox.Section;var ReactUtils=weavejs.util.ReactUtils;var SmartComponent=weavejs.ui.SmartComponent;var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HelpIcon=weavejs.ui.HelpIcon;var IDataSource=weavejs.api.data.IDataSource;var IColumnReference=weavejs.api.data.IColumnReference;var ColumnUtils=weavejs.data.ColumnUtils;var StreamedGeometryColumn=weavejs.data.column.StreamedGeometryColumn;var PREVIEW=exports.PREVIEW="preview";var METADATA=exports.METADATA="metadata";var BROWSE=exports.BROWSE="browse";;;var DataSourceEditor=function(_SmartComponent){_inherits(DataSourceEditor,_SmartComponent);function DataSourceEditor(props){_classCallCheck(this,DataSourceEditor);var _this=_possibleConstructorReturn(this,(DataSourceEditor.__proto__||Object.getPrototypeOf(DataSourceEditor)).call(this,props));_this.dataSourceWatcher=WeaveReactUtils.forceUpdateWatcher(_this,IDataSource);_this.getColumns=function(){var columnSiblings=_this.state.selectedBranch&&_this.state.selectedBranch.getChildren()||[];var leaves=columnSiblings.filter(function(n){return!n.isBranch()});if(!leaves)return[];var columns=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=leaves[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var leaf=_step.value;var columnRef=_weavejs.Weave.AS(leaf,IColumnReference);if(columnRef){columns.push(columnRef);var meta=columnRef.getColumnMetadata();if(meta){var column=_weavejs.WeaveAPI.AttributeColumnCache.getColumn(columnRef.getDataSource(),meta);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=_weavejs.Weave.getDescendants(column,StreamedGeometryColumn)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var sgc=_step2.value;sgc.requestAllMetadata()}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return columns};_this.renderTablePreview=function(columnRefs){var refFunction=function refFunction(c){if(!c)return;_weavejs.Weave.disposableChild(_this.weaveRoot,c);c.sortFieldIndex.value=-1;ColumnUtils.replaceColumnsInHashMap(c.columns,columnRefs);c.handleShowKeyColumn(true)};return React.createElement(_TableTool2.default,{ref:refFunction})};_this.handleProps(props);_this.setState({showPreviewView:false});return _this}_createClass(DataSourceEditor,[{key:"handleProps",value:function handleProps(props){if(this.dataSourceWatcher.target!=props.dataSource){this.dataSourceWatcher.target=props.dataSource;this.setSelection(props,null,null)}else{this.setSelection(props,this.state.selectedBranch,this.state.selectedLeaf)}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){this.handleProps(props)}},{key:"componentWillUnmount",value:function componentWillUnmount(){ColumnUtils.map_root_firstDataSet.delete(this.weaveRoot)}},{key:"getLabelEditor",value:function getLabelEditor(labelLinkableString){return[React.createElement(HBox,{padded:true,style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Label"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("A label used to identify this data source"))),React.createElement(StatefulTextField,{placeholder:this.props.dataSource.getLabel(),style:{width:"100%",userSelect:false},ref:WeaveReactUtils.linkReactStateRef(this,{value:labelLinkableString},500)})]}},{key:"renderFields",value:function renderFields(){var dataSource=this.props.dataSource;var tableStyles={table:{width:"100%",fontSize:"inherit"},td:[{paddingBottom:8,textAlign:"right",whiteSpace:"nowrap"},{paddingBottom:8,paddingLeft:8,width:"100%"}]};return ReactUtils.generateTable({body:this.editorFields,styles:tableStyles})}},{key:"renderPreviewView",value:function renderPreviewView(){var _this2=this;var root=this.props.dataSource.getHierarchyRoot();var columns=this.getColumns();return React.createElement(Section,{style:{flex:1}},React.createElement("div",{"aria-label":_weavejs.Weave.lang("Preview of {0}",this.props.dataSource.getLabel())},_weavejs.Weave.lang("Preview")),React.createElement(HBox,{padded:root&&root.hasChildBranches(),style:{flex:1,border:"none"}},React.createElement(VBox,{style:{flex:root&&root.hasChildBranches()?1:0,overflow:"auto"}},React.createElement(_WeaveDataTree2.default,{root:root,hideLeaves:true,filterFunc:DataSourceEditor.isNotGeometryList,initialSelectedItems:this.state.selectedBranch?[this.state.selectedBranch]:[],onSelect:function onSelect(selectedItems){return _this2.setSelection(_this2.props,selectedItems&&selectedItems[0],_this2.state.selectedLeaf)}})),React.createElement(VBox,{padded:true,style:{flex:1,overflow:"auto"},ref:_InteractiveTour2.default.getComponentRefCallback("Preview")},this.renderTablePreview(columns))))}},{key:"renderConfigureView",value:function renderConfigureView(){var registry=_weavejs.WeaveAPI.ClassRegistry;var displayName=_weavejs.Weave.lang(_weavejs.WeaveAPI.ClassRegistry.getDisplayName(this.props.dataSource.constructor));return React.createElement(Section,{overflow:true},React.createElement("div",{"aria-label":_weavejs.Weave.lang("Configure {0}:{1}",displayName,_weavejs.Weave.lang(this.props.dataSource.getLabel()))},_weavejs.Weave.lang("Configure {0}",displayName)),this.renderFields())}},{key:"setSelection",value:function setSelection(props,newBranch,newLeaf){var root=props.dataSource.getHierarchyRoot();var hasChildren=false;if(newBranch){var children=newBranch.getChildren();hasChildren=children&&children.length>0}var branch=hasChildren?newBranch:root;var leaf=newLeaf;var weaveRoot=_weavejs.Weave.getRoot(props.dataSource);if(weaveRoot!=this.weaveRoot){ColumnUtils.map_root_firstDataSet.delete(this.weaveRoot);this.weaveRoot=weaveRoot}var leaves=branch&&branch.getChildren()||[];leaves=leaves.filter(function(leaf){var ref=_weavejs.Weave.AS(leaf,IColumnReference);return!!(ref&&ref.getColumnMetadata())});if(leaves.length)ColumnUtils.map_root_firstDataSet.set(weaveRoot,leaves);else ColumnUtils.map_root_firstDataSet.delete(weaveRoot);if(leaves.indexOf(leaf)<0)leaf=leaves[0];this.setState({selectedBranch:branch,selectedLeaf:leaf})}},{key:"render",value:function render(){return React.createElement(VBox,{style:{flex:1}},this.renderConfigureView(),this.renderPreviewView())}},{key:"editorFields",get:function get(){return[]}}],[{key:"nodeEqualityFunc",value:function nodeEqualityFunc(a,b){if(a&&b)return a.equals(b);else return a===b}},{key:"isNotGeometryList",value:function isNotGeometryList(node){return!_weavejs.Weave.IS(node,_weavejs.Weave.getDefinition("weavejs.data.source.GeomListNode"))}}]);return DataSourceEditor}(SmartComponent);exports.default=DataSourceEditor;

},{"react":"react","weaveapp/dialog/InteractiveTour":16,"weaveapp/tool/TableTool":77,"weaveapp/ui/WeaveDataTree":124,"weavejs":136}],33:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractFilterEditor2=require("weaveapp/editor/AbstractFilterEditor");var _AbstractFilterEditor3=_interopRequireDefault(_AbstractFilterEditor2);var _MenuLayoutComponent=require("weaveapp/ui/MenuLayoutComponent");var _MenuLayoutComponent2=_interopRequireDefault(_MenuLayoutComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LinkableString=weavejs.core.LinkableString;var LinkableVariable=weavejs.core.LinkableVariable;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var DataTypes=weavejs.api.data.DataTypes;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var ColumnUtils=weavejs.data.ColumnUtils;var DiscreteValuesDataFilterEditor=function(_AbstractFilterEditor){_inherits(DiscreteValuesDataFilterEditor,_AbstractFilterEditor);function DiscreteValuesDataFilterEditor(props){_classCallCheck(this,DiscreteValuesDataFilterEditor);var _this=_possibleConstructorReturn(this,(DiscreteValuesDataFilterEditor.__proto__||Object.getPrototypeOf(DiscreteValuesDataFilterEditor)).call(this,props));_this.layoutMode=_weavejs.Weave.linkableChild(_this,new LinkableString(_MenuLayoutComponent.LAYOUT_LIST,_this.verifyLayoutMode));_this.values=_weavejs.Weave.linkableChild(_this,LinkableVariable);_this.options=[];return _this}_createClass(DiscreteValuesDataFilterEditor,[{key:"verifyLayoutMode",value:function verifyLayoutMode(value){return DiscreteValuesDataFilterEditor.OPTIONS.indexOf(value)>=0}},{key:"getChoices",value:function getChoices(){var dataType=DataTypes.getClass(this.column.getMetadata(ColumnMetadata.DATA_TYPE));this.options=ColumnUtils.getRecords({value:this.column,label:this.column},this.column.keys,{value:dataType,label:String});return _.sortByOrder(_.uniq(this.options,"value"),["value"],["asc"])}},{key:"render",value:function render(){if(_weavejs.Weave.detectChange(this,this.column)){this.options=this.getChoices()}var values=this.filter?this.filter.values.state:[];return React.createElement(_MenuLayoutComponent2.default,{options:this.options,multiple:true,displayMode:this.layoutMode.value,onChange:this.onChange.bind(this),selectedItems:values})}},{key:"deprecatedStateMapping",get:function get(){return[_get(DiscreteValuesDataFilterEditor.prototype.__proto__||Object.getPrototypeOf(DiscreteValuesDataFilterEditor.prototype),"deprecatedStateMapping",this),{"layoutMode":this.layoutMode}]}}],[{key:"OPTIONS",get:function get(){return[_MenuLayoutComponent.LAYOUT_LIST,_MenuLayoutComponent.LAYOUT_COMBO,_MenuLayoutComponent.LAYOUT_VSLIDER,_MenuLayoutComponent.LAYOUT_HSLIDER,_MenuLayoutComponent.LAYOUT_CHECKBOXLIST]}}]);return DiscreteValuesDataFilterEditor}(_AbstractFilterEditor3.default);exports.default=DiscreteValuesDataFilterEditor;DiscreteValuesDataFilterEditor.WEAVE_INFO=_weavejs.Weave.setClassInfo(DiscreteValuesDataFilterEditor,{id:"weavejs.editor.DiscreteValuesDataFilterEditor",interfaces:[ILinkableObjectWithNewProperties]});

},{"lodash":"lodash","react":"react","weaveapp/editor/AbstractFilterEditor":20,"weaveapp/ui/MenuLayoutComponent":122,"weavejs":136}],34:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _SelectableAttributeComponent=require("weaveapp/ui/SelectableAttributeComponent");var _SelectableAttributeComponent2=_interopRequireDefault(_SelectableAttributeComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var HelpIcon=weavejs.ui.HelpIcon;var ForeignDataMappingTransformEditor=function(_DataSourceEditor){_inherits(ForeignDataMappingTransformEditor,_DataSourceEditor);function ForeignDataMappingTransformEditor(){_classCallCheck(this,ForeignDataMappingTransformEditor);return _possibleConstructorReturn(this,(ForeignDataMappingTransformEditor.__proto__||Object.getPrototypeOf(ForeignDataMappingTransformEditor)).apply(this,arguments))}_createClass(ForeignDataMappingTransformEditor,[{key:"editorFields",get:function get(){var ds=this.props.dataSource;var attributes=new Map;attributes.set("Foreign key mapping",ds.keyColumn);attributes.set("Data to transform",ds.dataColumns);var editorFields=[this.getLabelEditor(ds.label),[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Foreign key mapping"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Each value in this column will be used as the key to look up records in the data columns"))),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"Foreign key mapping",attributes:attributes})],[_weavejs.Weave.lang("Data to transform"),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"Data to transform",attributes:attributes})]];return _get(ForeignDataMappingTransformEditor.prototype.__proto__||Object.getPrototypeOf(ForeignDataMappingTransformEditor.prototype),"editorFields",this).concat(editorFields)}}]);return ForeignDataMappingTransformEditor}(_DataSourceEditor3.default);exports.default=ForeignDataMappingTransformEditor;

},{"react":"react","weaveapp/editor/DataSourceEditor":32,"weaveapp/ui/SelectableAttributeComponent":123,"weavejs":136}],35:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _KeyTypeInput=require("weaveapp/ui/KeyTypeInput");var _KeyTypeInput2=_interopRequireDefault(_KeyTypeInput);var _FileSelector=require("weaveapp/ui/FileSelector");var _FileSelector2=_interopRequireDefault(_FileSelector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ComboBox=weavejs.ui.ComboBox;var HelpIcon=weavejs.ui.HelpIcon;var GeoJSON=weavejs.geom.GeoJSON;var GeoJSONDataSourceEditor=function(_DataSourceEditor){_inherits(GeoJSONDataSourceEditor,_DataSourceEditor);function GeoJSONDataSourceEditor(){_classCallCheck(this,GeoJSONDataSourceEditor);return _possibleConstructorReturn(this,(GeoJSONDataSourceEditor.__proto__||Object.getPrototypeOf(GeoJSONDataSourceEditor)).apply(this,arguments))}_createClass(GeoJSONDataSourceEditor,[{key:"editorFields",get:function get(){var dataSource=this.props.dataSource;var propertyIds=dataSource.getPropertyNames().map(function(id){return{label:id.toString(),value:id}});var validGeoJson=true;var acceptExtension=".json,.geojson,application/vnd.geo+json";if(dataSource.url.result){var jsonObj=dataSource.url.result;validGeoJson=GeoJSON.isGeoJSONObject(jsonObj)}propertyIds.unshift({label:_weavejs.Weave.lang("Auto-generated keys"),value:null});var editorFields=[this.getLabelEditor(dataSource.label),[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("GeoJSON URL"),React.createElement(HelpIcon,{className:validGeoJson?"":"fa-exclamation-triangle",style:{color:validGeoJson?null:"#794B02"}},React.createElement(VBox,null,validGeoJson?_weavejs.Weave.lang("The URL of the GeoJSON file to be used"):_weavejs.Weave.lang("Warning: The file you have chosen has an extension that does not match the expected extension.")))),React.createElement(_FileSelector2.default,{style:{width:"100%"},targetUrl:dataSource.url,placeholder:_weavejs.Weave.lang("http://www.example.com/example.geojson"),accept:acceptExtension})],[_weavejs.Weave.lang("Projection"),React.createElement(StatefulTextField,{style:{width:"100%"},selectOnFocus:true,placeholder:_weavejs.Weave.lang("Example: EPSG:4326"),ref:WeaveReactUtils.linkReactStateRef(this,{value:dataSource.projection})})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Key property"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("A property that can uniquely identify each row in the data. If there are no such properties, choose \"Auto-generated keys\""))),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:dataSource.keyProperty}),options:propertyIds})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Key namespace"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Key namespaces are used to link tables using matching key columns."))),React.createElement(_KeyTypeInput2.default,{style:{width:"100%"},keyTypeProperty:dataSource.keyType})]];return _get(GeoJSONDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(GeoJSONDataSourceEditor.prototype),"editorFields",this).concat(editorFields)}}]);return GeoJSONDataSourceEditor}(_DataSourceEditor3.default);exports.default=GeoJSONDataSourceEditor;

},{"react":"react","weaveapp/editor/DataSourceEditor":32,"weaveapp/ui/FileSelector":119,"weaveapp/ui/KeyTypeInput":121,"weavejs":136}],36:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _SelectableAttributeComponent=require("weaveapp/ui/SelectableAttributeComponent");var _SelectableAttributeComponent2=_interopRequireDefault(_SelectableAttributeComponent);var _KeyTypeInput=require("weaveapp/ui/KeyTypeInput");var _KeyTypeInput2=_interopRequireDefault(_KeyTypeInput);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var HelpIcon=weavejs.ui.HelpIcon;var FilteredColumn=weavejs.data.column.FilteredColumn;var DynamicComponent=weavejs.ui.DynamicComponent;var Checkbox=weavejs.ui.Checkbox;var GroupedDataTransformEditor=function(_DataSourceEditor){_inherits(GroupedDataTransformEditor,_DataSourceEditor);function GroupedDataTransformEditor(){_classCallCheck(this,GroupedDataTransformEditor);var _this=_possibleConstructorReturn(this,(GroupedDataTransformEditor.__proto__||Object.getPrototypeOf(GroupedDataTransformEditor)).apply(this,arguments));_this.isFiltered=function(){var ds=_this.props.dataSource;return _weavejs.Weave.IS(ds.groupByColumn.getInternalColumn(),FilteredColumn)};_this.setFiltered=function(enabled){var ds=_this.props.dataSource;if(_this.isFiltered()===enabled)return;if(enabled){var groupByState=_weavejs.Weave.getState(ds.groupByColumn);var filteredColumn=ds.groupByColumn.requestLocalObject(FilteredColumn);_weavejs.Weave.setState(filteredColumn.internalDynamicColumn,groupByState);filteredColumn.filter.targetPath=["defaultSubsetKeyFilter"]}else{var _filteredColumn=_weavejs.Weave.AS(ds.groupByColumn.getInternalColumn(),FilteredColumn);_weavejs.Weave.setState(ds.groupByColumn,_weavejs.Weave.getState(_filteredColumn.internalDynamicColumn))}};return _this}_createClass(GroupedDataTransformEditor,[{key:"editorFields",get:function get(){var _this2=this;var ds=this.props.dataSource;var attributes=new Map;attributes.set("Group by",ds.groupByColumn);attributes.set("Data to transform",ds.dataColumns);var editorFields=[this.getLabelEditor(ds.label),[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Group by"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("The keyType of the \"Group by\" column should match the keyType of each column to be transformed. The values in this column will be treated as foreign keys which map to aggregated values in the transformed columns."))),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"Group by",attributes:attributes})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Group keyType"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Specifies the keyType of the foreign keys referenced by the \"Group by\" column. By default, the dataType of the \"Group by\" column is used as the foreign keyType."))),React.createElement(_KeyTypeInput2.default,{keyTypeProperty:ds.groupKeyType})],[_weavejs.Weave.lang("Data to transform"),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"Data to transform",attributes:attributes})],[_weavejs.Weave.lang("Filter grouped records using subset"),React.createElement(DynamicComponent,{dependencies:[ds.groupByColumn],render:function render(){return React.createElement(Checkbox,{label:" ",value:_this2.isFiltered(),onChange:_this2.setFiltered})}})]];return _get(GroupedDataTransformEditor.prototype.__proto__||Object.getPrototypeOf(GroupedDataTransformEditor.prototype),"editorFields",this).concat(editorFields)}}]);return GroupedDataTransformEditor}(_DataSourceEditor3.default);exports.default=GroupedDataTransformEditor;

},{"react":"react","weaveapp/editor/DataSourceEditor":32,"weaveapp/ui/KeyTypeInput":121,"weaveapp/ui/SelectableAttributeComponent":123,"weavejs":136}],37:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _reactCodemirror=require("weaveapp/modules/react-codemirror");var _reactCodemirror2=_interopRequireDefault(_reactCodemirror);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SmartComponent=weavejs.ui.SmartComponent;var JSONEditor=function(_SmartComponent){_inherits(JSONEditor,_SmartComponent);function JSONEditor(props){_classCallCheck(this,JSONEditor);var _this=_possibleConstructorReturn(this,(JSONEditor.__proto__||Object.getPrototypeOf(JSONEditor)).call(this,props));_this.onFocusChange=function(focused){if(!focused&&_this.state.error){_this.json=null;_this.parsed=null;_this.setState({error:null})}};_this.handleJSON=function(json){try{_this.json=json;_this.parsed=JSON.parse(json);_this.setState({value:_this.parsed,error:null})}catch(error){_this.parsed=null;_this.setState({error:error})}};return _this}_createClass(JSONEditor,[{key:"render",value:function render(){if(!this.state.error&&!_.isEqual(this.state.value,this.parsed)){this.json=_weavejs.Weave.stringify(this.state.value,null,"\t",true);this.parsed=this.state.value}return React.createElement(_reactCodemirror2.default,{className:this.state.error?"weave-error-border":"weave-normal-border",onFocusChange:this.onFocusChange,options:{mode:"javascript",lineNumbers:false,lineWrapping:false,smartIndent:false,theme:"eclipse",readOnly:false},value:this.json,onChange:this.handleJSON})}}]);return JSONEditor}(SmartComponent);exports.default=JSONEditor;

},{"lodash":"lodash","react":"react","weaveapp/modules/react-codemirror":66,"weavejs":136}],38:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ColumnMetadata=weavejs.api.data.ColumnMetadata;var EditableTextCell=weavejs.ui.EditableTextCell;var ComboBox=weavejs.ui.ComboBox;var VBox=weavejs.ui.flexbox.VBox;var HBox=weavejs.ui.flexbox.HBox;var EntityMetadata=weavejs.api.net.beans.EntityMetadata;var MetadataGrid=function(_React$Component){_inherits(MetadataGrid,_React$Component);function MetadataGrid(props){_classCallCheck(this,MetadataGrid);var _this=_possibleConstructorReturn(this,(MetadataGrid.__proto__||Object.getPrototypeOf(MetadataGrid)).call(this,props));var entry={};_this.state={entry:entry};return _this}_createClass(MetadataGrid,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(!_.isEqual(this.props.entries,nextProps.entries)){var entry={};this.setState({entry:entry})}}},{key:"getEditor",value:function getEditor(entry,key,value){var _this2=this;var valueArray=Array.isArray(value);var entryCopy=_.cloneDeep(entry);var dedupedValues=valueArray&&_.uniq(value);var options=void 0;if(valueArray&&dedupedValues.length>1){options=dedupedValues.map(function(val,index){return{label:String(val),value:val}});return React.createElement(HBox,{overflow:true,style:{flex:1}},React.createElement(ComboBox,{style:{width:"100%"},noneOption:{label:"(None)",value:null},options:options,placeholder:_weavejs.Weave.lang("(Multiple Values)"),allowAdditions:true,searchable:true,onChange:function onChange(val){entry[key]=val;_this2.props.onChangeCallback(entry)}}))}var singleValue=valueArray?value[0]:value;options=ColumnMetadata.getSuggestedPropertyValues(key).map(function(value,index){return{label:value,value:value}});switch(key){case ColumnMetadata.KEY_TYPE:return React.createElement("div",{className:"weave-input-div disabled"},singleValue);case ColumnMetadata.AGGREGATION:case ColumnMetadata.DATA_TYPE:case ColumnMetadata.DATE_DISPLAY_FORMAT:case ColumnMetadata.DATE_FORMAT:return React.createElement(HBox,{overflow:true,style:{flex:1}},React.createElement(ComboBox,{style:{width:"100%"},value:singleValue,noneOption:{label:"(None)",value:null},options:options,allowAdditions:true,searchable:true,onChange:function onChange(val){entry[key]=val;_this2.props.onChangeCallback(entry)}}));case ColumnMetadata.MAX:case ColumnMetadata.MIN:case ColumnMetadata.NUMBER:case ColumnMetadata.OVERRIDE_BINS:case ColumnMetadata.STRING:case ColumnMetadata.TITLE:default:return React.createElement(EditableTextCell,{style:{flex:1},textContent:singleValue,emptyText:_weavejs.Weave.lang("Double click to edit"),onChange:function onChange(val){entry=_.set(entry,key,val);_this2.props.onChangeCallback(entry)}});}}},{key:"getCombinedEntry",value:function getCombinedEntry(){var combined=_.merge(this.state.entry,{});if(this.props.entries){if(this.props.entries.length>1){this.props.entries.forEach(function(entry){_.forEach(entry,function(value,key){if(!combined[key]){combined[key]=[value]}else if(combined[key]&&!_.includes(combined[key],value)){combined[key].push(value)}})})}else{_.forEach(this.props.entries[0],function(value,key){combined[key]=value})}}return combined}},{key:"render",value:function render(){var _this3=this;var rows=[];var entry=this.getCombinedEntry();if(entry)rows=_.map(entry,function(value,key){return{property:key,value:_this3.getEditor(entry,key,value)}});var columnIds=["property","value"];var columnTitles={property:_weavejs.Weave.lang("Property"),value:_weavejs.Weave.lang("Value")};var options=_.difference(EntityMetadata.getSuggestedPublicPropertyNames(),_.keys(entry)).map(function(name,index){return{label:String(name),value:name}});var cellStyle={border:"1px solid #dddddd",textAlign:"left",padding:8};return React.createElement(VBox,{style:{flex:1}},React.createElement(VBox,{style:{flex:1,border:"1px solid #D6D6D6",overflowX:"hidden"}},React.createElement("table",{style:{borderCollapse:"collapse",width:"100%"}},React.createElement("thead",null,React.createElement("tr",null,_.keys(columnTitles).map(function(key,index){return React.createElement("th",{key:index},columnTitles[key])}))),React.createElement("tbody",null,rows.map(function(row,index){return React.createElement("tr",{key:index},_.keys(row).map(function(key,i){return React.createElement("td",{key:i,style:cellStyle},row[key])}))})))),React.createElement(HBox,{overflow:true},_weavejs.Weave.lang("Add property:"),React.createElement(ComboBox,{style:{width:"100%"},value:null,placeholder:_weavejs.Weave.lang("Add a new property..."),noneOption:{label:"(None)",value:null},options:options,allowAdditions:true,searchable:true,direction:"upward",onChange:function onChange(val){var propertyValues=ColumnMetadata.getSuggestedPropertyValues(val);entry[val]=propertyValues&&propertyValues[0]||undefined;_this3.setState({entry:entry});_this3.props.onChangeCallback(entry)},onAddNewOption:function onAddNewOption(val){entry[val]=undefined;_this3.setState({entry:entry});_this3.props.onChangeCallback(entry)}})))}}]);return MetadataGrid}(React.Component);exports.default=MetadataGrid;

},{"lodash":"lodash","react":"react","weavejs":136}],39:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _AttributeSelector=require("weaveapp/ui/AttributeSelector");var _AttributeSelector2=_interopRequireDefault(_AttributeSelector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VBox=weavejs.ui.flexbox.VBox;var HEADER_COLUMNS="Header columns";var DATA_COLUMNS="Data columns";var MouseoverController=function(_React$Component){_inherits(MouseoverController,_React$Component);function MouseoverController(props){_classCallCheck(this,MouseoverController);var _this=_possibleConstructorReturn(this,(MouseoverController.__proto__||Object.getPrototypeOf(MouseoverController)).call(this,props));_this.attributes=new Map;_this.attributes.set(HEADER_COLUMNS,props.probedHeaderColumns);_this.attributes.set(DATA_COLUMNS,props.probedColumns);return _this}_createClass(MouseoverController,[{key:"render",value:function render(){return React.createElement(VBox,{style:{flex:1}},React.createElement(_AttributeSelector2.default,{attributeName:HEADER_COLUMNS,attributes:this.attributes}))}}]);return MouseoverController}(React.Component);exports.default=MouseoverController;

},{"react":"react","weaveapp/ui/AttributeSelector":110,"weavejs":136}],40:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractFilterEditor2=require("weaveapp/editor/AbstractFilterEditor");var _AbstractFilterEditor3=_interopRequireDefault(_AbstractFilterEditor2);var _HSlider=require("weaveapp/ui/slider/HSlider");var _HSlider2=_interopRequireDefault(_HSlider);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var LinkableBoolean=weavejs.core.LinkableBoolean;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ColumnUtils=weavejs.data.ColumnUtils;var NumericRangeDataFilterEditor=function(_AbstractFilterEditor){_inherits(NumericRangeDataFilterEditor,_AbstractFilterEditor);function NumericRangeDataFilterEditor(props){_classCallCheck(this,NumericRangeDataFilterEditor);var _this=_possibleConstructorReturn(this,(NumericRangeDataFilterEditor.__proto__||Object.getPrototypeOf(NumericRangeDataFilterEditor)).call(this,props));_this.forceDiscreteValues=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false),_this.handleColumn);_this.options=[];return _this}_createClass(NumericRangeDataFilterEditor,[{key:"onChange",value:function onChange(selectedValues){this.filter.values.state=selectedValues}},{key:"render",value:function render(){if(_weavejs.Weave.detectChange(this,this.column)){this.options=ColumnUtils.getRecords({value:this.column,label:this.column},this.column.keys,{value:Number,label:String});this.options=_.sortByOrder(_.uniq(this.options,"value"),["value"],["asc"])}var values=this.filter?this.filter.values.state:[];if(this.forceDiscreteValues.value){return React.createElement(HBox,{style:{flex:1,padding:25}},React.createElement(_HSlider2.default,{type:"numeric-discrete",options:this.options,selectedValues:values,onChange:this.onChange.bind(this)}))}else{return React.createElement(HBox,{style:{flex:1,padding:25}},React.createElement(_HSlider2.default,{type:"numeric",options:this.options,selectedValues:values,onChange:this.onChange.bind(this)}))}}},{key:"deprecatedStateMapping",get:function get(){return[_get(NumericRangeDataFilterEditor.prototype.__proto__||Object.getPrototypeOf(NumericRangeDataFilterEditor.prototype),"deprecatedStateMapping",this),{"forceDiscreteValues":this.forceDiscreteValues}]}}],[{key:"OPTIONS",get:function get(){return["Force Discrete Values"]}}]);return NumericRangeDataFilterEditor}(_AbstractFilterEditor3.default);exports.default=NumericRangeDataFilterEditor;NumericRangeDataFilterEditor.WEAVE_INFO=_weavejs.Weave.setClassInfo(NumericRangeDataFilterEditor,{id:"weavejs.editor.NumericRangeDataFilterEditor",interfaces:[ILinkableObjectWithNewProperties]});

},{"lodash":"lodash","react":"react","weaveapp/editor/AbstractFilterEditor":20,"weaveapp/ui/slider/HSlider":128,"weavejs":136}],41:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _classnames=require("weaveapp/modules/classnames");var _classnames2=_interopRequireDefault(_classnames);var _HSlider=require("weaveapp/ui/slider/HSlider");var _HSlider2=_interopRequireDefault(_HSlider);var _RCSlider=require("weaveapp/ui/slider/RCSlider");var _RCSlider2=_interopRequireDefault(_RCSlider);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var ReactUtils=weavejs.util.ReactUtils;var CenteredIcon=weavejs.ui.CenteredIcon;var SessionStateLog=weavejs.core.SessionStateLog;var LinkableWatcher=weavejs.core.LinkableWatcher;var KeyboardUtils=weavejs.util.KeyboardUtils;var SessionHistorySlider=function(_React$Component){_inherits(SessionHistorySlider,_React$Component);function SessionHistorySlider(props){_classCallCheck(this,SessionHistorySlider);var _this=_possibleConstructorReturn(this,(SessionHistorySlider.__proto__||Object.getPrototypeOf(SessionHistorySlider)).call(this,props));_this._stateLogWatcher=_weavejs.Weave.linkableChild(_this,new LinkableWatcher(SessionStateLog));_this.handleKeyStroke=function(event){if((event.ctrlKey||event.metaKey)&&event.keyCode==KeyboardUtils.KEYCODES.Z){event.preventDefault();_this._stateLog.undo()}if((event.ctrlKey||event.metaKey)&&event.keyCode==KeyboardUtils.KEYCODES.Y||event.metaKey&&event.shiftKey&&event.keyCode==KeyboardUtils.KEYCODES.Z){event.preventDefault();_this._stateLog.redo()}};_this.play=function(){};_this.getPlayLabel=function(a,b){return""};_this._stateLogWatcher.target=props.stateLog;_this.state={position:0};_weavejs.Weave.getCallbacks(_this._stateLogWatcher).addGroupedCallback(_this,_this.handleStateLogChange,true,false);return _this}_createClass(SessionHistorySlider,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){this._stateLogWatcher.target=props.stateLog}},{key:"handleStateLogChange",value:function handleStateLogChange(){this.setState({position:this._stateLog.undoHistory.length,max:this._stateLog.undoHistory.length+this._stateLog.redoHistory.length+1})}},{key:"componentDidMount",value:function componentDidMount(){ReactUtils.getDocument(this).addEventListener("keydown",this.handleKeyStroke)}},{key:"componentWillUnmount",value:function componentWillUnmount(){ReactUtils.getDocument(this).removeEventListener("keydown",this.handleKeyStroke)}},{key:"handleSlider",value:function handleSlider(selectedValue){if(!selectedValue||!selectedValue.length){selectedValue=["0"]}var delta=Number(selectedValue[0])-this._stateLog.undoHistory.length;if(delta<0)this._stateLog.undo(-delta);else this._stateLog.redo(delta)}},{key:"render",value:function render(){var _this2=this;var sliderOptions=[];for(var i=0;i<this.state.max;i++){sliderOptions.push({value:i,label:""})}return React.createElement(HBox,{style:{flex:1,alignItems:"center",alignSelf:"stretch"}},React.createElement(CenteredIcon,{"aria-label":_weavejs.Weave.lang("Undo"),onClick:function onClick(){return _this2._stateLog.undo()},className:(0,_classnames2.default)("weave-icon","weave-menubar-item",{"weave-menubar-item-disabled":!this._stateLog.undoHistory.length}),iconProps:{className:"fa fa-arrow-left"}}),React.createElement(CenteredIcon,{"aria-label":_weavejs.Weave.lang("Redo"),onClick:function onClick(){return _this2._stateLog.redo()},className:(0,_classnames2.default)("weave-icon","weave-menubar-item",{"weave-menubar-item-disabled":!this._stateLog.redoHistory.length}),iconProps:{className:"fa fa-arrow-right"}}),this.props.showSlider?React.createElement(_HSlider2.default,{options:sliderOptions,selectedValues:[this.state.position],step:1,onChange:this.handleSlider.bind(this),type:_RCSlider2.default.CATEGORICAL}):null)}},{key:"_stateLog",get:function get(){return this._stateLogWatcher.target}}]);return SessionHistorySlider}(React.Component);exports.default=SessionHistorySlider;SessionHistorySlider.WEAVE_INFO=_weavejs.Weave.setClassInfo(SessionHistorySlider,{id:"weavejs.editor.SessionHistorySlider"});

},{"react":"react","weaveapp/modules/classnames":61,"weaveapp/ui/slider/HSlider":128,"weaveapp/ui/slider/RCSlider":129,"weavejs":136}],42:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _WeaveProperties=require("weaveapp/WeaveProperties");var _WeaveProperties2=_interopRequireDefault(_WeaveProperties);var _ControlPanel=require("weaveapp/editor/ControlPanel");var _ControlPanel2=_interopRequireDefault(_ControlPanel);var _JSONEditor=require("weaveapp/editor/JSONEditor");var _JSONEditor2=_interopRequireDefault(_JSONEditor);var _AttributeSelector=require("weaveapp/ui/AttributeSelector");var _AttributeSelector2=_interopRequireDefault(_AttributeSelector);var _WeaveTree2=require("weaveapp/ui/WeaveTree");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SmartComponent=weavejs.ui.SmartComponent;var HDividedBox=weavejs.ui.HDividedBox;var VBox=weavejs.ui.flexbox.VBox;var DynamicComponent=weavejs.ui.DynamicComponent;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ILinkableCompositeObject=weavejs.api.core.ILinkableCompositeObject;var ILinkableHashMap=weavejs.api.core.ILinkableHashMap;var DebugUtils=weavejs.util.DebugUtils;var IColumnWrapper=weavejs.api.data.IColumnWrapper;var ILinkableDynamicObject=weavejs.api.core.ILinkableDynamicObject;var Menu=weavejs.ui.menu.Menu;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var IObjectWithDescription=weavejs.api.ui.IObjectWithDescription;var SessionStateEditor=function(_SmartComponent){_inherits(SessionStateEditor,_SmartComponent);function SessionStateEditor(props){_classCallCheck(this,SessionStateEditor);var _this=_possibleConstructorReturn(this,(SessionStateEditor.__proto__||Object.getPrototypeOf(SessionStateEditor)).call(this,props));_this.onSelect=function(items){_this.setState({selectedNode:items[0]})};_this.onDoubleClick=function(item){};_this.canDeleteSelectedItem=function(){var item=SessionStateEditor.getTreeNode(_this.selectedObject);var parent=_weavejs.Weave.getOwner(item&&item.data);var hashMap=_weavejs.Weave.AS(parent,ILinkableHashMap);var dynamicObject=_weavejs.Weave.AS(parent,ILinkableDynamicObject);return!!(hashMap||dynamicObject)};_this.deleteSelectedItem=function(){var item=SessionStateEditor.getTreeNode(_this.selectedObject);if(!item)return;var parent=_weavejs.Weave.getOwner(item.data);if(!parent)return;var hashMap=_weavejs.Weave.AS(parent,ILinkableHashMap);var dynamicObject=_weavejs.Weave.AS(parent,ILinkableDynamicObject);var oldObject=item.data;if(hashMap)hashMap.removeObject(hashMap.getName(oldObject));else if(dynamicObject)dynamicObject.removeObject();if(!!(hashMap||dynamicObject)&&!_weavejs.Weave.wasDisposed(oldObject))_this.reportError(_weavejs.Weave.lang("Object is locked and cannot be deleted."))};_this.treeDescriptor=new WeaveSessionTreeDescriptor;return _this}_createClass(SessionStateEditor,[{key:"componentDidMount",value:function componentDidMount(){Menu.registerMenuSource(this)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){}},{key:"getMenuItems",value:function getMenuItems(){var _this2=this;return[{shown:!!this.selectedObject,label:_weavejs.Weave.lang("New object..."),enabled:_weavejs.Weave.IS(this.selectedObject,ILinkableCompositeObject),click:function click(){var parent=_this2.selectedObject;_this2.showInputDialog(_weavejs.Weave.lang("Create new object"),_weavejs.Weave.lang("Enter the object type"),"",function(className){try{return _weavejs.Weave.getDefinition(className)!=null}catch(e){}return false},function(className){_weavejs.WeaveAPI.Scheduler.callLater(_this2,_this2.newObject,[parent,_weavejs.Weave.getDefinition(className)])})}},{shown:!!this.selectedObject,label:_weavejs.Weave.lang("Rename object..."),enabled:_weavejs.Weave.IS(_weavejs.Weave.getOwner(this.selectedObject),ILinkableHashMap),click:function click(){var object=_this2.selectedObject;var parent=_weavejs.Weave.getOwner(object);_this2.showInputDialog(_weavejs.Weave.lang("Rename object"),_weavejs.Weave.lang("Enter a new name"),parent.getName(object),function(name){return!parent.getObject(name)},function(name){parent.renameObject(parent.getName(object),name)})}},{shown:!!this.selectedObject,label:_weavejs.Weave.lang("Delete selected object"),enabled:this.canDeleteSelectedItem(),click:this.deleteSelectedItem},{},{shown:!!this.selectedObject,label:_weavejs.Weave.lang("Open attribute selector"),enabled:_weavejs.Weave.IS(this.selectedObject,ILinkableHashMap)||_weavejs.Weave.IS(this.selectedObject,IColumnWrapper),click:function click(){var selectedNode=_this2.selectedTreeNode;var selectableAttribute=_this2.selectedObject;_AttributeSelector2.default.openInstance(_this2,selectedNode.label,new Map([[selectedNode.label,selectableAttribute]]))}},{},{shown:!!this.selectedObject,label:_weavejs.Weave.lang("Watch selected object in console"),click:function click(){return DebugUtils.watchState(_this2.selectedObject)}},{shown:!!this.selectedObject,label:_weavejs.Weave.lang("Unwatch selected object"),click:function click(){return DebugUtils.unwatch(_this2.selectedObject)}}]}},{key:"showInputDialog",value:function showInputDialog(title,message){var defaultInput=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var inputValidator=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var inputHandler=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;this.reportError("TODO - implement SessionStateEditor.prototype.showInputDialog()")}},{key:"newObject",value:function newObject(parent,classDef){var _this3=this;var className=_weavejs.Weave.className(classDef).split(".").pop();if(_weavejs.Weave.IS(parent,ILinkableDynamicObject)){var newObject=_weavejs.Weave.AS(parent,ILinkableDynamicObject).requestLocalObject(classDef,false);if(newObject)this.onSelect([SessionStateEditor.getTreeNode(newObject)]);else this.reportError("Unable to create new "+className);return}var ilh=_weavejs.Weave.AS(parent,ILinkableHashMap);if(!ilh){this.reportError("Cannot create object under parent of type "+_weavejs.Weave.className(parent));return}this.showInputDialog(_weavejs.Weave.lang("Create new object"),_weavejs.Weave.lang("Enter the name of the new {0}",className),ilh.generateUniqueName(className),null,function(name){var newObject=ilh.requestObject(name,classDef,false);if(newObject){_this3.onSelect([SessionStateEditor.getTreeNode(newObject)])}else _this3.reportError("Unable to create new "+className)})}},{key:"reportError",value:function reportError(message){_WeaveProperties2.default.notify(_weavejs.Weave.getWeave(this.props.rootObject),"error",message)}},{key:"render",value:function render(){var _this4=this;var rootNode=SessionStateEditor.getTreeNode(this.props.rootObject);var initialSelectedNode=SessionStateEditor.getTreeNode(this.props.initialSelectedObject);var initialOpenItems=[rootNode,initialSelectedNode].filter(function(n){return!!n});return React.createElement(HDividedBox,{style:{flex:1},resizerStyle:{background:"black"},loadWithEqualWidthChildren:true},React.createElement(VBox,null,React.createElement(DynamicComponent,{dependencies:[this.props.rootObject],render:function render(){return React.createElement(WeaveSessionTree,{root:rootNode,treeDescriptor:_this4.treeDescriptor,initialOpenItems:initialOpenItems,initialSelectedItems:[initialSelectedNode],multipleSelection:false,onSelect:_this4.onSelect,onDoubleClick:_this4.onDoubleClick})}})),React.createElement(VBox,null,React.createElement(_JSONEditor2.default,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.selectedObject})})))}},{key:"selectedObject",get:function get(){return this.state.selectedNode?this.state.selectedNode.data:this.props.initialSelectedObject||this.props.rootObject}},{key:"selectedTreeNode",get:function get(){return SessionStateEditor.getTreeNode(this.selectedObject)}}],[{key:"getTreeNode",value:function getTreeNode(object){var root=_weavejs.Weave.getRoot(object);var path=_weavejs.Weave.findPath(root,object);var name=_weavejs.WeaveAPI.ClassRegistry.getDisplayName(object.constructor);if(path)name=path.length?path.pop():"Weave";return _weavejs.WeaveAPI.SessionManager.getSessionStateTree(object,name)}},{key:"openInstance",value:function openInstance(context,selectedObject){var weave=_weavejs.Weave.getWeave(selectedObject);return _ControlPanel2.default.openInstance(weave,SessionStateEditor,{context:context,title:_weavejs.Weave.lang("Session State Editor")},{rootObject:weave.root,initialSelectedObject:selectedObject})}}]);return SessionStateEditor}(SmartComponent);exports.default=SessionStateEditor;var WeaveSessionTreeDescriptor=function(_BasicTreeDescriptor){_inherits(WeaveSessionTreeDescriptor,_BasicTreeDescriptor);function WeaveSessionTreeDescriptor(){_classCallCheck(this,WeaveSessionTreeDescriptor);return _possibleConstructorReturn(this,(WeaveSessionTreeDescriptor.__proto__||Object.getPrototypeOf(WeaveSessionTreeDescriptor)).apply(this,arguments))}_createClass(WeaveSessionTreeDescriptor,[{key:"getLabel",value:function getLabel(node){var label=_weavejs.Weave.className(node.data).split(".").pop();if(node.label)label+=" "+JSON.stringify(node.label);var editorLabel=_weavejs.WeaveAPI.EditorManager.getLabel(node.data);var description=null;var iowd=_weavejs.Weave.AS(node.data,IObjectWithDescription);if(iowd)description=iowd.getDescription();else if(_weavejs.Weave.IS(node.data,IAttributeColumn))description=node.data.getMetadata(ColumnMetadata.TITLE);var inParens=editorLabel||description;if(editorLabel&&description)inParens=editorLabel+": "+description;if(inParens)label+=" ("+inParens+")";return label}},{key:"isEqual",value:function isEqual(node1,node2){return node1.data==node2.data}}]);return WeaveSessionTreeDescriptor}(_WeaveTree2.BasicTreeDescriptor);var WeaveSessionTree=function(_WeaveTree){_inherits(WeaveSessionTree,_WeaveTree);function WeaveSessionTree(){_classCallCheck(this,WeaveSessionTree);return _possibleConstructorReturn(this,(WeaveSessionTree.__proto__||Object.getPrototypeOf(WeaveSessionTree)).apply(this,arguments))}return WeaveSessionTree}(_WeaveTree2.WeaveTree);

},{"react":"react","weaveapp/WeaveProperties":3,"weaveapp/editor/ControlPanel":30,"weaveapp/editor/JSONEditor":37,"weaveapp/ui/AttributeSelector":110,"weaveapp/ui/WeaveTree":126,"weavejs":136}],43:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _SelectableAttributeComponent=require("weaveapp/ui/SelectableAttributeComponent");var _SelectableAttributeComponent2=_interopRequireDefault(_SelectableAttributeComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var HelpIcon=weavejs.ui.HelpIcon;var SpatialJoinTransformEditor=function(_DataSourceEditor){_inherits(SpatialJoinTransformEditor,_DataSourceEditor);function SpatialJoinTransformEditor(){_classCallCheck(this,SpatialJoinTransformEditor);return _possibleConstructorReturn(this,(SpatialJoinTransformEditor.__proto__||Object.getPrototypeOf(SpatialJoinTransformEditor)).apply(this,arguments))}_createClass(SpatialJoinTransformEditor,[{key:"editorFields",get:function get(){var ds=this.props.dataSource;var attributes=new Map;attributes.set("X",ds.xColumn);attributes.set("Y",ds.yColumn);attributes.set("Geometry",ds.geometryColumn);var editorFields=[this.getLabelEditor(ds.label),[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},Weave.lang("X Coordinate"),React.createElement(HelpIcon,null,Weave.lang("The keyType of the \"X Coordinate\" and \"Y Coordinate\" columns should match."))),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"X",attributes:attributes})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},Weave.lang("Y Coordinate"),React.createElement(HelpIcon,null,Weave.lang("The keyType of the \"X Coordinate\" and \"Y Coordinate\" columns should match."))),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"Y",attributes:attributes})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},Weave.lang("Geometry to group by"),React.createElement(HelpIcon,null,Weave.lang("Specifies the geometry column to use for grouping the supplied points."))),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"Geometry",attributes:attributes})],[Weave.lang("Point Data Projection"),React.createElement(StatefulTextField,{style:{width:"100%"},selectOnFocus:true,placeholder:Weave.lang("Example: EPSG:4326"),ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.pointProjection})})]];return _get(SpatialJoinTransformEditor.prototype.__proto__||Object.getPrototypeOf(SpatialJoinTransformEditor.prototype),"editorFields",this).concat(editorFields)}}]);return SpatialJoinTransformEditor}(_DataSourceEditor3.default);exports.default=SpatialJoinTransformEditor;

},{"react":"react","weaveapp/editor/DataSourceEditor":32,"weaveapp/ui/SelectableAttributeComponent":123,"weavejs":136}],44:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _DataSourceEditor2=require("weaveapp/editor/DataSourceEditor");var _DataSourceEditor3=_interopRequireDefault(_DataSourceEditor2);var _ConnectionManager=require("weaveapp/admin/ConnectionManager");var _ConnectionManager2=_interopRequireDefault(_ConnectionManager);var _SqlImport=require("weaveapp/admin/SqlImport");var _SqlImport2=_interopRequireDefault(_SqlImport);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var Button=weavejs.ui.Button;var EntityNode=weavejs.data.hierarchy.EntityNode;var MenuButton=weavejs.ui.menu.MenuButton;var PopupWindow=weavejs.ui.PopupWindow;var WeaveAdminService=weavejs.net.WeaveAdminService;var WeaveDataServlet=weavejs.net.WeaveDataServlet;var SQL="SQL";var CSV="CSV";var dataImportTypes=[SQL];var WeaveDataSourceEditor=function(_DataSourceEditor){_inherits(WeaveDataSourceEditor,_DataSourceEditor);function WeaveDataSourceEditor(){_classCallCheck(this,WeaveDataSourceEditor);var _this=_possibleConstructorReturn(this,(WeaveDataSourceEditor.__proto__||Object.getPrototypeOf(WeaveDataSourceEditor)).apply(this,arguments));_this.onHierarchySelected=function(selectedItems){var item=selectedItems[0];if(_this.props.dataSource&&item instanceof EntityNode){_this.props.dataSource.rootId.state=item.getEntity().id}else{_this.props.dataSource.rootId.state=null}};_this.selectId=function(id){_this.props.dataSource.hierarchyRefresh.triggerCallbacks()};_this.openSqlImport=PopupWindow.generateOpener(function(){return{context:_this,title:_weavejs.Weave.lang("Import data from SQL"),content:React.createElement(_SqlImport2.default,{service:_this.service,selectIdFunc:_this.selectId}),resizable:true,width:920,footerContent:React.createElement("div",null),height:675,suspendEnter:true}});_this.openCsvImport=function(){console.log("opening the csv import opo")};_this.openConnectionManager=PopupWindow.generateOpener(function(){return{context:_this,title:_weavejs.Weave.lang("Manage Users and Connections"),content:React.createElement(_ConnectionManager2.default,{service:_this.service}),modal:true,resizable:true,footerContent:React.createElement("div",null),width:920,height:675,suspendEnter:true}});return _this}_createClass(WeaveDataSourceEditor,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){_get(WeaveDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(WeaveDataSourceEditor.prototype),"componentWillReceiveProps",this).call(this,props);props.dataSource.rootId.addGroupedCallback(this,this.setHierarchySelection,false)}},{key:"setHierarchySelection",value:function setHierarchySelection(){}},{key:"service",get:function get(){return WeaveAdminService.getInstance(WeaveDataSourceEditor.getBaseUrl(this.props.dataSource.url.value))}},{key:"editorFields",get:function get(){var _this2=this;var ds=this.props.dataSource;var consoleUri=(ds.url.value||"/WeaveServices/DataService")+"/../../"+"AdminConsole.html";var editorFields=[this.getLabelEditor(ds.label),["",React.createElement(HBox,{style:{flex:1,justifyContent:"flex-end"}},React.createElement("a",{target:"_blank",href:consoleUri},_weavejs.Weave.lang("Open Admin Console")+" "))],[_weavejs.Weave.lang("Service URL"),React.createElement(StatefulTextField,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.url},500),placeholder:WeaveDataServlet.DEFAULT_URL})],[_weavejs.Weave.lang("Root hierarchy ID"),React.createElement(StatefulTextField,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:ds.rootId},500),placeholder:_weavejs.Weave.lang("Hierarchy ID")})],[_weavejs.Weave.lang("Import Data to Server"),React.createElement(MenuButton,{className:"ui icon button",showIcon:false,style:{flex:1,alignItems:"center",justifyContent:"center"},menu:dataImportTypes.map(function(importType){if(importType==SQL){var click=_this2.openSqlImport}else if(importType==CSV){}return{label:_weavejs.Weave.lang(importType),click:click}})},_weavejs.Weave.lang("Import Data"))],[_weavejs.Weave.lang("Manage Server"),React.createElement(Button,{onClick:this.openConnectionManager},_weavejs.Weave.lang("Manage users and connections"))]];return _get(WeaveDataSourceEditor.prototype.__proto__||Object.getPrototypeOf(WeaveDataSourceEditor.prototype),"editorFields",this).concat(editorFields)}}],[{key:"getBaseUrl",value:function getBaseUrl(serviceUrl){if(!serviceUrl)return"/WeaveServices";var pathComponents=serviceUrl.split("/");pathComponents.pop();return pathComponents.join("/")}}]);return WeaveDataSourceEditor}(_DataSourceEditor3.default);exports.default=WeaveDataSourceEditor;WeaveDataSourceEditor.WEAVE_INFO=_weavejs.Weave.setClassInfo(WeaveDataSourceEditor,{id:"weavejs.editor.WeaveDataSourceEditor",linkable:false});

},{"react":"react","weaveapp/admin/ConnectionManager":6,"weaveapp/admin/SqlImport":9,"weaveapp/editor/DataSourceEditor":32,"weavejs":136}],45:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _classnames=require("weaveapp/modules/classnames");var _classnames2=_interopRequireDefault(_classnames);var _SessionStateEditor=require("weaveapp/editor/SessionStateEditor");var _SessionStateEditor2=_interopRequireDefault(_SessionStateEditor);var _InteractiveTour=require("weaveapp/dialog/InteractiveTour");var _InteractiveTour2=_interopRequireDefault(_InteractiveTour);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Button=weavejs.ui.Button;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var WeaveToolEditor=function(_React$Component){_inherits(WeaveToolEditor,_React$Component);function WeaveToolEditor(props){_classCallCheck(this,WeaveToolEditor);var _this=_possibleConstructorReturn(this,(WeaveToolEditor.__proto__||Object.getPrototypeOf(WeaveToolEditor)).call(this,props));_this.toolWatcher=WeaveReactUtils.forceUpdateWatcher(_this,_IVisTool2.default);_this.mapping_crumb_renderFn={};_this.mapping_crumb_children_state={};_this.crumbOrder=[];_this.openSessionStateEditor=function(){_SessionStateEditor2.default.openInstance(_this,_this.tool)};_this.pushCrumb=function(title,renderFn){var stateObject=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(stateObject){_this.mapping_crumb_children_state[title]=stateObject;return}_this.mapping_crumb_renderFn[title]=renderFn;_this.setState({activeCrumb:title});_this.crumbOrder.push(title)};_this.reset=function(){_this.mapping_crumb_renderFn={};_this.mapping_crumb_children_state={};_this.crumbOrder=[]};_this.isCrumbClicked=false;_this.crumbClick=function(crumbTitle,index){_this.setState({activeCrumb:crumbTitle});_this.crumbOrder=_this.crumbOrder.slice(0,index+1);_this.isCrumbClicked=true};_this.stepBackInCrumbView=function(){var index=_this.crumbOrder.length-2;var activeCrumbTitle=_this.crumbOrder[index];_this.setState({activeCrumb:activeCrumbTitle});_this.crumbOrder=_this.crumbOrder.slice(0,index+1);_this.isCrumbClicked=true};_this.closeEditor=function(event){if(_this.props.onCloseHandler)_this.props.onCloseHandler(_this);_InteractiveTour2.default.targetComponentOnClick("Tool editor")};_this.handleNewTool(props.tool);return _this}_createClass(WeaveToolEditor,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.tool!==nextProps.tool){this.handleNewTool(nextProps.tool)}}},{key:"handleNewTool",value:function handleNewTool(tool){this.reset();if(tool&&!_weavejs.Weave.wasDisposed(tool)){this.tool=tool;this.displayName=_weavejs.WeaveAPI.ClassRegistry.getDisplayName(this.tool.constructor);var state={activeCrumb:this.displayName};if(this.state)this.setState(state);else this.state=state;this.crumbOrder[0]=this.displayName;this.mapping_crumb_renderFn[this.displayName]=this.tool.renderEditor}}},{key:"componentWillUpdate",value:function componentWillUpdate(){if(!this.tool&&this.props.onCloseHandler)this.props.onCloseHandler(this)}},{key:"componentDidUpdate",value:function componentDidUpdate(){if(this.isCrumbClicked&&this.activeEditor){this.isCrumbClicked=false;var stateObj=this.mapping_crumb_children_state[this.state.activeCrumb];if(stateObj)this.activeEditor.setState(stateObj)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.props.onCloseHandler)this.props.onCloseHandler(this)}},{key:"render",value:function render(){var _this2=this;if(!this.tool){this.reset();return React.createElement("div",null)}var crumbStyle={alignItems:"center"};var editorFunction=this.mapping_crumb_renderFn[this.state.activeCrumb];var originalEditorUI=editorFunction(this.pushCrumb);var editorUI=React.cloneElement(originalEditorUI,{ref:function ref(e){if(typeof originalEditorUI.ref=="function"){var refFunction=originalEditorUI.ref;refFunction(e)}_this2.activeEditor=e}});var crumbUI=React.createElement("div",{className:"ui breadcrumb"},this.crumbOrder.map(function(crumb,index){var styleObj={};var elements=void 0;var label=crumb;if(_this2.state.activeCrumb==crumb&&_this2.crumbOrder.length>1){styleObj.color="black";elements=[React.createElement("div",{key:String(index),ref:String(index),style:styleObj,className:"active section",onClick:_this2.crumbClick.bind(_this2,crumb,index)},label)]}else{styleObj.color="grey";styleObj["cursor"]="pointer";elements=[React.createElement("div",{key:String(index),ref:String(index),style:styleObj,className:"section",onClick:_this2.crumbClick.bind(_this2,crumb,index)},label)]}if(_this2.crumbOrder.length>1&&index<_this2.crumbOrder.length-1)elements.push(React.createElement("i",{className:"right chevron icon divider"}));return elements}));var backButtonUI=null;if(this.crumbOrder.length>1){backButtonUI=React.createElement(Button,{onClick:this.stepBackInCrumbView},React.createElement("i",{className:"fa fa-chevron-left"}))}return React.createElement(VBox,{className:(0,_classnames2.default)(this.props.className),style:this.props.style,ref:_InteractiveTour2.default.getComponentRefCallback("Tool editor"),onMouseEnter:function onMouseEnter(){return _this2.forceUpdate()}},React.createElement(HBox,{className:"weave-ToolEditor-Header"},backButtonUI,React.createElement(HBox,{className:"weave-padded-hbox",style:crumbStyle},crumbUI),React.createElement("span",{style:{flex:"1"}}),React.createElement(Button,{onClick:this.openSessionStateEditor,title:"Edit session state"},React.createElement("i",{className:"fa fa-code"})),React.createElement(Button,{onClick:this.closeEditor,title:"Close editor"},"\u2715")),React.createElement(VBox,{style:{flex:1,padding:8,overflow:"auto"}},editorUI))}},{key:"tool",get:function get(){return this.toolWatcher.target},set:function set(value){this.toolWatcher.target=value}}]);return WeaveToolEditor}(React.Component);exports.default=WeaveToolEditor;

},{"react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/dialog/InteractiveTour":16,"weaveapp/editor/SessionStateEditor":42,"weaveapp/modules/classnames":61,"weavejs":136}],46:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _reactDropzone=require("weaveapp/modules/react-dropzone");var _reactDropzone2=_interopRequireDefault(_reactDropzone);var _InteractiveTour=require("weaveapp/dialog/InteractiveTour");var _InteractiveTour2=_interopRequireDefault(_InteractiveTour);var _DataMenu=require("weaveapp/menu/DataMenu");var _DataMenu2=_interopRequireDefault(_DataMenu);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Label=weavejs.ui.flexbox.Label;var List=weavejs.ui.List;var CenteredIcon=weavejs.ui.CenteredIcon;var LogComponent=weavejs.ui.LogComponent;var IDataSource=weavejs.api.data.IDataSource;var DataSourceManager=function(_React$Component){_inherits(DataSourceManager,_React$Component);function DataSourceManager(props){_classCallCheck(this,DataSourceManager);var _this=_possibleConstructorReturn(this,(DataSourceManager.__proto__||Object.getPrototypeOf(DataSourceManager)).call(this,props));_this.selectedIndex=0;_this.setSelectedDataSource=function(dataSource){_this.setState({selected:dataSource})};_this.handleDataFileDrop=function(file){var extension=file.name.split(".").pop();if(_this.props.fileMenu.getSupportedFileTypes(true).indexOf("."+extension)!=-1){_this.props.fileMenu.handleOpenedFile(file)}else{console.log("This data format is not supported yet")}};_this.state={rejected:false};return _this}_createClass(DataSourceManager,[{key:"componentDidMount",value:function componentDidMount(){this.props.weave.root.childListCallbacks.addGroupedCallback(this,this.updateDataSources,true)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.weave.root.childListCallbacks.removeCallback(this,this.updateDataSources)}},{key:"updateDataSources",value:function updateDataSources(){var _this2=this;var dataSources=this.props.weave.root.getObjects(IDataSource);dataSources.forEach(function(ds){_weavejs.Weave.getCallbacks(ds).addGroupedCallback(_this2,_this2.forceUpdate)});this.forceUpdate()}},{key:"getSelectedDataSource",value:function getSelectedDataSource(){var sources=this.props.weave.root.getObjects(IDataSource);var selected=this.state.selected;if(!selected||_weavejs.Weave.wasDisposed(selected)){this.selectedIndex=Math.max(0,Math.min(this.selectedIndex,sources.length-1));selected=sources[this.selectedIndex]}else{this.selectedIndex=sources.indexOf(selected)}return selected}},{key:"refreshDataSource",value:function refreshDataSource(dataSource){dataSource.hierarchyRefresh.triggerCallbacks();var root=this.props.weave.root;var name=root.getName(dataSource);if(name){var names=root.getNames();root.requestObjectCopy(name,dataSource);root.setNameOrder(names)}}},{key:"removeDataSource",value:function removeDataSource(dataSource){var root=this.props.weave.root;root.removeObject(root.getName(dataSource))}},{key:"render",value:function render(){var _this3=this;var root=this.props.weave.root;var listOptions=root.getObjects(IDataSource).map(function(dataSource){var icon="fa fa-fw "+(dataSource.isLocal?"fa-file-o":"fa-globe");var iconMessage=dataSource.isLocal?"Does not use remote resources.":"Uses remote resources.";return{label:React.createElement(HBox,{padded:true,style:{flex:1,alignItems:"center"}},React.createElement(CenteredIcon,{className:"",iconProps:{className:icon,title:_weavejs.Weave.lang(iconMessage)}}),React.createElement(Label,{style:{flex:1},children:dataSource.getLabel()}),React.createElement(CenteredIcon,{onClick:function onClick(){return _this3.refreshDataSource(dataSource)},iconProps:{className:"fa fa-refresh",title:_weavejs.Weave.lang("Refresh this datasource")}}),React.createElement(CenteredIcon,{onClick:function onClick(){return _this3.removeDataSource(dataSource)},iconProps:{className:"fa fa-times",title:_weavejs.Weave.lang("Delete this datasource")}})),value:dataSource}});var editorJsx=void 0;var dataSource=this.getSelectedDataSource();var editorStyle={flex:1};if(dataSource&&!_weavejs.Weave.wasDisposed(dataSource)){var EditorClass=_DataMenu2.default.editorRegistry.get(dataSource.constructor);if(EditorClass){editorJsx=React.createElement(VBox,{className:"weave-data-source-manager-editor",style:editorStyle},React.createElement(EditorClass,{dataSource:dataSource}))}else{_.merge(editorStyle,{justifyContent:"center",alignItems:"center"});editorJsx=React.createElement(VBox,{className:"weave-data-source-manager-editor",style:editorStyle},React.createElement("div",{className:"ui centered header"},_weavejs.Weave.lang("Editor not yet implemented for this data source type.")))}}else{_.merge(editorStyle,{justifyContent:"center",alignItems:"center",width:"100%",position:"relative",fontSize:"24px"});editorJsx=React.createElement("div",{style:{padding:"10px",display:"flex",flex:1}},React.createElement(_reactDropzone2.default,{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},className:"weave-dropzone-file",activeStyle:{border:"8px solid #CCC"},onDropAccepted:function onDropAccepted(files){files.forEach(function(file){_this3.handleDataFileDrop(file)});_this3.setState({rejected:false})},onDropRejected:function onDropRejected(files){_this3.setState({rejected:true})},accept:".csv,.geojson,.json,.txt,.tsv,.xls,.shp,.dbf",disableClick:false},React.createElement(VBox,{className:"weave-data-source-manager-editor",style:editorStyle},React.createElement("span",{className:"fa fa-files-o fa-th-large fa-5x"}),React.createElement(VBox,{style:{display:"flex",fontSize:"16px",padding:"15",alignItems:"center"}},"Drag and drop a data file to create a datasource"),this.state.rejected?React.createElement(LogComponent,{style:{left:"10px",top:"10px",right:"10px",flex:1,position:"absolute",fontSize:"medium"},header:_weavejs.Weave.lang("File Import Error"),messages:[_weavejs.Weave.lang("The specified file could not be imported. Only files with the following extensions are allowed: .csv, .tsv, .txt, .shp, .dbf, .geojson, .zip, .json")],clearFunc:function clearFunc(event){_this3.setState({rejected:false});event.stopPropagation()}}):null)))}return React.createElement(HBox,{className:"ui bottom attached segments",style:{flex:1},onMouseEnter:function onMouseEnter(){return _this3.forceUpdate()}},React.createElement(VBox,{style:{width:250},className:"weave-data-source-manager-sidebar"},React.createElement(VBox,{className:"ui vertical attached segments",style:{flex:1,justifyContent:"space-between",border:"none",borderRadius:0}},React.createElement(VBox,{className:"ui basic inverted segment",style:{flex:1,overflow:"auto",padding:0,border:"none",borderRadius:0}},React.createElement("div",{className:"ui medium header",style:{padding:0,paddingLeft:14,paddingTop:14}},_weavejs.Weave.lang("Connected data sources")),React.createElement(VBox,{style:{alignItems:listOptions.length?null:"center"}},listOptions.length?React.createElement(List,{options:listOptions,multiple:false,selectedValues:[dataSource],onChange:function onChange(selectedValues){_this3.setSelectedDataSource(selectedValues[0])}}):React.createElement("div",{className:"weave-list-item",style:{alignSelf:"flex-start",cursor:"default",pointerEvents:"none"}},_weavejs.Weave.lang("(None)")))),React.createElement(VBox,{className:"ui inverted segment",style:{overflow:"auto",padding:0,border:"none",borderRadius:0}},React.createElement("div",{className:"ui medium header",style:{paddingLeft:14,paddingTop:14}},_weavejs.Weave.lang("Add more data sources")),_DataMenu2.default.getDataSourceItems(this.props.weave,this.setSelectedDataSource).map(function(dsItem,index){return dsItem.shown?React.createElement(HBox,{key:index,ref:_InteractiveTour2.default.getComponentRefCallback(dsItem.label),onClick:function onClick(){dsItem.click();_InteractiveTour2.default.targetComponentOnClick(dsItem.label)},className:"weave-data-source-item",style:{justifyContent:"space-between",padding:5}},_weavejs.Weave.lang(dsItem.label),React.createElement(CenteredIcon,{className:"",iconProps:{className:"fa fa-plus"}})):null})))),editorJsx)}}]);return DataSourceManager}(React.Component);exports.default=DataSourceManager;

},{"lodash":"lodash","react":"react","weaveapp/dialog/InteractiveTour":16,"weaveapp/menu/DataMenu":54,"weaveapp/modules/react-dropzone":67,"weavejs":136}],47:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PanelDragEvent=exports.AbstractLayout=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SmartComponent=weavejs.ui.SmartComponent;var MiscUtils=weavejs.util.MiscUtils;var ReactUtils=weavejs.util.ReactUtils;var MouseUtils=weavejs.util.MouseUtils;var AbstractLayout=exports.AbstractLayout=function(_SmartComponent){_inherits(AbstractLayout,_SmartComponent);function AbstractLayout(){_classCallCheck(this,AbstractLayout);return _possibleConstructorReturn(this,(AbstractLayout.__proto__||Object.getPrototypeOf(AbstractLayout)).apply(this,arguments))}return AbstractLayout}(SmartComponent);exports.default=AbstractLayout;var PanelDragEvent=exports.PanelDragEvent=function(){function PanelDragEvent(){_classCallCheck(this,PanelDragEvent)}_createClass(PanelDragEvent,null,[{key:"hasPanelId",value:function hasPanelId(event){var types=event.dataTransfer.types;if(Array.isArray(types))return types.indexOf(PanelDragEvent.DRAG_DATA_TYPE)>=0;if(types&&types.contains)return types.contains(PanelDragEvent.DRAG_DATA_TYPE);console.error("Unexpected DragEvent.prototype.types value",event);return false}},{key:"setPanelId",value:function setPanelId(event,panelId){var instance=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var dt=event.dataTransfer;if(instance){var element=ReactUtils.getElement(instance);var offset=MouseUtils.getOffsetPoint(element);if(dt.setDragImage)dt.setDragImage(element,offset.x,offset.y)}dt.setData(PanelDragEvent.DRAG_DATA_TYPE,JSON.stringify(panelId))}},{key:"getPanelId",value:function getPanelId(event){try{var str=event.dataTransfer.getData(PanelDragEvent.DRAG_DATA_TYPE);return MiscUtils.normalizeStructure(JSON.parse(str),["string"])}catch(e){return null}}},{key:"getLayout",value:function getLayout(event,weave){var panelId=PanelDragEvent.getPanelId(event);var panel=weave.getObject(panelId);return ReactUtils.findComponent(panel,AbstractLayout)}}]);return PanelDragEvent}();PanelDragEvent.DRAG_DATA_TYPE="text/plain";

},{"weavejs":136}],48:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DropZone=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractLayout2=require("weaveapp/layout/AbstractLayout");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StandardLib=weavejs.util.StandardLib;var LinkableVariable=weavejs.core.LinkableVariable;var Div=weavejs.ui.Div;var WeaveComponentRenderer=weavejs.ui.WeaveComponentRenderer;var PanelOverlay=weavejs.ui.PanelOverlay;var MiscUtils=weavejs.util.MiscUtils;var MouseUtils=weavejs.util.MouseUtils;var ReactUtils=weavejs.util.ReactUtils;var DOMUtils=weavejs.util.DOMUtils;var Layout=weavejs.ui.layout.Layout;var HORIZONTAL=weavejs.ui.layout.DirectionTypes.HORIZONTAL;var VERTICAL=weavejs.ui.layout.DirectionTypes.VERTICAL;var ILinkableVariable=weavejs.api.core.ILinkableVariable;var DropZone=exports.DropZone=undefined;(function(DropZone){DropZone[DropZone["NONE"]=0]="NONE";DropZone[DropZone["LEFT"]=1]="LEFT";DropZone[DropZone["TOP"]=2]="TOP";DropZone[DropZone["RIGHT"]=3]="RIGHT";DropZone[DropZone["BOTTOM"]=4]="BOTTOM";DropZone[DropZone["CENTER"]=5]="CENTER"})(DropZone||(exports.DropZone=DropZone={}));;var OUTER_PANEL_ID=[];var structure_LayoutState={id:MiscUtils.nullableStructure(["string"]),children:null,flex:"number",direction:"string",maximized:"boolean"};structure_LayoutState.children=MiscUtils.nullableStructure([structure_LayoutState]);var structure_FlexibleLayoutState=_.merge({title:"string"},structure_LayoutState);var FlexibleLayout=function(_AbstractLayout){_inherits(FlexibleLayout,_AbstractLayout);function FlexibleLayout(props){_classCallCheck(this,FlexibleLayout);var _this=_possibleConstructorReturn(this,(FlexibleLayout.__proto__||Object.getPrototypeOf(FlexibleLayout)).call(this,props));_this.linkableState=_weavejs.Weave.linkableChild(_this,new LinkableVariable(null,null,_this.simplifyState({flex:1,title:""})),_this.forceUpdate,true);_this.dropZone=DropZone.NONE;_this.outerZoneThickness=16;_this.setSessionState=function(state){state=_this.simplifyState(MiscUtils.normalizeStructure(state,structure_FlexibleLayoutState));state.flex=1;_this.linkableState.state=state};_this.hideOverlay=function(){_this.dropZone=DropZone.NONE;var overlayStyle=_.clone(_this.overlay.state.style);overlayStyle.visibility="hidden";overlayStyle.left=overlayStyle.top=overlayStyle.width=overlayStyle.height=0;_this.overlay.setState({style:overlayStyle})};_this.onDragLeave=function(event){if(!MouseUtils.isMouseOver(ReactDOM.findDOMNode(_this),event.nativeEvent,false))_this.hideOverlay()};_this.onDragEnd=function(event){_this.hideOverlay()};_this.onMouseUp=function(event){_this.hideOverlay()};_this.repositionPanels=function(){var layout=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!layout)layout=_this.rootLayout;if(!layout)return;if(layout==_this.rootLayout)_this.layoutRect=Object(_this.getLayoutPosition(layout));var div=_this.refs[JSON.stringify(layout.state.id)];if(div instanceof Div){var rect=_this.getLayoutPosition(layout);if(rect)div.setState({style:{position:"absolute",display:"flex",top:rect.top,left:rect.left,width:rect.width,height:rect.height}});else div.setState({style:{display:"none"}})}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=layout.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;if(child)_this.repositionPanels(child)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}};_weavejs.WeaveAPI.Scheduler.frameCallbacks.addGroupedCallback(_this,_this.frameHandler,true);return _this}_createClass(FlexibleLayout,[{key:"getSessionState",value:function getSessionState(){return this.linkableState.state}},{key:"componentDidMount",value:function componentDidMount(){this.repositionPanels();var document=ReactUtils.getDocument(this);document.addEventListener("mouseup",this.onMouseUp)}},{key:"componentWillUnmount",value:function componentWillUnmount(){var document=ReactUtils.getDocument(this);document.removeEventListener("mouseup",this.onMouseUp)}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.repositionPanels()}},{key:"addPanel",value:function addPanel(id){var state=this.getSessionState();if(!state.id&&state.children&&!state.children.length){state={id:id}}else{var newFlex=state.children&&state.children.length?1/state.children.length:null;state={children:[state,{id:id,flex:newFlex}],direction:state.direction==HORIZONTAL?HORIZONTAL:VERTICAL}}this.setSessionState(state)}},{key:"removePanel",value:function removePanel(id){var state=this.getSessionState();var node=FlexibleLayout.findStateNode(state,id);if(node){delete node.id;node.children=[];this.setSessionState(state)}}},{key:"replacePanel",value:function replacePanel(id,newId){var state=this.getSessionState();var node=FlexibleLayout.findStateNode(state,id);if(node)node.id=newId;else console.error("Could not find id in this layout",id);this.setSessionState(state)}},{key:"maximizePanel",value:function maximizePanel(id,maximized){var state=this.getSessionState();var node=FlexibleLayout.findStateNode(state,id);if(node){node.maximized=maximized;this.setSessionState(state)}}},{key:"frameHandler",value:function frameHandler(){var rect=Object(this.getLayoutPosition(this.rootLayout));if(this.layoutRect.width!=rect.width||this.layoutRect.height!=rect.height)this.repositionPanels()}},{key:"onDragStart",value:function onDragStart(draggedId,event){var layout=this.rootLayout.getComponentFromId(draggedId);if(!layout)return;this.draggedId=draggedId;_AbstractLayout2.PanelDragEvent.setPanelId(event,draggedId,layout)}},{key:"onDragOver",value:function onDragOver(dragOverId,event){event.preventDefault();if(_.isEqual(dragOverId,OUTER_PANEL_ID)){var state=this.getSessionState();if(state.id||state.children&&state.children.length)return}if(!_AbstractLayout2.PanelDragEvent.hasPanelId(event))return;try{event.dataTransfer.dropEffect="move"}catch(e){}var dropZone;var _getDropZone=this.getDropZone(dragOverId);var _getDropZone2=_slicedToArray(_getDropZone,2);dropZone=_getDropZone2[0];dragOverId=_getDropZone2[1];if(_.isEqual(this.draggedId,dragOverId)){this.dragOverId=null;this.hideOverlay();return}if(this.dragOverId===dragOverId&&this.dropZone===dropZone)return;this.dragOverId=dragOverId;this.dropZone=dropZone;var rect=this.getLayoutPosition(dragOverId);var overlayStyle=_.clone(this.overlay.state.style);overlayStyle.visibility=rect?"visible":"hidden";if(rect){overlayStyle.left=rect.left;overlayStyle.top=rect.top;overlayStyle.width=rect.width;overlayStyle.height=rect.height}if(dropZone===DropZone.LEFT){overlayStyle.width=rect.width/2}else if(dropZone===DropZone.RIGHT){overlayStyle.left=rect.left+rect.width/2;overlayStyle.width=rect.width/2}else if(dropZone===DropZone.BOTTOM){overlayStyle.top=rect.top+rect.height/2;overlayStyle.height=rect.height/2}else if(dropZone===DropZone.TOP){overlayStyle.height=rect.height/2}this.overlay.setState({style:overlayStyle})}},{key:"getDropZone",value:function getDropZone(dragOverId){if(_.isEqual(dragOverId,OUTER_PANEL_ID))return[DropZone.CENTER,OUTER_PANEL_ID];var state=this.getSessionState();var node=FlexibleLayout.findStateNode(state,dragOverId);if(node&&node.maximized)return[DropZone.CENTER,dragOverId];var rootElement=ReactDOM.findDOMNode(this.rootLayout);var rootRect=rootElement.getBoundingClientRect();var panelElement=null;var event=MouseUtils.forComponent(this).mouseEvent;if(event.clientX<=rootRect.left+this.outerZoneThickness||event.clientX>=rootRect.left+rootRect.width-this.outerZoneThickness||event.clientY<=rootRect.top+this.outerZoneThickness||event.clientY>=rootRect.top+rootRect.height-this.outerZoneThickness){dragOverId=OUTER_PANEL_ID;panelElement=rootElement}else{panelElement=this.rootLayout.getElementFromId(dragOverId)}if(this.draggedId===dragOverId)return[DropZone.NONE,dragOverId];var rect=panelElement.getBoundingClientRect();var center={x:(rect.right-rect.left)/2,y:(rect.bottom-rect.top)/2};var delta={x:event.clientX-(rect.left+center.x),y:event.clientY-(rect.top+center.y)};var deltaNorm={x:delta.x/(rect.width/2),y:delta.y/(rect.height/2)};var polarNorm={r:Math.sqrt(deltaNorm.x*deltaNorm.x+deltaNorm.y*deltaNorm.y),theta:Math.atan2(deltaNorm.y,deltaNorm.x)};if(Math.abs(deltaNorm.x)<=.4&&Math.abs(deltaNorm.y)<=.4)return[DropZone.CENTER,dragOverId];var zoneIndex=Math.round(polarNorm.theta/(2*Math.PI)*4+4)%4;var dropZone=[DropZone.RIGHT,DropZone.BOTTOM,DropZone.LEFT,DropZone.TOP][zoneIndex];return[dropZone,dragOverId]}},{key:"simplifyState",value:function simplifyState(state){var topLevel=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!state)return{};if(state.id===undefined)delete state.id;if(state.children===undefined)delete state.children;if(!state.children){if(!state.id)state.children=[];return state}var simpleChildren=[];for(var i=0;i<state.children.length;i++){var child=this.simplifyState(state.children[i],false);if(child.children&&(child.direction===state.direction||!child.children.length)){var childChildren=child.children;for(var ii=0;ii<childChildren.length;ii++){var childChild=childChildren[ii];childChild.flex*=child.flex||1;simpleChildren.push(childChild)}}else if(child.children||child.id){simpleChildren.push(child)}}state.children=simpleChildren;var totalSizeChildren=_.sum(_.map(state.children,function(child){return child.flex}));for(var i=0;i<state.children.length;i++){state.children[i].flex=StandardLib.normalize(state.children[i].flex||1,0,totalSizeChildren)}if(state.children.length===1){var flex=state.flex;var title=state.title;state=this.simplifyState(state.children[0],false);state.flex=flex;if(topLevel)state.title=title}return state}},{key:"onDrop",value:function onDrop(dragOverId,event){var sourceLayout=_AbstractLayout2.PanelDragEvent.getLayout(event,_weavejs.Weave.getWeave(this));var srcId=_AbstractLayout2.PanelDragEvent.getPanelId(event);var destId=this.dragOverId;if(srcId&&sourceLayout)event.preventDefault();this.handlePanelDrop(sourceLayout,srcId,destId,this.dropZone);this.draggedId=null;this.hideOverlay()}},{key:"handlePanelDrop",value:function handlePanelDrop(sourceLayout,srcId,destId,dropZone){if(_.isEqual(destId,OUTER_PANEL_ID))destId=null;if(!srcId||dropZone===DropZone.NONE||_.isEqual(srcId,destId))return;var sourceFlexibleLayout=_weavejs.Weave.AS(sourceLayout,FlexibleLayout);var newState=_.cloneDeep(this.getSessionState());var newSourceState;if(sourceLayout==this){newSourceState=newState}else if(sourceFlexibleLayout){newSourceState=_.cloneDeep(sourceFlexibleLayout.getSessionState())}else if(sourceLayout){if(dropZone===DropZone.CENTER&&destId)sourceLayout.replacePanel(srcId,destId);else sourceLayout.removePanel(srcId)}var srcNode=newSourceState&&FlexibleLayout.findStateNode(newSourceState,srcId);var destNode=destId?FlexibleLayout.findStateNode(newState,destId):{};if(sourceFlexibleLayout&&!srcNode){console.error("Unexpected error = could not find source state node",srcId,newSourceState);return}if(!destNode){console.error("Unexpected error - could not find destination state node",destId,newState);return}if(dropZone===DropZone.CENTER){if(sourceFlexibleLayout)srcNode.id=destId;else if(sourceLayout)sourceLayout.removePanel(srcId);if(destId)destNode.id=srcId;else newState.id=srcId}else{if(_weavejs.WeaveAPI.Locale.reverseLayout){if(dropZone===DropZone.LEFT)dropZone=DropZone.RIGHT;else if(dropZone===DropZone.RIGHT)dropZone=DropZone.LEFT}if(srcNode)srcNode.id=null;destNode.direction=dropZone===DropZone.TOP||dropZone===DropZone.BOTTOM?VERTICAL:HORIZONTAL;if(destNode.id){delete destNode.id;destNode.children=[{id:srcId,flex:0.5},{id:destId,flex:0.5}]}else{newState.flex=0.5;destNode.children=[{id:srcId,flex:0.5},newState];newState=destNode}if(dropZone===DropZone.BOTTOM||dropZone===DropZone.RIGHT)destNode.children.reverse()}if(sourceFlexibleLayout&&sourceFlexibleLayout!=this)sourceFlexibleLayout.setSessionState(newSourceState);this.setSessionState(newState)}},{key:"getLayoutPosition",value:function getLayoutPosition(layoutOrId){if(_.isEqual(layoutOrId,OUTER_PANEL_ID))layoutOrId=this.rootLayout;if(!(layoutOrId instanceof Layout))layoutOrId=this.rootLayout.getComponentFromId(layoutOrId);var layout=layoutOrId;if(layout.state.maximized)layout=this.rootLayout;return DOMUtils.getOffsetRect(ReactDOM.findDOMNode(this),ReactDOM.findDOMNode(layout))}},{key:"getPanelIds",value:function getPanelIds(){return FlexibleLayout.getLeafNodes(this.getSessionState()).map(function(node){return node.id})}},{key:"render",value:function render(){var _this2=this;var weave=_weavejs.Weave.getWeave(this);var newState=this.getSessionState();var components=null;if(this.rootLayout){components=FlexibleLayout.getLeafNodes(newState).sort(FlexibleLayout.sortLeafNodes).map(function(node){var path=node.id;var key=JSON.stringify(path);return React.createElement("div",{key:key,onDragOver:_this2.onDragOver.bind(_this2,path),onDragStart:_this2.onDragStart.bind(_this2,path),onDrop:_this2.onDrop.bind(_this2,path)},React.createElement(Div,{ref:key,children:_this2.props.panelRenderer?_this2.props.panelRenderer(path,{maximized:node.maximized},_this2.props.panelRenderer):React.createElement(WeaveComponentRenderer,{weave:weave,path:path,style:{width:"100%",height:"100%"}})}))})}var layout=Layout.renderLayout({key:"layout",ref:function ref(layout){_this2.rootLayout=layout;if(layout)_this2.repositionPanels()},state:newState,onStateChange:this.setSessionState});var style=_.merge({flex:1},this.props.style,{display:"flex",position:"relative",overflow:"hidden"});return React.createElement("div",_extends({ref:ReactUtils.registerComponentRef(this)},this.props,{style:style,onDragOver:this.onDragOver.bind(this,OUTER_PANEL_ID),onDrop:this.onDrop.bind(this,OUTER_PANEL_ID),onDragLeave:this.onDragLeave,onDragEnd:this.onDragEnd}),layout,components,React.createElement(PanelOverlay,{ref:function ref(overlay){return _this2.overlay=overlay}}))}},{key:"title",get:function get(){return this.getSessionState().title}}],[{key:"findStateNode",value:function findStateNode(state,id){return MiscUtils.findDeep(state,function(node){return node&&_.isEqual(node.id,id)})}},{key:"getLeafNodes",value:function getLeafNodes(state,output){if(!output)output=[];if(state&&state.id)output.push(state);if(state&&state.children){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=state.children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var child=_step2.value;FlexibleLayout.getLeafNodes(child,output)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}return output}},{key:"sortLeafNodes",value:function sortLeafNodes(node1,node2){var value1=node1.maximized?1:0;var value2=node2.maximized?1:0;if(value1<value2)return-1;if(value1>value2)return 1;return 0}}]);return FlexibleLayout}(_AbstractLayout2.AbstractLayout);exports.default=FlexibleLayout;FlexibleLayout.WEAVE_INFO=_weavejs.Weave.setClassInfo(FlexibleLayout,{id:"weavejs.layout.FlexibleLayout",label:"Flexible Layout",interfaces:[ILinkableVariable]});

},{"lodash":"lodash","react":"react","react-dom":"react-dom","weaveapp/layout/AbstractLayout":47,"weavejs":136}],49:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _classnames=require("weaveapp/modules/classnames");var _classnames2=_interopRequireDefault(_classnames);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractLayout2=require("weaveapp/layout/AbstractLayout");var _InteractiveTour=require("weaveapp/dialog/InteractiveTour");var _InteractiveTour2=_interopRequireDefault(_InteractiveTour);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var WeaveComponentRenderer=weavejs.ui.WeaveComponentRenderer;var Tabs=weavejs.ui.Tabs;var HBox=weavejs.ui.flexbox.HBox;var ReactUtils=weavejs.util.ReactUtils;var MiscUtils=weavejs.util.MiscUtils;var CenteredIcon=weavejs.ui.CenteredIcon;var Dropdown=weavejs.ui.Dropdown;var LinkableVariable=weavejs.core.LinkableVariable;var LinkablePlaceholder=weavejs.core.LinkablePlaceholder;var ILinkableVariable=weavejs.api.core.ILinkableVariable;var StandardLib=weavejs.util.StandardLib;var stateStructure={tabs:[{id:MiscUtils.nullableStructure(["string"]),label:"string"}],activeTabIndex:"number",title:"string"};var TabLayout=function(_AbstractLayout){_inherits(TabLayout,_AbstractLayout);function TabLayout(props){_classCallCheck(this,TabLayout);var _this=_possibleConstructorReturn(this,(TabLayout.__proto__||Object.getPrototypeOf(TabLayout)).call(this,props));_this.linkableState=_weavejs.Weave.linkableChild(_this,new LinkableVariable(null,null,MiscUtils.normalizeStructure({},stateStructure)),_this.forceUpdate,true);_this.onDragOverTab=function(panel){};_this.onDrop=function(event){console.log("drop layout",event.dataTransfer.getData("text/plain"))};_this.onDragLeaveTab=function(){_this.resetTimer=true};_this.switchPanelToActive=function(indexFromTabsComponent){var state=_this.getSessionState();state.activeTabIndex=indexFromTabsComponent-_this.leadingTabsLength;_this.setSessionState(state);var tab=state.tabs[state.activeTabIndex];if(tab)_InteractiveTour2.default.targetComponentOnClick(tab.label)};return _this}_createClass(TabLayout,[{key:"getSessionState",value:function getSessionState(){return this.linkableState.state}},{key:"setSessionState",value:function setSessionState(state){this.linkableState.state=MiscUtils.normalizeStructure(state,stateStructure)}},{key:"maximizePanel",value:function maximizePanel(){}},{key:"getTabLabel",value:function getTabLabel(id){var state=this.getSessionState();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=state.tabs[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var tab=_step.value;if(_.isEqual(id,tab.id))return tab.label}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}},{key:"setTabLabel",value:function setTabLabel(id,newLabel){var state=this.getSessionState();var tabToRename=null;state.tabs.forEach(function(tab){if(_.isEqual(id,tab.id))tabToRename=tab});tabToRename.label=newLabel;this.setSessionState(state)}},{key:"getPanelIndex",value:function getPanelIndex(id){var panels=this.getSessionState().tabs;return _.findIndex(panels,function(panel){return _.isEqual(panel.id,id)})}},{key:"getPanelIds",value:function getPanelIds(){return this.getSessionState().tabs.map(function(tab){return tab.id})}},{key:"addPanel",value:function addPanel(id){var state=this.getSessionState();state.tabs.push({id:id,label:this.generateNextTabLabel()});state.activeTabIndex=this.getPanelIndex(id);this.setSessionState(state)}},{key:"generateNextTabLabel",value:function generateNextTabLabel(){var prefix=TabLayout.DEFAULT_TAB_PREFIX;var next=1;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=_weavejs.Weave.getDescendants(_weavejs.Weave.getRoot(this),TabLayout)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var tabLayout=_step2.value;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=tabLayout.getSessionState().tabs[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var tabState=_step3.value;if(tabState.label.indexOf(prefix)==0){var num=StandardLib.asNumber(tabState.label.substr(prefix.length));if(num>=next)next=Math.floor(num)+1}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return prefix+next}},{key:"removePanel",value:function removePanel(id){var state=this.getSessionState();var index=this.getPanelIndex(id);state.tabs=state.tabs.filter(function(panel){return!_.isEqual(id,panel.id)});if(index<state.activeTabIndex)state.activeTabIndex-=1;else if(index==state.activeTabIndex)state.activeTabIndex=Math.min(index,state.tabs.length-1);this.setSessionState(state)}},{key:"replacePanel",value:function replacePanel(id,newId){var tabState=null;var state=this.getSessionState();state.tabs.forEach(function(item){if(_.isEqual(id,item.id))tabState=item});if(tabState)tabState.id=newId;else console.error("Could not find id in this layout",id);this.setSessionState(state)}},{key:"render",value:function render(){var _this2=this;var weave=_weavejs.Weave.getWeave(this);var state=this.getSessionState();var plusIcon=null;var tabBarChildren=null;var leadingTabs=this.props.leadingTabs||[];if(this.props.onAdd){if(Array.isArray(this.props.onAdd)){plusIcon=React.createElement(Dropdown,{className:(0,_classnames2.default)("weave-layout-tabs-label","bottom"),style:{display:"flex"},menuGetter:function menuGetter(){return _this2.props.onAdd}},React.createElement("i",{className:(0,_classnames2.default)("fa fa-plus","weave-tab-icon"),title:_weavejs.Weave.lang("Add New...")}))}else{plusIcon=React.createElement(HBox,{className:(0,_classnames2.default)("weave-layout-tabs-label","bottom"),onClick:this.props.onAdd},React.createElement(CenteredIcon,{className:"weave-tab-icon",title:_weavejs.Weave.lang("Add New..."),iconProps:{className:"fa fa-plus"}}))}}tabBarChildren=React.createElement(HBox,{overflow:true,style:{justifyContent:"space-between"}},plusIcon);return React.createElement(HBox,{ref:ReactUtils.registerComponentRef(this),style:_.merge({},this.props.style,{flex:1})},React.createElement(Tabs,_extends({},this.props,{location:"bottom",tabContentClassName:"weave-layout-tabs-content",tabBarClassName:"weave-layout-tabs-bar",tabLabelClassName:"weave-layout-tabs-label",tabBarStyle:{whiteSpace:"nowrap"},labels:leadingTabs.map(function(tab){return tab.label}).concat(state.tabs.map(function(tab){return React.createElement(HBox,{className:"weave-padded-hbox",onDragOver:function onDragOver(){return _this2.onDragOverTab(tab)},onDragLeave:_this2.onDragLeaveTab,style:{alignItems:"center"},ref:_InteractiveTour2.default.getComponentRefCallback(tab.label)},tab.label,_this2.props.onRemove?React.createElement(CenteredIcon,{onClick:function onClick(event){event.stopPropagation();_this2.props.onRemove(tab.id)},className:"weave-tab-icon",title:_weavejs.Weave.lang("Close"),children:"\u2715"}):null)})),onViewChange:this.switchPanelToActive,onTabClick:function onTabClick(index,event){if(_this2.props.onTabClick){var tabIndex=index-leadingTabs.length;if(state.tabs&&state.tabs[tabIndex])_this2.props.onTabClick(state.tabs[tabIndex].id,event)}},onTabDoubleClick:function onTabDoubleClick(index,event){if(_this2.props.onTabDoubleClick){var tabIndex=index-leadingTabs.length;if(state.tabs&&state.tabs[tabIndex])_this2.props.onTabDoubleClick(state.tabs[tabIndex].id)}},activeTabIndex:leadingTabs.length+this.activeTabIndex,tabs:leadingTabs.map(function(tab){return tab.content}).concat(state.tabs.map(function(tab){return _this2.props.panelRenderer?_this2.props.panelRenderer(tab.id,{},_this2.props.panelRenderer):React.createElement(WeaveComponentRenderer,{weave:weave,path:tab.id,style:{flex:1}})})),tabBarChildren:tabBarChildren})))}},{key:"activeTabIndex",get:function get(){var state=this.getSessionState();return state.activeTabIndex==null?-this.leadingTabsLength:state.activeTabIndex},set:function set(index){var state=this.getSessionState();state.activeTabIndex=MiscUtils.normalizeStructure(index,"number");this.linkableState.state=state}},{key:"title",get:function get(){return this.getSessionState().title}},{key:"leadingTabsLength",get:function get(){return this.props.leadingTabs?this.props.leadingTabs.length:0}},{key:"activePanelId",get:function get(){var state=this.getSessionState();var activePanelState=state.tabs[state.activeTabIndex];if(activePanelState)return activePanelState.id}}],[{key:"mergeLayout",value:function mergeLayout(into,from){if(LinkablePlaceholder.getClass(into)!=TabLayout||LinkablePlaceholder.getClass(from)!=TabLayout){console.error("Unexpected parameters to mergeLayout: ",into,from);return}var intoState=MiscUtils.normalizeStructure(_weavejs.Weave.getState(into),stateStructure);var fromState=MiscUtils.normalizeStructure(_weavejs.Weave.getState(from),stateStructure);intoState.tabs=intoState.tabs.concat(fromState.tabs);_weavejs.Weave.setState(intoState,fromState)}},{key:"DEFAULT_TAB_PREFIX",get:function get(){return _weavejs.Weave.lang("Sheet ")}}]);return TabLayout}(_AbstractLayout2.AbstractLayout);exports.default=TabLayout;TabLayout.WEAVE_INFO=_weavejs.Weave.setClassInfo(TabLayout,{id:"weavejs.layout.TabLayout",label:"Tab Layout",interfaces:[ILinkableVariable]});

},{"lodash":"lodash","react":"react","weaveapp/dialog/InteractiveTour":16,"weaveapp/layout/AbstractLayout":47,"weaveapp/modules/classnames":61,"weavejs":136}],50:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _WeaveProperties=require("weaveapp/WeaveProperties");var _WeaveProperties2=_interopRequireDefault(_WeaveProperties);var _AbstractLayout=require("weaveapp/layout/AbstractLayout");var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var CenteredIcon=weavejs.ui.CenteredIcon;var PopupWindow=weavejs.ui.PopupWindow;var ReactUtils=weavejs.util.ReactUtils;var MouseUtils=weavejs.util.MouseUtils;var WeaveComponentRenderer=weavejs.ui.WeaveComponentRenderer;var SmartComponent=weavejs.ui.SmartComponent;var KeyboardUtils=weavejs.util.KeyboardUtils;var DynamicComponent=weavejs.ui.DynamicComponent;var WeaveTool=function(_SmartComponent){_inherits(WeaveTool,_SmartComponent);function WeaveTool(props){_classCallCheck(this,WeaveTool);var _this=_possibleConstructorReturn(this,(WeaveTool.__proto__||Object.getPrototypeOf(WeaveTool)).call(this,props));_this.handleTool=function(wcr){if(_this.watcher==wcr.watcher)return;_this.watcher=wcr.watcher;if(_this.watcher){_weavejs.Weave.getCallbacks(_this.watcher).addGroupedCallback(_this,_this.update)}_this.update()};_this.handleKeyDown=function(event){if(event.keyCode==KeyboardUtils.KEYCODES.TAB){if(ReactUtils.hasFocus(_this.lastIcon)||ReactUtils.hasFocus(_this)&&event.shiftKey){_this.setState({hovered:false})}}};_this.onGearClick=function(event){if(MouseUtils.receivedMouseDown(event.target))_this.handleGear()};_this.handleGear=function(){if(_this.props.onGearClick){_this.props.onGearClick(_this)}else if(_this.watcher&&_this.watcher.target&&_this.watcher.target.renderEditor){PopupWindow.open({context:_this,title:_weavejs.Weave.lang("Settings for {0}",_this.state.title),modal:false,content:_this.watcher.target.renderEditor()})}};_this.onMaximizeClick=function(event){if(MouseUtils.receivedMouseDown(event.target))_this.handleMaximize()};_this.handleMaximize=function(){var layout=ReactUtils.findComponent(_this,_AbstractLayout.AbstractLayout);if(layout)layout.maximizePanel(_this.props.path,!_this.props.maximized)};_this.onPopoutPopinClick=function(event){if(MouseUtils.receivedMouseDown(event.target))_this.handlePopoutPopin()};_this.handlePopoutPopin=function(){if(_this.props.onPopoutClick)_this.props.onPopoutClick(_this);if(_this.props.onPopinClick)_this.props.onPopinClick(_this)};_this.onCloseClick=function(event){if(MouseUtils.receivedMouseDown(event.target))_this.handleClose()};_this.handleClose=function(){var layout=ReactUtils.findComponent(_this,_AbstractLayout.AbstractLayout);if(layout){_this.props.weave.removeObject(_this.props.path);layout.removePanel(_this.props.path)}};_this.state={};return _this}_createClass(WeaveTool,[{key:"componentDidMount",value:function componentDidMount(){this.firstIcon=this.gearIcon;this.lastIcon=this.closeIcon;this.update()}},{key:"componentWillUnmount",value:function componentWillUnmount(){}},{key:"componentDidUpdate",value:function componentDidUpdate(){if(!MouseUtils.forComponent(this).mouseButtonDown)this.setState({dragging:false})}},{key:"update",value:function update(){this.updateTitle();this.updateCaption()}},{key:"updateTitle",value:function updateTitle(){var path=this.props.path;var title=this.watcher&&this.watcher.target?this.watcher.target.title:"";if(!title&&path)title=path[path.length-1];if(this.state.title!=title)this.setState({title:title})}},{key:"updateCaption",value:function updateCaption(){var tool=_weavejs.Weave.AS(this.watcher&&this.watcher.target,_IAltText2.default);if(tool){this.setState({showCaption:tool.altText.showAsCaption.value,caption:tool.altText.text.value||tool.getAutomaticDescription()})}}},{key:"renderTitleBar",value:function renderTitleBar(){var _this2=this;var showControls=this.state.hovered||this.state.dragging;var className="weave-tool-title-bar";if(showControls||this.state.highlightTitle)className="weave-tool-title-bar-hovered";if(this.state.highlightTitle)className+=" weave-tool-title-bar-highlighted";var maximizeClassName="fa fa-fw fa-"+(this.props.maximized?"compress":"expand");var maximizeTitleText=this.props.maximized?_weavejs.Weave.lang("Restore"):_weavejs.Weave.lang("Maximize");return React.createElement(HBox,{className:className,style:{alignItems:"center"},onDoubleClick:this.onMaximizeClick},React.createElement(HBox,{overflow:true,style:{display:showControls?"flex":"none"}},React.createElement(CenteredIcon,{ref:function ref(c){return _this2.gearIcon=c},title:_weavejs.Weave.lang("Configure"),onMouseUp:this.onGearClick,onClick:this.handleGear,iconProps:{className:"fa fa-cog fa-fw"}}),React.createElement("div",{style:{width:28,height:24}}),_weavejs.Weave.beta?React.createElement("div",{style:{width:28,height:24}}):null),React.createElement(HBox,{draggable:true,style:{flex:1,alignSelf:"stretch",cursor:"move",visibility:"visible",overflow:"hidden"}},React.createElement("p",{className:"weave-tool-title-bar-text",style:{width:"100%",padding:5,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis"}},_weavejs.Weave.lang(this.state.title))),React.createElement(HBox,{overflow:true,style:{display:showControls?"flex":"none",flexDirection:"row"}},React.createElement(CenteredIcon,{title:maximizeTitleText,onMouseUp:this.onMaximizeClick,onClick:this.handleMaximize,iconProps:{className:maximizeClassName}}),_weavejs.Weave.beta?React.createElement(CenteredIcon,{title:this.props.onPopoutClick?_weavejs.Weave.lang("Display in new window"):_weavejs.Weave.lang("Restore to main window"),onMouseUp:this.onPopoutPopinClick,onClick:this.handlePopoutPopin,iconProps:{className:this.props.onPopoutClick?"fa fa-external-link fa-fw":"fa fa-level-down fa-fw fa-rotate-90"}}):null,React.createElement(CenteredIcon,{ref:function ref(c){return _this2.closeIcon=c},title:_weavejs.Weave.lang("Close"),onMouseUp:this.onCloseClick,onClick:this.handleClose,iconProps:{className:"fa fa-times fa-fw"}})))}},{key:"renderCaption",value:function renderCaption(){return React.createElement(HBox,{style:{padding:20,overflow:"auto"},className:"weave-caption-border"},this.state.caption)}},{key:"render",value:function render(){var _this3=this;var ap=_WeaveProperties2.default.getProperties(this.props.weave).accessibility;return React.createElement(VBox,{style:this.props.style,className:"weave-tool","aria-label":_weavejs.Weave.lang("{0} Visualization",this.props.path[(this.props.path.length||0)-1]),tabIndex:0,onKeyDown:this.handleKeyDown,onMouseOver:function onMouseOver(){_this3.setState({hovered:true})},onMouseLeave:function onMouseLeave(){_this3.setState({hovered:false})},onFocus:function onFocus(){_this3.setState({hovered:true})},onDragStart:function onDragStart(){_this3.setState({dragging:true})}},React.createElement("div",null,this.renderTitleBar()),React.createElement(WeaveComponentRenderer,{ref:ReactUtils.onWillUpdateRef(this.handleTool),weave:this.props.weave,path:this.props.path,props:this.props.props}),React.createElement(DynamicComponent,{dependencies:[ap.enableAccessibilityFeatures,ap.enableCaptioning],render:function render(){var ap=_WeaveProperties2.default.getProperties(_this3.props.weave).accessibility;if(ap.enableAccessibilityFeatures.value&&ap.enableCaptioning&&_this3.state.showCaption)return React.createElement("div",{style:{maxHeight:"30%"}},_this3.renderCaption());else return null}}))}}]);return WeaveTool}(SmartComponent);exports.default=WeaveTool;

},{"react":"react","weaveapp/WeaveProperties":3,"weaveapp/api/ui/IAltText":10,"weaveapp/layout/AbstractLayout":47,"weavejs":136}],51:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractLayout2=require("weaveapp/layout/AbstractLayout");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ReactUtils=weavejs.util.ReactUtils;var DraggableDiv=weavejs.ui.DraggableDiv;var WeaveComponentRenderer=weavejs.ui.WeaveComponentRenderer;var Div=weavejs.ui.Div;var LinkableVariable=weavejs.core.LinkableVariable;var MouseUtils=weavejs.util.MouseUtils;var MiscUtils=weavejs.util.MiscUtils;var ILinkableVariable=weavejs.api.core.ILinkableVariable;var stateStructure={panels:[{id:MiscUtils.nullableStructure(["string"]),position:{left:"string",top:"string",width:"string",height:"string"},maximized:"boolean"}],title:"string"};var WindowLayout=function(_AbstractLayout){_inherits(WindowLayout,_AbstractLayout);function WindowLayout(props){_classCallCheck(this,WindowLayout);var _this=_possibleConstructorReturn(this,(WindowLayout.__proto__||Object.getPrototypeOf(WindowLayout)).call(this,props));_this.linkableState=_weavejs.Weave.linkableChild(_this,new LinkableVariable(null,null,MiscUtils.normalizeStructure({},stateStructure)),_this.forceUpdate,true);_this.onDrag=function(panelDragged,event){console.log("dragging",event)};_this.onDrop=function(event){var panelDragged=_AbstractLayout2.PanelDragEvent.getPanelId(event);var sourceLayout=_AbstractLayout2.PanelDragEvent.getLayout(event,_weavejs.Weave.getWeave(_this));if(panelDragged&&sourceLayout)event.preventDefault();if(sourceLayout&&sourceLayout!=_this){var offsetPoint=MouseUtils.getOffsetPoint(ReactDOM.findDOMNode(_this),event.nativeEvent);sourceLayout.removePanel(panelDragged);var state=_this.getSessionState();state.panels=state.panels.concat({id:panelDragged,position:{left:offsetPoint.x,top:offsetPoint.y,width:"50%",height:"50%"}});_this.setSessionState(state)}_this.hideOverlay()};_this.onDragLeave=function(event){if(!MouseUtils.isMouseOver(ReactDOM.findDOMNode(_this),event.nativeEvent,false))_this.hideOverlay()};_this.onDragEnd=function(event){_this.hideOverlay()};_this.onMouseUp=function(event){_this.hideOverlay()};_this.onDragOver=function(event){event.preventDefault();if(!_AbstractLayout2.PanelDragEvent.hasPanelId(event))return;event.dataTransfer.dropEffect="move";var offsetPoint=MouseUtils.getOffsetPoint(ReactDOM.findDOMNode(_this),event.nativeEvent);_this.overlay.setState({style:{position:"absolute",visibility:"visible",backgroundColor:"rgba(0, 0, 0, 0.2)",left:offsetPoint.x,top:offsetPoint.y,width:"50%",height:"50%",pointerEvents:"none"}})};_this.hideOverlay=function(){_this.overlay.setState({style:{}})};return _this}_createClass(WindowLayout,[{key:"setSessionState",value:function setSessionState(state){if(Array.isArray(state)){state={panels:state}}this.linkableState.state=MiscUtils.normalizeStructure(state,stateStructure)}},{key:"getSessionState",value:function getSessionState(){return this.linkableState.state}},{key:"componentDidMount",value:function componentDidMount(){var document=ReactUtils.getDocument(this);document.addEventListener("mouseup",this.onMouseUp)}},{key:"componentWillUnmount",value:function componentWillUnmount(){var document=ReactUtils.getDocument(this);document.removeEventListener("mouseup",this.onMouseUp)}},{key:"bringPanelForward",value:function bringPanelForward(id){var panelState=null;var state=this.getSessionState();var panels=state.panels.filter(function(item){if(_.isEqual(id,item.id)){panelState=item;return false}return true});if(!panelState)return;state.panels=panels;state.panels.push(panelState);this.setSessionState(state)}},{key:"onReposition",value:function onReposition(id,position){this.updatePanelState(id,{position:position})}},{key:"addPanel",value:function addPanel(id){var state=this.getSessionState();state.panels=state.panels.concat({id:id,position:WindowLayout.generatePosition()});this.setSessionState(state)}},{key:"replacePanel",value:function replacePanel(id,newId){var panelState=null;var state=this.getSessionState();state.panels.forEach(function(item){if(_.isEqual(id,item.id))panelState=item});if(panelState)panelState.id=newId;else console.error("Could not find id in this layout",id);this.setSessionState(state)}},{key:"removePanel",value:function removePanel(id){var state=this.getSessionState();state.panels=state.panels.filter(function(item){return!_.isEqual(id,item.id)});this.setSessionState(state)}},{key:"maximizePanel",value:function maximizePanel(id,maximized){this.updatePanelState(id,{maximized:maximized})}},{key:"getPanelIds",value:function getPanelIds(){return this.getSessionState().panels.map(function(panel){return panel.id})}},{key:"updatePanelState",value:function updatePanelState(id,diff){var state=this.getSessionState();state.panels=state.panels.map(function(item){return _.isEqual(item.id,id)?_.merge({},item,diff):item});this.setSessionState(state)}},{key:"onDragStart",value:function onDragStart(panelDragged,event){_AbstractLayout2.PanelDragEvent.setPanelId(event,panelDragged)}},{key:"render",value:function render(){var _this2=this;var weave=_weavejs.Weave.getWeave(this);var state=this.getSessionState();return React.createElement("div",_extends({ref:ReactUtils.registerComponentRef(this)},this.props,{onDragOver:this.onDragOver,onDrop:this.onDrop,onDragLeave:this.onDragLeave,onDragEnd:this.onDragEnd,style:_.merge({flex:1},this.props.style,{position:"relative",overflow:"hidden"})}),state.panels.map(function(state){var key=JSON.stringify(state.id);var style={left:0,top:0,width:"100%",height:"100%",minWidth:"5%",minHeight:"5%"};if(!state.maximized)_.merge(style,state.position);return React.createElement(DraggableDiv,{key:key,liveMoving:true,liveResizing:false,onDragStart:_this2.onDragStart.bind(_this2,state.id),onDrag:_this2.onDrag.bind(_this2,state.id),movable:!state.maximized,resizable:!state.maximized,getExternalOverlay:function getExternalOverlay(){return _this2.overlay},className:"weave-window",style:style,onMouseDown:function onMouseDown(event){return _this2.bringPanelForward(state.id)},draggable:!_this2.props.panelRenderer,onReposition:_this2.onReposition.bind(_this2,state.id)},_this2.props.panelRenderer?_this2.props.panelRenderer(state.id,{maximized:state.maximized},_this2.props.panelRenderer):React.createElement(WeaveComponentRenderer,{weave:weave,path:state.id}))}),React.createElement(Div,{ref:function ref(c){_this2.overlay=c},style:{position:"absolute",visibility:"hidden"}}))}},{key:"title",get:function get(){return this.getSessionState().title}}],[{key:"generatePosition",value:function generatePosition(){return{left:WindowLayout.fudgePercent(5,3),top:WindowLayout.fudgePercent(5,3),width:"50%",height:"50%"}}},{key:"fudgePercent",value:function fudgePercent(n,delta){return Math.round(n-delta+Math.random()*2*delta)+"%"}}]);return WindowLayout}(_AbstractLayout2.AbstractLayout);exports.default=WindowLayout;WindowLayout.WEAVE_INFO=_weavejs.Weave.setClassInfo(WindowLayout,{id:"weavejs.layout.WindowLayout",label:"Window Layout",interfaces:[ILinkableVariable]});

},{"lodash":"lodash","react":"react","react-dom":"react-dom","weaveapp/layout/AbstractLayout":47,"weavejs":136}],52:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");var _C3BarChart=require("weaveapp/tool/c3tool/C3BarChart");var _C3BarChart2=_interopRequireDefault(_C3BarChart);var _ColorLegend=require("weaveapp/tool/ColorLegend");var _ColorLegend2=_interopRequireDefault(_ColorLegend);var _C3Gauge=require("weaveapp/tool/c3tool/C3Gauge");var _C3Gauge2=_interopRequireDefault(_C3Gauge);var _C3ColorHistogram=require("weaveapp/tool/c3tool/C3ColorHistogram");var _C3ColorHistogram2=_interopRequireDefault(_C3ColorHistogram);var _C3Histogram=require("weaveapp/tool/c3tool/C3Histogram");var _C3Histogram2=_interopRequireDefault(_C3Histogram);var _C3LineChart=require("weaveapp/tool/c3tool/C3LineChart");var _C3LineChart2=_interopRequireDefault(_C3LineChart);var _C3XYLineChart=require("weaveapp/tool/c3tool/C3XYLineChart");var _C3XYLineChart2=_interopRequireDefault(_C3XYLineChart);var _DataMessageTool=require("weaveapp/tool/DataMessageTool");var _DataMessageTool2=_interopRequireDefault(_DataMessageTool);var _C3PieChart=require("weaveapp/tool/c3tool/C3PieChart");var _C3PieChart2=_interopRequireDefault(_C3PieChart);var _C3ScatterPlot=require("weaveapp/tool/c3tool/C3ScatterPlot");var _C3ScatterPlot2=_interopRequireDefault(_C3ScatterPlot);var _Sparkline=require("weaveapp/tool/Sparkline");var _Sparkline2=_interopRequireDefault(_Sparkline);var _TableTool=require("weaveapp/tool/TableTool");var _TableTool2=_interopRequireDefault(_TableTool);var _TextTool=require("weaveapp/tool/TextTool");var _TextTool2=_interopRequireDefault(_TextTool);var _OpenLayersMapTool=require("weaveapp/tool/oltool/OpenLayersMapTool");var _OpenLayersMapTool2=_interopRequireDefault(_OpenLayersMapTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ChartsMenu=function(){function ChartsMenu(owner){_classCallCheck(this,ChartsMenu);this.label="Charts";this.owner=owner}_createClass(ChartsMenu,[{key:"getCreateObjectItems",value:function getCreateObjectItems(){var _this=this;var registry=_weavejs.WeaveAPI.ClassRegistry;var impls=[_C3BarChart2.default,_ColorLegend2.default,_C3Gauge2.default,_C3ColorHistogram2.default,_C3Histogram2.default,_C3LineChart2.default,_C3XYLineChart2.default,_DataMessageTool2.default,_OpenLayersMapTool2.default,_C3PieChart2.default,_C3ScatterPlot2.default,_Sparkline2.default,_TableTool2.default,_TextTool2.default];return impls.map(function(impl){var label=_weavejs.Weave.lang(registry.getDisplayName(impl));if(ChartsMenu.isBeta(impl)){if(_weavejs.Weave.beta)label+=" (beta)";else return null}return{label:label,click:_this.owner.createObject.bind(_this,impl)}}).filter(function(item){return!!item})}},{key:"menu",get:function get(){return[].concat(this.getCreateObjectItems())}}],[{key:"isBeta",value:function isBeta(impl){return impl==_C3Gauge2.default||impl==_DataMessageTool2.default||impl==_C3XYLineChart2.default}}]);return ChartsMenu}();exports.default=ChartsMenu;

},{"weaveapp/tool/ColorLegend":72,"weaveapp/tool/DataMessageTool":74,"weaveapp/tool/Sparkline":76,"weaveapp/tool/TableTool":77,"weaveapp/tool/TextTool":78,"weaveapp/tool/c3tool/C3BarChart":80,"weaveapp/tool/c3tool/C3ColorHistogram":82,"weaveapp/tool/c3tool/C3Gauge":83,"weaveapp/tool/c3tool/C3Histogram":84,"weaveapp/tool/c3tool/C3LineChart":85,"weaveapp/tool/c3tool/C3PieChart":86,"weaveapp/tool/c3tool/C3ScatterPlot":87,"weaveapp/tool/c3tool/C3XYLineChart":88,"weaveapp/tool/oltool/OpenLayersMapTool":96,"weavejs":136}],53:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _ColorController=require("weaveapp/editor/ColorController");var _ColorController2=_interopRequireDefault(_ColorController);var _MouseoverController=require("weaveapp/editor/MouseoverController");var _MouseoverController2=_interopRequireDefault(_MouseoverController);var _AttributeMenuTool=require("weaveapp/tool/AttributeMenuTool");var _AttributeMenuTool2=_interopRequireDefault(_AttributeMenuTool);var _DataFilterTool=require("weaveapp/tool/DataFilterTool");var _DataFilterTool2=_interopRequireDefault(_DataFilterTool);var _SessionStateMenuTool=require("weaveapp/tool/SessionStateMenuTool");var _SessionStateMenuTool2=_interopRequireDefault(_SessionStateMenuTool);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PopupWindow=weavejs.ui.PopupWindow;var LinkableHashMap=weavejs.core.LinkableHashMap;var ControllersMenu=function(){function ControllersMenu(owner){var _this=this;_classCallCheck(this,ControllersMenu);this.label="Controllers";this.openColorController=PopupWindow.generateOpener(function(){return{context:_this.owner.context,title:_weavejs.Weave.lang("Color settings"),content:React.createElement(_ColorController2.default,{colorColumn:_this.owner.weave.getObject("defaultColorColumn")}),resizable:true,width:920,height:675}});this.openMouseOverController=PopupWindow.generateOpener(function(){return{context:_this.owner.context,title:_weavejs.Weave.lang("Mouseover settings"),content:React.createElement(_MouseoverController2.default,{probedHeaderColumns:_this.owner.weave.root.requestObject("Probe Header Columns",LinkableHashMap),probedColumns:_this.owner.weave.root.requestObject("Probed Columns",LinkableHashMap)}),resizable:true,width:920,height:675}});this.owner=owner}_createClass(ControllersMenu,[{key:"getCreateObjectItems",value:function getCreateObjectItems(){var _this2=this;var registry=_weavejs.WeaveAPI.ClassRegistry;var impls=registry.getImplementations(_IVisTool2.default);impls=[_AttributeMenuTool2.default,_DataFilterTool2.default,_SessionStateMenuTool2.default];return impls.map(function(impl){var label=_weavejs.Weave.lang(registry.getDisplayName(impl));if(ControllersMenu.isBeta(impl)){if(_weavejs.Weave.beta)label+=" (beta)";else return null}return{label:label,click:_this2.owner.createObject.bind(_this2,impl)}}).filter(function(item){return!!item})}},{key:"menu",get:function get(){return[].concat({label:_weavejs.Weave.lang("Color settings"),click:this.openColorController},{label:_weavejs.Weave.lang("Mouseover settings"),click:this.openMouseOverController},{},this.getCreateObjectItems())}}],[{key:"isBeta",value:function isBeta(impl){return impl==_SessionStateMenuTool2.default}}]);return ControllersMenu}();exports.default=ControllersMenu;

},{"react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/editor/ColorController":28,"weaveapp/editor/MouseoverController":39,"weaveapp/tool/AttributeMenuTool":71,"weaveapp/tool/DataFilterTool":73,"weaveapp/tool/SessionStateMenuTool":75,"weavejs":136}],54:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _filesaver=require("filesaver.js");var FileSaver=_interopRequireWildcard(_filesaver);var _WeaveDataSourceEditor=require("weaveapp/editor/WeaveDataSourceEditor");var _WeaveDataSourceEditor2=_interopRequireDefault(_WeaveDataSourceEditor);var _CSVDataSourceEditor=require("weaveapp/editor/CSVDataSourceEditor");var _CSVDataSourceEditor2=_interopRequireDefault(_CSVDataSourceEditor);var _DBFDataSourceEditor=require("weaveapp/editor/DBFDataSourceEditor");var _DBFDataSourceEditor2=_interopRequireDefault(_DBFDataSourceEditor);var _GeoJSONDataSourceEditor=require("weaveapp/editor/GeoJSONDataSourceEditor");var _GeoJSONDataSourceEditor2=_interopRequireDefault(_GeoJSONDataSourceEditor);var _CensusDataSourceEditor=require("weaveapp/editor/CensusDataSourceEditor");var _CensusDataSourceEditor2=_interopRequireDefault(_CensusDataSourceEditor);var _CKANDataSourceEditor=require("weaveapp/editor/CKANDataSourceEditor");var _CKANDataSourceEditor2=_interopRequireDefault(_CKANDataSourceEditor);var _CachedDataSourceEditor=require("weaveapp/editor/CachedDataSourceEditor");var _CachedDataSourceEditor2=_interopRequireDefault(_CachedDataSourceEditor);var _SpatialJoinTransform=require("weaveapp/data/source/SpatialJoinTransform");var _SpatialJoinTransform2=_interopRequireDefault(_SpatialJoinTransform);var _SpatialJoinTransformEditor=require("weaveapp/editor/SpatialJoinTransformEditor");var _SpatialJoinTransformEditor2=_interopRequireDefault(_SpatialJoinTransformEditor);var _ForeignDataMappingTransformEditor=require("weaveapp/editor/ForeignDataMappingTransformEditor");var _ForeignDataMappingTransformEditor2=_interopRequireDefault(_ForeignDataMappingTransformEditor);var _GroupedDataTransformEditor=require("weaveapp/editor/GroupedDataTransformEditor");var _GroupedDataTransformEditor2=_interopRequireDefault(_GroupedDataTransformEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var IDataSource=weavejs.api.data.IDataSource;var WeaveDataSource=weavejs.data.source.WeaveDataSource;var CSVDataSource=weavejs.data.source.CSVDataSource;var DBFDataSource=weavejs.data.source.DBFDataSource;var GeoJSONDataSource=weavejs.data.source.GeoJSONDataSource;var CensusDataSource=weavejs.data.source.CensusDataSource;var CKANDataSource=weavejs.data.source.CKANDataSource;var CachedDataSource=weavejs.data.source.CachedDataSource;var ForeignDataMappingTransform=weavejs.data.source.ForeignDataMappingTransform;var GroupedDataTransform=weavejs.data.source.GroupedDataTransform;var ReferencedColumn=weavejs.data.column.ReferencedColumn;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var DataTypes=weavejs.api.data.DataTypes;var IKeyFilter=weavejs.api.data.IKeyFilter;var ColumnUtils=weavejs.data.ColumnUtils;var JS=weavejs.util.JS;var DataMenu=function(){function DataMenu(owner){var _this=this;_classCallCheck(this,DataMenu);this.label="Data";this.getColumnsToExport=function(){var columnSet=new Set;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_weavejs.Weave.getDescendants(_this.owner.weave.root,ReferencedColumn)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var rc=_step.value;var col=rc.getInternalColumn();if(col&&col.getMetadata(ColumnMetadata.DATA_TYPE)!=DataTypes.GEOMETRY)columnSet.add(col)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return JS.toArray(columnSet.values())};this.exportCSV=function(){var columns=_this.getColumnsToExport();var filter=_weavejs.Weave.AS(_this.owner.weave.getObject("defaultSubsetKeyFilter"),IKeyFilter);var csv=ColumnUtils.generateTableCSV(columns,filter);FileSaver.saveAs(new Blob([csv]),"Weave-data-export.csv")};this.owner=owner}_createClass(DataMenu,[{key:"getExportItems",value:function getExportItems(){return[{enabled:this.getColumnsToExport().length>0,label:_weavejs.Weave.lang("Export CSV"),click:this.exportCSV}]}},{key:"menu",get:function get(){return[].concat({enabled:this.owner.enableDataManagerItem(),label:_weavejs.Weave.lang("Manage data..."),click:this.owner.openDataManager},{},this.getExportItems())}}],[{key:"getDataSourceItems",value:function getDataSourceItems(weave,onCreateItem){var registry=_weavejs.WeaveAPI.ClassRegistry;var impls=registry.getImplementations(IDataSource);impls=impls.filter(function(impl){return DataMenu.editorRegistry.has(impl)});var items=[];items=impls.map(function(impl){var label=_weavejs.Weave.lang(registry.getDisplayName(impl));return{get shown(){return _weavejs.Weave.beta||!DataMenu.isBeta(impl)},get label(){if(DataMenu.isBeta(impl))return label+" (beta)";return label},click:function click(){var baseName=_weavejs.WeaveAPI.ClassRegistry.getDisplayName(impl);var path=[weave.root.generateUniqueName(baseName)];var dataSource=weave.requestObject(path,impl);if(onCreateItem)onCreateItem(dataSource)}}});return items}},{key:"isBeta",value:function isBeta(impl){return impl==CensusDataSource||impl==GroupedDataTransform||impl==_SpatialJoinTransform2.default}}]);return DataMenu}();exports.default=DataMenu;DataMenu.editorRegistry=new Map().set(CSVDataSource,_CSVDataSourceEditor2.default).set(DBFDataSource,_DBFDataSourceEditor2.default).set(GeoJSONDataSource,_GeoJSONDataSourceEditor2.default).set(CensusDataSource,_CensusDataSourceEditor2.default).set(CKANDataSource,_CKANDataSourceEditor2.default).set(WeaveDataSource,_WeaveDataSourceEditor2.default).set(CachedDataSource,_CachedDataSourceEditor2.default).set(_SpatialJoinTransform2.default,_SpatialJoinTransformEditor2.default).set(ForeignDataMappingTransform,_ForeignDataMappingTransformEditor2.default).set(GroupedDataTransform,_GroupedDataTransformEditor2.default);

},{"filesaver.js":"filesaver.js","weaveapp/data/source/SpatialJoinTransform":12,"weaveapp/editor/CKANDataSourceEditor":22,"weaveapp/editor/CSVDataSourceEditor":23,"weaveapp/editor/CachedDataSourceEditor":25,"weaveapp/editor/CensusDataSourceEditor":26,"weaveapp/editor/DBFDataSourceEditor":31,"weaveapp/editor/ForeignDataMappingTransformEditor":34,"weaveapp/editor/GeoJSONDataSourceEditor":35,"weaveapp/editor/GroupedDataTransformEditor":36,"weaveapp/editor/SpatialJoinTransformEditor":43,"weaveapp/editor/WeaveDataSourceEditor":44,"weavejs":136}],55:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ExternalToolMenu=function(){function ExternalToolMenu(owner,tools){_classCallCheck(this,ExternalToolMenu);this.label="External Tools";this.owner=owner;this.tools=tools}_createClass(ExternalToolMenu,[{key:"menu",get:function get(){var _this=this;return this.tools.map(function(tool){return{label:Weave.lang(_weavejs.WeaveAPI.ClassRegistry.getDisplayName(tool)),click:_this.owner.createObject.bind(_this,tool)}})}}]);return ExternalToolMenu}();exports.default=ExternalToolMenu;

},{"weavejs":136}],56:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _filesaver=require("filesaver.js");var FileSaver=_interopRequireWildcard(_filesaver);var _WeaveProperties=require("weaveapp/WeaveProperties");var _WeaveProperties2=_interopRequireDefault(_WeaveProperties);var _FileDialog=require("weaveapp/dialog/FileDialog");var _FileDialog2=_interopRequireDefault(_FileDialog);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var PopupWindow=weavejs.ui.PopupWindow;var CheckBoxList=weavejs.ui.CheckBoxList;var Input=weavejs.ui.Input;var WeaveArchive=weavejs.core.WeaveArchive;var KeySet=weavejs.data.key.KeySet;var ILinkableCompositeObject=weavejs.api.core.ILinkableCompositeObject;var URLRequest=weavejs.net.URLRequest;var CSVDataSource=weavejs.data.source.CSVDataSource;var GeoJSONDataSource=weavejs.data.source.GeoJSONDataSource;var Admin=weavejs.net.Admin;var ProgressIndicator=_weavejs.WeaveAPI.ProgressIndicator;var FileMenu=function(){function FileMenu(owner){var _this=this;_classCallCheck(this,FileMenu);this.label="File";this.bold=false;this.openFileDialog=PopupWindow.generateOpener(function(){return{context:_this.owner.context,title:_weavejs.Weave.lang("Open a Weave Session"),content:React.createElement(_FileDialog2.default,{openHandler:_this.load,context:_this.owner.context,skipConfirmation:true}),footerContent:React.createElement("div",null),resizable:false,draggable:false,modal:true,suspendEnter:true,width:"95%",height:"95%"}});this.updateProgressIndicator=function(meta){if(!ProgressIndicator.hasTask(meta.currentFile)&&meta.percent<100)ProgressIndicator.addTask(meta.currentFile,null,"Extracting session "+meta.currentFile+": "+(meta.percent/100).toString());else if(meta.percent==100)ProgressIndicator.removeTask(meta.currentFile);else ProgressIndicator.updateTask(meta.currentFile,meta.percent/100)};this.openFile=function(e){var files=e.target.files;for(var i=0;i<files.length;i++){_this.handleOpenedFile(files[i])}};this.map_url_file=new Map;this.load=function(file_or_url){var pushHistory=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var url=typeof file_or_url==="string"?file_or_url:"";var file=_weavejs.Weave.AS(file_or_url,File)||_this.map_url_file.get(url);if(file)url="local://"+file.name;_this.fileName=String(url).split("/").pop();window.document.title=_this.fileName?_weavejs.Weave.lang("Weave: {0}",_this.fileName):_weavejs.Weave.lang("Weave");if(pushHistory)_this.pushHistory(url);if(file){_this.map_url_file.set(url,file);_this.handleOpenedFile(file)}else if(url){var fileName=_this.fileName;_weavejs.WeaveAPI.URLRequestUtils.request(_this.owner.weave.root,new URLRequest(url)).then(function(result){if(fileName==_this.fileName)_this.loadArchive(result)},function(result){if(fileName==_this.fileName)_WeaveProperties2.default.notify(_this.owner.weave,"error",_weavejs.Weave.lang("Failed to open file \"{0}\"",fileName))})}else{_this.newSession()}};this.handleHistoryEvent=function(event){_this.load(event.state,false)};this.newSession=function(){var weave=_this.owner.weave;weave.root.setSessionState([],true);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_weavejs.Weave.getDescendants(weave.root,ILinkableCompositeObject)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var ilco=_step.value;ilco.setSessionState([],true)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=_weavejs.Weave.getDescendants(weave.root,KeySet)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var keySet=_step2.value;keySet.clearKeys()}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}weave.history.clearHistory();_this.archive=null};this.handleOpenedFile=function(file){var dataFilesOnly=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var reader=new FileReader;reader.onload=function(event){_this.handleOpenedFileContent(file.name,new Uint8Array(reader.result),dataFilesOnly)};reader.readAsArrayBuffer(file)};this._saveToServer=function(newFileName){var overwrite=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var promise=WeaveArchive.serialize(_this.owner.weave,_this.updateProgressIndicator);promise.then(function(result){Admin.service.saveWeaveFileByteArray(result,newFileName,overwrite);_WeaveProperties2.default.notify(_this.owner.weave,"success",_weavejs.Weave.lang("Session saved to server"))},function(error){console.error(error);_WeaveProperties2.default.notify(_this.owner.weave,"error",_weavejs.Weave.lang("Failed to save session to server"))})};this.saveToServer=function(){_this.saveDialog(_this.fileName,_this._saveToServer)};this._saveFile=function(newFilename){var promise=WeaveArchive.serialize(_this.owner.weave,_this.updateProgressIndicator);promise.then(function(result){var arrayBuffer=result.buffer;FileSaver.saveAs(new Blob([arrayBuffer]),newFilename)})};this.saveFile=function(){_this.saveDialog(_this.fileName,_this._saveFile)};this.owner=owner}_createClass(FileMenu,[{key:"getSessionItems",value:function getSessionItems(){var _this2=this;return[{label:"Open Session...",click:this.openFileDialog},{label:_weavejs.Weave.lang("Save session as..."),click:this.saveFile},{label:_weavejs.Weave.lang("Save to server"),click:function click(){_this2.owner.login.conditionalOpen(_this2.saveToServer)},shown:Admin.service.initialized}]}},{key:"saveDialog",value:function saveDialog(fileName,onSave){var _this3=this;function dropExtension(fileName){if(!fileName)fileName="";var i=fileName.lastIndexOf(".weave");return i<0?fileName:fileName.substr(0,i)}var defaultFileName="defaults.weave";var filenameInput;if(!this.fileName)this.fileName=defaultFileName;var setShowTopMenuBar=function setShowTopMenuBar(checked){_WeaveProperties2.default.getProperties(_this3.owner.weave).enableMenuBar.value=checked};var setSaveHistory=function setSaveHistory(checked){};var checkboxListOptions=[{value:setShowTopMenuBar,label:_weavejs.Weave.lang("Show top menu bar")}];var allOptions=checkboxListOptions.map(function(opt){return opt.value});var selectedOptions=allOptions;var onOk=function onOk(){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=allOptions[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var option=_step3.value;option.call(_this3,selectedOptions.indexOf(option)>=0)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}onSave(filenameInput.value&&filenameInput.value+".weave"||defaultFileName)};PopupWindow.open({context:this.owner.context,title:_weavejs.Weave.lang("Export session state"),content:React.createElement(VBox,{style:{width:400,height:200,padding:20}},React.createElement("span",null,_weavejs.Weave.lang("Enter a file name:")),React.createElement(HBox,{style:{alignItems:"center",marginTop:10}},React.createElement(Input,{type:"text",style:{flex:1},ref:function ref(c){if(c&&c.inputElement){filenameInput=c.inputElement;c.inputElement.select();c.inputElement;c.inputElement.focus()}},placeholder:dropExtension(defaultFileName),defaultValue:dropExtension(fileName)}),".weave"),React.createElement("span",{style:{marginTop:5}},_weavejs.Weave.lang("Export options:")),React.createElement(VBox,{style:{marginLeft:20,marginTop:5,flex:1}},React.createElement(CheckBoxList,{options:checkboxListOptions,selectedValues:selectedOptions,labelPosition:"right",onChange:function onChange(newValues){return selectedOptions=newValues}})),React.createElement(HBox,null)),resizable:false,modal:true,onOk:onOk})}},{key:"getSupportedFileTypes",value:function getSupportedFileTypes(){var dataFilesOnly=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var types=[".csv",".tsv",".txt",".shp",".dbf",".geojson",".zip",".json"];if(!dataFilesOnly)types.unshift(".weave");return types}},{key:"pushHistory",value:function pushHistory(url){window.history.pushState(url,"",FileMenu.buildUrl(url));window.onpopstate=this.handleHistoryEvent}},{key:"loadArchive",value:function loadArchive(fileContent){var _this4=this;WeaveArchive.deserialize(fileContent,this.updateProgressIndicator).then(function(archive){_this4.archive=archive;archive.setSessionFromArchive(_this4.owner.weave);_this4.owner.onFileLoaded()})}},{key:"handleOpenedFileContent",value:function handleOpenedFileContent(fileName,fileContent){var _this5=this;var dataFilesOnly=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var ext=String(fileName.split(".").pop()).toLowerCase();var dataSource;if(!dataFilesOnly&&ext=="weave"){this.loadArchive(fileContent);return}var newDataSource=function newDataSource(type){return dataSource=_this5.owner.weave.root.requestObject(fileName,type,false)};var getFileUrl=function getFileUrl(){return _weavejs.WeaveAPI.URLRequestUtils.saveLocalFile(_this5.owner.weave.root,fileName,fileContent)};if(ext=="tsv"||ext=="txt"){}else if(ext=="csv"){dataSource=newDataSource(CSVDataSource);dataSource.url.value=getFileUrl();dataSource.keyType.value=fileName}else if(ext=="xls"){}else if(ext=="geojson"||ext=="json"){dataSource=newDataSource(GeoJSONDataSource);dataSource.url.value=getFileUrl();dataSource.keyType.value=fileName}}},{key:"findDataSource",value:function findDataSource(type,filter){var create=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var weave=this.owner.weave;var results=_weavejs.Weave.getDescendants(weave.root,type).filter(filter);var ds=results[0];if(!ds&&create)return weave.root.requestObject("",type);return results[0]}},{key:"menu",get:function get(){return[].concat(this.getSessionItems(),{},this.owner.dataMenu.getExportItems())}}]);return FileMenu}();exports.default=FileMenu;FileMenu.buildBaseUrl=function(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+(""+window.location.pathname)};FileMenu.buildUrl=function(url){return FileMenu.buildBaseUrl()+("?file="+url)};

},{"filesaver.js":"filesaver.js","react":"react","weaveapp/WeaveProperties":3,"weaveapp/dialog/FileDialog":14,"weavejs":136}],57:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PopupWindow=weavejs.ui.PopupWindow;var Admin=weavejs.net.Admin;var SystemMenu=function(){function SystemMenu(owner){_classCallCheck(this,SystemMenu);this.label="Weave";this.bold=true;this.owner=owner}_createClass(SystemMenu,[{key:"menu",get:function get(){var _this=this;var items=[];if(!this.owner.showFileMenu)items=items.concat(this.owner.fileMenu.getSessionItems(),{});items.push({label:"Visit iweave.com",click:function click(){return window.open("http://www.iweave.com/")}},{label:"Report a problem",click:function click(){return window.open("http://github.com/WeaveTeam/WeaveJS/issues/new")}},{},{label:_weavejs.Weave.beta?"Disable beta features":"Enable beta features",click:function click(){return _weavejs.Weave.beta=!_weavejs.Weave.beta}},{},{enabled:false,label:"Version: 2.1"},{},{label:Admin.instance.userHasAuthenticated?_weavejs.Weave.lang("Signed in as {0}",Admin.instance.activeConnectionName):_weavejs.Weave.lang("Sign in..."),click:this.owner.login.open,shown:Admin.service.initialized},{enabled:Admin.instance.userHasAuthenticated,label:_weavejs.Weave.lang("Sign out"),shown:Admin.service.initialized,click:function click(){var signedOutPopup=function signedOutPopup(){return PopupWindow.open({context:_this.owner.context,title:"Confirmation",content:React.createElement("div",null,_weavejs.Weave.lang("Signed out successfully"))})};Admin.service.authenticate("","").then(signedOutPopup,signedOutPopup)}});return items}}]);return SystemMenu}();exports.default=SystemMenu;

},{"react":"react","weavejs":136}],58:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _WeaveProperties=require("weaveapp/WeaveProperties");var _WeaveProperties2=_interopRequireDefault(_WeaveProperties);var _SessionHistorySlider=require("weaveapp/editor/SessionHistorySlider");var _SessionHistorySlider2=_interopRequireDefault(_SessionHistorySlider);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MenuBar=weavejs.ui.menu.MenuBar;var DynamicComponent=weavejs.ui.DynamicComponent;var WeaveMenuBar=function(_React$Component){_inherits(WeaveMenuBar,_React$Component);function WeaveMenuBar(props){_classCallCheck(this,WeaveMenuBar);return _possibleConstructorReturn(this,(WeaveMenuBar.__proto__||Object.getPrototypeOf(WeaveMenuBar)).call(this,props))}_createClass(WeaveMenuBar,[{key:"render",value:function render(){var _this2=this;var enableSessionHistorySlider=_WeaveProperties2.default.getProperties(this.props.weave).showSessionHistorySlider;var enableSessionHistoryControls=_WeaveProperties2.default.getProperties(this.props.weave).enableSessionHistoryControls;return React.createElement(MenuBar,{style:this.props.style,config:this.props.menus.getMenuList()},React.createElement(DynamicComponent,{dependencies:[enableSessionHistoryControls,enableSessionHistorySlider],render:function render(){return enableSessionHistoryControls.value?React.createElement(_SessionHistorySlider2.default,{key:"historySlider",stateLog:_this2.props.weave.history,showSlider:enableSessionHistorySlider.value}):null}}))}}]);return WeaveMenuBar}(React.Component);exports.default=WeaveMenuBar;

},{"react":"react","weaveapp/WeaveProperties":3,"weaveapp/editor/SessionHistorySlider":41,"weavejs":136}],59:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _ServiceLogin=require("weaveapp/admin/ServiceLogin");var _ServiceLogin2=_interopRequireDefault(_ServiceLogin);var _SystemMenu=require("weaveapp/menu/SystemMenu");var _SystemMenu2=_interopRequireDefault(_SystemMenu);var _FileMenu=require("weaveapp/menu/FileMenu");var _FileMenu2=_interopRequireDefault(_FileMenu);var _ChartsMenu=require("weaveapp/menu/ChartsMenu");var _ChartsMenu2=_interopRequireDefault(_ChartsMenu);var _DataMenu=require("weaveapp/menu/DataMenu");var _DataMenu2=_interopRequireDefault(_DataMenu);var _ControllersMenu=require("weaveapp/menu/ControllersMenu");var _ControllersMenu2=_interopRequireDefault(_ControllersMenu);var _ExternalToolMenu=require("weaveapp/menu/ExternalToolMenu");var _ExternalToolMenu2=_interopRequireDefault(_ExternalToolMenu);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Admin=weavejs.net.Admin;var WeaveMenus=function(){function WeaveMenus(context,weave,createObject,onFileLoaded,openDataManager,enableDataManagerItem,externalTools){_classCallCheck(this,WeaveMenus);this.context=context;this.weave=weave;this.createObject=createObject;this.onFileLoaded=onFileLoaded;this.openDataManager=openDataManager;this.enableDataManagerItem=enableDataManagerItem;Admin.service.getAuthenticatedUser().then(_.noop,_.noop);this.login=new _ServiceLogin2.default(context,Admin.service);this.fileMenu=new _FileMenu2.default(this);this.systemMenu=new _SystemMenu2.default(this);this.chartsMenu=new _ChartsMenu2.default(this);this.dataMenu=new _DataMenu2.default(this);this.controllersMenu=new _ControllersMenu2.default(this);this.externalToolMenu=_.isArray(externalTools)&&externalTools.length?new _ExternalToolMenu2.default(this,externalTools):null}_createClass(WeaveMenus,[{key:"getMenuList",value:function getMenuList(){var menuList=[this.systemMenu];if(this.showFileMenu)menuList.push(this.fileMenu);else menuList.push(this.dataMenu);menuList.push(this.chartsMenu,this.controllersMenu);if(this.externalToolMenu)menuList.push(this.externalToolMenu);return menuList}}]);return WeaveMenus}();exports.default=WeaveMenus;

},{"lodash":"lodash","weaveapp/admin/ServiceLogin":8,"weaveapp/menu/ChartsMenu":52,"weaveapp/menu/ControllersMenu":53,"weaveapp/menu/DataMenu":54,"weaveapp/menu/ExternalToolMenu":55,"weaveapp/menu/FileMenu":56,"weaveapp/menu/SystemMenu":57,"weavejs":136}],60:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _reactNotificationSystem=require("react-notification-system");var ns=_interopRequireWildcard(_reactNotificationSystem);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=ns.default;

},{"react-notification-system":"react-notification-system"}],61:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classnames=require("classnames");var classnames=_interopRequireWildcard(_classnames);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=classnames.default;

},{"classnames":135}],62:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _clipboard=require("clipboard");var Clipboard=_interopRequireWildcard(_clipboard);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=Clipboard.default;

},{"clipboard":"clipboard"}],63:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jquery=require("jquery");var jquery=_interopRequireWildcard(_jquery);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=jquery.default;

},{"jquery":"jquery"}],64:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jszip=require("jszip");var jszip=_interopRequireWildcard(_jszip);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=jszip.default;

},{"jszip":"jszip"}],65:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _proj=require("proj4");var proj4=_interopRequireWildcard(_proj);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=proj4.default;

},{"proj4":"proj4"}],66:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _reactCodemirror=require("react-codemirror");var ReactCodeMirror=_interopRequireWildcard(_reactCodemirror);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=ReactCodeMirror.default;

},{"react-codemirror":"react-codemirror"}],67:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _reactDropzone=require("react-dropzone");var Dropzone=_interopRequireWildcard(_reactDropzone);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default=Dropzone.default;

},{"react-dropzone":"react-dropzone"}],68:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require('weavejs');var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var Weave=weavejs.Weave;var LinkableBoolean=weavejs.core.LinkableBoolean;var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var SolidFillStyle=function(){function SolidFillStyle(){_classCallCheck(this,SolidFillStyle);this.enable=Weave.linkableChild(this,new LinkableBoolean(true));this.color=Weave.linkableChild(this,new AlwaysDefinedColumn(NaN));this.alpha=Weave.linkableChild(this,new AlwaysDefinedColumn(1))}_createClass(SolidFillStyle,[{key:'beginFillStyle',value:function beginFillStyle(key,graphics){var style=this.getStyle(key);graphics.beginFill(style.color,style.alpha)}},{key:'getStyle',value:function getStyle(key){return{'color':this.color.getValueFromKey(key,Number),'alpha':this.alpha.getValueFromKey(key,Number)}}},{key:'recordFormat',get:function get(){return{'color':this.color,'alpha':this.alpha}}},{key:'recordType',get:function get(){return{'color':Number,'alpha':Number}}}]);return SolidFillStyle}();exports.default=SolidFillStyle;SolidFillStyle.WEAVE_INFO=Weave.setClassInfo(SolidFillStyle,{id:'weavejs.plot.SolidFillStyle',deprecatedIds:['ExtendedFillStyle']});

},{"weavejs":136}],69:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require('weavejs');var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var LinkableBoolean=weavejs.core.LinkableBoolean;var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var NormalizedColumn=weavejs.data.column.NormalizedColumn;var EquationColumnLib=weavejs.data.EquationColumnLib;var SolidLineStyle=function(){function SolidLineStyle(){_classCallCheck(this,SolidLineStyle);this._triggerCounter=0;this.map_column_dataType=new Map;this.map_column_defaultValue=new Map;this.enable=Weave.linkableChild(this,new LinkableBoolean(true));this.color=this.createColumn(Number,0);this.weight=this.createColumn(Number,1);this.alpha=this.createColumn(Number,0.5);this.caps=this.createColumn(String,null);this.joints=this.createColumn(String,null);this.miterLimit=this.createColumn(Number,3);this._callbackCollection=Weave.getCallbacks(this);this.weight.internalDynamicColumn.requestLocalObject(NormalizedColumn,true);this.normalizedWeightColumn.min.value=1;this.normalizedWeightColumn.max.value=5}_createClass(SolidLineStyle,[{key:'createColumn',value:function createColumn(dataType,defaultValue){var column=Weave.linkableChild(this,AlwaysDefinedColumn);this.map_column_dataType.set(column,dataType);column.defaultValue.state=defaultValue;return column}},{key:'beginLineStyle',value:function beginLineStyle(key,graphics){var style=this.getStyle(key);graphics.lineStyle(style.weight,style.color,style.alpha)}},{key:'getStyle',value:function getStyle(key){if(this._triggerCounter!=this._callbackCollection.triggerCounter){this._triggerCounter=this._callbackCollection.triggerCounter;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.map_column_dataType.keys()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var col=_step.value;var column=col;if(column.getInternalColumn()!=null)this.map_column_defaultValue.delete(column);else this.map_column_defaultValue.set(column,EquationColumnLib.cast(column.defaultValue.state,this.map_column_dataType.get(column)))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.map_key_style=new WeakMap}var params=this.map_key_style.get(key);if(params)return params;var _color=this.map_column_defaultValue.get(this.color);var _weight=this.map_column_defaultValue.get(this.weight);var _alpha=this.map_column_defaultValue.get(this.alpha);var _caps=this.map_column_defaultValue.get(this.caps);var _joints=this.map_column_defaultValue.get(this.joints);var _miterLimit=this.map_column_defaultValue.get(this.miterLimit);var lineColor=_color!==undefined?_color:this.color.getValueFromKey(key,Number);var lineWeight=_weight!==undefined?_weight:this.weight.getValueFromKey(key,Number);var lineAlpha=_alpha!==undefined?_alpha:this.alpha.getValueFromKey(key,Number);var lineCaps=_caps!==undefined?_caps:this.caps.getValueFromKey(key,String)||null;var lineJoints=_joints!==undefined?_joints:this.joints.getValueFromKey(key,String)||null;var lineMiterLimit=_miterLimit!==undefined?_miterLimit:this.miterLimit.getValueFromKey(key,Number);params={'color':lineColor,'weight':lineWeight,'alpha':lineAlpha,'caps':lineCaps,'joints':lineJoints,'miterLimit':lineMiterLimit};this.map_key_style.set(key,params);return params}},{key:'normalizedWeightColumn',get:function get(){return Weave.AS(this.weight.getInternalColumn(),NormalizedColumn)}},{key:'recordFormat',get:function get(){return{'color':this.color,'weight':this.weight,'alpha':this.alpha,'caps':this.caps,'joints':this.joints,'miterLimit':this.miterLimit}}},{key:'recordType',get:function get(){return{'color':Number,'weight':Number,'alpha':Number,'caps':String,'joints':String,'miterLimit':Number}}}]);return SolidLineStyle}();exports.default=SolidLineStyle;SolidLineStyle.WEAVE_INFO=Weave.setClassInfo(SolidLineStyle,{id:'weavejs.plot.SolidLineStyle',deprecatedIds:['ExtendedLineStyle']});

},{"weavejs":136}],70:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.OverrideBounds=exports.Margin=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Menu=weavejs.ui.menu.Menu;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var MiscUtils=weavejs.util.MiscUtils;var Accordion=weavejs.ui.Accordion;var KeySet=weavejs.data.key.KeySet;var LinkableNumber=weavejs.core.LinkableNumber;var LinkableString=weavejs.core.LinkableString;var FilteredKeySet=weavejs.data.key.FilteredKeySet;var DynamicKeyFilter=weavejs.data.key.DynamicKeyFilter;var ColumnUtils=weavejs.data.ColumnUtils;var StatefulTextArea=weavejs.ui.StatefulTextArea;var Checkbox=weavejs.ui.Checkbox;var JS=weavejs.util.JS;var Margin=exports.Margin=function Margin(){_classCallCheck(this,Margin);this.top=_weavejs.Weave.linkableChild(this,new LinkableNumber(20));this.bottom=_weavejs.Weave.linkableChild(this,new LinkableNumber(100));this.left=_weavejs.Weave.linkableChild(this,new LinkableNumber(100));this.right=_weavejs.Weave.linkableChild(this,new LinkableNumber(20))};Margin.WEAVE_INFO=_weavejs.Weave.setClassInfo(Margin,{id:"weavejs.tool.Margin"});var OverrideBounds=exports.OverrideBounds=function OverrideBounds(){_classCallCheck(this,OverrideBounds);this.xMin=_weavejs.Weave.linkableChild(this,LinkableNumber);this.yMin=_weavejs.Weave.linkableChild(this,LinkableNumber);this.xMax=_weavejs.Weave.linkableChild(this,LinkableNumber);this.yMax=_weavejs.Weave.linkableChild(this,LinkableNumber)};OverrideBounds.WEAVE_INFO=_weavejs.Weave.setClassInfo(OverrideBounds,{id:"weavejs.tool.OverrideBounds"});var AbstractVisTool=function(_React$Component){_inherits(AbstractVisTool,_React$Component);function AbstractVisTool(props){_classCallCheck(this,AbstractVisTool);var _this=_possibleConstructorReturn(this,(AbstractVisTool.__proto__||Object.getPrototypeOf(AbstractVisTool)).call(this,props));_this.panelTitle=_weavejs.Weave.linkableChild(_this,LinkableString);_this.altText=_weavejs.Weave.linkableChild(_this,_IAltText.IAltTextConfig,_this.forceUpdate,true);_this.xAxisName=_weavejs.Weave.linkableChild(_this,LinkableString);_this.yAxisName=_weavejs.Weave.linkableChild(_this,LinkableString);_this.margin=_weavejs.Weave.linkableChild(_this,Margin);_this.overrideBounds=_weavejs.Weave.linkableChild(_this,OverrideBounds);_this.filteredKeySet=_weavejs.Weave.linkableChild(_this,FilteredKeySet);_this.selectionFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.probeFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return Accordion.render(["Data",_this.getSelectableAttributesEditor(pushCrumb)],["Titles",_this.getTitlesEditor()],["Margins",_this.getMarginEditor()],["Accessibility",_this.getAltTextEditor()])};_weavejs.Weave.getCallbacks(_this).addGroupedCallback(_this,_this.forceUpdate,true);return _this}_createClass(AbstractVisTool,[{key:"componentDidMount",value:function componentDidMount(){Menu.registerMenuSource(this)}},{key:"isSelected",value:function isSelected(key){var keySet=this.selectionFilter.target;return keySet instanceof KeySet&&keySet.containsKey(key)}},{key:"isProbed",value:function isProbed(key){var keySet=this.probeFilter.target;return keySet instanceof KeySet&&keySet.containsKey(key)}},{key:"getAutomaticDescription",value:function getAutomaticDescription(){return this.title}},{key:"initSelectableAttributes",value:function initSelectableAttributes(input){AbstractVisTool.initSelectableAttributes(this.selectableAttributes,input)}},{key:"getMenuItems",value:function getMenuItems(){return AbstractVisTool.getMenuItems(this)}},{key:"getSelectableAttributesEditor",value:function getSelectableAttributesEditor(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return _IVisTool2.default.renderSelectableAttributes(this.selectableAttributes,pushCrumb)}},{key:"renderNumberEditor",value:function renderNumberEditor(linkableNumber,flex){var style={textAlign:"center",flex:flex,minWidth:60};return React.createElement(StatefulTextField,{type:"number",style:style,ref:WeaveReactUtils.linkReactStateRef(this,{value:linkableNumber})})}},{key:"getMarginEditor",value:function getMarginEditor(){return[[_weavejs.Weave.lang("Margins"),React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},this.renderNumberEditor(this.margin.left,1),React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1}},this.renderNumberEditor(this.margin.top,null),this.renderNumberEditor(this.margin.bottom,null)),this.renderNumberEditor(this.margin.right,1))]]}},{key:"getTitlesEditor",value:function getTitlesEditor(){var _this2=this;return[[_weavejs.Weave.lang("Chart"),this.panelTitle,this.defaultPanelTitle],[_weavejs.Weave.lang("X axis"),this.xAxisName,this.defaultXAxisLabel],[_weavejs.Weave.lang("Y axis"),this.yAxisName,this.defaultYAxisLabel]].map(function(row){return[_weavejs.Weave.lang(row[0]),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(_this2,{value:row[1]}),placeholder:row[2]})]})}},{key:"getAltTextEditor",value:function getAltTextEditor(){return[[_weavejs.Weave.lang("Alt Text"),React.createElement(StatefulTextArea,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.altText.text}),placeholder:this.getAutomaticDescription()})],[_weavejs.Weave.lang("Show as caption"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.altText.showAsCaption}),label:" "})]]}},{key:"selectionKeySet",get:function get(){var keySet=this.selectionFilter.target;return keySet instanceof KeySet?keySet:null}},{key:"probeKeySet",get:function get(){var keySet=this.probeFilter.target;return keySet instanceof KeySet?keySet:null}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)||this.defaultPanelTitle}},{key:"defaultPanelTitle",get:function get(){return""}},{key:"defaultXAxisLabel",get:function get(){return""}},{key:"defaultYAxisLabel",get:function get(){return""}},{key:"selectableAttributes",get:function get(){return new Map}},{key:"deprecatedStateMapping",get:function get(){return{"children":{"visualization":{"plotManager":{"marginTop":this.margin.top,"marginLeft":this.margin.left,"marginRight":this.margin.right,"marginBottom":this.margin.bottom,"overrideXMin":this.overrideBounds.xMin,"overrideYMin":this.overrideBounds.yMin,"overrideXMax":this.overrideBounds.xMax,"overrideYMax":this.overrideBounds.yMax,"plotters":{"yAxis":{"overrideAxisName":this.yAxisName},"xAxis":{"overrideAxisName":this.xAxisName}}}}}}}}],[{key:"initSelectableAttributes",value:function initSelectableAttributes(selectableAttributes,input){var attrs=JS.mapValues(selectableAttributes);ColumnUtils.initSelectableAttributes(attrs,input)}},{key:"createFromSetToSubset",value:function createFromSetToSubset(set,filter){filter.replaceKeys(false,true,set.keys,null);set.clearKeys()}},{key:"removeFromSetToSubset",value:function removeFromSetToSubset(set,filter){filter.excludeKeys(set.keys);set.clearKeys()}},{key:"clearSubset",value:function clearSubset(filter){filter.replaceKeys(true,true)}},{key:"getMenuItems",value:function getMenuItems(target){var menuItems=[];var selectionKeySet=target.selectionFilter.target;var probeKeySet=target.probeFilter.target;var subset=target.filteredKeySet.keyFilter.getInternalKeyFilter();if(probeKeySet)_weavejs.Weave.copyState(probeKeySet,this.localProbeKeySet);else this.localProbeKeySet.clearKeys();var usingIncludedKeys=subset&&subset.included.keys.length>0;var usingExcludedKeys=subset&&subset.excluded.keys.length>0;var includeMissingKeys=subset&&subset.includeMissingKeys.value;var usingSubset=includeMissingKeys?usingExcludedKeys:true;var usingProbe=this.localProbeKeySet.keys.length>0;var usingSelection=selectionKeySet&&selectionKeySet.keys.length>0;if(!usingSelection&&usingProbe&&subset){menuItems.push({label:_weavejs.Weave.lang("Create subset from highlighted record(s)"),click:this.createFromSetToSubset.bind(null,this.localProbeKeySet,subset)});menuItems.push({label:_weavejs.Weave.lang("Remove highlighted record(s) from subset"),click:this.removeFromSetToSubset.bind(null,this.localProbeKeySet,subset)})}else{menuItems.push({enabled:usingSelection&&!!subset,label:_weavejs.Weave.lang("Create subset from selected record(s)"),click:this.createFromSetToSubset.bind(null,selectionKeySet,subset)});menuItems.push({enabled:usingSelection&&!!subset,label:_weavejs.Weave.lang("Remove selected record(s) from subset"),click:this.removeFromSetToSubset.bind(null,selectionKeySet,subset)})}menuItems.push({enabled:usingSubset&&!!subset,label:_weavejs.Weave.lang("Show all records"),click:this.clearSubset.bind(null,subset)});return menuItems}},{key:"handlePointClick",value:function handlePointClick(toolGroup,event){var probeKeySet=toolGroup.probeFilter.target;var selectionKeySet=toolGroup.selectionFilter.target;if(!(probeKeySet instanceof KeySet)||!(selectionKeySet instanceof KeySet))return;var probeKeys=probeKeySet.keys;if(!probeKeys.length){selectionKeySet.clearKeys();return}var isSelected=false;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=probeKeys[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;if(selectionKeySet.containsKey(key)){isSelected=true;break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(event.ctrlKey||event.metaKey){if(isSelected)selectionKeySet.removeKeys(probeKeys);else selectionKeySet.addKeys(probeKeys)}else{if(_.isEqual(selectionKeySet.keys.sort(),probeKeys.sort()))selectionKeySet.clearKeys();else selectionKeySet.replaceKeys(probeKeys)}}}]);return AbstractVisTool}(React.Component);exports.default=AbstractVisTool;AbstractVisTool.localProbeKeySet=new KeySet;

},{"lodash":"lodash","react":"react","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weavejs":136}],71:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _MenuLayoutComponent=require("weaveapp/ui/MenuLayoutComponent");var _MenuLayoutComponent2=_interopRequireDefault(_MenuLayoutComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ReactUtils=weavejs.util.ReactUtils;var ComboBox=weavejs.ui.ComboBox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var StatefulTextField=weavejs.ui.StatefulTextField;var HelpIcon=weavejs.ui.HelpIcon;var IColumnWrapper=weavejs.api.data.IColumnWrapper;var LinkableHashMap=weavejs.core.LinkableHashMap;var LinkableString=weavejs.core.LinkableString;var LinkableBoolean=weavejs.core.LinkableBoolean;var LinkableNumber=weavejs.core.LinkableNumber;var LinkableVariable=weavejs.core.LinkableVariable;var LinkableWatcher=weavejs.core.LinkableWatcher;var ColumnUtils=weavejs.data.ColumnUtils;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var DynamicColumn=weavejs.data.column.DynamicColumn;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var JS=weavejs.util.JS;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var Checkbox=weavejs.ui.Checkbox;var LAYOUT_OPTIONS_SINGLE=[_MenuLayoutComponent.LAYOUT_LIST,_MenuLayoutComponent.LAYOUT_COMBO,_MenuLayoutComponent.LAYOUT_HSLIDER,_MenuLayoutComponent.LAYOUT_VSLIDER];var LAYOUT_OPTIONS_MULTIPLE=[_MenuLayoutComponent.LAYOUT_LIST,_MenuLayoutComponent.LAYOUT_COMBO,_MenuLayoutComponent.LAYOUT_HSLIDER,_MenuLayoutComponent.LAYOUT_VSLIDER,_MenuLayoutComponent.LAYOUT_CHECKBOXLIST];var AttributeMenuTool=function(_React$Component){_inherits(AttributeMenuTool,_React$Component);function AttributeMenuTool(props){_classCallCheck(this,AttributeMenuTool);var _this=_possibleConstructorReturn(this,(AttributeMenuTool.__proto__||Object.getPrototypeOf(AttributeMenuTool)).call(this,props));_this.panelTitle=_weavejs.Weave.linkableChild(_this,LinkableString);_this.choices=_weavejs.Weave.linkableChild(_this,new LinkableHashMap(IAttributeColumn),_this.forceUpdate,true);_this.layoutMode=_weavejs.Weave.linkableChild(_this,new LinkableString(_MenuLayoutComponent.LAYOUT_LIST,_this.verifyLayoutMode),_this.forceUpdate,true);_this.selectedAttribute=_weavejs.Weave.linkableChild(_this,LinkableVariable,_this.forceUpdate,true);_this.targetToolPath=_weavejs.Weave.linkableChild(_this,new LinkableVariable(Array));_this.targetAttribute=_weavejs.Weave.linkableChild(_this,LinkableString);_this.playEnabled=_weavejs.Weave.linkableChild(_this,LinkableBoolean);_this.playbackIntervalSeconds=_weavejs.Weave.linkableChild(_this,new LinkableNumber(1));_this.toolWatcher=_weavejs.Weave.privateLinkableChild(_this,LinkableWatcher);_this.altText=_weavejs.Weave.linkableChild(_this,new LinkableString(_this.panelTitle.value));_this.setToolWatcher=function(){_this.toolWatcher.targetPath=_this.targetToolPath.state;_this.onSelectedAttribute();_this.forceUpdate()};_this.playStep=function(){if(!_this.state.isPlaying)return;var state=_this.selectedAttribute.state;var currentSelections=Array.isArray(state)?state:[state];var choiceNames=_this.choices.getNames();var currentIndex=_.min(currentSelections.map(function(name){return choiceNames.indexOf(name)}));var nextIndex=(currentIndex+1)%choiceNames.length;_this.selectedAttribute.state=[choiceNames[nextIndex]];_this.playTimeoutHandle=setTimeout(_this.playStep,_this.playbackIntervalSeconds.value*1000)};_this.onSelectedAttribute=function(){var selectedColumns=_this.selectedAttributes;var targetAttribute=_this.getTargetAttribute();if(_weavejs.Weave.IS(targetAttribute,IColumnWrapper)){var columnToSet=ColumnUtils.hack_findInternalDynamicColumn(targetAttribute);if(selectedColumns.length>0){var selectedColumn=selectedColumns[0];columnToSet.requestLocalObjectCopy(selectedColumn)}else{columnToSet.removeObject()}}else if(_weavejs.Weave.IS(targetAttribute,LinkableHashMap)){var hm=targetAttribute;hm.delayCallbacks();hm.removeAllObjects();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=selectedColumns[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _selectedColumn=_step.value;var newColumn=hm.requestObject(null,DynamicColumn,false);newColumn.requestLocalObjectCopy(_selectedColumn)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}hm.resumeCallbacks()}_this.forceUpdate()};_this.handleSelection=function(selectedValue){if(!selectedValue)return;var selectedColumns=Array.isArray(selectedValue)?selectedValue:[selectedValue];var selectedNames=selectedColumns.map(function(column){return _this.choices.getName(column)});_this.selectedAttribute.state=selectedNames};_this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return React.createElement(AttributeMenuTargetEditor,{attributeMenuTool:_this,pushCrumb:pushCrumb})};_this.togglePlay=function(){_this.setState({isPlaying:!_this.state.isPlaying})};_this.state={isPlaying:false};_this.targetToolPath.addGroupedCallback(_this,_this.setToolWatcher);_this.selectedAttribute.addGroupedCallback(_this,_this.onSelectedAttribute);_this.playEnabled.addGroupedCallback(_this,_this.forceUpdate);return _this}_createClass(AttributeMenuTool,[{key:"verifyLayoutMode",value:function verifyLayoutMode(value){return LAYOUT_OPTIONS_MULTIPLE.indexOf(value)>=0}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(this.state.isPlaying==prevState.isPlaying)return;if(this.state.isPlaying){this.playTimeoutHandle=setTimeout(this.playStep,this.playbackIntervalSeconds.value*1000)}else{clearTimeout(this.playTimeoutHandle);this.playTimeoutHandle=null}}},{key:"getTargetAttribute",value:function getTargetAttribute(){var tool=this.toolWatcher.target;return tool&&tool.selectableAttributes&&tool.selectableAttributes.get(this.targetAttribute.value)}},{key:"render",value:function render(){return React.createElement(_MenuLayoutComponent2.default,{multiple:_weavejs.Weave.IS(this.getTargetAttribute(),LinkableHashMap),options:this.options,playToggle:this.playEnabled.value?this.togglePlay:null,isPlaying:this.state.isPlaying,displayMode:this.layoutMode.value,onChange:this.handleSelection,selectedItems:this.selectedAttributes})}},{key:"title",get:function get(){return this.panelTitle.value}},{key:"selectableAttributes",get:function get(){return new Map().set("Choices",this.choices)}},{key:"options",get:function get(){return this.choices.getObjects(IAttributeColumn).map(function(column){return{label:column.getMetadata(ColumnMetadata.TITLE)||"",value:column}})}},{key:"selectedAttributes",get:function get(){var _this2=this;var state=this.selectedAttribute.state;var selectedNames=Array.isArray(state)?state:[state];return selectedNames.map(function(name){return _this2.choices.getObject(name)}).filter(function(column){return!!column})}}]);return AttributeMenuTool}(React.Component);exports.default=AttributeMenuTool;AttributeMenuTool.WEAVE_INFO=_weavejs.Weave.setClassInfo(AttributeMenuTool,{id:"weavejs.tool.AttributeMenu",label:"Attribute Menu Tool",interfaces:[_IVisTool2.default,ISelectableAttributes],deprecatedIds:["weave.ui::AttributeMenuTool"]});var AttributeMenuTargetEditor=function(_React$Component2){_inherits(AttributeMenuTargetEditor,_React$Component2);function AttributeMenuTargetEditor(props){_classCallCheck(this,AttributeMenuTargetEditor);var _this3=_possibleConstructorReturn(this,(AttributeMenuTargetEditor.__proto__||Object.getPrototypeOf(AttributeMenuTargetEditor)).call(this,props));_this3.handleTargetToolChange=function(selectedItem){if(selectedItem){_this3.props.attributeMenuTool.targetToolPath.state=selectedItem;_this3.props.attributeMenuTool.targetAttribute.state=""}};_this3.getTargetToolPath=function(){var toolPath=_this3.props.attributeMenuTool.targetToolPath.state;return toolPath};_this3.weaveRoot=_weavejs.Weave.getRoot(_this3.props.attributeMenuTool);_this3.weaveRoot.childListCallbacks.addGroupedCallback(_this3,_this3.getOpenVizToolNames,true);_weavejs.Weave.getCallbacks(_this3.props.attributeMenuTool.toolWatcher).addGroupedCallback(_this3,_this3.forceUpdate);_this3.state={openToolNames:[]};return _this3}_createClass(AttributeMenuTargetEditor,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.attributeMenuTool!=nextProps.attributeMenuTool){this.weaveRoot.childListCallbacks.removeCallback(this,this.getOpenVizToolNames);_weavejs.Weave.getCallbacks(this.props.attributeMenuTool.toolWatcher).removeCallback(this,this.forceUpdate);this.weaveRoot=_weavejs.Weave.getRoot(nextProps.attributeMenuTool);this.weaveRoot.childListCallbacks.addGroupedCallback(this,this.getOpenVizToolNames,true);_weavejs.Weave.getCallbacks(nextProps.attributeMenuTool.toolWatcher).addGroupedCallback(this,this.forceUpdate)}}},{key:"getOpenVizToolNames",value:function getOpenVizToolNames(){var _this4=this;var openToolNames=[];_weavejs.Weave.getDescendants(this.weaveRoot,ISelectableAttributes).forEach(function(toolOrLayer){if(_weavejs.Weave.className(toolOrLayer)!=_weavejs.Weave.className(_this4.props.attributeMenuTool)){openToolNames.push({label:_weavejs.Weave.findPath(_this4.weaveRoot,toolOrLayer).join(", "),value:_weavejs.Weave.findPath(_this4.weaveRoot,toolOrLayer)})}});this.setState({openToolNames:openToolNames})}},{key:"getTargetToolAttributeOptions",value:function getTargetToolAttributeOptions(){return this.tool?JS.mapKeys(this.tool.selectableAttributes):[]}},{key:"renderTitleEditor",value:function renderTitleEditor(){return[[_weavejs.Weave.lang("Title"),React.createElement(StatefulTextField,{className:"ui input fluid",ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.attributeMenuTool.panelTitle})})]]}},{key:"render",value:function render(){return React.createElement(VBox,{overflow:true},ReactUtils.generateTable({body:[].concat(this.toolConfigs,_IVisTool2.default.renderSelectableAttributes(this.props.attributeMenuTool.selectableAttributes,this.props.pushCrumb),this.renderTitleEditor()),classes:{td:["weave-left-cell","weave-right-cell"]}}))}},{key:"tool",get:function get(){return this.props.attributeMenuTool.toolWatcher.target}},{key:"toolConfigs",get:function get(){var toolPath;if(this.props.attributeMenuTool.targetToolPath.state)toolPath=this.getTargetToolPath();return[[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Chart"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Select a chart to control."))),React.createElement(ComboBox,{className:"weave-sidebar-dropdown",placeholder:_weavejs.Weave.lang("Select a chart"),value:toolPath,options:this.state.openToolNames,onChange:this.handleTargetToolChange})],[React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center",justifyContent:"flex-end"}},_weavejs.Weave.lang("Attribute"),React.createElement(HelpIcon,null,_weavejs.Weave.lang("Attribute of the chart to be controlled. Values selected in the Attribute Controller will change this attribute for the selected chart."))),React.createElement(ComboBox,{className:"weave-sidebar-dropdown",placeholder:_weavejs.Weave.lang("Select an attribute"),ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.attributeMenuTool.targetAttribute}),options:this.getTargetToolAttributeOptions()})],[_weavejs.Weave.lang("Layout mode"),React.createElement(ComboBox,{className:"weave-sidebar-dropdown",ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.attributeMenuTool.layoutMode}),options:_weavejs.Weave.IS(this.props.attributeMenuTool.getTargetAttribute(),LinkableHashMap)?LAYOUT_OPTIONS_MULTIPLE:LAYOUT_OPTIONS_SINGLE})],[_weavejs.Weave.lang("Show Play Button"),React.createElement(Checkbox,{label:" ",ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.attributeMenuTool.playEnabled})})],[_weavejs.Weave.lang("Playback Interval (Seconds)"),React.createElement(StatefulTextField,{className:"ui input fluid",ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.attributeMenuTool.playbackIntervalSeconds})})]]}}]);return AttributeMenuTargetEditor}(React.Component);

},{"lodash":"lodash","react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/ui/MenuLayoutComponent":122,"weavejs":136}],72:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractVisTool=require("weaveapp/tool/AbstractVisTool");var _AbstractVisTool2=_interopRequireDefault(_AbstractVisTool);var _ColorRampComponent=require("weaveapp/ui/ColorRampComponent");var _ColorRampComponent2=_interopRequireDefault(_ColorRampComponent);var _BinningDefinitionEditor=require("weaveapp/editor/BinningDefinitionEditor");var _ColorRampEditor=require("weaveapp/editor/ColorRampEditor");var _ColorRampEditor2=_interopRequireDefault(_ColorRampEditor);var _PrintUtils=require("weaveapp/util/PrintUtils");var _PrintUtils2=_interopRequireDefault(_PrintUtils);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MiscUtils=weavejs.util.MiscUtils;var ReactUtils=weavejs.util.ReactUtils;var prefixer=weavejs.css.prefixer;var ToolTip=weavejs.ui.ToolTip;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Menu=weavejs.ui.menu.Menu;var ComboBox=weavejs.ui.ComboBox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var StatefulTextField=weavejs.ui.StatefulTextField;var Accordion=weavejs.ui.Accordion;var Checkbox=weavejs.ui.Checkbox;var DynamicColumn=weavejs.data.column.DynamicColumn;var FilteredKeySet=weavejs.data.key.FilteredKeySet;var DynamicKeyFilter=weavejs.data.key.DynamicKeyFilter;var LinkableNumber=weavejs.core.LinkableNumber;var LinkableString=weavejs.core.LinkableString;var LinkableBoolean=weavejs.core.LinkableBoolean;var ColumnUtils=weavejs.data.ColumnUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var SHAPE_TYPE_CIRCLE="circle";var SHAPE_TYPE_SQUARE="square";var SHAPE_TYPE_LINE="line";var SHAPE_TYPE_BOX="box";var SHAPE_MODES=[{label:"Circle",value:SHAPE_TYPE_CIRCLE},{label:"Line",value:SHAPE_TYPE_LINE},{label:"Square",value:SHAPE_TYPE_SQUARE},{label:"Box",value:SHAPE_TYPE_BOX}];var ColorLegend=function(_React$Component){_inherits(ColorLegend,_React$Component);function ColorLegend(props){_classCallCheck(this,ColorLegend);var _this=_possibleConstructorReturn(this,(ColorLegend.__proto__||Object.getPrototypeOf(ColorLegend)).call(this,props));_this.panelTitle=_weavejs.Weave.linkableChild(_this,LinkableString);_this.filteredKeySet=_weavejs.Weave.linkableChild(_this,FilteredKeySet);_this.selectionFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.probeFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.dynamicColorColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.maxColumns=_weavejs.Weave.linkableChild(_this,new LinkableNumber(1));_this.shapeSize=_weavejs.Weave.linkableChild(_this,new LinkableNumber(25));_this.shapeType=_weavejs.Weave.linkableChild(_this,new LinkableString(SHAPE_TYPE_CIRCLE));_this.showLegendName=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(true));_this.reverseOrder=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.altText=_weavejs.Weave.linkableChild(_this,new LinkableString(_this.panelTitle.value));_this.cellBorderWidth=1;_this.cellPadding=2;_this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return Accordion.render([_weavejs.Weave.lang("Data"),React.createElement(_BinningDefinitionEditor.BinningDefinitionSelector,{insertTableRows:[[_weavejs.Weave.lang("Color theme"),React.createElement(_ColorRampEditor2.default,{compact:true,colorRamp:_this.colorColumn.ramp,pushCrumb:pushCrumb})]],attributeName:"Color data",attributes:_this.selectableAttributes,pushCrumb:pushCrumb})],[_weavejs.Weave.lang("Display"),[[_weavejs.Weave.lang("Chart title"),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.panelTitle}),placeholder:_this.defaultPanelTitle})],[_weavejs.Weave.lang("Shape type"),React.createElement(ComboBox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.shapeType}),options:SHAPE_MODES})],[_weavejs.Weave.lang("Shape Size"),React.createElement(StatefulTextField,{type:"number",style:{textAlign:"center",flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.shapeSize})})],[_weavejs.Weave.lang("Reverse Order"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.reverseOrder}),label:" "})],[_weavejs.Weave.lang("Number of columns"),React.createElement(StatefulTextField,{type:"number",style:{textAlign:"center",flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.maxColumns})})],[_weavejs.Weave.lang("Show title"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.showLegendName}),label:" "})]]])};_weavejs.Weave.getCallbacks(_this).addGroupedCallback(_this,_this.forceUpdate);_this.filteredKeySet.setSingleKeySource(_this.dynamicColorColumn);_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.dynamicColorColumn.targetPath=["defaultColorColumn"];_this.state={selected:[],probed:[]};return _this}_createClass(ColorLegend,[{key:"getSelectedBins",value:function getSelectedBins(){var _this2=this;if(this.selectionKeySet)return _.uniq(this.selectionKeySet.keys.map(function(key){return _this2.binnedColumn.getValueFromKey(key,Number)}));return[]}},{key:"getProbedBins",value:function getProbedBins(){var _this3=this;if(this.probeKeySet)return _.uniq(this.probeKeySet.keys.map(function(key){return _this3.binnedColumn.getValueFromKey(key,Number)}));return[]}},{key:"handleClick",value:function handleClick(bin,event){var selectedBins=this.getSelectedBins();var _binnedKeysArray=this.binnedColumn["_binnedKeysArray"];if(_.contains(selectedBins,bin)){var currentSelection=this.selectionKeySet.keys;currentSelection=_.difference(currentSelection,_binnedKeysArray[bin]);this.selectionKeySet.replaceKeys(currentSelection);_.remove(selectedBins,function(value){return value==bin})}else{if(event.ctrlKey||event.metaKey)this.selectionKeySet.addKeys(_binnedKeysArray[bin]);else this.selectionKeySet.replaceKeys(_binnedKeysArray[bin])}}},{key:"handleProbe",value:function handleProbe(bin,mouseOver,event){if(!this.probeKeySet)return;if(mouseOver){var keys=this.binnedColumn.getKeysFromBinIndex(bin);if(!keys)return;this.probeKeySet.replaceKeys(keys)}else{this.probeKeySet.replaceKeys([])}this.toolTip.show(this,event,this.probeKeySet.keys,[this.binnedColumn.internalDynamicColumn])}},{key:"componentDidMount",value:function componentDidMount(){Menu.registerMenuSource(this);this.toolTip=ReactUtils.openPopup(this,React.createElement(ToolTip,null))}},{key:"componentWillUnmount",value:function componentWillUnmount(){ReactUtils.closePopup(this.toolTip)}},{key:"getMenuItems",value:function getMenuItems(){var menuItems=_AbstractVisTool2.default.getMenuItems(this);if(_weavejs.Weave.beta)menuItems.push({label:_weavejs.Weave.lang("Print Tool (Beta)"),click:_PrintUtils2.default.printTool.bind(null,ReactDOM.findDOMNode(this))});return menuItems}},{key:"getInteractionStyle",value:function getInteractionStyle(bin){var probed=this.getProbedBins().indexOf(bin)>=0;var selected=this.getSelectedBins().indexOf(bin)>=0;var borderAlpha;if(probed)borderAlpha=1;else if(selected)borderAlpha=0.5;else borderAlpha=0;return{borderColor:MiscUtils.rgba(0,0,0,borderAlpha),borderStyle:"solid",borderWidth:this.cellBorderWidth,padding:this.cellPadding,overflow:"hidden",alignItems:"center",flexShrink:isNaN(this.shapeSize.value)?1:0,minWidth:0}}},{key:"getCell",value:function getCell(cellIndex,shapeSize,textStyle){var shapeType=this.shapeType.value;var shapeElement=null;var shapeColor=MiscUtils.rgb_a(this.colorColumn.ramp.getColor(cellIndex,0,this.numberOfBins-1),1);var shapeStyle={backgroundColor:shapeColor};var textLabelFunction=this.binnedColumn.deriveStringFromNumber.bind(this.binnedColumn);if(shapeType==SHAPE_TYPE_BOX){_.merge(shapeStyle,{flex:"1 0",alignItems:"center",justifyContent:"center",height:shapeSize});shapeElement=[React.createElement(HBox,{key:"box",style:shapeStyle},React.createElement("div",{style:{stroke:"black",strokeOpacity:0.5,backgroundColor:"#FFF"}},React.createElement("span",{style:textStyle}," ",_weavejs.Weave.lang(textLabelFunction(cellIndex))," ")))]}else{var shapeContainerStyle={width:shapeSize,height:shapeSize};shapeStyle.width="100%";switch(shapeType){case SHAPE_TYPE_CIRCLE:_.merge(shapeStyle,{paddingTop:"100%",borderRadius:"50%"});break;case SHAPE_TYPE_SQUARE:_.merge(shapeStyle,{paddingTop:"100%"});break;case SHAPE_TYPE_LINE:shapeContainerStyle.display="flex";shapeContainerStyle.alignItems="center";_.merge(shapeStyle,{height:4});break;}shapeElement=[React.createElement("div",{key:shapeType,style:shapeContainerStyle},React.createElement("div",{style:shapeStyle})),React.createElement("span",{key:"label",style:textStyle},_weavejs.Weave.lang(textLabelFunction(cellIndex)))]}return React.createElement(HBox,{key:cellIndex,style:this.getInteractionStyle(cellIndex),onClick:this.handleClick.bind(this,cellIndex),onMouseMove:this.handleProbe.bind(this,cellIndex,true),onMouseOut:this.handleProbe.bind(this,cellIndex,false)},shapeElement)}},{key:"render",value:function render(){var _this4=this;if(this.numberOfBins){var maxColumns=this.maxColumns.value;var columnFlex=1/maxColumns;var extraCells=this.numberOfBins%maxColumns==0?0:maxColumns-this.numberOfBins%maxColumns;var totalCells=this.numberOfBins+extraCells;var columns=[];var items=[];var shapeSize=this.shapeSize.value;var textStyle=prefixer({paddingLeft:4,userSelect:"none",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",cursor:"pointer",minWidth:0,flex:"0.8 0"});if(isNaN(shapeSize)){shapeSize=_.max([1,_.min([shapeSize,this.element.clientHeight/this.numberOfBins])]);shapeSize=(shapeSize-(2*this.cellBorderWidth+2*this.cellPadding))/2}if(this.reverseOrder.value){for(var _cellIndex=this.numberOfBins-1;_cellIndex>=0;_cellIndex--){items.push(this.getCell(_cellIndex,shapeSize,textStyle))}}else{for(var _cellIndex2=0;_cellIndex2<this.numberOfBins;_cellIndex2++){items.push(this.getCell(_cellIndex2,shapeSize,textStyle))}}for(var extraBinIndex=this.numberOfBins;extraBinIndex<totalCells;extraBinIndex++){var cellHeight=shapeSize+2*this.cellPadding+2*this.cellBorderWidth;items.push(React.createElement(HBox,{key:cellIndex,style:{height:cellHeight}}))}for(var colIndex=0;colIndex<maxColumns;colIndex++){var rows=[];for(var cellIndex=0;cellIndex<totalCells;cellIndex++){if(cellIndex%maxColumns==colIndex){rows.push(items[cellIndex])}}var legendColumnStyle={display:"flex",flex:columnFlex,flexDirection:"column",minWidth:0,padding:"4px",justifyContent:"space-around"};columns[colIndex]=React.createElement("div",{key:colIndex,style:legendColumnStyle},rows)}var overflowValue=isNaN(this.shapeSize.value)?"hidden":"auto";return React.createElement(VBox,{style:{flex:1,padding:"0px 5px 0px 5px",overflow:"hidden"},ref:function ref(vbox){return _this4.element=ReactDOM.findDOMNode(vbox)}},this.showLegendName.value?React.createElement(HBox,{style:{flex:0.1,alignItems:"center"}},React.createElement("span",{style:textStyle},_weavejs.Weave.lang(this.dynamicColorColumn.getMetadata("title")))):null,React.createElement(HBox,{style:{flex:this.showLegendName.value?0.9:1,overflowY:overflowValue,overflowX:"hidden"}},columns))}else{if(this.colorColumn){var dataColumn=this.colorColumn.internalDynamicColumn;return React.createElement(VBox,{style:{flex:1,marginLeft:20,marginBottom:8},className:"weave-padded-vbox"},React.createElement("label",{style:{marginTop:5,fontWeight:"bold"}},_weavejs.Weave.lang(this.dynamicColorColumn.getMetadata("title"))),React.createElement(HBox,{style:{flex:1,overflow:"auto"},className:"weave-padded-hbox"},React.createElement(_ColorRampComponent2.default,{style:{width:30},direction:"bottom",ramp:this.colorColumn?this.colorColumn.ramp.getHexColors():[]}),React.createElement(VBox,{style:{justifyContent:"space-between"}},ColumnUtils.deriveStringFromNumber(dataColumn,this.colorColumn.getDataMax()),this.colorColumn.rampCenterAtZero.value?ColumnUtils.deriveStringFromNumber(dataColumn,0):null,ColumnUtils.deriveStringFromNumber(dataColumn,this.colorColumn.getDataMin()))))}return React.createElement("div",null)}}},{key:"initSelectableAttributes",value:function initSelectableAttributes(input){_AbstractVisTool2.default.initSelectableAttributes(this.selectableAttributes,input)}},{key:"colorColumn",get:function get(){return this.dynamicColorColumn.target}},{key:"binnedColumn",get:function get(){var cc=this.colorColumn;return cc?cc.getInternalColumn():null}},{key:"binningDefinition",get:function get(){var bc=this.binnedColumn;return bc?bc.binningDefinition.target:null}},{key:"selectionKeySet",get:function get(){return this.selectionFilter.getInternalKeyFilter()}},{key:"probeKeySet",get:function get(){return this.probeFilter.getInternalKeyFilter()}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)||this.defaultPanelTitle;;}},{key:"defaultPanelTitle",get:function get(){var column=this.colorColumn;var title=this.colorColumn.getMetadata("title");if(title==null)return _weavejs.Weave.lang("Color Legend");return _weavejs.Weave.lang("Color Legend of {0}",title)}},{key:"numberOfBins",get:function get(){var bc=this.binnedColumn;return bc?bc.numberOfBins:0}},{key:"selectableAttributes",get:function get(){return new Map().set("Color data",this.dynamicColorColumn)}},{key:"deprecatedStateMapping",get:function get(){var _this5=this;return{children:{visualization:{plotManager:{marginTop:function marginTop(str){return _this5.showLegendName.value=str!="0"},plotters:{plot:this}}}}}}}]);return ColorLegend}(React.Component);exports.default=ColorLegend;ColorLegend.WEAVE_INFO=_weavejs.Weave.setClassInfo(ColorLegend,{id:"weavejs.tool.ColorLegend",label:"Color Legend",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.tools::ColorBinLegendTool"]});

},{"lodash":"lodash","react":"react","react-dom":"react-dom","weaveapp/api/ui/IVisTool":11,"weaveapp/editor/BinningDefinitionEditor":21,"weaveapp/editor/ColorRampEditor":29,"weaveapp/tool/AbstractVisTool":70,"weaveapp/ui/ColorRampComponent":114,"weaveapp/util/PrintUtils":134,"weavejs":136}],73:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _classnames=require("weaveapp/modules/classnames");var _classnames2=_interopRequireDefault(_classnames);var _AbstractFilterEditor=require("weaveapp/editor/AbstractFilterEditor");var _AbstractFilterEditor2=_interopRequireDefault(_AbstractFilterEditor);var _DiscreteValuesDataFilterEditor=require("weaveapp/editor/DiscreteValuesDataFilterEditor");var _DiscreteValuesDataFilterEditor2=_interopRequireDefault(_DiscreteValuesDataFilterEditor);var _NumericRangeDataFilterEditor=require("weaveapp/editor/NumericRangeDataFilterEditor");var _NumericRangeDataFilterEditor2=_interopRequireDefault(_NumericRangeDataFilterEditor);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VBox=weavejs.ui.flexbox.VBox;var ReactUtils=weavejs.util.ReactUtils;var ComboBox=weavejs.ui.ComboBox;var Checkbox=weavejs.ui.Checkbox;var LinkableString=weavejs.core.LinkableString;var ColumnDataFilter=weavejs.data.key.ColumnDataFilter;var LinkableDynamicObject=weavejs.core.LinkableDynamicObject;var ColumnUtils=weavejs.data.ColumnUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var LinkablePlaceholder=weavejs.core.LinkablePlaceholder;var CallbackCollection=weavejs.core.CallbackCollection;var DataFilterTool=function(_React$Component){_inherits(DataFilterTool,_React$Component);function DataFilterTool(props){_classCallCheck(this,DataFilterTool);var _this=_possibleConstructorReturn(this,(DataFilterTool.__proto__||Object.getPrototypeOf(DataFilterTool)).call(this,props));_this.filter=_weavejs.Weave.linkableChild(_this,new LinkableDynamicObject(ColumnDataFilter),_this.handleFilterWatcher);_this.filterEditor=_weavejs.Weave.linkableChild(_this,new LinkableDynamicObject(_AbstractFilterEditor2.default),_this.handleEditor,true);_this.altText=_weavejs.Weave.linkableChild(_this,LinkableString);_this._editorDiff=null;_this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!_this.filter.target)_this.initLater();return React.createElement(DataFilterEditor,{filterEditor:_this.filterEditor,pushCrumb:pushCrumb,selectableAttributes:_this.selectableAttributes})};_this.setEnabled=function(value){if(_this.getFilter())_this.getFilter().enabled.value=value};_this.getEnabled=function(){return _this.getFilter()?_this.getFilter().enabled.value:false};_weavejs.Weave.getCallbacks(_this).addGroupedCallback(_this,_this.forceUpdate);_weavejs.WeaveAPI.Scheduler.callLater(_this,_this.initLater);return _this}_createClass(DataFilterTool,[{key:"initLater",value:function initLater(){if(this.filter.triggerCounter==CallbackCollection.DEFAULT_TRIGGER_COUNT)this.filter.targetPath=["defaultSubsetKeyFilter","filters",_weavejs.Weave.getRoot(this).getName(this)];if(!this.getFilter())this.setEditorType(_DiscreteValuesDataFilterEditor2.default,null)}},{key:"handleFilterWatcher",value:function handleFilterWatcher(){var _filter=this.getFilter();if(_filter){var values=_filter.values.getSessionState()||[];if(typeof values[0]=="number"||typeof values[0]=="string")this.setEditorType(_DiscreteValuesDataFilterEditor2.default,this._editorDiff)}else{this.setEditorType(_NumericRangeDataFilterEditor2.default,this._editorDiff);this._editorDiff=null}var _editor=this.getFilterEditor();if(_editor)_editor.filter=_filter}},{key:"handleEditor",value:function handleEditor(){var _editor=this.getFilterEditor();if(_editor)_editor.filter=this.filter.target}},{key:"setEditorType",value:function setEditorType(editorType,editorDiff){var editorState=this.filterEditor.target&&_weavejs.Weave.getState(this.filterEditor.target);_weavejs.Weave.getWeave(this).requestObject(this.filter.targetPath,_weavejs.Weave.className(ColumnDataFilter));this.filterEditor.requestLocalObject(editorType,false);if(this.filterEditor.target&&editorDiff){editorState=_weavejs.WeaveAPI.SessionManager.combineDiff(editorState,editorDiff);_weavejs.Weave.setState(this.filterEditor.target,editorState)}}},{key:"getFilter",value:function getFilter(){return this.filter.target}},{key:"getFilterEditor",value:function getFilterEditor(){return this.filterEditor.target}},{key:"getFilterColumn",value:function getFilterColumn(){return this.getFilter()?this.getFilter().column:null}},{key:"handleMissingSessionStateProperty",value:function handleMissingSessionStateProperty(newState,property){if(property=="editor")this._editorDiff={"layoutMode":"Combobox","showToggle":true}}},{key:"render",value:function render(){var _this2=this;var editorClass=LinkablePlaceholder.getClass(this.filterEditor.target);var editor=null;if(editorClass)editor=React.createElement(editorClass,{ref:function ref(editor){if(editor)LinkablePlaceholder.setInstance(_this2.filterEditor.target,editor)},filter:this.getFilter()});return React.createElement(VBox,{style:{flex:1},padded:true,className:"weave-data-filter"},React.createElement("div",{className:"weave-data-filter-checkbox"},React.createElement(Checkbox,{label:_weavejs.Weave.lang("Enabled"),value:this.getEnabled(),onChange:this.setEnabled})),React.createElement(VBox,{style:{flex:1},className:(0,_classnames2.default)("weave-data-filter-editor",{disabled:!this.getEnabled()})},editor))}},{key:"deprecatedStateMapping",get:function get(){return{"editor":this.filterEditor,"filter":this.filter}}},{key:"title",get:function get(){var column=this.getFilterColumn();if(column)return _weavejs.Weave.lang("Filter for {0}",ColumnUtils.getTitle(column));return _weavejs.Weave.lang("Filter")}},{key:"selectableAttributes",get:function get(){return new Map().set("Filter",this.getFilterColumn())}}]);return DataFilterTool}(React.Component);exports.default=DataFilterTool;DataFilterTool.WEAVE_INFO=_weavejs.Weave.setClassInfo(DataFilterTool,{id:"weavejs.tool.DataFilter",label:"Data Filter",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties],deprecatedIds:["weave.ui::DataFilterTool"]});var FILTER_TYPE={CONTINUOUS:"Continuous range",DISCRETE:"Discrete Values"};var DataFilterEditor=function(_React$Component2){_inherits(DataFilterEditor,_React$Component2);function DataFilterEditor(props){var _this3$filterEditorMa;_classCallCheck(this,DataFilterEditor);var _this3=_possibleConstructorReturn(this,(DataFilterEditor.__proto__||Object.getPrototypeOf(DataFilterEditor)).call(this,props));_this3.filterEditorMap=(_this3$filterEditorMa={},_defineProperty(_this3$filterEditorMa,FILTER_TYPE.CONTINUOUS,{editorClass:_NumericRangeDataFilterEditor2.default,options:_NumericRangeDataFilterEditor2.default.OPTIONS}),_defineProperty(_this3$filterEditorMa,FILTER_TYPE.DISCRETE,{editorClass:_DiscreteValuesDataFilterEditor2.default,options:_DiscreteValuesDataFilterEditor2.default.OPTIONS}),_this3$filterEditorMa);_this3.onFilterTypeChange=function(event){var key=event.target.value;var filterEditorItem=_this3.filterEditorMap[key];_this3.props.filterEditor.requestLocalObject(filterEditorItem.editorClass,false)};_this3.filterTypeSwitched=false;_this3.handleFilterTypeChange=function(selectedItem){if(selectedItem){var filterEditorItem=_this3.filterEditorMap[selectedItem];_this3.props.filterEditor.requestLocalObject(filterEditorItem.editorClass,false);_this3.filterTypeSwitched=true}};_this3.handleContinuousFilterOptionChange=function(isSelected){if(_this3.props.filterEditor.target){var forceDiscreteValues=_this3.props.filterEditor.target.forceDiscreteValues;forceDiscreteValues.state=isSelected}};_this3.handleDiscreteFilterOptionChange=function(selectedItem){if(_this3.props.filterEditor.target){_this3.props.filterEditor.target.layoutMode.state=selectedItem;_this3.last_discreteFilterLayoutMode=_this3.props.filterEditor.target.layoutMode.state}};_weavejs.Weave.getCallbacks(_this3.props.filterEditor).addGroupedCallback(_this3,_this3.forceUpdate);return _this3}_createClass(DataFilterEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){_weavejs.Weave.getCallbacks(this.props.filterEditor).removeCallback(this,this.forceUpdate)}},{key:"render",value:function render(){var labelStyle={textAlign:"right",display:"flex",justifyContent:"flex-end"};var selectedFilter;var selectedOption;var filterOptionUI=null;var filterEditorItem=null;if(this.props.filterEditor.target instanceof _NumericRangeDataFilterEditor2.default){selectedFilter=FILTER_TYPE.CONTINUOUS;filterEditorItem=this.filterEditorMap[FILTER_TYPE.CONTINUOUS];selectedOption=this.props.filterEditor.target.forceDiscreteValues.state;filterOptionUI=[React.createElement("span",{style:labelStyle}),React.createElement(Checkbox,{value:selectedOption,label:filterEditorItem.options[0],onChange:this.handleContinuousFilterOptionChange})];this.filterTypeSwitched=false}else if(this.props.filterEditor.target instanceof _DiscreteValuesDataFilterEditor2.default){selectedFilter=FILTER_TYPE.DISCRETE;filterEditorItem=this.filterEditorMap[FILTER_TYPE.DISCRETE];if(this.filterTypeSwitched)this.props.filterEditor.target.layoutMode.state=this.last_discreteFilterLayoutMode;selectedOption=this.props.filterEditor.target.layoutMode.state;filterOptionUI=[React.createElement("span",{style:labelStyle},_weavejs.Weave.lang("Layout")),React.createElement(ComboBox,{className:"weave-sidebar-dropdown",value:selectedOption,options:filterEditorItem.options,onChange:this.handleDiscreteFilterOptionChange})];this.filterTypeSwitched=false}var filterEditorMapKeys=Object.keys(this.filterEditorMap);var editorConfigs=[[React.createElement("span",{style:labelStyle},_weavejs.Weave.lang("Filter Type")),React.createElement(ComboBox,{className:"weave-sidebar-dropdown",value:selectedFilter,options:filterEditorMapKeys,onChange:this.handleFilterTypeChange})]];if(filterOptionUI){editorConfigs.push(filterOptionUI)}return ReactUtils.generateTable({body:_IVisTool2.default.renderSelectableAttributes(this.props.selectableAttributes,this.props.pushCrumb).concat(editorConfigs),classes:{td:["weave-left-cell","weave-right-cell"]}})}}]);return DataFilterEditor}(React.Component);

},{"react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/editor/AbstractFilterEditor":20,"weaveapp/editor/DiscreteValuesDataFilterEditor":33,"weaveapp/editor/NumericRangeDataFilterEditor":40,"weaveapp/modules/classnames":61,"weavejs":136}],74:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _WeaveProperties=require("weaveapp/WeaveProperties");var _WeaveProperties2=_interopRequireDefault(_WeaveProperties);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MiscUtils=weavejs.util.MiscUtils;var Button=weavejs.ui.Button;var LinkableString=weavejs.core.LinkableString;var LinkableDynamicObject=weavejs.core.LinkableDynamicObject;var DynamicKeyFilter=weavejs.data.key.DynamicKeyFilter;var WebSocketDataSource=weavejs.data.source.WebSocketDataSource;var KeySet=weavejs.data.key.KeySet;var DataMessageTool=function(_React$Component){_inherits(DataMessageTool,_React$Component);function DataMessageTool(props){_classCallCheck(this,DataMessageTool);var _this=_possibleConstructorReturn(this,(DataMessageTool.__proto__||Object.getPrototypeOf(DataMessageTool)).call(this,props));_this.panelTitle=_weavejs.Weave.linkableChild(_this,LinkableString);_this.messageTarget=_weavejs.Weave.linkableChild(_this,LinkableDynamicObject);_this.keySetSource=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.command=_weavejs.Weave.linkableChild(_this,LinkableString);_this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return React.createElement("div",null)};_this.sendMessage=function(){var ds=_weavejs.Weave.AS(_this.messageTarget.target,WebSocketDataSource);var ks=_weavejs.Weave.AS(_this.keySetSource.target,KeySet);var keyObjects=[];if(ks){keyObjects=ks.keys.map(function(key){return{keyType:key.keyType,localName:key.localName}})}var payload={command:_this.command.value,keys:keyObjects};ds.sendMessage(payload)};_this.keySetSource.targetPath=[_WeaveProperties2.default.DEFAULT_SELECTION_KEYSET];return _this}_createClass(DataMessageTool,[{key:"render",value:function render(){return React.createElement(Button,{onClick:this.sendMessage},_weavejs.Weave.lang("Send Message"))}},{key:"selectableAttributes",get:function get(){return new Map}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)||this.defaultPanelTitle}},{key:"defaultPanelTitle",get:function get(){return _weavejs.Weave.lang("Data Message Tool")}}]);return DataMessageTool}(React.Component);exports.default=DataMessageTool;DataMessageTool.WEAVE_INFO=_weavejs.Weave.setClassInfo(DataMessageTool,{id:"weavejs.tool.DataMessageTool",label:"Data Message Tool",interfaces:[_IVisTool2.default]});

},{"react":"react","weaveapp/WeaveProperties":3,"weaveapp/api/ui/IVisTool":11,"weavejs":136}],75:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _AbstractVisTool2=require("weaveapp/tool/AbstractVisTool");var _AbstractVisTool3=_interopRequireDefault(_AbstractVisTool2);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _MenuLayoutComponent=require("weaveapp/ui/MenuLayoutComponent");var _MenuLayoutComponent2=_interopRequireDefault(_MenuLayoutComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var List=weavejs.ui.List;var EditableTextCell=weavejs.ui.EditableTextCell;var MiscUtils=weavejs.util.MiscUtils;var ComboBox=weavejs.ui.ComboBox;var Checkbox=weavejs.ui.Checkbox;var Button=weavejs.ui.Button;var CenteredIcon=weavejs.ui.CenteredIcon;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var Tabs=weavejs.ui.Tabs;var Input=weavejs.ui.Input;var StatefulTextField=weavejs.ui.StatefulTextField;var ReactUtils=weavejs.util.ReactUtils;var LinkableHashMap=weavejs.core.LinkableHashMap;var LinkableVariable=weavejs.core.LinkableVariable;var LinkableDynamicObject=weavejs.core.LinkableDynamicObject;var LinkableString=weavejs.core.LinkableString;var ILinkableVariable=weavejs.api.core.ILinkableVariable;var LinkableBoolean=weavejs.core.LinkableBoolean;var LAYOUT_LIST="List";var LAYOUT_COMBO="ComboBox";var LAYOUT_VSLIDER="VSlider";var LAYOUT_HSLIDER="HSlider";var menuOptions=[LAYOUT_LIST,LAYOUT_COMBO,LAYOUT_HSLIDER,LAYOUT_VSLIDER];var SessionStateMenuTool=function(_AbstractVisTool){_inherits(SessionStateMenuTool,_AbstractVisTool);function SessionStateMenuTool(props){_classCallCheck(this,SessionStateMenuTool);var _this=_possibleConstructorReturn(this,(SessionStateMenuTool.__proto__||Object.getPrototypeOf(SessionStateMenuTool)).call(this,props));_this.selectedChoice=_weavejs.Weave.linkableChild(_this,LinkableString,_this.forceUpdate,true);_this.layoutMode=_weavejs.Weave.linkableChild(_this,new LinkableString(LAYOUT_LIST,_this.verifyLayoutMode),_this.forceUpdate,true);_this.autoRecord=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false),_this.forceUpdate);_this.choices=_weavejs.Weave.linkableChild(_this,new LinkableHashMap(LinkableVariable));_this.targets=_weavejs.Weave.linkableChild(_this,new LinkableHashMap(LinkableDynamicObject));_this.panelTitle=_weavejs.Weave.linkableChild(_this,LinkableString);_this.pendingApply=false;_this.getTargetStates=function(){var states={};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_this.targets.getObjects()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var wrapper=_step.value;if(!wrapper.target)continue;var targetName=_this.targets.getName(wrapper);states[targetName]=_weavejs.WeaveAPI.SessionManager.getSessionState(wrapper.target)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return states};_this.handleChoiceSelection=function(selectedValue){if(!selectedValue)return;var selection=Array.isArray(selectedValue)?selectedValue[0]:selectedValue;_this.selectedChoice.value=_this.choices.getName(selection);_this.setTargetStates(selection.state)};_this.handleChoices=function(){if(_weavejs.WeaveAPI.SessionManager.getCallbackCollection(_this).callbacksAreDelayed){_this.pendingApply=true;return}var choice=_this.choices.getObject(_this.selectedChoice.value);if(choice&&_weavejs.Weave.detectChange(_this.handleChoices,choice)){_this.setTargetStates(choice.getSessionState())}_this.forceUpdate()};_this.handleAutoRecord=function(){if(_this.autoRecord.value)_this.recordSelectedChoice()};_this.recordSelectedChoice=function(){var selectedName=_this.selectedChoice.value;if(selectedName){var choice=_this.choices.requestObject(selectedName,LinkableVariable,false);choice.setSessionState(_this.getTargetStates())}};_this.renderEditor=function(){return React.createElement(SessionStateMenuToolEditor,{sessionStateMenuTool:_this})};_this.choices.addGroupedCallback(_this,_this.handleChoices);_this.targets.addGroupedCallback(_this,_this.handleAutoRecord);_this.layoutMode.addGroupedCallback(_this,_this.forceUpdate);return _this}_createClass(SessionStateMenuTool,[{key:"verifyLayoutMode",value:function verifyLayoutMode(value){return menuOptions.indexOf(value)>=0}},{key:"setTargetStates",value:function setTargetStates(states){if(!states)return;this.targets.delayCallbacks();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.targets.getObjects(LinkableDynamicObject)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var wrapper=_step2.value;if(!wrapper.target)continue;var name=this.targets.getName(wrapper);if(states.hasOwnProperty(name))_weavejs.Weave.setState(wrapper.target,states[name])}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.targets.resumeCallbacks()}},{key:"render",value:function render(){if(this.autoRecord.value)this.recordSelectedChoice();var selectedChoice=this.choices.getObject(this.selectedChoice.value);return React.createElement(_MenuLayoutComponent2.default,{options:this.options,displayMode:this.layoutMode.value,onChange:this.handleChoiceSelection.bind(this),selectedItems:[selectedChoice]})}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)}},{key:"options",get:function get(){var _this2=this;return this.choices.getObjects(ILinkableVariable).map(function(choice){return{label:_this2.choices.getName(choice),value:choice}})}}]);return SessionStateMenuTool}(_AbstractVisTool3.default);exports.default=SessionStateMenuTool;SessionStateMenuTool.WEAVE_INFO=_weavejs.Weave.setClassInfo(SessionStateMenuTool,{id:"weavejs.tool.SessionStateMenu",label:"Session State Menu Tool",interfaces:[_IVisTool2.default],deprecatedIds:["weave.ui::SessionStateMenuTool"]});var SessionStateMenuToolEditor=function(_React$Component){_inherits(SessionStateMenuToolEditor,_React$Component);function SessionStateMenuToolEditor(props){_classCallCheck(this,SessionStateMenuToolEditor);var _this3=_possibleConstructorReturn(this,(SessionStateMenuToolEditor.__proto__||Object.getPrototypeOf(SessionStateMenuToolEditor)).call(this,props));_this3.removeSelectedChoice=function(choice,event){var ssmt=_this3.props.sessionStateMenuTool;if(choice){var allNames=ssmt.choices.getNames();var choiceName=ssmt.choices.getName(choice);var deleteIndex=allNames.indexOf(choiceName);if(deleteIndex<0)deleteIndex=allNames.length-1;ssmt.choices.removeObject(choiceName);if(choiceName==ssmt.selectedChoice.value){var newAllNames=ssmt.choices.getNames();var newSelectedName=newAllNames[Math.min(newAllNames.length-1,deleteIndex)];ssmt.selectedChoice.value=newSelectedName}}};_this3.addNewChoice=function(){var name=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var ssmt=_this3.props.sessionStateMenuTool;if(!name)name=ssmt.choices.generateUniqueName("Item");ssmt.selectedChoice.value=name;ssmt.recordSelectedChoice();return name};_this3.addNewChoiceItem=function(){var name=_this3.addNewChoice();_this3.props.sessionStateMenuTool.choices.getObject(name)};_this3.handleRename=function(newName){var ssmt=_this3.props.sessionStateMenuTool;var choiceBeingEdited=ssmt.choices.getObject(ssmt.selectedChoice.value);var oldName=ssmt.choices.getName(choiceBeingEdited);ssmt.selectedChoice.value=newName;ssmt.choices.renameObject(oldName,newName)};_this3.removeSelectedTarget=function(target){if(target){var name=_this3.props.sessionStateMenuTool.targets.getName(target);_this3.props.sessionStateMenuTool.targets.removeObject(name)}_this3.tidySavedStates()};_this3.addNewTargetPath=function(){var ssmt=_this3.props.sessionStateMenuTool;try{var path=JSON.parse(_this3.state.pathInput);if(!path)return;var wrapper=ssmt.targets.requestObject(null,LinkableDynamicObject,false);wrapper.targetPath=path;if(wrapper.target){_this3.setState({pathInput:""});_this3.tidySavedStates()}else{ssmt.targets.removeObject(ssmt.targets.getName(wrapper));_this3.setState({pathInput:_weavejs.Weave.lang("No target found")})}}catch(e){_this3.setState({pathInput:_weavejs.Weave.lang("Invalid path")})}};_this3.handlePathInput=function(event){_this3.setState({pathInput:event.target.value})};_this3.state={pathInput:null};return _this3}_createClass(SessionStateMenuToolEditor,[{key:"tidySavedStates",value:function tidySavedStates(){var _this4=this;this.props.sessionStateMenuTool.choices.getObjects().forEach(function(choice){var updated=false;var choiceState=choice.getSessionState()||{};var name=void 0;var targets=_this4.props.sessionStateMenuTool.targets;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=targets.getObjects()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var wrapper=_step3.value;if(!wrapper.target)continue;name=targets.getName(wrapper);if(!choiceState.hasOwnProperty(name)){choiceState[name]=_weavejs.WeaveAPI.SessionManager.getSessionState(wrapper.target);updated=true}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}for(var targetName in choiceState){if(!_this4.props.sessionStateMenuTool.targets.getObject(targetName)){delete choiceState[targetName];updated=true}}if(updated)choice.setSessionState(choiceState)})}},{key:"updateSelectedChoice",value:function updateSelectedChoice(choice,event){if(!_weavejs.Weave.wasDisposed(choice))this.props.sessionStateMenuTool.selectedChoice.value=this.props.sessionStateMenuTool.choices.getName(choice)}},{key:"getTargetList",value:function getTargetList(){var _this5=this;return this.props.sessionStateMenuTool.targets.getObjects().map(function(target,index){return{label:React.createElement(HBox,{key:index,style:{justifyContent:"space-between",alignItems:"center"}},React.createElement("span",{style:{overflow:"hidden"}},target.targetPath.join(", ")),React.createElement(CenteredIcon,{onClick:function onClick(){_this5.removeSelectedTarget(target)},iconProps:{className:"fa fa-times",title:"Delete this target"}})),value:target}})}},{key:"renderTargetItems",value:function renderTargetItems(){return React.createElement(VBox,{className:"weave-padded-vbox weave-container",style:{flex:1,border:"1px"}},React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},_weavejs.Weave.lang("Add target"),React.createElement(Input,{style:{flexGrow:0.5},placeholder:_weavejs.Weave.lang("Paste path here"),value:this.state.pathInput,onChange:this.handlePathInput}),React.createElement(Button,{onClick:this.addNewTargetPath},_weavejs.Weave.lang("Add"))),React.createElement(List,{options:this.getTargetList()}))}},{key:"renderMenuItems",value:function renderMenuItems(){var _this6=this;var ssmt=this.props.sessionStateMenuTool;var selectedOption;var menuItems=ssmt.choices.getObjects().map(function(choice){return{label:React.createElement(HBox,{ref:"choiceItem",style:{justifyContent:"space-between"},onClick:_this6.updateSelectedChoice.bind(_this6,choice)},React.createElement(EditableTextCell,{style:{flex:"1 0"},textContent:ssmt.choices.getName(choice),onChange:_this6.handleRename}),React.createElement(CenteredIcon,{ref:"deleteIcon",onClick:_this6.removeSelectedChoice.bind(_this6,choice),iconProps:{className:"fa fa-times",title:"Delete this choice"}})),value:choice}});if(ssmt.selectedChoice.value){selectedOption=ssmt.choices.getObject(ssmt.selectedChoice.value)}return React.createElement(VBox,null,React.createElement(Button,{style:{alignSelf:"flex-end"},onClick:this.addNewChoiceItem},_weavejs.Weave.lang("Add Choice")),React.createElement(List,{options:menuItems,selectedValues:[selectedOption]}))}},{key:"renderTargetsAndMenuItems",value:function renderTargetsAndMenuItems(){var tabs=new Map().set("Targets",this.renderTargetItems()).set("Menu Items",this.renderMenuItems());return React.createElement(Tabs,{labels:Array.from(tabs.keys()),tabs:Array.from(tabs.values())})}},{key:"renderTitleEditor",value:function renderTitleEditor(){return[[_weavejs.Weave.lang("Title"),React.createElement(StatefulTextField,{className:"ui input fluid",ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.sessionStateMenuTool.panelTitle})})]]}},{key:"render",value:function render(){var targetCount=this.props.sessionStateMenuTool.targets.getNames().length;return React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:"1 0"}},targetCount==0?_weavejs.Weave.lang("This menu tool will have no effect unless you add at least one target."):null,this.renderTargetsAndMenuItems(),ReactUtils.generateTable({body:[].concat(this.editorConfigs,this.renderTitleEditor()),classes:{td:["weave-left-cell","weave-right-cell"]}}))}},{key:"editorConfigs",get:function get(){return[[_weavejs.Weave.lang("Auto-update active menu item"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.sessionStateMenuTool.autoRecord}),label:" "})],[_weavejs.Weave.lang("Layout mode"),React.createElement(ComboBox,{className:"weave-sidebar-dropdown",ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.sessionStateMenuTool.layoutMode}),options:menuOptions})]]}}]);return SessionStateMenuToolEditor}(React.Component);

},{"react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/tool/AbstractVisTool":70,"weaveapp/ui/MenuLayoutComponent":122,"weavejs":136}],76:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractVisTool=require("weaveapp/tool/AbstractVisTool");var _AbstractVisTool2=_interopRequireDefault(_AbstractVisTool);var _ConfigUtils=require("weaveapp/util/ConfigUtils");var _ConfigUtils2=_interopRequireDefault(_ConfigUtils);var _SolidFillStyle=require("weaveapp/plot/SolidFillStyle");var _SolidFillStyle2=_interopRequireDefault(_SolidFillStyle);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _reactSparklines=require("react-sparklines");var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MiscUtils=weavejs.util.MiscUtils;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ReactUtils=weavejs.util.ReactUtils;var Accordion=weavejs.ui.Accordion;var ResizingDiv=weavejs.ui.ResizingDiv;var SmartComponent=weavejs.ui.SmartComponent;var ComboBox=weavejs.ui.ComboBox;var Checkbox=weavejs.ui.Checkbox;var ToolTip=weavejs.ui.ToolTip;var LinkableString=weavejs.core.LinkableString;var LinkableNumber=weavejs.core.LinkableNumber;var LinkableHashMap=weavejs.core.LinkableHashMap;var DynamicColumn=weavejs.data.column.DynamicColumn;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var KeySet=weavejs.data.key.KeySet;var FilteredKeySet=weavejs.data.key.FilteredKeySet;var DynamicKeyFilter=weavejs.data.key.DynamicKeyFilter;var LinkableBoolean=weavejs.core.LinkableBoolean;var ColumnUtils=weavejs.data.ColumnUtils;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var LINE="line";var BARS="bars";var CURVE="curve";var CHART_MODES=[{label:"Line",value:LINE},{label:"Bars",value:BARS},{label:"Curve",value:CURVE}];var COLUMN="column";var RECORD="record";var ORIENTATION_MODES=[{label:"Column Oriented",value:COLUMN},{label:"Record Oriented",value:RECORD}];var NONE=null;var MIN="max";var MAX="min";var MEAN="mean";var AVG="avg";var MEDIAN="median";var REFERENCELINE_MODES=[{label:"(None)",value:NONE},{label:"Min",value:MIN},{label:"Max",value:MAX},{label:"Mean",value:MEAN},{label:"Average",value:AVG},{label:"Median",value:MEDIAN}];var Sparkline=function(_SmartComponent){_inherits(Sparkline,_SmartComponent);function Sparkline(props){_classCallCheck(this,Sparkline);var _this=_possibleConstructorReturn(this,(Sparkline.__proto__||Object.getPrototypeOf(Sparkline)).call(this,props));_this.columns=_weavejs.Weave.linkableChild(_this,new LinkableHashMap(IAttributeColumn));_this.sortColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.labelColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.chartType=_weavejs.Weave.linkableChild(_this,new LinkableString(LINE,_this.verifyChartMode));_this.orientationMode=_weavejs.Weave.linkableChild(_this,new LinkableString(COLUMN,_this.verifyOrientationMode));_this.referenceLineMode=_weavejs.Weave.linkableChild(_this,new LinkableString(NONE,_this.verifyReferenceLineMode));_this.showAllRecords=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.showRowLabels=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(true));_this.showNormalBands=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.fill=_weavejs.Weave.linkableChild(_this,_SolidFillStyle2.default);_this.line=_weavejs.Weave.linkableChild(_this,_SolidLineStyle2.default);_this.marginTop=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0));_this.marginBottom=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0));_this.marginLeft=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0));_this.marginRight=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0));_this.panelTitle=_weavejs.Weave.linkableChild(_this,LinkableString);_this.altText=_weavejs.Weave.linkableChild(_this,new LinkableString(_this.panelTitle.value));_this.selectionFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.probeFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.filteredKeySet=_weavejs.Weave.linkableChild(_this,FilteredKeySet);_this.renderEditor=function(pushCrumb){var columns=_this.columns.getObjects(IAttributeColumn);return Accordion.render([_weavejs.Weave.lang("Data"),_IVisTool2.default.renderSelectableAttributes(_this.selectableAttributes,pushCrumb)],[_weavejs.Weave.lang("Display"),[[_weavejs.Weave.lang("Type"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.chartType}),options:CHART_MODES})],[_weavejs.Weave.lang("Orientation"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.orientationMode}),options:ORIENTATION_MODES,type:columns.length<=1?"disabled":null})],[_weavejs.Weave.lang("Reference line"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.referenceLineMode}),options:REFERENCELINE_MODES})],[_weavejs.Weave.lang("Show normal bands"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.showNormalBands}),label:" "})],[_weavejs.Weave.lang("Show line labels"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.showRowLabels}),label:" "})],[_weavejs.Weave.lang("Show All Records"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.showAllRecords}),label:" ",disabled:_this.orientationMode.value==COLUMN})]]],[_weavejs.Weave.lang("Title"),_this.getTitleEditor()],[_weavejs.Weave.lang("Margins"),_this.getMarginEditor()],[_weavejs.Weave.lang("Accessibility"),_this.getAltTextEditor()])};_this.handleResize=function(newSize){_this.setState({width:newSize.width,height:newSize.height})};_this.handleClick=function(record,event){if(_this.orientationMode.value==COLUMN||!_this.selectionKeySet)return;var currentSelection=_this.selectionKeySet.keys;if(_.includes(currentSelection,record.id)){currentSelection=_.difference(currentSelection,[record.id]);_this.selectionKeySet.replaceKeys(currentSelection)}else{if(event.ctrlKey||event.metaKey)_this.selectionKeySet.addKeys([record.id]);else _this.selectionKeySet.replaceKeys([record.id])}};_this.handleProbe=function(record,mouseOver,event){if(_this.orientationMode.value==COLUMN||!_this.probeKeySet)return;if(mouseOver){_this.probeKeySet.replaceKeys([record.id])}else{_this.probeKeySet.replaceKeys([])}var columns=_this.columns.getObjects(IAttributeColumn);_this.toolTip.show(_this,event.nativeEvent,_this.probeKeySet.keys,columns)};_weavejs.Weave.getCallbacks(_this).addGroupedCallback(_this,_this.forceUpdate);_this.line.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.fill.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.columns.addGroupedCallback(_this,_this.dataChanged,true);_this.sortColumn.addGroupedCallback(_this,_this.dataChanged,true);_this.labelColumn.addGroupedCallback(_this,_this.dataChanged,true);_this.orientationMode.addGroupedCallback(_this,_this.dataChanged,true);_this.showAllRecords.addGroupedCallback(_this,_this.dataChanged,true);_this.filteredKeySet.addGroupedCallback(_this,_this.dataChanged,true);_this.selectionFilter.addGroupedCallback(_this,_this.dataChanged,true);_this.probeFilter.addGroupedCallback(_this,_this.dataChanged,true);_this.chartType.addGroupedCallback(_this,_this.forceUpdate,true);_this.showRowLabels.addGroupedCallback(_this,_this.forceUpdate,true);_this.showNormalBands.addGroupedCallback(_this,_this.forceUpdate,true);_this.referenceLineMode.addGroupedCallback(_this,_this.forceUpdate,true);_this.marginTop.addGroupedCallback(_this,_this.forceUpdate,true);_this.marginBottom.addGroupedCallback(_this,_this.forceUpdate,true);_this.marginLeft.addGroupedCallback(_this,_this.forceUpdate,true);_this.marginRight.addGroupedCallback(_this,_this.forceUpdate,true);_this.state={data:[],width:props.width,height:props.height};return _this}_createClass(Sparkline,[{key:"verifyChartMode",value:function verifyChartMode(mode){return[LINE,BARS,CURVE].indexOf(mode)>=0}},{key:"verifyOrientationMode",value:function verifyOrientationMode(mode){return[COLUMN,RECORD].indexOf(mode)>=0}},{key:"verifyReferenceLineMode",value:function verifyReferenceLineMode(mode){return[NONE,MIN,MAX,MEAN,AVG,MEDIAN].indexOf(mode)>=0}},{key:"isSelected",value:function isSelected(key){var keySet=this.selectionFilter.target;return keySet instanceof KeySet&&keySet.containsKey(key)}},{key:"isProbed",value:function isProbed(key){var keySet=this.probeFilter.target;return keySet instanceof KeySet&&keySet.containsKey(key)}},{key:"initSelectableAttributes",value:function initSelectableAttributes(input){_AbstractVisTool2.default.initSelectableAttributes(this.selectableAttributes,input)}},{key:"getTitleEditor",value:function getTitleEditor(){var _this2=this;return[[_weavejs.Weave.lang("Chart"),this.panelTitle,this.defaultPanelTitle]].map(function(row){return[_weavejs.Weave.lang(row[0]),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(_this2,{value:row[1]}),placeholder:row[2]})]})}},{key:"getMarginEditor",value:function getMarginEditor(){return[[_weavejs.Weave.lang("Margins"),React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},_ConfigUtils2.default.renderNumberEditor(this.marginLeft,1),React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1}},_ConfigUtils2.default.renderNumberEditor(this.marginTop,null),_ConfigUtils2.default.renderNumberEditor(this.marginBottom,null)),_ConfigUtils2.default.renderNumberEditor(this.marginRight,1))]]}},{key:"getAltTextEditor",value:function getAltTextEditor(){return[[_weavejs.Weave.lang("Alt Text"),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.altText}),placeholder:_weavejs.Weave.lang("Enter text description of chart")})]]}},{key:"componentDidUpdate",value:function componentDidUpdate(){}},{key:"componentDidMount",value:function componentDidMount(){this.toolTip=ReactUtils.openPopup(this,React.createElement(ToolTip,null))}},{key:"componentWillUnmount",value:function componentWillUnmount(){ReactUtils.closePopup(this.toolTip)}},{key:"dataChanged",value:function dataChanged(){var _this3=this;var data=void 0;var columns=this.columns.getObjects(IAttributeColumn);var names=this.columns.getNames();this.filteredKeySet.setColumnKeySources(columns);if(_weavejs.WeaveAPI.Locale.reverseLayout){columns.reverse();names.reverse()}if(columns.length){var format=_.zipObject(names,columns);format=_.assign(format,{id:IQualifiedKey,sort:this.sortColumn,fill:{color:this.fill.color},line:{color:this.line.color}});var datatype={sort:Number,fill:{color:String},line:{color:String}};names.forEach(function(name,index){datatype[name]=Number});this.records=ColumnUtils.getRecords(format,this.filteredKeySet.keys,datatype);this.records=_.sortByOrder(this.records,["sort"],["asc"]);if(this.records.length){if(columns.length==1){data=[this.records.map(function(record,index){return record[names[0]]})]}else{if(this.orientationMode.value==COLUMN){data=names.map(function(name,index){return _this3.records.map(function(record,i){return record[name]})})}else if(this.orientationMode.value==RECORD){if(!this.showAllRecords.value){var records=this.getInteractedRecords();data=records&&records.map(function(record,index){return names.map(function(name,index){return record[name]})})}else{data=this.records.map(function(record,index){return names.map(function(name,i){return record[name]})})}}}}}this.setState({data:data})}},{key:"getInteractedRecords",value:function getInteractedRecords(){var _this4=this;var probeKeys=this.probeKeySet&&this.probeKeySet.keys;var selectedKeys=this.selectionKeySet&&this.selectionKeySet.keys;var records=[];if(probeKeys&&probeKeys.length){records=probeKeys.map(function(key,index){return _.find(_this4.records,function(record){return record.id===key})})}else if(selectedKeys&&selectedKeys.length){records=selectedKeys.map(function(key,index){return _.find(_this4.records,function(record){return record.id===key})})}return _.sortByOrder(records,["sort"],["asc"])}},{key:"getReferenceLineComponent",value:function getReferenceLineComponent(mode){switch(mode){case NONE:break;default:return React.createElement(_reactSparklines.SparklinesReferenceLine,{type:mode});}}},{key:"getLineComponent",value:function getLineComponent(mode,style){switch(mode){case LINE:return React.createElement(_reactSparklines.SparklinesLine,{style:style});case BARS:return React.createElement(_reactSparklines.SparklinesBars,{style:style});case CURVE:return React.createElement(_reactSparklines.SparklinesCurve,{style:style});}}},{key:"getSparklines",value:function getSparklines(){var rows=[]}},{key:"render",value:function render(){var _this5=this;return React.createElement(ResizingDiv,{style:{flex:1,whiteSpace:"nowrap",marginTop:this.marginTop.value,marginBottom:this.marginBottom.value,marginLeft:this.marginLeft.value,marginRight:this.marginRight.value},onResize:this.handleResize,onMouseLeave:function onMouseLeave(){return _this5.toolTip.hide()}},this.state.width&&this.state.height?React.createElement(VBox,{style:{flex:1,overflow:"auto",height:"100%"}},this.state.data&&this.state.data.map(function(data,index){var style={};var label=void 0;var referenceLineKey=_this5.referenceLineMode.value?_this5.referenceLineMode.value:"custom";var normalBandKey=_this5.showNormalBands.value?"yes":"no";var interactedRecords=_this5.getInteractedRecords();var interactive=!_this5.showAllRecords.value;if(_this5.orientationMode.value==RECORD){var record=_this5.records&&_this5.records[index];if(interactive){record=interactedRecords[index]}var selectionEmpty=!_this5.selectionKeySet||_this5.selectionKeySet.keys.length===0;var selected=record&&_this5.isSelected(record.id);var probed=record&&_this5.isProbed(record.id);style=_.assign(style,{stroke:record.line.color,strokeWidth:probed?3:selected?2:null,strokeOpacity:selectionEmpty||selected||probed?1:0.1,fill:record.fill.color,fillOpacity:selectionEmpty||selected||probed?0.8:0.1});label=record.id.toString()}else{var columns=_this5.columns.getObjects(IAttributeColumn);label=_weavejs.Weave.lang(ColumnUtils.getTitle(columns[index]));style={}}return React.createElement(VBox,{key:index,style:{flex:1,overflow:"hidden",position:"relative"},onClick:_this5.handleClick.bind(_this5,_this5.records&&(interactive?interactedRecords&&interactedRecords[index]:_this5.records[index])),onMouseMove:_this5.handleProbe.bind(_this5,_this5.records&&(interactive?interactedRecords&&interactedRecords[index]:_this5.records[index]),true),onMouseOut:_this5.handleProbe.bind(_this5,_this5.records&&(interactive?interactedRecords&&interactedRecords[index]:_this5.records[index]),false)},React.createElement("span",{style:{position:"absolute",top:0,left:0}},_this5.showRowLabels.value?label:""),React.createElement(_reactSparklines.Sparklines,{key:_this5.chartType.value.concat(referenceLineKey,normalBandKey,String(_this5.probeKeySet&&_this5.probeKeySet.keys),String(_this5.selectionKeySet&&_this5.selectionKeySet.keys)),data:data,width:_this5.state.width,height:_this5.state.height/_this5.state.data.length},_this5.getLineComponent(_this5.chartType.value,style),React.createElement(_reactSparklines.SparklinesNormalBand,{style:{fill:"red",fillOpacity:_this5.showNormalBands.value?.1:0}}),React.createElement(_reactSparklines.SparklinesReferenceLine,{type:referenceLineKey,value:0,style:{stroke:"red",strokeOpacity:_this5.referenceLineMode.value?.75:0,strokeDasharray:"2, 2"}})))})):"")}},{key:"selectionKeySet",get:function get(){return this.selectionFilter.getInternalKeyFilter()}},{key:"probeKeySet",get:function get(){return this.probeFilter.getInternalKeyFilter()}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)||this.defaultPanelTitle}},{key:"selectableAttributes",get:function get(){return new Map().set("Columns",this.columns).set("Sort",this.sortColumn)}},{key:"defaultPanelTitle",get:function get(){var columns=this.columns.getObjects();if(columns.length==0)return _weavejs.Weave.lang("Sparkline");return _weavejs.Weave.lang("Sparkline of {0}",columns.map(function(column){return ColumnUtils.getTitle(column)}).join(_weavejs.Weave.lang(", ")))}},{key:"deprecatedStateMapping",get:function get(){return{"columns":this.columns,"sortColumn":this.sortColumn}}}]);return Sparkline}(SmartComponent);exports.default=Sparkline;Sparkline.WEAVE_INFO=_weavejs.Weave.setClassInfo(Sparkline,{id:"weavejs.tool.Sparkline",label:"Sparkline",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.tools::Sparkline"]});

},{"lodash":"lodash","react":"react","react-sparklines":"react-sparklines","weaveapp/api/ui/IVisTool":11,"weaveapp/plot/SolidFillStyle":68,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/AbstractVisTool":70,"weaveapp/util/ConfigUtils":132,"weavejs":136}],77:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AttributeColumnTable=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _AbstractVisTool=require("weaveapp/tool/AbstractVisTool");var _AbstractVisTool2=_interopRequireDefault(_AbstractVisTool);var _PrintUtils=require("weaveapp/util/PrintUtils");var _PrintUtils2=_interopRequireDefault(_PrintUtils);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _DataTable2=require("weaveapp/ui/DataTable");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Menu=weavejs.ui.menu.Menu;var MiscUtils=weavejs.util.MiscUtils;var ReactUtils=weavejs.util.ReactUtils;var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var Checkbox=weavejs.ui.Checkbox;var FilteredKeySet=weavejs.data.key.FilteredKeySet;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var LinkableHashMap=weavejs.core.LinkableHashMap;var LinkableString=weavejs.core.LinkableString;var LinkableNumber=weavejs.core.LinkableNumber;var LinkableBoolean=weavejs.core.LinkableBoolean;var DynamicKeyFilter=weavejs.data.key.DynamicKeyFilter;var ColumnUtils=weavejs.data.ColumnUtils;var EventCallbackCollection=weavejs.core.EventCallbackCollection;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var KeyColumn=weavejs.data.column.KeyColumn;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var AttributeColumnTable=exports.AttributeColumnTable=function(_DataTable){_inherits(AttributeColumnTable,_DataTable);function AttributeColumnTable(){_classCallCheck(this,AttributeColumnTable);return _possibleConstructorReturn(this,(AttributeColumnTable.__proto__||Object.getPrototypeOf(AttributeColumnTable)).apply(this,arguments))}return AttributeColumnTable}(_DataTable2.DataTable);var TableTool=function(_React$Component){_inherits(TableTool,_React$Component);function TableTool(props){_classCallCheck(this,TableTool);var _this2=_possibleConstructorReturn(this,(TableTool.__proto__||Object.getPrototypeOf(TableTool)).call(this,props));_this2.columns=_weavejs.Weave.linkableChild(_this2,new LinkableHashMap(IAttributeColumn));_this2.sortFieldIndex=_weavejs.Weave.linkableChild(_this2,new LinkableNumber(0));_this2.columnWidth=_weavejs.Weave.linkableChild(_this2,new LinkableNumber(85));_this2.rowHeight=_weavejs.Weave.linkableChild(_this2,new LinkableNumber(30));_this2.headerHeight=_weavejs.Weave.linkableChild(_this2,new LinkableNumber(30));_this2.sortInDescendingOrder=_weavejs.Weave.linkableChild(_this2,new LinkableBoolean(false));_this2.panelTitle=_weavejs.Weave.linkableChild(_this2,new LinkableString);_this2.selectionFilter=_weavejs.Weave.linkableChild(_this2,DynamicKeyFilter);_this2.probeFilter=_weavejs.Weave.linkableChild(_this2,DynamicKeyFilter);_this2.filteredKeySet=_weavejs.Weave.linkableChild(_this2,FilteredKeySet);_this2.altText=_weavejs.Weave.linkableChild(_this2,new LinkableString(_this2.panelTitle.value));_this2.idProperty="";_this2.handleShowKeyColumn=function(value){if(value){var keyCols=_this2.columns.getObjects(KeyColumn);if(keyCols.length==0){var nameOrder=_this2.columns.getNames();_this2.columns.requestObject(null,KeyColumn);_this2.columns.setNameOrder(nameOrder)}}else{var keyColNames=_this2.columns.getNames(KeyColumn);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=keyColNames[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var keyColName=_step.value;_this2.columns.removeObject(keyColName)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}};_this2.handleProbe=function(ids){if(!_this2.probeKeySet)return;if(ids&&ids.length)_this2.probeKeySet.replaceKeys(ids&&ids.map(function(id){return _weavejs.WeaveAPI.QKeyManager.stringToQKey(id)}));else _this2.probeKeySet.clearKeys()};_this2.handleSelection=function(ids){_this2.selectionKeySet.replaceKeys(ids&&ids.map(function(id){return _weavejs.WeaveAPI.QKeyManager.stringToQKey(id)}))};_this2.renderEditor=function(pushCrumb){return ReactUtils.generateTable({body:_IVisTool2.default.renderSelectableAttributes(_this2.selectableAttributes,pushCrumb).concat(_this2.getTitlesEditor()).concat([[_weavejs.Weave.lang("Show Key Column"),React.createElement(Checkbox,{label:" ",onChange:_this2.handleShowKeyColumn,value:_this2.keyColumnShown})]]),classes:{td:["weave-left-cell","weave-right-cell"]}})};_this2.onSort=function(columnKey,sortDirection){_this2.sortFieldIndex.value=_this2.columns.getNames().indexOf(columnKey);_this2.sortInDescendingOrder.value=sortDirection==_DataTable2.SortTypes.DESC};_this2.events=_weavejs.Weave.linkableChild(_this2,new EventCallbackCollection);_this2.handleCellDoubleClick=function(rowId,columnKey){var key=_weavejs.WeaveAPI.QKeyManager.stringToQKey(rowId);var column=_this2.columns.getObject(columnKey);_this2.events.dispatch({key:key,column:column})};_this2.getCellValue=function(row,columnKey){if(columnKey===null){return row.toString()}else{var column=_this2.columns.getObject(columnKey);return column.getValueFromKey(row,String)}};_this2.getColumnTitle=function(columnKey){if(columnKey===null){return _weavejs.Weave.lang("Key")}else{var column=_this2.columns.getObject(columnKey);return column&&_weavejs.Weave.lang(column.getMetadata(ColumnMetadata.TITLE))}};_weavejs.Weave.getCallbacks(_this2).addGroupedCallback(_this2,_this2.forceUpdate);_this2.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this2.selectionFilter.targetPath=["defaultSelectionKeySet"];_this2.probeFilter.targetPath=["defaultProbeKeySet"];_this2.columns.addGroupedCallback(_this2,_this2.dataChanged,true);_this2.sortFieldIndex.addGroupedCallback(_this2,_this2.dataChanged,true);_this2.sortInDescendingOrder.addGroupedCallback(_this2,_this2.dataChanged,true);_this2.filteredKeySet.addGroupedCallback(_this2,_this2.dataChanged,true);_this2.selectionFilter.addGroupedCallback(_this2,_this2.forceUpdate);_this2.probeFilter.addGroupedCallback(_this2,_this2.forceUpdate);_this2.state={width:0,height:0};return _this2}_createClass(TableTool,[{key:"componentDidMount",value:function componentDidMount(){Menu.registerMenuSource(this)}},{key:"componentDidUpdate",value:function componentDidUpdate(){}},{key:"getMenuItems",value:function getMenuItems(){var _this3=this;var menuItems=_AbstractVisTool2.default.getMenuItems(this);if(this.selectionKeySet&&this.selectionKeySet.keys.length){menuItems.push({label:_weavejs.Weave.lang("Move selected to top"),click:function click(){return _this3.attributeColumnTable.moveSelectedToTop()}})}if(_weavejs.Weave.beta)menuItems.push({label:_weavejs.Weave.lang("Print Tool (Beta)"),click:_PrintUtils2.default.printTool.bind(null,ReactDOM.findDOMNode(this))});return menuItems}},{key:"dataChanged",value:function dataChanged(){var _this4=this;var columns=this.columns.getObjects(IAttributeColumn);var names=this.columns.getNames();var sortDirections=columns.map(function(column,index){if(_this4.sortFieldIndex.value==index){if(_this4.sortInDescendingOrder.value){return-1}return 1}return 0});this.filteredKeySet.setColumnKeySources(columns,sortDirections)}},{key:"initSelectableAttributes",value:function initSelectableAttributes(input){var _this5=this;input.slice(0,TableTool.MAX_DEFAULT_COLUMNS).forEach(function(item,i){return ColumnUtils.initSelectableAttribute(_this5.columns,item,i==0)})}},{key:"getTitlesEditor",value:function getTitlesEditor(){var _this6=this;return[["Title",this.panelTitle,this.defaultPanelTitle]].map(function(row){return[_weavejs.Weave.lang(row[0]),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(_this6,{value:row[1]}),placeholder:row[2]})]})}},{key:"render",value:function render(){var _this7=this;var columnNames=this.columns.getNames(IAttributeColumn);if(_weavejs.WeaveAPI.Locale.reverseLayout)columnNames.reverse();return React.createElement(AttributeColumnTable,{columnTitles:this.getColumnTitle,rows:this.filteredKeySet.keys,idProperty:function idProperty(key){return key.toString()},getCellValue:this.getCellValue,selectedIds:this.selectionKeySet&&this.selectionKeySet.keys.map(String),probedIds:this.probeKeySet&&this.probeKeySet.keys.map(String),sortId:columnNames[this.sortFieldIndex.value],sortDirection:this.sortInDescendingOrder.value==true?_DataTable2.SortTypes.DESC:_DataTable2.SortTypes.ASC,onHover:this.handleProbe,onSelection:this.handleSelection,onCellDoubleClick:this.handleCellDoubleClick,columnIds:columnNames,rowHeight:this.rowHeight.value,headerHeight:this.headerHeight.value,initialColumnWidth:this.columnWidth.value,evenlyExpandRows:true,allowResizing:true,onSortCallback:this.onSort,ref:function ref(c){_this7.attributeColumnTable=c}})}},{key:"selectionKeySet",get:function get(){return this.selectionFilter.getInternalKeyFilter()}},{key:"probeKeySet",get:function get(){return this.probeFilter.getInternalKeyFilter()}},{key:"deprecatedStateMapping",get:function get(){return{showKeyColumn:this.handleShowKeyColumn}}},{key:"keyColumnShown",get:function get(){var keyCols=this.columns.getObjects(KeyColumn);return keyCols.length>0}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)||this.defaultPanelTitle}},{key:"selectableAttributes",get:function get(){return new Map().set("Columns",this.columns)}},{key:"defaultPanelTitle",get:function get(){var columns=this.columns.getObjects();if(columns.length==0)return _weavejs.Weave.lang("Table");return _weavejs.Weave.lang("Table of {0}",columns.map(function(column){return ColumnUtils.getTitle(column)}).join(_weavejs.Weave.lang(", ")))}}]);return TableTool}(React.Component);exports.default=TableTool;TableTool.WEAVE_INFO=_weavejs.Weave.setClassInfo(TableTool,{id:"weavejs.tool.TableTool",label:"Table",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.tools::TableTool","weave.visualization.tools::AdvancedTableTool"]});TableTool.MAX_DEFAULT_COLUMNS=10;

},{"react":"react","react-dom":"react-dom","weaveapp/api/ui/IVisTool":11,"weaveapp/tool/AbstractVisTool":70,"weaveapp/ui/DataTable":117,"weaveapp/util/PrintUtils":134,"weavejs":136}],78:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MiscUtils=weavejs.util.MiscUtils;var VBox=weavejs.ui.flexbox.VBox;var StatefulTextField=weavejs.ui.StatefulTextField;var StatefulTextArea=weavejs.ui.StatefulTextArea;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ReactUtils=weavejs.util.ReactUtils;var StandardLib=weavejs.util.StandardLib;var LinkableString=weavejs.core.LinkableString;var LinkableNumber=weavejs.core.LinkableNumber;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var TextTool=function(_React$Component){_inherits(TextTool,_React$Component);function TextTool(props){_classCallCheck(this,TextTool);var _this=_possibleConstructorReturn(this,(TextTool.__proto__||Object.getPrototypeOf(TextTool)).call(this,props));_this.htmlText=_weavejs.Weave.linkableChild(_this,new LinkableString(""));_this.padding=_weavejs.Weave.linkableChild(_this,new LinkableNumber(4));_this.panelBackgroundColor=_weavejs.Weave.linkableChild(_this,LinkableNumber);_this.panelBorderColor=_weavejs.Weave.linkableChild(_this,LinkableNumber);_this.panelTitle=_weavejs.Weave.linkableChild(_this,LinkableString);_this.altText=_weavejs.Weave.linkableChild(_this,new LinkableString(_this.panelTitle.value));_this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return React.createElement(VBox,null,ReactUtils.generateTable({body:[].concat(_this.getTitlesEditor(),[[_weavejs.Weave.lang("Text"),React.createElement(StatefulTextArea,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.htmlText})})],["",React.createElement("span",null,_weavejs.Weave.lang("Use '<br>' for a new line"))]]),classes:{td:["weave-left-cell","weave-right-cell"]}}))};_this.textToolContainerClass="text-tool-container";_this.htmlText.addGroupedCallback(_this,_this.forceUpdate);_this.padding.addGroupedCallback(_this,_this.forceUpdate);_this.panelBackgroundColor.addGroupedCallback(_this,_this.forceUpdate);_this.panelBorderColor.addGroupedCallback(_this,_this.forceUpdate);return _this}_createClass(TextTool,[{key:"getTitlesEditor",value:function getTitlesEditor(){var _this2=this;return[[_weavejs.Weave.lang("Chart"),this.panelTitle,this.defaultPanelTitle]].map(function(row){return[_weavejs.Weave.lang(row[0]),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(_this2,{value:row[1]}),placeholder:row[2]})]})}},{key:"componentDidUpdate",value:function componentDidUpdate(){var _this3=this;(0,_jquery2.default)(this.element).empty();var htmlElements=_jquery2.default.parseHTML("<div>"+MiscUtils.evalTemplateString(this.htmlText.value,this)+"</div>",null,false);if(htmlElements){htmlElements.forEach(function(element){if(element.outerHTML)(0,_jquery2.default)(_this3.element).append(element.outerHTML)})}}},{key:"render",value:function render(){var _this4=this;var bgColor=this.panelBackgroundColor.value?StandardLib.getHexColor(this.panelBackgroundColor.value):"#FFFFFF";return React.createElement("div",{style:{flex:1,padding:this.padding.value,backgroundColor:bgColor,overflow:"auto"},ref:function ref(c){_this4.element=c},className:this.textToolContainerClass})}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)||this.defaultPanelTitle}},{key:"selectableAttributes",get:function get(){return new Map}},{key:"defaultPanelTitle",get:function get(){return _weavejs.Weave.lang("Text Tool")}},{key:"deprecatedStateMapping",get:function get(){return{"htmlText":this.htmlText,"padding":this.padding,"panelBackgroundColor":this.panelBackgroundColor,"panelBorderColor":this.panelBorderColor}}}]);return TextTool}(React.Component);exports.default=TextTool;TextTool.WEAVE_INFO=_weavejs.Weave.setClassInfo(TextTool,{id:"weavejs.tool.Text",label:"Text",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties],deprecatedIds:["weave.ui::TextTool"]});

},{"react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/modules/jquery":63,"weavejs":136}],79:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _d=require("d3");var d3=_interopRequireWildcard(_d);var _AbstractVisTool2=require("weaveapp/tool/AbstractVisTool");var _AbstractVisTool3=_interopRequireDefault(_AbstractVisTool2);var _C3Chart=require("weaveapp/tool/c3tool/C3Chart");var _C3Chart2=_interopRequireDefault(_C3Chart);var _PrintUtils=require("weaveapp/util/PrintUtils");var _PrintUtils2=_interopRequireDefault(_PrintUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DOMUtils=weavejs.util.DOMUtils;var MouseUtils=weavejs.util.MouseUtils;var ReactUtils=weavejs.util.ReactUtils;var ToolTip=weavejs.ui.ToolTip;var JS=weavejs.util.JS;function finiteOrNull(n){return isFinite(n)?n:null}var AbstractC3Tool=function(_AbstractVisTool){_inherits(AbstractC3Tool,_AbstractVisTool);function AbstractC3Tool(props){_classCallCheck(this,AbstractC3Tool);var _this=_possibleConstructorReturn(this,(AbstractC3Tool.__proto__||Object.getPrototypeOf(AbstractC3Tool)).call(this,props));_this.debouncedHandleC3Selection=_.debounce(_this.handleC3Selection.bind(_this),0);_this.debouncedHandleChange=_.debounce(_this.handleChange.bind(_this),30);var self=_this;_this.c3Config={size:{},padding:{top:0,bottom:0,left:0,right:0},interaction:{brighten:false},transition:{duration:0},tooltip:{show:false},data:{selection:{enabled:true,multiple:true,draggable:true},onselected:function onselected(d){if(_this.chart.internal.dragging)_this.debouncedHandleC3Selection()},onunselected:function onunselected(d){if(_this.chart.internal.dragging)_this.debouncedHandleC3Selection()},onmouseover:function onmouseover(d){if(d&&d.hasOwnProperty("index"))_this.handleC3MouseOver(d)},onmouseout:function onmouseout(d){if(d&&d.hasOwnProperty("index"))_this.handleC3MouseOut(d)}},onrendered:function onrendered(){self.handleC3Render()}};_this.xAxisClass={axis:"c3-axis-x",grid:"c3-xgrid"};_this.yAxisClass={axis:"c3-axis-y",grid:"c3-ygrid"};_this.y2AxisClass={axis:"c3-axis-y2",grid:"c3-ygrid"};_this.handlePointClick=_this.handlePointClick.bind(_this);_weavejs.Weave.getCallbacks(_this).addGroupedCallback(_this,_this.debouncedHandleChange,true);_weavejs.WeaveAPI.Scheduler.frameCallbacks.addImmediateCallback(_this,_this.validateSize);return _this}_createClass(AbstractC3Tool,[{key:"componentDidMount",value:function componentDidMount(){_get(AbstractC3Tool.prototype.__proto__||Object.getPrototypeOf(AbstractC3Tool.prototype),"componentDidMount",this).call(this);this.toolTip=ReactUtils.openPopup(this,React.createElement(ToolTip,null));MouseUtils.addPointClickListener(this.element,this.handlePointClick);this.validateSize();this.handleChange()}},{key:"componentWillUnmount",value:function componentWillUnmount(){ReactUtils.closePopup(this.toolTip);MouseUtils.removePointClickListener(this.element,this.handlePointClick)}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.validateSize()}},{key:"getMenuItems",value:function getMenuItems(){var menuItems=_AbstractVisTool3.default.getMenuItems(this);if(_weavejs.Weave.beta)menuItems.push({label:_weavejs.Weave.lang("Print Tool (Beta)"),click:_PrintUtils2.default.printTool.bind(null,this.element)});return menuItems}},{key:"validateSize",value:function validateSize(){if(!this.element||!this.chart)return;var chartWidth=this.chart.internal&&this.chart.internal.config&&this.chart.internal.config.size_width;var chartHeight=this.chart.internal&&this.chart.internal.config&&this.chart.internal.config.size_height;if(chartWidth!=this.element.clientWidth||chartHeight!=this.element.clientHeight){this.c3Config.size={width:this.element.clientWidth,height:this.element.clientHeight};if(this.chart)this.chart.resize({width:this.element.clientWidth,height:this.element.clientHeight})}this.cullAxes()}},{key:"render",value:function render(){var _this2=this;return React.createElement("div",{role:"img","aria-label":this.altText.text.value||this.getAutomaticDescription(),ref:function ref(c){_this2.element=c},style:{flex:1,overflow:"hidden"},onMouseLeave:function onMouseLeave(){return _this2.toolTip.hide()}},React.createElement(_C3Chart2.default,{config:JS.copyObject(this.c3Config,true),ref:function ref(c){_this2.chartComponent=c;_this2.chart=c&&c.chart;if(_this2.chart)_this2.handleC3Render()}}))}},{key:"mergeConfig",value:function mergeConfig(c3Config){_.merge(this.c3Config,c3Config)}},{key:"handleChange",value:function handleChange(){if(!_weavejs.Weave.wasDisposed(this)&&!_weavejs.Weave.isBusy(this)&&!this.busy&&this.validate(!this.chart)){this.busy=true;if(this.chart&&_.isEqual(this.chartComponent.props.config,this.c3Config))this.chart.flush();else this.forceUpdate()}}},{key:"handleC3Render",value:function handleC3Render(){var _this3=this;if(!this.chart)return;this.busy=false;this.handleChange();if(this.busy)return;this.cullAxes();if(this.element&&this.chart){(0,_jquery2.default)(this.element).find(".c3-chart").each(function(i,e){e.addEventListener("mouseout",function(event){_this3.handleC3MouseOut(event)})})}}},{key:"handleC3Selection",value:function handleC3Selection(){}},{key:"handleC3MouseOver",value:function handleC3MouseOver(d){}},{key:"handleC3MouseOut",value:function handleC3MouseOut(d){if(this.probeKeySet)this.probeKeySet.replaceKeys([]);this.toolTip.hide()}},{key:"validate",value:function validate(){var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return forced}},{key:"updateConfigMargin",value:function updateConfigMargin(){this.c3Config.padding.top=this.margin.top.value;if(this.c3Config.axis&&this.c3Config.axis.x)this.c3Config.axis.x.height=this.margin.bottom.value;else this.c3Config.padding.bottom=this.margin.bottom.value;if(_weavejs.WeaveAPI.Locale.reverseLayout){this.c3Config.padding.left=this.margin.right.value;this.c3Config.padding.right=this.margin.left.value}else{this.c3Config.padding.left=this.margin.left.value;this.c3Config.padding.right=this.margin.right.value}}},{key:"updateConfigAxisX",value:function updateConfigAxisX(){this.c3Config.axis.x.min=finiteOrNull(this.overrideBounds.xMin.value);this.c3Config.axis.x.max=finiteOrNull(this.overrideBounds.xMax.value)}},{key:"updateConfigAxisY",value:function updateConfigAxisY(){var yMin=finiteOrNull(this.overrideBounds.yMin.value);var yMax=finiteOrNull(this.overrideBounds.yMax.value);if(this.c3Config.axis.y){this.c3Config.axis.y.min=yMin;this.c3Config.axis.y.max=yMax}if(this.c3Config.axis.y2){this.c3Config.axis.y2.min=yMin;this.c3Config.axis.y2.max=yMax}}},{key:"handlePointClick",value:function handlePointClick(event){_AbstractVisTool3.default.handlePointClick(this,event)}},{key:"cullAxis",value:function cullAxis(axisSize,axisClass){var cullingMetric=this._getCullingMetrics(axisSize,axisClass.axis);var intervalForCulling=cullingMetric.interval;d3.select(this.element).selectAll("."+axisClass.axis+" .tick text").each(function(e,index){if(index>=0){d3.select(this).style("display",index%intervalForCulling?"none":"block")}});var gridCullingInterval=this.getInterval("."+axisClass.grid,cullingMetric.displayed);d3.select(this.element).selectAll("."+axisClass.grid).each(function(e,index){if(index>=0){d3.select(this).style("display",index%gridCullingInterval?"none":"block")}});var tickCullingInterval=this.getInterval("."+axisClass.axis+" .tick line",cullingMetric.displayed);d3.select(this.element).selectAll("."+axisClass.axis+" .tick line").each(function(e,index){if(index>=0){d3.select(this).style("display",index%tickCullingInterval?"none":"block")}})}},{key:"cullAxes",value:function cullAxes(){this.cullAxis(this.internalWidth,this.xAxisClass);this.cullAxis(this.internalHeight,_weavejs.WeaveAPI.Locale.reverseLayout?this.y2AxisClass:this.yAxisClass)}},{key:"customStyle",value:function customStyle(array,type,filter,style){var filtered=d3.select(this.element).selectAll(type).filter(filter);if(filtered.length){array.forEach(function(index){d3.select(filtered[0][index]).style(style)})}}},{key:"customSelectorStyle",value:function customSelectorStyle(array,selector,style){array.forEach(function(index){if(selector.length)d3.select(selector[0][index]).style(style)})}},{key:"_getCullingMetrics",value:function _getCullingMetrics(size,axisClass){var textHeight=DOMUtils.getTextHeight("test",this.getFontString());var labelsToShow=Math.floor(size/textHeight);labelsToShow=Math.max(2,labelsToShow);var tickValues=d3.select(this.element).selectAll("."+axisClass+" .tick text").size();return{interval:this.getInterval("."+axisClass+" .tick text",labelsToShow),total:tickValues,displayed:labelsToShow}}},{key:"getInterval",value:function getInterval(classSelector,requiredValues){var totalValues=d3.select(this.element).selectAll(classSelector).size();var interval;for(var i=1;i<totalValues;i++){if(totalValues/i<requiredValues){interval=i;break}}return interval}},{key:"getFontString",value:function getFontString(){return this.props.fontSize+"pt "+this.props.font}},{key:"getRotatedLabelHeight",value:function getRotatedLabelHeight(label,angle){var labelLengthRatio=Math.cos(Math.abs(angle)*(Math.PI/180));var labelHeightRatio=Math.sin(Math.abs(angle)*(Math.PI/180));var stringHeightFromLength=DOMUtils.getTextWidth(label,this.getFontString())*labelLengthRatio;var stringHeightFromHeight=DOMUtils.getTextHeight(label,this.getFontString())*labelHeightRatio;return stringHeightFromHeight+stringHeightFromLength}},{key:"centerEllipseString",value:function centerEllipseString(str,adj,replacement){var middleIndex=Math.floor(str.length/2);var startCut=middleIndex-Math.floor(adj/2);var endCut=middleIndex+Math.floor(adj/2)+adj%2;return str.slice(0,startCut)+replacement+str.slice(endCut)}},{key:"formatXAxisLabel",value:function formatXAxisLabel(label,angle){if(Array.isArray(label)&&label.length)label=label[0];var adjustment=0;var labelHeight=this.getRotatedLabelHeight(label,angle);var truncatedLabel=label;while(labelHeight>this.margin.bottom.value-20&&adjustment<label.length){adjustment++;truncatedLabel=this.centerEllipseString(label,adjustment,"\u2026");labelHeight=this.getRotatedLabelHeight(truncatedLabel,angle)}return truncatedLabel}},{key:"formatYAxisLabel",value:function formatYAxisLabel(label,angle){if(Array.isArray(label)&&label.length)label=label[0];var adjustment=0;var labelWidth=DOMUtils.getTextWidth(label,this.getFontString());var truncatedLabel=label;while(labelWidth>(_weavejs.WeaveAPI.Locale.reverseLayout?this.margin.right.value:this.margin.left.value)&&adjustment<label.length){adjustment++;truncatedLabel=this.centerEllipseString(label,adjustment,"\u2026");labelWidth=DOMUtils.getTextWidth(label,this.getFontString())}return truncatedLabel}},{key:"internalWidth",get:function get(){return this.c3Config.size.width-this.c3Config.padding.left-this.c3Config.padding.right}},{key:"internalHeight",get:function get(){return this.c3Config.size.height-this.c3Config.padding.top-this.margin.bottom.value}}]);return AbstractC3Tool}(_AbstractVisTool3.default);exports.default=AbstractC3Tool;

},{"d3":"d3","lodash":"lodash","react":"react","weaveapp/modules/jquery":63,"weaveapp/tool/AbstractVisTool":70,"weaveapp/tool/c3tool/C3Chart":81,"weaveapp/util/PrintUtils":134,"weavejs":136}],80:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _d=require("d3");var d3=_interopRequireWildcard(_d);var _FormatUtils=require("weaveapp/util/FormatUtils");var _FormatUtils2=_interopRequireDefault(_FormatUtils);var _AbstractC3Tool2=require("weaveapp/tool/c3tool/AbstractC3Tool");var _AbstractC3Tool3=_interopRequireDefault(_AbstractC3Tool2);var _ChartUtils=require("weaveapp/util/ChartUtils");var _ChartUtils2=_interopRequireDefault(_ChartUtils);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ComboBox=weavejs.ui.ComboBox;var Checkbox=weavejs.ui.Checkbox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var Accordion=weavejs.ui.Accordion;var StatefulTextField=weavejs.ui.StatefulTextField;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var DynamicColumn=weavejs.data.column.DynamicColumn;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var LinkableHashMap=weavejs.core.LinkableHashMap;var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var ColorRamp=weavejs.util.ColorRamp;var LinkableString=weavejs.core.LinkableString;var LinkableBoolean=weavejs.core.LinkableBoolean;var LinkableNumber=weavejs.core.LinkableNumber;var ColumnUtils=weavejs.data.ColumnUtils;var StandardLib=weavejs.util.StandardLib;var ArrayUtils=weavejs.util.ArrayUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var GROUP="group";var STACK="stack";var PERCENT_STACK="percentStack";var GROUPING_MODES=[{label:"Grouped Bars",value:GROUP},{label:"Stacked Bars",value:STACK},{label:"100% Stacked Bars",value:PERCENT_STACK}];var BOTTOM="bottom";var RIGHT="right";var INSET="inset";var LEGEND_POSITIONS=[{label:"Bottom",value:BOTTOM},{label:"Right",value:RIGHT},{label:"Inset",value:INSET}];var C3BarChart=function(_AbstractC3Tool){_inherits(C3BarChart,_AbstractC3Tool);function C3BarChart(props){_classCallCheck(this,C3BarChart);var _this=_possibleConstructorReturn(this,(C3BarChart.__proto__||Object.getPrototypeOf(C3BarChart)).call(this,props));_this.heightColumns=_weavejs.Weave.linkableChild(_this,new LinkableHashMap(IAttributeColumn));_this.labelColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.sortColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.colorColumn=_weavejs.Weave.linkableChild(_this,new AlwaysDefinedColumn("#808080"));_this.chartColors=_weavejs.Weave.linkableChild(_this,new ColorRamp(ColorRamp.getColorRampByName("Paired")));_this.groupingMode=_weavejs.Weave.linkableChild(_this,new LinkableString(STACK,_this.verifyGroupingMode));_this.legendPosition=_weavejs.Weave.linkableChild(_this,new LinkableString(BOTTOM,_this.verifyLegendPosition));_this.horizontalMode=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.showValueLabels=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.showXAxisLabel=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.xAxisLabelAngle=_weavejs.Weave.linkableChild(_this,new LinkableNumber(-45));_this.barWidthRatio=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0.8,_this.verifyBarRatio));_this.RECORD_FORMAT={id:IQualifiedKey,heights:{},numericValues:{sort:_this.sortColumn,yLabel:_this.yLabelColumn,xLabel:_this.labelColumn},stringValues:{yLabel:_this.yLabelColumn,xLabel:_this.labelColumn,color:_this.colorColumn}};_this.RECORD_DATATYPE={heights:{},numericValues:{sort:Number,yLabel:Number,xLabel:Number},stringValues:{yLabel:String,xLabel:String,color:String}};_this.formatGetStringFromNumber=function(value){var heightColumns=_this.heightColumns.getObjects();if(_this.groupingMode.value===PERCENT_STACK&&heightColumns.length>1){return _weavejs.Weave.lang("{0}%",StandardLib.roundSignificant(100*value))}else if(heightColumns.length>0){return _weavejs.Weave.lang(ColumnUtils.deriveStringFromNumber(heightColumns[0],value))}return null};_this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return Accordion.render([_weavejs.Weave.lang("Data"),_this.getSelectableAttributesEditor(pushCrumb)],[_weavejs.Weave.lang("Display"),[[_weavejs.Weave.lang("Grouping mode"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.groupingMode}),options:GROUPING_MODES})],_this.c3Config.legend.show&&[_weavejs.Weave.lang("Legend Position"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.legendPosition}),options:LEGEND_POSITIONS})],_weavejs.Weave.beta&&[_weavejs.Weave.lang("Horizontal bars (beta)"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.horizontalMode}),label:" "})],[_weavejs.Weave.lang("Show value labels"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.showValueLabels}),label:" "})],[_weavejs.Weave.lang("Show X axis title"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.showXAxisLabel}),label:" "})],[_weavejs.Weave.lang("X axis label angle"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.xAxisLabelAngle}),options:_ChartUtils2.default.getAxisLabelAngleChoices()})],[_weavejs.Weave.lang("Bar width ratio"),React.createElement(StatefulTextField,{type:"number",style:{flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.barWidthRatio})})]]],[_weavejs.Weave.lang("Titles"),_this.getTitlesEditor()],[_weavejs.Weave.lang("Margins"),_this.getMarginEditor()],[_weavejs.Weave.lang("Accessibility"),_this.getAltTextEditor()])};_this.colorColumn.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.mergeConfig({data:{json:[],type:"bar",xSort:false,names:{},labels:{format:function format(v,id,i,j){if(_this.showValueLabels.value){return _FormatUtils2.default.defaultNumberFormatting(v)}else{return""}}},order:null,color:function color(_color,d){if(_this.heightColumnNames.length===1&&d&&d.hasOwnProperty("index")){var record=_this.records[d.index];return record&&record.stringValues?record.stringValues.color:""}else{return _color}}},axis:{x:{type:"category",label:{text:"",position:"outer-center"},height:_this.margin.bottom.value,tick:{rotate:_this.xAxisLabelAngle.value,culling:{max:null},multiline:false,format:function format(num){var index=Math.round(num);var record=_this.records[index];if(_this.labelColumn.getInternalColumn()==null)return null;if(record){var valFromKey=_weavejs.Weave.lang(_this.labelColumn.getValueFromKey(record.id));if(_this.horizontalMode.value)return _this.formatYAxisLabel(valFromKey,_this.xAxisLabelAngle.value);return _this.formatXAxisLabel(valFromKey,_this.xAxisLabelAngle.value)}return null}}},rotated:false},grid:{x:{show:true},y:{show:true}},bar:{width:{ratio:NaN}},legend:{show:false,position:_this.legendPosition.value}});_this.c3ConfigYAxis={show:true,label:{text:"",position:"outer-middle"},tick:{fit:false,multiline:false,format:function format(num){return _this.formatGetStringFromNumber(num)}}};return _this}_createClass(C3BarChart,[{key:"verifyGroupingMode",value:function verifyGroupingMode(mode){return[GROUP,STACK,PERCENT_STACK].indexOf(mode)>=0}},{key:"verifyLegendPosition",value:function verifyLegendPosition(position){return[BOTTOM,RIGHT,INSET].indexOf(position)>=0}},{key:"verifyBarRatio",value:function verifyBarRatio(ratio){return 0<ratio&&ratio<1}},{key:"handleC3Selection",value:function handleC3Selection(){var _this2=this;if(!this.selectionKeySet)return;var selectedIndices=this.chart.selected();var selectedKeys=selectedIndices.map(function(value){return _this2.records[value.index].id});this.selectionKeySet.replaceKeys(selectedKeys)}},{key:"handleC3MouseOver",value:function handleC3MouseOver(d){var record=this.records[d.index];var qKey=this.records[d.index].id;var columnNamesToColor={};var columns=this.heightColumns.getObjects(IAttributeColumn);for(var index in columns){var column=columns[index];var columnName=column.getMetadata("title");columnNamesToColor[columnName]=this.chartColors.getHexColor(Number(index),0,columns.length-1)}if(this.probeKeySet)this.probeKeySet.replaceKeys([qKey]);var heightColumns=this.heightColumns.getObjects(IAttributeColumn);this.toolTip.show(this,this.chart.internal.d3.event,[qKey],heightColumns);if(heightColumns.length>1)this.toolTip.setState({columnNamesToColor:columnNamesToColor})}},{key:"dataChanged",value:function dataChanged(){var _this3=this;var columns=this.heightColumns.getObjects(IAttributeColumn);this.filteredKeySet.setColumnKeySources(columns);this.RECORD_FORMAT.heights=this.heightColumns.toObject(IAttributeColumn);this.RECORD_FORMAT.heights.xLabel=this.labelColumn;this.RECORD_DATATYPE.heights=_.zipObject(this.heightColumns.getNames(),columns.map(function(){return Number}));this.RECORD_DATATYPE.heights.xLabel=String;this.heightColumnNames=this.heightColumns.getNames();this.heightColumnsLabels=columns.map(function(column){return _weavejs.Weave.lang(column.getMetadata("title"))});this.yLabelColumnDataType=this.yLabelColumn.getMetadata("dataType");this.records=ColumnUtils.getRecords(this.RECORD_FORMAT,this.filteredKeySet.keys,this.RECORD_DATATYPE);this.records=_.sortByOrder(this.records,["numericValues.sort"],["asc"]);if(_weavejs.WeaveAPI.Locale.reverseLayout){this.records=this.records.reverse()}if(this.groupingMode.value===STACK||this.groupingMode.value===PERCENT_STACK)this.c3Config.data.groups=[this.heightColumnNames];else this.c3Config.data.groups=[];if(this.groupingMode.value===PERCENT_STACK&&this.heightColumnNames.length>1){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.records[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var record=_step.value;var heights=record.heights;var sum=0;for(var key in heights){if(typeof heights[key]=="number")sum+=heights[key]}for(var _key in heights){if(typeof heights[_key]=="number")heights[_key]/=sum}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}var keys={x:"",value:new Array};if(this.labelColumn.target){keys.x="xLabel";this.c3Config.legend.show=false}else{this.c3Config.legend.show=true}keys.value=this.heightColumnNames;var columnColors={};var columnTitles={};if(this.heightColumnNames.length>1){this.heightColumnNames.forEach(function(name,index){columnTitles[name]=_this3.heightColumnsLabels[index];columnColors[name]=_this3.chartColors.getHexColor(index,0,_this3.heightColumnNames.length-1)});if(this.labelColumn.target){this.c3Config.legend.show=true}}else{this.c3Config.legend.show=false}var data=_.cloneDeep(this.c3Config.data);data.json=_.pluck(this.records,"heights");data.colors=columnColors;data.keys=keys;data.names=columnTitles;data.unload=true;this.c3Config.data=data}},{key:"updateStyle",value:function updateStyle(){var _this4=this;if(!this.chart||!this.heightColumnNames)return;var selectionEmpty=!this.selectionKeySet||this.selectionKeySet.keys.length===0;var thinBars=this.chart.internal.width<=this.records.length;this.heightColumnNames.forEach(function(item){d3.select(_this4.element).selectAll("g").filter(".c3-shapes-"+item+".c3-bars").selectAll("path").style("opacity",function(d,i,oi){var key=_this4.records[i].id;var selected=_this4.isSelected(key);var probed=_this4.isProbed(key);return selectionEmpty||selected||probed?1:0.3}).style("stroke","black").style("stroke-width",1).style("stroke-opacity",function(d,i,oi){if(thinBars)return 0;var key=_this4.records[i].id;var selected=_this4.isSelected(key);var probed=_this4.isProbed(key);if(probed)return 1;if(selected)return 0.7;return 0.5});d3.select(_this4.element).selectAll("g").filter(".c3-texts-"+item).selectAll("text").style("fill-opacity",function(d,i,oi){var key=_this4.records[i].id;var selected=_this4.isSelected(key);var probed=_this4.isProbed(key);return selectionEmpty||selected||probed?1:0.3})})}},{key:"getAutomaticDescription",value:function getAutomaticDescription(){var description=_weavejs.Weave.lang("Bar Chart showing ");for(var i=0;i<this.heightColumns.getObjects().length;i++){description+=ColumnUtils.getTitle(this.heightColumns.getObjects()[i])+", "}description+="sorted by ";description+=ColumnUtils.getTitle(this.sortColumn);description+="\n";var heights=this.heightColumns.getObjects();if(heights.length==1){var heightColumn=heights[0];var statsHeight=_weavejs.WeaveAPI.StatisticsCache.getColumnStatistics(heightColumn);var max=statsHeight.getMin();var min=statsHeight.getMax();var average=statsHeight.getMean();var tmp;var max_keys=[];var min_keys=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=heightColumn.keys[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var k=_step2.value;tmp=heightColumn.getValueFromKey(k,Number);if(tmp>max)max=tmp;if(tmp<min)min=tmp}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=heightColumn.keys[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){k=_step3.value;if(Math.abs(heightColumn.getValueFromKey(k,Number)-max)<0.001)max_keys.push(k);if(Math.abs(heightColumn.getValueFromKey(k,Number)-min)<0.001)min_keys.push(k)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}description+=_weavejs.Weave.lang("The maximum {0} is {1} when {2} is ",ColumnUtils.getTitle(heightColumn),max,ColumnUtils.getTitle(this.sortColumn));var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=max_keys[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){k=_step4.value;description+=" "+this.sortColumn.getValueFromKey(k)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}description+=".";description+="\n";description+=_weavejs.Weave.lang("The minimum {0} is {1} when {2} is",ColumnUtils.getTitle(heightColumn),min,ColumnUtils.getTitle(this.sortColumn));var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=min_keys[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){k=_step5.value;description+=" "+this.sortColumn.getValueFromKey(k)}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}description+=".";description+="\n";description+=_weavejs.Weave.lang("The average value is {0}.",StandardLib.roundSignificant(average,2))}return description}},{key:"validate",value:function validate(){var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var changeDetected=false;var axisChange=_weavejs.Weave.detectChange(this,this.heightColumns,this.labelColumn,this.sortColumn,this.margin,this.overrideBounds,this.xAxisName,this.yAxisName,this.showXAxisLabel,this.xAxisLabelAngle);var dataChange=axisChange||_weavejs.Weave.detectChange(this,this.colorColumn,this.chartColors,this.groupingMode,this.filteredKeySet,this.showValueLabels);if(dataChange){changeDetected=true;this.dataChanged()}if(axisChange){changeDetected=true;var xLabel=_weavejs.Weave.lang(this.xAxisName.value)||this.defaultXAxisLabel;var yLabel=_weavejs.Weave.lang(this.yAxisName.value)||this.defaultYAxisLabel;if(!this.showXAxisLabel.value){xLabel=" "}if(this.heightColumnNames&&this.heightColumnNames.length){var axes={};if(_weavejs.WeaveAPI.Locale.reverseLayout){this.heightColumnNames.forEach(function(name){axes[name]="y2"});this.c3Config.data.axes=axes;this.c3Config.axis.y2=this.c3ConfigYAxis;this.c3Config.axis.y={show:false};this.c3Config.axis.x.tick.rotate=-1*this.xAxisLabelAngle.value}else{this.heightColumnNames.forEach(function(name){axes[name]="y"});this.c3Config.data.axes=axes;this.c3Config.axis.y=this.c3ConfigYAxis;delete this.c3Config.axis.y2;this.c3Config.axis.x.tick.rotate=this.xAxisLabelAngle.value}}this.c3Config.axis.x.label={text:xLabel,position:"outer-center"};this.c3ConfigYAxis.label={text:yLabel,position:"outer-middle"};this.updateConfigMargin();this.updateConfigAxisY()}if(_weavejs.Weave.detectChange(this,this.horizontalMode)){changeDetected=true;this.c3Config.axis.rotated=this.horizontalMode.value}if(_weavejs.Weave.detectChange(this,this.barWidthRatio)){changeDetected=true;this.c3Config.bar.width.ratio=this.barWidthRatio.value}if(_weavejs.Weave.detectChange(this,this.legendPosition)){changeDetected=true;this.c3Config.legend.position=this.legendPosition.value;if(this.legendPosition.value==RIGHT)this.c3Config.padding.right=null;else this.c3Config.padding.right=this.margin.right.value}if(changeDetected||forced)return true;var selectedKeys=this.selectionKeySet?this.selectionKeySet.keys:[];var keyToIndex=ArrayUtils.createLookup(this.records,"id");var selectedIndices=selectedKeys.map(function(key){return Number(keyToIndex.get(key))});this.chart.select(this.heightColumnNames,selectedIndices,true);this.updateStyle();return false}},{key:"getMarginEditor",value:function getMarginEditor(){return[[_weavejs.Weave.lang("Margins"),React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},React.createElement(StatefulTextField,{type:"number",style:{textAlign:"center",flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.left})}),React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1}},React.createElement(StatefulTextField,{type:"number",style:{textAlign:"center",minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.top})}),React.createElement(StatefulTextField,{type:"number",style:{textAlign:"center",minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.bottom})})),React.createElement(StatefulTextField,{type:"number",disabled:this.legendPosition.value=="right",style:{textAlign:"center",flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.right})}))]]}},{key:"yLabelColumn",get:function get(){return this.heightColumns.getObjects(IAttributeColumn)[0]||this.sortColumn}},{key:"defaultXAxisLabel",get:function get(){if(!this.showXAxisLabel.value)return"";return _weavejs.Weave.lang("Sorted by "+this.sortColumn.getMetadata("title"))}},{key:"defaultYAxisLabel",get:function get(){var columns=this.heightColumns.getObjects();if(columns.length==0)return _weavejs.Weave.lang("");return _weavejs.Weave.lang("{0}",columns.map(function(column){return ColumnUtils.getTitle(column)}).join(_weavejs.Weave.lang(", ")))}},{key:"selectableAttributes",get:function get(){return _get(C3BarChart.prototype.__proto__||Object.getPrototypeOf(C3BarChart.prototype),"selectableAttributes",this).set("Height",this.heightColumns).set("Sort",this.sortColumn).set("Color",this.colorColumn).set("Label",this.labelColumn)}},{key:"defaultPanelTitle",get:function get(){var columns=this.heightColumns.getObjects();if(columns.length==0)return _weavejs.Weave.lang("Bar Chart");return _weavejs.Weave.lang("Bar Chart of {0}",columns.map(function(column){return ColumnUtils.getTitle(column)}).join(_weavejs.Weave.lang(", ")))}},{key:"deprecatedStateMapping",get:function get(){return[_get(C3BarChart.prototype.__proto__||Object.getPrototypeOf(C3BarChart.prototype),"deprecatedStateMapping",this),{"children":{"visualization":{"plotManager":{"plotters":{"plot":{"filteredKeySet":this.filteredKeySet,"heightColumns":this.heightColumns,"labelColumn":this.labelColumn,"sortColumn":this.sortColumn,"colorColumn":this.colorColumn,"chartColors":this.chartColors,"horizontalMode":this.horizontalMode,"showValueLabels":this.showValueLabels,"groupingMode":this.groupingMode}}}}}}]}}]);return C3BarChart}(_AbstractC3Tool3.default);exports.default=C3BarChart;C3BarChart.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3BarChart,{id:"weavejs.tool.c3tool.C3BarChart",label:"Bar Chart",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes,_IAltText2.default],deprecatedIds:["weave.visualization.tools::CompoundBarChartTool"]});

},{"d3":"d3","lodash":"lodash","react":"react","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/tool/c3tool/AbstractC3Tool":79,"weaveapp/util/ChartUtils":131,"weaveapp/util/FormatUtils":133,"weavejs":136}],81:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _c=require("c3");var c3=_interopRequireWildcard(_c);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SmartComponent=weavejs.ui.SmartComponent;var C3Chart=function(_SmartComponent){_inherits(C3Chart,_SmartComponent);function C3Chart(props){_classCallCheck(this,C3Chart);var _this=_possibleConstructorReturn(this,(C3Chart.__proto__||Object.getPrototypeOf(C3Chart)).call(this,props));_this.key=0;return _this}_createClass(C3Chart,[{key:"render",value:function render(){return React.createElement("div",{key:this.key})}},{key:"componentDidMount",value:function componentDidMount(){this.updateChart()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.updateChart()}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){this.key++}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.destroyChart()}},{key:"updateChart",value:function updateChart(){var bindto=ReactDOM.findDOMNode(this);if(this.chart&&this.chart.internal.config.bindto==bindto)return;this.destroyChart();this.chart=c3.generate(_.merge({bindto:bindto},this.props.config))}},{key:"destroyChart",value:function destroyChart(){if(this.chart)_weavejs.WeaveAPI.Scheduler.callLater(null,function(chart){return chart.destroy()},[this.chart]);this.chart=null}}]);return C3Chart}(SmartComponent);exports.default=C3Chart;

},{"c3":"c3","lodash":"lodash","react":"react","react-dom":"react-dom","weavejs":136}],82:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _C3Histogram2=require("weaveapp/tool/c3tool/C3Histogram");var _C3Histogram3=_interopRequireDefault(_C3Histogram2);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ColumnUtils=weavejs.data.ColumnUtils;var C3ColorHistogram=function(_C3Histogram){_inherits(C3ColorHistogram,_C3Histogram);function C3ColorHistogram(props){_classCallCheck(this,C3ColorHistogram);var _this=_possibleConstructorReturn(this,(C3ColorHistogram.__proto__||Object.getPrototypeOf(C3ColorHistogram)).call(this,props));_this.fill.color.internalDynamicColumn.targetPath=["defaultColorColumn"];return _this}_createClass(C3ColorHistogram,[{key:"defaultPanelTitle",get:function get(){if(this.binnedColumn.numberOfBins)return _weavejs.Weave.lang("Color Histogram of {0}",ColumnUtils.getTitle(this.binnedColumn));return _weavejs.Weave.lang("Color Histogram")}}]);return C3ColorHistogram}(_C3Histogram3.default);exports.default=C3ColorHistogram;C3ColorHistogram.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3ColorHistogram,{id:"weavejs.tool.c3tool.C3ColorHistogram",label:"Color Histogram",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes,_IAltText2.default],deprecatedIds:["weave.visualization.tools::ColormapHistogramTool"]});

},{"weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/tool/c3tool/C3Histogram":84,"weavejs":136}],83:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _FormatUtils=require("weaveapp/util/FormatUtils");var _FormatUtils2=_interopRequireDefault(_FormatUtils);var _AbstractC3Tool2=require("weaveapp/tool/c3tool/AbstractC3Tool");var _AbstractC3Tool3=_interopRequireDefault(_AbstractC3Tool2);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var LinkableNumber=weavejs.core.LinkableNumber;var SimpleBinningDefinition=weavejs.data.bin.SimpleBinningDefinition;var ColorRamp=weavejs.util.ColorRamp;var DynamicColumn=weavejs.data.column.DynamicColumn;var DynamicBinningDefinition=weavejs.data.bin.DynamicBinningDefinition;var ColumnUtils=weavejs.data.ColumnUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var C3Gauge=function(_AbstractC3Tool){_inherits(C3Gauge,_AbstractC3Tool);function C3Gauge(props){_classCallCheck(this,C3Gauge);var _this=_possibleConstructorReturn(this,(C3Gauge.__proto__||Object.getPrototypeOf(C3Gauge)).call(this,props));_this.meterColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.binningDefinition=_weavejs.Weave.linkableChild(_this,DynamicBinningDefinition);_this.colorRamp=_weavejs.Weave.linkableChild(_this,ColorRamp);_this.colStats=_weavejs.Weave.linkableChild(_this,_weavejs.WeaveAPI.StatisticsCache.getColumnStatistics(_this.meterColumn));_this.RECORD_FORMAT={id:IQualifiedKey,meterColumn:_this.meterColumn};_this.RECORD_DATATYPE={meterColumn:Number};_this.filteredKeySet.setSingleKeySource(_this.meterColumn);_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.binningDefinition.requestLocalObject(SimpleBinningDefinition,false);_this.binningDefinition.internalObject.numberOfBins.value=3;_this.binningDefinition.generateBinClassifiersForColumn(_this.meterColumn);_weavejs.Weave.linkableChild(_this,_this.binningDefinition.asyncResultCallbacks);_this.margin.left=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0));_this.margin.right=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0));_this.margin.top=_weavejs.Weave.linkableChild(_this,new LinkableNumber(10));_this.margin.bottom=_weavejs.Weave.linkableChild(_this,new LinkableNumber(10));_this.keyToIndex={};_this.mergeConfig({padding:{top:10,bottom:10,left:10,right:10},data:{columns:[],type:"gauge",xSort:false,names:{}},gauge:{label:{format:function format(value,ratio){return String(_FormatUtils2.default.defaultNumberFormatting(value))},show:false},width:39},color:{threshold:{}}});return _this}_createClass(C3Gauge,[{key:"updateConfigMargin",value:function updateConfigMargin(){this.c3Config.padding.top=this.margin.top.value;this.c3Config.padding.bottom=this.margin.bottom.value}},{key:"validate",value:function validate(){var _this2=this;var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var changeDetected=false;if(_weavejs.Weave.detectChange(this,this.meterColumn,this.colorRamp,this.filteredKeySet,this.probeKeySet,this.selectionKeySet,this.colStats,this.binningDefinition,this.margin)){changeDetected=true;var name=this.meterColumn.getMetadata("title");this.records=ColumnUtils.getRecords(this.RECORD_FORMAT,this.filteredKeySet.keys,this.RECORD_DATATYPE);this.keyToIndex={};this.records.forEach(function(record,index){_this2.keyToIndex[record.id]=index});var numberOfBins=this.binningDefinition.getBinNames().length;this.c3Config.color.pattern=this.colorRamp.getHexColors();var binningDefinitionObject=this.binningDefinition.internalObject;this.c3Config.gauge.min=isNaN(binningDefinitionObject.overrideInputMin.value)?this.colStats.getMin():binningDefinitionObject.overrideInputMin.value;this.c3Config.gauge.max=isNaN(binningDefinitionObject.overrideInputMax.value)?this.colStats.getMax():binningDefinitionObject.overrideInputMax.value;var range=this.c3Config.gauge.max-this.c3Config.gauge.min;this.c3Config.color.threshold.values=[];for(var i=1;i<=numberOfBins;i++){this.c3Config.color.threshold.values.push(this.c3Config.gauge.min+i*(range/numberOfBins))}this.c3Config.gauge.label.show=true;var column=[name];var selectedKeys=this.selectionKeySet?this.selectionKeySet.keys:[];var probedKeys=this.probeKeySet?this.probeKeySet.keys:[];if(probedKeys.length)probedKeys.forEach(function(key){return column.push(_this2.meterColumn.getValueFromKey(key,Number))});else if(selectedKeys.length)selectedKeys.forEach(function(key){return column.push(_this2.meterColumn.getValueFromKey(key,Number))});if(column.length==2)this.c3Config.data.columns=[column];else this.c3Config.data.columns=[];this.updateConfigMargin()}return changeDetected||forced}},{key:"getMarginEditor",value:function getMarginEditor(){return[[_weavejs.Weave.lang("Margins"),React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},React.createElement(StatefulTextField,{type:"number",disabled:true,style:{textAlign:"center",flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.left})}),React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1}},React.createElement(StatefulTextField,{type:"number",style:{textAlign:"center",minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.top})}),React.createElement(StatefulTextField,{type:"number",style:{textAlign:"center",minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.bottom})})),React.createElement(StatefulTextField,{type:"number",disabled:true,style:{textAlign:"center",flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.margin.right})}))]]}},{key:"getTitlesEditor",value:function getTitlesEditor(){var _this3=this;return[["Chart",this.panelTitle,this.defaultPanelTitle]].map(function(row){return[_weavejs.Weave.lang(row[0]),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(_this3,{value:row[1]}),placeholder:row[2]})]})}},{key:"selectableAttributes",get:function get(){return _get(C3Gauge.prototype.__proto__||Object.getPrototypeOf(C3Gauge.prototype),"selectableAttributes",this).set("Meter",this.meterColumn)}},{key:"defaultPanelTitle",get:function get(){return _weavejs.Weave.lang("Gauge of {0}",ColumnUtils.getTitle(this.meterColumn))}},{key:"deprecatedStateMapping",get:function get(){return[_get(C3Gauge.prototype.__proto__||Object.getPrototypeOf(C3Gauge.prototype),"deprecatedStateMapping",this),{"children":{"visualization":{"plotManager":{"plotters":{"plot":{"filteredKeySet":this.filteredKeySet,"meterColumn":this.meterColumn,"colorRamp":this.colorRamp,"binningDefinition":this.binningDefinition}}}}}}]}}]);return C3Gauge}(_AbstractC3Tool3.default);exports.default=C3Gauge;C3Gauge.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3Gauge,{id:"weavejs.tool.c3tool.C3Gauge",label:"Gauge",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.tools::GaugeTool"]});

},{"react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/tool/c3tool/AbstractC3Tool":79,"weaveapp/util/FormatUtils":133,"weavejs":136}],84:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _d=require("d3");var d3=_interopRequireWildcard(_d);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _FormatUtils=require("weaveapp/util/FormatUtils");var _FormatUtils2=_interopRequireDefault(_FormatUtils);var _BinningDefinitionEditor=require("weaveapp/editor/BinningDefinitionEditor");var _BinningDefinitionEditor2=_interopRequireDefault(_BinningDefinitionEditor);var _ColorRampEditor=require("weaveapp/editor/ColorRampEditor");var _ColorRampEditor2=_interopRequireDefault(_ColorRampEditor);var _SelectableAttributeComponent=require("weaveapp/ui/SelectableAttributeComponent");var _SelectableAttributeComponent2=_interopRequireDefault(_SelectableAttributeComponent);var _AbstractC3Tool2=require("weaveapp/tool/c3tool/AbstractC3Tool");var _AbstractC3Tool3=_interopRequireDefault(_AbstractC3Tool2);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _SolidFillStyle=require("weaveapp/plot/SolidFillStyle");var _SolidFillStyle2=_interopRequireDefault(_SolidFillStyle);var _ChartUtils=require("weaveapp/util/ChartUtils");var _ChartUtils2=_interopRequireDefault(_ChartUtils);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);var _ColorPicker=require("weaveapp/ui/ColorPicker");var _ColorPicker2=_interopRequireDefault(_ColorPicker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Checkbox=weavejs.ui.Checkbox;var ComboBox=weavejs.ui.ComboBox;var Accordion=weavejs.ui.Accordion;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var DynamicComponent=weavejs.ui.DynamicComponent;var StatefulTextField=weavejs.ui.StatefulTextField;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var BinnedColumn=weavejs.data.column.BinnedColumn;var FilteredColumn=weavejs.data.column.FilteredColumn;var ColorColumn=weavejs.data.column.ColorColumn;var LinkableString=weavejs.core.LinkableString;var LinkableBoolean=weavejs.core.LinkableBoolean;var DynamicColumn=weavejs.data.column.DynamicColumn;var StandardLib=weavejs.util.StandardLib;var LinkableNumber=weavejs.core.LinkableNumber;var ColumnUtils=weavejs.data.ColumnUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var JS=weavejs.util.JS;var COUNT="count";var SUM="sum";var MEAN="mean";var C3Histogram=function(_AbstractC3Tool){_inherits(C3Histogram,_AbstractC3Tool);function C3Histogram(props){_classCallCheck(this,C3Histogram);var _this=_possibleConstructorReturn(this,(C3Histogram.__proto__||Object.getPrototypeOf(C3Histogram)).call(this,props));_this.binnedColumn=_weavejs.Weave.linkableChild(_this,BinnedColumn,_this.setColorColumn,true);_this.columnToAggregate=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.aggregationMethod=_weavejs.Weave.linkableChild(_this,new LinkableString("count"));_this.fill=_weavejs.Weave.linkableChild(_this,_SolidFillStyle2.default);_this.line=_weavejs.Weave.linkableChild(_this,_SolidLineStyle2.default);_this.barWidthRatio=_weavejs.Weave.linkableChild(_this,new LinkableNumber(0.95,_this.verifyBarRatio));_this.horizontalMode=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.showValueLabels=_weavejs.Weave.linkableChild(_this,new LinkableBoolean(false));_this.xAxisLabelAngle=_weavejs.Weave.linkableChild(_this,new LinkableNumber(-45));_this._callbackRecursion=false;_this.RECORD_DATATYPE={binnedColumn:Number,columnToAggregate:Number};_this.renderEditor=function(pushCrumb){var linkedColor=!!_this.fill.color.internalDynamicColumn.targetPath;var hexColor=_this.colorColumn&&_this.colorColumn.ramp?_this.colorColumn.ramp.state[0]:"#808080";return Accordion.render([_weavejs.Weave.lang("Binning"),React.createElement(_BinningDefinitionEditor2.default,{showNoneOption:false,binnedColumn:_this.binnedColumn,pushCrumb:pushCrumb})],linkedColor&&[_weavejs.Weave.lang("Coloring"),[[_weavejs.Weave.lang("Color theme"),React.createElement(DynamicComponent,{dependencies:[_this.fill.color],render:function render(){return React.createElement(_ColorRampEditor2.default,{compact:true,pushCrumb:pushCrumb,colorRamp:_this.colorColumn&&_this.colorColumn.ramp})}})]]],[_weavejs.Weave.lang("Aggregation"),[[_weavejs.Weave.lang("Height values (optional)"),React.createElement(_SelectableAttributeComponent2.default,{attributeName:"Height values (optional)",attributes:_this.selectableAttributes,pushCrumb:pushCrumb})],[_weavejs.Weave.lang("Aggregation method"),React.createElement(DynamicComponent,{dependencies:[_this.columnToAggregate],render:function render(){return React.createElement(ComboBox,{options:[COUNT,SUM,MEAN],type:_this.columnToAggregate.getInternalColumn()?null:"disabled",ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.aggregationMethod})})}})]]],[_weavejs.Weave.lang("Display"),[_weavejs.Weave.beta&&[_weavejs.Weave.lang("Horizontal bars (beta)"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.horizontalMode}),label:" "})],[_weavejs.Weave.lang("Show value labels"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.showValueLabels}),label:" "})],[_weavejs.Weave.lang("X axis label angle"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.xAxisLabelAngle}),options:_ChartUtils2.default.getAxisLabelAngleChoices()})],[_weavejs.Weave.lang("Bar width ratio"),React.createElement(StatefulTextField,{type:"number",style:{flex:1,minWidth:60},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.barWidthRatio})})],!linkedColor&&[_weavejs.Weave.lang("Color"),React.createElement(_ColorPicker2.default,{style:{height:"32px"},hexColor:hexColor,onChange:function onChange(newColor){return _this.updateColor(newColor)}})]]],[_weavejs.Weave.lang("Titles"),_this.getTitlesEditor()],[_weavejs.Weave.lang("Margins"),_this.getMarginEditor()],[_weavejs.Weave.lang("Accessibility"),_this.getAltTextEditor()])};_this.filteredKeySet.setSingleKeySource(_this.fill.color);_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_weavejs.Weave.getCallbacks(_this.fill.color.internalDynamicColumn).addGroupedCallback(_this,_this.setBinnedColumn);var _colorColumn=_this.fill.color.internalDynamicColumn.requestLocalObject(ColorColumn,false);_colorColumn.ramp.setSessionState([8421504]);var _binnedColumn=_colorColumn.internalDynamicColumn.requestLocalObject(BinnedColumn,true);_binnedColumn.internalDynamicColumn.requestLocalObject(FilteredColumn,true);_this.mergeConfig({data:{columns:[],type:"bar",xSort:false,names:{},labels:{format:function format(v,id,i,j){if(_this.showValueLabels.value){return _FormatUtils2.default.defaultNumberFormatting(v)}else{return""}}},color:function color(_color,d){if(d&&d.hasOwnProperty("index")){var binIndex=d.index;if(_weavejs.WeaveAPI.Locale.reverseLayout)binIndex=_this.histData.length-1-binIndex;var cc=_this.internalColorColumn;if(cc)return StandardLib.getHexColor(cc.getColorFromDataValue(binIndex))}return"#808080"},onmouseover:function onmouseover(d){if(d&&d.hasOwnProperty("index")){var keys=_this.binnedColumn.getKeysFromBinIndex(d.index);if(!keys)return;if(_this.probeKeySet)_this.probeKeySet.replaceKeys(keys);_this.toolTip.show(_this,_this.chart.internal.d3.event,keys,[_this.binnedColumn,_this.columnToAggregate])}}},legend:{show:false},axis:{x:{type:"category",label:{text:"",position:"outer-center"},tick:{rotate:_this.xAxisLabelAngle.value,culling:{max:null},multiline:false,format:function format(num){if(_this.element){var labelString=_weavejs.Weave.lang(_this.getLabelString(num));if(labelString){return _this.formatXAxisLabel(labelString,_this.xAxisLabelAngle.value)}else{return""}}else{return _weavejs.Weave.lang(_this.binnedColumn.deriveStringFromNumber(num))}}}},rotated:false},grid:{x:{show:true},y:{show:true}},bar:{width:{ratio:NaN}}});_this.c3ConfigYAxis={show:true,label:{text:"",position:"outer-middle"},tick:{fit:false,format:function format(num){return _weavejs.Weave.lang(String(_FormatUtils2.default.defaultNumberFormatting(num)))}}};return _this}_createClass(C3Histogram,[{key:"verifyBarRatio",value:function verifyBarRatio(ratio){return 0<ratio&&ratio<1}},{key:"initSelectableAttributes",value:function initSelectableAttributes(input){ColumnUtils.initSelectableAttribute(this.fill.color,input[0])}},{key:"setColorColumn",value:function setColorColumn(){if(this._callbackRecursion)return;this._callbackRecursion=true;var colorBinCol=this.internalColorColumn?_weavejs.Weave.AS(this.internalColorColumn.getInternalColumn(),BinnedColumn):null;if(colorBinCol){if(colorBinCol.binningDefinition.internalObject)_weavejs.Weave.copyState(this.binnedColumn,colorBinCol);else _weavejs.Weave.copyState(this.binnedColumn.internalDynamicColumn,colorBinCol.internalDynamicColumn)}this._callbackRecursion=false}},{key:"setBinnedColumn",value:function setBinnedColumn(){if(this._callbackRecursion)return;this._callbackRecursion=true;var colorBinCol=this.internalColorColumn?_weavejs.Weave.AS(this.internalColorColumn.getInternalColumn(),BinnedColumn):null;if(colorBinCol){if(colorBinCol.binningDefinition.internalObject)_weavejs.Weave.copyState(colorBinCol,this.binnedColumn);else _weavejs.Weave.copyState(colorBinCol.internalDynamicColumn,this.binnedColumn.internalDynamicColumn);var filteredColumn=_weavejs.Weave.AS(this.binnedColumn.getInternalColumn(),FilteredColumn);if(filteredColumn)_weavejs.Weave.linkState(this.filteredKeySet.keyFilter,filteredColumn.filter)}this._callbackRecursion=false}},{key:"getLabelString",value:function getLabelString(num){if(_weavejs.WeaveAPI.Locale.reverseLayout){var temp=this.histData.length-1;return _weavejs.Weave.lang(this.binnedColumn.deriveStringFromNumber(temp-num))}else return _weavejs.Weave.lang(this.binnedColumn.deriveStringFromNumber(num))}},{key:"getYAxisLabel",value:function getYAxisLabel(){var overrideAxisName=this.yAxisName.value;if(overrideAxisName){return overrideAxisName}else{return this.defaultYAxisLabel}}},{key:"handleC3Selection",value:function handleC3Selection(){if(!this.selectionKeySet)return;var set_selectedKeys=new Set;var selectedKeys=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.chart.selected()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var d=_step.value;var keys=this.binnedColumn.getKeysFromBinIndex(d.index);if(!keys)continue;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=keys[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var key=_step2.value;if(!set_selectedKeys.has(key)){set_selectedKeys.add(key);selectedKeys.push(key)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.selectionKeySet.replaceKeys(selectedKeys)}},{key:"updateStyle",value:function updateStyle(){var selectionEmpty=!this.selectionKeySet||this.selectionKeySet.keys.length===0;var selectedKeys=this.selectionKeySet?this.selectionKeySet.keys:[];var probedKeys=this.probeKeySet?this.probeKeySet.keys:[];var selectedRecords=_.filter(this.records,function(record){return _.includes(selectedKeys,record.id)});var probedRecords=_.filter(this.records,function(record){return _.includes(probedKeys,record.id)});var selectedBinIndices=_.map(_.uniq(selectedRecords,"binnedColumn"),"binnedColumn");var probedBinIndices=_.map(_.uniq(probedRecords,"binnedColumn"),"binnedColumn");d3.select(this.element).selectAll("path.c3-shape").style("stroke",function(d,i,oi){var selected=_.intersection(selectedBinIndices,[i]).length;var probed=_.intersection(probedBinIndices,[i]).length;if(probed&&selected)return"white";else return"black"}).style("opacity",function(d,i,oi){var selected=_.intersection(selectedBinIndices,[i]).length;var probed=_.intersection(probedBinIndices,[i]).length;return selectionEmpty||selected||probed?1:0.3}).style("stroke-opacity",function(d,i,oi){var selected=_.intersection(selectedBinIndices,[i]).length;var probed=_.intersection(probedBinIndices,[i]).length;if(probed)return 1;if(selected)return 0.5;return 0.3}).style("stroke-width",function(d,i,oi){var selected=_.intersection(selectedBinIndices,[i]).length;var probed=_.intersection(probedBinIndices,[i]).length;if(probed&&selected)return 2.5;return probed?1.7:1});d3.select(this.element).selectAll("path._selection_surround").remove();d3.select(this.element).selectAll("g.c3-shapes").selectAll("path._selected_").each(function(d,i,oi){d3.select(this.parentNode).append("path").classed("_selection_surround",true).attr("d",this.getAttribute("d")).style("stroke","black").style("stroke-width",1.5)})}},{key:"dataChanged",value:function dataChanged(){this.records=ColumnUtils.getRecords(this.RECORD_FORMAT,this.filteredKeySet.keys,this.RECORD_DATATYPE);this.histData=[];var columnToAggregateNameIsDefined=!!this.columnToAggregate.getInternalColumn();var numberOfBins=this.binnedColumn.numberOfBins;for(var iBin=0;iBin<numberOfBins;iBin++){var recordsInBin=_.filter(this.records,{binnedColumn:iBin});if(recordsInBin){var obj={height:0};if(columnToAggregateNameIsDefined){obj.height=this.getAggregateValue(recordsInBin,"columnToAggregate",this.aggregationMethod.value);this.histData.push(obj)}else{obj.height=this.getAggregateValue(recordsInBin,"binnedColumn",COUNT);this.histData.push(obj)}}}this.keys={value:["height"]};if(_weavejs.WeaveAPI.Locale.reverseLayout){this.histData=this.histData.reverse()}this.c3Config.data.json=this.histData;this.c3Config.data.keys=this.keys}},{key:"getAggregateValue",value:function getAggregateValue(records,columnToAggregateName,aggregationMethod){var count=0;var sum=0;records.forEach(function(record){count++;sum+=record[columnToAggregateName]});if(aggregationMethod===MEAN)return sum/count;if(aggregationMethod===COUNT)return count;return sum}},{key:"validate",value:function validate(){var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var changeDetected=false;var axisChange=_weavejs.Weave.detectChange(this,this.binnedColumn,this.columnToAggregate,this.aggregationMethod,this.xAxisName,this.yAxisName,this.margin,this.xAxisLabelAngle);if(axisChange||_weavejs.Weave.detectChange(this,this.columnToAggregate,this.fill,this.line,this.filteredKeySet,this.showValueLabels)){changeDetected=true;this.dataChanged()}if(axisChange){changeDetected=true;var xLabel=_weavejs.Weave.lang(this.xAxisName.value)||this.defaultXAxisLabel;var yLabel=_weavejs.Weave.lang(this.getYAxisLabel.bind(this)());if(this.records){var temp="height";if(_weavejs.WeaveAPI.Locale.reverseLayout){this.c3Config.data.axes=_defineProperty({},temp,"y2");this.c3Config.axis.y2=this.c3ConfigYAxis;this.c3Config.axis.y={show:false};this.c3Config.axis.x.tick.rotate=-1*this.xAxisLabelAngle.value}else{this.c3Config.data.axes=_defineProperty({},temp,"y");this.c3Config.axis.y=this.c3ConfigYAxis;delete this.c3Config.axis.y2;this.c3Config.axis.x.tick.rotate=this.xAxisLabelAngle.value}}this.c3Config.axis.x.label={text:xLabel,position:"outer-center"};this.c3ConfigYAxis.label={text:yLabel,position:"outer-middle"};this.updateConfigMargin()}if(_weavejs.Weave.detectChange(this,this.horizontalMode)){changeDetected=true;this.c3Config.axis.rotated=this.horizontalMode.value}if(_weavejs.Weave.detectChange(this,this.barWidthRatio)){changeDetected=true;this.c3Config.bar.width.ratio=this.barWidthRatio.value}if(changeDetected||forced)return true;if(this.selectionKeySet){var set_indices=new Set;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.selectionKeySet.keys[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var key=_step3.value;var index=this.binnedColumn.getValueFromKey(key,Number);if(isFinite(index))set_indices.add(index)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.chart.select(["height"],JS.toArray(set_indices),true)}else{this.chart.select(["height"],[],true)}this.updateStyle();return false}},{key:"updateColor",value:function updateColor(color){if(this.colorColumn&&this.colorColumn.ramp){this.colorColumn.ramp.setSessionState([color])}}},{key:"colorColumn",get:function get(){return _weavejs.Weave.AS(this.fill.color.getInternalColumn(),ColorColumn)}},{key:"RECORD_FORMAT",get:function get(){return{id:IQualifiedKey,binnedColumn:this.binnedColumn,columnToAggregate:this.columnToAggregate}}},{key:"internalColorColumn",get:function get(){return _weavejs.Weave.AS(this.fill.color.getInternalColumn(),ColorColumn)}},{key:"defaultXAxisLabel",get:function get(){return _weavejs.Weave.lang(this.binnedColumn.getMetadata("title"))}},{key:"defaultYAxisLabel",get:function get(){if(this.columnToAggregate.getInternalColumn()){switch(this.aggregationMethod.value){case COUNT:return _weavejs.Weave.lang("Number of records");case SUM:return _weavejs.Weave.lang("Sum of {0}",_weavejs.Weave.lang(this.columnToAggregate.getMetadata("title")));case MEAN:return _weavejs.Weave.lang("Mean of {0}",_weavejs.Weave.lang(this.columnToAggregate.getMetadata("title")));}}else{return _weavejs.Weave.lang("Number of records")}}},{key:"selectableAttributes",get:function get(){return _get(C3Histogram.prototype.__proto__||Object.getPrototypeOf(C3Histogram.prototype),"selectableAttributes",this).set("Group by",this.binnedColumn).set("Height values (optional)",this.columnToAggregate)}},{key:"defaultPanelTitle",get:function get(){if(this.binnedColumn.numberOfBins)return _weavejs.Weave.lang("Histogram of {0}",ColumnUtils.getTitle(this.binnedColumn));return _weavejs.Weave.lang("Histogram")}},{key:"deprecatedStateMapping",get:function get(){return[_get(C3Histogram.prototype.__proto__||Object.getPrototypeOf(C3Histogram.prototype),"deprecatedStateMapping",this),{"children":{"visualization":{"plotManager":{"plotters":{"plot":{"filteredKeySet":this.filteredKeySet,"binnedColumn":this.binnedColumn,"columnToAggregate":this.columnToAggregate,"aggregationMethod":this.aggregationMethod,"fillStyle":this.fill,"lineStyle":this.line,"drawPartialBins":true,"horizontalMode":false,"showValueLabels":false,"valueLabelColor":0,"valueLabelHorizontalAlign":"left","valueLabelMaxWidth":200,"valueLabelVerticalAlign":"middle"}}}}}}]}}]);return C3Histogram}(_AbstractC3Tool3.default);exports.default=C3Histogram;C3Histogram.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3Histogram,{id:"weavejs.tool.c3tool.C3Histogram",label:"Histogram",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes,_IAltText2.default],deprecatedIds:["weave.visualization.tools::HistogramTool"]});

},{"d3":"d3","lodash":"lodash","react":"react","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/editor/BinningDefinitionEditor":21,"weaveapp/editor/ColorRampEditor":29,"weaveapp/plot/SolidFillStyle":68,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/c3tool/AbstractC3Tool":79,"weaveapp/ui/ColorPicker":113,"weaveapp/ui/SelectableAttributeComponent":123,"weaveapp/util/ChartUtils":131,"weaveapp/util/FormatUtils":133,"weavejs":136}],85:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _d=require("d3");var d3=_interopRequireWildcard(_d);var _AbstractC3Tool2=require("weaveapp/tool/c3tool/AbstractC3Tool");var _AbstractC3Tool3=_interopRequireDefault(_AbstractC3Tool2);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _FormatUtils=require("weaveapp/util/FormatUtils");var _FormatUtils2=_interopRequireDefault(_FormatUtils);var _ChartUtils=require("weaveapp/util/ChartUtils");var _ChartUtils2=_interopRequireDefault(_ChartUtils);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ComboBox=weavejs.ui.ComboBox;var Accordion=weavejs.ui.Accordion;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var LinkableHashMap=weavejs.core.LinkableHashMap;var LinkableString=weavejs.core.LinkableString;var LinkableNumber=weavejs.core.LinkableNumber;var ColumnUtils=weavejs.data.ColumnUtils;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var C3LineChart=function(_AbstractC3Tool){_inherits(C3LineChart,_AbstractC3Tool);function C3LineChart(props){_classCallCheck(this,C3LineChart);var _this=_possibleConstructorReturn(this,(C3LineChart.__proto__||Object.getPrototypeOf(C3LineChart)).call(this,props));_this.columns=_weavejs.Weave.linkableChild(_this,new LinkableHashMap(IAttributeColumn));_this.line=_weavejs.Weave.linkableChild(_this,_SolidLineStyle2.default);_this.curveType=_weavejs.Weave.linkableChild(_this,LinkableString);_this.xAxisLabelAngle=_weavejs.Weave.linkableChild(_this,new LinkableNumber(-45));_this.RECORD_FORMAT={id:IQualifiedKey,columns:[],line:{color:_this.line.color}};_this.RECORD_DATATYPE={columns:Number,line:{color:String}};_this.renderEditor=function(pushCrumb){return Accordion.render([_weavejs.Weave.lang("Data"),_this.getSelectableAttributesEditor(pushCrumb)],[_weavejs.Weave.lang("Display"),[[_weavejs.Weave.lang("X axis label angle"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.xAxisLabelAngle}),options:_ChartUtils2.default.getAxisLabelAngleChoices()})]]],[_weavejs.Weave.lang("Titles"),_this.getTitlesEditor()],[_weavejs.Weave.lang("Margins"),_this.getMarginEditor()],[_weavejs.Weave.lang("Accessibility"),_this.getAltTextEditor()])};_this.line.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.keyToIndex={};_this.yAxisValueToLabel={};_this.c3ConfigYAxis={show:true,label:{text:"",position:"outer-middle"},tick:{multiline:true,format:function format(num){var columns=_this.columns.getObjects(IAttributeColumn);if(columns[0]&&columns[0].getMetadata("dataType")!=="number"){return _weavejs.Weave.lang(_this.yAxisValueToLabel[num])||""}else{return String(_FormatUtils2.default.defaultNumberFormatting(num))}}}};_this.mergeConfig({data:{columns:[],xSort:false,selection:{enabled:true,multiple:true,draggable:true}},grid:{x:{show:true},y:{show:true}},point:{focus:{expand:{enabled:false}},select:{r:3.5}},axis:{x:{label:{text:"",position:"outer-center"},tick:{culling:{max:null},multiline:false,rotate:_this.xAxisLabelAngle.value,format:function format(d){if(_weavejs.WeaveAPI.Locale.reverseLayout){var temp=_this.columnLabels.length-1;return _this.formatXAxisLabel(_weavejs.Weave.lang(_this.columnLabels[temp-d]),_this.xAxisLabelAngle.value)}else{return _this.formatXAxisLabel(_weavejs.Weave.lang(_this.columnLabels[d]),_this.xAxisLabelAngle.value)}}}}},legend:{show:false}});return _this}_createClass(C3LineChart,[{key:"getQKey",value:function getQKey(datum){if(!datum)return null;var record=this.records[this.keyToIndex[datum.id]];return record?record.id:null}},{key:"handleC3MouseOver",value:function handleC3MouseOver(d){var key=this.getQKey(d);if(this.probeKeySet)this.probeKeySet.replaceKeys([key]);this.toolTip.show(this,this.chart.internal.d3.event,[key],this.columns.getObjects(IAttributeColumn))}},{key:"handleC3Selection",value:function handleC3Selection(){if(!this.selectionKeySet)return;var set_selectedKeys=new Set;var selectedKeys=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.chart.selected()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var d=_step.value;var key=this.getQKey(d);if(key&&!set_selectedKeys.has(key)){set_selectedKeys.add(key);selectedKeys.push(key)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.selectionKeySet.replaceKeys(selectedKeys)}},{key:"validate",value:function validate(){var _this2=this;var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var changeDetected=false;var axisChange=_weavejs.Weave.detectChange(this,this.columns,this.overrideBounds,this.xAxisName,this.yAxisName,this.margin,this.xAxisLabelAngle);var dataChanged=axisChange||_weavejs.Weave.detectChange(this,this.curveType,this.line,this.filteredKeySet);if(dataChanged){changeDetected=true;this.columnLabels=[];var columns=this.columns.getObjects(IAttributeColumn);this.filteredKeySet.setColumnKeySources(columns);if(_weavejs.WeaveAPI.Locale.reverseLayout)columns.reverse();this.RECORD_FORMAT.columns=[IQualifiedKey].concat(columns);for(var idx in columns){var child=columns[idx];var title=child.getMetadata("title");this.columnLabels.push(title)}this.records=ColumnUtils.getRecords(this.RECORD_FORMAT,this.filteredKeySet.keys,this.RECORD_DATATYPE);this.records=_.sortBy(this.records,[0,"id"]);this.keyToIndex={};this.yAxisValueToLabel={};this.records.forEach(function(record,index){_this2.keyToIndex[record.id]=index;_this2.yAxisValueToLabel[record.id]=record.id.toString()});var colors={};this.records.forEach(function(record){colors[record.id]=record.line.color||"#000000"});this.c3Config.data.type=this.curveType.value==="double"?"spline":"line";this.c3Config.data.columns=_.map(this.records,"columns");this.c3Config.data.colors=colors}if(axisChange){changeDetected=true;var xLabel=this.xAxisName.value;var yLabel=this.yAxisName.value;if(this.records){var axes={};if(_weavejs.WeaveAPI.Locale.reverseLayout){this.records.forEach(function(record){axes[record.id]="y2"});this.c3Config.data.axes=axes;this.c3Config.axis.y2=this.c3ConfigYAxis;this.c3Config.axis.y={show:false};this.c3Config.axis.x.tick.rotate=-1*this.xAxisLabelAngle.value}else{this.records.forEach(function(record){axes[record.id]="y"});this.c3Config.data.axes=axes;this.c3Config.axis.y=this.c3ConfigYAxis;delete this.c3Config.axis.y2;this.c3Config.axis.x.tick.rotate=this.xAxisLabelAngle.value}}this.c3Config.axis.x.label={text:xLabel,position:"outer-center"};this.c3ConfigYAxis.label={text:yLabel,position:"outer-middle"};this.updateConfigMargin();this.updateConfigAxisY()}if(changeDetected||forced)return true;if(this.selectionKeySet)this.chart.select(this.selectionKeySet.keys.map(function(key){return key.toString()}),null,true);var selectionEmpty=!this.selectionKeySet||this.selectionKeySet.keys.length===0;d3.select(this.element).selectAll("circle.c3-shape").style("stroke",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed&&selected)return"white";else return"black"}).style("opacity",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);return selectionEmpty||selected||probed?1:0.3}).style("stroke-opacity",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed)return 1;if(selected)return 0.5;if(!selectionEmpty&&!selected)return 0;return 0}).style("stroke-width",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed&&selected)return 1;return probed?2:1});d3.select(this.element).selectAll("path.c3-shape.c3-line").style("opacity",function(d,i,oi){var key=_this2.records[i].id;var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);return selectionEmpty||selected||probed?1:0.3}).style("stroke-width",function(d,i,oi){var key=_this2.records[i].id;var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);return probed?3:selected?2:1});d3.select(this.element).selectAll("circle.c3-selected-circle").attr("r",function(d,i,oi){return 3.5}).style("stroke","black").style("stroke-opacity",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed&&selected)return 1;else return 0}).style("stroke-width","1px");return false}},{key:"selectableAttributes",get:function get(){return _get(C3LineChart.prototype.__proto__||Object.getPrototypeOf(C3LineChart.prototype),"selectableAttributes",this).set("Color",this.line.color).set("Y columns",this.columns)}},{key:"defaultPanelTitle",get:function get(){var columns=this.columns.getObjects();if(columns.length==0)return _weavejs.Weave.lang("Line chart");return _weavejs.Weave.lang("Line chart of {0}",columns.map(function(column){return ColumnUtils.getTitle(column)}).join(_weavejs.Weave.lang(", ")))}},{key:"deprecatedStateMapping",get:function get(){return[_get(C3LineChart.prototype.__proto__||Object.getPrototypeOf(C3LineChart.prototype),"deprecatedStateMapping",this),{"children":{"visualization":{"plotManager":{"plotters":{"plot":{"filteredKeySet":this.filteredKeySet,"columns":this.columns,"curveType":this.curveType,"lineStyle":this.line,"enableGroupBy":false,"groupKeyType":"","normalize":false,"shapeBorderAlpha":0.5,"shapeBorderColor":0,"shapeBorderThickness":1,"shapeSize":5,"shapeToDraw":"Solid Circle","zoomToSubset":false}}}}}}]}}]);return C3LineChart}(_AbstractC3Tool3.default);exports.default=C3LineChart;C3LineChart.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3LineChart,{id:"weavejs.tool.c3tool.C3LineChart",label:"Line Chart",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes,_IAltText2.default],deprecatedIds:["weave.visualization.tools::LineChartTool"]});

},{"d3":"d3","lodash":"lodash","react":"react","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/c3tool/AbstractC3Tool":79,"weaveapp/util/ChartUtils":131,"weaveapp/util/FormatUtils":133,"weavejs":136}],86:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractC3Tool2=require("weaveapp/tool/c3tool/AbstractC3Tool");var _AbstractC3Tool3=_interopRequireDefault(_AbstractC3Tool2);var _SolidFillStyle=require("weaveapp/plot/SolidFillStyle");var _SolidFillStyle2=_interopRequireDefault(_SolidFillStyle);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Accordion=weavejs.ui.Accordion;var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var DynamicColumn=weavejs.data.column.DynamicColumn;var LinkableNumber=weavejs.core.LinkableNumber;var ArrayUtils=weavejs.util.ArrayUtils;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ColumnUtils=weavejs.data.ColumnUtils;var recordsToBeDisplayed=360;var C3PieChart=function(_AbstractC3Tool){_inherits(C3PieChart,_AbstractC3Tool);function C3PieChart(props){_classCallCheck(this,C3PieChart);var _this=_possibleConstructorReturn(this,(C3PieChart.__proto__||Object.getPrototypeOf(C3PieChart)).call(this,props));_this.data=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.label=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.fill=_weavejs.Weave.linkableChild(_this,_SolidFillStyle2.default);_this.line=_weavejs.Weave.linkableChild(_this,_SolidLineStyle2.default);_this.innerRadius=_weavejs.Weave.linkableChild(_this,LinkableNumber);_this.RECORD_FORMAT={id:IQualifiedKey,data:_this.data,line:{color:_this.line.color},fill:{color:_this.fill.color},label:_this.label};_this.RECORD_DATATYPE={data:Number,line:{color:String},fill:{color:String},label:String};_this.renderEditor=function(pushCrumb){return Accordion.render(["Data",_this.getSelectableAttributesEditor(pushCrumb)],["Titles",_this.getTitlesEditor()],["Margins",_this.getMarginEditor()],["Accessibility",_this.getAltTextEditor()])};_this.filteredKeySet.setSingleKeySource(_this.data);_this.fill.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.keyToIndex={};_this.records=[];_this.mergeConfig({data:{columns:[],type:"pie"},pie:{label:{show:true,format:function format(value,ratio,id){var record=_this.records[_this.keyToIndex[id]];if(record&&record.label)return _weavejs.Weave.lang(record.label);return String(value)}}},donut:{label:{show:true,format:function format(value,ratio,id){var record=_this.records[_this.keyToIndex[id]];if(record&&record.label)return _weavejs.Weave.lang(record.label);return String(value)}}},legend:{show:false}});return _this}_createClass(C3PieChart,[{key:"handleC3MouseOver",value:function handleC3MouseOver(d){var key=this.records[d.index].id;if(this.probeKeySet)this.probeKeySet.replaceKeys([key]);this.toolTip.show(this,this.chart.internal.d3.event,[key],[this.data])}},{key:"handleC3Selection",value:function handleC3Selection(){var _this2=this;if(!this.selectionKeySet)return;var selectedIndices=this.chart.selected();var selectedKeys=selectedIndices.map(function(value){return _this2.records[value.index].id});this.selectionKeySet.replaceKeys(selectedKeys)}},{key:"updateStyle",value:function updateStyle(){var _this3=this;var selectedKeys=this.selectionKeySet?this.selectionKeySet.keys:[];var probedKeys=this.probeKeySet?this.probeKeySet.keys:[];var selectedIndices=selectedKeys.map(function(key){return Number(_this3.keyToIndex[key])});var probedIndices=probedKeys.map(function(key){return Number(_this3.keyToIndex[key])});var keys=Object.keys(this.keyToIndex);var indices=keys.map(function(key){return Number(_this3.keyToIndex[key])});var unselectedIndices=_.difference(indices,selectedIndices);unselectedIndices=_.difference(unselectedIndices,probedIndices);if(probedIndices.length){this.chart.focus(probedKeys)}else if(selectedIndices.length){this.chart.focus(selectedKeys)}else if(!probedIndices.length){this.chart.focus()}}},{key:"validate",value:function validate(){var _this4=this;var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(_weavejs.Weave.isBusy(this))return;var dataChanged=_weavejs.Weave.detectChange(this,this.data,this.label,this.innerRadius,this.fill,this.line,this.filteredKeySet);if(dataChanged){this.records=ColumnUtils.getRecords(this.RECORD_FORMAT,this.filteredKeySet.keys,this.RECORD_DATATYPE);if(this.records.length>recordsToBeDisplayed){this.records=this.records.slice(0,recordsToBeDisplayed);this.records=_.sortBy(this.records,"data")}this.keyToIndex={};this.records.forEach(function(record,index){_this4.keyToIndex[record.id]=index});var columns=this.records.map(function(record){return[record.id,record.data]});var colors={};this.records.forEach(function(record){colors[record.id]=record.fill.color&&record.fill.color!=="NaN"?record.fill.color:"#808080"});this.c3Config.data.columns=columns;this.c3Config.data.type=this.innerRadius.value>0?"donut":"pie";this.c3Config.data.colors=colors;this.c3Config.data.unload=true}var axisChanged=_weavejs.Weave.detectChange(this,this.xAxisName,this.yAxisName,this.margin);if(forced||dataChanged||axisChanged)return true;var selectedKeys=this.selectionKeySet?this.selectionKeySet.keys:[];var keyToIndex=ArrayUtils.createLookup(this.records,"id");var selectedIndices=selectedKeys.map(function(key){return Number(keyToIndex.get(key))});this.chart.select(null,selectedIndices,true);this.updateStyle();return false}},{key:"getTitlesEditor",value:function getTitlesEditor(){var _this5=this;return[["Chart",this.panelTitle,this.defaultPanelTitle]].map(function(row){return[_weavejs.Weave.lang(row[0]),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(_this5,{value:row[1]}),placeholder:row[2]})]})}},{key:"selectableAttributes",get:function get(){return _get(C3PieChart.prototype.__proto__||Object.getPrototypeOf(C3PieChart.prototype),"selectableAttributes",this).set("Label",this.label).set("Color",this.fill.color).set("Wedge Size",this.data)}},{key:"defaultPanelTitle",get:function get(){return _weavejs.Weave.lang("Pie Chart of {0}",ColumnUtils.getTitle(this.data))}},{key:"deprecatedStateMapping",get:function get(){return[_get(C3PieChart.prototype.__proto__||Object.getPrototypeOf(C3PieChart.prototype),"deprecatedStateMapping",this),{"children":{"visualization":{"plotManager":{"plotters":{"plot":{"filteredKeySet":this.filteredKeySet,"data":this.data,"fill":this.fill,"innerRadius":this.innerRadius,"label":this.label,"line":this.line,"labelAngleRatio":0}}}}}}]}}]);return C3PieChart}(_AbstractC3Tool3.default);exports.default=C3PieChart;C3PieChart.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3PieChart,{id:"weavejs.tool.c3tool.C3PieChart",label:"Pie Chart",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes,_IAltText2.default],deprecatedIds:["weave.visualization.tools::PieChartTool"]});

},{"lodash":"lodash","react":"react","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/plot/SolidFillStyle":68,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/c3tool/AbstractC3Tool":79,"weavejs":136}],87:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _d=require("d3");var d3=_interopRequireWildcard(_d);var _SolidFillStyle=require("weaveapp/plot/SolidFillStyle");var _SolidFillStyle2=_interopRequireDefault(_SolidFillStyle);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _AbstractC3Tool2=require("weaveapp/tool/c3tool/AbstractC3Tool");var _AbstractC3Tool3=_interopRequireDefault(_AbstractC3Tool2);var _FormatUtils=require("weaveapp/util/FormatUtils");var _FormatUtils2=_interopRequireDefault(_FormatUtils);var _ChartUtils=require("weaveapp/util/ChartUtils");var _ChartUtils2=_interopRequireDefault(_ChartUtils);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ComboBox=weavejs.ui.ComboBox;var Accordion=weavejs.ui.Accordion;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var DynamicColumn=weavejs.data.column.DynamicColumn;var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var NormalizedColumn=weavejs.data.column.NormalizedColumn;var LinkableNumber=weavejs.core.LinkableNumber;var StandardLib=weavejs.util.StandardLib;var ColumnUtils=weavejs.data.ColumnUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var C3ScatterPlot=function(_AbstractC3Tool){_inherits(C3ScatterPlot,_AbstractC3Tool);function C3ScatterPlot(props){_classCallCheck(this,C3ScatterPlot);var _this=_possibleConstructorReturn(this,(C3ScatterPlot.__proto__||Object.getPrototypeOf(C3ScatterPlot)).call(this,props));_this.dataX=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.dataY=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.radius=_weavejs.Weave.linkableChild(_this,new AlwaysDefinedColumn(5));_this.fill=_weavejs.Weave.linkableChild(_this,_SolidFillStyle2.default);_this.line=_weavejs.Weave.linkableChild(_this,_SolidLineStyle2.default);_this.xAxisLabelAngle=_weavejs.Weave.linkableChild(_this,new LinkableNumber(-45));_this.RECORD_FORMAT={id:IQualifiedKey,point:{x:_this.dataX,y:_this.dataY},size:_this.radius,fill:{color:_this.fill.color},line:{color:_this.line.color}};_this.RECORD_DATATYPE={point:{x:Number,y:Number},size:Number,fill:{color:String},line:{color:String}};_this.renderEditor=function(pushCrumb){return Accordion.render([_weavejs.Weave.lang("Data"),_this.getSelectableAttributesEditor(pushCrumb)],[_weavejs.Weave.lang("Display"),[[_weavejs.Weave.lang("X axis label angle"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.xAxisLabelAngle}),options:_ChartUtils2.default.getAxisLabelAngleChoices()})]]],[_weavejs.Weave.lang("Titles"),_this.getTitlesEditor()],[_weavejs.Weave.lang("Margins"),_this.getMarginEditor()],[_weavejs.Weave.lang("Accessibility"),_this.getAltTextEditor()])};_this.radius.internalDynamicColumn.requestLocalObject(NormalizedColumn,true);_this.filteredKeySet.setColumnKeySources([_this.dataX,_this.dataY]);_this.radiusNorm.min.value=3;_this.radiusNorm.max.value=25;_this.fill.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.keyToIndex=new Map;_this.yAxisValueToLabel={};_this.xAxisValueToLabel={};_this.mergeConfig({data:{rows:[],x:"x",xSort:false,type:"scatter",color:function color(_color,d){if(d.hasOwnProperty("index")){var record=_this.records[d.index];_color=record?record.fill.color:null;if(_color&&_color.charAt(0)!="#")_color=StandardLib.getHexColor(Number(_color))}return _color||"#000000"}},legend:{show:false},axis:{x:{label:{text:"",position:"outer-center"},tick:{format:function format(num){if(_this.xAxisValueToLabel&&_this.dataXType!=="number"){return _weavejs.Weave.lang(_this.xAxisValueToLabel[num])||""}else{return String(_FormatUtils2.default.defaultNumberFormatting(num))}},rotate:_this.xAxisLabelAngle.value,culling:{max:null},fit:false}}},grid:{x:{show:true},y:{show:true}},point:{r:function r(d){if(d.hasOwnProperty("index")){return Math.round(_this.records[d.index].size)}},focus:{expand:{enabled:false}},select:{r:function r(d){if(d.hasOwnProperty("index"))return Math.round(_this.records[d.index].size);return 0}}}});_this.c3ConfigYAxis={show:true,label:{text:"",position:"outer-middle"},tick:{format:function format(num){if(_this.yAxisValueToLabel&&_this.dataYType!=="number"){return _weavejs.Weave.lang(_this.yAxisValueToLabel[num])||""}else{return String(_FormatUtils2.default.defaultNumberFormatting(num))}}}};return _this}_createClass(C3ScatterPlot,[{key:"handleC3MouseOver",value:function handleC3MouseOver(d){var key=this.records[d.index].id;if(this.probeKeySet)this.probeKeySet.replaceKeys([key]);this.toolTip.show(this,this.chart.internal.d3.event,[key],[this.dataX,this.dataY,this.radiusData])}},{key:"handleC3Selection",value:function handleC3Selection(){var _this2=this;if(!this.selectionKeySet)return;var selectedIndices=this.chart.selected();var selectedKeys=selectedIndices.map(function(value){return _this2.records[value.index].id});this.selectionKeySet.replaceKeys(selectedKeys)}},{key:"validate",value:function validate(){var _this3=this;var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var xyChanged=_weavejs.Weave.detectChange(this,this.dataX,this.dataY);var dataChanged=xyChanged||_weavejs.Weave.detectChange(this,this.radius,this.fill,this.line,this.filteredKeySet);if(dataChanged){this.dataXType=this.dataX.getMetadata("dataType");this.dataYType=this.dataY.getMetadata("dataType");this.records=ColumnUtils.getRecords(this.RECORD_FORMAT,this.filteredKeySet.keys,this.RECORD_DATATYPE);this.records=_.sortByOrder(this.records,["size","id"],["desc","asc"]);this.keyToIndex.clear();this.yAxisValueToLabel={};this.xAxisValueToLabel={};this.records.forEach(function(record,index){_this3.keyToIndex.set(record.id,index);_this3.xAxisValueToLabel[_this3.records[index].point.x]=_this3.dataX.getValueFromKey(record.id,String);_this3.yAxisValueToLabel[_this3.records[index].point.y]=_this3.dataY.getValueFromKey(record.id,String)});this.c3Config.data.json={x:_.map(this.records,"point.x"),y:_.map(this.records,"point.y")}}var axisChanged=xyChanged||_weavejs.Weave.detectChange(this,this.xAxisName,this.yAxisName,this.margin,this.xAxisLabelAngle);if(axisChanged){var xLabel=_weavejs.Weave.lang(this.xAxisName.value)||this.defaultXAxisLabel;var yLabel=_weavejs.Weave.lang(this.yAxisName.value)||this.defaultYAxisLabel;if(_weavejs.WeaveAPI.Locale.reverseLayout){this.c3Config.data.axes={"y":"y2"};this.c3Config.axis.y2=this.c3ConfigYAxis;this.c3Config.axis.y={show:false};this.c3Config.axis.x.tick.rotate=-1*this.xAxisLabelAngle.value}else{this.c3Config.data.axes={"y":"y"};this.c3Config.axis.y=this.c3ConfigYAxis;delete this.c3Config.axis.y2;this.c3Config.axis.x.tick.rotate=this.xAxisLabelAngle.value}this.c3Config.axis.x.label={text:xLabel,position:"outer-center"};this.c3ConfigYAxis.label={text:yLabel,position:"outer-middle"};this.updateConfigMargin()}if(forced||dataChanged||axisChanged)return true;this.chart.internal.main.select(".c3-chart").attr("clip-path",null);var keyToIndex=function keyToIndex(key){return _this3.keyToIndex.get(key)};var selectedIndices=this.selectionKeySet?this.selectionKeySet.keys.map(keyToIndex):[];this.chart.select(["y"],selectedIndices,true);var selectionEmpty=!this.selectionKeySet||this.selectionKeySet.keys.length===0;d3.select(this.element).selectAll("circle.c3-shape").style("stroke",function(d,i,oi){var key=_this3.records[i].id;var selected=_this3.isSelected(key);var probed=_this3.isProbed(key);if(probed&&selected)return"white";else return"black"}).style("opacity",function(d,i,oi){var key=_this3.records[i].id;var selected=_this3.isSelected(key);var probed=_this3.isProbed(key);return selectionEmpty||selected||probed?1:0.3}).style("stroke-opacity",function(d,i,oi){var key=_this3.records[i].id;var selected=_this3.isSelected(key);var probed=_this3.isProbed(key);if(probed)return 1;return 0.5}).style("stroke-width",function(d,i,oi){var key=_this3.records[i].id;var selected=_this3.isSelected(key);var probed=_this3.isProbed(key);if(probed&&selected)return 1;return probed?2:1});d3.select(this.element).selectAll("circle.c3-selected-circle").attr("r",function(d,i,oi){if(d.hasOwnProperty("index")){return _this3.records[d.index].size+1}}).style("stroke","black").style("stroke-opacity",function(d,i,oi){if(d.hasOwnProperty("index")){var key=_this3.records[d.index].id;var selected=_this3.isSelected(key);var probed=_this3.isProbed(key);if(probed&&selected)return 1;else return 0}}).style("stroke-width","1px");return false}},{key:"getAutomaticDescription",value:function getAutomaticDescription(){return _weavejs.Weave.lang("Scatter plot of {0} vs {1}",this.xAxisName.value,this.yAxisName.value)}},{key:"radiusNorm",get:function get(){return this.radius.getInternalColumn()}},{key:"radiusData",get:function get(){return this.radiusNorm.internalDynamicColumn}},{key:"selectableAttributes",get:function get(){return _get(C3ScatterPlot.prototype.__proto__||Object.getPrototypeOf(C3ScatterPlot.prototype),"selectableAttributes",this).set("X",this.dataX).set("Y",this.dataY).set("Color",this.fill.color).set("Size",this.radius)}},{key:"defaultPanelTitle",get:function get(){return _weavejs.Weave.lang("Scatter Plot of {0} -vs- {1}",ColumnUtils.getTitle(this.dataX),ColumnUtils.getTitle(this.dataY))}},{key:"defaultXAxisLabel",get:function get(){return _weavejs.Weave.lang(this.dataX.getMetadata("title"))}},{key:"defaultYAxisLabel",get:function get(){return _weavejs.Weave.lang(this.dataY.getMetadata("title"))}},{key:"deprecatedStateMapping",get:function get(){return[_get(C3ScatterPlot.prototype.__proto__||Object.getPrototypeOf(C3ScatterPlot.prototype),"deprecatedStateMapping",this),{"children":{"visualization":{"plotManager":{"plotters":{"plot":{"filteredKeySet":this.filteredKeySet,"dataX":this.dataX,"dataY":this.dataY,"sizeBy":this.radiusData,"minScreenRadius":this.radiusNorm.min,"maxScreenRadius":this.radiusNorm.max,"defaultScreenRadius":this.radius.defaultValue,"fill":this.fill,"line":this.line,"showSquaresForMissingSize":false,"colorBySize":false,"colorPositive":65280,"colorNegative":16711680}}}}}}]}}]);return C3ScatterPlot}(_AbstractC3Tool3.default);exports.default=C3ScatterPlot;C3ScatterPlot.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3ScatterPlot,{id:"weavejs.tool.c3tool.C3ScatterPlot",label:"Scatter Plot",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes,_IAltText2.default],deprecatedIds:["weave.visualization.tools::ScatterPlotTool"]});

},{"d3":"d3","lodash":"lodash","react":"react","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/plot/SolidFillStyle":68,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/c3tool/AbstractC3Tool":79,"weaveapp/util/ChartUtils":131,"weaveapp/util/FormatUtils":133,"weavejs":136}],88:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _d=require("d3");var d3=_interopRequireWildcard(_d);var _AbstractC3Tool2=require("weaveapp/tool/c3tool/AbstractC3Tool");var _AbstractC3Tool3=_interopRequireDefault(_AbstractC3Tool2);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _FormatUtils=require("weaveapp/util/FormatUtils");var _FormatUtils2=_interopRequireDefault(_FormatUtils);var _ChartUtils=require("weaveapp/util/ChartUtils");var _ChartUtils2=_interopRequireDefault(_ChartUtils);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ComboBox=weavejs.ui.ComboBox;var Accordion=weavejs.ui.Accordion;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var LinkableHashMap=weavejs.core.LinkableHashMap;var LinkableString=weavejs.core.LinkableString;var DynamicColumn=weavejs.data.column.DynamicColumn;var LinkableNumber=weavejs.core.LinkableNumber;var ColumnUtils=weavejs.data.ColumnUtils;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ColorRamp=weavejs.util.ColorRamp;var C3XYLineChart=function(_AbstractC3Tool){_inherits(C3XYLineChart,_AbstractC3Tool);function C3XYLineChart(props){_classCallCheck(this,C3XYLineChart);var _this=_possibleConstructorReturn(this,(C3XYLineChart.__proto__||Object.getPrototypeOf(C3XYLineChart)).call(this,props));_this.xColumn=_weavejs.Weave.linkableChild(_this,new DynamicColumn);_this.sortColumn=_weavejs.Weave.linkableChild(_this,new DynamicColumn);_this.yColumns=_weavejs.Weave.linkableChild(_this,new LinkableHashMap(IAttributeColumn));_this.line=_weavejs.Weave.linkableChild(_this,_SolidLineStyle2.default);_this.curveType=_weavejs.Weave.linkableChild(_this,LinkableString);_this.ramp=_weavejs.Weave.linkableChild(_this,ColorRamp);_this.xAxisLabelAngle=_weavejs.Weave.linkableChild(_this,new LinkableNumber(-45));_this.data=[];_this.renderEditor=function(pushCrumb){return Accordion.render([_weavejs.Weave.lang("Data"),_this.getSelectableAttributesEditor(pushCrumb)],[_weavejs.Weave.lang("Display"),[[_weavejs.Weave.lang("X axis label angle"),React.createElement(ComboBox,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(_this,{value:_this.xAxisLabelAngle}),options:_ChartUtils2.default.getAxisLabelAngleChoices()})]]],[_weavejs.Weave.lang("Titles"),_this.getTitlesEditor()],[_weavejs.Weave.lang("Margins"),_this.getMarginEditor()],[_weavejs.Weave.lang("Accessibility"),_this.getAltTextEditor()])};_this.line.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.yAxisValueToLabel={};_this.c3ConfigYAxis={show:true,label:{text:"",position:"outer-middle"},tick:{multiline:true,format:function format(num){var columns=_this.yColumns.getObjects(IAttributeColumn);if(columns[0]&&columns[0].getMetadata("dataType")!=="number"){return _weavejs.Weave.lang(_this.yAxisValueToLabel[num])||""}else{return String(_FormatUtils2.default.defaultNumberFormatting(num))}}}};_this.mergeConfig({data:{x:"x",columns:[],xSort:false,selection:{enabled:true,multiple:true,draggable:true}},grid:{x:{show:true},y:{show:true}},point:{focus:{expand:{enabled:false}},select:{r:3.5}},axis:{x:{label:{text:"",position:"outer-center"},tick:{culling:{max:null},format:function format(num){var key=_this.indexToKey[num];if(_this.xColumn.getInternalColumn()&&_this.dataXType!="number"){if(key)return _weavejs.Weave.lang(_this.xColumn.getValueFromKey(key));else return""}return String(_FormatUtils2.default.defaultNumberFormatting(num))},rotate:_this.xAxisLabelAngle.value,fit:false,multiline:false}}},legend:{show:false}});return _this}_createClass(C3XYLineChart,[{key:"getQKey",value:function getQKey(d){return this.indexToKey[d.index]}},{key:"handleC3MouseOver",value:function handleC3MouseOver(d){var key=this.getQKey(d);if(this.probeKeySet)this.probeKeySet.replaceKeys([key]);this.toolTip.show(this,this.chart.internal.d3.event,[key],[this.xColumn].concat(this.yColumns.getObjects(IAttributeColumn)))}},{key:"handleC3Selection",value:function handleC3Selection(){if(!this.selectionKeySet)return;var set_selectedKeys=new Set;var selectedKeys=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.chart.selected()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var d=_step.value;var key=this.getQKey(d);if(key&&!set_selectedKeys.has(key)){set_selectedKeys.add(key);selectedKeys.push(key)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.selectionKeySet.replaceKeys(selectedKeys)}},{key:"validate",value:function validate(){var _this2=this;var forced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var changeDetected=false;var axisChange=_weavejs.Weave.detectChange(this,this.xColumn,this.sortColumn,this.yColumns,this.overrideBounds,this.xAxisName,this.yAxisName,this.margin,this.xAxisLabelAngle);var dataChanged=axisChange||_weavejs.Weave.detectChange(this,this.curveType,this.line,this.filteredKeySet);if(dataChanged){changeDetected=true;this.columnLabels=[];this.indexToKey={};var colors={};this.dataXType=this.xColumn.getMetadata("dataType");var columns=this.yColumns.getObjects(IAttributeColumn);columns.forEach(function(column,idx){var child=columns[idx];var title=ColumnUtils.getTitle(child);_this2.columnLabels.push(title);colors[title]=_this2.ramp.getHexColor(idx,0,columns.length)});columns.unshift(this.xColumn);this.filteredKeySet.setColumnKeySources(columns);this.data=ColumnUtils.joinColumns(columns,Number,false,this.filteredKeySet.keys);var keysArray=this.data.shift();keysArray.forEach(function(key,index){_this2.indexToKey[index]=key});var dataObjects=[];if(columns.length){this.data[0].forEach(function(item,index){var dataObject={};columns.forEach(function(column,idx){var label=ColumnUtils.getTitle(column);dataObject[label]=_this2.data[idx][index]});dataObject["key"]=_this2.indexToKey[index];dataObjects.push(dataObject)})}dataObjects=_.sortByOrder(dataObjects,[this.sortColumn.target?ColumnUtils.getTitle(this.sortColumn):ColumnUtils.getTitle(this.xColumn)],["asc"]);dataObjects.forEach(function(object,index){columns.forEach(function(column,idx){var label=ColumnUtils.getTitle(column);_this2.data[idx][index]=dataObjects[index][label]});_this2.indexToKey[index]=dataObjects[index]["key"]});if(_weavejs.WeaveAPI.Locale.reverseLayout){this.data.forEach(function(column,index){column.reverse()})}this.data.forEach(function(column,index){if(index==0)column.unshift("x");else column.unshift(_this2.columnLabels[index-1])});this.c3Config.data.type=this.curveType.value==="double"?"spline":"line";this.c3Config.data.columns=this.data;this.c3Config.data.colors=colors}if(axisChange){changeDetected=true;var xLabel=this.xAxisName.value;var yLabel=this.yAxisName.value;if(this.columnLabels.length){var axes={};var columns=this.yColumns.getObjects(IAttributeColumn);if(_weavejs.WeaveAPI.Locale.reverseLayout){this.columnLabels.forEach(function(label,index){axes[label]="y2"});this.c3Config.data.axes=axes;this.c3Config.axis.y2=this.c3ConfigYAxis;this.c3Config.axis.y={show:false};this.c3Config.axis.x.tick.rotate=-1*this.xAxisLabelAngle.value;this.c3Config.axis.x.type="category"}else{this.columnLabels.forEach(function(label,index){axes[label]="y"});this.c3Config.data.axes=axes;this.c3Config.axis.y=this.c3ConfigYAxis;delete this.c3Config.axis.y2;this.c3Config.axis.x.tick.rotate=this.xAxisLabelAngle.value;this.c3Config.axis.x.type="category"}}this.c3Config.axis.x.label={text:xLabel,position:"outer-center"};this.c3ConfigYAxis.label={text:yLabel,position:"outer-middle"};this.updateConfigMargin();this.updateConfigAxisY()}if(changeDetected||forced)return true;if(this.selectionKeySet)this.chart.select(this.selectionKeySet.keys.map(function(key){return key.toString()}),null,true);var selectionEmpty=!this.selectionKeySet||this.selectionKeySet.keys.length===0;d3.select(this.element).selectAll("circle.c3-shape").style("stroke",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed&&selected)return"white";else return"black"}).style("opacity",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);return selectionEmpty||selected||probed?1:0.3}).style("stroke-opacity",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed)return 1;if(selected)return 0.5;if(!selectionEmpty&&!selected)return 0;return 0}).style("stroke-width",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed&&selected)return 1;return probed?2:1});d3.select(this.element).selectAll("circle.c3-selected-circle").attr("r",function(d,i,oi){return 3.5}).style("stroke","black").style("stroke-opacity",function(d,i,oi){var key=_this2.getQKey(d);var selected=_this2.isSelected(key);var probed=_this2.isProbed(key);if(probed&&selected)return 1;else return 0}).style("stroke-width","1px");return false}},{key:"selectableAttributes",get:function get(){return _get(C3XYLineChart.prototype.__proto__||Object.getPrototypeOf(C3XYLineChart.prototype),"selectableAttributes",this).set("X",this.xColumn).set("Sort",this.sortColumn).set("Y columns",this.yColumns)}},{key:"defaultPanelTitle",get:function get(){var columns=this.yColumns.getObjects();if(columns.length==0)return _weavejs.Weave.lang("XY Line chart");return _weavejs.Weave.lang("XY Line chart of {0}",[ColumnUtils.getTitle(this.xColumn)].concat(columns.map(function(column){return ColumnUtils.getTitle(column)}).join(_weavejs.Weave.lang(", "))))}},{key:"deprecatedStateMapping",get:function get(){return[_get(C3XYLineChart.prototype.__proto__||Object.getPrototypeOf(C3XYLineChart.prototype),"deprecatedStateMapping",this),{"children":{"visualization":{"plotManager":{"plotters":{"plot":{"filteredKeySet":this.filteredKeySet,"columns":this.yColumns,"curveType":this.curveType,"lineStyle":this.line,"enableGroupBy":false,"groupKeyType":"","normalize":false,"shapeBorderAlpha":0.5,"shapeBorderColor":0,"shapeBorderThickness":1,"shapeSize":5,"shapeToDraw":"Solid Circle","zoomToSubset":false}}}}}}]}}]);return C3XYLineChart}(_AbstractC3Tool3.default);exports.default=C3XYLineChart;C3XYLineChart.WEAVE_INFO=_weavejs.Weave.setClassInfo(C3XYLineChart,{id:"weavejs.tool.c3tool.C3XYLineChart",label:"XY Line Chart",interfaces:[_IVisTool2.default,ILinkableObjectWithNewProperties,ISelectableAttributes,_IAltText2.default],deprecatedIds:["weave.visualization.tools::XYLineChartTool"]});

},{"d3":"d3","lodash":"lodash","react":"react","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/c3tool/AbstractC3Tool":79,"weaveapp/util/ChartUtils":131,"weaveapp/util/FormatUtils":133,"weavejs":136}],89:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _ProbeInteraction=require("weaveapp/tool/oltool/ProbeInteraction");var _ProbeInteraction2=_interopRequireDefault(_ProbeInteraction);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CustomDragZoom=function(_ol$interaction$DragB){_inherits(CustomDragZoom,_ol$interaction$DragB);function CustomDragZoom(){_classCallCheck(this,CustomDragZoom);var _this=_possibleConstructorReturn(this,(CustomDragZoom.__proto__||Object.getPrototypeOf(CustomDragZoom)).call(this,{}));_this.on("boxstart",CustomDragZoom.prototype.onBoxStart,_this);_this.on("boxend",CustomDragZoom.prototype.onBoxEnd,_this);return _this}_createClass(CustomDragZoom,[{key:"onBoxStart",value:function onBoxStart(event){if(this.probeInteraction)this.probeInteraction.setActive(false)}},{key:"onBoxEnd",value:function onBoxEnd(event){if(this.probeInteraction)this.probeInteraction.setActive(true);var extent=this.getGeometry().getExtent();var view=this.getMap().getView();var size=this.getMap().getSize();view.fit(this.getGeometry(),size,{constrainResolution:false})}},{key:"probeInteraction",get:function get(){if(!this._probeInteraction){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.getMap().getInteractions().getArray()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var interaction=_step.value;if(interaction instanceof _ProbeInteraction2.default){this._probeInteraction=interaction;break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}return this._probeInteraction}}]);return CustomDragZoom}(ol.interaction.DragBox);exports.default=CustomDragZoom;

},{"openlayers":"openlayers","weaveapp/tool/oltool/ProbeInteraction":98}],90:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CustomView=function(_ol$View){_inherits(CustomView,_ol$View);function CustomView(){_classCallCheck(this,CustomView);var _this=_possibleConstructorReturn(this,(CustomView.__proto__||Object.getPrototypeOf(CustomView)).apply(this,arguments));_this.enableResolutionConstraint=true;return _this}_createClass(CustomView,[{key:"constrainResolution",value:function constrainResolution(resolution,opt_delta,opt_direction){if(this.enableResolutionConstraint||opt_delta!==undefined){return _get(CustomView.prototype.__proto__||Object.getPrototypeOf(CustomView.prototype),"constrainResolution",this).call(this,resolution,opt_delta,opt_direction)}else{return resolution}}}]);return CustomView}(ol.View);exports.default=CustomView;

},{"openlayers":"openlayers"}],91:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _IOpenLayersMapTool=require("weaveapp/tool/oltool/IOpenLayersMapTool");var _IOpenLayersMapTool2=_interopRequireDefault(_IOpenLayersMapTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CustomZoomToExtent=function(_ol$control$Control){_inherits(CustomZoomToExtent,_ol$control$Control);function CustomZoomToExtent(opt_options){_classCallCheck(this,CustomZoomToExtent);var options=opt_options?opt_options:{};var className=options.className?options.className:"ol-zoom-extent";var label=options.label?options.label:"E";var tipLabel=options.tipLabel?options.tipLabel:"Zoom to extent";var button=(0,_jquery2.default)("<button>").addClass(className).prop("title",tipLabel).append(label);var div=(0,_jquery2.default)("<div>").addClass("ol-unselectable ol-control ol-zoom-extent").append(button);var _this=_possibleConstructorReturn(this,(CustomZoomToExtent.__proto__||Object.getPrototypeOf(CustomZoomToExtent)).call(this,{target:options.target,element:div[0]}));_this.extent=options.extent?options.extent:null;button.click(_this.handleClick.bind(_this));return _this}_createClass(CustomZoomToExtent,[{key:"handleClick",value:function handleClick(event){event.preventDefault();this.handleZoomToExtent()}},{key:"handleZoomToExtent",value:function handleZoomToExtent(){var map=this.getMap();var view=map.getView();var tool=this.getMap().get(_IOpenLayersMapTool2.default.MAP_TOOL);var toolBounds=tool.getExtent();var extent=void 0;if(!toolBounds.isEmpty()){extent=toolBounds.getCoords()}else{extent=view.get("extent")||view.getProjection().getExtent()}if(extent)view.fit(extent,map.getSize())}}]);return CustomZoomToExtent}(ol.control.Control);exports.default=CustomZoomToExtent;

},{"openlayers":"openlayers","weaveapp/modules/jquery":63,"weaveapp/tool/oltool/IOpenLayersMapTool":93}],92:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _IOpenLayersMapTool=require("weaveapp/tool/oltool/IOpenLayersMapTool");var _IOpenLayersMapTool2=_interopRequireDefault(_IOpenLayersMapTool);var _AbstractFeatureLayer=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");var _AbstractFeatureLayer2=_interopRequireDefault(_AbstractFeatureLayer);var _AbstractVisTool=require("weaveapp/tool/AbstractVisTool");var _AbstractVisTool2=_interopRequireDefault(_AbstractVisTool);var _ProbeInteraction=require("weaveapp/tool/oltool/ProbeInteraction");var _ProbeInteraction2=_interopRequireDefault(_ProbeInteraction);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DragSelectionMode;(function(DragSelectionMode){DragSelectionMode[DragSelectionMode["SUBTRACT"]=-1]="SUBTRACT";DragSelectionMode[DragSelectionMode["SET"]=0]="SET";DragSelectionMode[DragSelectionMode["ADD"]=1]="ADD"})(DragSelectionMode||(DragSelectionMode={}));;var DragSelection=function(_ol$interaction$DragB){_inherits(DragSelection,_ol$interaction$DragB);function DragSelection(){_classCallCheck(this,DragSelection);var _this=_possibleConstructorReturn(this,(DragSelection.__proto__||Object.getPrototypeOf(DragSelection)).call(this,{boxEndCondition:DragSelection.prototype.boxEndCondition}));_this.on("boxstart",DragSelection.prototype.onBoxStart,_this);_this.on("boxdrag",DragSelection.prototype.onBoxDrag,_this);_this.on("boxend",DragSelection.prototype.onBoxEnd,_this);return _this}_createClass(DragSelection,[{key:"boxEndCondition",value:function boxEndCondition(mapBrowserEvent,startPixel,endPixel){var event=mapBrowserEvent.originalEvent;var width=endPixel[0]-startPixel[0];var height=endPixel[1]-startPixel[1];var tool=mapBrowserEvent.map.get(_IOpenLayersMapTool2.default.MAP_TOOL);this.probeInteraction.setActive(true);if(width*width+height*height<=64){var probeLayer=mapBrowserEvent.map.forEachLayerAtPixel(mapBrowserEvent.pixel,function(layer){var weaveLayer=layer.get("layerObject");if(!(weaveLayer instanceof _AbstractFeatureLayer2.default))return false;if(weaveLayer.probeKeySet&&weaveLayer.probeKeySet.keys.length)return weaveLayer},this,_AbstractFeatureLayer2.default.selectableLayerFilter);if(probeLayer instanceof _AbstractFeatureLayer2.default){_AbstractVisTool2.default.handlePointClick(probeLayer,event);return false}else if(this.mode===DragSelectionMode.SET){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=tool.layers.getObjects()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var weaveLayer=_step.value;if(weaveLayer instanceof _AbstractFeatureLayer2.default){weaveLayer.selectionKeySet&&weaveLayer.selectionKeySet.clearKeys()}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}}},{key:"onBoxStart",value:function onBoxStart(event){if(this.probeInteraction)this.probeInteraction.setActive(false);var dragBoxEvent=event;var browserEvent=dragBoxEvent.mapBrowserEvent.originalEvent;if(browserEvent.ctrlKey&&browserEvent.shiftKey){this.mode=DragSelectionMode.SUBTRACT}else if(browserEvent.ctrlKey){this.mode=DragSelectionMode.ADD}else{this.mode=DragSelectionMode.SET}}},{key:"updateSelection",value:function updateSelection(extent){var selectedFeatures=new Set;var selectFeature=function selectFeature(feature){selectedFeatures.add(feature.getId())};var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.getMap().getLayers().getArray()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var olLayer=_step2.value;var selectable=olLayer.get("selectable");var weaveLayer=olLayer.get("layerObject");if(weaveLayer instanceof _AbstractFeatureLayer2.default&&selectable){var source=olLayer.getSource();var keySet=weaveLayer.selectionKeySet;source.forEachFeatureIntersectingExtent(extent,selectFeature);var keys=Array.from(selectedFeatures);switch(this.mode){case DragSelectionMode.SET:keySet&&keySet.replaceKeys(keys);break;case DragSelectionMode.ADD:keySet&&keySet.addKeys(keys);break;case DragSelectionMode.SUBTRACT:keySet&&keySet.removeKeys(keys);break;}}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"onBoxDrag",value:function onBoxDrag(event){var extent=this.getGeometry().getExtent();this.updateSelection(extent)}},{key:"onBoxEnd",value:function onBoxEnd(event){var extent=this.getGeometry().getExtent();this.updateSelection(extent);if(this.probeInteraction)this.probeInteraction.setActive(true)}},{key:"probeInteraction",get:function get(){if(!this._probeInteraction){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.getMap().getInteractions().getArray()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var interaction=_step3.value;if(interaction instanceof _ProbeInteraction2.default){this._probeInteraction=interaction;break}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}return this._probeInteraction}}]);return DragSelection}(ol.interaction.DragBox);exports.default=DragSelection;

},{"openlayers":"openlayers","weaveapp/tool/AbstractVisTool":70,"weaveapp/tool/oltool/IOpenLayersMapTool":93,"weaveapp/tool/oltool/ProbeInteraction":98,"weaveapp/tool/oltool/layer/AbstractFeatureLayer":100}],93:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.IOpenLayersMapTool=undefined;var _weavejs=require("weavejs");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var IOpenLayersMapTool=exports.IOpenLayersMapTool=function IOpenLayersMapTool(){_classCallCheck(this,IOpenLayersMapTool)};IOpenLayersMapTool.MAP_TOOL="IOpenLayersMapTool";exports.default=IOpenLayersMapTool;_weavejs.WeaveAPI.ClassRegistry.registerClass(IOpenLayersMapTool,"weavejs.api.ui.IOpenLayersMapTool");

},{"weavejs":136}],94:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _IOpenLayersMapTool=require("weaveapp/tool/oltool/IOpenLayersMapTool");var _IOpenLayersMapTool2=_interopRequireDefault(_IOpenLayersMapTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var InteractionModeCluster=function(_ol$control$Control){_inherits(InteractionModeCluster,_ol$control$Control);function InteractionModeCluster(optOptions){_classCallCheck(this,InteractionModeCluster);var iconMapping={"pan":"fa-hand-grab-o","select":"fa-mouse-pointer","zoom":"fa-search-plus"};var nameMapping={"pan":Weave.lang("Pan"),"select":Weave.lang("Selection"),"zoom":Weave.lang("Zoom to Box")};var options=optOptions||{};var div=(0,_jquery2.default)("\n\t\t\t<div style=\"display: flex; flex-direction: column\" class=\"iModeCluster ol-control ol-unselectable\">\n\t\t\t\t<button class=\"modeButton pan fa\" style=\"border-radius: 2px 2px 0 0\"></button>\n\t\t\t\t<button class=\"modeButton select fa\" style=\"border-radius: 0\"></button>\n\t\t\t\t<button class=\"modeButton zoom fa\" style=\"border-radius: 0 0 2px 2px\"></button>\n\t\t\t</div>\n\t\t");var activeButton=div.find("button.activeInteractionMode");var clusterButtons=div.find("button.modeButton");var divider=div.find("span.modeButton");var oldPosition=void 0;var _this=_possibleConstructorReturn(this,(InteractionModeCluster.__proto__||Object.getPrototypeOf(InteractionModeCluster)).call(this,{element:div[0],target:options.target}));var self=_this;function setupButton(mode){div.find("button."+mode).addClass(iconMapping[mode]).prop("title",Weave.lang("Set mouse interaction mode to {0}.",Weave.lang(nameMapping[mode]))).click(function(){if(self.interactionMode)self.interactionMode.value=mode})}for(var key in iconMapping){setupButton(key)}_this.updateInteractionMode_weaveToControl=function(){var mode=self.interactionMode.value;div.find("button.modeButton").removeClass("active");div.find("button.modeButton."+mode).addClass("active");div.prop("alt",Weave.lang("Mouse interaction mode set to {0}",Weave.lang(nameMapping[mode])))};return _this}_createClass(InteractionModeCluster,[{key:"setMap",value:function setMap(map){_get(InteractionModeCluster.prototype.__proto__||Object.getPrototypeOf(InteractionModeCluster.prototype),"setMap",this).call(this,map);if(!map)return;var mapTool=map.get(_IOpenLayersMapTool2.default.MAP_TOOL);this.interactionMode=mapTool.interactionMode;this.interactionMode.addGroupedCallback(mapTool,this.updateInteractionMode_weaveToControl,true)}}]);return InteractionModeCluster}(ol.control.Control);exports.default=InteractionModeCluster;

},{"openlayers":"openlayers","weaveapp/modules/jquery":63,"weaveapp/tool/oltool/IOpenLayersMapTool":93}],95:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _TileLayer=require("weaveapp/tool/oltool/layer/TileLayer");var _TileLayer2=_interopRequireDefault(_TileLayer);var _GeometryLayer=require("weaveapp/tool/oltool/layer/GeometryLayer");var _GeometryLayer2=_interopRequireDefault(_GeometryLayer);var _LabelLayer=require("weaveapp/tool/oltool/layer/LabelLayer");var _LabelLayer2=_interopRequireDefault(_LabelLayer);var _ScatterPlotLayer=require("weaveapp/tool/oltool/layer/ScatterPlotLayer");var _ScatterPlotLayer2=_interopRequireDefault(_ScatterPlotLayer);var _ImageGlyphLayer=require("weaveapp/tool/oltool/layer/ImageGlyphLayer");var _ImageGlyphLayer2=_interopRequireDefault(_ImageGlyphLayer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Checkbox=weavejs.ui.Checkbox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var Button=weavejs.ui.Button;var MenuButton=weavejs.ui.menu.MenuButton;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var LayerManager=function(_React$Component){_inherits(LayerManager,_React$Component);function LayerManager(props){_classCallCheck(this,LayerManager);var _this=_possibleConstructorReturn(this,(LayerManager.__proto__||Object.getPrototypeOf(LayerManager)).call(this,props));_this.onEditLayerClick=function(layer){if(_this.props.pushCrumb){_this.props.pushCrumb(Weave.lang("{0} layer",_this.props.layers.getName(layer)),layer.renderEditor,null)}else{_this.setState({selectedLayer:layer,openedLayer:layer})}};_this.generateItem=function(layer,index){return React.createElement(HBox,{key:"layerItem"+index,style:{alignItems:"center",padding:"4px"},className:layer==_this.state.selectedLayer?"weave-list-item-selected":"weave-list-item",onMouseDown:function onMouseDown(){if(_this.state.selectedLayer!=layer)_this.setState({selectedLayer:layer});if(_this.props.onLayerSelection)_this.props.onLayerSelection(layer)}},React.createElement(Checkbox,{title:Weave.lang("Show layer"),ref:WeaveReactUtils.linkReactStateRef(_this,{value:layer.visible}),label:layer.getDescription()}),React.createElement("span",{style:{flex:1}}),React.createElement("button",{className:"ui button",title:Weave.lang("Edit layer"),style:{alignSelf:"flex-end",whiteSpace:"nowrap"},onClick:_this.onEditLayerClick.bind(_this,layer)},React.createElement("i",{className:"fa fa-angle-right","aria-hidden":"true",style:{fontWeight:"bold"}})))};_this.moveSelectedUp=function(){var names=_this.props.layers.getNames();var _ref=[names[_this.selectionIndex+1],names[_this.selectionIndex]];names[_this.selectionIndex]=_ref[0];names[_this.selectionIndex+1]=_ref[1];_this.props.layers.setNameOrder(names)};_this.moveSelectedDown=function(){var names=_this.props.layers.getNames();var _ref2=[names[_this.selectionIndex-1],names[_this.selectionIndex]];names[_this.selectionIndex]=_ref2[0];names[_this.selectionIndex-1]=_ref2[1];_this.props.layers.setNameOrder(names)};_this.removeSelected=function(){var selectedName=_this.props.layers.getName(_this.state.selectedLayer);_this.props.layers.removeObject(selectedName)};if(props.layers){props.layers.childListCallbacks.addGroupedCallback(_this,_this.forceUpdate)}_this.state={selectedLayer:_this.props.selectedLayer?_this.props.selectedLayer:null,openedLayer:null};return _this}_createClass(LayerManager,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.layers!=nextProps.layers){this.props.layers.childListCallbacks.removeCallback(this,this.forceUpdate);nextProps.layers.childListCallbacks.addGroupedCallback(this,this.forceUpdate)}if(this.props.selectedLayer!=nextProps.selectedLayer){this.setState({selectedLayer:nextProps.selectedLayer})}}},{key:"render",value:function render(){var _this2=this;var flex1={flex:1};if(!this.state.openedLayer){var layerTypes=[_TileLayer2.default,_GeometryLayer2.default,_LabelLayer2.default,_ScatterPlotLayer2.default,_ImageGlyphLayer2.default];return React.createElement(VBox,{padded:true,overflow:true,style:{minHeight:200,flex:1}},React.createElement(HBox,null,React.createElement(MenuButton,{className:"ui icon button",showIcon:false,style:{flex:1,alignItems:"center",justifyContent:"center",borderBottomRightRadius:0,borderTopRightRadius:0},menu:layerTypes.map(function(layerClass){return{label:_weavejs.WeaveAPI.ClassRegistry.getDisplayName(layerClass),click:function click(){var oldNames=_this2.props.layers.getNames();var newLayer=_this2.props.layers.requestObject("",layerClass);if(layerClass===_TileLayer2.default){_this2.props.layers.setNameOrder(oldNames)}_this2.setState({selectedLayer:newLayer});_this2.onEditLayerClick(newLayer)}}})},React.createElement("i",{className:"fa fa-plus fa-fw"})),React.createElement(Button,{style:{flex:1,borderRadius:0},disabled:!this.state.selectedLayer,onClick:this.removeSelected},React.createElement("i",{className:"fa fa-minus fa-fw"})),React.createElement(Button,{style:{flex:1,borderRadius:0},disabled:!(this.state.selectedLayer&&this.selectionIndex>0),onClick:this.moveSelectedDown}," ",React.createElement("i",{className:"fa fa-arrow-down fa-fw"})),React.createElement(Button,{style:{flex:1,borderBottomLeftRadius:0,borderTopLeftRadius:0},disabled:!(this.state.selectedLayer&&this.selectionIndex<this.props.layers.getObjects().length-1),onClick:this.moveSelectedUp},React.createElement("i",{className:"fa fa-arrow-up fa-fw"}))),React.createElement("div",{style:{flex:1,overflow:"auto",border:"1px solid lightgrey"}},this.props.layers.getObjects().reverse().map(this.generateItem)))}else{return React.createElement(VBox,{style:{flex:1}},React.createElement(HBox,null,React.createElement(Button,{onClick:function onClick(){return _this2.setState({selectedLayer:_this2.state.selectedLayer,openedLayer:null})}}," < "),Weave.lang("Layer: {0}",this.props.layers.getName(this.state.openedLayer))),this.state.selectedLayer.renderEditor())}}},{key:"selectionIndex",get:function get(){return this.props.layers.getObjects().indexOf(this.state.selectedLayer)}}]);return LayerManager}(React.Component);exports.default=LayerManager;

},{"react":"react","weaveapp/tool/oltool/layer/GeometryLayer":104,"weaveapp/tool/oltool/layer/ImageGlyphLayer":106,"weaveapp/tool/oltool/layer/LabelLayer":107,"weaveapp/tool/oltool/layer/ScatterPlotLayer":108,"weaveapp/tool/oltool/layer/TileLayer":109,"weavejs":136}],96:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _proj=require("weaveapp/modules/proj4");var _proj2=_interopRequireDefault(_proj);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _AbstractVisTool=require("weaveapp/tool/AbstractVisTool");var _AbstractVisTool2=_interopRequireDefault(_AbstractVisTool);var _GeometryLayer=require("weaveapp/tool/oltool/layer/GeometryLayer");var _GeometryLayer2=_interopRequireDefault(_GeometryLayer);var _TileLayer=require("weaveapp/tool/oltool/layer/TileLayer");var _TileLayer2=_interopRequireDefault(_TileLayer);var _ImageGlyphLayer=require("weaveapp/tool/oltool/layer/ImageGlyphLayer");var _ImageGlyphLayer2=_interopRequireDefault(_ImageGlyphLayer);var _ScatterPlotLayer=require("weaveapp/tool/oltool/layer/ScatterPlotLayer");var _ScatterPlotLayer2=_interopRequireDefault(_ScatterPlotLayer);var _LabelLayer=require("weaveapp/tool/oltool/layer/LabelLayer");var _LabelLayer2=_interopRequireDefault(_LabelLayer);var _IOpenLayersMapTool=require("weaveapp/tool/oltool/IOpenLayersMapTool");var _IOpenLayersMapTool2=_interopRequireDefault(_IOpenLayersMapTool);var _AbstractLayer=require("weaveapp/tool/oltool/layer/AbstractLayer");var _AbstractLayer2=_interopRequireDefault(_AbstractLayer);var _CustomZoomToExtent=require("weaveapp/tool/oltool/CustomZoomToExtent");var _CustomZoomToExtent2=_interopRequireDefault(_CustomZoomToExtent);var _InteractionModeCluster=require("weaveapp/tool/oltool/InteractionModeCluster");var _InteractionModeCluster2=_interopRequireDefault(_InteractionModeCluster);var _DragSelection=require("weaveapp/tool/oltool/DragSelection");var _DragSelection2=_interopRequireDefault(_DragSelection);var _CustomDragZoom=require("weaveapp/tool/oltool/CustomDragZoom");var _CustomDragZoom2=_interopRequireDefault(_CustomDragZoom);var _CustomView=require("weaveapp/tool/oltool/CustomView");var _CustomView2=_interopRequireDefault(_CustomView);var _AbstractFeatureLayer=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");var _AbstractFeatureLayer2=_interopRequireDefault(_AbstractFeatureLayer);var _LayerManager=require("weaveapp/tool/oltool/LayerManager");var _LayerManager2=_interopRequireDefault(_LayerManager);var _ProbeInteraction=require("weaveapp/tool/oltool/ProbeInteraction");var _ProbeInteraction2=_interopRequireDefault(_ProbeInteraction);var _Projections=require("weaveapp/tool/oltool/Projections");var _Projections2=_interopRequireDefault(_Projections);var _PrintUtils=require("weaveapp/util/PrintUtils");var _PrintUtils2=_interopRequireDefault(_PrintUtils);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);var _IAltText=require("weaveapp/api/ui/IAltText");var _IAltText2=_interopRequireDefault(_IAltText);var _PanCluster=require("weaveapp/tool/oltool/PanCluster");var _PanCluster2=_interopRequireDefault(_PanCluster);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MouseUtils=weavejs.util.MouseUtils;var Menu=weavejs.ui.menu.Menu;var ResizingDiv=weavejs.ui.ResizingDiv;var MiscUtils=weavejs.util.MiscUtils;var Button=weavejs.ui.Button;var Checkbox=weavejs.ui.Checkbox;var Accordion=weavejs.ui.Accordion;var StatefulTextField=weavejs.ui.StatefulTextField;var ComboBox=weavejs.ui.ComboBox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var SmartComponent=weavejs.ui.SmartComponent;var DynamicComponent=weavejs.ui.DynamicComponent;var StatefulTextArea=weavejs.ui.StatefulTextArea;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ZoomBounds=weavejs.geom.ZoomBounds;var DynamicState=weavejs.api.core.DynamicState;var LinkableString=weavejs.core.LinkableString;var LinkableVariable=weavejs.core.LinkableVariable;var LinkableBoolean=weavejs.core.LinkableBoolean;var LinkableHashMap=weavejs.core.LinkableHashMap;var LinkableNumber=weavejs.core.LinkableNumber;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var IColumnReference=weavejs.api.data.IColumnReference;var ColumnUtils=weavejs.data.ColumnUtils;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var DataTypes=weavejs.api.data.DataTypes;var EventCallbackCollection=weavejs.core.EventCallbackCollection;var Bounds2D=weavejs.geom.Bounds2D;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ILinkableObjectWithNewPaths=weavejs.api.core.ILinkableObjectWithNewPaths;var CallbackCollection=weavejs.core.CallbackCollection;var StreamedGeometryColumn=weavejs.data.column.StreamedGeometryColumn;var ColorColumn=weavejs.data.column.ColorColumn;function isAlignment(obj){return obj&&(obj.vertical=="top"||obj.vertical=="bottom")&&(obj.horizontal=="left"||obj.horizontal=="right")}ol.proj.setProj4(_proj2.default);var SMALL="small";var MEDIUM="medium";var LARGE="large";var OpenLayersMapTool=function(_React$Component){_inherits(OpenLayersMapTool,_React$Component);function OpenLayersMapTool(props){_classCallCheck(this,OpenLayersMapTool);var _this=_possibleConstructorReturn(this,(OpenLayersMapTool.__proto__||Object.getPrototypeOf(OpenLayersMapTool)).call(this,props));_this.altText=Weave.linkableChild(_this,_IAltText.IAltTextConfig,_this.forceUpdate,true);_this.setOverrideExtent=function(){var bounds=new Bounds2D;_this.zoomBounds.getDataBounds(bounds);Weave.setState(_this.extentOverride,{xMin:bounds.xMin,xMax:bounds.xMax,yMin:bounds.yMin,yMax:bounds.yMax})};_this.clearOverrideExtent=function(){Weave.setState(_this.extentOverride,{xMin:NaN,xMax:NaN,yMin:NaN,yMax:NaN})};_this.overrideExtentDefined=function(){var bounds=Weave.getState(_this.extentOverride);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(bounds)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;var value=bounds[key];if(isNaN(value))return false}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return true};_this.zoomBounds=Weave.linkableChild(_this,ZoomBounds);_this.extentOverride=Weave.linkableChild(_this,_AbstractVisTool.OverrideBounds);_this.projectionSRS=Weave.linkableChild(_this,new LinkableString("EPSG:3857",_Projections2.default.projectionVerifier));_this.interactionMode=Weave.linkableChild(_this,LinkableString);_this.enableMouseWheel=Weave.linkableChild(_this,new LinkableBoolean(true));_this.layers=Weave.linkableChild(_this,new LinkableHashMap(_AbstractLayer2.default));_this.panelTitle=Weave.linkableChild(_this,LinkableString);_this.snapZoomToBaseMap=Weave.linkableChild(_this,new LinkableBoolean(true));_this.maxZoomLevel=Weave.linkableChild(_this,new LinkableNumber(18));_this.minZoomLevel=Weave.linkableChild(_this,new LinkableNumber(0));_this.zoomExtent=new _CustomZoomToExtent2.default({label:(0,_jquery2.default)("<span>").addClass("fa fa-arrows-alt").css({"font-weight":"normal"})[0]});_this.zoomButtons=new ol.control.Zoom({zoomInTipLabel:Weave.lang("Zoom In"),zoomOutTipLabel:Weave.lang("Zoom Out"),zoomInLabel:(0,_jquery2.default)("<span>").addClass("fa fa-plus")[0],zoomOutLabel:(0,_jquery2.default)("<span>").addClass("fa fa-minus")[0]});_this.zoomSlider=new ol.control.ZoomSlider;_this.panButtons=new _PanCluster2.default;_this.mouseModeButtons=new _InteractionModeCluster2.default({});_this.showZoomButtons=Weave.linkableChild(_this,new LinkableBoolean(true));_this.showZoomSlider=Weave.linkableChild(_this,LinkableBoolean);_this.showPanButtons=Weave.linkableChild(_this,new LinkableBoolean(false));_this.showZoomExtentButton=Weave.linkableChild(_this,new LinkableBoolean(true));_this.showMouseModeControls=Weave.linkableChild(_this,new LinkableBoolean(true));_this.toolPadding=Weave.linkableChild(_this,new LinkableNumber(10));_this.controlLocation=Weave.linkableChild(_this,new LinkableVariable(null,isAlignment,{vertical:"top",horizontal:"left"}));_this.events=Weave.linkableChild(_this,new EventCallbackCollection);_this._stopEventPropagation=false;_this.handleGenericEvent=function(event){var eventData={map:_this,mapEvent:event,type:event.type,key:null,layer:null};if(event.pixel){var olFeature=void 0;var olLayer=void 0;event.map.forEachFeatureAtPixel(event.pixel,function(f,l){var _ref;return _ref=[f,l],olFeature=_ref[0],olLayer=_ref[1],_ref});if(olFeature&&olLayer){eventData.key=olFeature.getId();eventData.layer=olLayer.get("layerObject")}}_this._stopEventPropagation=false;_this.events.dispatch(eventData);return!_this._stopEventPropagation};_this.renderEditor=function(pushCrumb){return React.createElement(OpenLayersMapToolEditor,{tool:_this,pushCrumb:pushCrumb})};_GeometryLayer2.default;_TileLayer2.default;_ImageGlyphLayer2.default;_ScatterPlotLayer2.default;_LabelLayer2.default;_weavejs.WeaveAPI.Scheduler.callLater(_this,_this.initLater);return _this}_createClass(OpenLayersMapTool,[{key:"getAutomaticDescription",value:function getAutomaticDescription(){return this.title}},{key:"overrideSet",value:function overrideSet(){var state=Weave.getState(this.extentOverride);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=Object.keys(state)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var coord=_step2.value;if(!_.isFinite(state[coord]))return false}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return true}},{key:"initLater",value:function initLater(){if(this.interactionMode.triggerCounter==CallbackCollection.DEFAULT_TRIGGER_COUNT){var defaultDragMode=Weave.getWeave(this).getObject("WeaveProperties","toolInteractions","defaultDragMode");if(defaultDragMode instanceof LinkableString)this.interactionMode.value=defaultDragMode.value||"select";else this.interactionMode.value="select"}}},{key:"initSelectableAttributes",value:function initSelectableAttributes(input){this.layers.requestObject("",_TileLayer2.default);var geoColumns=input.filter(OpenLayersMapTool.isGeomColumnOrRef);var nonGeoColumns=input.filter(_.negate(OpenLayersMapTool.isGeomColumnOrRef));if(geoColumns.length){var geoColumn=geoColumns[0];var geoLayer=this.layers.requestObject("",_GeometryLayer2.default);if(geoLayer)ColumnUtils.initSelectableAttribute(geoLayer.geometryColumn,geoColumns[0]);var selectableAttributes=geoLayer.selectableAttributes;var colorDataColumn=Weave.getWeave(this).getObject(["defaultColorDataColumn"]);if(!colorDataColumn.getInternalColumn()&&nonGeoColumns[0]){ColumnUtils.initSelectableAttribute(colorDataColumn,nonGeoColumns[0])}}}},{key:"deprecatedPathRewrite",value:function deprecatedPathRewrite(relativePath){if(OpenLayersMapTool.matchesLayerSettings(relativePath))return["layers"].concat(relativePath.slice(4))}},{key:"updateCursor",value:function updateCursor(){var modesToCursors={"select":["default"],"pan":["grabbing","-webkit-grabbing","move"],"zoom":["zoom-in"]};var interactionMode=this.interactionMode.value||"select";var cursorValues=modesToCursors[interactionMode];if(!this.map)return;var mapElement=this.map.getTargetElement();if(mapElement){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=cursorValues[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var cursor=_step3.value;(0,_jquery2.default)(mapElement).css({cursor:cursor});if((0,_jquery2.default)(mapElement).css("cursor")==cursor)return}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}},{key:"stopEventPropagation",value:function stopEventPropagation(){this._stopEventPropagation=true}},{key:"initializeMap",value:function initializeMap(){var _this2=this;Menu.registerMenuSource(this);this.map=new ol.Map({interactions:ol.interaction.defaults({dragPan:false,mouseWheelZoom:false}),controls:[],target:this.element});this.map.set(_IOpenLayersMapTool2.default.MAP_TOOL,this);var dragPan=new ol.interaction.DragPan;var dragSelect=new _DragSelection2.default;var probeInteraction=new _ProbeInteraction2.default(this);var dragZoom=new _CustomDragZoom2.default;var mouseWheelZoom=new ol.interaction.MouseWheelZoom;this.map.addInteraction(dragPan);this.map.addInteraction(dragSelect);this.map.addInteraction(probeInteraction);this.map.addInteraction(dragZoom);this.map.addInteraction(new ol.interaction.Interaction({handleEvent:this.handleGenericEvent}));this.map.addInteraction(mouseWheelZoom);this.interactionMode.addGroupedCallback(this,function(){var interactionMode=_this2.interactionMode.value||"select";dragPan.setActive(interactionMode==="pan");dragSelect.setActive(interactionMode==="select");dragZoom.setActive(interactionMode==="zoom");_this2.updateCursor()},true);this.enableMouseWheel.addGroupedCallback(this,function(){mouseWheelZoom.setActive(_this2.enableMouseWheel.value)},true);(0,_jquery2.default)(this.element).find("canvas.ol-unselectable").attr("tabIndex",1024);this.controlLocation.addGroupedCallback(this,this.updateControlPositions);var _arr=[this.showZoomSlider,this.showMouseModeControls,this.showPanButtons,this.showZoomExtentButton,this.showZoomButtons];for(var _i=0;_i<_arr.length;_i++){var lb=_arr[_i];lb.addGroupedCallback(this,this.updateControls_weaveToOl)}this.updateControls_weaveToOl();this.snapZoomToBaseMap.addGroupedCallback(this,this.updateResolutionSnapping);Weave.getCallbacks(this.extentOverride).addGroupedCallback(this,this.updateViewParameters_weaveToOl);this.maxZoomLevel.addGroupedCallback(this,this.updateViewParameters_weaveToOl);this.minZoomLevel.addGroupedCallback(this,this.updateViewParameters_weaveToOl);this.projectionSRS.addGroupedCallback(this,this.updateViewParameters_weaveToOl,true);this.layers.addGroupedCallback(this,this.requestDetail,true);this.layers.childListCallbacks.addImmediateCallback(this,this.updatePlotters_weaveToOl,true);Weave.getCallbacks(this.zoomBounds).addGroupedCallback(this,this.updateZoomAndCenter_weaveToOl,true);_weavejs.WeaveAPI.Scheduler.frameCallbacks.addImmediateCallback(this,this.handleFrame)}},{key:"updateViewParameters_weaveToOl",value:function updateViewParameters_weaveToOl(){var extent=[this.extentOverride.xMin.value,this.extentOverride.yMin.value,this.extentOverride.xMax.value,this.extentOverride.yMax.value];if(!_.every(extent,Number.isFinite))extent=undefined;var projection=_Projections2.default.getProjection(this.projectionSRS.value)||this.getDefaultProjection();var view=new _CustomView2.default({minZoom:this.minZoomLevel.value,maxZoom:this.maxZoomLevel.value,projection:projection,extent:extent});view.set("extent",extent);this.centerCallbackHandle=view.on("change:center",this.updateCenter_olToWeave,this);this.resolutionCallbackHandle=view.on("change:resolution",this.updateZoom_olToWeave,this);this.map.setView(view);this.updateResolutionSnapping();this.updateZoomAndCenter_weaveToOl();this.map.on("postrender",this.updateResolutionDependentStyles,this)}},{key:"handleFrame",value:function handleFrame(){var element=this.map.getTargetElement();var newSize=[element.offsetWidth,element.offsetHeight];if(_.isEqual(this._lastSize,newSize))return;this._lastSize=newSize;var screenBounds=new Bounds2D(0,0,newSize[0],newSize[1]);this.zoomBounds.setScreenBounds(screenBounds,true);this.map.updateSize();this.updateControlPositions()}},{key:"updateControl",value:function updateControl(lbool,control){if(lbool.value){if(!_.contains(this.map.getControls().getArray(),control))this.map.addControl(control)}else{this.map.removeControl(control)}}},{key:"updateControls_weaveToOl",value:function updateControls_weaveToOl(){this.updateControl(this.showPanButtons,this.panButtons);this.updateControl(this.showZoomButtons,this.zoomButtons);this.updateControl(this.showMouseModeControls,this.mouseModeButtons);this.updateControl(this.showZoomSlider,this.zoomSlider);this.updateControl(this.showZoomExtentButton,this.zoomExtent);this.updateControlPositions()}},{key:"updateControlPositions",value:function updateControlPositions(){var controls=_.sortBy(this.map.getControls().getArray(),function(item){return OpenLayersMapTool.controlIndex.get(item.constructor)});var maxWidth=0;if(controls.length>0){maxWidth=_.max(controls,function(control){return control.element.scrollWidth}).element.scrollWidth}var mapWidth=this.map.getSize()[0];var mapHeight=this.map.getSize()[1];var padding=5;var controlLocation=this.controlLocation.state;var verticalDirection=void 0,verticalStart=void 0,verticalOffsetMultiplier=void 0;var horizontalDirection=void 0,horizontalStart=void 0,horizontalOffsetMultiplier=void 0;var _ref2=controlLocation.vertical=="top"?[+1,0,0]:[-1,+1,mapHeight];var _ref3=_slicedToArray(_ref2,3);verticalDirection=_ref3[0];verticalOffsetMultiplier=_ref3[1];verticalStart=_ref3[2];var _ref4=controlLocation.horizontal=="left"?[+1,0,0]:[-1,+1,mapWidth];var _ref5=_slicedToArray(_ref4,3);horizontalDirection=_ref5[0];horizontalOffsetMultiplier=_ref5[1];horizontalStart=_ref5[2];if(controlLocation.vertical=="bottom")controls.reverse();var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=controls[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var control=_step4.value;var height=control.element.scrollHeight;var width=control.element.scrollWidth;var centerOffset=(maxWidth-width)/2;(0,_jquery2.default)(control.element).css({top:verticalDirection*height*verticalOffsetMultiplier+verticalStart+padding*verticalDirection});(0,_jquery2.default)(control.element).css({left:horizontalDirection*width*horizontalOffsetMultiplier+horizontalStart+(centerOffset+padding)*horizontalDirection});verticalStart+=verticalDirection*(height+padding)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"updateCenter_olToWeave",value:function updateCenter_olToWeave(){var _map$getView$getCente=this.map.getView().getCenter(),_map$getView$getCente2=_slicedToArray(_map$getView$getCente,2),xCenter=_map$getView$getCente2[0],yCenter=_map$getView$getCente2[1];var dataBounds=new Bounds2D;this.zoomBounds.getDataBounds(dataBounds);dataBounds.setXCenter(xCenter);dataBounds.setYCenter(yCenter);this.zoomBounds.setDataBounds(dataBounds)}},{key:"updateResolutionDependentStyles",value:function updateResolutionDependentStyles(event){if(event.frameState&&event.frameState.animate)return;this.map.un("postrender",this.updateResolutionDependentStyles,this);var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=this.layers.getObjects(_AbstractFeatureLayer2.default)[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var layer=_step5.value;if(layer&&layer.styleResolutionDependent){layer.updateStyleData()}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}},{key:"updateZoom_olToWeave",value:function updateZoom_olToWeave(){var view=this.map.getView();var resolution=view.getResolution();var dataBounds=new Bounds2D;var screenBounds=new Bounds2D;this.zoomBounds.getDataBounds(dataBounds);this.zoomBounds.getScreenBounds(screenBounds);dataBounds.setWidth(screenBounds.getWidth()*resolution);dataBounds.setHeight(screenBounds.getHeight()*resolution);dataBounds.makeSizePositive();this.zoomBounds.setDataBounds(dataBounds);this.map.on("postrender",this.updateResolutionDependentStyles,this)}},{key:"updateZoomAndCenter_weaveToOl",value:function updateZoomAndCenter_weaveToOl(){var _this3=this;var dataBounds=new Bounds2D;this.zoomBounds.getDataBounds(dataBounds);if(dataBounds.isEmpty()){var proj=_Projections2.default.getProjection(this.projectionSRS.value);if(proj){dataBounds.setCoords(_Projections2.default.getEstimatedExtent(proj));this.zoomBounds.setDataBounds(dataBounds);return}}var center=[dataBounds.getXCenter(),dataBounds.getYCenter()];var scale=this.zoomBounds.getXScale()||1;var view=this.map.getView();view.un("change:center",this.updateCenter_olToWeave,this);view.un("change:resolution",this.updateZoom_olToWeave,this);view.setCenter(center);var resolution=1/scale;if(!MouseUtils.forComponent(this).mouseButtonDown)resolution=view.constrainResolution(resolution);view.setResolution(resolution);_.defer(function(){view.on("change:center",_this3.updateCenter_olToWeave,_this3);view.on("change:resolution",_this3.updateZoom_olToWeave,_this3)});this.map.on("postrender",this.updateResolutionDependentStyles,this)}},{key:"getDefaultProjection",value:function getDefaultProjection(){var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.layers.getNames()[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var layerName=_step6.value;var layer=this.layers.getObject(layerName);if(layer instanceof _TileLayer2.default)return"EPSG:3857"}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}return _Projections2.default.DEFAULT_PROJECTION}},{key:"requestDetail",value:function requestDetail(){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this.layers.getNames()[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var name=_step7.value;var layer=this.layers.getObject(name);if(!(layer instanceof _AbstractFeatureLayer2.default))continue;var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=Weave.getDescendants(this.layers.getObject(name),StreamedGeometryColumn)[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var sgc=_step8.value;if(layer.inputProjection==layer.outputProjection){StreamedGeometryColumn.metadataRequestMode="xyz";sgc.requestGeometryDetailForZoomBounds(this.zoomBounds)}else{StreamedGeometryColumn.metadataRequestMode="all";sgc.requestGeometryDetail(sgc.collectiveBounds,0)}}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return()}}finally{if(_didIteratorError8){throw _iteratorError8}}}}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally{if(_didIteratorError7){throw _iteratorError7}}}}},{key:"updateResolutionSnapping",value:function updateResolutionSnapping(){var view=this.map.getView();if(!view)return;if(this.layers.getObjects(_TileLayer2.default).length&&this.snapZoomToBaseMap.value)view.enableResolutionConstraint=true;else view.enableResolutionConstraint=false}},{key:"updatePlotters_weaveToOl",value:function updatePlotters_weaveToOl(){var newNames=this.layers.getNames();for(var idx in newNames){var layer=this.layers.getObject(newNames[idx]);layer.parent=this;if(!layer||!layer.olLayer)continue;layer.olLayer.setZIndex(Number(idx)+2)}this.updateResolutionSnapping();this.projectionSRS.triggerCallbacks()}},{key:"hasNonEmptySelection",value:function hasNonEmptySelection(){var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=this.layers.getObjects(_AbstractFeatureLayer2.default)[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var layer=_step9.value;if(layer.selectionKeySet&&layer.selectionKeySet.keys.length)return true}}catch(err){_didIteratorError9=true;_iteratorError9=err}finally{try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return()}}finally{if(_didIteratorError9){throw _iteratorError9}}}return false}},{key:"getMenuItems",value:function getMenuItems(){var _this4=this;var menuItems=[];if(this.hasNonEmptySelection()){menuItems.push({label:Weave.lang("Zoom to selected records"),click:function click(){return _this4.zoomToSelection()}})}var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=this.layers.getObjects(_AbstractFeatureLayer2.default)[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var layer=_step10.value;if(layer instanceof _AbstractFeatureLayer2.default&&layer.visible.value&&layer.selectable.value){menuItems=menuItems.concat(_AbstractVisTool2.default.getMenuItems(layer));break}}}catch(err){_didIteratorError10=true;_iteratorError10=err}finally{try{if(!_iteratorNormalCompletion10&&_iterator10.return){_iterator10.return()}}finally{if(_didIteratorError10){throw _iteratorError10}}}if(Weave.beta)menuItems.push({label:Weave.lang("Print Tool (Beta)"),click:_PrintUtils2.default.printCanvasTool.bind(null,this.element)});return menuItems}},{key:"getExtent",value:function getExtent(){var bounds=new Bounds2D;var viewExtent=this.map.getView().get("extent");if(viewExtent){bounds.setCoords(viewExtent)}else{var layers=this.layers.getObjects();var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=layers[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var layer=_step11.value;if(layer.visible.value&&(layer instanceof _AbstractFeatureLayer2.default||layers.length==1))bounds.includeBounds(layer.getExtent())}}catch(err){_didIteratorError11=true;_iteratorError11=err}finally{try{if(!_iteratorNormalCompletion11&&_iterator11.return){_iterator11.return()}}finally{if(_didIteratorError11){throw _iteratorError11}}}}return bounds}},{key:"zoomToSelection",value:function zoomToSelection(){var inputKeys=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var zoomMarginPercent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0.2;var setOfKeys=new Set;var keyBounds=new Bounds2D;var tmpBounds=new Bounds2D;var useProbe=false;var extent=[NaN,NaN,NaN,NaN];var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=this.layers.getObjects(_AbstractFeatureLayer2.default)[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var layer=_step12.value;var keys=inputKeys;if(!keys)keys=layer.selectionKeySet?layer.selectionKeySet.keys:[];var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=keys[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var key=_step13.value;var feature=layer.source.getFeatureById(key);if(!feature)continue;var geometry=feature.getGeometry();if(!geometry)continue;geometry.getExtent(extent);tmpBounds.setCoords(extent);keyBounds.includeBounds(tmpBounds)}}catch(err){_didIteratorError13=true;_iteratorError13=err}finally{try{if(!_iteratorNormalCompletion13&&_iterator13.return){_iterator13.return()}}finally{if(_didIteratorError13){throw _iteratorError13}}}}}catch(err){_didIteratorError12=true;_iteratorError12=err}finally{try{if(!_iteratorNormalCompletion12&&_iterator12.return){_iterator12.return()}}finally{if(_didIteratorError12){throw _iteratorError12}}}var scale=1/(1-zoomMarginPercent);keyBounds.setWidth(keyBounds.getWidth()*scale);keyBounds.setHeight(keyBounds.getHeight()*scale);if(!keyBounds.isEmpty()){this.map.getView().fit(keyBounds.getCoords(),this.map.getSize())}else{this.map.getView().setCenter([keyBounds.getXCenter(),keyBounds.getYCenter()])}}},{key:"componentDidMount",value:function componentDidMount(){MouseUtils.echoWindowEventsToOpener(ReactDOM.findDOMNode(this));if(!_Projections2.default.projectionDbReadyOrFailed){console.log("Projection database not ready; delaying initialization of map");_weavejs.WeaveAPI.Scheduler.callLater(this,this.componentDidMount);return}this.initializeMap()}},{key:"render",value:function render(){var _this5=this;return React.createElement(ResizingDiv,null,React.createElement("div",{role:"img","aria-label":this.altText.text.value||this.getAutomaticDescription(),ref:function ref(c){_this5.element=c},style:{height:"100%",width:"100%"}}))}},{key:"title",get:function get(){return MiscUtils.evalTemplateString(this.panelTitle.value,this)||this.defaultPanelTitle}},{key:"deprecatedStateMapping",get:function get(){var _this6=this;return{zoomControlsLocation:function zoomControlsLocation(zcl){var vertical=void 0;var horizontal=void 0;if(zcl.startsWith("Bottom")){vertical="bottom"}else{vertical="top"}if(zcl.endsWith("right")){horizontal="right"}else{horizontal="left"}_this6.controlLocation.state={vertical:vertical,horizontal:horizontal}},zoomToBaseMap:this.snapZoomToBaseMap,showZoomControls:this.showZoomSlider,children:{visualization:{plotManager:[{zoomBounds:this.zoomBounds,overrideXMin:this.extentOverride.xMin,overrideYMin:this.extentOverride.yMin,overrideXMax:this.extentOverride.xMax,overrideYMax:this.extentOverride.yMax,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,plotters:this.layers},{layerSettings:function layerSettings(_layerSettings,removeMissingDynamicObjects){Weave.setState(_this6.layers,DynamicState.removeTypeFromState(_layerSettings,false),removeMissingDynamicObjects)}}]}}}}},{key:"defaultPanelTitle",get:function get(){var columns=Weave.getDescendants(this,ColorColumn);if(!columns.length){return Weave.lang("Map")}return Weave.lang("Map of {0}",ColumnUtils.getTitle(columns[0]))}}],[{key:"isGeomColumnOrRef",value:function isGeomColumnOrRef(column){var iac=Weave.AS(column,IAttributeColumn);var icr=Weave.AS(column,IColumnReference);var dataType=void 0;if(iac){dataType=iac.getMetadata(ColumnMetadata.DATA_TYPE);if(dataType==DataTypes.GEOMETRY){return true}}else if(icr){var metadata=icr.getColumnMetadata();if(metadata){dataType=metadata[ColumnMetadata.DATA_TYPE]}if(dataType==DataTypes.GEOMETRY){return true}}return false}}]);return OpenLayersMapTool}(React.Component);exports.default=OpenLayersMapTool;OpenLayersMapTool.WEAVE_INFO=Weave.setClassInfo(OpenLayersMapTool,{id:"weavejs.tool.oltool.OpenLayersMapTool",label:"Map",interfaces:[_IVisTool2.default,_IOpenLayersMapTool2.default,ILinkableObjectWithNewProperties,ILinkableObjectWithNewPaths,_IAltText2.default],deprecatedIds:["weavejs.tool.Map","weave.visualization.tools::MapTool"]});OpenLayersMapTool.controlIndex=new Map().set(_PanCluster2.default,0).set(_CustomZoomToExtent2.default,1).set(ol.control.Zoom,2).set(ol.control.ZoomSlider,3).set(_InteractionModeCluster2.default,4);OpenLayersMapTool.matchesLayerSettings=_.matches(["children","visualization","plotManager","layerSettings"]);var OpenLayersMapToolEditor=function(_SmartComponent){_inherits(OpenLayersMapToolEditor,_SmartComponent);function OpenLayersMapToolEditor(){_classCallCheck(this,OpenLayersMapToolEditor);var _this7=_possibleConstructorReturn(this,(OpenLayersMapToolEditor.__proto__||Object.getPrototypeOf(OpenLayersMapToolEditor)).apply(this,arguments));_this7.updateSelectedLayer=function(layer){_this7.setState({selectedLayer:layer})};return _this7}_createClass(OpenLayersMapToolEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){var displayName=_weavejs.WeaveAPI.ClassRegistry.getDisplayName(this.props.tool.constructor);this.props.pushCrumb(displayName,null,this.state)}},{key:"render",value:function render(){var _this8=this;var controlLocationOpts=[{vertical:"top",horizontal:"left"},{vertical:"top",horizontal:"right"},{vertical:"bottom",horizontal:"left"},{vertical:"bottom",horizontal:"right"}].map(function(value){return{label:Weave.lang(_.startCase(value.vertical)+" "+_.startCase(value.horizontal)),value:value}});var renderNumberEditor=function renderNumberEditor(linkableNumber,flex){var style={textAlign:"center",flex:flex,minWidth:60};return React.createElement(StatefulTextField,{type:"number",style:style,ref:WeaveReactUtils.linkReactStateRef(_this8,{value:linkableNumber})})};return Accordion.render([Weave.lang("Layers"),React.createElement(_LayerManager2.default,{layers:this.props.tool.layers,pushCrumb:this.props.pushCrumb,selectedLayer:this.state.selectedLayer,onLayerSelection:this.updateSelectedLayer})],[Weave.lang("Display"),[[Weave.lang("Chart title"),React.createElement(HBox,null,React.createElement(StatefulTextField,{style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.panelTitle}),placeholder:this.props.tool.defaultPanelTitle}))],[Weave.lang("Projection SRS"),React.createElement(HBox,null,React.createElement(StatefulTextField,{spellCheck:false,style:{width:"100%"},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.projectionSRS})}))]]],[Weave.lang("Controls"),[[Weave.lang("Control location"),React.createElement(ComboBox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.controlLocation}),options:controlLocationOpts})],[Weave.lang("Show zoom to extent button"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.showZoomExtentButton}),label:" "})],[Weave.lang("Show zoom buttons"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.showZoomButtons}),label:" "})],[Weave.lang("Show zoom slider"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.showZoomSlider}),label:" "})],[Weave.lang("Show mouse mode selector"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.showMouseModeControls}),label:" "})]]],[Weave.lang("Zoom and pan behavior"),[[Weave.lang("Enable Mousewheel Zoom"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.enableMouseWheel}),label:" "})],[Weave.lang("Zoom range"),React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},React.createElement(StatefulTextField,{style:{flex:1},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.minZoomLevel})}),"-",React.createElement(StatefulTextField,{style:{flex:1},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.maxZoomLevel})}))],[React.createElement("span",{style:{whiteSpace:"normal"}}," ",Weave.lang("Pan Boundary")),React.createElement(VBox,null,React.createElement("span",{style:{display:this.props.tool.overrideExtentDefined()?null:"none"}},React.createElement(HBox,{className:"weave-padded-hbox",style:{alignItems:"center"}},renderNumberEditor(this.props.tool.extentOverride.xMin,1),React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1}},renderNumberEditor(this.props.tool.extentOverride.yMax,null),renderNumberEditor(this.props.tool.extentOverride.yMin,null)),renderNumberEditor(this.props.tool.extentOverride.yMin,1))),React.createElement(HBox,null,React.createElement(Button,{onClick:this.props.tool.setOverrideExtent,style:{borderTopRightRadius:0,borderBottomRightRadius:0}},Weave.lang("Use current zoom")),React.createElement(Button,{onClick:this.props.tool.clearOverrideExtent,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0}},Weave.lang("Use data bounds"))))],[Weave.lang("Snap zoom to base map"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.snapZoomToBaseMap}),label:" ",title:Weave.lang("Constrain zoom to match tile resolution and avoid 'blurry' appearance.")})]]],[Weave.lang("Accessibility"),[[Weave.lang("Alt Text"),React.createElement(DynamicComponent,{dependencies:[this.props.tool.altText],render:function render(){return React.createElement(StatefulTextArea,{ref:WeaveReactUtils.linkReactStateRef(_this8,{value:_this8.props.tool.altText.text}),placeholder:Weave.lang("Enter a text description for the chart")})}})],[Weave.lang("Show as caption"),React.createElement(Checkbox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.tool.altText.showAsCaption}),label:" "})]]])}}]);return OpenLayersMapToolEditor}(SmartComponent);

},{"lodash":"lodash","openlayers":"openlayers","react":"react","react-dom":"react-dom","weaveapp/api/ui/IAltText":10,"weaveapp/api/ui/IVisTool":11,"weaveapp/modules/jquery":63,"weaveapp/modules/proj4":65,"weaveapp/tool/AbstractVisTool":70,"weaveapp/tool/oltool/CustomDragZoom":89,"weaveapp/tool/oltool/CustomView":90,"weaveapp/tool/oltool/CustomZoomToExtent":91,"weaveapp/tool/oltool/DragSelection":92,"weaveapp/tool/oltool/IOpenLayersMapTool":93,"weaveapp/tool/oltool/InteractionModeCluster":94,"weaveapp/tool/oltool/LayerManager":95,"weaveapp/tool/oltool/PanCluster":97,"weaveapp/tool/oltool/ProbeInteraction":98,"weaveapp/tool/oltool/Projections":99,"weaveapp/tool/oltool/layer/AbstractFeatureLayer":100,"weaveapp/tool/oltool/layer/AbstractLayer":102,"weaveapp/tool/oltool/layer/GeometryLayer":104,"weaveapp/tool/oltool/layer/ImageGlyphLayer":106,"weaveapp/tool/oltool/layer/LabelLayer":107,"weaveapp/tool/oltool/layer/ScatterPlotLayer":108,"weaveapp/tool/oltool/layer/TileLayer":109,"weaveapp/util/PrintUtils":134,"weavejs":136}],97:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PanCluster=function(_ol$control$Control){_inherits(PanCluster,_ol$control$Control);function PanCluster(optOptions){_classCallCheck(this,PanCluster);var options=optOptions||{};var parent=(0,_jquery2.default)("\n\t\t<div style=\"background-color: rgba(0,0,0,0)\" class=\"ol-unselectable ol-control panCluster\">\n\t\t\t<table style=\"font-size:75%\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td></td><td class=\"ol-control\" style=\"position:relative\"><button class=\"panCluster N\">N</button></td><td></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\"ol-control\" style=\"position:relative\"><button class=\"panCluster W\">W</button></td>\n\t\t\t\t\t<td class=\"ol-control\" style=\"position:relative\"><button class=\"panCluster X fa fa-arrows-alt\"></button></td>\n\t\t\t\t\t<td class=\"ol-control\" style=\"position:relative\"><button class=\"panCluster E\">E</button></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td></td><td class=\"ol-control\" style=\"position:relative\"><button class=\"panCluster S\">S</button></td><td></td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>");var directions={N:[0,1],E:[1,0],S:[0,-1],W:[-1,0],X:[null,null]};var _this=_possibleConstructorReturn(this,(PanCluster.__proto__||Object.getPrototypeOf(PanCluster)).call(this,{element:parent[0],target:options.target}));var self=_this;var pan=function pan(xSign,ySign){var panPercent=0.3;var map=self.getMap();var view=map.getView();var extent=view.calculateExtent(map.getSize());var extentWidth=Math.abs(extent[0]-extent[2]);var extentHeight=Math.abs(extent[1]-extent[3]);var center=view.getCenter();center[0]+=extentWidth*xSign*panPercent;center[1]+=extentHeight*ySign*panPercent;view.setCenter(center)};var zoomExtent=function zoomExtent(){var map=self.getMap();var view=map.getView();var extent=view.get("extent")||view.getProjection().getExtent();var size=map.getSize();view.fit(extent,size)};for(var direction in directions){var xSign=directions[direction][0];var ySign=directions[direction][1];var button=parent.find(".panCluster."+direction);if(xSign!==null){button.click(pan.bind(_this,xSign,ySign))}else{button.click(zoomExtent.bind(_this))}}return _this}return PanCluster}(ol.control.Control);exports.default=PanCluster;

},{"openlayers":"openlayers","weaveapp/modules/jquery":63}],98:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _AbstractFeatureLayer=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ToolTip=weavejs.ui.ToolTip;var ReactUtils=weavejs.util.ReactUtils;var ProbeInteraction=function(_ol$interaction$Point){_inherits(ProbeInteraction,_ol$interaction$Point);function ProbeInteraction(tool){_classCallCheck(this,ProbeInteraction);var _this=_possibleConstructorReturn(this,(ProbeInteraction.__proto__||Object.getPrototypeOf(ProbeInteraction)).call(this,{handleMoveEvent:ProbeInteraction.prototype.handleMoveEvent}));_this.tool=tool;_this.toolTip=ReactUtils.openPopup(tool,React.createElement(ToolTip));ReactUtils.onUnmount(_this.tool,function(){return ReactUtils.closePopup(_this.toolTip)});return _this}_createClass(ProbeInteraction,[{key:"setMap",value:function setMap(map){_get(ProbeInteraction.prototype.__proto__||Object.getPrototypeOf(ProbeInteraction.prototype),"setMap",this).call(this,map);var element=map.getTargetElement();map.getTargetElement().addEventListener("mouseout",this.handleOutEvent.bind(this))}},{key:"onFeatureAtPixel",value:function onFeatureAtPixel(feature,layer){var zIndex=layer.getZIndex();if(zIndex>this.topZIndex){var weaveLayerObject=layer.get("layerObject");if(!weaveLayerObject)return;this.topKeySet=weaveLayerObject.probeKeySet||this.topKeySet;this.topZIndex=zIndex;this.topKey=feature.getId();this.topLayer=weaveLayerObject}}},{key:"pixelToKey",value:function pixelToKey(pixel){var map=this.getMap();this.topKeySet=null;this.topZIndex=-Infinity;this.topLayer=null;this.topKey=null;map.forEachFeatureAtPixel(pixel,this.onFeatureAtPixel,this,_AbstractFeatureLayer.AbstractFeatureLayer.selectableLayerFilter);if(this.topKey&&this.topKeySet){this.topKeySet.replaceKeys([this.topKey])}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=map.getLayers().getArray()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var layer=_step.value;if(!_AbstractFeatureLayer.AbstractFeatureLayer.selectableLayerFilter(layer))continue;var weaveLayerObject=layer.get("layerObject");var keySet=weaveLayerObject.probeKeySet;if(keySet&&keySet!=this.topKeySet){keySet.clearKeys()}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this.topKey}},{key:"handleMoveEvent",value:function handleMoveEvent(event){var key=this.pixelToKey(event.pixel);if(key){var browserEvent=event.originalEvent;this.toolTip.show(this.tool,browserEvent,[key],this.topLayer.getToolTipColumns())}else{this.toolTip.hide()}}},{key:"handleOutEvent",value:function handleOutEvent(event){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.getMap().getLayers().getArray()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var layer=_step2.value;if(!_AbstractFeatureLayer.AbstractFeatureLayer.selectableLayerFilter(layer))continue;var weaveLayerObject=layer.get("layerObject");var keySet=weaveLayerObject.probeKeySet;if(keySet)keySet.clearKeys()}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.toolTip.hide()}}]);return ProbeInteraction}(ol.interaction.Pointer);exports.default=ProbeInteraction;

},{"openlayers":"openlayers","react":"react","weaveapp/tool/oltool/layer/AbstractFeatureLayer":100,"weavejs":136}],99:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _jszip=require("weaveapp/modules/jszip");var _jszip2=_interopRequireDefault(_jszip);var _proj=require("weaveapp/modules/proj4");var _proj2=_interopRequireDefault(_proj);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var URLRequest=weavejs.net.URLRequest;var Bounds2D=weavejs.geom.Bounds2D;var Projections=function(){function Projections(){_classCallCheck(this,Projections)}_createClass(Projections,null,[{key:"getProjection",value:function getProjection(projectionName){var proj=ol.proj.get(projectionName);if(!proj){var error=Projections.projectionDbPromise.getError();var result=Projections.projectionDbPromise.getResult();if(!error&&!result)console.error("ProjDatabase.zip not ready by the time it was needed.");if(error)console.error("Failed to retrieve ProjDatabase.zip, and using a non-default projection:",error);if(result&&projectionName)console.error("Invalid projection selected:",projectionName)}return proj}},{key:"loadProjDatabase",value:function loadProjDatabase(){return _weavejs.WeaveAPI.URLRequestUtils.request(null,new URLRequest("ProjDatabase.zip")).then(function(result){return(0,_jszip2.default)().loadAsync(result)}).then(function(zip){return zip.file("ProjDatabase.json").async("string")}).then(JSON.parse).then(function(db){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(db)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var newProjName=_step.value;var projDef=db[newProjName];if(projDef)_proj2.default.defs(newProjName,projDef)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return true})}},{key:"projectionVerifier",value:function projectionVerifier(value){return!!Projections.getProjection(value)}},{key:"getEstimatedExtent",value:function getEstimatedExtent(proj){var extentBounds=new Bounds2D;var IOTA=Number("1e-10");if(!proj.getExtent()){var code=proj.getCode();if(Projections.estimatedExtentMap.get(code))return Projections.estimatedExtentMap.get(code);for(var lat=-180;lat<180;lat++){for(var long=-90;long<180;long++){var coord=[long,lat];if(coord[0]==-180)coord[0]+=IOTA;if(coord[0]==180)coord[0]-=IOTA;if(coord[1]==-90)coord[1]+=IOTA;if(coord[1]==90)coord[1]-=IOTA;var projectedPoint=ol.proj.fromLonLat(coord,proj);extentBounds.includeCoords(projectedPoint[0],projectedPoint[1])}}return Projections.estimatedExtentMap.set(code,extentBounds.getCoords()).get(code)}return proj.getExtent()}},{key:"projectionDbReadyOrFailed",get:function get(){return!!Projections.projectionDbPromise.getResult()||!!Projections.projectionDbPromise.getError()}}]);return Projections}();exports.default=Projections;Projections.DEFAULT_PROJECTION="EPSG:4326";Projections.projectionDbPromise=Projections.loadProjDatabase();Projections.estimatedExtentMap=new Map;

},{"openlayers":"openlayers","weaveapp/modules/jszip":64,"weaveapp/modules/proj4":65,"weavejs":136}],100:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractFeatureLayer=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _AbstractLayer2=require("weaveapp/tool/oltool/layer/AbstractLayer");var _AbstractLayer3=_interopRequireDefault(_AbstractLayer2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StandardLib=weavejs.util.StandardLib;var KeySet=weavejs.data.key.KeySet;var FilteredKeySet=weavejs.data.key.FilteredKeySet;var DynamicKeyFilter=weavejs.data.key.DynamicKeyFilter;var AbstractFeatureLayer=exports.AbstractFeatureLayer=function(_AbstractLayer){_inherits(AbstractFeatureLayer,_AbstractLayer);function AbstractFeatureLayer(){_classCallCheck(this,AbstractFeatureLayer);var _this=_possibleConstructorReturn(this,(AbstractFeatureLayer.__proto__||Object.getPrototypeOf(AbstractFeatureLayer)).call(this));_this.filteredKeySet=_weavejs.Weave.linkableChild(_this,FilteredKeySet);_this.selectionFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.probeFilter=_weavejs.Weave.linkableChild(_this,DynamicKeyFilter);_this.styleResolutionDependent=false;_this.selectionFilter.targetPath=["defaultSelectionKeySet"];_this.probeFilter.targetPath=["defaultProbeKeySet"];_this.filteredKeySet.keyFilter.targetPath=["defaultSubsetKeyFilter"];_this.olLayer=new ol.layer.Vector;_this.source=new ol.source.Vector({wrapX:false});_this.updateMetaStyle=_this.updateMetaStyle_unbound.bind(_this);_this.debounced_updateMetaStyles=_.debounce(_this.updateMetaStyles.bind(_this),0);return _this}_createClass(AbstractFeatureLayer,[{key:"getRequiredAttributes",value:function getRequiredAttributes(){return[]}},{key:"getExtent",value:function getExtent(){var bounds=_get(AbstractFeatureLayer.prototype.__proto__||Object.getPrototypeOf(AbstractFeatureLayer.prototype),"getExtent",this).call(this);bounds.setCoords(this.source.getExtent());return bounds}},{key:"isSelected",value:function isSelected(key){var keySet=this.selectionFilter.target;return keySet instanceof KeySet&&keySet.containsKey(key)}},{key:"isProbed",value:function isProbed(key){var keySet=this.probeFilter.target;return keySet instanceof KeySet&&keySet.containsKey(key)}},{key:"onLayerReady",value:function onLayerReady(){_get(AbstractFeatureLayer.prototype.__proto__||Object.getPrototypeOf(AbstractFeatureLayer.prototype),"onLayerReady",this).call(this);this.source.on("addfeature",this.onFeatureAdd,this);this.changedItems=new Set;var selectionKeyHandler=this.updateSetFromKeySet.bind(this,this.selectionFilter,new Set);var probeKeyHandler=this.updateSetFromKeySet.bind(this,this.probeFilter,new Set);this.selectionFilter.addGroupedCallback(this,selectionKeyHandler,true);this.probeFilter.addGroupedCallback(this,probeKeyHandler,true);_weavejs.Weave.getCallbacks(this.filteredKeySet).addGroupedCallback(this,this.updateMetaStyles,true);this.selectable.addGroupedCallback(this,this.updateMetaStyles)}},{key:"onFeatureAdd",value:function onFeatureAdd(vectorEvent){vectorEvent.feature.on("propertychange",this.onFeaturePropertyChange,this)}},{key:"onFeaturePropertyChange",value:function onFeaturePropertyChange(objectEvent){var propertyName=objectEvent.key;if(!_.contains(AbstractFeatureLayer.Styles,propertyName)){return}else{this.debounced_updateMetaStyles()}}},{key:"getToolTipColumns",value:function getToolTipColumns(){return[]}},{key:"updateSetFromKeySet",value:function updateSetFromKeySet(keyFilter,previousContents){var keySet=keyFilter.getInternalKeyFilter();if(!keySet)return;if(!this.source)return;var wasEmpty=previousContents.size===0;var isEmpty=keySet.keys.length===0;if(keyFilter===this.selectionFilter&&isEmpty!==wasEmpty){this.updateMetaStyles()}else{this.changedItems.clear();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=keySet.keys[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;if(!previousContents.has(key))this.changedItems.add(key)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=previousContents[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _key=_step2.value;if(!keySet.containsKey(_key))this.changedItems.add(_key)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.changedItems.forEach(function(featureId){var feature=this.source.getFeatureById(featureId);if(feature){this.updateMetaStyle(feature)}},this)}previousContents.clear();var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=keySet.keys[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _key2=_step3.value;previousContents.add(_key2)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"updateMetaStyles",value:function updateMetaStyles(){if(!this.source)return;this.source.forEachFeature(this.updateMetaStyle,this)}},{key:"updateMetaStyle_unbound",value:function updateMetaStyle_unbound(feature){var id=feature.getId();var nullStyle=new ol.style.Style({});var unselectedStyle=feature.get("unselectedStyle")||nullStyle;var normalStyle=feature.get("normalStyle")||nullStyle;var selectedStyle=feature.get("selectedStyle")||nullStyle;var probedStyle=feature.get("probedStyle")||nullStyle;var zOrder=feature.get("zOrder")||0;var replace=feature.get("replace");var newStyle=void 0;var isInFilter=this.filteredKeySet.containsKey(id);var isSelected=this.isSelected(id);var isProbed=this.isProbed(id);if(!isInFilter){feature.setStyle(nullStyle);return}if(!this.selectable.state){feature.setStyle(normalStyle);return}if(!isSelected&&!isProbed&&this.selectionKeySet&&this.selectionKeySet.keys.length>0){if(replace){newStyle=unselectedStyle;newStyle.setZIndex(zOrder)}else{newStyle=[].concat(unselectedStyle);newStyle[0].setZIndex(zOrder)}}else{newStyle=[].concat(normalStyle);newStyle[0].setZIndex(zOrder)}if(isSelected){if(replace){newStyle=selectedStyle;newStyle.setZIndex(Number.MAX_SAFE_INTEGER-3)}else{newStyle=newStyle.concat(selectedStyle);newStyle[0].setZIndex(Number.MAX_SAFE_INTEGER-3)}}if(isProbed){if(replace){newStyle=probedStyle;newStyle.setZIndex(Number.MAX_SAFE_INTEGER)}else{newStyle=newStyle.concat(probedStyle);newStyle[0].setZIndex(Number.MAX_SAFE_INTEGER)}}feature.setStyle(newStyle)}},{key:"requiredAttributes",get:function get(){if(!this._cachedRequiredAttributes){this._cachedRequiredAttributes=this.getRequiredAttributes()}return this._cachedRequiredAttributes}},{key:"selectionKeySet",get:function get(){var keySet=this.selectionFilter.target;return keySet instanceof KeySet?keySet:null}},{key:"probeKeySet",get:function get(){var keySet=this.probeFilter.target;return keySet instanceof KeySet?keySet:null}},{key:"editableFields",get:function get(){return _get(AbstractFeatureLayer.prototype.__proto__||Object.getPrototypeOf(AbstractFeatureLayer.prototype),"editableFields",this).set("Selectable",this.selectable)}}],[{key:"toColorArray",value:function toColorArray(color,alpha){var colorArray;if(typeof color=="number"){var hexColor=StandardLib.getHexColor(color);if(!hexColor)return null;colorArray=ol.color.asArray(hexColor)}else{if(color[0]==="#"){colorArray=ol.color.asArray(color)}else{colorArray=ol.color.asArray(StandardLib.getHexColor(Number(color)))}}colorArray=[].concat(colorArray);if(!colorArray){return null}colorArray[3]=Number(alpha);return colorArray}},{key:"toColorRGBA",value:function toColorRGBA(colorString,alpha){var colorArray=AbstractFeatureLayer.toColorArray(colorString,alpha);if(!colorArray)colorArray=[0,0,0,0];return ol.color.asString(colorArray)}},{key:"olFillFromWeaveFill",value:function olFillFromWeaveFill(fill,fade){if(fade===undefined)fade=1;var color=fill.color!==undefined&&fill.color!==null&&AbstractFeatureLayer.toColorArray(fill.color,fill.alpha*fade)||[0,0,0,0];return new ol.style.Fill({color:color})}},{key:"olStrokeFromWeaveStroke",value:function olStrokeFromWeaveStroke(stroke,fade){if(fade===undefined)fade=1;var color=stroke.color!==undefined&&stroke.color!==null&&AbstractFeatureLayer.toColorArray(stroke.color,stroke.alpha*fade)||[0,0,0,1];var lineCap=stroke.lineCap==="none"?"butt":stroke.lineCap||"round";var lineJoin=stroke.lineJoin===null?"round":stroke.lineJoin||"round";var miterLimit=Number(stroke.miterLimit);var width=Number(stroke.weight);if(width==0)color[3]=0;return new ol.style.Stroke({color:color,lineCap:lineCap,lineJoin:lineJoin,miterLimit:miterLimit,width:width})}},{key:"getOlProbedStyle",value:function getOlProbedStyle(baseStrokeStyle){var width=baseStrokeStyle.getWidth();return[new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,0,1],width:width+AbstractFeatureLayer.PROBE_HALO_WIDTH+AbstractFeatureLayer.PROBE_LINE_WIDTH}),zIndex:Number.MAX_SAFE_INTEGER-2}),new ol.style.Style({stroke:new ol.style.Stroke({color:[255,255,255,1],width:width+AbstractFeatureLayer.PROBE_HALO_WIDTH}),zIndex:Number.MAX_SAFE_INTEGER-1})]}},{key:"getOlSelectionStyle",value:function getOlSelectionStyle(baseStrokeStyle){var width=baseStrokeStyle.getWidth();var lineCap=baseStrokeStyle.getLineCap();var lineJoin=baseStrokeStyle.getLineJoin();var miterLimit=baseStrokeStyle.getMiterLimit();return[new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,0,0.5],width:width+AbstractFeatureLayer.SELECT_WIDTH,lineCap:lineCap,lineJoin:lineJoin,miterLimit:miterLimit}),zIndex:Number.MAX_SAFE_INTEGER-4})]}}]);return AbstractFeatureLayer}(_AbstractLayer3.default);AbstractFeatureLayer.SELECT_WIDTH=5;AbstractFeatureLayer.PROBE_HALO_WIDTH=4;AbstractFeatureLayer.PROBE_LINE_WIDTH=1;AbstractFeatureLayer.Styles={NORMAL:"normalStyle",UNSELECTED:"unselectedStyle",SELECTED:"selectedStyle",PROBED:"probedStyle"};;;exports.default=AbstractFeatureLayer;

},{"lodash":"lodash","openlayers":"openlayers","weaveapp/tool/oltool/layer/AbstractLayer":102,"weavejs":136}],101:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractGlyphLayer=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _AbstractFeatureLayer2=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");var _AbstractFeatureLayer3=_interopRequireDefault(_AbstractFeatureLayer2);var _Projections=require("weaveapp/tool/oltool/Projections");var _Projections2=_interopRequireDefault(_Projections);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DynamicColumn=weavejs.data.column.DynamicColumn;var LinkableString=weavejs.core.LinkableString;var GeneralizedGeometry=weavejs.geom.GeneralizedGeometry;var ColumnUtils=weavejs.data.ColumnUtils;var AbstractGlyphLayer=exports.AbstractGlyphLayer=function(_AbstractFeatureLayer){_inherits(AbstractGlyphLayer,_AbstractFeatureLayer);function AbstractGlyphLayer(){_classCallCheck(this,AbstractGlyphLayer);var _this=_possibleConstructorReturn(this,(AbstractGlyphLayer.__proto__||Object.getPrototypeOf(AbstractGlyphLayer)).call(this));_this.dataX=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.dataY=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.sourceProjection=_weavejs.Weave.linkableChild(_this,new LinkableString("EPSG:4326",_Projections2.default.projectionVerifier));_this.filteredKeySet.setColumnKeySources([_this.dataX,_this.dataY]);return _this}_createClass(AbstractGlyphLayer,[{key:"getRequiredAttributes",value:function getRequiredAttributes(){return _get(AbstractGlyphLayer.prototype.__proto__||Object.getPrototypeOf(AbstractGlyphLayer.prototype),"getRequiredAttributes",this).call(this).concat([this.dataX,this.dataY])}},{key:"onLayerReady",value:function onLayerReady(){var _this2=this;_get(AbstractGlyphLayer.prototype.__proto__||Object.getPrototypeOf(AbstractGlyphLayer.prototype),"onLayerReady",this).call(this);this.sourceProjection.addGroupedCallback(this,this.updateLocations);this.requiredAttributes.forEach(function(attr){attr.addGroupedCallback(_this2,_this2.updateLocations)});this.updateLocations()}},{key:"_getFeatureIds",value:function _getFeatureIds(){return _.map(this.source.getFeatures(),function(item){return item.getId()})}},{key:"updateProjection",value:function updateProjection(){this.updateLocations()}},{key:"updateLocations",value:function updateLocations(){var recordIds=_.intersection.apply(null,this.requiredAttributes.map(function(attr){return attr.keys}));var records=ColumnUtils.getRecords({"dataX":this.dataX,"dataY":this.dataY},recordIds);var removedIds=_.difference(this._getFeatureIds(),recordIds);var rawProj=_Projections2.default.getProjection(this.inputProjection);var mapProj=_Projections2.default.getProjection(this.outputProjection);if(!rawProj){if(!AbstractGlyphLayer._projectionErrorsShown.has(this.inputProjection)){AbstractGlyphLayer._projectionErrorsShown.add(this.inputProjection);console.error(_weavejs.Weave.className(this)+": Projection "+this.inputProjection+" does not exist; check your data configuration. Falling back to EPSG:4326 (Lat/Long)")}rawProj=_Projections2.default.getProjection("EPSG:4326")}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=removedIds[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var id=_step.value;var _feature=this.source.getFeatureById(id);this.source.removeFeature(_feature)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var featureAdded=false;for(var i in records){var record=records[i];var geom=void 0;var dataX=record.dataX&&record.dataX[0];if(dataX instanceof GeneralizedGeometry){geom=dataX;dataX=(geom.bounds.xMin+geom.bounds.xMax)/2}var dataY=record.dataY&&record.dataY[0];if(dataY instanceof GeneralizedGeometry){geom=dataY;dataY=(geom.bounds.yMin+geom.bounds.yMax)/2}var point=new ol.geom.Point([dataX,dataY]);point.transform(rawProj,mapProj);var coords=point.getCoordinates();if(!isFinite(coords[0])||!isFinite(coords[1])){point=null}var feature=this.source.getFeatureById(recordIds[i]);if(!feature){feature=new ol.Feature({});feature.setId(recordIds[i]);this.source.addFeature(feature);featureAdded=true}feature.setGeometry(point)}if(featureAdded)this.updateStyleData()}},{key:"editableFields",get:function get(){return _get(AbstractGlyphLayer.prototype.__proto__||Object.getPrototypeOf(AbstractGlyphLayer.prototype),"editableFields",this).set("Source Projection",this.sourceProjection)}},{key:"selectableAttributes",get:function get(){return _get(AbstractGlyphLayer.prototype.__proto__||Object.getPrototypeOf(AbstractGlyphLayer.prototype),"selectableAttributes",this).set("Latitude / Y",this.dataY).set("Longitude / X",this.dataX)}},{key:"inputProjection",get:function get(){return this.dataX.getMetadata("projection")||this.sourceProjection.value||this.outputProjection}}]);return AbstractGlyphLayer}(_AbstractFeatureLayer3.default);AbstractGlyphLayer._projectionErrorsShown=new Set;exports.default=AbstractGlyphLayer;

},{"lodash":"lodash","openlayers":"openlayers","weaveapp/tool/oltool/Projections":99,"weaveapp/tool/oltool/layer/AbstractFeatureLayer":100,"weavejs":136}],102:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _IOpenLayersMapTool=require("weaveapp/tool/oltool/IOpenLayersMapTool");var _IOpenLayersMapTool2=_interopRequireDefault(_IOpenLayersMapTool);var _Projections=require("weaveapp/tool/oltool/Projections");var _Projections2=_interopRequireDefault(_Projections);var _IVisTool=require("weaveapp/api/ui/IVisTool");var _IVisTool2=_interopRequireDefault(_IVisTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var StatefulTextField=weavejs.ui.StatefulTextField;var StatefulRangeSlider=weavejs.ui.StatefulRangeSlider;var ComboBox=weavejs.ui.ComboBox;var Checkbox=weavejs.ui.Checkbox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var DynamicComponent=weavejs.ui.DynamicComponent;var ReactUtils=weavejs.util.ReactUtils;var LinkableNumber=weavejs.core.LinkableNumber;var LinkableBoolean=weavejs.core.LinkableBoolean;var LinkableVariable=weavejs.core.LinkableVariable;var LinkableString=weavejs.core.LinkableString;var IFilteredKeySet=weavejs.api.data.IFilteredKeySet;var Bounds2D=weavejs.geom.Bounds2D;var AbstractLayer=function(){function AbstractLayer(){var _this=this;_classCallCheck(this,AbstractLayer);this.opacity=_weavejs.Weave.linkableChild(this,new LinkableNumber(1));this.visible=_weavejs.Weave.linkableChild(this,new LinkableBoolean(true));this.selectable=_weavejs.Weave.linkableChild(this,new LinkableBoolean(true));this.renderEditor=function(){var pushCrumb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var attributeList=void 0;var idx=0;return ReactUtils.generateTable({body:[].concat(_IVisTool2.default.renderSelectableAttributes(_this.selectableAttributes,pushCrumb),_this.renderEditableFields()),classes:{td:["weave-left-cell","weave-right-cell"]}})};this.parent=null;this._olLayer=null}_createClass(AbstractLayer,[{key:"getExtent",value:function getExtent(){return new Bounds2D}},{key:"renderEditableField",value:function renderEditableField(value,key){var lv=void 0;var options=void 0;if(value instanceof LinkableVariable){lv=value;options=[]}else if(Array.isArray(value)){lv=value[0];options=value[1]}else if(_weavejs.Weave.IS(value,IFilteredKeySet)){var fks=_weavejs.Weave.AS(value,IFilteredKeySet);return[_weavejs.Weave.lang(key),React.createElement(DynamicComponent,{dependencies:[fks],render:function render(){return React.createElement(Checkbox,{key:key,label:" ",value:!fks.keyFilter.target,onChange:function onChange(value){fks.keyFilter.targetPath=value?null:["defaultSubsetKeyFilter"]}})}})]}if(key=="Opacity"){return[_weavejs.Weave.lang(key),React.createElement(StatefulRangeSlider,{valueFormat:function valueFormat(value){return" "+Math.round(value*100)+"%"},min:0,max:1,step:0.01,style:{display:"inline",width:"50px",verticalAlign:"middle"},ref:WeaveReactUtils.linkReactStateRef(this,{value:value})})]}if(lv instanceof LinkableString||lv instanceof LinkableNumber){if(_typeof(options[0])===_typeof("")){return[_weavejs.Weave.lang(key),React.createElement(ComboBox,{key:key,ref:WeaveReactUtils.linkReactStateRef(this,{value:lv}),options:options})]}else if(_typeof(options[0])===_typeof({})){return[_weavejs.Weave.lang(key),React.createElement(ComboBox,{key:key,ref:WeaveReactUtils.linkReactStateRef(this,{value:lv}),options:options})]}else{return[_weavejs.Weave.lang(key),React.createElement(StatefulTextField,{key:key,ref:WeaveReactUtils.linkReactStateRef(this,{value:lv})})]}}else if(lv instanceof LinkableBoolean){return[_weavejs.Weave.lang(key),React.createElement(Checkbox,{key:key,ref:WeaveReactUtils.linkReactStateRef(this,{value:lv}),label:" "})]}else return["",""]}},{key:"renderEditableFields",value:function renderEditableFields(){var _this2=this;var fieldList=[];this.editableFields.forEach(function(value,key){fieldList.push(_this2.renderEditableField(value,key))});return fieldList}},{key:"onLayerReady",value:function onLayerReady(){var parent=_weavejs.Weave.getAncestor(this,_IOpenLayersMapTool2.default);this.projectionSRS=parent.projectionSRS;this.projectionSRS.addGroupedCallback(this,this.updateProjection,true)}},{key:"updateProjection",value:function updateProjection(){}},{key:"addAndConfigureLayer",value:function addAndConfigureLayer(){var _this3=this;var value=this.olLayer;this.parent.map.addLayer(value);this.opacity.addGroupedCallback(this,function(){return value.set("opacity",_this3.opacity.value)},true);this.visible.addGroupedCallback(this,function(){return value.set("visible",_this3.visible.value)},true);this.selectable.addGroupedCallback(this,function(){return value.set("selectable",_this3.selectable.value)},true);var index=this.parent.layers.getObjects().indexOf(this);value.setZIndex(index+2);value.set("layerObject",this);this.onLayerReady()}},{key:"getDescription",value:function getDescription(){var name=_weavejs.Weave.getOwner(this).getName(this);return name}},{key:"dispose",value:function dispose(){if(this._olLayer!=null){this.parent.map.removeLayer(this._olLayer)}}},{key:"deprecatedStateMapping",get:function get(){return{alpha:this.opacity}}},{key:"editableFields",get:function get(){return new Map().set("Opacity",this.opacity)}},{key:"selectableAttributes",get:function get(){return new Map}},{key:"source",get:function get(){return this._source},set:function set(value){var _this4=this;this._source=value;if(!this.olLayer){_weavejs.WeaveAPI.Scheduler.callLater(this,function(){_this4.source=value});return}this.olLayer.setSource(value)}},{key:"olLayer",set:function set(value){var _this5=this;if(!this.parent||!this.parent.map){_weavejs.WeaveAPI.Scheduler.callLater(this,function(){_this5.olLayer=value});return}if(value){this._olLayer=value;this.addAndConfigureLayer()}},get:function get(){return this._olLayer}},{key:"outputProjection",get:function get(){return this.projectionSRS&&this.projectionSRS.value||this.parent&&this.parent.getDefaultProjection()||_Projections2.default.DEFAULT_PROJECTION}}],[{key:"selectableLayerFilter",value:function selectableLayerFilter(layer){return layer.get("selectable")}}]);return AbstractLayer}();exports.default=AbstractLayer;

},{"react":"react","weaveapp/api/ui/IVisTool":11,"weaveapp/tool/oltool/IOpenLayersMapTool":93,"weaveapp/tool/oltool/Projections":99,"weavejs":136}],103:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CircleCache=function(){function CircleCache(){_classCallCheck(this,CircleCache)}_createClass(CircleCache,null,[{key:"circleDefToString",value:function circleDefToString(fillStyle,strokeStyle,radius){var fillColor=fillStyle?ol.color.asArray(fillStyle.getColor()):null;var strokeColor=strokeStyle?ol.color.asArray(strokeStyle.getColor()):null;var strokeWidth=strokeStyle?strokeStyle.getWidth():null;return JSON.stringify([fillColor,strokeColor,strokeWidth,radius])}},{key:"getCircle",value:function getCircle(options){var circleString=CircleCache.circleDefToString(options.fill,options.stroke,options.radius);var circle=void 0;if(!CircleCache.cache.has(circleString)){circle=new ol.style.Circle(options);CircleCache.cache.set(circleString,circle)}else{circle=CircleCache.cache.get(circleString)}return circle}}]);return CircleCache}();exports.default=CircleCache;CircleCache.cache=new Map;

},{"openlayers":"openlayers"}],104:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractFeatureLayer2=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");var _SolidFillStyle=require("weaveapp/plot/SolidFillStyle");var _SolidFillStyle2=_interopRequireDefault(_SolidFillStyle);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _Projections=require("weaveapp/tool/oltool/Projections");var _Projections2=_interopRequireDefault(_Projections);var _ScatterPlotLayer=require("weaveapp/tool/oltool/layer/ScatterPlotLayer");var _ScatterPlotLayer2=_interopRequireDefault(_ScatterPlotLayer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DynamicColumn=weavejs.data.column.DynamicColumn;var ColumnMetadata=weavejs.api.data.ColumnMetadata;var DataTypes=weavejs.api.data.DataTypes;var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var NormalizedColumn=weavejs.data.column.NormalizedColumn;var ColumnUtils=weavejs.data.ColumnUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var GeometryLayer=function(_AbstractFeatureLayer){_inherits(GeometryLayer,_AbstractFeatureLayer);function GeometryLayer(){_classCallCheck(this,GeometryLayer);var _this=_possibleConstructorReturn(this,(GeometryLayer.__proto__||Object.getPrototypeOf(GeometryLayer)).call(this));_this.fill=_weavejs.Weave.linkableChild(_this,_SolidFillStyle2.default);_this.line=_weavejs.Weave.linkableChild(_this,_SolidLineStyle2.default);_this.geometryColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.radius=_weavejs.Weave.linkableChild(_this,new AlwaysDefinedColumn(5));_this.fill.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.radius.internalDynamicColumn.requestLocalObject(NormalizedColumn,true);_this.radiusNorm.min.value=3;_this.radiusNorm.max.value=25;_this.filteredKeySet.setColumnKeySources([_this.geometryColumn]);_this.geoJsonParser=new ol.format.GeoJSON;return _this}_createClass(GeometryLayer,[{key:"getRequiredAttributes",value:function getRequiredAttributes(){return _get(GeometryLayer.prototype.__proto__||Object.getPrototypeOf(GeometryLayer.prototype),"getRequiredAttributes",this).call(this).concat([this.geometryColumn])}},{key:"onLayerReady",value:function onLayerReady(){_get(GeometryLayer.prototype.__proto__||Object.getPrototypeOf(GeometryLayer.prototype),"onLayerReady",this).call(this);this.geometryColumn.addGroupedCallback(this,this.updateGeometryData);_weavejs.Weave.getCallbacks(this.filteredKeySet).removeCallback(this,this.updateMetaStyles);_weavejs.Weave.getCallbacks(this.fill).addGroupedCallback(this,this.updateStyleData);_weavejs.Weave.getCallbacks(this.line).addGroupedCallback(this,this.updateStyleData);_weavejs.Weave.getCallbacks(this.radius).addGroupedCallback(this,this.updateStyleData);_weavejs.Weave.getCallbacks(this.filteredKeySet).addGroupedCallback(this,this.updateGeometryData,true)}},{key:"updateProjection",value:function updateProjection(){this.updateGeometryData()}},{key:"updateGeometryData",value:function updateGeometryData(){this.source.clear();var idc=this.geometryColumn;var keys=this.filteredKeySet.keys;if(idc.getMetadata(ColumnMetadata.DATA_TYPE)!=DataTypes.GEOMETRY)return;var rawGeometries=ColumnUtils.getGeoJsonGeometries(idc,keys);for(var idx=0;idx<keys.length;idx++){var rawGeom=rawGeometries[idx];if(!rawGeom)continue;var id=keys[idx];var geometry=this.geoJsonParser.readGeometry(rawGeom,{dataProjection:_Projections2.default.getProjection(this.inputProjection),featureProjection:_Projections2.default.getProjection(this.outputProjection)});if(geometry.getExtent().some(_.isNaN)){console.error("Dropping feature",id,"due to containing NaN coordinates. Possibly misconfigured projection?");continue}var feature=new ol.Feature({geometry:geometry});feature.setId(id);this.source.addFeature(feature)}this.updateStyleData();this.updateMetaStyles()}},{key:"getToolTipColumns",value:function getToolTipColumns(){var additionalColumns=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_weavejs.Weave.getPath(this.fill).getChildren().concat(_weavejs.Weave.getPath(this.line).getChildren())[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var column=_step.value;var internalColumn=ColumnUtils.hack_findInternalDynamicColumn(column.getObject());if(internalColumn)additionalColumns.push(internalColumn)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return additionalColumns}},{key:"updateStyleData",value:function updateStyleData(){var fillEnabled=this.fill.enable.value;var strokeEnabled=this.line.enable.value;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.filteredKeySet.keys[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var key=_step2.value;var record={};record.id=key;record.fill=this.fill.getStyle(key);record.stroke=this.line.getStyle(key);record.radius=this.radius.getValueFromKey(key);var olStroke=_AbstractFeatureLayer2.AbstractFeatureLayer.olStrokeFromWeaveStroke(record.stroke);var olFill=_AbstractFeatureLayer2.AbstractFeatureLayer.olFillFromWeaveFill(record.fill);var olStrokeFaded=_AbstractFeatureLayer2.AbstractFeatureLayer.olStrokeFromWeaveStroke(record.stroke,0.5);var olFillFaded=_AbstractFeatureLayer2.AbstractFeatureLayer.olFillFromWeaveFill(record.fill,0.5);var olSelectionStyle=_AbstractFeatureLayer2.AbstractFeatureLayer.getOlSelectionStyle(olStroke);var olProbedStyle=_AbstractFeatureLayer2.AbstractFeatureLayer.getOlProbedStyle(olStroke);var normalStyle=[new ol.style.Style({fill:fillEnabled?olFill:undefined,stroke:strokeEnabled?olStroke:undefined,zIndex:0})];var unselectedStyle=[new ol.style.Style({fill:fillEnabled?olFill:undefined,stroke:strokeEnabled?olStrokeFaded:undefined,zIndex:0})];var selectedStyle=(strokeEnabled||fillEnabled)&&_AbstractFeatureLayer2.AbstractFeatureLayer.getOlSelectionStyle(olStroke);var probedStyle=(strokeEnabled||fillEnabled)&&_AbstractFeatureLayer2.AbstractFeatureLayer.getOlProbedStyle(olStroke);var feature=this.source.getFeatureById(record.id);if(feature){if(feature.getGeometry()instanceof ol.geom.MultiPoint){normalStyle=_ScatterPlotLayer2.default.getNormalStyle(record,strokeEnabled,fillEnabled,olStroke,olFill);unselectedStyle=_ScatterPlotLayer2.default.getUnselectedStyle(record,strokeEnabled,fillEnabled,olStrokeFaded,olFillFaded);selectedStyle=_ScatterPlotLayer2.default.getSelectedStyle(record,strokeEnabled,fillEnabled,olSelectionStyle);probedStyle=_ScatterPlotLayer2.default.getProbedStyle(record,strokeEnabled,fillEnabled,olProbedStyle)}var metaStyle={};metaStyle.normalStyle=normalStyle;metaStyle.unselectedStyle=unselectedStyle;metaStyle.selectedStyle=selectedStyle;metaStyle.probedStyle=probedStyle;feature.setProperties(metaStyle)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"selectableAttributes",get:function get(){return _get(GeometryLayer.prototype.__proto__||Object.getPrototypeOf(GeometryLayer.prototype),"selectableAttributes",this).set("Geometries",this.geometryColumn).set("Fill Color",this.fill.color).set("Fill Alpha",this.fill.alpha).set("Line Color",this.line.color).set("Line Alpha",this.line.alpha).set("Line Thickness",this.line.normalizedWeightColumn)}},{key:"editableFields",get:function get(){return _get(GeometryLayer.prototype.__proto__||Object.getPrototypeOf(GeometryLayer.prototype),"editableFields",this).set("Ignore subset",this.filteredKeySet)}},{key:"radiusNorm",get:function get(){return this.radius.getInternalColumn()}},{key:"radiusData",get:function get(){return this.radiusNorm.internalDynamicColumn}},{key:"deprecatedStateMapping",get:function get(){return _.merge(_get(GeometryLayer.prototype.__proto__||Object.getPrototypeOf(GeometryLayer.prototype),"deprecatedStateMapping",this),{geometryColumn:{internalDynamicColumn:this.geometryColumn},alpha:this.opacity})}},{key:"inputProjection",get:function get(){return this.geometryColumn.getMetadata("projection")||this.outputProjection}}]);return GeometryLayer}(_AbstractFeatureLayer2.AbstractFeatureLayer);exports.default=GeometryLayer;GeometryLayer.WEAVE_INFO=_weavejs.Weave.setClassInfo(GeometryLayer,{id:"weavejs.tool.oltool.layer.GeometryLayer",label:"Geometries",interfaces:[ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.plotters::GeometryPlotter"]});

},{"lodash":"lodash","openlayers":"openlayers","weaveapp/plot/SolidFillStyle":68,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/oltool/Projections":99,"weaveapp/tool/oltool/layer/AbstractFeatureLayer":100,"weaveapp/tool/oltool/layer/ScatterPlotLayer":108,"weavejs":136}],105:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _weavejs=require("weavejs");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Dictionary2D=weavejs.util.Dictionary2D;var ImageGlyphCache=function(){function ImageGlyphCache(context){_classCallCheck(this,ImageGlyphCache);this.context=context;this.baseImageElements=new Map;this.canvasMap=new Dictionary2D;this.imageMap=new Dictionary2D}_createClass(ImageGlyphCache,[{key:"requestBaseImageElement",value:function requestBaseImageElement(url,callback){var imageElement=this.baseImageElements.get(url);if(!imageElement){imageElement=new Image;imageElement.src=url;this.baseImageElements.set(url,imageElement)}if(imageElement.complete){callback(imageElement)}else{(0,_jquery2.default)(imageElement).one("load",function(){return callback(imageElement)})}}},{key:"getCachedCanvas",value:function getCachedCanvas(url,color){var canvas=this.canvasMap.get(url,color);var freshCanvas=false;if(!canvas){freshCanvas=true;canvas=document.createElement("canvas");this.canvasMap.set(url,color,canvas)}return{canvas:canvas,freshCanvas:freshCanvas}}},{key:"requestDataUrl",value:function requestDataUrl(url,color,callback){var _getCachedCanvas=this.getCachedCanvas(url,color),canvas=_getCachedCanvas.canvas,freshCanvas=_getCachedCanvas.freshCanvas;if(freshCanvas){this.requestBaseImageElement(url,function(imageElement){var _ref=[imageElement.naturalHeight,imageElement.naturalWidth];canvas.height=_ref[0];canvas.width=_ref[1];var ctx=canvas.getContext("2d");ctx.fillStyle=color;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.globalCompositeOperation="destination-atop";ctx.drawImage(imageElement,0,0);ctx.globalCompositeOperation="multiply";ctx.drawImage(imageElement,0,0);callback(canvas.toDataURL())})}else{callback(canvas.toDataURL())}}},{key:"getImage",value:function getImage(url,color){var _this=this;var image=this.imageMap.get(url,color);if(!image){image=new Image;_weavejs.WeaveAPI.URLRequestUtils.request(this.context,{url:url,responseType:"datauri",mimeType:""}).then(function(dataUri){_this.requestDataUrl(dataUri,color,function(dataUrl){image.src=dataUrl})});this.imageMap.set(url,color,image)}return image}}]);return ImageGlyphCache}();exports.default=ImageGlyphCache;

},{"weaveapp/modules/jquery":63,"weavejs":136}],106:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _AbstractGlyphLayer2=require("weaveapp/tool/oltool/layer/AbstractGlyphLayer");var _AbstractGlyphLayer3=_interopRequireDefault(_AbstractGlyphLayer2);var _ImageGlyphCache=require("weaveapp/tool/oltool/layer/ImageGlyphCache");var _ImageGlyphCache2=_interopRequireDefault(_ImageGlyphCache);var _AbstractFeatureLayer=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");var _AbstractFeatureLayer2=_interopRequireDefault(_AbstractFeatureLayer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var ColumnUtils=weavejs.data.ColumnUtils;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ImageGlyphLayer=function(_AbstractGlyphLayer){_inherits(ImageGlyphLayer,_AbstractGlyphLayer);function ImageGlyphLayer(){_classCallCheck(this,ImageGlyphLayer);var _this=_possibleConstructorReturn(this,(ImageGlyphLayer.__proto__||Object.getPrototypeOf(ImageGlyphLayer)).call(this));_this.imageSize=_weavejs.Weave.linkableChild(_this,AlwaysDefinedColumn);_this.imageURL=_weavejs.Weave.linkableChild(_this,AlwaysDefinedColumn);_this.dataAlpha=_weavejs.Weave.linkableChild(_this,new AlwaysDefinedColumn(1));_this.dataColor=_weavejs.Weave.linkableChild(_this,AlwaysDefinedColumn);_this.imageGlyphCache=new _ImageGlyphCache2.default(_this);_this.dataAlpha.defaultValue.state=1;return _this}_createClass(ImageGlyphLayer,[{key:"onLayerReady",value:function onLayerReady(){_get(ImageGlyphLayer.prototype.__proto__||Object.getPrototypeOf(ImageGlyphLayer.prototype),"onLayerReady",this).call(this);this.imageSize.addGroupedCallback(this,this.updateStyleData);this.imageURL.addGroupedCallback(this,this.updateStyleData);this.dataAlpha.addGroupedCallback(this,this.updateStyleData);this.dataColor.addGroupedCallback(this,this.updateStyleData,true)}},{key:"getToolTipColumns",value:function getToolTipColumns(){var additionalColumns=[];var _arr=[this.imageSize,this.imageURL,this.dataAlpha,this.dataColor];for(var _i=0;_i<_arr.length;_i++){var column=_arr[_i];var internalColumn=ColumnUtils.hack_findInternalDynamicColumn(column);if(internalColumn)additionalColumns.push(internalColumn)}return additionalColumns}},{key:"setIconStyle",value:function setIconStyle(feature,img,iconSize,alpha){var styles={};if(!img.complete||!img.src){(0,_jquery2.default)(img).one("load",this.setIconStyle.bind(this,feature,img,iconSize,alpha));return}var maxDim=Math.max(img.naturalHeight,img.naturalWidth);var scale=void 0;if(isNaN(iconSize)){scale=1}else{scale=iconSize/maxDim}var imgSize=[img.naturalWidth,img.naturalHeight];var _arr2=["normal","selected","probed","unselected"];for(var _i2=0;_i2<_arr2.length;_i2++){var stylePrefix=_arr2[_i2];var icon=void 0;if(stylePrefix==="probed"){icon=new ol.style.Icon({snapToPixel:true,img:img,imgSize:imgSize,scale:scale*2})}else{icon=new ol.style.Icon({snapToPixel:true,img:img,imgSize:imgSize,scale:scale})}if(stylePrefix==="unselected"){icon.setOpacity(alpha/3)}else{icon.setOpacity(alpha)}styles[stylePrefix+"Style"]=new ol.style.Style({image:icon})}styles.replace=true;feature.setProperties(styles)}},{key:"updateStyleData",value:function updateStyleData(){var recordIds=this.dataX.keys;var records=ColumnUtils.getRecords({"alpha":this.dataAlpha,"color":this.dataColor,"imageURL":this.imageURL,"imageSize":this.imageSize},recordIds,{"alpha":Number,"color":Number,"imageURL":String,"imageSize":Number});for(var idx in records){var record=records[idx];var feature=this.source.getFeatureById(recordIds[idx]);if(!feature){feature=new ol.Feature({});feature.setId(recordIds[idx]);this.source.addFeature(feature)}var imageSize=Number(record.imageSize||NaN);if(isNaN(record.alpha))record.alpha=1;var color=_AbstractFeatureLayer2.default.toColorRGBA(record.color,1);if(!record.imageURL){feature.setStyle(null);continue}var img=this.imageGlyphCache.getImage(record.imageURL,color);this.setIconStyle(feature,img,imageSize,record.alpha)}}},{key:"selectableAttributes",get:function get(){return _get(ImageGlyphLayer.prototype.__proto__||Object.getPrototypeOf(ImageGlyphLayer.prototype),"selectableAttributes",this).set("Image Size",this.imageSize).set("Image URL",this.imageURL).set("Image Tint",this.dataColor)}},{key:"deprecatedStateMapping",get:function get(){var _this2=this;return _.merge(_get(ImageGlyphLayer.prototype.__proto__||Object.getPrototypeOf(ImageGlyphLayer.prototype),"deprecatedStateMapping",this),{alpha:function alpha(state){return _weavejs.Weave.setState(typeof state==="number"?_this2.opacity:_this2.dataAlpha,state)},color:this.dataColor})}}]);return ImageGlyphLayer}(_AbstractGlyphLayer3.default);exports.default=ImageGlyphLayer;ImageGlyphLayer.WEAVE_INFO=_weavejs.Weave.setClassInfo(ImageGlyphLayer,{id:"weavejs.tool.oltool.layer.ImageGlyphLayer",label:"Icons",interfaces:[ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.plotters::ImageGlyphPlotter"]});

},{"lodash":"lodash","openlayers":"openlayers","weaveapp/modules/jquery":63,"weaveapp/tool/oltool/layer/AbstractFeatureLayer":100,"weaveapp/tool/oltool/layer/AbstractGlyphLayer":101,"weaveapp/tool/oltool/layer/ImageGlyphCache":105,"weavejs":136}],107:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractGlyphLayer2=require("weaveapp/tool/oltool/layer/AbstractGlyphLayer");var _AbstractGlyphLayer3=_interopRequireDefault(_AbstractGlyphLayer2);var _AbstractFeatureLayer=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");var _AbstractFeatureLayer2=_interopRequireDefault(_AbstractFeatureLayer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DOMUtils=weavejs.util.DOMUtils;var Bounds2D=weavejs.geom.Bounds2D;var DynamicColumn=weavejs.data.column.DynamicColumn;var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var LinkableBoolean=weavejs.core.LinkableBoolean;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var LabelLayer=function(_AbstractGlyphLayer){_inherits(LabelLayer,_AbstractGlyphLayer);function LabelLayer(){_classCallCheck(this,LabelLayer);var _this=_possibleConstructorReturn(this,(LabelLayer.__proto__||Object.getPrototypeOf(LabelLayer)).call(this));_this.size=_weavejs.Weave.linkableChild(_this,AlwaysDefinedColumn);_this.text=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.color=_weavejs.Weave.linkableChild(_this,AlwaysDefinedColumn);_this.sortColumn=_weavejs.Weave.linkableChild(_this,DynamicColumn);_this.hideOverlappingText=_weavejs.Weave.linkableChild(_this,LinkableBoolean);_this.styleResolutionDependent=true;return _this}_createClass(LabelLayer,[{key:"getRequiredAttributes",value:function getRequiredAttributes(){return _get(LabelLayer.prototype.__proto__||Object.getPrototypeOf(LabelLayer.prototype),"getRequiredAttributes",this).call(this).concat([this.text])}},{key:"onLayerReady",value:function onLayerReady(){_get(LabelLayer.prototype.__proto__||Object.getPrototypeOf(LabelLayer.prototype),"onLayerReady",this).call(this);this.size.addGroupedCallback(this,this.updateStyleData);this.text.addGroupedCallback(this,this.updateStyleData);this.color.addGroupedCallback(this,this.updateStyleData);this.hideOverlappingText.addGroupedCallback(this,this.updateStyleData,true)}},{key:"updateStyleData",value:function updateStyleData(){if(!this.parent||!this.parent.map){_weavejs.WeaveAPI.Scheduler.callLater(this,this.updateStyleData);return}var map=this.parent.map;var records=[];var renderedRecords=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.text.keys[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;var feature=this.source.getFeatureById(key.toString());if(!feature){feature=new ol.Feature({});feature.setId(key);this.source.addFeature(feature)}var text=this.text.getValueFromKey(key,String);var size=this.size.getValueFromKey(key,Number);var color=this.color.getValueFromKey(key,String);var sort=this.sortColumn.getValueFromKey(key,Number);var font=size+"px sans-serif";var width=DOMUtils.getTextWidth(text,font);var height=DOMUtils.getTextHeight(text,font);if(text){text=_.trim(text)}var bounds=feature.get("Bounds2D");if(!bounds){bounds=new Bounds2D;feature.set("Bounds2D",bounds)}var point=feature.getGeometry();var pixel=point?map.getPixelFromCoordinate(point.getCoordinates()):null;if(pixel){bounds.setCenter(pixel[0],pixel[1]);bounds.setWidth(width);bounds.setHeight(height)}else{bounds.setCenter(NaN,NaN);bounds.setWidth(0);bounds.setHeight(0)}records.push({text:text,color:color,sort:sort,font:font,feature:feature,bounds:bounds})}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}records=_.sortByOrder(records,["sort"],["desc"]);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=records[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var record=_step2.value;var doRender=true;if(this.hideOverlappingText.value){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=renderedRecords[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var otherRecord=_step3.value;if(otherRecord.bounds.overlaps(record.bounds)){doRender=false}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}if(doRender){renderedRecords.push(record)}var _text=_weavejs.Weave.lang(record.text);var _color=record.color;var _font=record.font;var _feature=record.feature;var textColor=_AbstractFeatureLayer2.default.toColorRGBA(_color,1);var fadedTextColor=_AbstractFeatureLayer2.default.toColorRGBA(_color,0.5);var selectedStroke=new ol.style.Stroke({color:"rgba(128,128,128,0.75)",width:3});var probeStroke=new ol.style.Stroke({color:"white",width:2});var normalFill=new ol.style.Fill({color:textColor});var fadedFill=new ol.style.Fill({color:fadedTextColor});var normalText=doRender?new ol.style.Text({text:_text,font:_font,fill:normalFill}):null;var probedText=new ol.style.Text({text:_text,font:_font,fill:normalFill,stroke:probeStroke});var selectedText=new ol.style.Text({text:_text,font:_font,fill:normalFill,stroke:selectedStroke});var unselectedText=doRender?new ol.style.Text({text:_text,font:_font,fill:fadedFill}):null;var metaStyle={};metaStyle.normalStyle=new ol.style.Style({text:normalText});metaStyle.unselectedStyle=new ol.style.Style({text:unselectedText});metaStyle.selectedStyle=new ol.style.Style({text:selectedText});metaStyle.probedStyle=new ol.style.Style({text:probedText});metaStyle.replace=true;_feature.setProperties(metaStyle)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"selectableAttributes",get:function get(){return _get(LabelLayer.prototype.__proto__||Object.getPrototypeOf(LabelLayer.prototype),"selectableAttributes",this).set("Text",this.text).set("Text Size",this.size).set("Text Color",this.color).set("Display precedence",this.sortColumn)}},{key:"editableFields",get:function get(){return _get(LabelLayer.prototype.__proto__||Object.getPrototypeOf(LabelLayer.prototype),"editableFields",this).set("Hide overlapping text",this.hideOverlappingText)}},{key:"deprecatedStateMapping",get:function get(){return _.merge(_get(LabelLayer.prototype.__proto__||Object.getPrototypeOf(LabelLayer.prototype),"deprecatedStateMapping",this),{geometryColumn:[{internalDynamicColumn:this.dataX},{internalDynamicColumn:this.dataY}]})}}]);return LabelLayer}(_AbstractGlyphLayer3.default);exports.default=LabelLayer;LabelLayer.WEAVE_INFO=_weavejs.Weave.setClassInfo(LabelLayer,{id:"weavejs.tool.oltool.layer.LabelLayer",label:"Labels",interfaces:[ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.plotters::TextGlyphPlotter","weave.visualization.plotters::GeometryLabelPlotter"]});

},{"lodash":"lodash","openlayers":"openlayers","weaveapp/tool/oltool/layer/AbstractFeatureLayer":100,"weaveapp/tool/oltool/layer/AbstractGlyphLayer":101,"weavejs":136}],108:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractGlyphLayer2=require("weaveapp/tool/oltool/layer/AbstractGlyphLayer");var _AbstractGlyphLayer3=_interopRequireDefault(_AbstractGlyphLayer2);var _SolidFillStyle=require("weaveapp/plot/SolidFillStyle");var _SolidFillStyle2=_interopRequireDefault(_SolidFillStyle);var _SolidLineStyle=require("weaveapp/plot/SolidLineStyle");var _SolidLineStyle2=_interopRequireDefault(_SolidLineStyle);var _CircleCache=require("weaveapp/tool/oltool/layer/CircleCache");var _CircleCache2=_interopRequireDefault(_CircleCache);var _AbstractFeatureLayer=require("weaveapp/tool/oltool/layer/AbstractFeatureLayer");var _AbstractFeatureLayer2=_interopRequireDefault(_AbstractFeatureLayer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var NormalizedColumn=weavejs.data.column.NormalizedColumn;var IQualifiedKey=weavejs.api.data.IQualifiedKey;var ColumnUtils=weavejs.data.ColumnUtils;var ISelectableAttributes=weavejs.api.data.ISelectableAttributes;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var ScatterPlotLayer=function(_AbstractGlyphLayer){_inherits(ScatterPlotLayer,_AbstractGlyphLayer);function ScatterPlotLayer(){_classCallCheck(this,ScatterPlotLayer);var _this=_possibleConstructorReturn(this,(ScatterPlotLayer.__proto__||Object.getPrototypeOf(ScatterPlotLayer)).call(this));_this.fill=Weave.linkableChild(_this,_SolidFillStyle2.default);_this.line=Weave.linkableChild(_this,_SolidLineStyle2.default);_this.radius=Weave.linkableChild(_this,new AlwaysDefinedColumn(5));_this.fill.color.internalDynamicColumn.targetPath=["defaultColorColumn"];_this.radius.internalDynamicColumn.requestLocalObject(NormalizedColumn,true);_this.radiusNorm.min.value=3;_this.radiusNorm.max.value=25;return _this}_createClass(ScatterPlotLayer,[{key:"onLayerReady",value:function onLayerReady(){_get(ScatterPlotLayer.prototype.__proto__||Object.getPrototypeOf(ScatterPlotLayer.prototype),"onLayerReady",this).call(this);var _arr=[this.fill,this.line,this.radius];for(var _i=0;_i<_arr.length;_i++){var obj=_arr[_i];Weave.getCallbacks(obj).addGroupedCallback(this,this.updateStyleData)}this.updateStyleData()}},{key:"getToolTipColumns",value:function getToolTipColumns(){var additionalColumns=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Weave.getPath(this.fill).getChildren().concat(Weave.getPath(this.line).getChildren())[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var column=_step.value;var internalColumn=ColumnUtils.hack_findInternalDynamicColumn(column.getObject());if(internalColumn)additionalColumns.push(internalColumn)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}additionalColumns.push(ColumnUtils.hack_findInternalDynamicColumn(this.radius));return additionalColumns}},{key:"updateStyleData",value:function updateStyleData(){var recordIds=_.intersection.apply(null,this.requiredAttributes.map(function(attr){return attr.keys}));var fillEnabled=this.fill.enable.value;var strokeEnabled=this.line.enable.value;var styleRecords=ColumnUtils.getRecords({id:IQualifiedKey,fill:this.fill.recordFormat,stroke:this.line.recordFormat,radius:this.radius},recordIds,{fill:this.fill.recordType,stroke:this.line.recordType,radius:Number});styleRecords=_.sortByOrder(styleRecords,["radius","id"],["desc","asc"]);var zOrder=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=styleRecords[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var record=_step2.value;var olStroke=_AbstractFeatureLayer2.default.olStrokeFromWeaveStroke(record.stroke);var olFill=_AbstractFeatureLayer2.default.olFillFromWeaveFill(record.fill);var olStrokeFaded=_AbstractFeatureLayer2.default.olStrokeFromWeaveStroke(record.stroke,0.5);var olFillFaded=_AbstractFeatureLayer2.default.olFillFromWeaveFill(record.fill,0.5);var olSelectionStyle=_AbstractFeatureLayer2.default.getOlSelectionStyle(olStroke);var olProbedStyle=_AbstractFeatureLayer2.default.getOlProbedStyle(olStroke);var normalStyle=ScatterPlotLayer.getNormalStyle(record,strokeEnabled,fillEnabled,olStroke,olFill);var unselectedStyle=ScatterPlotLayer.getUnselectedStyle(record,strokeEnabled,fillEnabled,olStrokeFaded,olFillFaded);var selectedStyle=ScatterPlotLayer.getSelectedStyle(record,strokeEnabled,fillEnabled,olSelectionStyle);var probedStyle=ScatterPlotLayer.getProbedStyle(record,strokeEnabled,fillEnabled,olProbedStyle);var feature=this.source.getFeatureById(record.id);if(!feature){feature=new ol.Feature({});feature.setId(record.id);this.source.addFeature(feature)}var metaStyle={};metaStyle.normalStyle=normalStyle;metaStyle.unselectedStyle=unselectedStyle;metaStyle.selectedStyle=selectedStyle;metaStyle.probedStyle=probedStyle;feature.setProperties(metaStyle);feature.set("zOrder",zOrder);zOrder++}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"selectableAttributes",get:function get(){return _get(ScatterPlotLayer.prototype.__proto__||Object.getPrototypeOf(ScatterPlotLayer.prototype),"selectableAttributes",this).set("Fill Color",this.fill.color).set("Radius",this.radiusData)}},{key:"radiusNorm",get:function get(){return this.radius.getInternalColumn()}},{key:"radiusData",get:function get(){return this.radiusNorm.internalDynamicColumn}},{key:"deprecatedStateMapping",get:function get(){return _.merge(_get(ScatterPlotLayer.prototype.__proto__||Object.getPrototypeOf(ScatterPlotLayer.prototype),"deprecatedStateMapping",this),{"sizeBy":this.radiusData,"minScreenRadius":this.radiusNorm.min,"maxScreenRadius":this.radiusNorm.max,"defaultScreenRadius":this.radius.defaultValue})}}],[{key:"getSelectedStyle",value:function getSelectedStyle(record,strokeEnabled,fillEnabled,olSelectionStyle){return(strokeEnabled||fillEnabled)&&[new ol.style.Style({image:_CircleCache2.default.getCircle({stroke:olSelectionStyle[0].getStroke(),radius:record.radius}),zIndex:olSelectionStyle[0].getZIndex()})]}},{key:"getProbedStyle",value:function getProbedStyle(record,strokeEnabled,fillEnabled,olProbedStyle){return(strokeEnabled||fillEnabled)&&[new ol.style.Style({image:_CircleCache2.default.getCircle({stroke:olProbedStyle[0].getStroke(),radius:record.radius}),zIndex:olProbedStyle[0].getZIndex()}),new ol.style.Style({image:_CircleCache2.default.getCircle({stroke:olProbedStyle[1].getStroke(),radius:record.radius}),zIndex:olProbedStyle[1].getZIndex()})]}},{key:"getNormalStyle",value:function getNormalStyle(record,strokeEnabled,fillEnabled,olStroke,olFill){return[new ol.style.Style({image:_CircleCache2.default.getCircle({fill:fillEnabled?olFill:undefined,stroke:strokeEnabled?olStroke:undefined,radius:record.radius})})]}},{key:"getUnselectedStyle",value:function getUnselectedStyle(record,strokeEnabled,fillEnabled,olStrokeFaded,olFillFaded){return[new ol.style.Style({image:_CircleCache2.default.getCircle({fill:fillEnabled?olFillFaded:undefined,stroke:strokeEnabled?olStrokeFaded:undefined,radius:record.radius})})]}}]);return ScatterPlotLayer}(_AbstractGlyphLayer3.default);exports.default=ScatterPlotLayer;ScatterPlotLayer.WEAVE_INFO=Weave.setClassInfo(ScatterPlotLayer,{id:"weavejs.tool.oltool.layer.ScatterPlotLayer",label:"Bubbles",interfaces:[ILinkableObjectWithNewProperties,ISelectableAttributes],deprecatedIds:["weave.visualization.plotters::ScatterPlotPlotter"]});

},{"lodash":"lodash","openlayers":"openlayers","weaveapp/plot/SolidFillStyle":68,"weaveapp/plot/SolidLineStyle":69,"weaveapp/tool/oltool/layer/AbstractFeatureLayer":100,"weaveapp/tool/oltool/layer/AbstractGlyphLayer":101,"weaveapp/tool/oltool/layer/CircleCache":103,"weavejs":136}],109:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _openlayers=require("openlayers");var ol=_interopRequireWildcard(_openlayers);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _AbstractLayer2=require("weaveapp/tool/oltool/layer/AbstractLayer");var _AbstractLayer3=_interopRequireDefault(_AbstractLayer2);var _Projections=require("weaveapp/tool/oltool/Projections");var _Projections2=_interopRequireDefault(_Projections);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ComboBox=weavejs.ui.ComboBox;var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ReactUtils=weavejs.util.ReactUtils;var LinkableString=weavejs.core.LinkableString;var LinkableVariable=weavejs.core.LinkableVariable;var ILinkableObjectWithNewProperties=weavejs.api.core.ILinkableObjectWithNewProperties;var TileLayerEditor=function(_React$Component){_inherits(TileLayerEditor,_React$Component);function TileLayerEditor(props){_classCallCheck(this,TileLayerEditor);var _this=_possibleConstructorReturn(this,(TileLayerEditor.__proto__||Object.getPrototypeOf(TileLayerEditor)).call(this,props));_this.tempLayer=_weavejs.Weave.disposableChild(_this,LinkableString);_this.tempAttributions=_weavejs.Weave.disposableChild(_this,LinkableString);_this.tempProjection=_weavejs.Weave.disposableChild(_this,LinkableString);_this.tempUrl=_weavejs.Weave.disposableChild(_this,LinkableString);_this.tempLayer.addGroupedCallback(_this,_this.toProviderOptions);_this.tempAttributions.addGroupedCallback(_this,_this.toProviderOptions);_this.tempProjection.addGroupedCallback(_this,_this.toProviderOptions);_this.tempUrl.addGroupedCallback(_this,_this.toProviderOptions);_this.componentWillReceiveProps(props);return _this}_createClass(TileLayerEditor,[{key:"toProviderOptions",value:function toProviderOptions(){if(!this.props.layer)return;if(this.props.layer.provider.value==="custom"){this.props.layer.providerOptions.state={attributions:this.tempAttributions.value,url:this.tempUrl.value,projection:this.tempProjection.value}}else{this.props.layer.providerOptions.state={layer:this.tempLayer.value}}}},{key:"fromProviderOptions",value:function fromProviderOptions(){var opts=this.props.layer.providerOptions.state||{};this.tempLayer.value=opts.layer;this.tempAttributions.value=opts.attributions;this.tempUrl.value=opts.url;this.tempProjection.value=opts.projection}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props&&this.props.layer){this.props.layer.providerOptions.removeCallback(this,this.fromProviderOptions);_weavejs.Weave.getCallbacks(this.props.layer).removeCallback(this,this.forceUpdate)}_weavejs.Weave.getCallbacks(nextProps.layer).addGroupedCallback(this,this.forceUpdate);nextProps.layer.providerOptions.addGroupedCallback(this,this.fromProviderOptions);this.fromProviderOptions()}},{key:"render",value:function render(){var layers=void 0;switch(this.props.layer.provider.value){case"stamen":layers=["watercolor","toner"];break;case"mapquest":layers=["sat","osm"];break;default:layers=null;}var providerOptions=[{value:"osm",label:"OpenStreetMap"},{value:"stamen",label:"Stamen"},{value:"mapquest",label:"MapQuest"},{value:"custom",label:_weavejs.Weave.lang("Custom")}];var layerSelection=void 0;var editorFields=void 0;if(this.props.layer.provider.value==="osm"){editorFields=[[_weavejs.Weave.lang("Provider"),React.createElement(ComboBox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.layer.provider}),options:providerOptions})]]}else if(this.props.layer.provider.value==="custom"){editorFields=[[_weavejs.Weave.lang("Provider"),React.createElement(ComboBox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.layer.provider}),options:providerOptions})],[_weavejs.Weave.lang("URL"),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.tempUrl})})],[_weavejs.Weave.lang("Attribution"),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.tempAttributions})})],[_weavejs.Weave.lang("Projection"),React.createElement(StatefulTextField,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.tempProjection})})]]}else{editorFields=[[_weavejs.Weave.lang("Provider"),React.createElement(ComboBox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.layer.provider}),options:providerOptions})],[_weavejs.Weave.lang("Layer"),React.createElement(ComboBox,{ref:WeaveReactUtils.linkReactStateRef(this,{value:this.tempLayer}),options:layers?layers.map(function(name){return{label:_.startCase(name),value:name}}):[]})]]}return ReactUtils.generateTable({body:[].concat(editorFields,this.props.editableFields),classes:{td:["weave-left-cell","weave-right-cell"]}})}}]);return TileLayerEditor}(React.Component);var TileLayer=function(_AbstractLayer){_inherits(TileLayer,_AbstractLayer);function TileLayer(){_classCallCheck(this,TileLayer);var _this2=_possibleConstructorReturn(this,(TileLayer.__proto__||Object.getPrototypeOf(TileLayer)).call(this));_this2.provider=_weavejs.Weave.linkableChild(_this2,new LinkableString("osm"));_this2.providerOptions=_weavejs.Weave.linkableChild(_this2,new LinkableVariable(Object,null,{}));_this2.renderEditor=function(){return React.createElement(TileLayerEditor,{layer:_this2,editableFields:_this2.renderEditableFields()})};_this2.olLayer=new ol.layer.Tile;return _this2}_createClass(TileLayer,[{key:"getExtent",value:function getExtent(){var bounds=_get(TileLayer.prototype.__proto__||Object.getPrototypeOf(TileLayer.prototype),"getExtent",this).call(this);bounds.setCoords(this.olLayer.getExtent());return bounds}},{key:"onLayerReady",value:function onLayerReady(){_get(TileLayer.prototype.__proto__||Object.getPrototypeOf(TileLayer.prototype),"onLayerReady",this).call(this);this.provider.addGroupedCallback(this,this.onProviderChange);this.provider.addGroupedCallback(this,this.updateTileSource);this.providerOptions.addGroupedCallback(this,this.updateTileSource,true)}},{key:"onProviderChange",value:function onProviderChange(){if(this.provider.value=="stamen"){var layer=this.providerOptions.state&&this.providerOptions.state.layer;if(!layer||!_.contains(TileLayer.STAMEN_LAYERS,layer)){this.providerOptions.state=_.merge(this.providerOptions.state||{},{layer:TileLayer.STAMEN_LAYERS[0]})}}else if(this.provider.value=="mapquest"){var _layer=this.providerOptions.state&&this.providerOptions.state.layer;if(!_layer||!_.contains(TileLayer.MAPQUEST_LAYERS,_layer)){this.providerOptions.state=_.merge(this.providerOptions.state||{},{layer:TileLayer.MAPQUEST_LAYERS[0]})}}}},{key:"updateProjection",value:function updateProjection(){var proj=_Projections2.default.getProjection(this.outputProjection);if(proj){this.olLayer.setExtent(_Projections2.default.getEstimatedExtent(proj))}}},{key:"getSource",value:function getSource(){var params=_.pick(_weavejs.Weave.getState(this.providerOptions),_.identity);switch(this.provider.value){case"stamen":return new ol.source.Stamen(params);case"mapquest":return new ol.source.MapQuest(params);case"osm":return new ol.source.OSM(params);case"custom":if(params.url&&TileLayer.isXYZString(params.url)){return new ol.source.XYZ(params)}else{return new ol.source.TileWMS(params)}default:return null;}}},{key:"updateTileSource",value:function updateTileSource(){var newLayer=void 0;try{newLayer=this.getSource()}catch(e){console.error(e)}this.source=newLayer||null}},{key:"deprecatedStateMapping",get:function get(){var _this3=this;return _.merge(_get(TileLayer.prototype.__proto__||Object.getPrototypeOf(TileLayer.prototype),"deprecatedStateMapping",this),{service:{"":function _(serviceState,removeMissingDynamicObjects){if(serviceState.providerName){var providerName=void 0;var params={};switch(serviceState.providerName){case"Stamen Watercolor":providerName="stamen";params.layer="watercolor";break;case"Stamen Toner":providerName="stamen";params.layer="toner";break;case"Open MapQuest Aerial":providerName="mapquest";params.layer="sat";break;case"Open MapQuest":providerName="mapquest";params.layer="osm";break;case"Blue Marble Map":providerName="custom";params.url="http://demo.opengeo.org/geoserver/wms?layers=nasa:bluemarble";break;default:providerName="osm";break;}_this3.provider.value=providerName;_this3.providerOptions.state=params}else{_this3.provider.value="custom";var _params={};var mapping={wmsURL:"url",attributions:"attributions",projection:"projection"};for(var key in mapping){if(serviceState[key]!==undefined)_params[mapping[key]]=serviceState[key]}_weavejs.Weave.setState(_this3.providerOptions,_params,removeMissingDynamicObjects)}}}})}}],[{key:"isXYZString",value:function isXYZString(url){return url&&url.indexOf("{x}")!=-1&&url.indexOf("{y}")!=-1&&url.indexOf("{z}")!=-1}}]);return TileLayer}(_AbstractLayer3.default);exports.default=TileLayer;TileLayer.WEAVE_INFO=_weavejs.Weave.setClassInfo(TileLayer,{id:"weavejs.tool.oltool.layer.TileLayer",label:"Base map",interfaces:[ILinkableObjectWithNewProperties],deprecatedIds:["weave.visualization.plotters::WMSPlotter"]});TileLayer.STAMEN_LAYERS=["watercolor","toner"];TileLayer.MAPQUEST_LAYERS=["sat","osm"];

},{"lodash":"lodash","openlayers":"openlayers","react":"react","weaveapp/tool/oltool/Projections":99,"weaveapp/tool/oltool/layer/AbstractLayer":102,"weavejs":136}],110:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _ControlPanel=require("weaveapp/editor/ControlPanel");var _ControlPanel2=_interopRequireDefault(_ControlPanel);var _HierarchyExplorer=require("weaveapp/ui/HierarchyExplorer");var _HierarchyExplorer2=_interopRequireDefault(_HierarchyExplorer);var _ButtonGroupBar=require("weaveapp/ui/ButtonGroupBar");var _ButtonGroupBar2=_interopRequireDefault(_ButtonGroupBar);var _ColumnSelector=require("weaveapp/ui/ColumnSelector");var _ColumnSelector2=_interopRequireDefault(_ColumnSelector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ILinkableHashMap=weavejs.api.core.ILinkableHashMap;var WeaveRootDataTreeNode=weavejs.data.hierarchy.WeaveRootDataTreeNode;var ReferencedColumn=weavejs.data.column.ReferencedColumn;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var IColumnReference=weavejs.api.data.IColumnReference;var ColumnUtils=weavejs.data.ColumnUtils;var SmartComponent=weavejs.ui.SmartComponent;var Button=weavejs.ui.Button;var AttributeSelector=function(_SmartComponent){_inherits(AttributeSelector,_SmartComponent);function AttributeSelector(props){_classCallCheck(this,AttributeSelector);var _this=_possibleConstructorReturn(this,(AttributeSelector.__proto__||Object.getPrototypeOf(AttributeSelector)).call(this,props));_this.onButtonBarClick=function(event){var name=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var selectedAttribute=_this.props.attributes.get(name);_this.setState({selectedAttributeName:name})};_this.onAddSelected=function(){_this.addColumns(_this.selectedColumnRefs)};_this.onSelectAll=function(){if(_this.hierarchyExplorer.selectedFolder){var children=_this.hierarchyExplorer.selectedFolder.getChildren();_this.hierarchyExplorer.selectedItems=children.filter(function(node){return!node.isBranch()})}};_this.onDoubleClick=function(item){var ref=_weavejs.Weave.AS(item,IColumnReference);if(ref)_this.addColumns([ref])};_this.onSelectColumn=function(selectedItems){var ref=_weavejs.Weave.AS(selectedItems[0],IColumnReference);if(ref&&!_this.usingHashMap){var meta=ref.getColumnMetadata();if(meta){var dc=ColumnUtils.hack_findInternalDynamicColumn(_this.selectedAttribute);if(dc)dc.requestLocalObject(ReferencedColumn).setColumnReference(ref.getDataSource(),meta)}}if(_this.usingHashMap){_this.forceUpdate()}};_this.selectableAttributeComponentKey=0;_this.state={selectedAttributeName:_this.props.attributeName};_this.componentWillReceiveProps(props);return _this}_createClass(AttributeSelector,[{key:"componentDidMount",value:function componentDidMount(){this.forceUpdate()}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var nextAttribute=nextProps.attributes.get(this.state.selectedAttributeName);var attribute=this.props.attributes.get(this.props.attributeName);if(nextAttribute!=attribute||!this.rootNode){_weavejs.Weave.getCallbacks(attribute).removeCallback(this,this.forceUpdate);_weavejs.Weave.getCallbacks(nextAttribute).addGroupedCallback(this,this.forceUpdate);if(this.rootNode)_weavejs.Weave.getCallbacks(this.rootNode).removeCallback(this,this.forceUpdate);this.rootNode=new WeaveRootDataTreeNode(_weavejs.Weave.getRoot(nextAttribute));_weavejs.Weave.getCallbacks(this.rootNode).addGroupedCallback(this,this.forceUpdate)}}},{key:"componentWillUpdate",value:function componentWillUpdate(nextProps,nextState){if(this.state.selectedAttributeName!=nextState.selectedAttributeName||this.props.attributes!=nextProps.attributes){var selectedAttribute=nextProps.attributes.get(nextState.selectedAttributeName);var previousSelectedAttribute=this.props.attributes&&this.props.attributes.get(this.state.selectedAttributeName);if(_weavejs.Weave.isLinkable(previousSelectedAttribute)){_weavejs.Weave.getCallbacks(previousSelectedAttribute).removeCallback(this,this.forceUpdate)}if(_weavejs.Weave.isLinkable(selectedAttribute)){_weavejs.Weave.getCallbacks(selectedAttribute).addGroupedCallback(this,this.forceUpdate)}}}},{key:"addColumns",value:function addColumns(refs){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=refs[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var ref=_step.value;var meta=ref&&ref.getColumnMetadata();if(meta){var lhm=_weavejs.Weave.AS(this.selectedAttribute,ILinkableHashMap);if(lhm)lhm.requestObject(null,ReferencedColumn).setColumnReference(ref.getDataSource(),meta)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"getSelectedTreeNodes",value:function getSelectedTreeNodes(){var selectedAttribute=this.props.attributes.get(this.state.selectedAttributeName);var columns=[];if(this.usingHashMap){columns=selectedAttribute.getObjects(IAttributeColumn)}else{columns.push(selectedAttribute)}return columns.map(function(column){return ColumnUtils.hack_findHierarchyNode(column)}).filter(_.identity)}},{key:"render",value:function render(){var _this2=this;var controllerStyle={justifyContent:"flex-end",background:"#F8F8F8",padding:"4px"};var attributeNames=Array.from(this.props.attributes.keys());return React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1}},attributeNames.length>1?React.createElement(_ButtonGroupBar2.default,{activeButton:this.props.attributeName,items:attributeNames,clickHandler:this.onButtonBarClick}):null,React.createElement(_ColumnSelector2.default,{key:this.selectableAttributeComponentKey++,style:{flex:null},attributeName:this.state.selectedAttributeName,attributes:this.props.attributes}),React.createElement(_HierarchyExplorer2.default,{skipSelections:this.usingHashMap,ref:function ref(c){if(c)_this2.hierarchyExplorer=c},root:this.rootNode,onSelect:this.onSelectColumn,initialSelectedItems:this.getSelectedTreeNodes(),onDoubleClick:this.usingHashMap?this.onDoubleClick:null}),this.usingHashMap?React.createElement(HBox,{className:"weave-padded-hbox",style:controllerStyle},React.createElement(Button,{disabled:!(this.hierarchyExplorer&&this.hierarchyExplorer.selectedFolder),onClick:this.onSelectAll},_weavejs.Weave.lang("Select All")),React.createElement(Button,{disabled:!this.selectedColumnRefs.length,style:{marginLeft:8},onClick:this.onAddSelected},_weavejs.Weave.lang("Add Selected"))):null)}},{key:"usingHashMap",get:function get(){return _weavejs.Weave.IS(this.selectedAttribute,ILinkableHashMap)}},{key:"selectedAttribute",get:function get(){return this.props.attributes.get(this.state.selectedAttributeName)}},{key:"selectedColumnRefs",get:function get(){if(!this.hierarchyExplorer||!this.hierarchyExplorer.selectedItems)return[];return this.hierarchyExplorer.selectedItems.map(function(value){return _weavejs.Weave.AS(value,IColumnReference)}).filter(_.identity)}}],[{key:"openInstance",value:function openInstance(context,attributeName,attributes){var weave=_weavejs.Weave.getWeave(attributes.get(attributeName));return _ControlPanel2.default.openInstance(weave,AttributeSelector,{context:context,title:_weavejs.Weave.lang("Attribute Selector")},{attributeName:attributeName,attributes:attributes})}}]);return AttributeSelector}(SmartComponent);exports.default=AttributeSelector;

},{"lodash":"lodash","react":"react","weaveapp/editor/ControlPanel":30,"weaveapp/ui/ButtonGroupBar":112,"weaveapp/ui/ColumnSelector":116,"weaveapp/ui/HierarchyExplorer":120,"weavejs":136}],111:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var _DataTable=require("weaveapp/ui/DataTable");var _DataTable2=_interopRequireDefault(_DataTable);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BinNamesList=function(_React$Component){_inherits(BinNamesList,_React$Component);function BinNamesList(props){_classCallCheck(this,BinNamesList);var _this=_possibleConstructorReturn(this,(BinNamesList.__proto__||Object.getPrototypeOf(BinNamesList)).call(this,props));if(_this.props.binningDefinition){_weavejs.Weave.getCallbacks(_this.props.binningDefinition).addGroupedCallback(_this,_this.forceUpdate)}return _this}_createClass(BinNamesList,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.binningDefinition!==nextProps.binningDefinition){if(this.props.binningDefinition)_weavejs.Weave.getCallbacks(this.props.binningDefinition).removeCallback(this,this.forceUpdate);if(nextProps.binningDefinition)_weavejs.Weave.getCallbacks(nextProps.binningDefinition).addGroupedCallback(this,this.forceUpdate)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.props.binningDefinition)_weavejs.Weave.getCallbacks(this.props.binningDefinition).removeCallback(this,this.forceUpdate)}},{key:"render",value:function render(){var binDef=this.props.binningDefinition;var rows=[];if(binDef){rows=binDef.getBinNames().map(function(binName,index){return{id:index,value:binName}})}var columnTitles={id:"Key",value:"Bin names"};return React.createElement(_DataTable2.default,{columnIds:["value"],idProperty:"id",rows:rows,columnTitles:columnTitles,headerHeight:this.props.showHeaderRow?undefined:0,allowResizing:false,evenlyExpandRows:true,enableHover:false,enableSelection:false})}}]);return BinNamesList}(React.Component);exports.default=BinNamesList;BinNamesList.defaultProps={showHeaderRow:true,binningDefinition:null};

},{"react":"react","weaveapp/ui/DataTable":117,"weavejs":136}],112:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var Button=weavejs.ui.Button;var SmartComponent=weavejs.ui.SmartComponent;var ButtonGroupBar=function(_SmartComponent){_inherits(ButtonGroupBar,_SmartComponent);function ButtonGroupBar(props){_classCallCheck(this,ButtonGroupBar);var _this=_possibleConstructorReturn(this,(ButtonGroupBar.__proto__||Object.getPrototypeOf(ButtonGroupBar)).call(this,props));_this.clickHandler=function(label,index,event){if(_this.props.clickHandler){_this.props.clickHandler(event,label,index)}_this.setState({activeButton:index})};_this.state={activeButton:_this.props.activeButton?_this.props.activeButton:0};return _this}_createClass(ButtonGroupBar,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.activeButton!=nextProps.activeButton){this.setState({activeButton:nextProps.activeButton})}}},{key:"render",value:function render(){var barStyle=_.merge({},this.props.style,{display:"inline-flex",overflow:"hidden"});var buttons=void 0;buttons=this.props.items.map(function(label,index){var buttonStyle={borderRadius:0,border:"none"};buttonStyle=this.props.buttonStyle?_.merge({},this.props.buttonStyle,buttonStyle):buttonStyle;if(index==this.state.activeButton||label==this.state.activeButton){if(this.props.activeButtonStyle){buttonStyle=_.merge(buttonStyle,this.props.activeButtonStyle)}else{buttonStyle.color="white";buttonStyle.backgroundColor="grey"}}return React.createElement(Button,{style:buttonStyle,onClick:this.clickHandler.bind(this,label,index),key:index},label)},this);return React.createElement(HBox,{style:{justifyContent:"center"}},React.createElement("div",{className:"weave-buttonGroupBar",style:barStyle},buttons))}}]);return ButtonGroupBar}(SmartComponent);exports.default=ButtonGroupBar;

},{"lodash":"lodash","react":"react","weavejs":136}],113:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactColor=require("react-color");var _reactColor2=_interopRequireDefault(_reactColor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ReactUtils=weavejs.util.ReactUtils;var HBox=weavejs.ui.flexbox.HBox;var Button=weavejs.ui.Button;var ColorPicker=function(_React$Component){_inherits(ColorPicker,_React$Component);function ColorPicker(props){_classCallCheck(this,ColorPicker);var _this=_possibleConstructorReturn(this,(ColorPicker.__proto__||Object.getPrototypeOf(ColorPicker)).call(this,props));_this.handleClick=function(event){if(_this.popup){_this.handleClose()}else{var clientRect=_this.element.getBoundingClientRect();var style={position:"absolute"};var isAbove=window.innerHeight<=clientRect.bottom+241.75;var isLeft=window.innerWidth<=clientRect.left+200;var direction=_this.props.direction?_this.props.direction:ColorPicker.BOTTOM_RIGHT;if(direction==ColorPicker.BOTTOM_LEFT){if(isAbove){style.top=clientRect.top-241.75}else{style.top=clientRect.bottom}style.left=clientRect.right-225}else if(direction==ColorPicker.BOTTOM_RIGHT){if(isAbove){style.top=clientRect.top-241.75}else{style.top=clientRect.bottom}if(isLeft){style.left=clientRect.right-225}else{style.left=clientRect.left}}else if(direction==ColorPicker.TOP_RIGHT){style.top=clientRect.top-241.75;if(isLeft){style.left=clientRect.right-225}else{style.left=clientRect.left}}else if(direction==ColorPicker.TOP_LEFT){style.top=clientRect.top-241.75;style.left=clientRect.right-225}_this.popup=ReactUtils.openPopup(_this,React.createElement(HBox,{style:style,onClick:function onClick(event){event.nativeEvent.stopImmediatePropagation()}},React.createElement(_reactColor2.default,{color:_this.state.hexColor,position:"below",display:true,onChange:_this.handleChange,onClose:_this.handleClose,type:"sketch"})));ReactUtils.getDocument(_this).addEventListener("click",_this.handleClose);_this.props.onClick&&_this.props.onClick(_this.state.hexColor);_this.setState({buttonLabel:"close"})}};_this.handleClose=function(){if(_this.element){_this.setState({buttonLabel:_this.props.buttonLabel?_this.props.buttonLabel:"Add color"});ReactUtils.closePopup(_this.popup);_this.popup=null}ReactUtils.getDocument(_this).removeEventListener("click",_this.handleClose);_this.props.onClose&&_this.props.onClose(_this.state.hexColor)};_this.handleChange=function(color){if(_this.popup){_this.setState({hexColor:color.hex});_this.props.onChange&&_this.props.onChange(color.hex)}};_this.state={hexColor:props.hexColor||"#FFFFFF",buttonLabel:props.buttonLabel};_this.handleClick=_this.handleClick.bind(_this);_this.handleClose=_this.handleClose.bind(_this);_this.handleChange=_this.handleChange.bind(_this);return _this}_createClass(ColorPicker,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.hexColor!=nextProps.hexColor)this.setState({hexColor:nextProps.hexColor});if(this.props.buttonLabel!=nextProps.buttonLabel)this.setState({buttonLabel:nextProps.buttonLabel})}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.popup){ReactUtils.closePopup(this.popup);this.popup=null}ReactUtils.getDocument(this).removeEventListener("click",this.handleClose)}},{key:"render",value:function render(){var _this2=this;var swatchStyle={padding:"4px",background:"#fff",borderRadius:"2px",border:"1px solid rgba(0,0,0,.1)",display:this.props.style&&this.props.style.width&&this.props.style.height?"inline-block":"block",width:"100%",height:"100%",cursor:"pointer"};var colorStyle={borderRadius:"2px",width:"100%",height:"100%",background:this.state.hexColor};var ui=null;var styleObject=this.props.style?this.props.style:{};if(this.props.buttonMode){styleObject.width=null;styleObject.height=null;var label=this.state.buttonLabel?this.state.buttonLabel:"Add color";ui=React.createElement("div",{style:styleObject},React.createElement("div",{ref:function ref(elt){return _this2.element=elt}},React.createElement(Button,{onClick:this.handleClick},label)))}else{if(!this.props.noDefaultSize){styleObject.width=styleObject.width?styleObject.width:"30px";styleObject.height=styleObject.height?styleObject.height:"20px"}ui=React.createElement("div",{style:styleObject},React.createElement("div",{ref:function ref(elt){return _this2.element=elt},style:swatchStyle,onClick:this.handleClick},React.createElement("div",{style:colorStyle})))}return ui}}]);return ColorPicker}(React.Component);exports.default=ColorPicker;ColorPicker.BOTTOM_LEFT="bottom left";ColorPicker.BOTTOM_RIGHT="bottom right";ColorPicker.TOP_LEFT="top left";ColorPicker.TOP_RIGHT="top right";

},{"react":"react","react-color":"react-color"}],114:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ColorRampComponent=function(_React$Component){_inherits(ColorRampComponent,_React$Component);function ColorRampComponent(props){_classCallCheck(this,ColorRampComponent);return _possibleConstructorReturn(this,(ColorRampComponent.__proto__||Object.getPrototypeOf(ColorRampComponent)).call(this,props))}_createClass(ColorRampComponent,[{key:"render",value:function render(){var hexColors=this.props.ramp||[];var direction=this.props.direction||"right";var style=this.props.style?this.props.style:{};if(hexColors.length>1)style["background"]="linear-gradient(to "+direction+","+hexColors.join(", ")+")";else style["background"]=hexColors[0];return React.createElement("div",_extends({},this.props,{style:style}))}}]);return ColorRampComponent}(React.Component);exports.default=ColorRampComponent;

},{"react":"react"}],115:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _DataTable=require("weaveapp/ui/DataTable");var _DataTable2=_interopRequireDefault(_DataTable);var _ColorRampComponent=require("weaveapp/ui/ColorRampComponent");var _ColorRampComponent2=_interopRequireDefault(_ColorRampComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var Label=weavejs.ui.flexbox.Label;var StandardLib=weavejs.util.StandardLib;var ColorRampList=function(_React$Component){_inherits(ColorRampList,_React$Component);function ColorRampList(props){_classCallCheck(this,ColorRampList);var _this=_possibleConstructorReturn(this,(ColorRampList.__proto__||Object.getPrototypeOf(ColorRampList)).call(this,props));_this.columnTitles={};_this.handleTableSelection=function(id){if(id.length){var selectedRampConfig=_this.props.allColorRamps.find(function(v){return v.name==id[0]});if(selectedRampConfig)_this.props.onChange&&_this.props.onChange(selectedRampConfig.colors)}};_this.columnTitles["id"]="Key";_this.columnTitles["value"]=_weavejs.Weave.lang("Color scale presets");_this.state={selectedColors:props.selectedColors};return _this}_createClass(ColorRampList,[{key:"getRampNameFromRamp",value:function getRampNameFromRamp(selectedColors){if(selectedColors){var selectedRampConfig=this.props.allColorRamps.find(function(v){return _.isEqual(v.colors,selectedColors)});if(selectedRampConfig)return selectedRampConfig.name;return""}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.selectedColors){this.setState({selectedColors:nextProps.selectedColors})}}},{key:"render",value:function render(){var selectedId=this.getRampNameFromRamp(this.state.selectedColors);var rows=this.props.allColorRamps.map(function(colorRampConfig){var row={};var rampRow=React.createElement(HBox,{padded:true,style:{flex:1}},React.createElement(_ColorRampComponent2.default,{style:{flex:1},ramp:colorRampConfig.colors.map(StandardLib.getHexColor)}),React.createElement(Label,{style:{flex:1},children:colorRampConfig.name}));row["id"]=colorRampConfig.name;row["value"]=rampRow;return row});return React.createElement(_DataTable2.default,{columnIds:["value"],idProperty:"id",rows:rows,columnTitles:this.columnTitles,selectedIds:[selectedId],allowResizing:false,evenlyExpandRows:true,onSelection:this.handleTableSelection})}}]);return ColorRampList}(React.Component);exports.default=ColorRampList;ColorRampList.defaultProps={allColorRamps:[]};

},{"lodash":"lodash","react":"react","weaveapp/ui/ColorRampComponent":114,"weaveapp/ui/DataTable":117,"weavejs":136}],116:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ReactUtils=weavejs.util.ReactUtils;var HBox=weavejs.ui.flexbox.HBox;var ColumnUtils=weavejs.data.ColumnUtils;var IColumnWrapper=weavejs.api.data.IColumnWrapper;var HierarchyUtils=weavejs.data.hierarchy.HierarchyUtils;var ILinkableHashMap=weavejs.api.core.ILinkableHashMap;var ReferencedColumn=weavejs.data.column.ReferencedColumn;var IAttributeColumn=weavejs.api.data.IAttributeColumn;var WeaveRootDataTreeNode=weavejs.data.hierarchy.WeaveRootDataTreeNode;var ComboBox=weavejs.ui.ComboBox;var DynamicComponent=weavejs.ui.DynamicComponent;var ColumnSelector=function(_React$Component){_inherits(ColumnSelector,_React$Component);function ColumnSelector(props){_classCallCheck(this,ColumnSelector);var _this=_possibleConstructorReturn(this,(ColumnSelector.__proto__||Object.getPrototypeOf(ColumnSelector)).call(this,props));_this.setColumn=function(columnReference){if(_this.comboBox&&ReactUtils.hasFocus(_this.comboBox)){var dynamicColumn=ColumnUtils.hack_findInternalDynamicColumn(_this.props.attributes.get(_this.props.attributeName));if(columnReference){var internalReferencedColumn=dynamicColumn.requestLocalObject(ReferencedColumn);internalReferencedColumn.setColumnReference(columnReference.getDataSource(),columnReference.getColumnMetadata())}else{dynamicColumn.removeObject()}}};_this.setColumnInHashmap=function(selectedOptions){if(_this.comboBox&&ReactUtils.hasFocus(_this.comboBox)){ColumnUtils.replaceColumnsInHashMap(_this.columnsHashmap,selectedOptions)}};_this.componentWillReceiveProps(props);return _this}_createClass(ColumnSelector,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.weaveRootTreeNode)_weavejs.Weave.getCallbacks(this.weaveRootTreeNode).removeCallback(this,this.forceUpdate);this.weaveRoot=_weavejs.Weave.getRoot(nextProps.attributes.get(nextProps.attributeName));this.weaveRootTreeNode=this.weaveRoot&&new WeaveRootDataTreeNode(this.weaveRoot);if(this.weaveRootTreeNode)_weavejs.Weave.getCallbacks(this.weaveRootTreeNode).addGroupedCallback(this,this.forceUpdate)}},{key:"render",value:function render(){var _this2=this;var attribute=this.props.attributes.get(this.props.attributeName);var dependencies=ColumnSelector.getDataSourceDependencies(attribute);dependencies.push(attribute);DynamicComponent.setDependencies(this,dependencies);var attribute_ilhm_or_icw=this.props.attributes.get(this.props.attributeName);var dropDownStyle={borderBottomRightRadius:0,borderTopRightRadius:0};var buttonStyle={borderBottomLeftRadius:0,borderTopLeftRadius:0,borderLeft:"none"};if(_weavejs.Weave.IS(attribute_ilhm_or_icw,IColumnWrapper)){var _attribute=attribute_ilhm_or_icw;var node=ColumnUtils.hack_findHierarchyNode(_attribute,true);if(node)this.lastActiveNode=node;var options=[];var dataSource=node&&node.getDataSource();var rootNode=dataSource&&dataSource.getHierarchyRoot();var parentNode=rootNode&&HierarchyUtils.findParentNode(rootNode,dataSource,node.getColumnMetadata());var header=React.createElement("span",{style:{fontWeight:"bold",fontSize:"small"}},parentNode&&parentNode.getLabel());if(this.lastActiveNode){options=HierarchyUtils.findSiblingNodes(this.lastActiveNode.getDataSource(),this.lastActiveNode.getColumnMetadata()).map(function(node){return{value:node,label:node.getLabel()}})}if(options.length==0){options=ColumnUtils.findFirstDataSet(this.weaveRoot).concat().map(function(node){return{value:node,label:node.getLabel()}})}return React.createElement(HBox,{overflow:true,style:_.merge({flex:1},this.props.style)},React.createElement(ComboBox,{noneOption:{label:"(None)",value:null},ref:function ref(c){return _this2.comboBox=c},title:_weavejs.Weave.lang("Change column"),style:dropDownStyle,searchable:true,value:node?{label:node.getLabel(),value:node}:null,options:options,onChange:this.setColumn,header:header}))}else if(_weavejs.Weave.IS(attribute_ilhm_or_icw,ILinkableHashMap)){var _attribute2=attribute_ilhm_or_icw;var value=[];var nodes=new Set;var siblings=[];var columns=this.columnsHashmap.getObjects(IAttributeColumn);if(columns.length){columns.forEach(function(column,index){var node=ColumnUtils.hack_findHierarchyNode(column,true);if(node){_this2.lastActiveNode=node;value.push({label:node.getLabel(),value:node})}if(!_this2.lastActiveNode)return;var columnSiblings=HierarchyUtils.findSiblingNodes(_this2.lastActiveNode.getDataSource(),node.getColumnMetadata());columnSiblings.forEach(function(siblingNode){nodes.add(siblingNode)})})}else if(this.lastActiveNode){HierarchyUtils.findSiblingNodes(this.lastActiveNode.getDataSource(),this.lastActiveNode.getColumnMetadata()).forEach(function(node){nodes.add(node)})}if(nodes.size==0){ColumnUtils.findFirstDataSet(this.weaveRoot).concat().map(function(node){nodes.add(node)})}if(this.props.showAsList){var listStyle={minHeight:"200px",overflow:"auto",flex:1};return React.createElement("div",null)}else{return React.createElement(HBox,{overflow:true,style:_.merge({flex:1},this.props.style)},React.createElement(ComboBox,{ref:function ref(c){return _this2.comboBox=c},type:"multiple",searchable:true,style:dropDownStyle,value:value,noneOption:{label:"(None)",value:[]},options:Array.from(nodes.keys()).map(function(node){return{label:node.getLabel(),value:node}}),onChange:this.setColumnInHashmap}))}}}},{key:"columnsHashmap",get:function get(){return this.props.attributes.get(this.props.attributeName)}}],[{key:"findSelectableAttributes",value:function findSelectableAttributes(attribute){var defaultLabel=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"Data";var SA="selectableAttributes";var ancestor=attribute;while(ancestor&&!(ancestor[SA]instanceof Map)){ancestor=_weavejs.Weave.getOwner(ancestor)}if(ancestor){var map=ancestor[SA];if(map){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=map.entries()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step$value=_slicedToArray(_step.value,2),key=_step$value[0],value=_step$value[1];if(value===attribute)return[key,map]}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}return[defaultLabel,new Map().set(defaultLabel,attribute)]}},{key:"getDataSourceDependencies",value:function getDataSourceDependencies(attribute){var dataSources=void 0;var ilhm=_weavejs.Weave.AS(attribute,ILinkableHashMap);var icw=_weavejs.Weave.AS(attribute,IColumnWrapper);if(icw){dataSources=ColumnUtils.getDataSources(icw)}else if(ilhm){dataSources=_.flatten(ilhm.getObjects(IAttributeColumn).map(ColumnUtils.getDataSources)).filter(_.identity)}return dataSources}}]);return ColumnSelector}(React.Component);exports.default=ColumnSelector;

},{"lodash":"lodash","react":"react","weavejs":136}],117:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DataTable=exports.SortHeaderCell=exports.SortTypes=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _fixedDataTable=require("fixed-data-table");var FixedDataTable=_interopRequireWildcard(_fixedDataTable);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var Label=weavejs.ui.flexbox.Label;var Cell=FixedDataTable.Cell;var Column=FixedDataTable.Column;var Table=FixedDataTable.Table;var SmartComponent=weavejs.ui.SmartComponent;var ResizingDiv=weavejs.ui.ResizingDiv;var SortTypes=exports.SortTypes={ASC:"ASC",DESC:"DESC"};var SortHeaderCell=exports.SortHeaderCell=function(_SmartComponent){_inherits(SortHeaderCell,_SmartComponent);function SortHeaderCell(props){_classCallCheck(this,SortHeaderCell);var _this=_possibleConstructorReturn(this,(SortHeaderCell.__proto__||Object.getPrototypeOf(SortHeaderCell)).call(this,props));_this.defaultProps={disableSort:false};_this.onSortChange=function(e){e.preventDefault();if(_this.props.onSortChange&&!_this.props.disableSort){_this.props.onSortChange(_this.props.columnKey,_this.props.sortDirection?_this.reverseSortDirection(_this.props.sortDirection):SortTypes.DESC)}};_this.reverseSortDirection=function(sortDirection){return sortDirection===SortTypes.DESC?SortTypes.ASC:SortTypes.DESC};return _this}_createClass(SortHeaderCell,[{key:"render",value:function render(){var sortArrow="";if(this.props.sortDirection==SortTypes.DESC)sortArrow=React.createElement(SortHeaderCell.DownArrow,null);if(this.props.sortDirection==SortTypes.ASC)sortArrow=React.createElement(SortHeaderCell.UpArrow,null);return React.createElement(Cell,this.props,React.createElement(HBox,{padded:true,onClick:this.onSortChange},sortArrow,React.createElement(Label,{style:{paddingLeft:sortArrow?4:null,flex:1},children:this.props.children})))}}],[{key:"UpArrow",value:function UpArrow(props){return React.createElement("span",{style:{alignSelf:"stretch",display:"flex",cursor:"pointer"}},React.createElement("i",{className:"fa fa-play fa-fw fa-rotate-270",style:{alignSelf:"center",fontSize:"60%",paddingRight:2}}))}},{key:"DownArrow",value:function DownArrow(props){return React.createElement("span",{style:{alignSelf:"stretch",display:"flex",cursor:"pointer"}},React.createElement("i",{className:"fa fa-play fa-fw fa-rotate-90",style:{alignSelf:"center",fontSize:"60%",paddingRight:2}}))}}]);return SortHeaderCell}(SmartComponent);var DataTable=exports.DataTable=function(_SmartComponent2){_inherits(DataTable,_SmartComponent2);function DataTable(props){_classCallCheck(this,DataTable);var _this2=_possibleConstructorReturn(this,(DataTable.__proto__||Object.getPrototypeOf(DataTable)).call(this,props));_this2.getRowClass=function(index){var id=_this2.getId(index);if(!id||!_this2.props.enableHover||!_this2.props.enableSelection)return"";if(_this2.props.enableHover&&_this2.props.enableSelection&&_.includes(_this2.state.probedIds,id)&&_.includes(_this2.state.selectedIds,id)){return"table-row-probed-selected"}else if(_this2.props.enableHover&&_.includes(_this2.state.probedIds,id)){return"table-row-probed"}else if(_this2.props.enableSelection&&_.includes(_this2.state.selectedIds,id)){return"table-row-selected"}};_this2.onColumnResizeEndCallback=function(newColumnWidth,columnKey){var columnWidths=_.cloneDeep(_this2.state.columnWidths);columnWidths[columnKey]=newColumnWidth;_this2.setState({columnWidths:columnWidths})};_this2.onMouseEnter=function(event,index){var id=_this2.getId(index);var probedIds=id?[id]:[];if(_this2.props.onHover){_this2.props.onHover(probedIds)}else{_this2.setState({probedIds:probedIds})}};_this2.onMouseLeave=function(event,index){if(_this2.props.onHover){_this2.props.onHover([])}else{_this2.setState({probedIds:[]})}};_this2.onMouseDown=function(event,index){if(event.button!==0)return;var selectedIds=_this2.state.selectedIds;var id=_this2.getId(index);if(!id)return;var keyLocation=selectedIds.indexOf(id);if((event.ctrlKey||event.metaKey)&&_this2.props.multiple){if(_.includes(selectedIds,id)){selectedIds.splice(keyLocation,1)}else{selectedIds.push(id)}_this2.lastClicked=index}else if(event.shiftKey&&_this2.props.multiple){selectedIds=[];if(_this2.lastClicked!=null){var start=_this2.lastClicked;var end=index;if(start>end){var temp=start;start=end;end=temp}for(var i=start;i<=end;i++){id=_this2.getId(i);if(id)selectedIds.push(id)}}}else{if(selectedIds.length==1&&selectedIds[0]==id&&_this2.props.allowClear){selectedIds=[];_this2.lastClicked=null}else{selectedIds=[id];_this2.lastClicked=index}}_this2.setState({selectedIds:selectedIds});if(_this2.props.onSelection)_this2.props.onSelection(selectedIds);_this2.forceUpdate()};_this2.updateSortDirection=function(columnKey,sortDirection){var orderOfRows=_this2.state.orderOfRows;_this2.sortColumnIndices(columnKey,sortDirection,orderOfRows);_this2.setState({sortId:columnKey,sortDirection:sortDirection,orderOfRows:orderOfRows})};_this2.sortColumnIndices=function(columnKey,sortDirection,orderOfRows){if(_this2.props.onSortCallback){_this2.props.onSortCallback(columnKey,sortDirection)}else{orderOfRows.sort(function(indexA,indexB){var sortVal=_this2.props.sortFunction.call(_this2,indexA,indexB,columnKey);if(sortVal!==0&&sortDirection===SortTypes.ASC)sortVal=sortVal*-1;return sortVal})}};_this2.handleResize=function(newSize){_this2.setState({width:newSize.width,height:newSize.height})};_this2.renderCell=function(props){var value=_this2.getValue(props.rowIndex,props.columnKey);var rowId=_this2.getId(props.rowIndex);var handleDoubleClick=function handleDoubleClick(event){if(_this2.props.onCellDoubleClick)_this2.props.onCellDoubleClick(rowId,props.columnKey)};return React.createElement(Cell,_extends({key:props.rowIndex+"#"+props.columnKey},props),React.createElement("div",{style:{marginLeft:-4,paddingLeft:4,marginTop:-4,paddingTop:4,width:props.width,height:props.height},onDoubleClick:handleDoubleClick},value))};var orderOfRows=_this2.props.rows.map(function(row,index){return index});var headerIndices=[];if(props.selectedIds&&props.probedIds)_this2.lastClicked=props.selectedIds.length-1;_this2.state={columnWidths:{},orderOfRows:orderOfRows,selectedIds:props.selectedIds||[],probedIds:props.probedIds||[],sortId:props.sortId,sortDirection:props.sortDirection,width:props.width,height:props.height};_this2.setIdPropertyGetter(props);return _this2}_createClass(DataTable,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var newState={};this.setIdPropertyGetter(nextProps);if(nextProps.rows.length!==this.state.orderOfRows.length||this.props.sortDirection!==nextProps.sortDirection)newState.orderOfRows=nextProps.rows.map(function(row,index){return index});if(nextProps.probedIds)newState.probedIds=nextProps.probedIds.concat([]);if(nextProps.selectedIds)newState.selectedIds=nextProps.selectedIds.concat([]);if(nextProps.sortId){newState.sortId=nextProps.sortId}if(this.props.sortDirection!==nextProps.sortDirection){newState.sortDirection=nextProps.sortDirection}this.setState(newState)}},{key:"setIdPropertyGetter",value:function setIdPropertyGetter(props){if(props.idProperty instanceof Function){this.idPropertyGetter=props.idProperty}else{var idProperty=props.idProperty;this.idPropertyGetter=function(row){return props.getCellValue(row,idProperty)}}}},{key:"moveSelectedToTop",value:function moveSelectedToTop(){var rowIds=this.props.rows.map(this.idPropertyGetter);var orderOfRows=this.state.orderOfRows;var selectedRowIdsIndices=[];this.state.selectedIds.map(function(id,index){var idIndex=_.indexOf(rowIds,id);selectedRowIdsIndices.push(idIndex);var rowIndex=orderOfRows.indexOf(idIndex);orderOfRows.splice(rowIndex,1,NaN)});orderOfRows=orderOfRows.filter(function(id){if(isNaN(id)){return false}return true});this.setState({orderOfRows:selectedRowIdsIndices.concat(orderOfRows)});if(this.props.onSelection)this.props.onSelection(this.state.selectedIds);this.forceUpdate()}},{key:"getValue",value:function getValue(index,columnKey){if(columnKey===null){return this.getId(index)}var row=this.props.rows[this.state.orderOfRows[index]];return row&&this.props.getCellValue(row,columnKey)}},{key:"getId",value:function getId(index){var row=this.props.rows[this.state.orderOfRows[index]];return row&&this.idPropertyGetter(row)}},{key:"getColumnTitle",value:function getColumnTitle(columnId){if(!this.props.columnTitles)return"";if(typeof this.props.columnTitles==="function"){return this.props.columnTitles(columnId)}else{return this.props.columnTitles[columnId]}}},{key:"render",value:function render(){var _this3=this;var tableContainer={flex:1,whiteSpace:"nowrap"};var evenWidth;var columnIds=this.props.columnIds.concat([]);if(this.props.evenlyExpandRows&&this.state.width>0)evenWidth=Math.max(this.state.width/columnIds.length,this.props.initialColumnWidth);var columns=columnIds.map(function(id,index){return React.createElement(Column,{allowCellsRecycling:true,key:index,columnKey:id,header:React.createElement(SortHeaderCell,{onSortChange:_this3.updateSortDirection,sortDirection:id==_this3.state.sortId?_this3.state.sortDirection:"NONE",disableSort:_this3.props.disableSort,columnKey:id},_this3.getColumnTitle(id)),cell:_this3.renderCell,width:_this3.state.columnWidths[id]||(_this3.props.evenlyExpandRows?evenWidth||_this3.props.initialColumnWidth:_this3.props.initialColumnWidth),isResizable:_this3.props.allowResizing})});return React.createElement(ResizingDiv,{className:this.props.showBottomBorder?null:"weave-disableBottomBorder",style:tableContainer,onResize:this.handleResize},this.state.width&&this.state.height?React.createElement(Table,{rowsCount:this.props.rows.length,width:this.state.width,height:this.state.height,headerHeight:this.props.headerHeight,rowHeight:this.props.rowHeight,onRowMouseDown:this.onMouseDown,onRowMouseEnter:this.onMouseEnter,onRowMouseLeave:this.onMouseLeave,rowClassNameGetter:this.getRowClass,onColumnResizeEndCallback:this.onColumnResizeEndCallback,isColumnResizing:false},columns):"")}}],[{key:"defaultGetCellValue",value:function defaultGetCellValue(row,columnKey){return row&&row[columnKey]}}]);return DataTable}(SmartComponent);DataTable.defaultProps={idProperty:"",rows:[],getCellValue:DataTable.defaultGetCellValue,columnTitles:{},columnIds:[],enableHover:true,enableSelection:true,disableSort:false,rowHeight:30,headerHeight:30,initialColumnWidth:85,allowResizing:true,evenlyExpandRows:true,showBottomBorder:true,allowClear:true,multiple:true,sortFunction:function sortFunction(indexA,indexB,columnKey){var valueA=this.getValue(indexA,columnKey);var valueB=this.getValue(indexB,columnKey);valueA=typeof valueA=="string"?valueA:valueA&&valueA.value;valueB=typeof valueB=="string"?valueB:valueA&&valueB.value;var sortVal=0;if(valueA>valueB)sortVal=1;if(valueA<valueB)sortVal=-1;return sortVal}};var ObjectDataTable=function(_DataTable){_inherits(ObjectDataTable,_DataTable);function ObjectDataTable(){_classCallCheck(this,ObjectDataTable);return _possibleConstructorReturn(this,(ObjectDataTable.__proto__||Object.getPrototypeOf(ObjectDataTable)).apply(this,arguments))}return ObjectDataTable}(DataTable);exports.default=ObjectDataTable;

},{"fixed-data-table":"fixed-data-table","lodash":"lodash","react":"react","weavejs":136}],118:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _clipboard=require("weaveapp/modules/clipboard");var _clipboard2=_interopRequireDefault(_clipboard);var _jquery=require("weaveapp/modules/jquery");var _jquery2=_interopRequireDefault(_jquery);var _FormatUtils=require("weaveapp/util/FormatUtils");var _FormatUtils2=_interopRequireDefault(_FormatUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var Button=weavejs.ui.Button;var FileInfoView=function(_React$Component){_inherits(FileInfoView,_React$Component);function FileInfoView(props){_classCallCheck(this,FileInfoView);var _this=_possibleConstructorReturn(this,(FileInfoView.__proto__||Object.getPrototypeOf(FileInfoView)).call(this,props));_this.defaultProps={className:""};return _this}_createClass(FileInfoView,[{key:"componentDidMount",value:function componentDidMount(){this.element=ReactDOM.findDOMNode(this)}},{key:"componentDidUpdate",value:function componentDidUpdate(){var selector=(0,_jquery2.default)(this.element).find(".ui.button.copyButton");var selectedElement=selector.get(0);if(selectedElement){this.clipboard=new _clipboard2.default(selectedElement);this.clipboard.on("success",function(e){selector.popup({content:_weavejs.Weave.lang("Copied!"),on:"click"}).popup("show");e.clearSelection()});this.clipboard.on("error",function(e){selector.popup({content:_weavejs.Weave.lang("Copy not supported on Safari."),on:"click"}).popup("show")})}}},{key:"render",value:function render(){var thumbnail=this.props.fileInfo&&this.props.fileInfo.thumb&&new Blob([this.props.fileInfo.thumb.data],{type:"image/jpeg"});var date=this.props.fileInfo&&new Date(this.props.fileInfo.lastModified);var copyURL=this.props.fileInfo&&window.location.origin+window.location.pathname+"?file=/"+this.props.fileInfo.fileName;return React.createElement(VBox,{className:this.props.className,style:{flex:1,alignItems:"center",justifyContent:"center"}},this.props.fileInfo?React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1,alignItems:"center"}},React.createElement(VBox,{style:{flex:1,justifyContent:"flex-end"}},thumbnail?React.createElement("img",{src:URL.createObjectURL(thumbnail)}):React.createElement("i",{className:"huge circular file outline icon",title:_weavejs.Weave.lang("Thumbnail Unavailable")})),React.createElement(VBox,{className:"weave-padded-vbox",style:{flex:1,justifyContent:"flex-start",alignItems:"center"}},React.createElement("div",{className:"ui medium center aligned dividing header"},this.props.fileInfo&&this.props.fileInfo.fileName,React.createElement("div",{className:"sub header"},_weavejs.Weave.lang("Weave Session")+(this.props.fileInfo&&" - "+_FormatUtils2.default.defaultFileSizeFormatting(this.props.fileInfo.fileSize)))),this.props.fileInfo&&_weavejs.Weave.lang("Modified")+" "+_FormatUtils2.default.defaultFuzzyTimeAgoFormatting(date)+" "+_weavejs.Weave.lang("ago"),React.createElement(HBox,{className:"weave-padded-hbox"},React.createElement(Button,{className:"copyButton","data-clipboard-text":copyURL},_weavejs.Weave.lang("Copy URL")),this.props.children))):null)}}]);return FileInfoView}(React.Component);exports.default=FileInfoView;

},{"react":"react","react-dom":"react-dom","weaveapp/modules/clipboard":62,"weaveapp/modules/jquery":63,"weaveapp/util/FormatUtils":133,"weavejs":136}],119:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StatefulTextField=weavejs.ui.StatefulTextField;var FileInput=weavejs.ui.FileInput;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var Button=weavejs.ui.Button;var URLRequestUtils=_weavejs.WeaveAPI.URLRequestUtils;var FileSelector=function(_React$Component){_inherits(FileSelector,_React$Component);function FileSelector(props){_classCallCheck(this,FileSelector);var _this=_possibleConstructorReturn(this,(FileSelector.__proto__||Object.getPrototypeOf(FileSelector)).call(this,props));_this.handleFileChange=function(event){var file=event.target.files[0];var reader=new FileReader;reader.onload=function(event){var buffer=reader.result;var fileName=URLRequestUtils.saveLocalFile(_weavejs.Weave.getRoot(_this.props.targetUrl),file.name,new Uint8Array(buffer));_this.props.targetUrl.value=null;_this.props.targetUrl.value=fileName};reader.readAsArrayBuffer(file);if(_this.props.onFileChange){_this.props.onFileChange()}};if(props.targetUrl.value){var extension=props.targetUrl.value&&props.targetUrl.value.split(".").pop();_this.state={validExtension:_.includes(_this.props.accept.split(","),"."+extension)}}else{_this.state={validExtension:true}}return _this}_createClass(FileSelector,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.targetUrl.value){var extension=nextProps.targetUrl.value.split(".").pop();this.setState({validExtension:_.includes(nextProps.accept.split(","),"."+extension)})}else{this.setState({validExtension:true})}}},{key:"render",value:function render(){var hBoxFlex={};if(this.props.style&&this.props.style.flex)hBoxFlex.flex=this.props.style.flex;return React.createElement(HBox,{style:hBoxFlex},React.createElement(StatefulTextField,_extends({},this.props,{className:"right labeled"+(this.state.validExtension?"":" warning")+(this.props.className?" "+this.props.className:""),ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.targetUrl},500)})),React.createElement(FileInput,{onChange:this.handleFileChange,accept:this.props.accept},React.createElement(Button,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,margin:0,whiteSpace:"nowrap",border:"1px solid #E0E1E2"}},_weavejs.Weave.lang("Open file"))))}}]);return FileSelector}(React.Component);exports.default=FileSelector;

},{"lodash":"lodash","react":"react","weavejs":136}],120:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _WeaveDataTree=require("weaveapp/ui/WeaveDataTree");var _WeaveDataTree2=_interopRequireDefault(_WeaveDataTree);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HDividedBox=weavejs.ui.HDividedBox;var HierarchyUtils=weavejs.data.hierarchy.HierarchyUtils;var SmartComponent=weavejs.ui.SmartComponent;var DynamicComponent=weavejs.ui.DynamicComponent;var HierarchyExplorer=function(_SmartComponent){_inherits(HierarchyExplorer,_SmartComponent);function HierarchyExplorer(props){_classCallCheck(this,HierarchyExplorer);return _possibleConstructorReturn(this,(HierarchyExplorer.__proto__||Object.getPrototypeOf(HierarchyExplorer)).call(this,props))}_createClass(HierarchyExplorer,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(_weavejs.Weave.isLinkable(nextProps.root)){if(_weavejs.Weave.isLinkable(this.props.root))_weavejs.Weave.getCallbacks(this.props.root).removeCallback(this,this.forceUpdate);_weavejs.Weave.getCallbacks(nextProps.root).addGroupedCallback(this,this.forceUpdate)}}},{key:"componentDidMount",value:function componentDidMount(){this.forceUpdate();;}},{key:"render",value:function render(){var _this2=this;var paths=this.props.initialSelectedItems.map(function(value){return HierarchyUtils.findPathToNode(_this2.props.root,value)}).filter(_.identity);var firstPath=paths[0];var selectedFolderNodes=firstPath?[firstPath[firstPath.length-2]]:[this.props.root.getChildren()[0]];var openFolderNodes=firstPath?firstPath.slice(0,firstPath.length-2):null;return React.createElement(HDividedBox,{style:{flex:1},loadWithEqualWidthChildren:true},React.createElement("div",{style:{display:"flex"}},React.createElement(_WeaveDataTree2.default,{ref:function ref(c){if(c)_this2.folderTree=c},hideRoot:true,hideLeaves:true,initialSelectedItems:selectedFolderNodes,initialOpenItems:openFolderNodes,root:this.props.root,onSelect:function onSelect(){return _this2.forceUpdate()}})),React.createElement("div",{style:{display:"flex"}},React.createElement(DynamicComponent,{dependencies:[this.props.root],render:function render(){return React.createElement(_WeaveDataTree2.default,{ref:function ref(c){if(c)_this2.columnTree=c},hideRoot:true,hideBranches:true,initialSelectedItems:_this2.props.skipSelections?[]:_this2.props.initialSelectedItems,root:_this2.selectedFolder,onSelect:_this2.props.onSelect,onDoubleClick:_this2.props.onDoubleClick})}})))}},{key:"selectedFolder",get:function get(){return this.folderTree&&this.folderTree.state.selectedItems[0]}},{key:"selectedItems",get:function get(){return this.columnTree&&this.columnTree.state.selectedItems},set:function set(items){if(this.columnTree)this.columnTree.setState({selectedItems:items})}}]);return HierarchyExplorer}(SmartComponent);exports.default=HierarchyExplorer;

},{"lodash":"lodash","react":"react","weaveapp/ui/WeaveDataTree":124,"weavejs":136}],121:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ComboBox=weavejs.ui.ComboBox;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var KeyTypeInput=function(_React$Component){_inherits(KeyTypeInput,_React$Component);function KeyTypeInput(props){_classCallCheck(this,KeyTypeInput);var _this=_possibleConstructorReturn(this,(KeyTypeInput.__proto__||Object.getPrototypeOf(KeyTypeInput)).call(this,props));_this.changeListener=function(content){_this.props.keyTypeProperty.value=content};props.keyTypeProperty.addGroupedCallback(_this,_this.forceUpdate,true);return _this}_createClass(KeyTypeInput,[{key:"render",value:function render(){var options=_weavejs.WeaveAPI.QKeyManager.getAllKeyTypes().map(function(keyType,index){if(keyType=="string"){return null}return{label:keyType,value:keyType}}).filter(function(option){return option?true:false});return React.createElement(ComboBox,{style:{width:"100%"},noneOption:{label:"(None)",value:null},ref:WeaveReactUtils.linkReactStateRef(this,{value:this.props.keyTypeProperty}),options:options,allowAdditions:true,searchable:true,onChange:this.changeListener})}}]);return KeyTypeInput}(React.Component);exports.default=KeyTypeInput;

},{"react":"react","weavejs":136}],122:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LAYOUT_CHECKBOXLIST=exports.LAYOUT_HSLIDER=exports.LAYOUT_VSLIDER=exports.LAYOUT_COMBO=exports.LAYOUT_LIST=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _HSlider=require("weaveapp/ui/slider/HSlider");var _HSlider2=_interopRequireDefault(_HSlider);var _VSlider=require("weaveapp/ui/slider/VSlider");var _VSlider2=_interopRequireDefault(_VSlider);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var ComboBox=weavejs.ui.ComboBox;var FloatingDiv=weavejs.ui.FloatingDiv;var CheckBoxList=weavejs.ui.CheckBoxList;var List=weavejs.ui.List;var CenteredIcon=weavejs.ui.CenteredIcon;var LAYOUT_LIST=exports.LAYOUT_LIST="List";var LAYOUT_COMBO=exports.LAYOUT_COMBO="ComboBox";var LAYOUT_VSLIDER=exports.LAYOUT_VSLIDER="VSlider";var LAYOUT_HSLIDER=exports.LAYOUT_HSLIDER="HSlider";var LAYOUT_CHECKBOXLIST=exports.LAYOUT_CHECKBOXLIST="CheckBoxList";var MenuLayoutComponent=function(_React$Component){_inherits(MenuLayoutComponent,_React$Component);function MenuLayoutComponent(props){_classCallCheck(this,MenuLayoutComponent);return _possibleConstructorReturn(this,(MenuLayoutComponent.__proto__||Object.getPrototypeOf(MenuLayoutComponent)).call(this,props))}_createClass(MenuLayoutComponent,[{key:"render",value:function render(){var options=this.props.options.map(function(option){return{label:_.isString(option.label)?_weavejs.Weave.lang(option.label):option.label,value:option.value}});var button=this.props.playToggle?React.createElement(CenteredIcon,{onClick:this.props.playToggle,iconProps:{className:this.props.isPlaying?"fa fa-pause fa-fw":"fa fa-play fa-fw"}}):null;switch(this.props.displayMode){case LAYOUT_LIST:return React.createElement(VBox,null,button,React.createElement(List,{options:options,multiple:this.props.multiple,onChange:this.props.onChange,selectedValues:this.props.selectedItems}));case LAYOUT_HSLIDER:return React.createElement(HBox,{style:{flex:1,paddingLeft:25,paddingRight:25,overflow:"hidden"}},button,React.createElement(_HSlider2.default,{options:options,onChange:this.props.onChange,selectedValues:this.props.selectedItems,type:"categorical"}));case LAYOUT_VSLIDER:return React.createElement(VBox,{style:{flex:1,paddingTop:25,paddingBottom:25,overflow:"hidden"}},button,React.createElement(_VSlider2.default,{options:options,onChange:this.props.onChange,selectedValues:this.props.selectedItems,type:"categorical"}));case LAYOUT_CHECKBOXLIST:return React.createElement(VBox,{style:{flex:1}},button,React.createElement(CheckBoxList,{options:options,selectedValues:this.props.selectedItems,onChange:this.props.onChange}));case LAYOUT_COMBO:return React.createElement(VBox,{style:{flex:1,padding:5}},React.createElement(FloatingDiv,{useContentHeight:true,style:{flex:1}},React.createElement(ComboBox,{placeholder:_weavejs.Weave.lang("Select a column"),options:options,onChange:this.props.onChange,value:_.head(this.props.selectedItems)})));default:return null;}}}]);return MenuLayoutComponent}(React.Component);exports.default=MenuLayoutComponent;

},{"lodash":"lodash","react":"react","weaveapp/ui/slider/HSlider":128,"weaveapp/ui/slider/VSlider":130,"weavejs":136}],123:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _ColumnSelector=require("weaveapp/ui/ColumnSelector");var _ColumnSelector2=_interopRequireDefault(_ColumnSelector);var _AttributeSelector=require("weaveapp/ui/AttributeSelector");var _AttributeSelector2=_interopRequireDefault(_AttributeSelector);var _ColorPicker=require("weaveapp/ui/ColorPicker");var _ColorPicker2=_interopRequireDefault(_ColorPicker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var WeaveReactUtils=weavejs.util.WeaveReactUtils;var HBox=weavejs.ui.flexbox.HBox;var VBox=weavejs.ui.flexbox.VBox;var AlwaysDefinedColumn=weavejs.data.column.AlwaysDefinedColumn;var ColorColumn=weavejs.data.column.ColorColumn;var StatefulTextField=weavejs.ui.StatefulTextField;var Button=weavejs.ui.Button;var StandardLib=weavejs.util.StandardLib;var DynamicComponent=weavejs.ui.DynamicComponent;var SelectableAttributeComponent=function(_React$Component){_inherits(SelectableAttributeComponent,_React$Component);function SelectableAttributeComponent(props){_classCallCheck(this,SelectableAttributeComponent);var _this=_possibleConstructorReturn(this,(SelectableAttributeComponent.__proto__||Object.getPrototypeOf(SelectableAttributeComponent)).call(this,props));_this.renderAttributeSelectorForEditor=function(attributeName){return React.createElement(_AttributeSelector2.default,{attributeName:attributeName,attributes:_this.props.attributes})};_this.launchAttributeSelector=function(attributeName){if(_this.props.pushCrumb){_this.props.pushCrumb("Attributes",_this.renderAttributeSelectorForEditor.bind(_this,attributeName),null);return null}else{return _AttributeSelector2.default.openInstance(_this,attributeName,_this.props.attributes)}};return _this}_createClass(SelectableAttributeComponent,[{key:"render",value:function render(){var _this2=this;var column=this.props.attributes.get(this.props.attributeName);var adc=_weavejs.Weave.AS(column,AlwaysDefinedColumn);var isColorColumn=adc&&_weavejs.Weave.IS(adc.internalDynamicColumn.target,ColorColumn);var defaultSelector=null;if(adc){if(isColorColumn){defaultSelector=React.createElement(DynamicComponent,{dependencies:[adc.defaultValue],render:function render(){var value=adc.defaultValue.state;var hexColor=void 0;if((typeof value==="undefined"?"undefined":_typeof(value))==_typeof(0)){hexColor=StandardLib.getHexColor(value)}else if((typeof value==="undefined"?"undefined":_typeof(value))==_typeof("")){hexColor=value}else{hexColor="000000"}return React.createElement(HBox,{style:{marginRight:"5px"}},React.createElement(_ColorPicker2.default,{noDefaultSize:true,style:{width:"45px",borderBottomRightRadius:0,borderTopRightRadius:0},hexColor:hexColor,onChange:function onChange(value){adc.defaultValue.state=value}}),React.createElement(Button,{style:{borderBottomLeftRadius:0,borderTopLeftRadius:0,borderLeft:"none"},onClick:function onClick(){adc.defaultValue.state=null},title:_weavejs.Weave.lang("Clear color")},React.createElement("i",{className:"fa fa-remove","aria-hidden":"true"})))}})}else{defaultSelector=React.createElement(StatefulTextField,{style:{flex:1},ref:WeaveReactUtils.linkReactStateRef(this,{value:adc.defaultValue})})}}var mainSelector=React.createElement(HBox,{overflow:true,style:_.merge({flex:1},this.props.style)},isColorColumn?defaultSelector:null,React.createElement(_ColumnSelector2.default,this.props),React.createElement(Button,{onClick:function onClick(){return _this2.launchAttributeSelector(_this2.props.attributeName)},style:{borderBottomLeftRadius:0,borderTopLeftRadius:0,borderLeft:"none"},title:_weavejs.Weave.lang("Click to explore other DataSources for "+this.props.attributeName)},React.createElement("i",{className:"fa fa-angle-right","aria-hidden":"true",style:{fontWeight:"bold"}})));return React.createElement(VBox,{overflow:true,padded:true,style:{flex:1}},mainSelector,!isColorColumn&&defaultSelector?React.createElement(HBox,{padded:true},React.createElement("div",{style:{alignSelf:"center"}},_weavejs.Weave.lang("Default value")),defaultSelector):null)}}]);return SelectableAttributeComponent}(React.Component);exports.default=SelectableAttributeComponent;

},{"lodash":"lodash","react":"react","weaveapp/ui/AttributeSelector":110,"weaveapp/ui/ColorPicker":113,"weaveapp/ui/ColumnSelector":116,"weavejs":136}],124:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _WeaveTreeNodeDescriptor=require("weaveapp/ui/WeaveTreeNodeDescriptor");var _WeaveTreeNodeDescriptor2=_interopRequireDefault(_WeaveTreeNodeDescriptor);var _WeaveTree2=require("weaveapp/ui/WeaveTree");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultTreeDescriptor=void 0;var WeaveDataTree=function(_WeaveTree){_inherits(WeaveDataTree,_WeaveTree);function WeaveDataTree(props){_classCallCheck(this,WeaveDataTree);return _possibleConstructorReturn(this,(WeaveDataTree.__proto__||Object.getPrototypeOf(WeaveDataTree)).call(this,props))}return WeaveDataTree}(_WeaveTree2.WeaveTree);exports.default=WeaveDataTree;WeaveDataTree.defaultProps={get treeDescriptor(){return defaultTreeDescriptor||(defaultTreeDescriptor=new _WeaveTreeNodeDescriptor2.default)}};

},{"weaveapp/ui/WeaveTree":126,"weaveapp/ui/WeaveTreeNodeDescriptor":127}],125:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SmartComponent=weavejs.ui.SmartComponent;var ProgressBar=weavejs.ui.ProgressBar;var ProgressIndicator=_weavejs.WeaveAPI.ProgressIndicator;var WeaveProgressBar=function(_SmartComponent){_inherits(WeaveProgressBar,_SmartComponent);function WeaveProgressBar(props){_classCallCheck(this,WeaveProgressBar);var _this=_possibleConstructorReturn(this,(WeaveProgressBar.__proto__||Object.getPrototypeOf(WeaveProgressBar)).call(this,props));_this.timeBecameBusy=0;_this.autoVisibleDelay=2000;_this.autoHideDelay=800;_weavejs.Weave.getCallbacks(ProgressIndicator).addGroupedCallback(_this,_this.forceUpdate);_weavejs.WeaveAPI.Scheduler.frameCallbacks.addGroupedCallback(_this,_this.toggleVisible);_this.state={visible:false};return _this}_createClass(WeaveProgressBar,[{key:"toggleVisible",value:function toggleVisible(){var busy=ProgressIndicator.getTaskCount()>0;if(this.state.visible!=busy){if(this.timeBecameBusy==-1)this.timeBecameBusy=Date.now();if(Date.now()<this.timeBecameBusy+(busy?this.autoVisibleDelay:this.autoHideDelay))return;this.setState({visible:busy})}this.timeBecameBusy=-1}},{key:"render",value:function render(){return React.createElement(ProgressBar,_extends({visible:this.state.visible,progressValue:ProgressIndicator.getNormalizedProgress()},this.props))}}]);return WeaveProgressBar}(SmartComponent);exports.default=WeaveProgressBar;

},{"react":"react","weavejs":136}],126:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BasicTreeDescriptor=exports.WeaveTree=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _reactDom=require("react-dom");var ReactDOM=_interopRequireWildcard(_reactDom);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);var _DataTable=require("weaveapp/ui/DataTable");var _DataTable2=_interopRequireDefault(_DataTable);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var DOMUtils=weavejs.util.DOMUtils;;var defaultTreeDescriptor=void 0;var WeaveTree=exports.WeaveTree=function(_React$Component){_inherits(WeaveTree,_React$Component);function WeaveTree(props){_classCallCheck(this,WeaveTree);var _this=_possibleConstructorReturn(this,(WeaveTree.__proto__||Object.getPrototypeOf(WeaveTree)).call(this,props));_this.state={selectedItems:[],openItems:[],columnWidth:0};_this.areNodesEqual=function(a,b){if(a&&b)return _this.props.treeDescriptor.isEqual(a,b);else return a===b};_this.renderItem=function(node,index,depth){var className=WeaveTree.CLASSNAME;var iconClassName=WeaveTree.LEAF_ICON_CLASSNAME;var iconClickFunc=null;var doubleClickFunc=void 0;var expanderClassName=WeaveTree.EXPANDER_HIDDEN_CLASS_NAME;var isOpen=_this.isOpen(node);var isBranch=_this.props.treeDescriptor.isBranch(node);var isExpandable=isBranch&&(!_this.props.hideLeaves||_this.props.treeDescriptor.hasChildBranches(node));if(isBranch){iconClassName=isOpen?WeaveTree.OPEN_BRANCH_ICON_CLASSNAME:WeaveTree.BRANCH_ICON_CLASSNAME}if(isExpandable){iconClickFunc=function iconClickFunc(e){_this.internalSetOpen(node,!_this.isOpen(node));e.stopPropagation()};expanderClassName=isOpen?WeaveTree.EXPANDER_OPEN_CLASS_NAME:WeaveTree.EXPANDER_CLOSED_CLASS_NAME}else if(!_this.props.treeDescriptor.isBranch(node)&&_this.props.onDoubleClick){doubleClickFunc=function doubleClickFunc(e){_this.props.onDoubleClick&&_this.props.onDoubleClick(node)}}return React.createElement(HBox,{key:index,className:className,onDoubleClick:iconClickFunc||doubleClickFunc,style:{alignItems:"center",width:"100%",paddingLeft:(depth||0)*16+5,whiteSpace:"nowrap"}},React.createElement("span",{style:{alignSelf:"stretch",display:"flex"}},React.createElement("i",{onMouseDown:iconClickFunc,onDoubleClick:function onDoubleClick(e){return e.stopPropagation()},className:expanderClassName,style:{alignSelf:"center"}})),React.createElement("span",{style:{alignSelf:"stretch",display:"flex"}},React.createElement("i",{style:{alignSelf:"center"},className:iconClassName}))," "+_this.props.treeDescriptor.getLabel(node))};_this.enumerateItems=function(node){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(!node)return result;if(_this.props.filterFunc&&!_this.props.filterFunc(node)){return result}if(node!==_this.props.root||!_this.props.hideRoot){if(_this.props.treeDescriptor.isBranch(node)||node==_this.props.root||!_this.props.hideLeaves){result.push([depth,node]);depth++}}if(_this.props.treeDescriptor.isBranch(node)&&_this.isOpen(node)){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_this.props.treeDescriptor.getChildren(node)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;_this.enumerateItems(child,result,depth)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}return result};_this.onSelect=function(indices){var nodes=indices.map(function(index){return _this.lastEnumeration[Number(index)][1]});_this.setState({selectedItems:nodes});var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=nodes[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var node=_step2.value;_this.internalSetOpen(node,true)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}};_this.state={selectedItems:props.initialSelectedItems||[],openItems:props.initialOpenItems||[]};return _this}_createClass(WeaveTree,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var shouldResetBoth=this.props.treeDescriptor!=nextProps.treeDescriptor||!this.props.root!=!nextProps.root||nextProps.root&&!nextProps.treeDescriptor.isEqual(nextProps.root,this.props.root);if(shouldResetBoth)this.setState({selectedItems:nextProps.initialSelectedItems||[],openItems:nextProps.initialOpenItems||[]});else if(this.nodeArraysChanged(nextProps.initialSelectedItems,this.props.initialSelectedItems))this.setState({selectedItems:nextProps.initialSelectedItems||[]});else if(this.nodeArraysChanged(nextProps.initialOpenItems,this.props.initialOpenItems))this.setState({openItems:nextProps.initialOpenItems||[]})}},{key:"isOpen",value:function isOpen(node){var _this2=this;if(node===this.props.root&&this.props.hideRoot)return true;else return node&&!!this.state.openItems.find(function(otherNode){return _this2.props.treeDescriptor.isEqual(otherNode,node)})}},{key:"nodeArraysChanged",value:function nodeArraysChanged(arrayA,arrayB){var _this3=this;return arrayA&&arrayB?arrayA.length!=arrayB.length||arrayA.some(function(d,i,a){return!_this3.areNodesEqual(d,arrayB[i])}):arrayA!=arrayB}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(this.props.onSelect&&this.nodeArraysChanged(prevState.selectedItems,this.state.selectedItems))this.props.onSelect(this.state.selectedItems);if(this.props.onExpand&&this.nodeArraysChanged(prevState.openItems,this.state.openItems))this.props.onExpand(this.state.openItems);if(this.longestRowJSX){var newColumnWidth=this.computeRowWidth(this.longestRowJSX);if(newColumnWidth!=this.state.columnWidth){this.setState({columnWidth:newColumnWidth})}}}},{key:"componentDidMount",value:function componentDidMount(){if(this.longestRowJSX){var newColumnWidth=this.computeRowWidth(this.longestRowJSX);if(newColumnWidth!=this.state.columnWidth){this.setState({columnWidth:newColumnWidth})}}}},{key:"internalSetOpen",value:function internalSetOpen(node,value){var _this4=this;if(!node)return;var isOpen=this.isOpen(node);if(value==isOpen)return;var openItems=this.state.openItems;if(!isOpen)openItems=openItems.concat([node]);else if(isOpen)openItems=openItems.filter(function(other){return!_this4.props.treeDescriptor.isEqual(node,other)});this.setState({openItems:openItems})}},{key:"computeRowWidth",value:function computeRowWidth(rowJSX){var body=document.getElementsByTagName("body")[0];var div=document.createElement("span");body.appendChild(div);var renderedRow=ReactDOM.render(rowJSX,div);var node=ReactDOM.findDOMNode(renderedRow);node.style.display="inline-block";node.style.width=null;var width=node.offsetWidth;ReactDOM.unmountComponentAtNode(div);body.removeChild(div);return width*1.5}},{key:"render",value:function render(){var _this5=this;if(_weavejs.Weave.isLinkable(this.props.root)){_weavejs.Weave.getCallbacks(this.props.root).addGroupedCallback(this,this.forceUpdate)}this.rowHeight=Math.max(DOMUtils.getTextHeightForClasses("M",WeaveTree.CLASSNAME),22)+5;var rootChildren=this.props.treeDescriptor.getChildren(this.props.root)||[];this.lastEnumeration=this.props.hideBranches?rootChildren.filter(function(n){return!_this5.props.treeDescriptor.isBranch(n)}).map(function(n){return[0,n]}):this.enumerateItems(this.props.root);var selectedIndices=[];var maxRowIndex=-1;var maxRowLength=-Infinity;var rows=this.lastEnumeration.map(function(row,index){var _row=_slicedToArray(row,2),depth=_row[0],item=_row[1];if(_this5.state.selectedItems.filter(_.identity).some(function(node){return _this5.props.treeDescriptor.isEqual(node,item)}))selectedIndices.push(index.toString());var label=_this5.props.treeDescriptor.getLabel(item);var rowLengthHeuristic=label.length+depth;if(rowLengthHeuristic>maxRowLength){maxRowLength=rowLengthHeuristic;maxRowIndex=index}return{id:index.toString(),tree:_this5.renderItem(item,index,depth)}});if(rows[maxRowIndex])this.longestRowJSX=rows[maxRowIndex]["tree"];return React.createElement(_DataTable2.default,{idProperty:"id",headerHeight:0,rowHeight:this.rowHeight,columnIds:["tree"],initialColumnWidth:this.state.columnWidth,rows:rows,selectedIds:selectedIndices,onSelection:this.onSelect,showBottomBorder:false,allowClear:false})}}]);return WeaveTree}(React.Component);WeaveTree.defaultProps={get treeDescriptor(){return defaultTreeDescriptor||(defaultTreeDescriptor=new BasicTreeDescriptor)}};WeaveTree.CLASSNAME="weave-tree-view";WeaveTree.BRANCH_ICON_CLASSNAME="weave-tree-view-icon fa fa-folder fa-fw";WeaveTree.LEAF_ICON_CLASSNAME="weave-tree-view-icon fa fa-file-text-o fa-fw";WeaveTree.OPEN_BRANCH_ICON_CLASSNAME="weave-tree-view-icon fa fa-folder-open fa-fw";WeaveTree.EXPANDER_CLOSED_CLASS_NAME="weave-tree-view-icon-expander fa fa-play fa-fw";WeaveTree.EXPANDER_OPEN_CLASS_NAME="weave-tree-view-icon-expander fa fa-play fa-fw fa-rotate-90";WeaveTree.EXPANDER_HIDDEN_CLASS_NAME="weave-tree-view-icon-expander fa fa-fw hidden-expander";var BasicTreeDescriptor=exports.BasicTreeDescriptor=function(){function BasicTreeDescriptor(){_classCallCheck(this,BasicTreeDescriptor)}_createClass(BasicTreeDescriptor,[{key:"getLabel",value:function getLabel(node){return node?node.label:""}},{key:"isEqual",value:function isEqual(node1,node2){return node1==node2}},{key:"getChildren",value:function getChildren(node){return node?node.children:null}},{key:"isBranch",value:function isBranch(node){return!!(node&&node.children)}},{key:"hasChildBranches",value:function hasChildBranches(node){if(node&&node.children){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=node.children[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _child=_step3.value;if(_child.children)return true}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}return false}},{key:"addChildAt",value:function addChildAt(parent,newChild,index){var index=parent.children?parent.children.indexOf(newChild):-1;if(index>=0){var newChildren=parent.children?parent.children.concat():[];newChildren.push(newChild);parent.children=newChildren;return true}return false}},{key:"removeChildAt",value:function removeChildAt(parent,child,index){var index=parent.children?parent.children.indexOf(child):-1;if(index>=0){var newChildren=parent.children?parent.children.concat():[];newChildren.splice(index,1);parent.children=newChildren;return true}return false}}]);return BasicTreeDescriptor}();var BasicWeaveTree=function(_WeaveTree){_inherits(BasicWeaveTree,_WeaveTree);function BasicWeaveTree(){_classCallCheck(this,BasicWeaveTree);return _possibleConstructorReturn(this,(BasicWeaveTree.__proto__||Object.getPrototypeOf(BasicWeaveTree)).apply(this,arguments))}return BasicWeaveTree}(WeaveTree);exports.default=BasicWeaveTree;;

},{"lodash":"lodash","react":"react","react-dom":"react-dom","weaveapp/ui/DataTable":117,"weavejs":136}],127:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var WeaveTreeNodeDescriptor=function(){function WeaveTreeNodeDescriptor(){_classCallCheck(this,WeaveTreeNodeDescriptor)}_createClass(WeaveTreeNodeDescriptor,[{key:'getLabel',value:function getLabel(node){return node?node.getLabel():''}},{key:'isEqual',value:function isEqual(node1,node2){return node1&&node2?node1.equals(node2):node1==node2}},{key:'getChildren',value:function getChildren(node){return node?node.getChildren():null}},{key:'hasChildBranches',value:function hasChildBranches(node){return node&&node.hasChildBranches()}},{key:'isBranch',value:function isBranch(node){return node&&node.isBranch()}}]);return WeaveTreeNodeDescriptor}();exports.default=WeaveTreeNodeDescriptor;

},{}],128:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _RCSlider=require("weaveapp/ui/slider/RCSlider");var _RCSlider2=_interopRequireDefault(_RCSlider);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VBox=weavejs.ui.flexbox.VBox;var HSlider=function(_React$Component){_inherits(HSlider,_React$Component);function HSlider(props){_classCallCheck(this,HSlider);return _possibleConstructorReturn(this,(HSlider.__proto__||Object.getPrototypeOf(HSlider)).call(this,props))}_createClass(HSlider,[{key:"render",value:function render(){return React.createElement(VBox,{overflow:true,style:{flex:1,justifyContent:"space-around"},className:"weave-hslider"},React.createElement(_RCSlider2.default,this.props))}}]);return HSlider}(React.Component);exports.default=HSlider;

},{"react":"react","weaveapp/ui/slider/RCSlider":129,"weavejs":136}],129:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _rcSlider=require("rc-slider");var _rcSlider2=_interopRequireDefault(_rcSlider);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SmartComponent=weavejs.ui.SmartComponent;var RCSlider=function(_SmartComponent){_inherits(RCSlider,_SmartComponent);function RCSlider(props){_classCallCheck(this,RCSlider);var _this=_possibleConstructorReturn(this,(RCSlider.__proto__||Object.getPrototypeOf(RCSlider)).call(this,props));_this.indexToValue=new Map;_this.valueToIndex=new Map;_this.step=1;_this.onChange=_.debounce(_this.onChange.bind(_this),30);return _this}_createClass(RCSlider,[{key:"componentWillUpdate",value:function componentWillUpdate(){}},{key:"onChange",value:function onChange(value){if(this.props.type==RCSlider.CATEGORICAL){var selectedValues=[this.indexToValue.get(value)];this.props.onChange(selectedValues)}if(this.props.type==RCSlider.NUMERIC){var _selectedValues=[{min:value[0],max:value[1]}];this.props.onChange(_selectedValues)}if(this.props.type==RCSlider.NUMERIC_DISCRETE){var _selectedValues2=[{min:this.indexToValue.get(value[0]),max:this.indexToValue.get(value[1])}];this.props.onChange(_selectedValues2)}}},{key:"render",value:function render(){var _this2=this;this.options=[];this.indexToValue.clear();this.valueToIndex.clear();this.indexToLabel={};var slider=null;if(!this.props.options){this.options=[]}else{this.props.options.forEach(function(option,index){_this2.options.push(index);_this2.indexToValue.set(index,option.value);_this2.indexToLabel[index]=option.label;_this2.valueToIndex.set(option.value,index)})}if(this.props.type==RCSlider.CATEGORICAL){slider=React.createElement(_rcSlider2.default,{min:0,max:this.options.length?this.options.length-1:0,step:null,marks:this.indexToLabel,value:this.valueToIndex.get((this.props.selectedValues||[])[0]),onChange:this.onChange,vertical:this.props.vertical,style:this.props.style})}var value=Object((this.props.selectedValues||[])[0]);if(this.props.type==RCSlider.NUMERIC){var valueToLabel={};this.options=this.props.options.map(function(option){valueToLabel[option.value]=option.label;return option.value});if(this.options.length){this.min=Math.min.apply(null,this.options);this.max=Math.max.apply(null,this.options)}else{this.min=0;this.max=1}if(isNaN(value.min))value.min=this.min;if(isNaN(value.max))value.max=this.max;var marks={};marks[this.min]=valueToLabel[this.min]||"0";marks[this.max]=valueToLabel[this.max]||"1";var stepCount=(this.max-this.min)/1024;slider=React.createElement(_rcSlider2.default,{range:true,step:stepCount>0?stepCount:1,min:this.min,max:this.max,marks:marks,value:[value.min,value.max],onChange:this.onChange,vertical:this.props.vertical})}if(this.props.type==RCSlider.NUMERIC_DISCRETE){var min=0;var max=1;if(this.options.length>0)max=Math.max(0,this.options.length-1);if(isNaN(value.min))value.min=min;if(isNaN(value.max))value.max=max;slider=React.createElement(_rcSlider2.default,{range:true,min:min,max:max,step:null,marks:this.indexToLabel,value:[this.valueToIndex.get(value.min),this.valueToIndex.get(value.max)],onChange:this.onChange,vertical:this.props.vertical})}return React.createElement("div",{ref:function ref(e){return _this2.element=e},className:"weave-rc-slider-container",onMouseEnter:function onMouseEnter(){return _this2.element.focus()},onMouseLeave:function onMouseLeave(){return _this2.element.blur()},tabIndex:0},slider)}}]);return RCSlider}(SmartComponent);exports.default=RCSlider;RCSlider.VERTICAL="vertical";RCSlider.HORIZONTAL="horizontal";RCSlider.NUMERIC="numeric";RCSlider.CATEGORICAL="categorical";RCSlider.NUMERIC_DISCRETE="numeric-discrete";

},{"lodash":"lodash","rc-slider":"rc-slider","react":"react","weavejs":136}],130:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);var _RCSlider=require("weaveapp/ui/slider/RCSlider");var _RCSlider2=_interopRequireDefault(_RCSlider);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HBox=weavejs.ui.flexbox.HBox;var VSlider=function(_React$Component){_inherits(VSlider,_React$Component);function VSlider(props){_classCallCheck(this,VSlider);return _possibleConstructorReturn(this,(VSlider.__proto__||Object.getPrototypeOf(VSlider)).call(this,props))}_createClass(VSlider,[{key:"render",value:function render(){return React.createElement(HBox,{overflow:true,style:{flex:1,justifyContent:"space-around"},className:"weave-vslider"},React.createElement(_RCSlider2.default,_extends({vertical:true},this.props)))}}]);return VSlider}(React.Component);exports.default=VSlider;

},{"react":"react","weaveapp/ui/slider/RCSlider":129,"weavejs":136}],131:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ChartUtils=function(){function ChartUtils(){_classCallCheck(this,ChartUtils)}_createClass(ChartUtils,null,[{key:"getAxisLabelAngleChoices",value:function getAxisLabelAngleChoices(){return _.range(-180,180,15).map(function(value,index){return{label:String(value),value:value}})}}]);return ChartUtils}();exports.default=ChartUtils;

},{"lodash":"lodash"}],132:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);var _weavejs=require("weavejs");var weavejs=_interopRequireWildcard(_weavejs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var StatefulTextField=weavejs.ui.StatefulTextField;var WeaveReactUtils=weavejs.util.WeaveReactUtils;var ConfigUtils=function(){function ConfigUtils(){_classCallCheck(this,ConfigUtils)}_createClass(ConfigUtils,null,[{key:"renderNumberEditor",value:function renderNumberEditor(linkableNumber,flex){var style={textAlign:"center",flex:flex,minWidth:60};return React.createElement(StatefulTextField,{type:"number",style:style,ref:WeaveReactUtils.linkReactStateRef(this,{value:linkableNumber})})}}]);return ConfigUtils}();exports.default=ConfigUtils;

},{"react":"react","weavejs":136}],133:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _d=require("d3");var d3=_interopRequireWildcard(_d);var _weavejs=require("weavejs");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FormatUtils=function(){function FormatUtils(){_classCallCheck(this,FormatUtils)}_createClass(FormatUtils,null,[{key:"defaultNumberFormatting",value:function defaultNumberFormatting(x){if(x<0.0001)return x;return FormatUtils.d3formatter(d3.round(x,4))}},{key:"defaultFileSizeFormatting",value:function defaultFileSizeFormatting(byteFileSize){var i=-1;var byteUnits=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{byteFileSize=byteFileSize/1024;i++}while(byteFileSize>1024);return Math.max(byteFileSize,0.1).toFixed(1)+byteUnits[i]}},{key:"defaultFuzzyTimeAgoFormatting",value:function defaultFuzzyTimeAgoFormatting(date){var now=new Date;var secondsBetween=Math.floor((now.getTime()-date.getTime())/1000);var ratio=Math.floor(secondsBetween/31536000);if(ratio>1)return ratio+" "+_weavejs.Weave.lang("years");ratio=Math.floor(secondsBetween/2592000);if(ratio>1)return ratio+" "+_weavejs.Weave.lang("months");ratio=Math.floor(secondsBetween/86400);if(ratio>1)return ratio+" "+_weavejs.Weave.lang("days");ratio=Math.floor(secondsBetween/3600);if(ratio>1)return ratio+" "+_weavejs.Weave.lang("hours");ratio=Math.floor(secondsBetween/60);if(ratio>1)return ratio+" "+_weavejs.Weave.lang("minutes");return Math.floor(secondsBetween)+" "+_weavejs.Weave.lang("seconds")}}]);return FormatUtils}();exports.default=FormatUtils;FormatUtils.d3formatter=d3.format(",");

},{"d3":"d3","weavejs":136}],134:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var React=_interopRequireWildcard(_react);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ReactUtils=weavejs.util.ReactUtils;var PrintUtils=function(){function PrintUtils(){_classCallCheck(this,PrintUtils)}_createClass(PrintUtils,null,[{key:"printTool",value:function printTool(tool){var popoutWindow;var options={transferStyle:true,windowSettings:"width="+tool.clientWidth+", height="+tool.clientHeight};var content=React.createElement("div",null);popoutWindow=ReactUtils.openPopout(content,PrintUtils.onLoad,PrintUtils.onBeforeUnLoad,options);popoutWindow.document.body.innerHTML=$(tool).clone(true,true).html();popoutWindow.print();popoutWindow.close()}},{key:"printCanvasTool",value:function printCanvasTool(tool){var popoutWindow;var canvas;var options={transferStyle:true,windowSettings:"width="+tool.clientWidth+", height="+tool.clientHeight};var content=React.createElement("img",{id:"printImg"});popoutWindow=ReactUtils.openPopout(content,PrintUtils.onLoad,PrintUtils.onBeforeUnLoad,options);var canvasList=tool.getElementsByTagName("canvas");if(canvasList.length)canvas=canvasList.item(0);var data=canvas.toDataURL("image/png");popoutWindow.document.getElementById("printImg").setAttribute("src",data);popoutWindow.print();popoutWindow.close()}}]);return PrintUtils}();exports.default=PrintUtils;PrintUtils.onBeforeUnLoad=function(){};PrintUtils.onLoad=function(){};

},{"react":"react"}],135:[function(require,module,exports){
/*!
  Copyright (c) 2016 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
/* global define */

(function () {
	'use strict';

	var hasOwn = {}.hasOwnProperty;

	function classNames () {
		var classes = [];

		for (var i = 0; i < arguments.length; i++) {
			var arg = arguments[i];
			if (!arg) continue;

			var argType = typeof arg;

			if (argType === 'string' || argType === 'number') {
				classes.push(arg);
			} else if (Array.isArray(arg)) {
				classes.push(classNames.apply(null, arg));
			} else if (argType === 'object') {
				for (var key in arg) {
					if (hasOwn.call(arg, key) && arg[key]) {
						classes.push(key);
					}
				}
			}
		}

		return classes.join(' ');
	}

	if (typeof module !== 'undefined' && module.exports) {
		module.exports = classNames;
	} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {
		// register as 'classnames', consistent with npm package name
		define('classnames', [], function () {
			return classNames;
		});
	} else {
		window.classNames = classNames;
	}
}());

},{}],136:[function(require,module,exports){
;(function (root, factory) {
  if (typeof exports === "object") {
    module.exports = factory();
  } else if (typeof define === "function" && define.amd) {
    define([], factory);
  } else {
    root.weavejs = factory();
  }
}(this, function () {
  var goog = this.goog = {};
  this.CLOSURE_NO_DEPS = true;
  var weavejs = this.weavejs = {};
  var org = this.org = {};
  var WEAVE = {};

"use strict";

var _jszip = require("jszip");

var JSZip_ = _interopRequireWildcard(_jszip);

var _classnames = require("classnames");

var classNames_ = _interopRequireWildcard(_classnames);

var _react = require("react");

var React_ = _interopRequireWildcard(_react);

var _reactDom = require("react-dom");

var ReactDOM_ = _interopRequireWildcard(_reactDom);

var _reactAddonsUpdate = require("react-addons-update");

var reactUpdate_ = _interopRequireWildcard(_reactAddonsUpdate);

var _pixi = require("pixi.js");

var PIXI_ = _interopRequireWildcard(_pixi);

var _lodash = require("lodash");

var __ = _interopRequireWildcard(_lodash);

var _moment = require("moment");

var moment_ = _interopRequireWildcard(_moment);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

/// <reference path="./_lib-references.ts"/>
var React = React_;
React.addons = React_.addons || {};
React.addons.update = reactUpdate_.default;
var ReactDOM = ReactDOM_;
var moment = moment_.default;
var _ = __;
var lodash = __;
var classNames = classNames_.default;
var JSZip = JSZip_.default;
var PIXI = PIXI_;
PIXI.utils._saidHello = true;

'use strict';var COMPILED=false;var goog=goog||{};goog.global=this;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;goog.isDef=function(val){return val!==void 0};
goog.exportPath_=function(name,opt_object,opt_objectToExportTo){var parts=name.split('.');var cur=opt_objectToExportTo||goog.global;if(!(parts[0]in cur)&&cur.execScript)cur.execScript('var '+parts[0]);for(var part;parts.length&&(part=parts.shift());)if(!parts.length&&goog.isDef(opt_object))cur[part]=opt_object;else if(cur[part])cur=cur[part];else cur=cur[part]={}};
goog.define=function(name,defaultValue){var value=defaultValue;if(!COMPILED)if(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,name))value=goog.global.CLOSURE_UNCOMPILED_DEFINES[name];else if(goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,name))value=goog.global.CLOSURE_DEFINES[name];goog.exportPath_(name,value)};goog.define('goog.DEBUG',true);goog.define('goog.LOCALE','en');
goog.define('goog.TRUSTED_SITE',true);goog.define('goog.STRICT_MODE_COMPATIBLE',false);goog.define('goog.DISALLOW_TEST_ONLY_CODE',COMPILED&&!goog.DEBUG);goog.define('goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING',false);goog.provide=function(name){if(!COMPILED)if(goog.isProvided_(name))throw Error('Namespace "'+name+'" already declared.');goog.constructNamespace_(name)};
goog.constructNamespace_=function(name,opt_obj){if(!COMPILED){delete goog.implicitNamespaces_[name];var namespace=name;while(namespace=namespace.substring(0,namespace.lastIndexOf('.'))){if(goog.getObjectByName(namespace))break;goog.implicitNamespaces_[namespace]=true}}goog.exportPath_(name,opt_obj)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(name){if(!goog.isString(name)||!name||name.search(goog.VALID_MODULE_RE_)==-1)throw Error('Invalid module identifier');if(!goog.isInModuleLoader_())throw Error('Module '+name+' has been loaded incorrectly.');if(goog.moduleLoaderState_.moduleName)throw Error('goog.module may only be called once per module.');goog.moduleLoaderState_.moduleName=name;if(!COMPILED){if(goog.isProvided_(name))throw Error('Namespace "'+name+'" already declared.');delete goog.implicitNamespaces_[name]}};
goog.module.get=function(name){return goog.module.getInternal_(name)};goog.module.getInternal_=function(name){if(!COMPILED)if(goog.isProvided_(name))return name in goog.loadedModules_?goog.loadedModules_[name]:goog.getObjectByName(name);else return null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.moduleLoaderState_!=null};
goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw new Error('goog.module.declareTestMethods must be called from '+'within a goog.module');goog.moduleLoaderState_.declareTestMethods=true};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw new Error('goog.module.declareLegacyNamespace must be called from '+'within a goog.module');if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error('goog.module must be called prior to '+'goog.module.declareLegacyNamespace.');goog.moduleLoaderState_.declareLegacyNamespace=true};
goog.setTestOnly=function(opt_message){if(goog.DISALLOW_TEST_ONLY_CODE){opt_message=opt_message||'';throw Error('Importing test-only code into non-debug environment'+(opt_message?': '+opt_message:'.'));}};goog.forwardDeclare=function(name){};if(!COMPILED){goog.isProvided_=function(name){return name in goog.loadedModules_||!goog.implicitNamespaces_[name]&&goog.isDefAndNotNull(goog.getObjectByName(name))};goog.implicitNamespaces_={'goog.module':true}}
goog.getObjectByName=function(name,opt_obj){var parts=name.split('.');var cur=opt_obj||goog.global;for(var part;part=parts.shift();)if(goog.isDefAndNotNull(cur[part]))cur=cur[part];else return null;return cur};goog.globalize=function(obj,opt_global){var global=opt_global||goog.global;for(var x in obj)global[x]=obj[x]};
goog.addDependency=function(relPath,provides,requires,opt_isModule){if(goog.DEPENDENCIES_ENABLED){var provide,require;var path=relPath.replace(/\\/g,'/');var deps=goog.dependencies_;for(var i=0;provide=provides[i];i++){deps.nameToPath[provide]=path;deps.pathIsModule[path]=!!opt_isModule}for(var j=0;require=requires[j];j++){if(!(path in deps.requires))deps.requires[path]={};deps.requires[path][require]=true}}};goog.define('goog.ENABLE_DEBUG_LOADER',true);goog.logToConsole_=function(msg){if(goog.global.console)goog.global.console['error'](msg)};
goog.require=function(name){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_)goog.maybeProcessDeferredDep_(name);if(goog.isProvided_(name))if(goog.isInModuleLoader_())return goog.module.getInternal_(name);else return null;if(goog.ENABLE_DEBUG_LOADER){var path=goog.getPathFromDeps_(name);if(path){goog.included_[path]=true;goog.writeScripts_();return null}}var errorMessage='goog.require could not find: '+name;goog.logToConsole_(errorMessage);throw Error(errorMessage);}};goog.basePath='';goog.global.CLOSURE_BASE_PATH;
goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};goog.abstractMethod=function(){throw Error('unimplemented abstract method');};goog.addSingletonGetter=function(ctor){ctor.getInstance=function(){if(ctor.instance_)return ctor.instance_;if(goog.DEBUG)goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=ctor;return ctor.instance_=new ctor}};goog.instantiatedSingletons_=[];goog.define('goog.LOAD_MODULE_USING_EVAL',true);
goog.define('goog.SEAL_MODULE_EXPORTS',goog.DEBUG);goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
if(goog.DEPENDENCIES_ENABLED){goog.included_={};goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}};goog.inHtmlDocument_=function(){var doc=goog.global.document;return typeof doc!='undefined'&&'write'in doc};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_())return;var doc=goog.global.document;var scripts=doc.getElementsByTagName('SCRIPT');for(var i=scripts.length-
1;i>=0;--i){var script=(scripts[i]);var src=script.src;var qmark=src.lastIndexOf('?');var l=qmark==-1?src.length:qmark;if(src.substr(l-7,7)=='base.js'){goog.basePath=src.substr(0,l-7);return}}};goog.importScript_=function(src,opt_sourceText){var importScript=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(importScript(src,opt_sourceText))goog.dependencies_.written[src]=true};goog.IS_OLD_IE_=!goog.global.atob&&goog.global.document&&goog.global.document.all;goog.importModule_=function(src){var bootstrap=
'goog.retrieveAndExecModule_("'+src+'");';if(goog.importScript_('',bootstrap))goog.dependencies_.written[src]=true};goog.queuedModules_=[];goog.wrapModule_=function(srcUrl,scriptText){if(!goog.LOAD_MODULE_USING_EVAL||!goog.isDef(goog.global.JSON))return''+'goog.loadModule(function(exports) {'+'"use strict";'+scriptText+'\n'+';return exports'+'});'+'\n//# sourceURL\x3d'+srcUrl+'\n';else return''+'goog.loadModule('+goog.global.JSON.stringify(scriptText+'\n//# sourceURL\x3d'+srcUrl+'\n')+');'};goog.loadQueuedModules_=
function(){var count=goog.queuedModules_.length;if(count>0){var queue=goog.queuedModules_;goog.queuedModules_=[];for(var i=0;i<count;i++){var path=queue[i];goog.maybeProcessDeferredPath_(path)}}};goog.maybeProcessDeferredDep_=function(name){if(goog.isDeferredModule_(name)&&goog.allDepsAreAvailable_(name)){var path=goog.getPathFromDeps_(name);goog.maybeProcessDeferredPath_(goog.basePath+path)}};goog.isDeferredModule_=function(name){var path=goog.getPathFromDeps_(name);if(path&&goog.dependencies_.pathIsModule[path]){var abspath=
goog.basePath+path;return abspath in goog.dependencies_.deferred}return false};goog.allDepsAreAvailable_=function(name){var path=goog.getPathFromDeps_(name);if(path&&path in goog.dependencies_.requires)for(var requireName in goog.dependencies_.requires[path])if(!goog.isProvided_(requireName)&&!goog.isDeferredModule_(requireName))return false;return true};goog.maybeProcessDeferredPath_=function(abspath){if(abspath in goog.dependencies_.deferred){var src=goog.dependencies_.deferred[abspath];delete goog.dependencies_.deferred[abspath];
goog.globalEval(src)}};goog.loadModule=function(moduleDef){var previousState=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:undefined,declareTestMethods:false};var exports;if(goog.isFunction(moduleDef))exports=moduleDef.call(goog.global,{});else if(goog.isString(moduleDef))exports=goog.loadModuleFromSource_.call(goog.global,moduleDef);else throw Error('Invalid module definition');var moduleName=goog.moduleLoaderState_.moduleName;if(!goog.isString(moduleName)||!moduleName)throw Error('Invalid module name "'+
moduleName+'"');if(goog.moduleLoaderState_.declareLegacyNamespace)goog.constructNamespace_(moduleName,exports);else if(goog.SEAL_MODULE_EXPORTS&&Object.seal)Object.seal(exports);goog.loadedModules_[moduleName]=exports;if(goog.moduleLoaderState_.declareTestMethods)for(var entry in exports)if(entry.indexOf('test',0)===0||entry=='tearDown'||entry=='setUp'||entry=='setUpPage'||entry=='tearDownPage')goog.global[entry]=exports[entry]}finally{goog.moduleLoaderState_=previousState}};goog.loadModuleFromSource_=
function(source){var exports={};eval(arguments[0]);return exports};goog.writeScriptSrcNode_=function(src){goog.global.document.write('\x3cscript type\x3d"text/javascript" src\x3d"'+src+'"\x3e\x3c/'+'script\x3e')};goog.appendScriptSrcNode_=function(src){var doc=goog.global.document;var scriptEl=doc.createElement('script');scriptEl.type='text/javascript';scriptEl.src=src;scriptEl.defer=false;scriptEl.async=false;doc.head.appendChild(scriptEl)};goog.writeScriptTag_=function(src,opt_sourceText){if(goog.inHtmlDocument_()){var doc=
goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&doc.readyState=='complete'){var isDeps=/\bdeps.js$/.test(src);if(isDeps)return false;else throw Error('Cannot write "'+src+'" after document load');}var isOldIE=goog.IS_OLD_IE_;if(opt_sourceText===undefined)if(!isOldIE)if(goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING)goog.appendScriptSrcNode_(src);else goog.writeScriptSrcNode_(src);else{var state=" onreadystatechange\x3d'goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+
")' ";doc.write('\x3cscript type\x3d"text/javascript" src\x3d"'+src+'"'+state+'\x3e\x3c/'+'script\x3e')}else doc.write('\x3cscript type\x3d"text/javascript"\x3e'+opt_sourceText+'\x3c/'+'script\x3e');return true}else return false};goog.lastNonModuleScriptIndex_=0;goog.onScriptLoad_=function(script,scriptIndex){if(script.readyState=='complete'&&goog.lastNonModuleScriptIndex_==scriptIndex)goog.loadQueuedModules_();return true};goog.writeScripts_=function(){var scripts=[];var seenScript={};var deps=goog.dependencies_;
function visitNode(path){if(path in deps.written)return;if(path in deps.visited){if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}return}deps.visited[path]=true;if(path in deps.requires)for(var requireName in deps.requires[path])if(!goog.isProvided_(requireName))if(requireName in deps.nameToPath)visitNode(deps.nameToPath[requireName]);else throw Error('Undefined nameToPath for '+requireName);if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}}for(var path in goog.included_)if(!deps.written[path])visitNode(path);
for(var i=0;i<scripts.length;i++){var path=scripts[i];goog.dependencies_.written[path]=true}var moduleState=goog.moduleLoaderState_;goog.moduleLoaderState_=null;var loadingModule=false;for(var i=0;i<scripts.length;i++){var path=scripts[i];if(path)if(!deps.pathIsModule[path])goog.importScript_(goog.basePath+path);else{loadingModule=true;goog.importModule_(goog.basePath+path)}else{goog.moduleLoaderState_=moduleState;throw Error('Undefined script input');}}goog.moduleLoaderState_=moduleState};goog.getPathFromDeps_=
function(rule){if(rule in goog.dependencies_.nameToPath)return goog.dependencies_.nameToPath[rule];else return null};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS)goog.importScript_(goog.basePath+'deps.js')}goog.normalizePath_=function(path){var components=path.split('/');var i=0;while(i<components.length)if(components[i]=='.')components.splice(i,1);else if(i&&components[i]=='..'&&components[i-1]&&components[i-1]!='..')components.splice(--i,2);else i++;return components.join('/')};
goog.loadFileSync_=function(src){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(src);else{var xhr=new goog.global['XMLHttpRequest'];xhr.open('get',src,false);xhr.send();return xhr.responseText}};
goog.retrieveAndExecModule_=function(src){if(!COMPILED){var originalPath=src;src=goog.normalizePath_(src);var importScript=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;var scriptText=goog.loadFileSync_(src);if(scriptText!=null){var execModuleScript=goog.wrapModule_(src,scriptText);var isOldIE=goog.IS_OLD_IE_;if(isOldIE){goog.dependencies_.deferred[originalPath]=execModuleScript;goog.queuedModules_.push(originalPath)}else importScript(src,execModuleScript)}else throw new Error('load of '+
src+'failed');}};
goog.typeOf=function(value){var s=typeof value;if(s=='object')if(value){if(value instanceof Array)return'array';else if(value instanceof Object)return s;var className=Object.prototype.toString.call((value));if(className=='[object Window]')return'object';if(className=='[object Array]'||typeof value.length=='number'&&typeof value.splice!='undefined'&&typeof value.propertyIsEnumerable!='undefined'&&!value.propertyIsEnumerable('splice'))return'array';if(className=='[object Function]'||typeof value.call!=
'undefined'&&typeof value.propertyIsEnumerable!='undefined'&&!value.propertyIsEnumerable('call'))return'function'}else return'null';else if(s=='function'&&typeof value.call=='undefined')return'object';return s};goog.isNull=function(val){return val===null};goog.isDefAndNotNull=function(val){return val!=null};goog.isArray=function(val){return goog.typeOf(val)=='array'};goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=='array'||type=='object'&&typeof val.length=='number'};
goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=='function'};goog.isString=function(val){return typeof val=='string'};goog.isBoolean=function(val){return typeof val=='boolean'};goog.isNumber=function(val){return typeof val=='number'};goog.isFunction=function(val){return goog.typeOf(val)=='function'};goog.isObject=function(val){var type=typeof val;return type=='object'&&val!=null||type=='function'};
goog.getUid=function(obj){return obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(obj){return!!obj[goog.UID_PROPERTY_]};goog.removeUid=function(obj){if('removeAttribute'in obj)obj.removeAttribute(goog.UID_PROPERTY_);try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_='closure_uid_'+(Math.random()*1E9>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;
goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=='object'||type=='array'){if(obj.clone)return obj.clone();var clone=type=='array'?[]:{};for(var key in obj)clone[key]=goog.cloneObject(obj[key]);return clone}return obj};goog.bindNative_=function(fn,selfObj,var_args){return(fn.call.apply(fn.bind,arguments))};
goog.bindJs_=function(fn,selfObj,var_args){if(!fn)throw new Error;if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(selfObj,newArgs)}}else return function(){return fn.apply(selfObj,arguments)}};
goog.bind=function(fn,selfObj,var_args){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf('native code')!=-1)goog.bind=goog.bindNative_;else goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=args.slice();newArgs.push.apply(newArgs,arguments);return fn.apply(this,newArgs)}};goog.mixin=function(target,source){for(var x in source)target[x]=source[x]};
goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(script){if(goog.global.execScript)goog.global.execScript(script,'JavaScript');else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval('var _evalTest_ \x3d 1;');if(typeof goog.global['_evalTest_']!='undefined'){try{delete goog.global['_evalTest_']}catch(ignore){}goog.evalWorksForGlobals_=true}else goog.evalWorksForGlobals_=false}if(goog.evalWorksForGlobals_)goog.global.eval(script);else{var doc=goog.global.document;var scriptElt=doc.createElement('SCRIPT');
scriptElt.type='text/javascript';scriptElt.defer=false;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else throw Error('goog.globalEval not available');};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;
goog.getCssName=function(className,opt_modifier){var getMapping=function(cssName){return goog.cssNameMapping_[cssName]||cssName};var renameByParts=function(cssName){var parts=cssName.split('-');var mapped=[];for(var i=0;i<parts.length;i++)mapped.push(getMapping(parts[i]));return mapped.join('-')};var rename;if(goog.cssNameMapping_)rename=goog.cssNameMappingStyle_=='BY_WHOLE'?getMapping:renameByParts;else rename=function(a){return a};if(opt_modifier)return className+'-'+rename(opt_modifier);else return rename(className)};
goog.setCssNameMapping=function(mapping,opt_style){goog.cssNameMapping_=mapping;goog.cssNameMappingStyle_=opt_style};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING)goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING;goog.getMsg=function(str,opt_values){if(opt_values)str=str.replace(/\{\$([^}]+)}/g,function(match,key){return key in opt_values?opt_values[key]:match});return str};goog.getMsgWithFallback=function(a,b){return a};
goog.exportSymbol=function(publicPath,object,opt_objectToExportTo){goog.exportPath_(publicPath,object,opt_objectToExportTo)};goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};
goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor;childCtor.prototype.constructor=childCtor;childCtor.base=function(me,methodName,var_args){var args=new Array(arguments.length-2);for(var i=2;i<arguments.length;i++)args[i-2]=arguments[i];return parentCtor.prototype[methodName].apply(me,args)}};
goog.base=function(me,opt_methodName,var_args){var caller=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!caller)throw Error('arguments.caller not defined.  goog.base() cannot be used '+'with strict mode code. See '+'http://www.ecma-international.org/ecma-262/5.1/#sec-C');if(caller.superClass_){var ctorArgs=new Array(arguments.length-1);for(var i=1;i<arguments.length;i++)ctorArgs[i-1]=arguments[i];return caller.superClass_.constructor.apply(me,ctorArgs)}var args=new Array(arguments.length-
2);for(var i=2;i<arguments.length;i++)args[i-2]=arguments[i];var foundCaller=false;for(var ctor=me.constructor;ctor;ctor=ctor.superClass_&&ctor.superClass_.constructor)if(ctor.prototype[opt_methodName]===caller)foundCaller=true;else if(foundCaller)return ctor.prototype[opt_methodName].apply(me,args);if(me[opt_methodName]===caller)return me.constructor.prototype[opt_methodName].apply(me,args);else throw Error('goog.base called from a method of one name '+'to a method of a different name');};
goog.scope=function(fn){fn.call(goog.global)};if(!COMPILED)goog.global['COMPILED']=COMPILED;
goog.defineClass=function(superClass,def){var constructor=def.constructor;var statics=def.statics;if(!constructor||constructor==Object.prototype.constructor)constructor=function(){throw Error('cannot instantiate an interface (no constructor defined).');};var cls=goog.defineClass.createSealingConstructor_(constructor,superClass);if(superClass)goog.inherits(cls,superClass);delete def.constructor;delete def.statics;goog.defineClass.applyProperties_(cls.prototype,def);if(statics!=null)if(statics instanceof
Function)statics(cls);else goog.defineClass.applyProperties_(cls,statics);return cls};goog.defineClass.ClassDescriptor;goog.define('goog.defineClass.SEAL_CLASS_INSTANCES',goog.DEBUG);
goog.defineClass.createSealingConstructor_=function(ctr,superClass){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(superClass&&superClass.prototype&&superClass.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return ctr;var wrappedCtr=function(){var instance=ctr.apply(this,arguments)||this;instance[goog.UID_PROPERTY_]=instance[goog.UID_PROPERTY_];if(this.constructor===wrappedCtr)Object.seal(instance);return instance};return wrappedCtr}return ctr};
goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=['constructor','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','valueOf'];goog.defineClass.applyProperties_=function(target,source){var key;for(key in source)if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key];for(var i=0;i<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;i++){key=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[i];if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key]}};
goog.tagUnsealableClass=function(ctr){if(!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES)ctr.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=true};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_='goog_defineClass_legacy_unsealable';goog.provide('org.apache.flex.utils.Language');org.apache.flex.utils.Language=function(){};org.apache.flex.utils.Language.sortNames;org.apache.flex.utils.Language.sortNamesOne=[];org.apache.flex.utils.Language.muler;org.apache.flex.utils.Language.zeroStr=String.fromCharCode(0);
org.apache.flex.utils.Language.as=function(leftOperand,rightOperand,coercion){coercion=typeof coercion!=='undefined'?coercion:null;var error,itIs,message;coercion=coercion!==undefined?coercion:false;itIs=org.apache.flex.utils.Language.is(leftOperand,rightOperand);if(!itIs&&coercion){message='Type Coercion failed';if(TypeError)error=new TypeError(message);else error=new Error(message);throw error;}return itIs?leftOperand:null};org.apache.flex.utils.Language._int=function(value){return value>>0};
org.apache.flex.utils.Language.string=function(value){return value==null?null:value.toString()};
org.apache.flex.utils.Language.is=function(leftOperand,rightOperand){var superClass;if(leftOperand==null||rightOperand==null)return false;if(leftOperand instanceof rightOperand)return true;if(rightOperand===Object)return true;if(typeof leftOperand==='string')return rightOperand===String;if(typeof leftOperand==='number')return rightOperand===Number;if(typeof leftOperand==='boolean')return rightOperand===Boolean;if(rightOperand===Array)return Array.isArray(leftOperand);if(leftOperand.FLEXJS_CLASS_INFO===
undefined)return false;if(leftOperand.FLEXJS_CLASS_INFO.interfaces)if(org.apache.flex.utils.Language.checkInterfaces(leftOperand,rightOperand))return true;superClass=leftOperand.constructor;superClass=superClass.superClass_;if(superClass)while(superClass&&superClass.FLEXJS_CLASS_INFO){if(superClass.FLEXJS_CLASS_INFO.interfaces)if(org.apache.flex.utils.Language.checkInterfaces(superClass,rightOperand))return true;superClass=superClass.constructor;superClass=superClass.superClass_}return false};
org.apache.flex.utils.Language.checkInterfaces=function(leftOperand,rightOperand){var i,interfaces;interfaces=leftOperand.FLEXJS_CLASS_INFO.interfaces;for(i=interfaces.length-1;i>-1;i--){if(interfaces[i]===rightOperand)return true;if(interfaces[i].prototype.FLEXJS_CLASS_INFO.interfaces){var isit=org.apache.flex.utils.Language.checkInterfaces(interfaces[i].prototype,rightOperand);if(isit)return true}}return false};
org.apache.flex.utils.Language.prototype.isClass=function(classDef){return typeof classDef==='function'&&classDef.prototype&&classDef.prototype.constructor===classDef};org.apache.flex.utils.Language.prototype.asClass=function(classDef){return this.isClass(classDef)?classDef:null};org.apache.flex.utils.Language.postdecrement=function(obj,prop){var value=Number(obj[prop]);obj[prop]=value-1;return value};
org.apache.flex.utils.Language.postincrement=function(obj,prop){var value=Number(obj[prop]);obj[prop]=value+1;return value};org.apache.flex.utils.Language.predecrement=function(obj,prop){var value=obj[prop]-1;obj[prop]=value;return value};org.apache.flex.utils.Language.preincrement=function(obj,prop){var value=Number(obj[prop]+1);obj[prop]=value;return value};
org.apache.flex.utils.Language.superGetter=function(clazz,pthis,prop){var superClass=clazz.superClass_;var superdesc=Object.getOwnPropertyDescriptor(superClass,prop);while(superdesc==null){superClass=superClass.constructor;superClass=superClass.superClass_;superdesc=Object.getOwnPropertyDescriptor(superClass,prop)}return superdesc.get.call(pthis)};
org.apache.flex.utils.Language.superSetter=function(clazz,pthis,prop,value){var superClass=clazz.superClass_;var superdesc=Object.getOwnPropertyDescriptor(superClass,prop);while(superdesc==null){superClass=superClass.constructor;superClass=superClass.superClass_;superdesc=Object.getOwnPropertyDescriptor(superClass,prop)}superdesc.set.apply(pthis,[value])};
org.apache.flex.utils.Language.trace=function(rest){rest=Array.prototype.slice.call(arguments,0);var theConsole;theConsole=goog.global.console;if(theConsole===undefined)if(typeof window!=='undefined')theConsole=window.console;else if(typeof console!=='undefined')theConsole=console;try{if(theConsole&&theConsole.log)theConsole.log.apply(theConsole,rest)}catch(e){}};org.apache.flex.utils.Language.uint=function(value){return value>>>0};
org.apache.flex.utils.Language.closure=function(fn,object,boundMethodName){if(object.hasOwnProperty(boundMethodName))return object[boundMethodName];var boundMethod=goog.bind(fn,object);Object.defineProperty(object,boundMethodName,{value:boundMethod});return boundMethod};
org.apache.flex.utils.Language.sortOn=function(arr,names,opt){opt=typeof opt!=='undefined'?opt:0;if(org.apache.flex.utils.Language.is(names,Array))org.apache.flex.utils.Language.sortNames=org.apache.flex.utils.Language.as(names,Array);else{org.apache.flex.utils.Language.sortNamesOne[0]=names;org.apache.flex.utils.Language.sortNames=org.apache.flex.utils.Language.sortNamesOne}if(org.apache.flex.utils.Language.is(opt,Array)){var opt2=0;var foreachiter0_target=opt;for(var foreachiter0 in foreachiter0_target){var o=
foreachiter0_target[foreachiter0];opt2=opt2|o}}else opt2=org.apache.flex.utils.Language.as(opt,Number);org.apache.flex.utils.Language.muler=(2&opt2)>0?-1:1;if(opt2&16)arr.sort(org.apache.flex.utils.Language.compareNumber);else if(opt2&1)arr.sort(org.apache.flex.utils.Language.compareStringCaseinsensitive);else arr.sort(org.apache.flex.utils.Language.compareString)};
org.apache.flex.utils.Language.compareStringCaseinsensitive=function(a,b){var foreachiter1_target=org.apache.flex.utils.Language.sortNames;for(var foreachiter1 in foreachiter1_target){var n=foreachiter1_target[foreachiter1];var v=Number((a[n]||org.apache.flex.utils.Language.zeroStr).toString().toLowerCase().localeCompare((b[n]||org.apache.flex.utils.Language.zeroStr).toString().toLowerCase()));if(v!=0)return v*org.apache.flex.utils.Language.muler}return 0};
org.apache.flex.utils.Language.compareString=function(a,b){var foreachiter2_target=org.apache.flex.utils.Language.sortNames;for(var foreachiter2 in foreachiter2_target){var n=foreachiter2_target[foreachiter2];var v=Number((a[n]||org.apache.flex.utils.Language.zeroStr).toString().localeCompare((b[n]||org.apache.flex.utils.Language.zeroStr).toString()));if(v!=0)return v*org.apache.flex.utils.Language.muler}return 0};
org.apache.flex.utils.Language.compareNumber=function(a,b){var foreachiter3_target=org.apache.flex.utils.Language.sortNames;for(var foreachiter3 in foreachiter3_target){var n=foreachiter3_target[foreachiter3];if(a[n]>b[n])return org.apache.flex.utils.Language.muler;else if(a[n]<b[n])return-org.apache.flex.utils.Language.muler}return 0};org.apache.flex.utils.Language.prototype.FLEXJS_CLASS_INFO={names:[{name:'Language',qName:'org.apache.flex.utils.Language'}]};
goog.exportSymbol('org.apache.flex.utils.Language',org.apache.flex.utils.Language);org.apache.flex.utils.Language.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'isClass':{type:'Boolean',declaredBy:'org.apache.flex.utils.Language'},'asClass':{type:'Class',declaredBy:'org.apache.flex.utils.Language'}}}}};goog.provide('weavejs.util.StandardLib');goog.require('org.apache.flex.utils.Language');weavejs.util.StandardLib=function(){};weavejs.util.StandardLib.lodash;weavejs.util.StandardLib.ol;weavejs.util.StandardLib.formatNumber=function(number,precision){precision=typeof precision!=='undefined'?precision:-1;return String(number)};
weavejs.util.StandardLib.asNumber=function(value){if(value==null)return NaN;if(org.apache.flex.utils.Language.is(value,Number)||org.apache.flex.utils.Language.is(value,Date))return Number(value);try{var str=String(value);if(str=='')return NaN;if(str.charAt(0)==='#')return Number('0x'+str.substr(1));if(str.charAt(str.length-1)==='%')return Number(str.substr(0,-1))/100;return Number(str)}catch(e){}return NaN};weavejs.util.StandardLib.asString=function(value){if(value==null)return'';return String(value)};
weavejs.util.StandardLib.asBoolean=function(value){if(org.apache.flex.utils.Language.is(value,Boolean))return value;if(org.apache.flex.utils.Language.is(value,String))return weavejs.util.StandardLib.stringCompare(value,'true',true)==0;if(isNaN(value))return false;if(org.apache.flex.utils.Language.is(value,Number))return value!=0;return value};weavejs.util.StandardLib.isDefined=function(value){return value!==undefined&&value!==null&&!(org.apache.flex.utils.Language.is(value,Number)&&isNaN(value))};
weavejs.util.StandardLib.isUndefined=function(value,orEmptyString){orEmptyString=typeof orEmptyString!=='undefined'?orEmptyString:false;return value===undefined||value===null||org.apache.flex.utils.Language.is(value,Number)&&isNaN(value)||orEmptyString&&value===''};
weavejs.util.StandardLib.lpad=function(str,length,padString){padString=typeof padString!=='undefined'?padString:' ';if(str.length>=length)return str;while(str.length+padString.length<length)padString+=padString;return padString.substr(0,length-str.length)+str};
weavejs.util.StandardLib.rpad=function(str,length,padString){padString=typeof padString!=='undefined'?padString:' ';if(str.length>=length)return str;while(str.length+padString.length<length)padString+=padString;return str+padString.substr(0,length-str.length)};
weavejs.util.StandardLib.replace=function(string,findStr,replaceStr,moreFindAndReplace){moreFindAndReplace=Array.prototype.slice.call(arguments,3);string=string.split(findStr).join(replaceStr);while(moreFindAndReplace.length>1){findStr=org.apache.flex.utils.Language.string(moreFindAndReplace.shift());replaceStr=org.apache.flex.utils.Language.string(moreFindAndReplace.shift());string=string.split(findStr).join(replaceStr)}return string};weavejs.util.StandardLib.argRef=new RegExp('^(0|[1-9][0-9]*)}');
weavejs.util.StandardLib.substitute=function(format,args){args=Array.prototype.slice.call(arguments,1);if(format==null)return'';if(args.length==1&&org.apache.flex.utils.Language.is(args[0],Array))args=org.apache.flex.utils.Language.as(args[0],Array);var split=format.split('{');var output=org.apache.flex.utils.Language.string(split[0]);for(var i=1;i<split.length;i++){var str=org.apache.flex.utils.Language.as(split[i],String);if(weavejs.util.StandardLib.argRef.test(str)){var j=str.indexOf('}');output+=
org.apache.flex.utils.Language.string(args[str.substring(0,j)]);output+=str.substring(j+1)}else output+='{'+str}return output};
weavejs.util.StandardLib.unIndent=function(script,spacesPerTab){spacesPerTab=typeof spacesPerTab!=='undefined'?spacesPerTab:-1;if(script==null)return null;script=weavejs.util.StandardLib.replace(script,'\r\n','\n','\r','\n');script=weavejs.util.StandardLib.trim('.'+script).substr(1);var lines=script.split('\n');while(lines.length&&!weavejs.util.StandardLib.trim(lines[0]))lines.shift();if(!lines.length)return'';var commonIndent=Number.MAX_VALUE;var line;var foreachiter0_target=lines;for(var foreachiter0 in foreachiter0_target){line=
foreachiter0_target[foreachiter0];if(!weavejs.util.StandardLib.trim(line))continue;var lineIndent=0;while(line.charAt(lineIndent)=='\t')lineIndent++;commonIndent=Math.min(commonIndent,lineIndent)}for(var i=0;i<lines.length;i++){line=org.apache.flex.utils.Language.string(lines[i]);var t=0;while(t<commonIndent&&line.charAt(t)=='\t')t++;var spaces='';if(spacesPerTab>=0)while(line.charAt(t)=='\t'){spaces+=weavejs.util.StandardLib.lpad('',spacesPerTab,'        ');t++}lines[i]=spaces+line.substr(t)}return lines.join('\n')};
weavejs.util.StandardLib.trim=function(str){if(str==null)return'';var startIndex=0;while(weavejs.util.StandardLib.isWhitespace(str.charAt(startIndex)))++startIndex;var endIndex=str.length-1;while(weavejs.util.StandardLib.isWhitespace(str.charAt(endIndex)))--endIndex;if(endIndex>=startIndex)return str.slice(startIndex,endIndex+1);else return''};
weavejs.util.StandardLib.isWhitespace=function(character){switch(character){case ' ':case '\t':case '\r':case '\n':case '\f':case '\u00a0':case '\u2028':case '\u2029':case '\u3000':return true;default:return false}};
weavejs.util.StandardLib.numberToBase=function(number,base,zeroPad){base=typeof base!=='undefined'?base:10;zeroPad=typeof zeroPad!=='undefined'?zeroPad:1;if(!isFinite(number))return null;var parts=Math.abs(number).toString(base).split('.');if(parts[0].length<zeroPad)parts[0]=weavejs.util.StandardLib.lpad(parts[0],zeroPad,'0');if(number<0)parts[0]='-'+parts[0];return parts.join('.')};weavejs.util.StandardLib.sign=function(value){if(value<0)return-1;return 1};
weavejs.util.StandardLib.constrain=function(value,min,max){if(value<min)return min;if(value>max)return max;return value};weavejs.util.StandardLib.normalize=function(value,min,max){if(value<min||value>max)return NaN;if(min==max)return value-min;return(value-min)/(max-min)};
weavejs.util.StandardLib.scale=function(inputValue,inputMin,inputMax,outputMin,outputMax){if(inputMin==inputMax){if(isNaN(inputValue))return NaN;if(inputValue>inputMax)return outputMax;return outputMin}return outputMin+(outputMax-outputMin)*(inputValue-inputMin)/(inputMax-inputMin)};
weavejs.util.StandardLib.roundSignificant=function(value,significantDigits){significantDigits=typeof significantDigits!=='undefined'?significantDigits:14;if(!isFinite(value))return value;var sign=value<0?-1:1;var absValue=Math.abs(value);var pow10;if(absValue<1){pow10=Math.pow(10,significantDigits);return sign*Math.round(absValue*pow10)/pow10}var log10=Math.ceil(Math.log(absValue)/Math.LN10);if(log10<significantDigits){pow10=Math.pow(10,significantDigits-log10);return sign*Math.round(absValue*pow10)/
pow10}else{pow10=Math.pow(10,log10-significantDigits);return sign*Math.round(absValue/pow10)*pow10}};weavejs.util.StandardLib.testRoundSignificant=function(){for(var pow=-5;pow<=5;pow++){var n=1234.5678*Math.pow(10,pow);for(var d=0;d<=9;d++)org.apache.flex.utils.Language.trace('roundSignificant(',n,',',d,') \x3d',weavejs.util.StandardLib.roundSignificant(n,d))}};weavejs.util.StandardLib.roundPrecision=function(number,precision){return Math.round(number/precision)*precision};
weavejs.util.StandardLib.suggestPrecision=function(n,d){return Math.pow(10,Math.min(0,Math.ceil(Math.log(n)/Math.LN10)-d))};
weavejs.util.StandardLib.interpolateColor=function(normValue,colors){colors=Array.prototype.slice.call(arguments,1);if(colors.length==1&&org.apache.flex.utils.Language.is(colors[0],Array))colors=colors[0];if(normValue<0||normValue>1||colors.length==0)return NaN;var maxIndex=colors.length-1;var leftIndex=org.apache.flex.utils.Language._int(maxIndex*normValue);var rightIndex=leftIndex+1;if(rightIndex==colors.length)return colors[leftIndex];var minColor=Number(colors[leftIndex]);var maxColor=Number(colors[rightIndex]);
normValue=normValue*maxIndex-leftIndex;var percentLeft=1-normValue;var percentRight=normValue;var R=16711680;var G=65280;var B=255;return percentLeft*(minColor&R)+percentRight*(maxColor&R)&R|percentLeft*(minColor&G)+percentRight*(maxColor&G)&G|percentLeft*(minColor&B)+percentRight*(maxColor&B)&B};weavejs.util.StandardLib.getColorLuma=function(color){return.3*((color&16711680)>>16)+.59*((color&65280)>>8)+.11*(color&255)};
weavejs.util.StandardLib.getHexColor=function(color){if(color!=(color&16777215))return null;return'#'+weavejs.util.StandardLib.numberToBase(color,16,6)};
weavejs.util.StandardLib.getNiceNumber=function(x,round){var exponent;var fractionalPart;var niceFractionalPart;if(x==0)return 0;exponent=Math.floor(Math.log(x)/Math.LN10);fractionalPart=x/Math.pow(10,exponent);if(round)if(fractionalPart<1.5)niceFractionalPart=1;else if(fractionalPart<3)niceFractionalPart=2;else if(fractionalPart<7)niceFractionalPart=5;else niceFractionalPart=10;else if(fractionalPart<=1)niceFractionalPart=1;else if(fractionalPart<=2)niceFractionalPart=2;else if(fractionalPart<5)niceFractionalPart=
5;else niceFractionalPart=10;return niceFractionalPart*Math.pow(10,exponent)};
weavejs.util.StandardLib.getNiceNumbersInRange=function(min,max,numberOfValuesInRange){if(min==max)return[min];var nfrac;var d;var graphmin;var graphmax;var range;var x;var i=0;var values=[];range=max-min;d=weavejs.util.StandardLib.getNiceNumber(range/(numberOfValuesInRange-1),true);graphmin=Math.floor(min/d)*d;graphmax=Math.ceil(max/d)*d;nfrac=Math.max(-Math.floor(Math.log(d)/Math.LN10),0);for(x=graphmin;x<graphmax+.5*d;x+=d)values[i++]=weavejs.util.StandardLib.roundSignificant(x);return values};
weavejs.util.StandardLib.mean=function(args){args=Array.prototype.slice.call(arguments,0);if(args.length==1&&org.apache.flex.utils.Language.is(args[0],Array))args=args[0];var sum=0;var foreachiter1_target=args;for(var foreachiter1 in foreachiter1_target){var value=foreachiter1_target[foreachiter1];sum+=value}return sum/args.length};
weavejs.util.StandardLib.sum=function(args){args=Array.prototype.slice.call(arguments,0);if(args.length==1&&org.apache.flex.utils.Language.is(args[0],Array))args=args[0];var sum=0;var foreachiter2_target=args;for(var foreachiter2 in foreachiter2_target){var value=foreachiter2_target[foreachiter2];sum+=value}return sum};weavejs.util.StandardLib.AS3_CASEINSENSITIVE=1;weavejs.util.StandardLib.AS3_DESCENDING=2;weavejs.util.StandardLib.AS3_UNIQUESORT=4;weavejs.util.StandardLib.AS3_RETURNINDEXEDARRAY=8;
weavejs.util.StandardLib.AS3_NUMERIC=16;weavejs.util.StandardLib.LODASH_ASCENDING='asc';weavejs.util.StandardLib.LODASH_DESCENDING='desc';weavejs.util.StandardLib._indexMap;
weavejs.util.StandardLib.as3SortOn=function(array,fieldNames,options){var __localFn0__=function(option){return option&weavejs.util.StandardLib.AS3_RETURNINDEXEDARRAY};var __localFn1__=function(option){return option&weavejs.util.StandardLib.AS3_UNIQUESORT};var __localFn2__=function(option){return option&weavejs.util.StandardLib.AS3_DESCENDING?weavejs.util.StandardLib.LODASH_DESCENDING:weavejs.util.StandardLib.LODASH_ASCENDING};var __localFn3__=function(option,index){var __localFn0__=function(item){if(item===
undefined||item===null)return'';return String(item[fieldName])};var __localFn1__=function(item){if(item===undefined||item===null)return'';return String(item[fieldName]).toLocaleLowerCase()};var customConvert;var fieldName=org.apache.flex.utils.Language.string(fieldNames[index]);if(!(option&weavejs.util.StandardLib.AS3_NUMERIC))customConvert=__localFn0__;else if(option&weavejs.util.StandardLib.AS3_CASEINSENSITIVE)customConvert=__localFn1__;return customConvert||fieldNames[index]};var __localFn4__=
function(item,index){weavejs.util.StandardLib._indexMap.set(item,index)};var __localFn5__=function(item){return weavejs.util.StandardLib._indexMap.get(item)};if(!org.apache.flex.utils.Language.is(fieldNames,Array))fieldNames=[fieldNames];if(!org.apache.flex.utils.Language.is(options,Array))options=[options];var returnIndexedArray=options.some(__localFn0__);var uniqueSort=options.some(__localFn1__);var orders=options.map(__localFn2__);var iteratees=options.map(__localFn3__);if(!weavejs.util.StandardLib._indexMap)weavejs.util.StandardLib._indexMap=
new weavejs.util.JS.Map;weavejs.util.StandardLib._indexMap.clear();if(returnIndexedArray){if(!weavejs.util.StandardLib.arrayIsType(array,Object))weavejs.util.JS.error("Warning: Can't do an indexed array sort of non-objects reliably, as there's a higher chance of non-unique items.");array.forEach(__localFn4__)}var result=weavejs.util.StandardLib.lodash.sortByOrder(array,iteratees,orders);if(returnIndexedArray)result=result.map(__localFn5__);return result};weavejs.util.StandardLib._sortBuffer=[];
weavejs.util.StandardLib.sortOn=function(array,params,sortDirections,inPlace,returnSortedIndexArray){sortDirections=typeof sortDirections!=='undefined'?sortDirections:undefined;inPlace=typeof inPlace!=='undefined'?inPlace:true;returnSortedIndexArray=typeof returnSortedIndexArray!=='undefined'?returnSortedIndexArray:false;if(array.length==0)return inPlace?array:[];var values;var param;var sortDirection;var i;for(i=weavejs.util.StandardLib._sortBuffer.length;i<array.length;i++)weavejs.util.StandardLib._sortBuffer[i]=
[];if(params===array||!org.apache.flex.utils.Language.is(params,Array)){params=[params];if(sortDirections)sortDirections=[sortDirections]}var fields=new Array(params.length);var fieldOptions=new Array(params.length);for(var p=0;p<params.length;p++){param=params[p];sortDirection=Number(sortDirections&&sortDirections[p]<0?weavejs.util.StandardLib.AS3_DESCENDING:0);i=Number(array.length);if(org.apache.flex.utils.Language.is(param,Array))while(i--)weavejs.util.StandardLib._sortBuffer[i][p]=param[i];else if(org.apache.flex.utils.Language.is(param,
Function))while(i--)weavejs.util.StandardLib._sortBuffer[i][p]=param(array[i]);else if(org.apache.flex.utils.Language.is(param,weavejs.util.JS.Map)||org.apache.flex.utils.Language.is(param,weavejs.util.JS.WeakMap))while(i--)weavejs.util.StandardLib._sortBuffer[i][p]=param.get(array[i]);else if(typeof param==='object')while(i--)weavejs.util.StandardLib._sortBuffer[i][p]=param[array[i]];else while(i--)weavejs.util.StandardLib._sortBuffer[i][p]=array[i][param];fields[p]=p;fieldOptions[p]=weavejs.util.StandardLib.AS3_RETURNINDEXEDARRAY|
weavejs.util.StandardLib.guessSortMode(weavejs.util.StandardLib._sortBuffer,p)|sortDirection}values=weavejs.util.StandardLib._sortBuffer.slice(0,array.length);values=weavejs.util.StandardLib.as3SortOn(values,fields,fieldOptions);if(returnSortedIndexArray)return values;var array2=new Array(array.length);i=Number(array.length);while(i--)array2[i]=array[values[i]];if(!inPlace)return array2;i=Number(array.length);while(i--)array[i]=array2[i];return array};
weavejs.util.StandardLib.guessSortMode=function(array,itemProp){var foreachiter3_target=array;for(var foreachiter3 in foreachiter3_target){var item=foreachiter3_target[foreachiter3];var value=item[itemProp];if(value!==undefined)return org.apache.flex.utils.Language.is(value,Number)||org.apache.flex.utils.Language.is(value,Date)?16:0}return 0};
weavejs.util.StandardLib.getArrayType=function(a){if(a==null||a.length==0||a[0]==null)return null;var type=Object(a[0]).constructor;var foreachiter4_target=a;for(var foreachiter4 in foreachiter4_target){var item=foreachiter4_target[foreachiter4];if(item==null||item.constructor!=type)return null}return type};
weavejs.util.StandardLib.arrayIsType=function(a,type){var foreachiter5_target=a;for(var foreachiter5 in foreachiter5_target){var item=foreachiter5_target[foreachiter5];if(!org.apache.flex.utils.Language.is(item,type))return false}return true};weavejs.util.StandardLib.logTransform=function(normValue,factor){factor=typeof factor!=='undefined'?factor:1024;return Math.log(1+normValue*factor)/Math.log(1+factor)};
weavejs.util.StandardLib.formatDate=function(value,formatString,formatAsUniversalTime){formatString=typeof formatString!=='undefined'?formatString:null;formatAsUniversalTime=typeof formatAsUniversalTime!=='undefined'?formatAsUniversalTime:true;if(org.apache.flex.utils.Language.is(value,Number)){var date=new Date;date.setTime(org.apache.flex.utils.Language.as(value,Number));value=date}return String(value)};weavejs.util.StandardLib._timezoneMultiplier=6E4;
weavejs.util.StandardLib.compare=function(a,b,objectCompare){objectCompare=typeof objectCompare!=='undefined'?objectCompare:null;var c;if(a===b)return 0;if(a==null)return 1;if(b==null)return-1;var typeA=typeof a;var typeB=typeof b;if(typeA!=typeB)return weavejs.util.StandardLib.stringCompare(typeA,typeB);if(typeA=='boolean')return weavejs.util.StandardLib.numericCompare(Number(a),Number(b));if(typeA=='number')return weavejs.util.StandardLib.numericCompare(org.apache.flex.utils.Language.as(a,Number),
org.apache.flex.utils.Language.as(b,Number));if(typeA=='string')return weavejs.util.StandardLib.stringCompare(org.apache.flex.utils.Language.as(a,String),org.apache.flex.utils.Language.as(b,String));if(typeA!='object')return 1;if(org.apache.flex.utils.Language.is(a,Date)&&org.apache.flex.utils.Language.is(b,Date))return weavejs.util.StandardLib.dateCompare(org.apache.flex.utils.Language.as(a,Date),org.apache.flex.utils.Language.as(b,Date));if(org.apache.flex.utils.Language.is(a,Array)&&org.apache.flex.utils.Language.is(b,
Array)){var an=Number(a.length);var bn=Number(b.length);if(an<bn)return-1;if(an>bn)return 1;for(var i=0;i<an;i++){c=weavejs.util.StandardLib.compare(a[i],b[i]);if(c!=0)return c}return 0}if(objectCompare!=null){var result=Number(objectCompare(a,b));if(isFinite(result))return result}var qna=String(a);var qnb=String(b);if(qna!=qnb)return weavejs.util.StandardLib.stringCompare(qna,qnb);var p;for(p in a)if(!b.hasOwnProperty(p))return-1;for(p in b){if(!a.hasOwnProperty(p))return 1;c=weavejs.util.StandardLib.compare(a[p],
b[p]);if(c!=0)return c}return 0};weavejs.util.StandardLib.numericCompare=function(a,b){if(isNaN(a)&&isNaN(b))return 0;if(isNaN(a))return 1;if(isNaN(b))return-1;if(a<b)return-1;if(a>b)return 1;return 0};
weavejs.util.StandardLib.stringCompare=function(a,b,caseInsensitive){caseInsensitive=typeof caseInsensitive!=='undefined'?caseInsensitive:false;if(a==null&&b==null)return 0;if(a==null)return 1;if(b==null)return-1;if(caseInsensitive){a=String(a).toLocaleLowerCase();b=String(b).toLocaleLowerCase()}var result=String(a).localeCompare(b);if(result<-1)result=-1;else if(result>1)result=1;return result};
weavejs.util.StandardLib.dateCompare=function(a,b){if(a==null&&b==null)return 0;if(a==null)return 1;if(b==null)return-1;var na=a.getTime();var nb=b.getTime();if(na<nb)return-1;if(na>nb)return 1;if(isNaN(na)&&isNaN(nb))return 0;if(isNaN(na))return 1;if(isNaN(nb))return-1;return 0};weavejs.util.StandardLib.ucs2encode=function(value){var output='';if(value>65535){value-=65536;output+=String.fromCharCode(value>>>10&1023|55296);value=56320|value&1023}return output+String.fromCharCode(value)};
weavejs.util.StandardLib.guid=function(){return weavejs.util.StandardLib.s4()+weavejs.util.StandardLib.s4()+'-'+weavejs.util.StandardLib.s4()+'-'+weavejs.util.StandardLib.s4()+'-'+weavejs.util.StandardLib.s4()+'-'+weavejs.util.StandardLib.s4()+weavejs.util.StandardLib.s4()+weavejs.util.StandardLib.s4()};weavejs.util.StandardLib.s4=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};
weavejs.util.StandardLib.byteArrayToString=function(byteArray){var CHUNK_SIZE=8192;var n=byteArray.length;if(n<=CHUNK_SIZE)return String.fromCharCode.apply(String,byteArray);var strings=[];for(var i=0;i<byteArray.length;)strings.push(String.fromCharCode.apply(null,byteArray.subarray(i,i+=CHUNK_SIZE)));return strings.join('')};weavejs.util.StandardLib.prototype.FLEXJS_CLASS_INFO={names:[{name:'StandardLib',qName:'weavejs.util.StandardLib'}]};goog.exportSymbol('weavejs.util.StandardLib',weavejs.util.StandardLib);
weavejs.util.StandardLib.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.util.JS');goog.require('weavejs.util.StandardLib');goog.require('org.apache.flex.utils.Language');weavejs.util.JS=function(){};weavejs.util.JS.getGlobal=function(name){var Fn=Function;var fn=new Fn('return '+name+';');return fn()};weavejs.util.JS.global=weavejs.util.JS.getGlobal('this');weavejs.util.JS.console=weavejs.util.JS.getGlobal('console');weavejs.util.JS.Symbol=weavejs.util.JS.getGlobal('Symbol');
weavejs.util.JS.error=function(args){args=Array.prototype.slice.call(arguments,0);weavejs.util.JS.console.error.apply(weavejs.util.JS.console,args)};weavejs.util.JS.log=function(args){args=Array.prototype.slice.call(arguments,0);weavejs.util.JS.console.log.apply(weavejs.util.JS.console,args)};weavejs.util.JS.unnamedFunctionRegExp=/^\s*function\s*\([^\)]*\)\s*\{[^]*\}\s*$/m;
weavejs.util.JS.compile=function(script,paramNames,errorHandler){paramNames=typeof paramNames!=='undefined'?paramNames:null;errorHandler=typeof errorHandler!=='undefined'?errorHandler:null;var __localFn0__=function(){try{return func.apply(this,arguments)}catch(e){if(org.apache.flex.utils.Language.is(e,SyntaxError)){args.pop();args.push(script);try{func=Function['apply'](null,args)}catch(e2){if(org.apache.flex.utils.Language.is(e2,SyntaxError))func=Function['apply']();return weavejs.util.JS.handleScriptError(e2,
'compiling',script,paramNames,errorHandler)}try{return func.apply(this,arguments)}catch(e3){return weavejs.util.JS.handleScriptError(e3,'evaluating',script,paramNames,errorHandler)}}return weavejs.util.JS.handleScriptError(e,'evaluating',script,paramNames,errorHandler)}};try{script=weavejs.util.StandardLib.replace(script,'\r\n','\n','\r','\n');var isFunc=weavejs.util.JS.unnamedFunctionRegExp.test(script);if(isFunc)script='('+weavejs.util.StandardLib.trim(script)+')';var args=(paramNames||[]).concat('return eval('+
JSON.stringify(script)+');');var func=Function['apply'](null,args);if(isFunc)func=func();return __localFn0__}catch(e){weavejs.util.JS.handleScriptError(e,'compiling',script,paramNames,errorHandler);throw e;}return null};
weavejs.util.JS.handleScriptError=function(e,doingWhat,script,paramNames,errorHandler){script=weavejs.util.StandardLib.replace(script,'\n','\n\t');script=weavejs.util.StandardLib.trim(script);var paramsStr=paramNames&&paramNames.length?' with params ('+paramNames.join(', ')+')':'';e.message=weavejs.util.StandardLib.substitute('Error {0} script{1}:\n\t{2}\n{3}',doingWhat,paramsStr,script,e.message);if(errorHandler!=null)return errorHandler(e);else throw e;};weavejs.util.JS.ArrayBuffer=weavejs.util.JS.getGlobal('ArrayBuffer');
weavejs.util.JS.Uint8Array=weavejs.util.JS.getGlobal('Uint8Array');weavejs.util.JS.DataView=weavejs.util.JS.getGlobal('DataView');weavejs.util.JS.Promise=weavejs.util.JS.getGlobal('Promise');weavejs.util.JS.Map=weavejs.util.JS.getGlobal('Map');weavejs.util.JS.WeakMap=weavejs.util.JS.getGlobal('WeakMap');weavejs.util.JS.mapKeys=function(map){return map?weavejs.util.JS.toArray(map.keys()):[]};weavejs.util.JS.mapValues=function(map){return map?weavejs.util.JS.toArray(map.values()):[]};
weavejs.util.JS.mapEntries=function(map){return map?weavejs.util.JS.toArray(map.entries()):[]};weavejs.util.JS.isIterable=function(value){return value&&typeof value[weavejs.util.JS.Symbol.iterator]==='function'};
weavejs.util.JS.toArray=function(value){if(org.apache.flex.utils.Language.is(value,Array))return value;if(value&&typeof value[weavejs.util.JS.Symbol.iterator]==='function'){var iterator=value[weavejs.util.JS.Symbol.iterator]();var values=[];while(true){var next=iterator.next();if(next.done)break;values.push(next.value)}return values}if(Object.prototype.toString.call(value)==='[object Arguments]')return Array.prototype.slice.call(value);return null};weavejs.util.JS.objectKeys=function(object){return Object['keys'](object)};
weavejs.util.JS.isPrimitive=function(value){return value===null||typeof value!=='object'};
weavejs.util.JS.copyObject=function(object,allowNonPrimitiveRefs){allowNonPrimitiveRefs=typeof allowNonPrimitiveRefs!=='undefined'?allowNonPrimitiveRefs:false;if(object===null||typeof object!=='object')return object;var copy;if(org.apache.flex.utils.Language.is(object,Array))copy=[];else if(Object['getPrototypeOf'](Object['getPrototypeOf'](object)))if(allowNonPrimitiveRefs)copy=object;else throw new Error('copyObject() cannot copy non-primitive Objects');else copy={};for(var key in object)copy[key]=
weavejs.util.JS.copyObject(object[key],allowNonPrimitiveRefs);return copy};weavejs.util.JS.bindAll=function(instance){var proto=Object['getPrototypeOf'](instance);for(var key in proto){var prop=proto[key];if(typeof prop==='function'&&key!=='constructor')instance[key]=prop.bind(instance)}return instance};weavejs.util.JS.isClass=function(classDef){return typeof classDef==='function'&&classDef.prototype&&classDef.prototype.constructor===classDef};
weavejs.util.JS.asClass=function(classDef){return weavejs.util.JS.isClass(classDef)?classDef:null};weavejs.util.JS.setTimeout=function(func,delay,params){params=Array.prototype.slice.call(arguments,2);params.unshift(func,delay);return weavejs.util.JS.global['setTimeout'].apply(weavejs.util.JS.global,params)};weavejs.util.JS.clearTimeout=function(id){weavejs.util.JS.global['clearTimeout'](id)};
weavejs.util.JS.setInterval=function(func,delay,params){params=Array.prototype.slice.call(arguments,2);params.unshift(func,delay);return weavejs.util.JS.global['setInterval'].apply(weavejs.util.JS.global,params)};weavejs.util.JS.clearInterval=function(id){weavejs.util.JS.global['clearInterval'](id)};weavejs.util.JS.requestAnimationFrame=function(func){return weavejs.util.JS.global['requestAnimationFrame'].call(weavejs.util.JS.global,func)};
weavejs.util.JS.cancelAnimationFrame=function(id){weavejs.util.JS.global['cancelAnimationFrame'].call(weavejs.util.JS.global,id)};weavejs.util.JS.now=function(){return Date['now']()};weavejs.util.JS.hasProperty=function(object,prop){while(object!=null&&!Object['getOwnPropertyDescriptor'](object,prop))object=Object['getPrototypeOf'](object);return object!=null};weavejs.util.JS.getOwnPropertyNames=function(object){return Object['getOwnPropertyNames'](object)};
weavejs.util.JS.getPropertyNames=function(object,useCache){if(object==null||object===Object.prototype)return[];if(!weavejs.util.JS.map_obj_names){weavejs.util.JS.map_obj_names=new weavejs.util.JS.WeakMap;weavejs.util.JS.map_prop_skip=new weavejs.util.JS.Map}if(useCache&&weavejs.util.JS.map_obj_names.has(object))return weavejs.util.JS.map_obj_names.get(object);var names=weavejs.util.JS.getPropertyNames(Object['getPrototypeOf'](object),useCache);if(useCache)names=names.concat();++weavejs.util.JS.skip_id;
var name;var foreachiter0_target=names;for(var foreachiter0 in foreachiter0_target){name=foreachiter0_target[foreachiter0];weavejs.util.JS.map_prop_skip.set(name,weavejs.util.JS.skip_id)}var ownNames=Object['getOwnPropertyNames'](object);var foreachiter1_target=ownNames;for(var foreachiter1 in foreachiter1_target){name=foreachiter1_target[foreachiter1];if(weavejs.util.JS.map_prop_skip.get(name)!==weavejs.util.JS.skip_id){weavejs.util.JS.map_prop_skip.set(name,weavejs.util.JS.skip_id);names.push(name)}}weavejs.util.JS.map_obj_names.set(object,
names);return names};weavejs.util.JS.map_obj_names;weavejs.util.JS.map_prop_skip;weavejs.util.JS.skip_id=0;weavejs.util.JS.prototype.FLEXJS_CLASS_INFO={names:[{name:'JS',qName:'weavejs.util.JS'}]};goog.exportSymbol('weavejs.util.JS',weavejs.util.JS);weavejs.util.JS.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.api.core.IClassRegistry');weavejs.api.core.IClassRegistry=function(){};weavejs.api.core.IClassRegistry.prototype.registerClass=function(definition,qualifiedName,interfaces,displayName){};weavejs.api.core.IClassRegistry.prototype.getClassName=function(definition){};weavejs.api.core.IClassRegistry.prototype.getDefinition=function(name){};weavejs.api.core.IClassRegistry.prototype.getClassInfo=function(class_or_instance){};
weavejs.api.core.IClassRegistry.prototype.getSingletonInstance=function(theInterface){};weavejs.api.core.IClassRegistry.prototype.registerImplementation=function(theInterface,theImplementation,displayName){};weavejs.api.core.IClassRegistry.prototype.getImplementations=function(theInterface){};weavejs.api.core.IClassRegistry.prototype.getDisplayName=function(theImplementation){};weavejs.api.core.IClassRegistry.prototype.FLEXJS_CLASS_INFO={names:[{name:'IClassRegistry',qName:'weavejs.api.core.IClassRegistry'}]};
weavejs.api.core.IClassRegistry.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'registerClass':{type:'void',declaredBy:'weavejs.api.core.IClassRegistry'},'getClassName':{type:'String',declaredBy:'weavejs.api.core.IClassRegistry'},'getDefinition':{type:'*',declaredBy:'weavejs.api.core.IClassRegistry'},'getClassInfo':{type:'Object',declaredBy:'weavejs.api.core.IClassRegistry'},'getSingletonInstance':{type:'*',
declaredBy:'weavejs.api.core.IClassRegistry'},'registerImplementation':{type:'void',declaredBy:'weavejs.api.core.IClassRegistry'},'getImplementations':{type:'Array',declaredBy:'weavejs.api.core.IClassRegistry'},'getDisplayName':{type:'String',declaredBy:'weavejs.api.core.IClassRegistry'}}}}};goog.provide('weavejs.core.ClassRegistryImpl');goog.require('weavejs.util.JS');goog.require('weavejs.api.core.IClassRegistry');goog.require('org.apache.flex.utils.Language');weavejs.core.ClassRegistryImpl=function(){this.map_interface_singletonInstance=new weavejs.util.JS.Map;this.map_interface_implementations=new weavejs.util.JS.Map;this.map_class_displayName=new weavejs.util.JS.Map;this.map_name_class=new weavejs.util.JS.Map;this.map_class_name=new weavejs.util.JS.Map;this.defaultPackages=[]};weavejs.core.ClassRegistryImpl.prototype.map_interface_singletonInstance;
weavejs.core.ClassRegistryImpl.prototype.map_interface_implementations;weavejs.core.ClassRegistryImpl.prototype.map_class_displayName;weavejs.core.ClassRegistryImpl.prototype.map_name_class;weavejs.core.ClassRegistryImpl.prototype.map_class_name;weavejs.core.ClassRegistryImpl.prototype.defaultPackages;weavejs.core.ClassRegistryImpl.FLEXJS_CLASS_INFO='FLEXJS_CLASS_INFO';weavejs.core.ClassRegistryImpl.NAMES='names';weavejs.core.ClassRegistryImpl.NAME='name';weavejs.core.ClassRegistryImpl.QNAME='qName';
weavejs.core.ClassRegistryImpl.INTERFACES='interfaces';
weavejs.core.ClassRegistryImpl.prototype.registerClass=function(definition,qualifiedName,interfaces,displayName){interfaces=typeof interfaces!=='undefined'?interfaces:null;displayName=typeof displayName!=='undefined'?displayName:null;if(!this.map_name_class.has(qualifiedName))this.map_name_class.set(qualifiedName,definition);if(!this.map_class_name.has(definition))this.map_class_name.set(definition,qualifiedName);var shortName=org.apache.flex.utils.Language.string(qualifiedName.split('.').pop().split(':').pop());if(!this.map_name_class.has(shortName))this.map_name_class.set(shortName,
definition);var info;var items;var item;if(Object(definition.prototype).hasOwnProperty(weavejs.core.ClassRegistryImpl.FLEXJS_CLASS_INFO))info=definition.prototype[weavejs.core.ClassRegistryImpl.FLEXJS_CLASS_INFO];else info=definition.prototype[weavejs.core.ClassRegistryImpl.FLEXJS_CLASS_INFO]={};var found=false;items=info[weavejs.core.ClassRegistryImpl.NAMES]||(info[weavejs.core.ClassRegistryImpl.NAMES]=[]);var foreachiter0_target=items;for(var foreachiter0 in foreachiter0_target){item=foreachiter0_target[foreachiter0];
if(item[weavejs.core.ClassRegistryImpl.QNAME]==qualifiedName){found=true;break}}if(!found){item={};item[weavejs.core.ClassRegistryImpl.NAME]=shortName;item[weavejs.core.ClassRegistryImpl.QNAME]=qualifiedName;items.push(item)}items=info[weavejs.core.ClassRegistryImpl.INTERFACES]||(info[weavejs.core.ClassRegistryImpl.INTERFACES]=[]);var foreachiter1_target=interfaces;for(var foreachiter1 in foreachiter1_target){item=foreachiter1_target[foreachiter1];if(items.indexOf(item)<0)items.push(item);this.registerImplementation(item,
definition,displayName)}};weavejs.core.ClassRegistryImpl.prototype.getClassName=function(definition){if(!definition)return null;if(!definition.prototype)definition=definition.constructor;if(definition.prototype&&definition.prototype[weavejs.core.ClassRegistryImpl.FLEXJS_CLASS_INFO])return definition.prototype[weavejs.core.ClassRegistryImpl.FLEXJS_CLASS_INFO].names[0].qName;if(this.map_class_name.has(definition))return this.map_class_name.get(definition);return definition.name};
weavejs.core.ClassRegistryImpl.prototype.getDefinition=function(name){var def=this.map_name_class.get(name);if(def||!name)return def;def=this.evalChain(name);if(!def){var shortName=org.apache.flex.utils.Language.string(name.split('.').pop().split('::').pop());var foreachiter2_target=this.defaultPackages;for(var foreachiter2 in foreachiter2_target){var pkg=foreachiter2_target[foreachiter2];var qName=pkg?pkg+'.'+shortName:shortName;def=this.map_name_class.get(qName)||this.evalChain(qName);if(def)break}}if(def)this.map_name_class.set(name,
def);return def};weavejs.core.ClassRegistryImpl.prototype.evalChain=function(name){var chain=name.split('.');var def=weavejs.util.JS.global;var foreachiter3_target=chain;for(var foreachiter3 in foreachiter3_target){var key=foreachiter3_target[foreachiter3];if(!def)break;try{def=def[key]}catch(e){def=undefined}}return def};
weavejs.core.ClassRegistryImpl.prototype.getClassInfo=function(class_or_instance){if(!class_or_instance)return null;if(!class_or_instance.prototype)class_or_instance=class_or_instance.constructor;var info=class_or_instance&&class_or_instance.prototype&&class_or_instance.prototype.FLEXJS_REFLECTION_INFO;if(org.apache.flex.utils.Language.is(info,Function)){info=info();info.variables=info.variables();info.accessors=info.accessors();info.methods=info.methods()}return info};
weavejs.core.ClassRegistryImpl.prototype.getSingletonInstance=function(theInterface){if(!this.map_interface_singletonInstance.get(theInterface)){var classDef=this.getImplementations(theInterface)[0];if(classDef)this.map_interface_singletonInstance.set(theInterface,new classDef)}return this.map_interface_singletonInstance.get(theInterface)};
weavejs.core.ClassRegistryImpl.prototype.registerImplementation=function(theInterface,theImplementation,displayName){displayName=typeof displayName!=='undefined'?displayName:null;this.verifyImplementation(theInterface,theImplementation);var array=this.map_interface_implementations.get(theInterface);if(!array)this.map_interface_implementations.set(theInterface,array=[]);if(displayName||!this.map_class_displayName.get(theImplementation))this.map_class_displayName.set(theImplementation,displayName||
this.getClassName(theImplementation).split(':').pop());if(array.indexOf(theImplementation)<0){array.push(theImplementation);array.sort(org.apache.flex.utils.Language.closure(this.compareDisplayNames,this,'compareDisplayNames'))}};weavejs.core.ClassRegistryImpl.prototype.getImplementations=function(theInterface){var array=this.map_interface_implementations.get(theInterface);return array?array.concat():[]};
weavejs.core.ClassRegistryImpl.prototype.getDisplayName=function(theImplementation){var str=org.apache.flex.utils.Language.string(this.map_class_displayName.get(theImplementation));return str};weavejs.core.ClassRegistryImpl.prototype.compareDisplayNames=function(impl1,impl2){var name1=org.apache.flex.utils.Language.string(this.map_class_displayName.get(impl1));var name2=org.apache.flex.utils.Language.string(this.map_class_displayName.get(impl2));if(name1<name2)return-1;if(name1>name2)return 1;return 0};
weavejs.core.ClassRegistryImpl.prototype.verifyImplementation=function(theInterface,theImplementation){if(!theInterface)throw new Error('interface cannot be '+theInterface+' check '+theImplementation);if(!theImplementation)throw new Error('implementation cannot be '+theImplementation);if(!org.apache.flex.utils.Language.is(theImplementation.prototype,theInterface))throw new Error(this.getClassName(theImplementation)+' does not implement '+this.getClassName(theInterface));};
weavejs.core.ClassRegistryImpl.partitionClassList=function(classes,interfaces){interfaces=Array.prototype.slice.call(arguments,1);var __localFn0__=function(impl,i,a){if(org.apache.flex.utils.Language.is(impl.prototype,interfaceClass)){partition.push(impl);return false}return true};if(interfaces.length==1&&org.apache.flex.utils.Language.is(interfaces[0],Array))interfaces=interfaces[0];var partitions=[];var foreachiter4_target=interfaces;for(var foreachiter4 in foreachiter4_target){var interfaceClass=
foreachiter4_target[foreachiter4];var partition=[];classes=classes.filter(__localFn0__);partitions.push(partition)}partitions.push(classes);return partitions};weavejs.core.ClassRegistryImpl.prototype.FLEXJS_CLASS_INFO={names:[{name:'ClassRegistryImpl',qName:'weavejs.core.ClassRegistryImpl'}],interfaces:[weavejs.api.core.IClassRegistry]};goog.exportSymbol('weavejs.core.ClassRegistryImpl',weavejs.core.ClassRegistryImpl);
weavejs.core.ClassRegistryImpl.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'map_interface_singletonInstance':{type:'Object'},'map_interface_implementations':{type:'Object'},'map_class_displayName':{type:'Object'},'map_name_class':{type:'Object'},'map_class_name':{type:'Object'},'defaultPackages':{type:'Array'}}},accessors:function(){return{}},methods:function(){return{'ClassRegistryImpl':{type:'',declaredBy:'weavejs.core.ClassRegistryImpl'},'registerClass':{type:'void',
declaredBy:'weavejs.core.ClassRegistryImpl'},'getClassName':{type:'String',declaredBy:'weavejs.core.ClassRegistryImpl'},'getDefinition':{type:'*',declaredBy:'weavejs.core.ClassRegistryImpl'},'getClassInfo':{type:'Object',declaredBy:'weavejs.core.ClassRegistryImpl'},'getSingletonInstance':{type:'*',declaredBy:'weavejs.core.ClassRegistryImpl'},'registerImplementation':{type:'void',declaredBy:'weavejs.core.ClassRegistryImpl'},'getImplementations':{type:'Array',declaredBy:'weavejs.core.ClassRegistryImpl'},
'getDisplayName':{type:'String',declaredBy:'weavejs.core.ClassRegistryImpl'},'verifyImplementation':{type:'void',declaredBy:'weavejs.core.ClassRegistryImpl'}}}}};goog.provide('weavejs.api.core.ILocale');weavejs.api.core.ILocale=function(){};weavejs.api.core.ILocale.prototype.reverseLayout;weavejs.api.core.ILocale.prototype.getText=function(text){};weavejs.api.core.ILocale.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILocale',qName:'weavejs.api.core.ILocale'}]};
weavejs.api.core.ILocale.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'reverseLayout':{type:'Boolean',declaredBy:'weavejs.api.core.ILocale'},'data':{type:'Object',declaredBy:'weavejs.api.core.ILocale'}}},methods:function(){return{'getText':{type:'String',declaredBy:'weavejs.api.core.ILocale'}}}}};goog.provide('weavejs.api.core.ILinkableObject');weavejs.api.core.ILinkableObject=function(){};weavejs.api.core.ILinkableObject.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableObject',qName:'weavejs.api.core.ILinkableObject'}]};weavejs.api.core.ILinkableObject.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.api.core.IProgressIndicator');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.core.IProgressIndicator=function(){};weavejs.api.core.IProgressIndicator.prototype.getTaskCount=function(){};weavejs.api.core.IProgressIndicator.prototype.addTask=function(taskToken,busyObject,description){};weavejs.api.core.IProgressIndicator.prototype.hasTask=function(taskToken){};weavejs.api.core.IProgressIndicator.prototype.updateTask=function(taskToken,progress){};
weavejs.api.core.IProgressIndicator.prototype.removeTask=function(taskToken){};weavejs.api.core.IProgressIndicator.prototype.getNormalizedProgress=function(){};weavejs.api.core.IProgressIndicator.prototype.FLEXJS_CLASS_INFO={names:[{name:'IProgressIndicator',qName:'weavejs.api.core.IProgressIndicator'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.core.IProgressIndicator.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'getTaskCount':{type:'int',declaredBy:'weavejs.api.core.IProgressIndicator'},'addTask':{type:'void',declaredBy:'weavejs.api.core.IProgressIndicator'},'hasTask':{type:'Boolean',declaredBy:'weavejs.api.core.IProgressIndicator'},'updateTask':{type:'void',declaredBy:'weavejs.api.core.IProgressIndicator'},'removeTask':{type:'void',
declaredBy:'weavejs.api.core.IProgressIndicator'},'getNormalizedProgress':{type:'Number',declaredBy:'weavejs.api.core.IProgressIndicator'}}}}};goog.provide('weavejs.api.core.IScheduler');weavejs.api.core.IScheduler=function(){};weavejs.api.core.IScheduler.prototype.frameCallbacks;weavejs.api.core.IScheduler.prototype.callLater=function(relevantContext,method,parameters){};weavejs.api.core.IScheduler.prototype.startTask=function(relevantContext,iterativeTask,priority,finalCallback,description){};weavejs.api.core.IScheduler.prototype.FLEXJS_CLASS_INFO={names:[{name:'IScheduler',qName:'weavejs.api.core.IScheduler'}]};
weavejs.api.core.IScheduler.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'frameCallbacks':{type:'ICallbackCollection',declaredBy:'weavejs.api.core.IScheduler'}}},methods:function(){return{'callLater':{type:'void',declaredBy:'weavejs.api.core.IScheduler'},'startTask':{type:'void',declaredBy:'weavejs.api.core.IScheduler'}}}}};goog.provide('weavejs.api.core.ISessionManager');weavejs.api.core.ISessionManager=function(){};weavejs.api.core.ISessionManager.prototype.getCallbackCollection=function(linkableObject){};weavejs.api.core.ISessionManager.prototype.getLinkableObjectFromCallbackCollection=function(callbackCollection){};weavejs.api.core.ISessionManager.prototype.newLinkableChild=function(linkableParent,linkableChildType,callback,useGroupedCallback){};
weavejs.api.core.ISessionManager.prototype.registerLinkableChild=function(linkableParent,linkableChild,callback,useGroupedCallback){};weavejs.api.core.ISessionManager.prototype.newDisposableChild=function(disposableParent,disposableChildType){};weavejs.api.core.ISessionManager.prototype.registerDisposableChild=function(disposableParent,disposableChild){};weavejs.api.core.ISessionManager.prototype.getOwner=function(child){};weavejs.api.core.ISessionManager.prototype.getLinkableOwner=function(child){};
weavejs.api.core.ISessionManager.prototype.getLinkableDescendants=function(root,filter){};weavejs.api.core.ISessionManager.prototype.assignBusyTask=function(taskToken,busyObject){};weavejs.api.core.ISessionManager.prototype.unassignBusyTask=function(taskToken){};weavejs.api.core.ISessionManager.prototype.linkableObjectIsBusy=function(linkableObject){};weavejs.api.core.ISessionManager.prototype.setSessionState=function(linkableObject,newState,removeMissingDynamicObjects){};
weavejs.api.core.ISessionManager.prototype.getSessionState=function(linkableObject){};weavejs.api.core.ISessionManager.prototype.computeDiff=function(oldState,newState){};weavejs.api.core.ISessionManager.prototype.combineDiff=function(baseDiff,diffToAdd){};weavejs.api.core.ISessionManager.prototype.copySessionState=function(source,destination){};weavejs.api.core.ISessionManager.prototype.linkSessionState=function(primary,secondary){};
weavejs.api.core.ISessionManager.prototype.unlinkSessionState=function(first,second){};weavejs.api.core.ISessionManager.prototype.disposeObject=function(object){};weavejs.api.core.ISessionManager.prototype.objectWasDisposed=function(object){};weavejs.api.core.ISessionManager.prototype.getPath=function(root,descendant){};weavejs.api.core.ISessionManager.prototype.getObject=function(root,path){};weavejs.api.core.ISessionManager.prototype.FLEXJS_CLASS_INFO={names:[{name:'ISessionManager',qName:'weavejs.api.core.ISessionManager'}]};
weavejs.api.core.ISessionManager.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'getCallbackCollection':{type:'ICallbackCollection',declaredBy:'weavejs.api.core.ISessionManager'},'getLinkableObjectFromCallbackCollection':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ISessionManager'},'newLinkableChild':{type:'*',declaredBy:'weavejs.api.core.ISessionManager'},'registerLinkableChild':{type:'*',declaredBy:'weavejs.api.core.ISessionManager'},
'newDisposableChild':{type:'*',declaredBy:'weavejs.api.core.ISessionManager'},'registerDisposableChild':{type:'*',declaredBy:'weavejs.api.core.ISessionManager'},'getOwner':{type:'Object',declaredBy:'weavejs.api.core.ISessionManager'},'getLinkableOwner':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ISessionManager'},'getLinkableDescendants':{type:'Array',declaredBy:'weavejs.api.core.ISessionManager'},'assignBusyTask':{type:'void',declaredBy:'weavejs.api.core.ISessionManager'},'unassignBusyTask':{type:'void',
declaredBy:'weavejs.api.core.ISessionManager'},'linkableObjectIsBusy':{type:'Boolean',declaredBy:'weavejs.api.core.ISessionManager'},'setSessionState':{type:'void',declaredBy:'weavejs.api.core.ISessionManager'},'getSessionState':{type:'Object',declaredBy:'weavejs.api.core.ISessionManager'},'computeDiff':{type:'*',declaredBy:'weavejs.api.core.ISessionManager'},'combineDiff':{type:'Object',declaredBy:'weavejs.api.core.ISessionManager'},'copySessionState':{type:'void',declaredBy:'weavejs.api.core.ISessionManager'},
'linkSessionState':{type:'void',declaredBy:'weavejs.api.core.ISessionManager'},'unlinkSessionState':{type:'void',declaredBy:'weavejs.api.core.ISessionManager'},'disposeObject':{type:'void',declaredBy:'weavejs.api.core.ISessionManager'},'objectWasDisposed':{type:'Boolean',declaredBy:'weavejs.api.core.ISessionManager'},'getPath':{type:'Array',declaredBy:'weavejs.api.core.ISessionManager'},'getObject':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ISessionManager'}}}}};goog.provide('weavejs.api.ui.IEditorManager');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.ui.IEditorManager=function(){};weavejs.api.ui.IEditorManager.prototype.setLabel=function(object,label){};weavejs.api.ui.IEditorManager.prototype.getLabel=function(object){};weavejs.api.ui.IEditorManager.prototype.FLEXJS_CLASS_INFO={names:[{name:'IEditorManager',qName:'weavejs.api.ui.IEditorManager'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.ui.IEditorManager.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'setLabel':{type:'void',declaredBy:'weavejs.api.ui.IEditorManager'},'getLabel':{type:'String',declaredBy:'weavejs.api.ui.IEditorManager'}}}}};goog.provide('weavejs.WeaveAPI');goog.require('weavejs.core.ClassRegistryImpl');goog.require('weavejs.util.JS');goog.require('weavejs.api.core.ILocale');goog.require('org.apache.flex.utils.Language');weavejs.WeaveAPI=function(){};weavejs.WeaveAPI.debugAsyncStack=false;weavejs.WeaveAPI.debugLocale=false;weavejs.WeaveAPI.TASK_PRIORITY_IMMEDIATE=0;weavejs.WeaveAPI.TASK_PRIORITY_HIGH=1;weavejs.WeaveAPI.TASK_PRIORITY_NORMAL=2;weavejs.WeaveAPI.TASK_PRIORITY_LOW=3;weavejs.WeaveAPI._classRegistry=null;
Object.defineProperties(weavejs.WeaveAPI,{ClassRegistry:{get:function(){if(!weavejs.WeaveAPI._classRegistry)weavejs.WeaveAPI._classRegistry=new weavejs.core.ClassRegistryImpl;return weavejs.WeaveAPI._classRegistry}},SessionManager:{get:function(){return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(weavejs.api.core.ISessionManager)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(weavejs.api.core.ISessionManager)}},
Scheduler:{get:function(){return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(weavejs.api.core.IScheduler)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(weavejs.api.core.IScheduler)}},ProgressIndicator:{get:function(){return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(weavejs.api.core.IProgressIndicator)||
weavejs.WeaveAPI._classRegistry.getSingletonInstance(weavejs.api.core.IProgressIndicator)}},AttributeColumnCache:{get:function(){var IAttributeColumnCache=weavejs.util.JS.global['weavejs']['api']['data']['IAttributeColumnCache'];return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(IAttributeColumnCache)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(IAttributeColumnCache)}},
StatisticsCache:{get:function(){var IStatisticsCache=weavejs.util.JS.global['weavejs']['api']['data']['IStatisticsCache'];return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(IStatisticsCache)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(IStatisticsCache)}},QKeyManager:{get:function(){var IQualifiedKeyManager=weavejs.util.JS.global['weavejs']['api']['data']['IQualifiedKeyManager'];
return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(IQualifiedKeyManager)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(IQualifiedKeyManager)}},CSVParser:{get:function(){var ICSVParser=weavejs.util.JS.global['weavejs']['api']['data']['ICSVParser'];return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(ICSVParser)||
weavejs.WeaveAPI._classRegistry.getSingletonInstance(ICSVParser)}},URLRequestUtils:{get:function(){var IURLRequestUtils=weavejs.util.JS.global['weavejs']['api']['net']['IURLRequestUtils'];return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(IURLRequestUtils)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(IURLRequestUtils)}},Locale:{get:function(){return(weavejs.WeaveAPI._classRegistry||
org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(weavejs.api.core.ILocale)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(weavejs.api.core.ILocale)}},EditorManager:{get:function(){return(weavejs.WeaveAPI._classRegistry||org.apache.flex.utils.Language.as(weavejs.WeaveAPI.ClassRegistry,weavejs.core.ClassRegistryImpl)).map_interface_singletonInstance.get(weavejs.api.ui.IEditorManager)||weavejs.WeaveAPI._classRegistry.getSingletonInstance(weavejs.api.ui.IEditorManager)}}});
weavejs.WeaveAPI.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeaveAPI',qName:'weavejs.WeaveAPI'}]};goog.exportSymbol('weavejs.WeaveAPI',weavejs.WeaveAPI);weavejs.WeaveAPI.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.api.core.DynamicState');weavejs.api.core.DynamicState=function(){};
weavejs.api.core.DynamicState.create=function(objectName,className,sessionState){objectName=typeof objectName!=='undefined'?objectName:null;className=typeof className!=='undefined'?className:null;sessionState=typeof sessionState!=='undefined'?sessionState:null;var obj={};obj[weavejs.api.core.DynamicState.OBJECT_NAME]=objectName||null;obj[weavejs.api.core.DynamicState.CLASS_NAME]=className||null;obj[weavejs.api.core.DynamicState.SESSION_STATE]=sessionState;return obj};
weavejs.api.core.DynamicState.OBJECT_NAME='objectName';weavejs.api.core.DynamicState.CLASS_NAME='className';weavejs.api.core.DynamicState.SESSION_STATE='sessionState';weavejs.api.core.DynamicState.BYPASS_DIFF='bypassDiff';
weavejs.api.core.DynamicState.isDynamicState=function(object,handleBypassDiff){handleBypassDiff=typeof handleBypassDiff!=='undefined'?handleBypassDiff:false;if(typeof object!=='object')return false;var matchCount=0;for(var name in object)if(name===weavejs.api.core.DynamicState.OBJECT_NAME||name===weavejs.api.core.DynamicState.CLASS_NAME||name===weavejs.api.core.DynamicState.SESSION_STATE)matchCount++;else if(handleBypassDiff&&name===weavejs.api.core.DynamicState.BYPASS_DIFF)continue;else return false;
return matchCount==3};
weavejs.api.core.DynamicState.isDynamicStateArray=function(state,handleBypassDiff){handleBypassDiff=typeof handleBypassDiff!=='undefined'?handleBypassDiff:false;var array=org.apache.flex.utils.Language.as(state,Array);if(!array)return false;var result=false;var foreachiter0_target=array;for(var foreachiter0 in foreachiter0_target){var item=foreachiter0_target[foreachiter0];if(typeof item==='string')continue;if(weavejs.api.core.DynamicState.isDynamicState(item,handleBypassDiff))result=true;else return false}return result};
weavejs.api.core.DynamicState.alterSessionStateToBypassDiff=function(object){if(weavejs.api.core.DynamicState.isDynamicState(object)){object[weavejs.api.core.DynamicState.BYPASS_DIFF]=true;object=object[weavejs.api.core.DynamicState.SESSION_STATE]}if(typeof object==='object')for(var key in object)weavejs.api.core.DynamicState.alterSessionStateToBypassDiff(object[key])};
weavejs.api.core.DynamicState.removeTypeFromState=function(state,recursive){recursive=typeof recursive!=='undefined'?recursive:true;if(weavejs.api.core.DynamicState.isDynamicStateArray(state)){var newState={};var foreachiter1_target=state;for(var foreachiter1 in foreachiter1_target){var typedState=foreachiter1_target[foreachiter1];if(typeof typedState==='object')newState[typedState[weavejs.api.core.DynamicState.OBJECT_NAME]||'']=recursive?weavejs.api.core.DynamicState.removeTypeFromState(typedState[weavejs.api.core.DynamicState.SESSION_STATE],
true):typedState[weavejs.api.core.DynamicState.SESSION_STATE]}return newState}if(recursive&&typeof state==='object')for(var key in state)state[key]=weavejs.api.core.DynamicState.removeTypeFromState(state[key],true);return state};
weavejs.api.core.DynamicState.traverseState=function(state,path,newValue){newValue=typeof newValue!=='undefined'?newValue:undefined;if(!path.length)return newValue===undefined?state:newValue;if(!state)return undefined;var property=path[0];path=path.slice(1);if(weavejs.api.core.DynamicState.isDynamicStateArray(state,true)){var i;if(org.apache.flex.utils.Language.is(property,Number))i=Number(property);else for(i=0;i<state.length;i++)if(state[i][weavejs.api.core.DynamicState.OBJECT_NAME]==property||
!property&&!state[i][weavejs.api.core.DynamicState.OBJECT_NAME])break;var typedState=state[i];if(!typedState)return undefined;if(path.length)return weavejs.api.core.DynamicState.traverseState(typedState[weavejs.api.core.DynamicState.SESSION_STATE],path,newValue);return newValue===undefined?typedState[weavejs.api.core.DynamicState.SESSION_STATE]:typedState[weavejs.api.core.DynamicState.SESSION_STATE]=newValue}if(path.length)return weavejs.api.core.DynamicState.traverseState(state[property],path,newValue);
return newValue===undefined?state[property]:state[property]=newValue};weavejs.api.core.DynamicState.prototype.FLEXJS_CLASS_INFO={names:[{name:'DynamicState',qName:'weavejs.api.core.DynamicState'}]};goog.exportSymbol('weavejs.api.core.DynamicState',weavejs.api.core.DynamicState);weavejs.api.core.DynamicState.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.api.core.IDisposableObject');weavejs.api.core.IDisposableObject=function(){};weavejs.api.core.IDisposableObject.prototype.dispose=function(){};weavejs.api.core.IDisposableObject.prototype.FLEXJS_CLASS_INFO={names:[{name:'IDisposableObject',qName:'weavejs.api.core.IDisposableObject'}]};
weavejs.api.core.IDisposableObject.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'dispose':{type:'void',declaredBy:'weavejs.api.core.IDisposableObject'}}}}};goog.provide('weavejs.core.CallbackEntry');goog.require('weavejs.api.core.IDisposableObject');weavejs.core.CallbackEntry=function(context,callback){this.context=context;this.callback=callback;if(context)weavejs.WeaveAPI.SessionManager.registerDisposableChild(context,this);if(weavejs.WeaveAPI.debugAsyncStack)this.addCallback_stackTrace=new Error(weavejs.core.CallbackEntry.STACK_TRACE_ADD)};weavejs.core.CallbackEntry.prototype.context=null;weavejs.core.CallbackEntry.prototype.callback=null;
weavejs.core.CallbackEntry.prototype.recursionCount=0;weavejs.core.CallbackEntry.prototype.schedule=0;weavejs.core.CallbackEntry.prototype.addCallback_stackTrace=null;weavejs.core.CallbackEntry.prototype.removeCallback_stackTrace=null;weavejs.core.CallbackEntry.prototype.dispose=function(){if(weavejs.WeaveAPI.debugAsyncStack&&this.callback!=null)this.removeCallback_stackTrace=new Error(weavejs.core.CallbackEntry.STACK_TRACE_REMOVE);this.context=null;this.callback=null};
weavejs.core.CallbackEntry.STACK_TRACE_ADD='This is the stack trace from when the callback was added.';weavejs.core.CallbackEntry.STACK_TRACE_REMOVE='This is the stack trace from when the callback was removed.';weavejs.core.CallbackEntry.prototype.FLEXJS_CLASS_INFO={names:[{name:'CallbackEntry',qName:'weavejs.core.CallbackEntry'}],interfaces:[weavejs.api.core.IDisposableObject]};goog.exportSymbol('weavejs.core.CallbackEntry',weavejs.core.CallbackEntry);
weavejs.core.CallbackEntry.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'context':{type:'Object'},'callback':{type:'Function'},'recursionCount':{type:'uint'},'schedule':{type:'int'},'addCallback_stackTrace':{type:'Error'},'removeCallback_stackTrace':{type:'Error'}}},accessors:function(){return{}},methods:function(){return{'CallbackEntry':{type:'',declaredBy:'weavejs.core.CallbackEntry'},'dispose':{type:'void',declaredBy:'weavejs.core.CallbackEntry'}}}}};goog.provide('weavejs.util.Dictionary2D');weavejs.util.Dictionary2D=function(weakPrimaryKeys,weakSecondaryKeys,defaultType){weakPrimaryKeys=typeof weakPrimaryKeys!=='undefined'?weakPrimaryKeys:false;weakSecondaryKeys=typeof weakSecondaryKeys!=='undefined'?weakSecondaryKeys:false;defaultType=typeof defaultType!=='undefined'?defaultType:null;this.map=weakPrimaryKeys?new weavejs.util.JS.WeakMap:new weavejs.util.JS.Map;this.weak1=weakPrimaryKeys;this.weak2=weakSecondaryKeys;this.defaultType=defaultType};
weavejs.util.Dictionary2D.prototype.map;weavejs.util.Dictionary2D.prototype.weak1;weavejs.util.Dictionary2D.prototype.weak2;weavejs.util.Dictionary2D.prototype.defaultType;weavejs.util.Dictionary2D.prototype.get=function(key1,key2){var value=undefined;var map2=this.map.get(key1);if(map2)value=map2.get(key2);if(value===undefined&&this.defaultType){value=new this.defaultType;this.set(key1,key2,value)}return value};
weavejs.util.Dictionary2D.prototype.set=function(key1,key2,value){var map2=this.map.get(key1);if(map2==null){map2=this.weak2?new weavejs.util.JS.WeakMap:new weavejs.util.JS.Map;this.map.set(key1,map2)}map2.set(key2,value)};weavejs.util.Dictionary2D.prototype.primaryKeys=function(){if(this.weak1)weavejs.util.Dictionary2D.throwWeakIterationError();return weavejs.util.JS.mapKeys(this.map)};
weavejs.util.Dictionary2D.prototype.secondaryKeys=function(key1){if(this.weak2)weavejs.util.Dictionary2D.throwWeakIterationError();return weavejs.util.JS.mapKeys(this.map.get(key1))};weavejs.util.Dictionary2D.prototype.removeAllPrimary=function(key1){this.map['delete'](key1)};
weavejs.util.Dictionary2D.prototype.removeAllSecondary=function(key2){if(this.weak1)weavejs.util.Dictionary2D.throwWeakIterationError();this._key2ToRemove=key2;this.map.forEach(org.apache.flex.utils.Language.closure(this.removeAllSecondary_each,this,'removeAllSecondary_each'),this)};weavejs.util.Dictionary2D.prototype._key2ToRemove;weavejs.util.Dictionary2D.prototype.removeAllSecondary_each=function(map2,key1){map2['delete'](this._key2ToRemove)};
weavejs.util.Dictionary2D.prototype.remove=function(key1,key2){var value=undefined;var map2=this.map.get(key1);if(map2){value=map2.get(key2);map2['delete'](key2);if(this.weak2||map2.size)return value;this.map['delete'](key1)}return value};weavejs.util.Dictionary2D.throwWeakIterationError=function(){throw new Error('WeakMap cannot be iterated over');};
weavejs.util.Dictionary2D.prototype.forEach=function(key1_key2_value,thisArg){if(this.weak1||this.weak2)weavejs.util.Dictionary2D.throwWeakIterationError();this.forEach_fn=key1_key2_value;this.forEach_this=thisArg;this.map.forEach(org.apache.flex.utils.Language.closure(this.forEach1,this,'forEach1'),this);this.forEach_fn=null;this.forEach_this=null;this.forEach_key1=null;this.forEach_map2=null};weavejs.util.Dictionary2D.prototype.forEach_fn;weavejs.util.Dictionary2D.prototype.forEach_this;weavejs.util.Dictionary2D.prototype.forEach_key1;
weavejs.util.Dictionary2D.prototype.forEach_map2;weavejs.util.Dictionary2D.prototype.forEach1=function(map2,key1){if(this.forEach_fn==null)return;this.forEach_key1=key1;this.forEach_map2=map2;map2.forEach(org.apache.flex.utils.Language.closure(this.forEach2,this,'forEach2'),this)};weavejs.util.Dictionary2D.prototype.forEach2=function(value,key2){if(this.forEach_fn!=null&&this.forEach_fn.call(this.forEach_this,this.forEach_key1,key2,value))this.forEach_fn=null};
weavejs.util.Dictionary2D.prototype.FLEXJS_CLASS_INFO={names:[{name:'Dictionary2D',qName:'weavejs.util.Dictionary2D'}]};goog.exportSymbol('weavejs.util.Dictionary2D',weavejs.util.Dictionary2D);
weavejs.util.Dictionary2D.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'map':{type:'Object'}}},accessors:function(){return{}},methods:function(){return{'Dictionary2D':{type:'',declaredBy:'weavejs.util.Dictionary2D'},'get':{type:'*',declaredBy:'weavejs.util.Dictionary2D'},'set':{type:'void',declaredBy:'weavejs.util.Dictionary2D'},'primaryKeys':{type:'Array',declaredBy:'weavejs.util.Dictionary2D'},'secondaryKeys':{type:'Array',declaredBy:'weavejs.util.Dictionary2D'},
'removeAllPrimary':{type:'void',declaredBy:'weavejs.util.Dictionary2D'},'removeAllSecondary':{type:'void',declaredBy:'weavejs.util.Dictionary2D'},'remove':{type:'*',declaredBy:'weavejs.util.Dictionary2D'},'forEach':{type:'void',declaredBy:'weavejs.util.Dictionary2D'}}}}};goog.provide('weavejs.core.GroupedCallbackEntry');goog.require('weavejs.core.CallbackEntry');goog.require('weavejs.util.Dictionary2D');weavejs.core.GroupedCallbackEntry=function(context,groupedCallback){this.targets=[];weavejs.core.GroupedCallbackEntry.base(this,'constructor',context,groupedCallback);if(!weavejs.core.GroupedCallbackEntry._initialized){weavejs.core.GroupedCallbackEntry._initialized=true;weavejs.WeaveAPI.Scheduler.frameCallbacks.addImmediateCallback(null,weavejs.core.GroupedCallbackEntry._handleGroupedCallbacks)}};
goog.inherits(weavejs.core.GroupedCallbackEntry,weavejs.core.CallbackEntry);
weavejs.core.GroupedCallbackEntry.addGroupedCallback=function(callbackCollection,relevantContext,groupedCallback,triggerCallbackNow,delayWhileBusy){if(!relevantContext)relevantContext=weavejs.core.GroupedCallbackEntry.CONTEXT_PLACEHOLDER;callbackCollection.removeCallback(relevantContext,groupedCallback);var entry=weavejs.core.GroupedCallbackEntry.d2d_context_callback_entry.get(relevantContext,groupedCallback);if(!entry){entry=new weavejs.core.GroupedCallbackEntry(relevantContext,groupedCallback);
weavejs.core.GroupedCallbackEntry.d2d_context_callback_entry.set(relevantContext,groupedCallback,entry)}entry.targets.push(callbackCollection);if(delayWhileBusy)entry.delayWhileBusy=true;callbackCollection.addImmediateCallback(relevantContext,org.apache.flex.utils.Language.closure(entry.trigger,entry,'trigger'),triggerCallbackNow)};
weavejs.core.GroupedCallbackEntry.removeGroupedCallback=function(callbackCollection,relevantContext,groupedCallback){if(!relevantContext)relevantContext=weavejs.core.GroupedCallbackEntry.CONTEXT_PLACEHOLDER;var entry=weavejs.core.GroupedCallbackEntry.d2d_context_callback_entry.get(relevantContext,groupedCallback);if(entry){callbackCollection.removeCallback(relevantContext,org.apache.flex.utils.Language.closure(entry.trigger,entry,'trigger'));var index=entry.targets.indexOf(callbackCollection);if(index>=
0){entry.targets.splice(index,1);if(entry.targets.length==0)weavejs.core.GroupedCallbackEntry.d2d_context_callback_entry.remove(relevantContext,groupedCallback)}}};
weavejs.core.GroupedCallbackEntry._handleGroupedCallbacks=function(){var i;var entry;for(i=0;i<weavejs.core.GroupedCallbackEntry._triggeredEntries.length;i++){entry=weavejs.core.GroupedCallbackEntry._triggeredEntries[i];entry.handleGroupedCallback()}var foreachiter0_target=weavejs.core.GroupedCallbackEntry._triggeredEntries;for(var foreachiter0 in foreachiter0_target){entry=foreachiter0_target[foreachiter0];entry.handled=entry.triggered=entry.triggeredAgain=false}weavejs.core.GroupedCallbackEntry._triggeredEntries.length=
0};weavejs.core.GroupedCallbackEntry.CONTEXT_PLACEHOLDER={};weavejs.core.GroupedCallbackEntry._initialized=false;weavejs.core.GroupedCallbackEntry.d2d_context_callback_entry=new weavejs.util.Dictionary2D(true,true);weavejs.core.GroupedCallbackEntry._triggeredEntries=[];weavejs.core.GroupedCallbackEntry.prototype.handled=false;weavejs.core.GroupedCallbackEntry.prototype.triggered=false;weavejs.core.GroupedCallbackEntry.prototype.triggeredAgain=false;
weavejs.core.GroupedCallbackEntry.prototype.delayWhileBusy=false;weavejs.core.GroupedCallbackEntry.prototype.targets;weavejs.core.GroupedCallbackEntry.prototype.trigger=function(){if(!this.triggered){weavejs.core.GroupedCallbackEntry._triggeredEntries.push(this);this.triggered=true}else if(this.handled&&!this.triggeredAgain){weavejs.core.GroupedCallbackEntry._triggeredEntries.push(this);this.triggeredAgain=true}};
weavejs.core.GroupedCallbackEntry.prototype.handleGroupedCallback=function(){if(!this.callback){Weave.dispose(this);return}for(var i=0;i<this.targets.length;i++){var target=this.targets[i];if(weavejs.WeaveAPI.SessionManager.objectWasDisposed(target))this.targets.splice(i--,1);else if(this.delayWhileBusy&&weavejs.WeaveAPI.SessionManager.linkableObjectIsBusy(target))return}if(this.targets.length==0){this.dispose();weavejs.core.GroupedCallbackEntry.d2d_context_callback_entry.remove(this.context,this.callback);
return}if(this.recursionCount==0){this.recursionCount++;this.callback.apply(this.context===weavejs.core.GroupedCallbackEntry.CONTEXT_PLACEHOLDER?this.callback['this']:this.context);this.handled=true;this.recursionCount--}};
weavejs.core.GroupedCallbackEntry.prototype.dispose=function(){var foreachiter1_target=this.targets;for(var foreachiter1 in foreachiter1_target){var target=foreachiter1_target[foreachiter1];weavejs.core.GroupedCallbackEntry.removeGroupedCallback(target,this.context,this.callback)}weavejs.core.GroupedCallbackEntry.base(this,'dispose')};weavejs.core.GroupedCallbackEntry.prototype.FLEXJS_CLASS_INFO={names:[{name:'GroupedCallbackEntry',qName:'weavejs.core.GroupedCallbackEntry'}]};
goog.exportSymbol('weavejs.core.GroupedCallbackEntry',weavejs.core.GroupedCallbackEntry);
weavejs.core.GroupedCallbackEntry.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'handled':{type:'Boolean'},'triggered':{type:'Boolean'},'triggeredAgain':{type:'Boolean'},'delayWhileBusy':{type:'Boolean'},'targets':{type:'Array'}}},accessors:function(){return{}},methods:function(){return{'GroupedCallbackEntry':{type:'',declaredBy:'weavejs.core.GroupedCallbackEntry'},'trigger':{type:'void',declaredBy:'weavejs.core.GroupedCallbackEntry'},'handleGroupedCallback':{type:'void',
declaredBy:'weavejs.core.GroupedCallbackEntry'},'dispose':{type:'void',declaredBy:'weavejs.core.GroupedCallbackEntry'}}}}};goog.provide('weavejs.api.core.ICallbackCollection');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.core.ICallbackCollection=function(){};weavejs.api.core.ICallbackCollection.prototype.addImmediateCallback=function(relevantContext,callback,runCallbackNow,alwaysCallLast){};weavejs.api.core.ICallbackCollection.prototype.addGroupedCallback=function(relevantContext,groupedCallback,triggerCallbackNow,delayWhileBusy){};
weavejs.api.core.ICallbackCollection.prototype.addDisposeCallback=function(relevantContext,callback,allowDelay){};weavejs.api.core.ICallbackCollection.prototype.removeCallback=function(relevantContext,callback){};weavejs.api.core.ICallbackCollection.prototype.triggerCallbacks=function(){};weavejs.api.core.ICallbackCollection.prototype.triggerCounter;weavejs.api.core.ICallbackCollection.prototype.delayCallbacks=function(){};weavejs.api.core.ICallbackCollection.prototype.resumeCallbacks=function(){};
weavejs.api.core.ICallbackCollection.prototype.FLEXJS_CLASS_INFO={names:[{name:'ICallbackCollection',qName:'weavejs.api.core.ICallbackCollection'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.core.ICallbackCollection.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'triggerCounter':{type:'uint',declaredBy:'weavejs.api.core.ICallbackCollection'},'callbacksAreDelayed':{type:'Boolean',declaredBy:'weavejs.api.core.ICallbackCollection'}}},methods:function(){return{'addImmediateCallback':{type:'void',declaredBy:'weavejs.api.core.ICallbackCollection'},'addGroupedCallback':{type:'void',declaredBy:'weavejs.api.core.ICallbackCollection'},
'addDisposeCallback':{type:'void',declaredBy:'weavejs.api.core.ICallbackCollection'},'removeCallback':{type:'void',declaredBy:'weavejs.api.core.ICallbackCollection'},'triggerCallbacks':{type:'void',declaredBy:'weavejs.api.core.ICallbackCollection'},'delayCallbacks':{type:'void',declaredBy:'weavejs.api.core.ICallbackCollection'},'resumeCallbacks':{type:'void',declaredBy:'weavejs.api.core.ICallbackCollection'}}}}};goog.provide('weavejs.core.CallbackCollection');goog.require('weavejs.core.GroupedCallbackEntry');goog.require('weavejs.api.core.ICallbackCollection');goog.require('weavejs.api.core.IDisposableObject');weavejs.core.CallbackCollection=function(preCallback){preCallback=typeof preCallback!=='undefined'?preCallback:null;this._callbackEntries=[];this._triggerCounter=weavejs.core.CallbackCollection.DEFAULT_TRIGGER_COUNT;this._disposeCallbackEntries=[];this._preCallback=preCallback};weavejs.core.CallbackCollection.prototype._linkableObject;
weavejs.core.CallbackCollection.prototype._lastTriggerStackTrace;weavejs.core.CallbackCollection.prototype._oldEntries;weavejs.core.CallbackCollection.prototype._callbackEntries;weavejs.core.CallbackCollection.prototype._preCallback=null;weavejs.core.CallbackCollection.prototype._delayCount=0;weavejs.core.CallbackCollection.prototype._runCallbacksIsPending=false;weavejs.core.CallbackCollection.DEFAULT_TRIGGER_COUNT=1;weavejs.core.CallbackCollection.prototype._triggerCounter;
weavejs.core.CallbackCollection.prototype.addImmediateCallback=function(relevantContext,callback,runCallbackNow,alwaysCallLast){runCallbackNow=typeof runCallbackNow!=='undefined'?runCallbackNow:false;alwaysCallLast=typeof alwaysCallLast!=='undefined'?alwaysCallLast:false;if(callback==null)return;this.removeCallback(relevantContext,callback);var entry=new weavejs.core.CallbackEntry(relevantContext,callback);if(alwaysCallLast)entry.schedule=1;this._callbackEntries.push(entry);if(runCallbackNow){entry.recursionCount++;
callback.apply(relevantContext||callback['this']);entry.recursionCount--}};weavejs.core.CallbackCollection.prototype.triggerCallbacks=function(){if(weavejs.WeaveAPI.debugAsyncStack)this._lastTriggerStackTrace=new Error(weavejs.core.CallbackCollection.STACK_TRACE_TRIGGER);if(this._delayCount>0){this._triggerCounter++;this._runCallbacksIsPending=true;return}this._runCallbacksImmediately()};weavejs.core.CallbackCollection.prototype._runCallbacksCompleted;
weavejs.core.CallbackCollection.prototype._runCallbacksImmediately=function(preCallbackParams){preCallbackParams=Array.prototype.slice.call(arguments,0);this._triggerCounter++;this._runCallbacksIsPending=false;this._runCallbacksCompleted=false;for(var schedule=0;schedule<2;schedule++)for(var i=0;i<this._callbackEntries.length;i++){if(this._runCallbacksCompleted&&this._preCallback==null)break;var entry=this._callbackEntries[i];if(entry.schedule!=schedule)continue;var shouldRemoveEntry;if(entry.callback==
null)shouldRemoveEntry=true;else if(org.apache.flex.utils.Language.is(entry.context,weavejs.core.CallbackCollection))shouldRemoveEntry=org.apache.flex.utils.Language.as(entry.context,weavejs.core.CallbackCollection)._wasDisposed;else shouldRemoveEntry=weavejs.WeaveAPI.SessionManager.objectWasDisposed(entry.context);if(shouldRemoveEntry){Weave.dispose(entry);var removed=this._callbackEntries.splice(i--,1);if(weavejs.WeaveAPI.debugAsyncStack)this._oldEntries=this._oldEntries?this._oldEntries.concat(removed):
removed;continue}if(entry.recursionCount==0||this._preCallback!=null){entry.recursionCount++;if(this._preCallback!=null)this._preCallback.apply(this,preCallbackParams);entry.callback.apply(entry.context||entry.callback['this']);entry.recursionCount--}}this._runCallbacksCompleted=true};
weavejs.core.CallbackCollection.prototype.removeCallback=function(relevantContext,callback){weavejs.core.GroupedCallbackEntry.removeGroupedCallback(this,relevantContext,callback);for(var outerLoop=0;outerLoop<2;outerLoop++){var entries=outerLoop==0?this._callbackEntries:this._disposeCallbackEntries;for(var index=0;index<entries.length;index++){var entry=entries[index];if(entry.callback===callback&&entry.context===relevantContext)Weave.dispose(entry)}}};
weavejs.core.CallbackCollection.prototype.delayCallbacks=function(){this._delayCount++};weavejs.core.CallbackCollection.prototype.resumeCallbacks=function(){if(this._delayCount>0)this._delayCount--;if(this._delayCount==0){if(this._runCallbacksIsPending)this.triggerCallbacks();if(this._wasDisposed)this.runDisposeCallbacks()}};
weavejs.core.CallbackCollection.prototype.addDisposeCallback=function(relevantContext,callback,allowDelay){allowDelay=typeof allowDelay!=='undefined'?allowDelay:false;var entry;var foreachiter0_target=this._disposeCallbackEntries;for(var foreachiter0 in foreachiter0_target){entry=foreachiter0_target[foreachiter0];if(entry.callback===callback&&entry.context===relevantContext)return}entry=new weavejs.core.CallbackEntry(relevantContext,callback);if(allowDelay)entry.schedule=1;this._disposeCallbackEntries.push(entry)};
weavejs.core.CallbackCollection.prototype._disposeCallbackEntries;weavejs.core.CallbackCollection.prototype.dispose=function(){var entry;if(weavejs.WeaveAPI.debugAsyncStack)this._oldEntries=this._oldEntries?this._oldEntries.concat(this._callbackEntries):this._callbackEntries.concat();var foreachiter1_target=this._callbackEntries;for(var foreachiter1 in foreachiter1_target){entry=foreachiter1_target[foreachiter1];Weave.dispose(entry)}this._callbackEntries.length=0;this._wasDisposed=true;this.runDisposeCallbacks()};
weavejs.core.CallbackCollection.prototype.runDisposeCallbacks=function(){var foreachiter2_target=this._disposeCallbackEntries;for(var foreachiter2 in foreachiter2_target){var entry=foreachiter2_target[foreachiter2];if(entry.schedule>0&&this._delayCount>0)continue;if(entry.callback!=null&&!weavejs.WeaveAPI.SessionManager.objectWasDisposed(entry.context)){entry.callback.apply(entry.context||entry.callback['this']);Weave.dispose(entry)}}};weavejs.core.CallbackCollection.prototype._wasDisposed=false;
weavejs.core.CallbackCollection.prototype.addGroupedCallback=function(relevantContext,groupedCallback,triggerCallbackNow,delayWhileBusy){triggerCallbackNow=typeof triggerCallbackNow!=='undefined'?triggerCallbackNow:false;delayWhileBusy=typeof delayWhileBusy!=='undefined'?delayWhileBusy:true;weavejs.core.GroupedCallbackEntry.addGroupedCallback(this,relevantContext,groupedCallback,triggerCallbackNow,delayWhileBusy)};weavejs.core.CallbackCollection.STACK_TRACE_TRIGGER='This is the stack trace from when the callbacks were last triggered.';
Object.defineProperties(weavejs.core.CallbackCollection.prototype,{triggerCounter:{get:function(){return this._triggerCounter}},callbacksAreDelayed:{get:function(){return this._delayCount>0}},wasDisposed:{get:function(){return this._wasDisposed}}});weavejs.core.CallbackCollection.prototype.FLEXJS_CLASS_INFO={names:[{name:'CallbackCollection',qName:'weavejs.core.CallbackCollection'}],interfaces:[weavejs.api.core.ICallbackCollection,weavejs.api.core.IDisposableObject]};
goog.exportSymbol('weavejs.core.CallbackCollection',weavejs.core.CallbackCollection);
weavejs.core.CallbackCollection.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'triggerCounter':{type:'uint',declaredBy:'weavejs.core.CallbackCollection'},'callbacksAreDelayed':{type:'Boolean',declaredBy:'weavejs.core.CallbackCollection'},'wasDisposed':{type:'Boolean',declaredBy:'weavejs.core.CallbackCollection'}}},methods:function(){return{'CallbackCollection':{type:'',declaredBy:'weavejs.core.CallbackCollection'},'addImmediateCallback':{type:'void',
declaredBy:'weavejs.core.CallbackCollection'},'triggerCallbacks':{type:'void',declaredBy:'weavejs.core.CallbackCollection'},'removeCallback':{type:'void',declaredBy:'weavejs.core.CallbackCollection'},'delayCallbacks':{type:'void',declaredBy:'weavejs.core.CallbackCollection'},'resumeCallbacks':{type:'void',declaredBy:'weavejs.core.CallbackCollection'},'addDisposeCallback':{type:'void',declaredBy:'weavejs.core.CallbackCollection'},'dispose':{type:'void',declaredBy:'weavejs.core.CallbackCollection'},
'addGroupedCallback':{type:'void',declaredBy:'weavejs.core.CallbackCollection'}}}}};goog.provide('weavejs.api.core.ILinkableVariable');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.core.ILinkableVariable=function(){};weavejs.api.core.ILinkableVariable.prototype.getSessionState=function(){};weavejs.api.core.ILinkableVariable.prototype.setSessionState=function(value){};weavejs.api.core.ILinkableVariable.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableVariable',qName:'weavejs.api.core.ILinkableVariable'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.core.ILinkableVariable.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'getSessionState':{type:'Object',declaredBy:'weavejs.api.core.ILinkableVariable'},'setSessionState':{type:'void',declaredBy:'weavejs.api.core.ILinkableVariable'}}}}};goog.provide('weavejs.core.LinkableVariable');goog.require('weavejs.core.CallbackCollection');goog.require('weavejs.api.core.ICallbackCollection');goog.require('weavejs.api.core.IDisposableObject');goog.require('weavejs.api.core.ILinkableVariable');
weavejs.core.LinkableVariable=function(sessionStateType,verifier,defaultValue,defaultValueTriggersCallbacks){sessionStateType=typeof sessionStateType!=='undefined'?sessionStateType:null;verifier=typeof verifier!=='undefined'?verifier:null;defaultValue=typeof defaultValue!=='undefined'?defaultValue:undefined;defaultValueTriggersCallbacks=typeof defaultValueTriggersCallbacks!=='undefined'?defaultValueTriggersCallbacks:true;weavejs.core.LinkableVariable.base(this,'constructor');if(sessionStateType!=
Object){this._sessionStateType=sessionStateType;this._primitiveType=this._sessionStateType==String||this._sessionStateType==Number||this._sessionStateType==Boolean}this._verifier=verifier;if(defaultValue!==undefined){this.setSessionState(defaultValue);if(defaultValueTriggersCallbacks&&this.triggerCounter>weavejs.core.CallbackCollection.DEFAULT_TRIGGER_COUNT)weavejs.WeaveAPI.Scheduler.callLater(this,org.apache.flex.utils.Language.closure(this._defaultValueTrigger,this,'_defaultValueTrigger'))}};
goog.inherits(weavejs.core.LinkableVariable,weavejs.core.CallbackCollection);weavejs.core.LinkableVariable.prototype._verifier=null;weavejs.core.LinkableVariable.prototype._sessionStateWasSet=false;weavejs.core.LinkableVariable.prototype._primitiveType=false;weavejs.core.LinkableVariable.prototype._sessionStateType=null;weavejs.core.LinkableVariable.prototype._sessionStateInternal=undefined;weavejs.core.LinkableVariable.prototype._sessionStateExternal=undefined;
weavejs.core.LinkableVariable.prototype._locked=false;weavejs.core.LinkableVariable.prototype._bypassDiff=true;weavejs.core.LinkableVariable.prototype._defaultValueTrigger=function(){if(!this.wasDisposed&&this.triggerCounter==weavejs.core.CallbackCollection.DEFAULT_TRIGGER_COUNT+1)this.triggerCallbacks()};weavejs.core.LinkableVariable.prototype.verifyValue=function(value){return this._verifier==null||this._verifier(value)};weavejs.core.LinkableVariable.prototype.getSessionStateType=function(){return this._sessionStateType};
weavejs.core.LinkableVariable.prototype.getSessionState=function(){if(this._sessionStateExternal===undefined)return null;return this._sessionStateExternal};
weavejs.core.LinkableVariable.prototype.setSessionState=function(value){if(this._locked)return;if(this._sessionStateType!=null)value=org.apache.flex.utils.Language.as(value,this._sessionStateType);if(this._verifier!=null&&!this._verifier(value))return;var wasCopied=false;var type=null;if(value==null)value=null;else{type=typeof value;if(type=='object'&&value.constructor!=Object&&value.constructor!=Array){value=weavejs.util.JS.copyObject(value);wasCopied=true}}if(this._sessionStateWasSet&&this.sessionStateEquals(value))return;
if(type=='object'){if(!wasCopied)value=weavejs.util.JS.copyObject(value);if(this._bypassDiff)weavejs.api.core.DynamicState.alterSessionStateToBypassDiff(value);this._sessionStateExternal=value;this._sessionStateInternal=weavejs.util.JS.copyObject(value)}else this._sessionStateExternal=this._sessionStateInternal=value;this._sessionStateWasSet=true;this.triggerCallbacks()};
weavejs.core.LinkableVariable.prototype.sessionStateEquals=function(otherSessionState){if(this._primitiveType)return this._sessionStateInternal==otherSessionState;return weavejs.util.StandardLib.compare(this._sessionStateInternal,otherSessionState,org.apache.flex.utils.Language.closure(this.objectCompare,this,'objectCompare'))==0};
weavejs.core.LinkableVariable.prototype.objectCompare=function(a,b){if(weavejs.api.core.DynamicState.isDynamicState(a,true)&&weavejs.api.core.DynamicState.isDynamicState(b,true)&&a[weavejs.api.core.DynamicState.CLASS_NAME]==b[weavejs.api.core.DynamicState.CLASS_NAME]&&a[weavejs.api.core.DynamicState.OBJECT_NAME]==b[weavejs.api.core.DynamicState.OBJECT_NAME])return weavejs.util.StandardLib.compare(a[weavejs.api.core.DynamicState.SESSION_STATE],b[weavejs.api.core.DynamicState.SESSION_STATE],org.apache.flex.utils.Language.closure(this.objectCompare,
this,'objectCompare'));return NaN};weavejs.core.LinkableVariable.prototype.detectChanges=function(){if(!this.sessionStateEquals(this._sessionStateExternal))this.triggerCallbacks()};weavejs.core.LinkableVariable.prototype.lock=function(){this._locked=true};weavejs.core.LinkableVariable.prototype.dispose=function(){weavejs.core.LinkableVariable.base(this,'dispose');this._sessionStateInternal=undefined;this._sessionStateExternal=undefined};
Object.defineProperties(weavejs.core.LinkableVariable.prototype,{locked:{get:function(){return this._locked}},state:{get:function(){return this.getSessionState()},set:function(value){this.setSessionState(value)}}});weavejs.core.LinkableVariable.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableVariable',qName:'weavejs.core.LinkableVariable'}],interfaces:[weavejs.api.core.ILinkableVariable,weavejs.api.core.ICallbackCollection,weavejs.api.core.IDisposableObject]};
goog.exportSymbol('weavejs.core.LinkableVariable',weavejs.core.LinkableVariable);
weavejs.core.LinkableVariable.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'locked':{type:'Boolean',declaredBy:'weavejs.core.LinkableVariable'},'state':{type:'Object',declaredBy:'weavejs.core.LinkableVariable'}}},methods:function(){return{'LinkableVariable':{type:'',declaredBy:'weavejs.core.LinkableVariable'},'getSessionStateType':{type:'Class',declaredBy:'weavejs.core.LinkableVariable'},'getSessionState':{type:'Object',declaredBy:'weavejs.core.LinkableVariable'},
'setSessionState':{type:'void',declaredBy:'weavejs.core.LinkableVariable'},'detectChanges':{type:'void',declaredBy:'weavejs.core.LinkableVariable'},'lock':{type:'void',declaredBy:'weavejs.core.LinkableVariable'},'dispose':{type:'void',declaredBy:'weavejs.core.LinkableVariable'}}}}};goog.provide('weavejs.core.LinkableBoolean');goog.require('weavejs.core.LinkableVariable');
weavejs.core.LinkableBoolean=function(defaultValue,verifier,defaultValueTriggersCallbacks){defaultValue=typeof defaultValue!=='undefined'?defaultValue:undefined;verifier=typeof verifier!=='undefined'?verifier:null;defaultValueTriggersCallbacks=typeof defaultValueTriggersCallbacks!=='undefined'?defaultValueTriggersCallbacks:true;weavejs.core.LinkableBoolean.base(this,'constructor',Boolean,verifier,defaultValue,defaultValueTriggersCallbacks)};goog.inherits(weavejs.core.LinkableBoolean,weavejs.core.LinkableVariable);
weavejs.core.LinkableBoolean.prototype.getSessionState=function(){if(this._sessionStateExternal===undefined)return false;return this._sessionStateExternal};weavejs.core.LinkableBoolean.prototype.setSessionState=function(value){if(org.apache.flex.utils.Language.is(value,String))value=value==='true';weavejs.core.LinkableBoolean.base(this,'setSessionState',value?true:false)};
Object.defineProperties(weavejs.core.LinkableBoolean.prototype,{value:{get:function(){if(this._sessionStateExternal===undefined)return false;return this._sessionStateExternal},set:function(value){this.setSessionState(value)}}});weavejs.core.LinkableBoolean.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableBoolean',qName:'weavejs.core.LinkableBoolean'}]};goog.exportSymbol('weavejs.core.LinkableBoolean',weavejs.core.LinkableBoolean);
weavejs.core.LinkableBoolean.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'value':{type:'Boolean',declaredBy:'weavejs.core.LinkableBoolean'}}},methods:function(){return{'LinkableBoolean':{type:'',declaredBy:'weavejs.core.LinkableBoolean'},'getSessionState':{type:'Object',declaredBy:'weavejs.core.LinkableBoolean'},'setSessionState':{type:'void',declaredBy:'weavejs.core.LinkableBoolean'}}}}};goog.provide('weavejs.core.LogEntry');weavejs.core.LogEntry=function(id,forward,backward,triggerDelay,diffDuration){this.id=id;this.forward=forward;this.backward=backward;this.triggerDelay=triggerDelay;this.diffDuration=diffDuration};weavejs.core.LogEntry.prototype.id;weavejs.core.LogEntry.prototype.forward;weavejs.core.LogEntry.prototype.backward;weavejs.core.LogEntry.prototype.triggerDelay;weavejs.core.LogEntry.prototype.diffDuration;
weavejs.core.LogEntry.convertGenericObjectsToLogEntries=function(array,defaultTriggerDelay){for(var i=0;i<array.length;i++){var o=array[i];if(!org.apache.flex.utils.Language.is(o,weavejs.core.LogEntry))array[i]=new weavejs.core.LogEntry(o.id,o.forward,o.backward,o.triggerDelay||defaultTriggerDelay,o.diffDuration)}return array};weavejs.core.LogEntry.prototype.FLEXJS_CLASS_INFO={names:[{name:'LogEntry',qName:'weavejs.core.LogEntry'}]};goog.exportSymbol('weavejs.core.LogEntry',weavejs.core.LogEntry);
weavejs.core.LogEntry.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'id':{type:'int'},'forward':{type:'Object'},'backward':{type:'Object'},'triggerDelay':{type:'int'},'diffDuration':{type:'int'}}},accessors:function(){return{}},methods:function(){return{'LogEntry':{type:'',declaredBy:'weavejs.core.LogEntry'}}}}};goog.provide('weavejs.core.SessionStateLog');goog.require('weavejs.core.LinkableBoolean');goog.require('weavejs.core.LogEntry');goog.require('weavejs.api.core.IDisposableObject');goog.require('weavejs.api.core.ILinkableVariable');
weavejs.core.SessionStateLog=function(subject,syncDelay){syncDelay=typeof syncDelay!=='undefined'?syncDelay:0;this.enableLogging=weavejs.WeaveAPI.SessionManager.registerLinkableChild(this,new weavejs.core.LinkableBoolean(true),org.apache.flex.utils.Language.closure(this.synchronizeNow,this,'synchronizeNow'));this._syncTime=weavejs.util.JS.now();this._undoHistory=[];this._redoHistory=[];this._subject=subject;this._syncDelay=syncDelay;this._prevState=weavejs.util.JS.copyObject(weavejs.WeaveAPI.SessionManager.getSessionState(this._subject));
weavejs.WeaveAPI.SessionManager.registerDisposableChild(this._subject,this);var cc=weavejs.WeaveAPI.SessionManager.getCallbackCollection(this._subject);cc.addImmediateCallback(this,org.apache.flex.utils.Language.closure(this.immediateCallback,this,'immediateCallback'));cc.addGroupedCallback(this,org.apache.flex.utils.Language.closure(this.groupedCallback,this,'groupedCallback'))};weavejs.core.SessionStateLog.debug=false;weavejs.core.SessionStateLog.enableHistoryRewrite=true;
weavejs.core.SessionStateLog.prototype.dispose=function(){if(this._undoHistory==null)throw new Error('SessionStateLog.dispose() called more than once');this._subject=null;this._undoHistory=null;this._redoHistory=null};weavejs.core.SessionStateLog.prototype._subject;weavejs.core.SessionStateLog.prototype._syncDelay;weavejs.core.SessionStateLog.prototype._prevState=null;weavejs.core.SessionStateLog.prototype._undoHistory;weavejs.core.SessionStateLog.prototype._redoHistory;
weavejs.core.SessionStateLog.prototype._nextId=0;weavejs.core.SessionStateLog.prototype._undoActive=false;weavejs.core.SessionStateLog.prototype._redoActive=false;weavejs.core.SessionStateLog.prototype._syncTime;weavejs.core.SessionStateLog.prototype._triggerDelay=-1;weavejs.core.SessionStateLog.prototype._saveTime=0;weavejs.core.SessionStateLog.prototype._savePending=false;weavejs.core.SessionStateLog.prototype.enableLogging;
weavejs.core.SessionStateLog.prototype.squashHistory=function(directionalSquashCount){var sm=weavejs.WeaveAPI.SessionManager;var cc=sm.getCallbackCollection(this);cc.delayCallbacks();this.synchronizeNow();var count=weavejs.util.StandardLib.constrain(directionalSquashCount,-this._undoHistory.length,this._redoHistory.length);if(count<-1||count>1){cc.triggerCallbacks();var entries;if(count<0)entries=this._undoHistory.splice(this._undoHistory.length+count,-count);else entries=this._redoHistory.splice(0,
count);var entry;var squashBackward=null;var squashForward=null;var totalDuration=0;var totalDelay=0;var last=entries.length-1;for(var i=0;i<=last;i++){entry=org.apache.flex.utils.Language.as(entries[last-i],weavejs.core.LogEntry);squashBackward=sm.combineDiff(squashBackward,entry.backward);entry=org.apache.flex.utils.Language.as(entries[i],weavejs.core.LogEntry);squashForward=sm.combineDiff(squashForward,entry.forward);totalDuration+=entry.diffDuration;totalDelay+=entry.triggerDelay}entry=new weavejs.core.LogEntry(this._nextId++,
squashForward,squashBackward,totalDelay,totalDuration);if(count<0)this._undoHistory.push(entry);else this._redoHistory.unshift(entry)}cc.resumeCallbacks()};
weavejs.core.SessionStateLog.prototype.clearHistory=function(directional){directional=typeof directional!=='undefined'?directional:0;var cc=weavejs.WeaveAPI.SessionManager.getCallbackCollection(this);cc.delayCallbacks();this.synchronizeNow();if(directional<=0){if(this._undoHistory.length>0)cc.triggerCallbacks();this._undoHistory.length=0}if(directional>=0){if(this._redoHistory.length>0)cc.triggerCallbacks();this._redoHistory.length=0}cc.resumeCallbacks()};
weavejs.core.SessionStateLog.prototype.immediateCallback=function(){if(!this.enableLogging.value)return;this._saveTime=Number.MAX_VALUE;if(!this._savePending){this._savePending=true;this.saveDiff()}if(weavejs.core.SessionStateLog.debug&&(this._undoActive||this._redoActive)){var state=weavejs.WeaveAPI.SessionManager.getSessionState(this._subject);var forwardDiff=weavejs.WeaveAPI.SessionManager.computeDiff(this._prevState,state);weavejs.util.JS.log('immediate diff:',forwardDiff)}};
weavejs.core.SessionStateLog.prototype.groupedCallback=function(){if(!this.enableLogging.value)return;this.immediateCallback();this._saveTime=weavejs.util.JS.now()+this._syncDelay;if(weavejs.core.SessionStateLog.debug&&(this._undoActive||this._redoActive)){var state=weavejs.WeaveAPI.SessionManager.getSessionState(this._subject);var forwardDiff=weavejs.WeaveAPI.SessionManager.computeDiff(this._prevState,state);weavejs.util.JS.log('grouped diff:',forwardDiff)}};
weavejs.core.SessionStateLog.prototype.saveDiff=function(immediately){immediately=typeof immediately!=='undefined'?immediately:false;if(!this.enableLogging.value){this._savePending=false;return}var currentTime=weavejs.util.JS.now();if(this._triggerDelay<0)this._triggerDelay=currentTime-this._syncTime;if(!immediately&&weavejs.util.JS.now()<this._saveTime){weavejs.WeaveAPI.Scheduler.callLater(this,org.apache.flex.utils.Language.closure(this.saveDiff,this,'saveDiff'));return}var sm=weavejs.WeaveAPI.SessionManager;
var cc=sm.getCallbackCollection(this);cc.delayCallbacks();var state=sm.getSessionState(this._subject);var forwardDiff=weavejs.util.JS.copyObject(sm.computeDiff(this._prevState,state));if(forwardDiff!==undefined){var diffDuration=currentTime-(this._syncTime+this._triggerDelay);var backwardDiff=weavejs.util.JS.copyObject(sm.computeDiff(state,this._prevState));var oldEntry;var newEntry;if(this._undoActive){oldEntry=org.apache.flex.utils.Language.as(this._redoHistory[0],weavejs.core.LogEntry);newEntry=
new weavejs.core.LogEntry(this._nextId++,backwardDiff,forwardDiff,oldEntry.triggerDelay,oldEntry.diffDuration);if(weavejs.core.SessionStateLog.enableHistoryRewrite)this._redoHistory[0]=newEntry;else if(weavejs.util.StandardLib.compare(oldEntry.forward,newEntry.forward)!=0)this._redoHistory.unshift(newEntry)}else{newEntry=new weavejs.core.LogEntry(this._nextId++,forwardDiff,backwardDiff,this._triggerDelay,diffDuration);if(this._redoActive){oldEntry=org.apache.flex.utils.Language.as(this._undoHistory.pop(),
weavejs.core.LogEntry);newEntry.triggerDelay=oldEntry.triggerDelay;newEntry.diffDuration=oldEntry.diffDuration;if(!weavejs.core.SessionStateLog.enableHistoryRewrite&&weavejs.util.StandardLib.compare(oldEntry.forward,newEntry.forward)==0)newEntry=oldEntry}this._undoHistory.push(newEntry)}if(weavejs.core.SessionStateLog.debug)this.debugHistory(newEntry);this._syncTime=currentTime;cc.triggerCallbacks();this._prevState=weavejs.util.JS.copyObject(state)}if(this._undoActive||this._redoActive)this._syncTime=
currentTime;this._undoActive=false;this._redoActive=false;this._savePending=false;this._triggerDelay=-1;cc.resumeCallbacks()};weavejs.core.SessionStateLog.prototype.synchronizeNow=function(){this.saveDiff(true)};weavejs.core.SessionStateLog.prototype.undo=function(numberOfSteps){numberOfSteps=typeof numberOfSteps!=='undefined'?numberOfSteps:1;this.applyDiffs(-numberOfSteps)};
weavejs.core.SessionStateLog.prototype.redo=function(numberOfSteps){numberOfSteps=typeof numberOfSteps!=='undefined'?numberOfSteps:1;this.applyDiffs(numberOfSteps)};
weavejs.core.SessionStateLog.prototype.applyDiffs=function(delta){var stepsRemaining=Math.min(Math.abs(delta),delta<0?this._undoHistory.length:this._redoHistory.length);if(stepsRemaining>0){var logEntry;var diff;var debug=weavejs.core.SessionStateLog.debug&&stepsRemaining==1;if(this._savePending&&!this._undoActive&&!this._redoActive)this.synchronizeNow();var sm=weavejs.WeaveAPI.SessionManager;var combine=stepsRemaining>2;var baseDiff=null;sm.getCallbackCollection(this._subject).delayCallbacks();if(!this.enableLogging.value){var state=
sm.getSessionState(this._subject);baseDiff=sm.computeDiff(state,this._prevState);if(baseDiff!=null)combine=true}while(stepsRemaining-- >0){if(delta<0){logEntry=this._undoHistory.pop();this._redoHistory.unshift(logEntry);diff=logEntry.backward}else{logEntry=this._redoHistory.shift();this._undoHistory.push(logEntry);diff=logEntry.forward}if(debug)weavejs.util.JS.log('apply',delta<0?'undo':'redo',logEntry.id+':',diff);if(stepsRemaining==0&&this.enableLogging.value)this._prevState=weavejs.util.JS.copyObject(sm.getSessionState(this._subject));
if(combine){baseDiff=sm.combineDiff(baseDiff,diff);if(stepsRemaining<=1){sm.setSessionState(this._subject,baseDiff,false);combine=false}}else sm.setSessionState(this._subject,diff,false);if(debug){var newState=sm.getSessionState(this._subject);var resultDiff=sm.computeDiff(this._prevState,newState);weavejs.util.JS.log('resulting diff:',resultDiff)}}sm.getCallbackCollection(this._subject).resumeCallbacks();this._undoActive=delta<0&&this._savePending;this._redoActive=delta>0&&this._savePending;if(!this._savePending)this._prevState=
weavejs.util.JS.copyObject(sm.getSessionState(this._subject));sm.getCallbackCollection(this).triggerCallbacks()}};
weavejs.core.SessionStateLog.prototype.debugHistory=function(logEntry){var h=this._undoHistory.concat();for(var i=0;i<h.length;i++)h[i]=h[i].id;var f=this._redoHistory.concat();for(i=0;i<f.length;i++)f[i]=f[i].id;if(logEntry){weavejs.util.JS.log('\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c\x3c');weavejs.util.JS.log('NEW HISTORY (backward) '+
logEntry.id+':',logEntry.backward);weavejs.util.JS.log('\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d');weavejs.util.JS.log('NEW HISTORY (forward) '+logEntry.id+':',logEntry.forward);weavejs.util.JS.log('\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e\x3e')}org.apache.flex.utils.Language.trace('undo ['+
h+']','redo ['+f+']')};weavejs.core.SessionStateLog.prototype.getSessionState=function(){var cc=weavejs.WeaveAPI.SessionManager.getCallbackCollection(this);cc.delayCallbacks();this.synchronizeNow();var state={'version':0,'currentState':this._prevState,'undoHistory':this._undoHistory.concat(),'redoHistory':this._redoHistory.concat(),'nextId':this._nextId};cc.resumeCallbacks();return state};
weavejs.core.SessionStateLog.prototype.setSessionState=function(state){var cc=weavejs.WeaveAPI.SessionManager.getCallbackCollection(this);cc.delayCallbacks();this.enableLogging.delayCallbacks();try{var version=Number(state.version);switch(version){case 0:this._prevState=state.currentState;this._undoHistory=weavejs.core.LogEntry.convertGenericObjectsToLogEntries(state.undoHistory,this._syncDelay);this._redoHistory=weavejs.core.LogEntry.convertGenericObjectsToLogEntries(state.redoHistory,this._syncDelay);
this._nextId=Number(state.nextId);break;default:throw new Error('Weave history format version '+version+' is unsupported.');}this._undoActive=false;this._redoActive=false;this._savePending=false;this._saveTime=0;this._triggerDelay=-1;this._syncTime=weavejs.util.JS.now();weavejs.WeaveAPI.SessionManager.setSessionState(this._subject,this._prevState)}finally{this.enableLogging.resumeCallbacks();cc.triggerCallbacks();cc.resumeCallbacks()}};
Object.defineProperties(weavejs.core.SessionStateLog.prototype,{undoHistory:{get:function(){return this._undoHistory}},redoHistory:{get:function(){return this._redoHistory}}});weavejs.core.SessionStateLog.prototype.FLEXJS_CLASS_INFO={names:[{name:'SessionStateLog',qName:'weavejs.core.SessionStateLog'}],interfaces:[weavejs.api.core.ILinkableVariable,weavejs.api.core.IDisposableObject]};goog.exportSymbol('weavejs.core.SessionStateLog',weavejs.core.SessionStateLog);
weavejs.core.SessionStateLog.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'enableLogging':{type:'LinkableBoolean'}}},accessors:function(){return{'undoHistory':{type:'Array',declaredBy:'weavejs.core.SessionStateLog'},'redoHistory':{type:'Array',declaredBy:'weavejs.core.SessionStateLog'}}},methods:function(){return{'SessionStateLog':{type:'',declaredBy:'weavejs.core.SessionStateLog'},'dispose':{type:'void',declaredBy:'weavejs.core.SessionStateLog'},'squashHistory':{type:'void',
declaredBy:'weavejs.core.SessionStateLog'},'clearHistory':{type:'void',declaredBy:'weavejs.core.SessionStateLog'},'synchronizeNow':{type:'void',declaredBy:'weavejs.core.SessionStateLog'},'undo':{type:'void',declaredBy:'weavejs.core.SessionStateLog'},'redo':{type:'void',declaredBy:'weavejs.core.SessionStateLog'},'getSessionState':{type:'Object',declaredBy:'weavejs.core.SessionStateLog'},'setSessionState':{type:'void',declaredBy:'weavejs.core.SessionStateLog'}}}}};goog.provide('weavejs.api.core.ILinkableCompositeObject');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.core.ILinkableCompositeObject=function(){};weavejs.api.core.ILinkableCompositeObject.prototype.getSessionState=function(){};weavejs.api.core.ILinkableCompositeObject.prototype.setSessionState=function(newState,removeMissingDynamicObjects){};
weavejs.api.core.ILinkableCompositeObject.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableCompositeObject',qName:'weavejs.api.core.ILinkableCompositeObject'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.core.ILinkableCompositeObject.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'getSessionState':{type:'Array',declaredBy:'weavejs.api.core.ILinkableCompositeObject'},'setSessionState':{type:'void',declaredBy:'weavejs.api.core.ILinkableCompositeObject'}}}}};goog.provide('weavejs.api.core.ILinkableDynamicObject');goog.require('weavejs.api.core.ILinkableCompositeObject');weavejs.api.core.ILinkableDynamicObject=function(){};weavejs.api.core.ILinkableDynamicObject.prototype.internalObject;weavejs.api.core.ILinkableDynamicObject.prototype.requestGlobalObject=function(name,objectType,lockObject){};weavejs.api.core.ILinkableDynamicObject.prototype.requestLocalObject=function(objectType,lockObject){};
weavejs.api.core.ILinkableDynamicObject.prototype.requestLocalObjectCopy=function(objectToCopy){};weavejs.api.core.ILinkableDynamicObject.prototype.lock=function(){};weavejs.api.core.ILinkableDynamicObject.prototype.removeObject=function(){};weavejs.api.core.ILinkableDynamicObject.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableDynamicObject',qName:'weavejs.api.core.ILinkableDynamicObject'}],interfaces:[weavejs.api.core.ILinkableCompositeObject]};
weavejs.api.core.ILinkableDynamicObject.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'internalObject':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},'target':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},'targetPath':{type:'Array',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},'foundPlaceholder':{type:'Boolean',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},
'locked':{type:'Boolean',declaredBy:'weavejs.api.core.ILinkableDynamicObject'}}},methods:function(){return{'requestGlobalObject':{type:'*',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},'requestLocalObject':{type:'*',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},'requestLocalObjectCopy':{type:'void',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},'lock':{type:'void',declaredBy:'weavejs.api.core.ILinkableDynamicObject'},'removeObject':{type:'void',declaredBy:'weavejs.api.core.ILinkableDynamicObject'}}}}};goog.provide('weavejs.api.core.ILinkableHashMap');goog.require('weavejs.api.core.ILinkableCompositeObject');weavejs.api.core.ILinkableHashMap=function(){};weavejs.api.core.ILinkableHashMap.prototype.typeRestriction;weavejs.api.core.ILinkableHashMap.prototype.setNameOrder=function(newOrder){};weavejs.api.core.ILinkableHashMap.prototype.getNames=function(filter,filterIncludesPlaceholders){};weavejs.api.core.ILinkableHashMap.prototype.getObjects=function(filter,filterIncludesPlaceholders){};
weavejs.api.core.ILinkableHashMap.prototype.toObject=function(filter,filterIncludesPlaceholders){};weavejs.api.core.ILinkableHashMap.prototype.toMap=function(filter,filterIncludesPlaceholders){};weavejs.api.core.ILinkableHashMap.prototype.getName=function(object){};weavejs.api.core.ILinkableHashMap.prototype.getObject=function(name){};weavejs.api.core.ILinkableHashMap.prototype.setObject=function(name,object,lockObject){};
weavejs.api.core.ILinkableHashMap.prototype.requestObject=function(name,classDef,lockObject){};weavejs.api.core.ILinkableHashMap.prototype.requestObjectCopy=function(name,objectToCopy){};weavejs.api.core.ILinkableHashMap.prototype.renameObject=function(oldName,newName){};weavejs.api.core.ILinkableHashMap.prototype.objectIsLocked=function(name){};weavejs.api.core.ILinkableHashMap.prototype.removeObject=function(name){};weavejs.api.core.ILinkableHashMap.prototype.removeAllObjects=function(){};
weavejs.api.core.ILinkableHashMap.prototype.generateUniqueName=function(baseName){};weavejs.api.core.ILinkableHashMap.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableHashMap',qName:'weavejs.api.core.ILinkableHashMap'}],interfaces:[weavejs.api.core.ILinkableCompositeObject]};
weavejs.api.core.ILinkableHashMap.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'typeRestriction':{type:'Class',declaredBy:'weavejs.api.core.ILinkableHashMap'},'childListCallbacks':{type:'IChildListCallbackInterface',declaredBy:'weavejs.api.core.ILinkableHashMap'}}},methods:function(){return{'setNameOrder':{type:'void',declaredBy:'weavejs.api.core.ILinkableHashMap'},'getNames':{type:'Array',declaredBy:'weavejs.api.core.ILinkableHashMap'},
'getObjects':{type:'Array',declaredBy:'weavejs.api.core.ILinkableHashMap'},'toObject':{type:'Object',declaredBy:'weavejs.api.core.ILinkableHashMap'},'toMap':{type:'Object',declaredBy:'weavejs.api.core.ILinkableHashMap'},'getName':{type:'String',declaredBy:'weavejs.api.core.ILinkableHashMap'},'getObject':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ILinkableHashMap'},'setObject':{type:'void',declaredBy:'weavejs.api.core.ILinkableHashMap'},'requestObject':{type:'*',declaredBy:'weavejs.api.core.ILinkableHashMap'},
'requestObjectCopy':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ILinkableHashMap'},'renameObject':{type:'ILinkableObject',declaredBy:'weavejs.api.core.ILinkableHashMap'},'objectIsLocked':{type:'Boolean',declaredBy:'weavejs.api.core.ILinkableHashMap'},'removeObject':{type:'void',declaredBy:'weavejs.api.core.ILinkableHashMap'},'removeAllObjects':{type:'void',declaredBy:'weavejs.api.core.ILinkableHashMap'},'generateUniqueName':{type:'String',declaredBy:'weavejs.api.core.ILinkableHashMap'}}}}};goog.provide('weavejs.path.WeavePath');weavejs.path.WeavePath=function(weave,basePath){this.weave=weave;this._path=weavejs.path.WeavePath._A(basePath,1);this._parent=null};weavejs.path.WeavePath.prototype.weave;weavejs.path.WeavePath.prototype._path;weavejs.path.WeavePath.prototype._parent;
weavejs.path.WeavePath._A=function(args,option){option=typeof option!=='undefined'?option:0;if(args.length==option&&org.apache.flex.utils.Language.is(args[0],Array))return[].concat(args[0],Array.prototype.slice.call(args,1));return Array.prototype.slice.call(args)};
weavejs.path.WeavePath.prototype.push=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);var newWeavePath=new this.constructor(this.weave,this.getPath(relativePath));newWeavePath._parent=this;return newWeavePath};weavejs.path.WeavePath.prototype.pop=function(){if(this._parent)return this._parent;else weavejs.path.WeavePath._failMessage('pop','stack is empty');return null};
weavejs.path.WeavePath.prototype.request=function(relativePath_objectType){relativePath_objectType=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_objectType,2);if(!weavejs.path.WeavePath._assertParams('request',args))return this;var type=org.apache.flex.utils.Language.string(args.pop());var relativePath=args;var classDef;var className;if(weavejs.util.JS.isClass(type)){classDef=weavejs.util.JS.asClass(type);className=Weave.className(classDef)}else{className=
org.apache.flex.utils.Language.as(type,String);classDef=Weave.getDefinition(className);if(!classDef)throw new Error(weavejs.util.StandardLib.substitute('No class definition for {0}',className));}var objectPath=this._path.concat(relativePath);if(!objectPath.length){if(Object(this.weave.root).constructor==classDef)return this;throw new Error('Cannot request an object at the root path');}var parentPath=objectPath.concat();var childName=parentPath.pop();var parent=Weave.followPath(this.weave.root,parentPath);
var hashMap=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableHashMap);var dynamicObject=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableDynamicObject);var child=null;if(hashMap){if(org.apache.flex.utils.Language.is(childName,Number))childName=hashMap.getNames()[childName];child=hashMap.requestObject(org.apache.flex.utils.Language.as(childName,String),classDef,false)}else if(dynamicObject)child=dynamicObject.requestGlobalObject(org.apache.flex.utils.Language.as(childName,
String),classDef,false);else child=Weave.followPath(this.weave.root,objectPath);if(child&&child.constructor==classDef)return this;throw new Error(weavejs.util.StandardLib.substitute('Request for {0} failed at path {1}',org.apache.flex.utils.Language.as(type,String)||Weave.className(type),JSON.stringify(objectPath)));};
weavejs.path.WeavePath.prototype.remove=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);if(this._path.length+relativePath.length==0)throw new Error('Cannot remove root object');var parentPath=this._path.concat(relativePath);var childName=parentPath.pop();var parent=Weave.followPath(this.weave.root,parentPath);var hashMap=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableHashMap);if(hashMap){if(org.apache.flex.utils.Language.is(childName,
Number))childName=hashMap.getNames()[childName];if(hashMap.objectIsLocked(org.apache.flex.utils.Language.as(childName,String)))throw new Error('Object is locked and cannot be removed: '+this.push(relativePath));hashMap.removeObject(org.apache.flex.utils.Language.as(childName,String));return this}var dynamicObject=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableDynamicObject);if(dynamicObject){if(dynamicObject.locked)throw new Error('Object is locked and cannot be removed: '+this.push(relativePath));
dynamicObject.removeObject();return this}if(parent)throw new Error('Parent object does not support dynamic children, so cannot remove child: '+this.push(relativePath));else throw new Error('No parent from which to remove a child: '+this.push(relativePath));};
weavejs.path.WeavePath.prototype.reorder=function(orderedNames){orderedNames=Array.prototype.slice.call(arguments,0);orderedNames=weavejs.path.WeavePath._A(orderedNames,1);if(weavejs.path.WeavePath._assertParams('reorder',orderedNames)){var hashMap=org.apache.flex.utils.Language.as(this.getObject(),weavejs.api.core.ILinkableHashMap);if(hashMap)if(orderedNames)hashMap.setNameOrder(orderedNames);weavejs.path.WeavePath._failMessage('reorder','path does not refer to an ILinkableHashMap: '+this)}return this};
weavejs.path.WeavePath.prototype.state=function(relativePath_state){relativePath_state=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_state,2);if(weavejs.path.WeavePath._assertParams('state',args)){var state=args.pop();var obj=this.getObject(args);if(obj)Weave.setState(obj,state,true);else weavejs.path.WeavePath._failObject('state',this.getPath(args))}return this};
weavejs.path.WeavePath.prototype.diff=function(relativePath_diff){relativePath_diff=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_diff,2);if(weavejs.path.WeavePath._assertParams('diff',args)){var diff=args.pop();var obj=this.getObject(args);if(obj)Weave.setState(obj,diff,false);else weavejs.path.WeavePath._failObject('diff',this.getPath(args))}return this};
weavejs.path.WeavePath.prototype.addCallback=function(relevantContext,callback,triggerCallbackNow,immediateMode,delayWhileBusy){triggerCallbackNow=typeof triggerCallbackNow!=='undefined'?triggerCallbackNow:false;immediateMode=typeof immediateMode!=='undefined'?immediateMode:false;delayWhileBusy=typeof delayWhileBusy!=='undefined'?delayWhileBusy:true;if(typeof relevantContext==='function'&&typeof callback!=='function'){if(arguments.length>3)delayWhileBusy=immediateMode;if(arguments.length>2)immediateMode=
triggerCallbackNow;if(arguments.length>1)triggerCallbackNow=callback;if(arguments.length>0)callback=org.apache.flex.utils.Language.as(relevantContext,Function);relevantContext=null}else if(!weavejs.path.WeavePath._assertParams('addCallback',arguments,2))return this;if(!relevantContext)callback['this']=this;var object=this.getObject();if(!object)throw new Error('No ILinkableObject to which to add a callback: '+this);if(immediateMode)Weave.getCallbacks(object).addImmediateCallback(relevantContext,callback,
triggerCallbackNow,false);else Weave.getCallbacks(object).addGroupedCallback(relevantContext,callback,triggerCallbackNow,delayWhileBusy);return this};
weavejs.path.WeavePath.prototype.removeCallback=function(relevantContext,callback){var object=this.getObject();if(!object)throw new Error('No ILinkableObject from which to remove a callback: '+this);if(arguments.length==1&&typeof relevantContext==='function'){callback=org.apache.flex.utils.Language.as(relevantContext,Function);relevantContext=null}else if(!weavejs.path.WeavePath._assertParams('removeCallback',arguments,2))return this;Weave.getCallbacks(object).removeCallback(relevantContext||this,
callback);return this};weavejs.path.WeavePath.prototype.exec=function(script_or_function,callback){callback=typeof callback!=='undefined'?callback:null;if(weavejs.path.WeavePath._assertParams('exec',arguments)){var result=this.getValue(script_or_function);if(callback!=null)callback.call(this,result)}return this};
weavejs.path.WeavePath.prototype.call=function(func,args){args=Array.prototype.slice.call(arguments,1);if(!func)weavejs.path.WeavePath._assertParams('call',[]);else func.apply(this,args);return this};
weavejs.path.WeavePath.prototype.forEach=function(items,visitorFunction){if(weavejs.path.WeavePath._assertParams('forEach',arguments,2))if(org.apache.flex.utils.Language.is(items,Array)&&Array.prototype.forEach)items.forEach(visitorFunction,this);else for(var key in items)visitorFunction.call(this,items[key],key,items);return this};
weavejs.path.WeavePath.prototype.forEachName=function(relativePath_visitorFunction){relativePath_visitorFunction=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_visitorFunction,2);if(weavejs.path.WeavePath._assertParams('forEachName',args)){var visitorFunction=org.apache.flex.utils.Language.as(args.pop(),Function);this.getNames(args).forEach(visitorFunction,this)}return this};
weavejs.path.WeavePath.prototype.forEachChild=function(relativePath_visitorFunction){relativePath_visitorFunction=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_visitorFunction,2);if(weavejs.path.WeavePath._assertParams('forEachChild',args)){var visitorFunction=args.pop();this.getChildren(args).forEach(visitorFunction,this)}return this};
weavejs.path.WeavePath.prototype.trace=function(args){args=Array.prototype.slice.call(arguments,0);weavejs.util.JS.log.apply(Weave,weavejs.path.WeavePath._A(args));return this};weavejs.path.WeavePath.prototype.getPath=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);return this._path.concat(weavejs.path.WeavePath._A(relativePath,1))};
weavejs.path.WeavePath.prototype._getChildNames=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);var object=this.getObject(relativePath);if(object){if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableHashMap))return org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableHashMap).getNames();if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableDynamicObject))return[null];
return weavejs.WeaveAPI.SessionManager['getLinkablePropertyNames'](object,true)}throw new Error('No ILinkableObject for which to get child names at '+this);};weavejs.path.WeavePath.prototype.getNames=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);return this._getChildNames(relativePath)};
weavejs.path.WeavePath.prototype.getChildren=function(relativePath){var self=this;relativePath=Array.prototype.slice.call(arguments,0);var __localFn0__=function(name){return this.push(relativePath.concat(name))};relativePath=weavejs.path.WeavePath._A(relativePath,1);return this._getChildNames(relativePath).map(__localFn0__,this)};
weavejs.path.WeavePath.prototype.getType=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);var object=this.getObject(relativePath);if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableHashMap)&&this.getType('class'))return org.apache.flex.utils.Language.as(this.getState('class'),String);return Weave.className(object)};
weavejs.path.WeavePath.prototype.getSimpleType=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);var type=Weave.className(this.getObject(relativePath));return type&&type.split('.').pop().split(':').pop()};
weavejs.path.WeavePath.prototype.getState=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);var obj=this.getObject(relativePath);if(obj)return Weave.getState(obj);else weavejs.util.JS.error('Warning: No ILinkableObject from which to get session state at '+this.push(relativePath));return null};
weavejs.path.WeavePath.prototype.getTypedState=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);return weavejs.WeaveAPI.SessionManager['getTypedStateTree'](this.getObject(relativePath))};
weavejs.path.WeavePath.prototype.getUntypedState=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);var state=weavejs.util.JS.copyObject(this.getState(relativePath));return weavejs.api.core.DynamicState.removeTypeFromState(state)};
weavejs.path.WeavePath.prototype.getDiff=function(relativePath_previousState){relativePath_previousState=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_previousState,2);if(weavejs.path.WeavePath._assertParams('getDiff',args)){var previousState=args.pop();var obj=this.getObject(args);if(obj)return Weave.computeDiff(previousState,Weave.getState(obj));else weavejs.util.JS.error('Warning: No ILinkableObject from which to get diff at '+this.push(args))}return null};
weavejs.path.WeavePath.prototype.getReverseDiff=function(relativePath_otherState){relativePath_otherState=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_otherState,2);if(weavejs.path.WeavePath._assertParams('getReverseDiff',args)){var otherState=args.pop();var obj=this.getObject(args);if(obj)return Weave.computeDiff(Weave.getState(obj),otherState);else weavejs.util.JS.error('Warning: No ILinkableObject from which to get reverse diff at '+this.push(args))}return null};
weavejs.path.WeavePath.prototype.getValue=function(script_or_function,args){args=Array.prototype.slice.call(arguments,1);if(!script_or_function)weavejs.path.WeavePath._assertParams('getValue',[]);if(org.apache.flex.utils.Language.is(script_or_function,String))script_or_function=weavejs.util.JS.compile(script_or_function);return script_or_function.apply(this.getObject(),args)};
weavejs.path.WeavePath.prototype.getObject=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);relativePath=weavejs.path.WeavePath._A(relativePath,1);return Weave.followPath(this.weave.root,this.getPath(relativePath))};weavejs.path.WeavePath.prototype.toString=function(){return'WeavePath('+JSON.stringify(this._path)+')'};
weavejs.path.WeavePath._assertParams=function(methodName,args,minLength){minLength=typeof minLength!=='undefined'?minLength:1;if(!minLength)minLength=1;if(args.length<minLength){var min_params=minLength==1?'one parameter':minLength+' parameters';weavejs.path.WeavePath._failMessage(methodName,'requires at least '+min_params);return false}return true};weavejs.path.WeavePath._failPath=function(methodName,path){weavejs.path.WeavePath._failMessage(methodName,'command failed',path)};
weavejs.path.WeavePath._failObject=function(methodName,path){weavejs.path.WeavePath._failMessage(methodName,'object does not exist',path)};weavejs.path.WeavePath._failMessage=function(methodName,message,path){path=typeof path!=='undefined'?path:null;var str='WeavePath.'+methodName+'(): '+message;if(path)str+=' (path: '+JSON.stringify(path)+')';throw new Error(str);};
weavejs.path.WeavePath.migrate=function(source,destination){var typedState=source.getValue('WeaveAPI.SessionManager.getTypedStateTree(this)');var delayed=[];weavejs.path.WeavePath._setTypedState(destination.path(),typedState,delayed);for(var i=delayed.length-1;i>=0;i--){var cc=delayed[i];cc.resumeCallbacks()}};
weavejs.path.WeavePath._setTypedState=function(path,typedState,delayedCallbacks){var type=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.CLASS_NAME]);var state=typedState[weavejs.api.core.DynamicState.SESSION_STATE];var hasChildren=weavejs.api.core.DynamicState.isDynamicStateArray(state);var def=Weave.getDefinition(type);if(def)path.request(def);else if(hasChildren)path.request(weavejs.WeaveAPI.ClassRegistry.getImplementations(weavejs.api.core.ILinkableHashMap)[0]).push('class').request('LinkableString').state(type);
else path.request('LinkableVariable');var cc=Weave.getCallbacks(path.getObject());cc.delayCallbacks();delayedCallbacks.push(cc);if(hasChildren){var foreachiter0_target=state;for(var foreachiter0 in foreachiter0_target){typedState=foreachiter0_target[foreachiter0];type=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.CLASS_NAME]);if(type==='Array')path.state(typedState[weavejs.api.core.DynamicState.SESSION_STATE]);else weavejs.path.WeavePath._setTypedState(path.push(typedState[weavejs.api.core.DynamicState.OBJECT_NAME]),
typedState,delayedCallbacks)}}else path.state(state)};weavejs.path.WeavePath.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeavePath',qName:'weavejs.path.WeavePath'}]};goog.exportSymbol('weavejs.path.WeavePath',weavejs.path.WeavePath);
weavejs.path.WeavePath.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'weave':{type:'Weave'}}},accessors:function(){return{}},methods:function(){return{'WeavePath':{type:'',declaredBy:'weavejs.path.WeavePath'},'push':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'pop':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'request':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'remove':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'reorder':{type:'WeavePath',
declaredBy:'weavejs.path.WeavePath'},'state':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'diff':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'addCallback':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'removeCallback':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'exec':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'call':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'forEach':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'forEachName':{type:'WeavePath',
declaredBy:'weavejs.path.WeavePath'},'forEachChild':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'trace':{type:'WeavePath',declaredBy:'weavejs.path.WeavePath'},'getPath':{type:'Array',declaredBy:'weavejs.path.WeavePath'},'getNames':{type:'Array',declaredBy:'weavejs.path.WeavePath'},'getChildren':{type:'Array',declaredBy:'weavejs.path.WeavePath'},'getType':{type:'String',declaredBy:'weavejs.path.WeavePath'},'getSimpleType':{type:'String',declaredBy:'weavejs.path.WeavePath'},'getState':{type:'Object',
declaredBy:'weavejs.path.WeavePath'},'getTypedState':{type:'Object',declaredBy:'weavejs.path.WeavePath'},'getUntypedState':{type:'Object',declaredBy:'weavejs.path.WeavePath'},'getDiff':{type:'Object',declaredBy:'weavejs.path.WeavePath'},'getReverseDiff':{type:'Object',declaredBy:'weavejs.path.WeavePath'},'getValue':{type:'Object',declaredBy:'weavejs.path.WeavePath'},'getObject':{type:'ILinkableObject',declaredBy:'weavejs.path.WeavePath'},'toString':{type:'String',declaredBy:'weavejs.path.WeavePath'}}}}};goog.provide('weavejs.path.WeavePathDataShared');
weavejs.path.WeavePathDataShared=function(){this.IKeySet=weavejs.util.JS.global['weavejs']['api']['data']['IKeySet'];this.IQualifiedKeyManager=weavejs.util.JS.global['weavejs']['api']['data']['IQualifiedKeyManager'];this.IQualifiedKey=weavejs.util.JS.global['weavejs']['api']['data']['IQualifiedKey'];this.d2d_keySet_addedKeys=new weavejs.util.Dictionary2D(true);this.d2d_keySet_removedKeys=new weavejs.util.Dictionary2D(true);this.map_keySet_timeoutId=new weavejs.util.JS.WeakMap};weavejs.path.WeavePathDataShared.prototype.IKeySet;
weavejs.path.WeavePathDataShared.prototype.IQualifiedKeyManager;weavejs.path.WeavePathDataShared.prototype.IQualifiedKey;weavejs.path.WeavePathDataShared.DEFAULT_PROBE_KEY_SET='defaultProbeKeySet';weavejs.path.WeavePathDataShared.DEFAULT_SELECTION_KEY_SET='defaultSelectionKeySet';weavejs.path.WeavePathDataShared.DEFAULT_SUBSET_KEY_FILTER='defaultSubsetKeyFilter';
weavejs.path.WeavePathDataShared.prototype.init=function(weave){this.weave=weave;this.qkm=weavejs.WeaveAPI.QKeyManager;this.probe_keyset=org.apache.flex.utils.Language.as(weave.path(weavejs.path.WeavePathDataShared.DEFAULT_PROBE_KEY_SET),weavejs.path.WeavePathData);this.selection_keyset=org.apache.flex.utils.Language.as(weave.path(weavejs.path.WeavePathDataShared.DEFAULT_SELECTION_KEY_SET),weavejs.path.WeavePathData);this.subset_filter=org.apache.flex.utils.Language.as(weave.path(weavejs.path.WeavePathDataShared.DEFAULT_SUBSET_KEY_FILTER),
weavejs.path.WeavePathData)};weavejs.path.WeavePathDataShared.prototype.qkm;weavejs.path.WeavePathDataShared.prototype.weave;weavejs.path.WeavePathDataShared.prototype.probe_keyset;weavejs.path.WeavePathDataShared.prototype.selection_keyset;weavejs.path.WeavePathDataShared.prototype.subset_filter;weavejs.path.WeavePathDataShared.prototype.d2d_keySet_addedKeys;weavejs.path.WeavePathDataShared.prototype.d2d_keySet_removedKeys;weavejs.path.WeavePathDataShared.prototype.map_keySet_timeoutId;
weavejs.path.WeavePathDataShared.prototype.qkeyToIndex=function(qkey){return qkey.toNumber()};weavejs.path.WeavePathDataShared.prototype.indexToQKey=function(index){return this.qkm.numberToQKey(index)};weavejs.path.WeavePathDataShared.prototype.qkeyToString=function(qkey){return qkey.toString()};weavejs.path.WeavePathDataShared.prototype.stringToQKey=function(s){return org.apache.flex.utils.Language.as(s,this.IQualifiedKey)||this.qkm.stringToQKey(s)};
weavejs.path.WeavePathDataShared.prototype._flushKeys=function(keySet){var add_keys=this.d2d_keySet_addedKeys.secondaryKeys(keySet);var remove_keys=this.d2d_keySet_removedKeys.secondaryKeys(keySet);this.d2d_keySet_addedKeys.removeAllPrimary(keySet);this.d2d_keySet_removedKeys.removeAllPrimary(keySet);keySet['addKeys'](add_keys);keySet['removeKeys'](remove_keys);this.map_keySet_timeoutId['delete'](keySet)};
weavejs.path.WeavePathDataShared.prototype._flushKeysLater=function(keySet){if(!this.map_keySet_timeoutId.has(keySet))this.map_keySet_timeoutId.set(keySet,weavejs.util.JS.setTimeout(org.apache.flex.utils.Language.closure(this._flushKeys,this,'_flushKeys'),25,keySet))};
weavejs.path.WeavePathDataShared.prototype._addKeys=function(keySet,qkeyStrings){var self=this;var __localFn0__=function(qkey){self.d2d_keySet_addedKeys.set(keySet,qkey,true);self.d2d_keySet_removedKeys.remove(keySet,qkey)};this.qkm.getQKeys(null,qkeyStrings).forEach(__localFn0__);this._flushKeysLater(keySet)};
weavejs.path.WeavePathDataShared.prototype._removeKeys=function(keySet,qkeyStrings){var self=this;var __localFn0__=function(qkey){self.d2d_keySet_removedKeys.set(keySet,qkey,true);self.d2d_keySet_addedKeys.remove(keySet,qkey)};this.qkm.getQKeys(null,qkeyStrings).forEach(__localFn0__);this._flushKeysLater(keySet)};weavejs.path.WeavePathDataShared.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeavePathDataShared',qName:'weavejs.path.WeavePathDataShared'}]};
goog.exportSymbol('weavejs.path.WeavePathDataShared',weavejs.path.WeavePathDataShared);
weavejs.path.WeavePathDataShared.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'IKeySet':{type:'*'},'IQualifiedKeyManager':{type:'*'},'IQualifiedKey':{type:'*'},'weave':{type:'Weave'},'probe_keyset':{type:'WeavePathData'},'selection_keyset':{type:'WeavePathData'},'subset_filter':{type:'WeavePathData'}}},accessors:function(){return{}},methods:function(){return{'WeavePathDataShared':{type:'',declaredBy:'weavejs.path.WeavePathDataShared'},'init':{type:'void',declaredBy:'weavejs.path.WeavePathDataShared'},
'qkeyToIndex':{type:'int',declaredBy:'weavejs.path.WeavePathDataShared'},'indexToQKey':{type:'Object',declaredBy:'weavejs.path.WeavePathDataShared'},'qkeyToString':{type:'String',declaredBy:'weavejs.path.WeavePathDataShared'},'stringToQKey':{type:'Object',declaredBy:'weavejs.path.WeavePathDataShared'},'_flushKeys':{type:'void',declaredBy:'weavejs.path.WeavePathDataShared'},'_flushKeysLater':{type:'void',declaredBy:'weavejs.path.WeavePathDataShared'},'_addKeys':{type:'void',declaredBy:'weavejs.path.WeavePathDataShared'},
'_removeKeys':{type:'void',declaredBy:'weavejs.path.WeavePathDataShared'}}}}};goog.provide('weavejs.path.WeavePathData');goog.require('weavejs.path.WeavePath');goog.require('weavejs.path.WeavePathDataShared');
weavejs.path.WeavePathData=function(weave,basePath){this.IDataSource=weavejs.util.JS.global['weavejs']['api']['data']['IDataSource'];this.ColumnUtils=weavejs.util.JS.global['weavejs']['data']['ColumnUtils'];this.ReferencedColumn=weavejs.util.JS.global['weavejs']['data']['ReferencedColumn'];this.DynamicColumn=weavejs.util.JS.global['weavejs']['data']['DynamicColumn'];this.ExtendedDynamicColumn=weavejs.util.JS.global['weavejs']['data']['ExtendedDynamicColumn'];this.IAttributeColumn=weavejs.util.JS.global['weavejs']['api']['data']['IAttributeColumn'];
this.IKeySet=weavejs.util.JS.global['weavejs']['api']['data']['IKeySet'];this.IKeySetCallbackInterface=weavejs.util.JS.global['weavejs']['api']['data']['IKeySetCallbackInterface'];this.IQualifiedKey=weavejs.util.JS.global['weavejs']['api']['data']['IQualifiedKey'];weavejs.path.WeavePathData.base(this,'constructor',weave,basePath);var shared=weavejs.path.WeavePathData.map_weave.get(weave);if(!shared){weavejs.path.WeavePathData.map_weave.set(weave,shared=new weavejs.path.WeavePathDataShared);shared.init(weave)}this.shared=
shared;this.probe_keyset=shared.probe_keyset;this.selection_keyset=shared.selection_keyset;this.subset_filter=shared.subset_filter;this.qkeyToString=org.apache.flex.utils.Language.closure(shared.qkeyToString,shared,'qkeyToString');this.stringToQKey=org.apache.flex.utils.Language.closure(shared.stringToQKey,shared,'stringToQKey');this.indexToQKey=org.apache.flex.utils.Language.closure(shared.indexToQKey,shared,'indexToQKey');this.qkeyToIndex=org.apache.flex.utils.Language.closure(shared.qkeyToIndex,
shared,'qkeyToIndex')};goog.inherits(weavejs.path.WeavePathData,weavejs.path.WeavePath);weavejs.path.WeavePathData.prototype.IDataSource;weavejs.path.WeavePathData.prototype.ColumnUtils;weavejs.path.WeavePathData.prototype.ReferencedColumn;weavejs.path.WeavePathData.prototype.DynamicColumn;weavejs.path.WeavePathData.prototype.ExtendedDynamicColumn;weavejs.path.WeavePathData.prototype.IAttributeColumn;weavejs.path.WeavePathData.prototype.IKeySet;weavejs.path.WeavePathData.prototype.IKeySetCallbackInterface;
weavejs.path.WeavePathData.prototype.IQualifiedKey;weavejs.path.WeavePathData.map_weave=new weavejs.util.JS.WeakMap;weavejs.path.WeavePathData.prototype.shared;weavejs.path.WeavePathData.prototype.probe_keyset;weavejs.path.WeavePathData.prototype.selection_keyset;weavejs.path.WeavePathData.prototype.subset_filter;weavejs.path.WeavePathData.prototype.qkeyToString;weavejs.path.WeavePathData.prototype.stringToQKey;weavejs.path.WeavePathData.prototype.indexToQKey;weavejs.path.WeavePathData.prototype.qkeyToIndex;
weavejs.path.WeavePathData.prototype._initProperty=function(manifest,callback_pass,property_descriptor){var name=org.apache.flex.utils.Language.string(property_descriptor['name']||weavejs.path.WeavePath._failMessage('initProperty','A "name" is required'));var label=org.apache.flex.utils.Language.string(property_descriptor['label']);var children=property_descriptor['children'];var type=org.apache.flex.utils.Language.string(property_descriptor['type']);if(!type)type=children?'LinkableHashMap':'LinkableVariable';
var new_prop=org.apache.flex.utils.Language.as(this.push(name),weavejs.path.WeavePathData);if(callback_pass){var callback=property_descriptor['callback'];var triggerNow=property_descriptor['triggerNow'];var immediate=property_descriptor['immediate'];if(callback)new_prop.addCallback(new_prop,callback,triggerNow!==undefined?triggerNow:true,immediate!==undefined?immediate:false)}else{var oldType=new_prop.getType();type=new_prop.request(type).getType();if(label)new_prop.label(label);if(oldType!=type&&
property_descriptor.hasOwnProperty('default'))new_prop.state(property_descriptor['default']);manifest[name]=new_prop}if(children){if(!callback_pass)manifest[name]={};children.forEach(this._initProperty.bind(new_prop,manifest[name],callback_pass))}return this};
weavejs.path.WeavePathData.prototype.initProperties=function(property_descriptor_array,manifest){manifest=typeof manifest!=='undefined'?manifest:null;if(this.getType()==null)this.request('ExternalTool');if(!manifest)manifest={};property_descriptor_array.forEach(this._initProperty.bind(this,manifest,false));property_descriptor_array.forEach(this._initProperty.bind(this,manifest,true));return manifest};
weavejs.path.WeavePathData.prototype.getProperties=function(relativePath){var self=this;relativePath=Array.prototype.slice.call(arguments,0);var __localFn0__=function(name){result[name]=this.push(name)};var result={};this.getNames.apply(this,relativePath).forEach(__localFn0__,this);return result};weavejs.path.WeavePathData.prototype.getKeys=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath,1);return this.IKeySet(this.getObject(args)).keys};
weavejs.path.WeavePathData.prototype.flushKeys=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath,1);if(weavejs.path.WeavePath._assertParams('flushKeys',args)){var keySet=this.getObject(args);this.shared._flushKeys(keySet)}return this};
weavejs.path.WeavePathData.prototype.addKeys=function(relativePath_qkeyStringArray){relativePath_qkeyStringArray=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_qkeyStringArray,2);if(weavejs.path.WeavePath._assertParams('addKeys',args)){var qkeyStringArray=args.pop();var keySet=this.getObject(args);this.shared._addKeys(keySet,qkeyStringArray)}return this};
weavejs.path.WeavePathData.prototype.removeKeys=function(relativePath_qkeyStringArray){relativePath_qkeyStringArray=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_qkeyStringArray,2);if(weavejs.path.WeavePath._assertParams('removeKeys',args)){var qkeyStringArray=args.pop();var keySet=this.getObject(args);this.shared._removeKeys(keySet,qkeyStringArray)}return this};
weavejs.path.WeavePathData.prototype.addKeySetCallback=function(callback,triggerCallbackNow){var self=this;triggerCallbackNow=typeof triggerCallbackNow!=='undefined'?triggerCallbackNow:false;var __localFn0__=function(){callback.call(self,{added:keyCallbacks.keysAdded,removed:keyCallbacks.keysRemoved})};var self=this;var keyCallbacks=org.apache.flex.utils.Language.as(this.getObject('keyCallbacks'),this.IKeySetCallbackInterface);keyCallbacks.addImmediateCallback(keyCallbacks,__localFn0__);if(triggerCallbackNow)callback.call(this,
{added:this.getKeys(),removed:[]});return this};weavejs.path.WeavePathData.prototype.setKeys=function(relativePath_qkeyStringArray){relativePath_qkeyStringArray=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_qkeyStringArray,2);if(weavejs.path.WeavePath._assertParams('setKeys',args)){var qkeyStringArray=args.pop();var keyObjectArray=qkeyStringArray.map(this.stringToQKey);this.getObject(args)['replaceKeys'](keyObjectArray);return this}return this};
weavejs.path.WeavePathData.prototype.filterKeys=function(relativePath_qkeyStringArray){var self=this;relativePath_qkeyStringArray=Array.prototype.slice.call(arguments,0);var __localFn0__=function(key){return obj.containsKey(key)};var args=weavejs.path.WeavePath._A(relativePath_qkeyStringArray,2);if(weavejs.path.WeavePath._assertParams('filterKeys',args)){var qkeyStringArray=args.pop();var keyObjects=qkeyStringArray.map(this.stringToQKey);var obj=this.getObject(args);return weavejs.WeaveAPI.QKeyManager.convertToQKeys(keyObjects).filter(__localFn0__)}return null};
weavejs.path.WeavePathData.prototype.retrieveRecords=function(pathMapping,options){var self=this;options=typeof options!=='undefined'?options:null;var __localFn0__=function(key,iRow,a){var __localFn0__=function(chain,iChain,a){weavejs.path.WeavePathData.setChain(record,chain,results[iChain+1][iRow])};var record={id:key};obj.chains.forEach(__localFn0__);return record};var dataType=org.apache.flex.utils.Language.string(options?options['dataType']:null);var keySetPath=options?options['keySet']:null;
if(!keySetPath&&org.apache.flex.utils.Language.is(options,weavejs.path.WeavePath))keySetPath=org.apache.flex.utils.Language.as(options,weavejs.path.WeavePath);if(arguments.length==1&&org.apache.flex.utils.Language.is(pathMapping,weavejs.path.WeavePath)){keySetPath=org.apache.flex.utils.Language.as(pathMapping,weavejs.path.WeavePath);pathMapping=null}if(!pathMapping)pathMapping=this.getNames();if(org.apache.flex.utils.Language.is(pathMapping,Array)){var names=org.apache.flex.utils.Language.as(pathMapping,
Array);pathMapping={};var foreachiter0_target=names;for(var foreachiter0 in foreachiter0_target){var name=foreachiter0_target[foreachiter0];pathMapping[name]=this.push(name)}}var obj=this.listChainsAndColumns(pathMapping);var results=this.ColumnUtils.joinColumns(obj.columns,dataType,true,keySetPath?keySetPath.getObject():null);return results[0].map(__localFn0__)};
weavejs.path.WeavePathData.setChain=function(root,property_chain,value){value=typeof value!=='undefined'?value:undefined;var __localFn0__=function(prop,i,a){root=root[prop]||(root[prop]={})};property_chain=[].concat(property_chain);var last_property=org.apache.flex.utils.Language.string(property_chain.pop());property_chain.forEach(__localFn0__);if(value===undefined)return root[last_property];return root[last_property]=value};
weavejs.path.WeavePathData.getChain=function(root,property_chain){return weavejs.path.WeavePathData.setChain(root,property_chain)};
weavejs.path.WeavePathData.prototype.listChainsAndColumns=function(obj,prefix,output){prefix=typeof prefix!=='undefined'?prefix:null;output=typeof output!=='undefined'?output:null;if(!prefix)prefix=[];if(!output)output={chains:[],columns:[]};for(var key in obj){var item=obj[key];if(org.apache.flex.utils.Language.is(item,weavejs.path.WeavePath))item=item.getObject();if(org.apache.flex.utils.Language.is(item,weavejs.api.core.ILinkableObject)){if(org.apache.flex.utils.Language.is(item,this.IAttributeColumn)){output.chains.push(prefix.concat(key));
output.columns.push(item)}}else this.listChainsAndColumns(item,prefix.concat(key),output)}return output};weavejs.path.WeavePathData.prototype.label=function(relativePath_label){relativePath_label=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath_label,2);if(weavejs.path.WeavePath._assertParams('setLabel',args)){var label=org.apache.flex.utils.Language.string(args.pop());weavejs.WeaveAPI.EditorManager.setLabel(this.getObject(args),label)}return this};
weavejs.path.WeavePathData.prototype.getLabel=function(relativePath){relativePath=Array.prototype.slice.call(arguments,0);var args=weavejs.path.WeavePath._A(relativePath,1);return weavejs.WeaveAPI.EditorManager.getLabel(this.getObject(args))};
weavejs.path.WeavePathData.prototype.setColumn=function(metadata,dataSourceName){var object=this.getObject();if(!object)object=this.request(this.ReferencedColumn).getObject();if(org.apache.flex.utils.Language.is(object,this.ExtendedDynamicColumn))object=object['internalDynamicColumn'].requestLocalObject(this.ReferencedColumn,false);else if(org.apache.flex.utils.Language.is(object,this.DynamicColumn))object=object['requestLocalObject'](this.ReferencedColumn,false);if(org.apache.flex.utils.Language.is(object,
this.ReferencedColumn)){if(arguments.length<2)dataSourceName=org.apache.flex.utils.Language.string(this.weave.root.getNames(this.IDataSource)[0]);var dataSource=org.apache.flex.utils.Language.as(this.weave.root.getObject(dataSourceName),this.IDataSource);org.apache.flex.utils.Language.as(org.apache.flex.utils.Language.as(object,this.ReferencedColumn),Object).setColumnReference(dataSource,metadata)}else weavejs.path.WeavePath._failMessage('setColumn','Not a compatible column object',this._path);return this};
weavejs.path.WeavePathData.prototype.setColumns=function(metadataMapping,dataSourceName){var self=this;var __localFn0__=function(value,key,a){var path=org.apache.flex.utils.Language.as(this.push(key),weavejs.path.WeavePathData);var func=org.apache.flex.utils.Language.is(value,Array)?org.apache.flex.utils.Language.closure(path.setColumns,path,'setColumns'):org.apache.flex.utils.Language.closure(path.setColumn,path,'setColumn');var args=useDataSource?[value,dataSourceName]:[value];func.apply(path,args)};
var useDataSource=arguments.length>1;this.forEach(metadataMapping,__localFn0__);if(org.apache.flex.utils.Language.is(metadataMapping,Array))while(this.getType(metadataMapping.length))this.remove(metadataMapping.length);return this};weavejs.path.WeavePathData.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeavePathData',qName:'weavejs.path.WeavePathData'}]};goog.exportSymbol('weavejs.path.WeavePathData',weavejs.path.WeavePathData);
weavejs.path.WeavePathData.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'IDataSource':{type:'*'},'ColumnUtils':{type:'*'},'ReferencedColumn':{type:'*'},'DynamicColumn':{type:'*'},'ExtendedDynamicColumn':{type:'*'},'IAttributeColumn':{type:'*'},'IKeySet':{type:'*'},'IKeySetCallbackInterface':{type:'*'},'IQualifiedKey':{type:'*'},'probe_keyset':{type:'WeavePathData'},'selection_keyset':{type:'WeavePathData'},'subset_filter':{type:'WeavePathData'},'qkeyToString':{type:'Function'},
'stringToQKey':{type:'Function'},'indexToQKey':{type:'Function'},'qkeyToIndex':{type:'Function'}}},accessors:function(){return{}},methods:function(){return{'WeavePathData':{type:'',declaredBy:'weavejs.path.WeavePathData'},'getProperties':{type:'Object',declaredBy:'weavejs.path.WeavePathData'},'getKeys':{type:'Array',declaredBy:'weavejs.path.WeavePathData'},'flushKeys':{type:'WeavePath',declaredBy:'weavejs.path.WeavePathData'},'addKeys':{type:'WeavePath',declaredBy:'weavejs.path.WeavePathData'},'removeKeys':{type:'WeavePath',
declaredBy:'weavejs.path.WeavePathData'},'addKeySetCallback':{type:'WeavePath',declaredBy:'weavejs.path.WeavePathData'},'setKeys':{type:'WeavePath',declaredBy:'weavejs.path.WeavePathData'},'filterKeys':{type:'Array',declaredBy:'weavejs.path.WeavePathData'},'retrieveRecords':{type:'Array',declaredBy:'weavejs.path.WeavePathData'},'label':{type:'WeavePath',declaredBy:'weavejs.path.WeavePathData'},'getLabel':{type:'String',declaredBy:'weavejs.path.WeavePathData'},'setColumn':{type:'WeavePath',declaredBy:'weavejs.path.WeavePathData'},
'setColumns':{type:'WeavePathData',declaredBy:'weavejs.path.WeavePathData'}}}}};goog.provide('weavejs.path.WeavePathUI');goog.require('weavejs.path.WeavePathData');weavejs.path.WeavePathUI=function(weave,basePath){weavejs.path.WeavePathUI.base(this,'constructor',weave,basePath)};goog.inherits(weavejs.path.WeavePathUI,weavejs.path.WeavePathData);
weavejs.path.WeavePathUI.prototype.pushPlotter=function(plotterName,plotterType){plotterType=typeof plotterType!=='undefined'?plotterType:null;var tool=this;var result=tool.push('children','visualization','plotManager','plotters',plotterName);if(plotterType)result.request(plotterType);return result};weavejs.path.WeavePathUI.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeavePathUI',qName:'weavejs.path.WeavePathUI'}]};goog.exportSymbol('weavejs.path.WeavePathUI',weavejs.path.WeavePathUI);
weavejs.path.WeavePathUI.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'WeavePathUI':{type:'',declaredBy:'weavejs.path.WeavePathUI'},'pushPlotter':{type:'WeavePath',declaredBy:'weavejs.path.WeavePathUI'}}}}};goog.provide('weavejs.util.DebugUtils');weavejs.util.DebugUtils=function(){};weavejs.util.DebugUtils.map_id_obj=new weavejs.util.JS.Map;weavejs.util.DebugUtils.map_obj_id=new weavejs.util.JS.Map;weavejs.util.DebugUtils._nextId=0;weavejs.util.DebugUtils.debugTrace=function(args){args=Array.prototype.slice.call(arguments,0);for(var i=0;i<args.length;i++)args[i]=weavejs.util.DebugUtils.debugId(args[i]);weavejs.util.JS.log.apply(weavejs.util.JS,args)};
weavejs.util.DebugUtils.debugId=function(object){if(weavejs.util.JS.isPrimitive(object))return String(object);var idString=org.apache.flex.utils.Language.string(weavejs.util.DebugUtils.map_obj_id.get(object));if(!idString){var idNumber=weavejs.util.DebugUtils._nextId++;var className=org.apache.flex.utils.Language.string(Weave.className(object).split('.').pop());idString=className+'#'+idNumber;weavejs.util.DebugUtils.map_obj_id.set(object,idString);weavejs.util.DebugUtils.map_id_obj.set(idNumber,object);
weavejs.util.DebugUtils.map_id_obj.set(idString,object)}return idString};weavejs.util.DebugUtils.debugLookup=function(debugId){debugId=typeof debugId!=='undefined'?debugId:undefined;if(debugId===undefined)return weavejs.util.DebugUtils.getAllDebugIds();return weavejs.util.DebugUtils.map_id_obj.get(debugId)};
weavejs.util.DebugUtils.getAllDebugIds=function(){var ids=new Array(weavejs.util.DebugUtils._nextId);for(var i=0;i<weavejs.util.DebugUtils._nextId;i++)ids[i]=weavejs.util.DebugUtils.map_obj_id.get(weavejs.util.DebugUtils.map_id_obj.get(i));return ids};weavejs.util.DebugUtils.resetDebugIds=function(){weavejs.util.DebugUtils.map_id_obj=new weavejs.util.JS.Map;weavejs.util.DebugUtils.map_obj_id=new weavejs.util.JS.Map;weavejs.util.DebugUtils._nextId=0};weavejs.util.DebugUtils.map_target_callback=new weavejs.util.JS.WeakMap;
weavejs.util.DebugUtils.watch=function(target,callbackReturnsString){target=typeof target!=='undefined'?target:null;callbackReturnsString=typeof callbackReturnsString!=='undefined'?callbackReturnsString:null;var __localFn0__=function(){var str='';var path=Weave.findPath(Weave.getRoot(target),target)||[];if(path.length)str+=' '+JSON.stringify(path.pop());if(callbackReturnsString!=null)str+=': '+callbackReturnsString.call(target,target);weavejs.util.DebugUtils.debugTrace(target,str)};if(!target){weavejs.util.JS.log('Usage: watch(target, optional_callbackReturnsString)');
return}weavejs.util.DebugUtils.unwatch(target);var callback=__localFn0__;weavejs.util.DebugUtils.map_target_callback.set(target,callback);Weave.getCallbacks(target).addImmediateCallback(target,callback)};
weavejs.util.DebugUtils.watchState=function(target,indent){target=typeof target!=='undefined'?target:null;indent=typeof indent!=='undefined'?indent:null;var __localFn0__=function(object){return Weave.stringify(Weave.getState(object),null,indent)};if(!target){weavejs.util.JS.log('Usage: watchState(target, optional_indent)');return}weavejs.util.DebugUtils.watch(target,__localFn0__)};
weavejs.util.DebugUtils.unwatch=function(target){var callback=weavejs.util.DebugUtils.map_target_callback.get(target);weavejs.util.DebugUtils.map_target_callback['delete'](target);Weave.getCallbacks(target).removeCallback(target,callback)};
weavejs.util.DebugUtils.flattenSessionState=function(state,pathPrefix,output){pathPrefix=typeof pathPrefix!=='undefined'?pathPrefix:null;output=typeof output!=='undefined'?output:null;if(!pathPrefix)pathPrefix=[];if(!output)output=[];if(weavejs.api.core.DynamicState.isDynamicStateArray(state)){var names=[];var foreachiter0_target=state;for(var foreachiter0 in foreachiter0_target){var obj=foreachiter0_target[foreachiter0];if(weavejs.api.core.DynamicState.isDynamicState(obj)){var objectName=org.apache.flex.utils.Language.string(obj[weavejs.api.core.DynamicState.OBJECT_NAME]);
var className=org.apache.flex.utils.Language.string(obj[weavejs.api.core.DynamicState.CLASS_NAME]);var sessionState=obj[weavejs.api.core.DynamicState.SESSION_STATE];pathPrefix.push(objectName);if(className)output.push([pathPrefix.concat('class'),className]);weavejs.util.DebugUtils.flattenSessionState(sessionState,pathPrefix,output);pathPrefix.pop();if(objectName)names.push(objectName)}else names.push(obj)}if(names.length)output.push([pathPrefix.concat(),names])}else if(org.apache.flex.utils.Language.is(state,
Array))output.push([pathPrefix.concat(),state]);else if(typeof state==='object'&&state!==null)for(var key in state){pathPrefix.push(key);weavejs.util.DebugUtils.flattenSessionState(state[key],pathPrefix,output);pathPrefix.pop()}else output.push([pathPrefix.concat(),state]);return output};
weavejs.util.DebugUtils.traverseStatePath=function(state,path){try{outerLoop:for(var i in path){var property=path[i];if(weavejs.api.core.DynamicState.isDynamicStateArray(state))if(org.apache.flex.utils.Language.is(property,Number))state=state[property][weavejs.api.core.DynamicState.SESSION_STATE];else{var foreachiter1_target=state;for(var foreachiter1 in foreachiter1_target){var obj=foreachiter1_target[foreachiter1];if(obj[weavejs.api.core.DynamicState.OBJECT_NAME]==property){state=obj[weavejs.api.core.DynamicState.SESSION_STATE];
continue outerLoop}}return undefined}else state=state[property]}return state}catch(e){return undefined}};
weavejs.util.DebugUtils.replaceUnknownObjectsInState=function(stateToModify,className){className=typeof className!=='undefined'?className:null;if(weavejs.api.core.DynamicState.isDynamicStateArray(stateToModify)){var foreachiter2_target=stateToModify;for(var foreachiter2 in foreachiter2_target){var obj=foreachiter2_target[foreachiter2];if(!weavejs.api.core.DynamicState.isDynamicState(obj))continue;className=org.apache.flex.utils.Language.string(obj[weavejs.api.core.DynamicState.CLASS_NAME]);var classDef=
Weave.getDefinition(className);if(!classDef){classDef=Weave.getDefinition('LinkableHashMap');obj[weavejs.api.core.DynamicState.CLASS_NAME]='LinkableHashMap'}if(org.apache.flex.utils.Language.is(classDef.prototype,weavejs.api.core.ILinkableCompositeObject))obj[weavejs.api.core.DynamicState.SESSION_STATE]=weavejs.util.DebugUtils.replaceUnknownObjectsInState(obj[weavejs.api.core.DynamicState.SESSION_STATE],className)}}else if(!weavejs.util.JS.isPrimitive(stateToModify)){var newState=[];if(className)newState.push(weavejs.api.core.DynamicState.create('class',
'LinkableString',className));for(var key in stateToModify){var value=stateToModify[key];var type=weavejs.util.JS.isPrimitive(value)?'LinkableVariable':'LinkableHashMap';newState.push(weavejs.api.core.DynamicState.create(key,type,weavejs.util.DebugUtils.replaceUnknownObjectsInState(value)))}stateToModify=newState}return stateToModify};weavejs.util.DebugUtils.shiftKey=function(reactInstance){return Weave.getDefinition('MouseUtils').forInstance(reactInstance).mouseEvent.shiftKey};
weavejs.util.DebugUtils.prototype.FLEXJS_CLASS_INFO={names:[{name:'DebugUtils',qName:'weavejs.util.DebugUtils'}]};goog.exportSymbol('weavejs.util.DebugUtils',weavejs.util.DebugUtils);weavejs.util.DebugUtils.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('Weave');goog.require('weavejs.WeaveAPI');goog.require('weavejs.api.core.DynamicState');goog.require('weavejs.core.SessionStateLog');goog.require('weavejs.path.WeavePathUI');goog.require('weavejs.util.DebugUtils');goog.require('weavejs.util.Dictionary2D');goog.require('weavejs.util.JS');goog.require('weavejs.util.StandardLib');goog.require('weavejs.api.core.IDisposableObject');goog.require('org.apache.flex.utils.Language');
Weave=function(){this['WeavePath']=weavejs.path.WeavePathUI;this.root=Weave.disposableChild(this,weavejs.WeaveAPI.ClassRegistry.getImplementations(weavejs.api.core.ILinkableHashMap)[0]);this.history=Weave.disposableChild(this,new weavejs.core.SessionStateLog(this.root,Weave.HISTORY_SYNC_DELAY));Weave.map_root_weave.set(this.root,this)};Weave.HISTORY_SYNC_DELAY=100;Weave.FRAME_INTERVAL=1E3/30;Weave.beta=false;
Weave.prototype.dispose=function(){Weave.dispose(this);Weave.map_root_weave['delete'](this.root);this.root=null;this.history=null};Weave.prototype.root;Weave.prototype.history;
Weave.prototype.macro=function(name,params){params=Array.prototype.slice.call(arguments,1);var macros=org.apache.flex.utils.Language.as(this.getObject('WeaveProperties','macros'),weavejs.api.core.ILinkableHashMap);if(!macros)throw new Error('macros hash map not found');var LinkableFunction=Weave.getDefinition('LinkableFunction');var fn=org.apache.flex.utils.Language.as(macros.getObject(name),LinkableFunction);if(!fn)throw new Error('Macro does not exist: '+name);return fn.apply(null,params)};
Weave.prototype.path=function(basePath){basePath=Array.prototype.slice.call(arguments,0);if(basePath.length==1&&org.apache.flex.utils.Language.is(basePath[0],Array))basePath=basePath[0];if(basePath.length==1&&Weave.isLinkable(basePath[0]))basePath=Weave.findPath(this.root,basePath[0]);return basePath?new weavejs.path.WeavePathUI(this,basePath):null};
Weave.prototype.getObject=function(path){path=Array.prototype.slice.call(arguments,0);if(path.length==1){if(org.apache.flex.utils.Language.is(path[0],weavejs.path.WeavePath))return org.apache.flex.utils.Language.as(path[0],weavejs.path.WeavePath).getObject();if(org.apache.flex.utils.Language.is(path[0],Array))path=path[0]}return Weave.followPath(this.root,path)};
Weave.prototype.requestObject=function(path,type){var parentPath=path.concat();var childName=parentPath.pop();var parent=Weave.followPath(this.root,parentPath);var hashMap=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableHashMap);var dynamicObject=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableDynamicObject);var child=null;if(hashMap){if(org.apache.flex.utils.Language.is(childName,Number))childName=hashMap.getNames()[childName];child=hashMap.requestObject(org.apache.flex.utils.Language.as(childName,
String),type,false)}else if(dynamicObject)child=dynamicObject.requestGlobalObject(org.apache.flex.utils.Language.as(childName,String),type,false);else child=Weave.followPath(this.root,path);if(child&&child.constructor==type)return child;return null};Weave.prototype.removeObject=function(path){this.requestObject(path,null)};Weave.map_root_weave=new weavejs.util.JS.Map;
Weave.getWeave=function(object){var sm=weavejs.WeaveAPI.SessionManager;while(object&&!org.apache.flex.utils.Language.is(object,Weave))object=sm.getOwner(object);return org.apache.flex.utils.Language.as(object,Weave)};Weave.getPath=function(object){var weave=Weave.getWeave(object);return weave?weave.path(object):null};Weave.findPath=function(root,descendant){return weavejs.WeaveAPI.SessionManager.getPath(root,descendant)};
Weave.followPath=function(root,path){return weavejs.WeaveAPI.SessionManager.getObject(root,path)};Weave.getCallbacks=function(linkableObject){return weavejs.WeaveAPI.SessionManager.getCallbackCollection(linkableObject)};
Weave.detectChange=function(observer,linkableObject,moreLinkableObjects){moreLinkableObjects=Array.prototype.slice.call(arguments,2);var changeDetected=false;moreLinkableObjects.unshift(linkableObject);var foreachiter0_target=moreLinkableObjects;for(var foreachiter0 in foreachiter0_target){linkableObject=foreachiter0_target[foreachiter0];if(linkableObject&&Weave._internalDetectChange(observer,linkableObject,true))changeDetected=true}return changeDetected};
Weave._internalDetectChange=function(observer,linkableObject,clearChangedNow){clearChangedNow=typeof clearChangedNow!=='undefined'?clearChangedNow:true;var previousCount=Weave.d2d_linkableObject_observer_triggerCounter.get(linkableObject,observer);var newCount=weavejs.WeaveAPI.SessionManager.getCallbackCollection(linkableObject).triggerCounter;if(previousCount!==newCount){if(clearChangedNow)Weave.d2d_linkableObject_observer_triggerCounter.set(linkableObject,observer,newCount);return true}return false};
Weave.d2d_linkableObject_observer_triggerCounter=new weavejs.util.Dictionary2D(true,true);Weave.getRoot=function(object){var sm=weavejs.WeaveAPI.SessionManager;while(true){var owner=sm.getLinkableOwner(object);if(!owner)break;object=owner}return Weave.wasDisposed(object)?null:org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableHashMap)};
Weave.getAncestor=function(descendant,ancestorType){if(org.apache.flex.utils.Language.is(ancestorType,String))ancestorType=Weave.getDefinition(String(ancestorType),true);var sm=weavejs.WeaveAPI.SessionManager;do descendant=sm.getLinkableOwner(descendant);while(descendant&&!org.apache.flex.utils.Language.is(descendant,ancestorType));return descendant};Weave.getOwner=function(child){return weavejs.WeaveAPI.SessionManager.getLinkableOwner(child)};
Weave.getDescendants=function(object,filter){filter=typeof filter!=='undefined'?filter:null;if(org.apache.flex.utils.Language.is(filter,String))filter=Weave.getDefinition(String(filter),true);return weavejs.WeaveAPI.SessionManager.getLinkableDescendants(object,filter)};Weave.getState=function(linkableObject){return weavejs.WeaveAPI.SessionManager.getSessionState(linkableObject)};
Weave.setState=function(linkableObject,newState,removeMissingDynamicObjects){removeMissingDynamicObjects=typeof removeMissingDynamicObjects!=='undefined'?removeMissingDynamicObjects:true;weavejs.WeaveAPI.SessionManager.setSessionState(linkableObject,newState,removeMissingDynamicObjects)};Weave.copyState=function(source,destination){weavejs.WeaveAPI.SessionManager.copySessionState(source,destination)};
Weave.linkState=function(primary,secondary){weavejs.WeaveAPI.SessionManager.linkSessionState(primary,secondary)};Weave.unlinkState=function(first,second){weavejs.WeaveAPI.SessionManager.unlinkSessionState(first,second)};Weave.computeDiff=function(oldState,newState){return weavejs.WeaveAPI.SessionManager.computeDiff(oldState,newState)};Weave.combineDiff=function(baseDiff,diffToAdd){return weavejs.WeaveAPI.SessionManager.combineDiff(baseDiff,diffToAdd)};
Weave.disposableChild=function(disposableParent,disposableChildOrType){if(weavejs.util.JS.isClass(disposableChildOrType))return weavejs.WeaveAPI.SessionManager.newDisposableChild(disposableParent,weavejs.util.JS.asClass(disposableChildOrType));return weavejs.WeaveAPI.SessionManager.registerDisposableChild(disposableParent,disposableChildOrType)};
Weave.linkableChild=function(linkableParent,linkableChildOrType,callback,useGroupedCallback){callback=typeof callback!=='undefined'?callback:null;useGroupedCallback=typeof useGroupedCallback!=='undefined'?useGroupedCallback:false;if(weavejs.util.JS.isClass(linkableChildOrType))return weavejs.WeaveAPI.SessionManager.newLinkableChild(linkableParent,weavejs.util.JS.asClass(linkableChildOrType),callback,useGroupedCallback);return weavejs.WeaveAPI.SessionManager.registerLinkableChild(linkableParent,org.apache.flex.utils.Language.as(linkableChildOrType,
weavejs.api.core.ILinkableObject),callback,useGroupedCallback)};Weave.privateLinkableChild=function(linkableParent,linkableChildOrType,callback,useGroupedCallback){callback=typeof callback!=='undefined'?callback:null;useGroupedCallback=typeof useGroupedCallback!=='undefined'?useGroupedCallback:false;var child=Weave.linkableChild(linkableParent,linkableChildOrType,callback,useGroupedCallback);weavejs.WeaveAPI.SessionManager['excludeLinkableChildFromSessionState'](linkableParent,child);return child};
Weave.dispose=function(object){weavejs.WeaveAPI.SessionManager.disposeObject(object)};Weave.wasDisposed=function(object){return weavejs.WeaveAPI.SessionManager.objectWasDisposed(object)};Weave.isBusy=function(object){return weavejs.WeaveAPI.SessionManager.linkableObjectIsBusy(object)};
Weave.isLinkable=function(objectOrClass){if(org.apache.flex.utils.Language.is(objectOrClass,weavejs.api.core.ILinkableObject)||objectOrClass===weavejs.api.core.ILinkableObject)return true;return objectOrClass?org.apache.flex.utils.Language.is(objectOrClass.prototype,weavejs.api.core.ILinkableObject):false};Weave.IS=function(object,type){return org.apache.flex.utils.Language.is(object,type)};Weave.AS=function(object,type){return org.apache.flex.utils.Language.as(object,type)};
Weave.map_class_isAsync=new weavejs.util.JS.Map;Weave.registerAsyncClass=function(type,instanceHandler){var valueInMap=instanceHandler||true;Weave.map_class_isAsync.set(type,valueInMap);var foreachiter1_target=weavejs.util.JS.mapKeys(Weave.map_class_isAsync);for(var foreachiter1 in foreachiter1_target){var cachedType=foreachiter1_target[foreachiter1];if(!Weave.map_class_isAsync.get(cachedType)&&type.isPrototypeOf(cachedType))Weave.map_class_isAsync.set(cachedType,valueInMap)}};
Weave.isAsyncClass=function(type){if(Weave.map_class_isAsync.has(type))return Weave.map_class_isAsync.get(type);var foreachiter2_target=weavejs.util.JS.mapKeys(Weave.map_class_isAsync);for(var foreachiter2 in foreachiter2_target){var cachedType=foreachiter2_target[foreachiter2];var valueInMap=Weave.map_class_isAsync.get(cachedType);if(valueInMap&&cachedType.isPrototypeOf(type)){Weave.map_class_isAsync.set(type,valueInMap);return true}}Weave.map_class_isAsync.set(type,false);return false};
Weave.getAsyncInstanceHandler=function(type){return Weave.isAsyncClass(type)?org.apache.flex.utils.Language.as(Weave.map_class_isAsync.get(type),Function):null};
Weave.registerClass=function(definition,qualifiedName,additionalInterfaces,displayName){additionalInterfaces=typeof additionalInterfaces!=='undefined'?additionalInterfaces:null;displayName=typeof displayName!=='undefined'?displayName:null;var ids=org.apache.flex.utils.Language.is(qualifiedName,String)?[qualifiedName]:org.apache.flex.utils.Language.as(qualifiedName,Array)||[];if(!ids.length)throw new Error('registerClass() requires at least one name under which to register a class definition');definition['WEAVE_INFO']=
Weave.setClassInfo(definition,{'id':ids[0],'label':displayName,'interfaces':additionalInterfaces,'deprecatedIds':ids.slice(1)})};Weave.classInfo=function(info){var __localFn0__=function(constructor){constructor.WEAVE_INFO=Weave.setClassInfo(constructor,info)};return __localFn0__};
Weave.setClassInfo=function(definition,info){var ID='id';var DEPRECATED_IDS='deprecatedIds';var INTERFACES='interfaces';var LABEL='label';var LINKABLE='linkable';var id=org.apache.flex.utils.Language.as(info[ID],String);var label=org.apache.flex.utils.Language.as(info[LABEL],String);var linkable=info[LINKABLE]===undefined?true:!!info[LINKABLE];var allInterfaces=linkable?[weavejs.api.core.ILinkableObject].concat(info[INTERFACES]||[]):org.apache.flex.utils.Language.as(info[INTERFACES],Array);var deprecatedIds=
org.apache.flex.utils.Language.is(info[DEPRECATED_IDS],String)?[info[DEPRECATED_IDS]]:org.apache.flex.utils.Language.as(info[DEPRECATED_IDS],Array)||[];weavejs.WeaveAPI.ClassRegistry.registerClass(definition,id,allInterfaces,label);var foreachiter3_target=deprecatedIds;for(var foreachiter3 in foreachiter3_target){var deprecatedId=foreachiter3_target[foreachiter3];weavejs.WeaveAPI.ClassRegistry.registerClass(definition,deprecatedId)}return definition['WEAVE_INFO']=info};Weave.className=function(def){return weavejs.WeaveAPI.ClassRegistry.getClassName(def)};
Weave.getDefinition=function(name,throwIfNotFound){throwIfNotFound=typeof throwIfNotFound!=='undefined'?throwIfNotFound:false;var result=weavejs.WeaveAPI.ClassRegistry.getDefinition(name);if(result===undefined&&throwIfNotFound)throw new Error('No definition for '+JSON.stringify(name));return result};
Weave.stringify=function(value,replacer,indent,json_values_only){replacer=typeof replacer!=='undefined'?replacer:null;indent=typeof indent!=='undefined'?indent:null;json_values_only=typeof json_values_only!=='undefined'?json_values_only:false;indent=typeof indent==='number'?weavejs.util.StandardLib.lpad('',indent,' '):org.apache.flex.utils.Language.as(indent,String)||'';return Weave._stringify('',value,replacer,indent?'\n':'',indent,json_values_only)};
Weave._stringify=function(key,value,replacer,lineBreak,indent,json_values_only){if(replacer!=null)value=replacer(key,value);var output;var item;if(typeof value==='string')return Weave.encodeString(value);if(value==null||typeof value!='object'){if(json_values_only&&(value===undefined||!isFinite(org.apache.flex.utils.Language.as(value,Number))))value=null;return String(value)||String(null)}var lineBreakIndent=lineBreak+indent;var valueIsArray=org.apache.flex.utils.Language.is(value,Array);output=[];
if(valueIsArray)for(var i=0;i<value.length;i++)output.push(Weave._stringify(String(i),value[i],replacer,lineBreakIndent,indent,json_values_only));else if(typeof value=='object'){for(key in value)output.push(Weave.encodeString(key)+': '+Weave._stringify(key,value[key],replacer,lineBreakIndent,indent,json_values_only));output.sort()}if(output.length==0)return valueIsArray?'[]':'{}';var lb=valueIsArray?'[':'{';var rb=valueIsArray?']':'}';return lb+lineBreakIndent+output.join(indent?','+lineBreakIndent:
', ')+lineBreak+rb};Weave.encodeString=function(string,quote){quote=typeof quote!=='undefined'?quote:'"';if(string==null)return'null';var result=new Array(string.length);for(var i=0;i<string.length;i++){var chr=string.charAt(i);var esc=org.apache.flex.utils.Language.string(chr==quote?quote:Weave.ENCODE_LOOKUP[chr]);result[i]=esc?'\\'+esc:chr}return quote+result.join('')+quote};Weave.ENCODE_LOOKUP={'\b':'b','\f':'f','\n':'n','\r':'r','\t':'t','\\':'\\'};
Weave.lang=function(text,parameters){parameters=Array.prototype.slice.call(arguments,1);var newText=weavejs.WeaveAPI.Locale.getText(text);if(weavejs.WeaveAPI.debugLocale){parameters.unshift(text);var str=Weave.stringify(parameters);return'lang('+str.substring(1,str.length-1)+')'}if(parameters.length)return weavejs.util.StandardLib.substitute(newText,parameters);return newText};Weave.prototype.triggerColumns=function(){this.triggerAll('ReferencedColumn')};
Weave.prototype.triggerAll=function(filter){var self=this;var __localFn0__=function(obj){Weave.getCallbacks(obj).triggerCallbacks()};if(org.apache.flex.utils.Language.is(filter,String))filter=Weave.getDefinition(filter);Weave.getDescendants(this.root,weavejs.util.JS.asClass(filter)).forEach(__localFn0__)};
Weave.prototype.populateColumns=function(){var RefCol=Weave.getDefinition('ReferencedColumn');var ExtDynCol=Weave.getDefinition('ExtendedDynamicColumn');var all=Weave.getDescendants(this.root,weavejs.api.core.ILinkableDynamicObject);var def=[];var undef=[];var foreachiter4_target=all;for(var foreachiter4 in foreachiter4_target){var item=foreachiter4_target[foreachiter4];var col=item;if(!col)continue;if(org.apache.flex.utils.Language.is(item.target,RefCol))def.push(item);if(!item.target)undef.push(item)}for(var i=
0;i<undef.length;i++)Weave.copyState(def[i%def.length],undef[i])};Weave.prototype.stringifyState=function(pathOrType){pathOrType=Array.prototype.slice.call(arguments,0);var object;if(weavejs.util.JS.isClass(pathOrType[0]))object=this.root.getObjects(pathOrType[0])[0];else object=this.getObject(pathOrType);var state=Weave.getState(object);return Weave.stringify(state,null,'\t')};
Weave.id=function(arg){arg=typeof arg!=='undefined'?arg:undefined;var type=typeof arg;if(arguments.length==0||type=='string'||type=='number')return weavejs.util.DebugUtils.debugLookup(arg);return weavejs.util.DebugUtils.debugId(arg)};Weave.watch=weavejs.util.DebugUtils.watch;Weave.unwatch=weavejs.util.DebugUtils.unwatch;Weave.watchState=weavejs.util.DebugUtils.watchState;
Weave.prototype.createScript=function(name,targets,script,groupedCallback){groupedCallback=typeof groupedCallback!=='undefined'?groupedCallback:false;var lcs=this.root.requestObject(name,Weave.getDefinition('LinkableCallbackScript'));var array=[];for(var key in targets)array.push(weavejs.api.core.DynamicState.create(key,'LinkableDynamicObject',targets[key]));Weave.setState(org.apache.flex.utils.Language.as(lcs,weavejs.api.core.ILinkableObject),{script:script,variables:array,groupedCallback:groupedCallback},
true);return lcs};Weave.prototype.FLEXJS_CLASS_INFO={names:[{name:'Weave',qName:'Weave'}],interfaces:[weavejs.api.core.IDisposableObject]};goog.exportSymbol('Weave',Weave);
Weave.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'root':{type:'ILinkableHashMap'},'history':{type:'SessionStateLog'}}},accessors:function(){return{}},methods:function(){return{'Weave':{type:'',declaredBy:'Weave'},'dispose':{type:'void',declaredBy:'Weave'},'macro':{type:'*',declaredBy:'Weave'},'path':{type:'WeavePath',declaredBy:'Weave'},'getObject':{type:'ILinkableObject',declaredBy:'Weave'},'requestObject':{type:'ILinkableObject',declaredBy:'Weave'},'removeObject':{type:'void',
declaredBy:'Weave'}}}}};goog.provide('weavejs.core.EventCallbackCollection');goog.require('weavejs.core.CallbackCollection');weavejs.core.EventCallbackCollection=function(){weavejs.core.EventCallbackCollection.base(this,'constructor',org.apache.flex.utils.Language.closure(this._setData,this,'_setData'))};goog.inherits(weavejs.core.EventCallbackCollection,weavejs.core.CallbackCollection);weavejs.core.EventCallbackCollection.prototype._data=null;
weavejs.core.EventCallbackCollection.prototype._setData=function(data){data=typeof data!=='undefined'?data:null;this._data=data};weavejs.core.EventCallbackCollection.prototype.dispatch=function(data){var oldValue=this._data;this._runCallbacksImmediately(data);this._setData(oldValue)};Object.defineProperties(weavejs.core.EventCallbackCollection.prototype,{data:{get:function(){return this._data}}});
weavejs.core.EventCallbackCollection.prototype.FLEXJS_CLASS_INFO={names:[{name:'EventCallbackCollection',qName:'weavejs.core.EventCallbackCollection'}]};goog.exportSymbol('weavejs.core.EventCallbackCollection',weavejs.core.EventCallbackCollection);
weavejs.core.EventCallbackCollection.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'data':{type:'Object',declaredBy:'weavejs.core.EventCallbackCollection'}}},methods:function(){return{'EventCallbackCollection':{type:'',declaredBy:'weavejs.core.EventCallbackCollection'},'dispatch':{type:'void',declaredBy:'weavejs.core.EventCallbackCollection'}}}}};goog.provide('weavejs.core.LinkableString');goog.require('weavejs.core.LinkableVariable');
weavejs.core.LinkableString=function(defaultValue,verifier,defaultValueTriggersCallbacks){defaultValue=typeof defaultValue!=='undefined'?defaultValue:null;verifier=typeof verifier!=='undefined'?verifier:null;defaultValueTriggersCallbacks=typeof defaultValueTriggersCallbacks!=='undefined'?defaultValueTriggersCallbacks:true;weavejs.core.LinkableString.base(this,'constructor',String,verifier,arguments.length?defaultValue:undefined,defaultValueTriggersCallbacks)};
goog.inherits(weavejs.core.LinkableString,weavejs.core.LinkableVariable);weavejs.core.LinkableString.prototype.setSessionState=function(value){weavejs.core.LinkableString.base(this,'setSessionState',value==null?null:String(value))};Object.defineProperties(weavejs.core.LinkableString.prototype,{value:{get:function(){if(this._sessionStateExternal===undefined)return null;return this._sessionStateExternal},set:function(value){this.setSessionState(value)}}});
weavejs.core.LinkableString.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableString',qName:'weavejs.core.LinkableString'}]};goog.exportSymbol('weavejs.core.LinkableString',weavejs.core.LinkableString);
weavejs.core.LinkableString.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'value':{type:'String',declaredBy:'weavejs.core.LinkableString'}}},methods:function(){return{'LinkableString':{type:'',declaredBy:'weavejs.core.LinkableString'},'setSessionState':{type:'void',declaredBy:'weavejs.core.LinkableString'}}}}};goog.provide('weavejs.core.LinkableFunction');goog.require('weavejs.core.LinkableString');
weavejs.core.LinkableFunction=function(defaultValue,ignoreRuntimeErrors,paramNames){defaultValue=typeof defaultValue!=='undefined'?defaultValue:null;ignoreRuntimeErrors=typeof ignoreRuntimeErrors!=='undefined'?ignoreRuntimeErrors:false;paramNames=typeof paramNames!=='undefined'?paramNames:null;weavejs.core.LinkableFunction.base(this,'constructor',weavejs.util.StandardLib.unIndent(defaultValue));this._ignoreRuntimeErrors=ignoreRuntimeErrors;this._paramNames=paramNames?paramNames.concat():[]};
goog.inherits(weavejs.core.LinkableFunction,weavejs.core.LinkableString);weavejs.core.LinkableFunction.debug=false;weavejs.core.LinkableFunction.prototype._catchErrors=false;weavejs.core.LinkableFunction.prototype._ignoreRuntimeErrors=false;weavejs.core.LinkableFunction.prototype._compiledMethod=null;weavejs.core.LinkableFunction.prototype._paramNames=null;weavejs.core.LinkableFunction.prototype._isFunctionDefinition=false;weavejs.core.LinkableFunction.prototype._triggerCount=0;
weavejs.core.LinkableFunction.RETURN_UNDEFINED=function(_){_=Array.prototype.slice.call(arguments,0);return undefined};weavejs.core.LinkableFunction.prototype.validate=function(){if(this._triggerCount!=this.triggerCounter){this._triggerCount=this.triggerCounter;this._compiledMethod=weavejs.core.LinkableFunction.RETURN_UNDEFINED;this._isFunctionDefinition=false;this._compiledMethod=weavejs.util.JS.compile(this.value,this._paramNames,org.apache.flex.utils.Language.closure(this.errorHandler,this,'errorHandler'))}};
weavejs.core.LinkableFunction.prototype.errorHandler=function(e){var root=Weave.getRoot(this);if(root)e.message='In LinkableFunction '+JSON.stringify(Weave.findPath(root,this))+':\n'+e.message;if(weavejs.core.LinkableFunction.debug)weavejs.util.JS.error(e);if(this._ignoreRuntimeErrors||weavejs.core.LinkableFunction.debug)return;throw e;};
weavejs.core.LinkableFunction.prototype.apply=function(thisArg,argArray){thisArg=typeof thisArg!=='undefined'?thisArg:null;argArray=typeof argArray!=='undefined'?argArray:null;if(this._triggerCount!=this.triggerCounter)this.validate();return this._compiledMethod.apply(thisArg,argArray)};
weavejs.core.LinkableFunction.prototype.call=function(thisArg,args){args=Array.prototype.slice.call(arguments,1);thisArg=typeof thisArg!=='undefined'?thisArg:null;if(this._triggerCount!=this.triggerCounter)this.validate();return this._compiledMethod.apply(thisArg,args)};weavejs.core.LinkableFunction.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableFunction',qName:'weavejs.core.LinkableFunction'}]};goog.exportSymbol('weavejs.core.LinkableFunction',weavejs.core.LinkableFunction);
weavejs.core.LinkableFunction.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'LinkableFunction':{type:'',declaredBy:'weavejs.core.LinkableFunction'},'validate':{type:'void',declaredBy:'weavejs.core.LinkableFunction'},'apply':{type:'*',declaredBy:'weavejs.core.LinkableFunction'},'call':{type:'*',declaredBy:'weavejs.core.LinkableFunction'}}}}};goog.provide('weavejs.api.core.IChildListCallbackInterface');goog.require('weavejs.api.core.ICallbackCollection');weavejs.api.core.IChildListCallbackInterface=function(){};weavejs.api.core.IChildListCallbackInterface.prototype.lastObjectAdded;weavejs.api.core.IChildListCallbackInterface.prototype.FLEXJS_CLASS_INFO={names:[{name:'IChildListCallbackInterface',qName:'weavejs.api.core.IChildListCallbackInterface'}],interfaces:[weavejs.api.core.ICallbackCollection]};
weavejs.api.core.IChildListCallbackInterface.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'lastObjectAdded':{type:'ILinkableObject',declaredBy:'weavejs.api.core.IChildListCallbackInterface'},'lastNameAdded':{type:'String',declaredBy:'weavejs.api.core.IChildListCallbackInterface'},'lastObjectRemoved':{type:'ILinkableObject',declaredBy:'weavejs.api.core.IChildListCallbackInterface'},'lastNameRemoved':{type:'String',declaredBy:'weavejs.api.core.IChildListCallbackInterface'}}},
methods:function(){return{}}}};goog.provide('weavejs.core.ChildListCallbackInterface');goog.require('weavejs.core.CallbackCollection');goog.require('weavejs.api.core.IChildListCallbackInterface');weavejs.core.ChildListCallbackInterface=function(){weavejs.core.ChildListCallbackInterface.base(this,'constructor',org.apache.flex.utils.Language.closure(this.setCallbackVariables,this,'setCallbackVariables'))};goog.inherits(weavejs.core.ChildListCallbackInterface,weavejs.core.CallbackCollection);
weavejs.core.ChildListCallbackInterface.prototype._lastNameAdded=null;weavejs.core.ChildListCallbackInterface.prototype._lastObjectAdded=null;weavejs.core.ChildListCallbackInterface.prototype._lastNameRemoved=null;weavejs.core.ChildListCallbackInterface.prototype._lastObjectRemoved=null;
weavejs.core.ChildListCallbackInterface.prototype.setCallbackVariables=function(name,objectAdded,objectRemoved){name=typeof name!=='undefined'?name:null;objectAdded=typeof objectAdded!=='undefined'?objectAdded:null;objectRemoved=typeof objectRemoved!=='undefined'?objectRemoved:null;this._lastNameAdded=org.apache.flex.utils.Language.string(objectAdded?name:null);this._lastObjectAdded=objectAdded;this._lastNameRemoved=org.apache.flex.utils.Language.string(objectRemoved?name:null);this._lastObjectRemoved=
objectRemoved};weavejs.core.ChildListCallbackInterface.prototype.runCallbacks=function(name,objectAdded,objectRemoved){var _name=this._lastNameAdded||this._lastNameRemoved;var _added=this._lastObjectAdded;var _removed=this._lastObjectRemoved;this._runCallbacksImmediately(name,objectAdded,objectRemoved);this.setCallbackVariables(_name,_added,_removed)};
Object.defineProperties(weavejs.core.ChildListCallbackInterface.prototype,{lastNameAdded:{get:function(){return this._lastNameAdded}},lastObjectAdded:{get:function(){return this._lastObjectAdded}},lastNameRemoved:{get:function(){return this._lastNameRemoved}},lastObjectRemoved:{get:function(){return this._lastObjectRemoved}}});weavejs.core.ChildListCallbackInterface.prototype.FLEXJS_CLASS_INFO={names:[{name:'ChildListCallbackInterface',qName:'weavejs.core.ChildListCallbackInterface'}],interfaces:[weavejs.api.core.IChildListCallbackInterface]};
goog.exportSymbol('weavejs.core.ChildListCallbackInterface',weavejs.core.ChildListCallbackInterface);
weavejs.core.ChildListCallbackInterface.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'lastNameAdded':{type:'String',declaredBy:'weavejs.core.ChildListCallbackInterface'},'lastObjectAdded':{type:'ILinkableObject',declaredBy:'weavejs.core.ChildListCallbackInterface'},'lastNameRemoved':{type:'String',declaredBy:'weavejs.core.ChildListCallbackInterface'},'lastObjectRemoved':{type:'ILinkableObject',declaredBy:'weavejs.core.ChildListCallbackInterface'}}},
methods:function(){return{'ChildListCallbackInterface':{type:'',declaredBy:'weavejs.core.ChildListCallbackInterface'},'runCallbacks':{type:'void',declaredBy:'weavejs.core.ChildListCallbackInterface'}}},metadata:function(){return[]}}};goog.provide('weavejs.core.LinkablePlaceholder');goog.require('weavejs.core.LinkableVariable');weavejs.core.LinkablePlaceholder=function(classDef){weavejs.core.LinkablePlaceholder.base(this,'constructor');if(!classDef)throw new Error('classDef cannot be null');this.classDef=classDef;this._bypassDiff=classDef===weavejs.core.LinkableVariable||org.apache.flex.utils.Language.is(classDef.prototype,weavejs.core.LinkableVariable)};goog.inherits(weavejs.core.LinkablePlaceholder,weavejs.core.LinkableVariable);
weavejs.core.LinkablePlaceholder.prototype.classDef;weavejs.core.LinkablePlaceholder.prototype.instance;weavejs.core.LinkablePlaceholder.prototype.getClass=function(){return this.classDef};weavejs.core.LinkablePlaceholder.prototype.getInstance=function(){return this.instance};
weavejs.core.LinkablePlaceholder.prototype.setInstance=function(instance){if(Weave.wasDisposed(this))throw new Error('LinkablePlaceholder was already disposed');if(!org.apache.flex.utils.Language.is(instance,this.classDef))throw new Error('Unexpected object type');this.instance=instance;weavejs.core.LinkablePlaceholder.replace(this,instance)};weavejs.core.LinkablePlaceholder.prototype.setSessionState=function(value){weavejs.core.LinkablePlaceholder.base(this,'setSessionState',value)};
weavejs.core.LinkablePlaceholder.replace=function(oldObject,newObject){var owner=Weave.getOwner(oldObject);var oldPlaceholder=org.apache.flex.utils.Language.as(oldObject,weavejs.core.LinkablePlaceholder);var lhm=org.apache.flex.utils.Language.as(owner,weavejs.api.core.ILinkableHashMap);var ldo=org.apache.flex.utils.Language.as(owner,weavejs.api.core.ILinkableDynamicObject);if(!lhm&&!ldo)throw new Error('Unable to replace object because owner is not an ILinkableHashMap or ILinkableDynamicObject');
var ownerCC=Weave.getCallbacks(owner);ownerCC.delayCallbacks();try{var sessionState=undefined;if(Weave.getCallbacks(oldObject).triggerCounter!=weavejs.core.CallbackCollection.DEFAULT_TRIGGER_COUNT)sessionState=Weave.getState(oldObject);if(oldPlaceholder)Weave.getCallbacks(oldPlaceholder).delayCallbacks();if(lhm)lhm.setObject(lhm.getName(oldObject),newObject);else if(ldo)ldo.target=newObject;if(sessionState!==undefined)Weave.setState(newObject,sessionState);if(oldPlaceholder)Weave.getCallbacks(oldPlaceholder).resumeCallbacks()}finally{ownerCC.resumeCallbacks()}};
weavejs.core.LinkablePlaceholder.getClass=function(object){var placeholder=org.apache.flex.utils.Language.as(object,weavejs.core.LinkablePlaceholder);if(placeholder)return placeholder.getClass();if(object)return object.constructor;return null};
weavejs.core.LinkablePlaceholder.setInstance=function(possiblePlaceholder,instance){if(possiblePlaceholder===instance)return;var placeholder=org.apache.flex.utils.Language.as(possiblePlaceholder,weavejs.core.LinkablePlaceholder);if(!placeholder)throw new Error('Attempted to put an instance where there was no placeholder for it.');placeholder.setInstance(instance)};
weavejs.core.LinkablePlaceholder.replaceInstanceWithPlaceholder=function(instance){if(!instance||org.apache.flex.utils.Language.is(instance,weavejs.core.LinkablePlaceholder)||Weave.wasDisposed(instance))return;var placeholder=new weavejs.core.LinkablePlaceholder(weavejs.core.LinkablePlaceholder.getClass(instance));try{weavejs.core.LinkablePlaceholder.replace(instance,placeholder)}catch(e){Weave.dispose(placeholder);throw e;}};
weavejs.core.LinkablePlaceholder.whenReady=function(relevantContext,possiblePlaceholder,onReady){var __localFn0__=function(){var instance=lp.getInstance();if(instance)onReady(instance)};var lp=Weave.AS(possiblePlaceholder,weavejs.core.LinkablePlaceholder);if(lp)Weave.getCallbacks(lp).addDisposeCallback(relevantContext,__localFn0__,true);else if(possiblePlaceholder&&!Weave.wasDisposed(relevantContext))onReady(possiblePlaceholder)};
weavejs.core.LinkablePlaceholder.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkablePlaceholder',qName:'weavejs.core.LinkablePlaceholder'}]};goog.exportSymbol('weavejs.core.LinkablePlaceholder',weavejs.core.LinkablePlaceholder);
weavejs.core.LinkablePlaceholder.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'LinkablePlaceholder':{type:'',declaredBy:'weavejs.core.LinkablePlaceholder'},'getClass':{type:'Class',declaredBy:'weavejs.core.LinkablePlaceholder'},'getInstance':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkablePlaceholder'},'setInstance':{type:'void',declaredBy:'weavejs.core.LinkablePlaceholder'},'setSessionState':{type:'void',
declaredBy:'weavejs.core.LinkablePlaceholder'}}}}};goog.provide('weavejs.core.LinkableHashMap');goog.require('weavejs.core.CallbackCollection');goog.require('weavejs.core.ChildListCallbackInterface');goog.require('weavejs.core.LinkablePlaceholder');goog.require('weavejs.api.core.ILinkableHashMap');
weavejs.core.LinkableHashMap=function(typeRestriction){typeRestriction=typeof typeRestriction!=='undefined'?typeRestriction:null;this._childListCallbacks=Weave.linkableChild(this,weavejs.core.ChildListCallbackInterface);this._orderedNames=[];this._nameToObjectMap={};this._map_objectToNameMap=new weavejs.util.JS.WeakMap;this._nameIsLocked={};this._previousNameMap={};weavejs.core.LinkableHashMap.base(this,'constructor');this._typeRestriction=typeRestriction};
goog.inherits(weavejs.core.LinkableHashMap,weavejs.core.CallbackCollection);weavejs.core.LinkableHashMap.prototype._childListCallbacks;weavejs.core.LinkableHashMap.prototype._orderedNames;weavejs.core.LinkableHashMap.prototype._nameToObjectMap;weavejs.core.LinkableHashMap.prototype._map_objectToNameMap;weavejs.core.LinkableHashMap.prototype._nameIsLocked;weavejs.core.LinkableHashMap.prototype._previousNameMap;weavejs.core.LinkableHashMap.prototype._typeRestriction;
weavejs.core.LinkableHashMap.prototype.getNames=function(filter,filterIncludesPlaceholders){filter=typeof filter!=='undefined'?filter:null;filterIncludesPlaceholders=typeof filterIncludesPlaceholders!=='undefined'?filterIncludesPlaceholders:false;return this.getList(false,filter,filterIncludesPlaceholders)};
weavejs.core.LinkableHashMap.prototype.getObjects=function(filter,filterIncludesPlaceholders){filter=typeof filter!=='undefined'?filter:null;filterIncludesPlaceholders=typeof filterIncludesPlaceholders!=='undefined'?filterIncludesPlaceholders:false;return this.getList(true,filter,filterIncludesPlaceholders)};
weavejs.core.LinkableHashMap.prototype.toObject=function(filter,filterIncludesPlaceholders){filter=typeof filter!=='undefined'?filter:null;filterIncludesPlaceholders=typeof filterIncludesPlaceholders!=='undefined'?filterIncludesPlaceholders:false;var obj={};var foreachiter0_target=this.getList(false,filter,filterIncludesPlaceholders);for(var foreachiter0 in foreachiter0_target){var name=foreachiter0_target[foreachiter0];obj[name]=this._nameToObjectMap[name]}return obj};
weavejs.core.LinkableHashMap.prototype.toMap=function(filter,filterIncludesPlaceholders){filter=typeof filter!=='undefined'?filter:null;filterIncludesPlaceholders=typeof filterIncludesPlaceholders!=='undefined'?filterIncludesPlaceholders:false;var map=new weavejs.util.JS.Map;var foreachiter1_target=this.getList(false,filter,filterIncludesPlaceholders);for(var foreachiter1 in foreachiter1_target){var name=foreachiter1_target[foreachiter1];map.set(name,this._nameToObjectMap[name])}return map};
weavejs.core.LinkableHashMap.prototype.getList=function(listObjects,filter,filterIncludesPlaceholders){if(org.apache.flex.utils.Language.is(filter,String))filter=Weave.getDefinition(String(filter),true);var result=[];for(var i=0;i<this._orderedNames.length;i++){var name=org.apache.flex.utils.Language.string(this._orderedNames[i]);var object=this._nameToObjectMap[name];if(!filter)result.push(listObjects?object:name);else if(org.apache.flex.utils.Language.is(object,filter))result.push(listObjects?object:
name);else if(filterIncludesPlaceholders){var placeholder=org.apache.flex.utils.Language.as(object,weavejs.core.LinkablePlaceholder);if(!placeholder)continue;var classDef=placeholder.getClass();if(classDef===filter||org.apache.flex.utils.Language.is(classDef.prototype,filter))result.push(listObjects?object:name)}}return result};weavejs.core.LinkableHashMap.prototype.getObject=function(name){return this._nameToObjectMap[name]};
weavejs.core.LinkableHashMap.prototype.setObject=function(name,object,lockObject){lockObject=typeof lockObject!=='undefined'?lockObject:false;if(this._nameIsLocked[name]||this._nameToObjectMap[name]===object)return;var className=Weave.className(object);if(!className)throw new Error('Cannot get class name from object');if(Weave.getDefinition(className)!=object['constructor'])throw new Error('The Class of the object is not registered');if(Weave.getOwner(object))throw new Error('LinkableHashMap cannot accept an object that is already registered with an owner.');
if(object){if(!name)name=this.generateUniqueName(className.split('::').pop().split('.').pop());this.delayCallbacks();Weave.linkableChild(this,object);var oldObject=this._nameToObjectMap[name];this._nameToObjectMap[name]=object;this._map_objectToNameMap.set(object,name);if(this._orderedNames.indexOf(name)<0)this._orderedNames.push(name);if(lockObject)this._nameIsLocked[name]=true;this._previousNameMap[name]=true;this._childListCallbacks.runCallbacks(name,object,oldObject);Weave.dispose(oldObject);
this.resumeCallbacks()}else this.removeObject(name)};weavejs.core.LinkableHashMap.prototype.getName=function(object){return this._map_objectToNameMap.get(object)};
weavejs.core.LinkableHashMap.prototype.setNameOrder=function(newOrder){var changeDetected=false;var name;var i;var originalNameCount=this._orderedNames.length;var haveSeen={};for(i=0;i<newOrder.length;i++){name=org.apache.flex.utils.Language.string(newOrder[i]);if(this._nameToObjectMap[name]==undefined||haveSeen[name]!=undefined)continue;haveSeen[name]=true;this._orderedNames.push(name)}var appendedCount=this._orderedNames.length-originalNameCount;for(i=0;i<appendedCount;i++){var newIndex=originalNameCount+
i;var oldIndex=this._orderedNames.indexOf(this._orderedNames[newIndex]);if(newIndex-oldIndex!=appendedCount)changeDetected=true;this._orderedNames[oldIndex]=null}var out=0;for(i=0;i<this._orderedNames.length;i++)if(this._orderedNames[i]!=null)this._orderedNames[out++]=this._orderedNames[i];this._orderedNames.length=out;if(changeDetected)this._childListCallbacks.runCallbacks(null,null,null)};
weavejs.core.LinkableHashMap.prototype.requestObject=function(name,classDef,lockObject){lockObject=typeof lockObject!=='undefined'?lockObject:false;if(org.apache.flex.utils.Language.is(classDef,String))classDef=Weave.getDefinition(String(classDef),true);var className=org.apache.flex.utils.Language.string(classDef?Weave.className(classDef):null);var result=this.initObjectByClassName(name,className,lockObject);return classDef?org.apache.flex.utils.Language.as(result,classDef):null};
weavejs.core.LinkableHashMap.prototype.requestObjectCopy=function(name,objectToCopy){if(objectToCopy==null){this.removeObject(name);return null}this.delayCallbacks();var classDef=weavejs.core.LinkablePlaceholder.getClass(objectToCopy);var sessionState=Weave.getState(objectToCopy);if(name==this.getName(objectToCopy))this.removeObject(name);this.requestObject(name,classDef,false);var object=this.getObject(name);if(classDef==weavejs.core.LinkablePlaceholder.getClass(object))Weave.setState(object,sessionState);
this.resumeCallbacks();return object};weavejs.core.LinkableHashMap.prototype.renameObject=function(oldName,newName){if(oldName!=newName){this.delayCallbacks();var newNameOrder=this._orderedNames.concat();var index=newNameOrder.indexOf(oldName);if(index>=0)newNameOrder.splice(index,1,newName);this.requestObjectCopy(newName,this.getObject(oldName));this.removeObject(oldName);this.setNameOrder(newNameOrder);this.resumeCallbacks()}return this.getObject(newName)};
weavejs.core.LinkableHashMap.prototype.initObjectByClassName=function(name,className,lockObject){lockObject=typeof lockObject!=='undefined'?lockObject:false;if(className){var classDef=Weave.getDefinition(className);if(Weave.isLinkable(classDef)&&(this._typeRestriction==null||classDef===this._typeRestriction||org.apache.flex.utils.Language.is(classDef.prototype,this._typeRestriction))){if(!name){var baseName=org.apache.flex.utils.Language.string(className.split('::').pop().split('.').pop());if(name==
'')baseName=weavejs.WeaveAPI.ClassRegistry.getDisplayName(classDef)||baseName;name=this.generateUniqueName(baseName)}var object=this._nameToObjectMap[name];if(classDef!=weavejs.core.LinkablePlaceholder.getClass(object))this.createAndSaveNewObject(name,classDef,lockObject);else if(lockObject)this.lockObject(name)}else this.removeObject(name)}else this.removeObject(name);return this._nameToObjectMap[name||'']};
weavejs.core.LinkableHashMap.prototype.createAndSaveNewObject=function(name,classDef,lockObject){if(this._nameIsLocked[name])return;try{this.delayCallbacks();this.removeObject(name);var object;if(Weave.isAsyncClass(classDef))object=new weavejs.core.LinkablePlaceholder(classDef);else object=new classDef;Weave.linkableChild(this,object);this._nameToObjectMap[name]=object;this._map_objectToNameMap.set(object,name);this._orderedNames.push(name);this._previousNameMap[name]=true;if(lockObject)this.lockObject(name);
this._childListCallbacks.runCallbacks(name,object,null)}finally{this.resumeCallbacks()}};weavejs.core.LinkableHashMap.prototype.lockObject=function(name){if(name!=null&&this._nameToObjectMap[name]!=null)this._nameIsLocked[name]=true};weavejs.core.LinkableHashMap.prototype.objectIsLocked=function(name){return this._nameIsLocked[name]?true:false};
weavejs.core.LinkableHashMap.prototype.removeObject=function(name){if(!name||this._nameIsLocked[name])return;var object=this._nameToObjectMap[name];if(object==null)return;this.delayCallbacks();delete this._nameToObjectMap[name];this._map_objectToNameMap['delete'](object);var index=this._orderedNames.indexOf(name);this._orderedNames.splice(index,1);this._childListCallbacks.runCallbacks(name,null,object);Weave.dispose(object);this.resumeCallbacks()};
weavejs.core.LinkableHashMap.prototype.removeAllObjects=function(){this.delayCallbacks();var names=this._orderedNames.concat();var foreachiter2_target=names;for(var foreachiter2 in foreachiter2_target){var name=foreachiter2_target[foreachiter2];this.removeObject(name)}this.resumeCallbacks()};
weavejs.core.LinkableHashMap.prototype.dispose=function(){weavejs.core.LinkableHashMap.base(this,'dispose');this.removeAllObjects();var names=this._orderedNames.concat();var foreachiter3_target=names;for(var foreachiter3 in foreachiter3_target){var name=foreachiter3_target[foreachiter3];this._nameIsLocked[name]=undefined;this.removeObject(name)}};
weavejs.core.LinkableHashMap.prototype.generateUniqueName=function(baseName){var count=1;var name=baseName;while(this._previousNameMap[name]!=undefined)name=baseName+ ++count;this._previousNameMap[name]=true;return name};
weavejs.core.LinkableHashMap.prototype.getSessionState=function(){var result=new Array(this._orderedNames.length);for(var i=0;i<this._orderedNames.length;i++){var name=org.apache.flex.utils.Language.string(this._orderedNames[i]);var object=this._nameToObjectMap[name];result[i]=weavejs.api.core.DynamicState.create(name,Weave.className(weavejs.core.LinkablePlaceholder.getClass(object)),Weave.getState(object))}return result};
weavejs.core.LinkableHashMap.prototype.setSessionState=function(newStateArray,removeMissingDynamicObjects){if(newStateArray==null)return;this.delayCallbacks();var i;var delayed=[];var callbacks;var objectName;var className;var typedState;var remainingObjects=removeMissingDynamicObjects?{}:null;var newObjects={};var newNameOrder=[];if(newStateArray!=null){var foreachiter4_target=this._orderedNames;for(var foreachiter4 in foreachiter4_target){objectName=foreachiter4_target[foreachiter4];callbacks=Weave.getCallbacks(this._nameToObjectMap[objectName]);
delayed.push(callbacks);callbacks.delayCallbacks()}for(i=0;i<newStateArray.length;i++){typedState=newStateArray[i];if(!weavejs.api.core.DynamicState.isDynamicState(typedState,true))continue;objectName=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.OBJECT_NAME]);className=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.CLASS_NAME]);if(objectName==null)continue;if(className==null)continue;if(this._nameToObjectMap[objectName]!=this.initObjectByClassName(objectName,
className))newObjects[objectName]=true}var foreachiter5_target=this._orderedNames;for(var foreachiter5 in foreachiter5_target){objectName=foreachiter5_target[foreachiter5];callbacks=Weave.getCallbacks(this._nameToObjectMap[objectName]);delayed.push(callbacks);callbacks.delayCallbacks()}for(i=0;i<newStateArray.length;i++){typedState=newStateArray[i];if(typeof typedState==='string'){objectName=String(typedState);if(removeMissingDynamicObjects)remainingObjects[objectName]=true;newNameOrder.push(objectName);
continue}if(!weavejs.api.core.DynamicState.isDynamicState(typedState,true))continue;objectName=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.OBJECT_NAME]);if(objectName==null)continue;var object=this._nameToObjectMap[objectName];if(object==null)continue;Weave.setState(object,typedState[weavejs.api.core.DynamicState.SESSION_STATE],newObjects[objectName]||removeMissingDynamicObjects);if(removeMissingDynamicObjects)remainingObjects[objectName]=true;newNameOrder.push(objectName)}}if(removeMissingDynamicObjects){var names=
this._orderedNames.concat();var foreachiter6_target=names;for(var foreachiter6 in foreachiter6_target){objectName=foreachiter6_target[foreachiter6];if(remainingObjects[objectName]!==true)this.removeObject(objectName)}}this.setNameOrder(newNameOrder);var foreachiter7_target=delayed;for(var foreachiter7 in foreachiter7_target){callbacks=foreachiter7_target[foreachiter7];if(!Weave.wasDisposed(callbacks))callbacks.resumeCallbacks()}this.resumeCallbacks()};
Object.defineProperties(weavejs.core.LinkableHashMap.prototype,{typeRestriction:{get:function(){return this._typeRestriction}},childListCallbacks:{get:function(){return this._childListCallbacks}}});weavejs.core.LinkableHashMap.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableHashMap',qName:'weavejs.core.LinkableHashMap'}],interfaces:[weavejs.api.core.ILinkableHashMap]};goog.exportSymbol('weavejs.core.LinkableHashMap',weavejs.core.LinkableHashMap);
weavejs.core.LinkableHashMap.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'typeRestriction':{type:'Class',declaredBy:'weavejs.core.LinkableHashMap'},'childListCallbacks':{type:'IChildListCallbackInterface',declaredBy:'weavejs.core.LinkableHashMap'}}},methods:function(){return{'LinkableHashMap':{type:'',declaredBy:'weavejs.core.LinkableHashMap'},'getNames':{type:'Array',declaredBy:'weavejs.core.LinkableHashMap'},'getObjects':{type:'Array',
declaredBy:'weavejs.core.LinkableHashMap'},'toObject':{type:'Object',declaredBy:'weavejs.core.LinkableHashMap'},'toMap':{type:'Object',declaredBy:'weavejs.core.LinkableHashMap'},'getObject':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableHashMap'},'setObject':{type:'void',declaredBy:'weavejs.core.LinkableHashMap'},'getName':{type:'String',declaredBy:'weavejs.core.LinkableHashMap'},'setNameOrder':{type:'void',declaredBy:'weavejs.core.LinkableHashMap'},'requestObject':{type:'*',declaredBy:'weavejs.core.LinkableHashMap'},
'requestObjectCopy':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableHashMap'},'renameObject':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableHashMap'},'objectIsLocked':{type:'Boolean',declaredBy:'weavejs.core.LinkableHashMap'},'removeObject':{type:'void',declaredBy:'weavejs.core.LinkableHashMap'},'removeAllObjects':{type:'void',declaredBy:'weavejs.core.LinkableHashMap'},'dispose':{type:'void',declaredBy:'weavejs.core.LinkableHashMap'},'generateUniqueName':{type:'String',declaredBy:'weavejs.core.LinkableHashMap'},
'getSessionState':{type:'Array',declaredBy:'weavejs.core.LinkableHashMap'},'setSessionState':{type:'void',declaredBy:'weavejs.core.LinkableHashMap'}}}}};goog.provide('weavejs.core.LinkableCallbackScript');goog.require('weavejs.core.LinkableFunction');goog.require('weavejs.core.LinkableHashMap');goog.require('weavejs.api.core.ILinkableObject');
weavejs.core.LinkableCallbackScript=function(){this.variables=Weave.linkableChild(this,new weavejs.core.LinkableHashMap);this.script=Weave.linkableChild(this,new weavejs.core.LinkableString);this.delayWhileBusy=Weave.linkableChild(this,new weavejs.core.LinkableBoolean(true));this.delayWhilePlaceholders=Weave.linkableChild(this,new weavejs.core.LinkableBoolean(true));this.groupedCallback=Weave.linkableChild(this,new weavejs.core.LinkableBoolean(true));var callbacks=Weave.getCallbacks(this);callbacks.addImmediateCallback(null,
org.apache.flex.utils.Language.closure(this._immediateCallback,this,'_immediateCallback'));callbacks.addGroupedCallback(null,org.apache.flex.utils.Language.closure(this._groupedCallback,this,'_groupedCallback'))};weavejs.core.LinkableCallbackScript.prototype.variables;weavejs.core.LinkableCallbackScript.prototype.script;weavejs.core.LinkableCallbackScript.prototype.delayWhileBusy;weavejs.core.LinkableCallbackScript.prototype.delayWhilePlaceholders;weavejs.core.LinkableCallbackScript.prototype.groupedCallback;
weavejs.core.LinkableCallbackScript.prototype._compiledFunction;weavejs.core.LinkableCallbackScript.prototype.get=function(variableName){return this.variables.getObject(variableName)};weavejs.core.LinkableCallbackScript.prototype._immediateCallback=function(){if(!this.groupedCallback.value)this._runScript()};weavejs.core.LinkableCallbackScript.prototype._groupedCallback=function(){if(this.groupedCallback.value)this._runScript()};
weavejs.core.LinkableCallbackScript.prototype._runScript=function(){if(this.delayWhileBusy.value&&Weave.isBusy(this))return;if(this.delayWhilePlaceholders.value){var ldos=this.variables.getObjects(weavejs.api.core.ILinkableDynamicObject);var foreachiter0_target=ldos;for(var foreachiter0 in foreachiter0_target){var ldo=foreachiter0_target[foreachiter0];if(ldo.foundPlaceholder)return}}if(!this.script.value)return;try{if(Weave.detectChange(this,this.script,this.variables.childListCallbacks))this._compiledFunction=
weavejs.util.JS.compile(this.script.value,this.variables.getNames(),org.apache.flex.utils.Language.closure(this.errorHandler,this,'errorHandler'));this._compiledFunction.apply(this,this.variables.getObjects())}catch(e){weavejs.util.JS.error(e)}};
weavejs.core.LinkableCallbackScript.prototype.errorHandler=function(e){var root=Weave.getRoot(this);if(root)e.message='In LinkableCallbackScript '+JSON.stringify(Weave.findPath(root,this))+':\n'+e.message;if(weavejs.core.LinkableFunction.debug){weavejs.util.JS.error(e);return}throw e;};weavejs.core.LinkableCallbackScript.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableCallbackScript',qName:'weavejs.core.LinkableCallbackScript'}],interfaces:[weavejs.api.core.ILinkableObject]};
goog.exportSymbol('weavejs.core.LinkableCallbackScript',weavejs.core.LinkableCallbackScript);
weavejs.core.LinkableCallbackScript.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'variables':{type:'LinkableHashMap'},'script':{type:'LinkableString'},'delayWhileBusy':{type:'LinkableBoolean'},'delayWhilePlaceholders':{type:'LinkableBoolean'},'groupedCallback':{type:'LinkableBoolean'}}},accessors:function(){return{}},methods:function(){return{'LinkableCallbackScript':{type:'',declaredBy:'weavejs.core.LinkableCallbackScript'},'get':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableCallbackScript'}}}}};goog.provide('weavejs.util.WeavePromiseHandler');weavejs.util.WeavePromiseHandler=function(onFulfilled,onRejected,next){this.next=next;this.onFulfilled=onFulfilled;this.onRejected=onRejected};weavejs.util.WeavePromiseHandler.prototype.onFulfilled;weavejs.util.WeavePromiseHandler.prototype.onRejected;weavejs.util.WeavePromiseHandler.prototype.next;weavejs.util.WeavePromiseHandler.prototype.isNew=true;
weavejs.util.WeavePromiseHandler.prototype.onResult=function(result){this.isNew=false;try{if(this.onFulfilled!=null)this.next.setResult(this.onFulfilled(result));else this.next.setResult(result)}catch(e){this.next.setError(e)}};weavejs.util.WeavePromiseHandler.prototype.onError=function(error){this.isNew=false;try{if(this.onRejected!=null)this.next.setResult(this.onRejected(error));else this.next.setError(error)}catch(e){this.next.setError(e)}};
weavejs.util.WeavePromiseHandler.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeavePromiseHandler',qName:'weavejs.util.WeavePromiseHandler'}]};goog.exportSymbol('weavejs.util.WeavePromiseHandler',weavejs.util.WeavePromiseHandler);
weavejs.util.WeavePromiseHandler.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'onFulfilled':{type:'Function'},'onRejected':{type:'Function'},'next':{type:'WeavePromise'},'isNew':{type:'Boolean'}}},accessors:function(){return{}},methods:function(){return{'WeavePromiseHandler':{type:'',declaredBy:'weavejs.util.WeavePromiseHandler'},'onResult':{type:'void',declaredBy:'weavejs.util.WeavePromiseHandler'},'onError':{type:'void',declaredBy:'weavejs.util.WeavePromiseHandler'}}}}};goog.provide('weavejs.util.WeavePromise');goog.require('weavejs.util.WeavePromiseHandler');goog.require('weavejs.api.core.IDisposableObject');
weavejs.util.WeavePromise=function(relevantContext,resolver){resolver=typeof resolver!=='undefined'?resolver:null;this.handlers=[];this.dependencies=[];if(weavejs.WeaveAPI.debugAsyncStack)this.stackTrace_created=new Error('WeavePromise created');if(org.apache.flex.utils.Language.is(relevantContext,weavejs.util.WeavePromise)){this.rootPromise=org.apache.flex.utils.Language.as(relevantContext,weavejs.util.WeavePromise).rootPromise;this.relevantContext=relevantContext=this.rootPromise.relevantContext}else{this.rootPromise=
this;this.relevantContext=relevantContext||this}if(relevantContext)Weave.disposableChild(relevantContext,this);if(resolver!=null)resolver(org.apache.flex.utils.Language.closure(this.setResult,this,'setResult'),org.apache.flex.utils.Language.closure(this.setError,this,'setError'))};weavejs.util.WeavePromise._callNewHandlersSeparately=false;weavejs.util.WeavePromise.prototype.stackTrace_created;weavejs.util.WeavePromise.prototype.stackTrace_resolved;weavejs.util.WeavePromise.prototype.rootPromise;weavejs.util.WeavePromise.prototype.relevantContext;
weavejs.util.WeavePromise.prototype.result=undefined;weavejs.util.WeavePromise.prototype.error=undefined;weavejs.util.WeavePromise.prototype.handlers;weavejs.util.WeavePromise.prototype.dependencies;
weavejs.util.WeavePromise.prototype.setResult=function(result){if(Weave.wasDisposed(this.relevantContext))return this;if(weavejs.WeaveAPI.debugAsyncStack)this.stackTrace_resolved=new Error('WeavePromise resolved');this.result=undefined;this.error=undefined;var wp=org.apache.flex.utils.Language.as(result,weavejs.util.WeavePromise);if(wp)wp._notify(this);else if(weavejs.util.WeavePromise.isThenable(result))result.then(org.apache.flex.utils.Language.closure(this.setResult,this,'setResult'),org.apache.flex.utils.Language.closure(this.setError,
this,'setError'));else{this.result=org.apache.flex.utils.Language.as(result,Object);this.callHandlers()}return this};weavejs.util.WeavePromise.asPromise=function(obj){var wp=org.apache.flex.utils.Language.as(obj,weavejs.util.WeavePromise);if(wp)return wp.getPromise();return weavejs.util.WeavePromise.isThenable(obj)?obj:null};weavejs.util.WeavePromise.isThenable=function(obj){return obj&&typeof obj.then==='function'};weavejs.util.WeavePromise.prototype.getResult=function(){return this.result};
weavejs.util.WeavePromise.prototype.setError=function(error){if(Weave.wasDisposed(this.relevantContext))return this;if(weavejs.WeaveAPI.debugAsyncStack)this.stackTrace_resolved=new Error('WeavePromise resolved');this.result=undefined;this.error=org.apache.flex.utils.Language.as(error,Object);this.callHandlers();return this};weavejs.util.WeavePromise.prototype.getError=function(){return this.error};
weavejs.util.WeavePromise.prototype.callHandlers=function(newHandlersOnly){newHandlersOnly=typeof newHandlersOnly!=='undefined'?newHandlersOnly:false;if(this.dependencies.some(Weave.isBusy))return;if(this.result===undefined&&this.error===undefined)return;if(this.handlers.length==0&&this.error!==undefined)weavejs.util.JS.error(this.error);var shouldCallLater=false;for(var i=0;i<this.handlers.length;i++){var handler=this.handlers[i];if(weavejs.util.WeavePromise._callNewHandlersSeparately){if(newHandlersOnly!=
handler.isNew){shouldCallLater=handler.isNew;continue}}else if(newHandlersOnly&&!handler.isNew)continue;if(this.result!==undefined)handler.onResult(this.result);else if(this.error!==undefined)handler.onError(this.error)}if(shouldCallLater)weavejs.WeaveAPI.Scheduler.callLater(this.relevantContext,org.apache.flex.utils.Language.closure(this.callHandlers,this,'callHandlers'),[true])};
weavejs.util.WeavePromise.prototype.then=function(onFulfilled,onRejected){onFulfilled=typeof onFulfilled!=='undefined'?onFulfilled:null;onRejected=typeof onRejected!=='undefined'?onRejected:null;if(Weave.wasDisposed(this.relevantContext))return this;var next=new weavejs.util.WeavePromise(this);this.handlers.push(new weavejs.util.WeavePromiseHandler(onFulfilled,onRejected,next));if(this.result!==undefined||this.error!==undefined)weavejs.WeaveAPI.Scheduler.callLater(this.relevantContext,org.apache.flex.utils.Language.closure(this.callHandlers,
this,'callHandlers'),[true]);return next};weavejs.util.WeavePromise.prototype._notify=function(next){if(Weave.wasDisposed(this.relevantContext))return;var foreachiter0_target=this.handlers;for(var foreachiter0 in foreachiter0_target){var handler=foreachiter0_target[foreachiter0];if(handler.next===next)return}this.handlers.push(new weavejs.util.WeavePromiseHandler(null,null,next));if(this.result!==undefined)next.setResult(this.result);else if(this.error!==undefined)next.setError(this.error)};
weavejs.util.WeavePromise.prototype.depend=function(linkableObjects){linkableObjects=Array.prototype.slice.call(arguments,0);var foreachiter1_target=linkableObjects;for(var foreachiter1 in foreachiter1_target){var dependency=foreachiter1_target[foreachiter1];if(this.dependencies.indexOf(dependency)<0)this.dependencies.push(dependency);Weave.getCallbacks(dependency).addGroupedCallback(this.relevantContext,org.apache.flex.utils.Language.closure(this.callHandlers,this,'callHandlers'),true)}return this};
weavejs.util.WeavePromise.prototype.getPromise=function(){var self=this;var __localFn0__=function(resolve,reject){var_resolve=resolve;var_reject=reject};var var_resolve,var_reject;var promise=new weavejs.util.JS.Promise(__localFn0__);promise._WeavePromise=this;this.then(var_resolve,var_reject);return promise};weavejs.util.WeavePromise.prototype.dispose=function(){Weave.dispose(this);this.dependencies.length=0;this.handlers.length=0};
weavejs.util.WeavePromise.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeavePromise',qName:'weavejs.util.WeavePromise'}],interfaces:[weavejs.api.core.IDisposableObject]};goog.exportSymbol('weavejs.util.WeavePromise',weavejs.util.WeavePromise);
weavejs.util.WeavePromise.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'WeavePromise':{type:'',declaredBy:'weavejs.util.WeavePromise'},'setResult':{type:'WeavePromise',declaredBy:'weavejs.util.WeavePromise'},'getResult':{type:'Object',declaredBy:'weavejs.util.WeavePromise'},'setError':{type:'WeavePromise',declaredBy:'weavejs.util.WeavePromise'},'getError':{type:'Object',declaredBy:'weavejs.util.WeavePromise'},
'then':{type:'WeavePromise',declaredBy:'weavejs.util.WeavePromise'},'depend':{type:'WeavePromise',declaredBy:'weavejs.util.WeavePromise'},'getPromise':{type:'Object',declaredBy:'weavejs.util.WeavePromise'},'dispose':{type:'void',declaredBy:'weavejs.util.WeavePromise'}}}}};goog.provide('weavejs.util.WeaveTreeItem');weavejs.util.WeaveTreeItem=function(params){params=typeof params!=='undefined'?params:null;this._recursion={};this._cache={};this._counter={};if(org.apache.flex.utils.Language.is(params,String)){this.label=org.apache.flex.utils.Language.as(params,String);this.data=params}else for(var key in params)this[key]=params[key]};
weavejs.util.WeaveTreeItem.createItems=function(WeaveTreeItem_implementation,items){var __localFn0__=function(item,i,a){return weavejs.util.WeaveTreeItem._mapItem(WeaveTreeItem_implementation||weavejs.util.WeaveTreeItem,item)};var n=0;while(n!=items.length){n=items.length;items=Array.prototype.concat.apply([],items)}return items.map(__localFn0__).filter(weavejs.util.WeaveTreeItem._filterItemsRemoveNulls)};
weavejs.util.WeaveTreeItem._mapItem=function(WeaveTreeItem_implementation,item){if(weavejs.util.JS.isClass(item))return new item;if(org.apache.flex.utils.Language.is(item,String)||item!=null&&Object(item).constructor==Object)return new WeaveTreeItem_implementation(item);return item};weavejs.util.WeaveTreeItem._filterItemsRemoveNulls=function(item,i,a){return item!=null};weavejs.util.WeaveTreeItem.prototype.childItemClass;weavejs.util.WeaveTreeItem.prototype._recursion;
weavejs.util.WeaveTreeItem.prototype._label='';weavejs.util.WeaveTreeItem.prototype._children=null;weavejs.util.WeaveTreeItem.prototype._dependency=null;weavejs.util.WeaveTreeItem.prototype._cache;weavejs.util.WeaveTreeItem.prototype.cacheSettings;weavejs.util.WeaveTreeItem.prototype._counter;
weavejs.util.WeaveTreeItem.prototype.getBoolean=function(param,recursionName){if(!this._recursion[recursionName])try{this._recursion[recursionName]=true;if(this.isSimpleObject(param,'not'))param=!this.getBoolean(param['not'],'not_'+recursionName);if(this.isSimpleObject(param,'or'))param=this.getBoolean(param['or'],'or_'+recursionName);if(org.apache.flex.utils.Language.is(param,Function))param=this.evalFunction(org.apache.flex.utils.Language.as(param,Function));if(org.apache.flex.utils.Language.is(param,
weavejs.api.core.ILinkableVariable))param=org.apache.flex.utils.Language.as(param,weavejs.api.core.ILinkableVariable).getSessionState();if(org.apache.flex.utils.Language.is(param,Array)){var breakValue=recursionName.indexOf('or_')==0;var foreachiter0_target=param;for(var foreachiter0 in foreachiter0_target){param=foreachiter0_target[foreachiter0];param=this.getBoolean(param,'item_'+recursionName);if(param?breakValue:!breakValue)break}}param=param?true:false}finally{this._recursion[recursionName]=
false}return param};weavejs.util.WeaveTreeItem.prototype.isSimpleObject=function(object,singlePropertyName){var found=false;for(var key in object){if(found)return false;if(key!==singlePropertyName)return false;found=true}return found};
weavejs.util.WeaveTreeItem.prototype.getString=function(param,recursionName){if(!this._recursion[recursionName])try{this._recursion[recursionName]=true;if(org.apache.flex.utils.Language.is(param,Function))param=this.evalFunction(org.apache.flex.utils.Language.as(param,Function));else param=param||''}finally{this._recursion[recursionName]=false}return param};
weavejs.util.WeaveTreeItem.prototype.getObject=function(param,recursionName){if(!this._recursion[recursionName])try{this._recursion[recursionName]=true;if(org.apache.flex.utils.Language.is(param,Function))param=this.evalFunction(org.apache.flex.utils.Language.as(param,Function))}finally{this._recursion[recursionName]=false}return param};weavejs.util.WeaveTreeItem.prototype.evalFunction=function(func){try{return func.call(this,this)}catch(e){weavejs.util.JS.error(e)}};
weavejs.util.WeaveTreeItem.prototype.isCached=function(id){if(this.cacheSettings&&this.cacheSettings.hasOwnProperty(id)&&!this.cacheSettings[id])return false;if(this._dependency&&Weave.wasDisposed(this._dependency))this.dependency=null;return this._dependency&&this._counter[id]===Weave.getCallbacks(this._dependency).triggerCounter};
weavejs.util.WeaveTreeItem.prototype.cache=function(id,newValue){newValue=typeof newValue!=='undefined'?newValue:undefined;if(arguments.length==1)return this._cache[id];if(this._dependency&&Weave.wasDisposed(this._dependency))this.dependency=null;if(this._dependency){this._counter[id]=Weave.getCallbacks(this._dependency).triggerCounter;this._cache[id]=newValue}return newValue};weavejs.util.WeaveTreeItem.prototype.data=null;
Object.defineProperties(weavejs.util.WeaveTreeItem.prototype,{label:{get:function(){var id='label';if(this.isCached(id))return this._cache[id];var str=org.apache.flex.utils.Language.string(this.getString(this._label,id));if(!str&&org.apache.flex.utils.Language.is(this.data,String))str=org.apache.flex.utils.Language.as(this.data,String);return this.cache(id,str)},set:function(value){this._counter['label']=undefined;this._label=value}},children:{get:function(){var id='children';var items;if(this.isCached(id))items=
this._cache[id];else items=org.apache.flex.utils.Language.as(this.getObject(this._children,id),Array);if(items){var iOut=0;for(var i=0;i<items.length;i++){var item=weavejs.util.WeaveTreeItem._mapItem(this.childItemClass,items[i]);if(item!=null)items[iOut++]=item}items.length=iOut}return this.cache(id,items)},set:function(value){this._counter['children']=undefined;this._children=value}},dependency:{get:function(){if(this._dependency&&Weave.wasDisposed(this._dependency))this.dependency=null;return this._dependency},
set:function(value){if(this._dependency!=value)this._counter={};this._dependency=value}}});weavejs.util.WeaveTreeItem.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeaveTreeItem',qName:'weavejs.util.WeaveTreeItem'}]};goog.exportSymbol('weavejs.util.WeaveTreeItem',weavejs.util.WeaveTreeItem);
weavejs.util.WeaveTreeItem.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'cacheSettings':{type:'Object'},'data':{type:'Object'}}},accessors:function(){return{'label':{type:'*',declaredBy:'weavejs.util.WeaveTreeItem'},'children':{type:'*',declaredBy:'weavejs.util.WeaveTreeItem'},'dependency':{type:'ILinkableObject',declaredBy:'weavejs.util.WeaveTreeItem'}}},methods:function(){return{'WeaveTreeItem':{type:'',declaredBy:'weavejs.util.WeaveTreeItem'}}}}};goog.provide('weavejs.api.core.ILinkableObjectWithBusyStatus');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.core.ILinkableObjectWithBusyStatus=function(){};weavejs.api.core.ILinkableObjectWithBusyStatus.prototype.isBusy=function(){};weavejs.api.core.ILinkableObjectWithBusyStatus.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableObjectWithBusyStatus',qName:'weavejs.api.core.ILinkableObjectWithBusyStatus'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.core.ILinkableObjectWithBusyStatus.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'isBusy':{type:'Boolean',declaredBy:'weavejs.api.core.ILinkableObjectWithBusyStatus'}}}}};goog.provide('weavejs.api.core.ILinkableObjectWithNewPaths');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.core.ILinkableObjectWithNewPaths=function(){};weavejs.api.core.ILinkableObjectWithNewPaths.prototype.deprecatedPathRewrite=function(relativePath){};weavejs.api.core.ILinkableObjectWithNewPaths.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableObjectWithNewPaths',qName:'weavejs.api.core.ILinkableObjectWithNewPaths'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.core.ILinkableObjectWithNewPaths.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'deprecatedPathRewrite':{type:'Array',declaredBy:'weavejs.api.core.ILinkableObjectWithNewPaths'}}}}};goog.provide('weavejs.api.core.ILinkableObjectWithNewProperties');goog.require('weavejs.api.core.ILinkableObject');weavejs.api.core.ILinkableObjectWithNewProperties=function(){};weavejs.api.core.ILinkableObjectWithNewProperties.prototype.deprecatedStateMapping;weavejs.api.core.ILinkableObjectWithNewProperties.prototype.FLEXJS_CLASS_INFO={names:[{name:'ILinkableObjectWithNewProperties',qName:'weavejs.api.core.ILinkableObjectWithNewProperties'}],interfaces:[weavejs.api.core.ILinkableObject]};
weavejs.api.core.ILinkableObjectWithNewProperties.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'deprecatedStateMapping':{type:'Object',declaredBy:'weavejs.api.core.ILinkableObjectWithNewProperties'}}},methods:function(){return{}}}};goog.provide('weavejs.core.SessionManager');goog.require('weavejs.util.WeavePromise');goog.require('weavejs.api.core.ILinkableObjectWithBusyStatus');goog.require('weavejs.api.core.ILinkableObjectWithNewPaths');goog.require('weavejs.api.core.ILinkableObjectWithNewProperties');goog.require('weavejs.api.core.ISessionManager');
weavejs.core.SessionManager=function(){this.d2d_object_name_tree=new weavejs.util.Dictionary2D(true,false,weavejs.util.WeaveTreeItem);this._treeCallbacks=new weavejs.core.CallbackCollection;this.map_obj_getSessionStateIgnore=new weavejs.util.JS.WeakMap;this.map_child_owner=new weavejs.util.JS.WeakMap;this.d2d_owner_child=new weavejs.util.Dictionary2D(true,false);this.d2d_child_parent=new weavejs.util.Dictionary2D(true,false);this.d2d_parent_child=new weavejs.util.Dictionary2D(true,false);this.map_task_stackTrace=
new weavejs.util.JS.Map;this.d2d_owner_task=new weavejs.util.Dictionary2D(false,false);this.d2d_task_owner=new weavejs.util.Dictionary2D(false,false);this.map_busyTraversal=new weavejs.util.JS.WeakMap;this.array_busyTraversal=[];this.map_unbusyTriggerCounts=new weavejs.util.JS.Map;this.map_unbusyStackTraces=new weavejs.util.JS.WeakMap;this.map_ILinkableObject_ICallbackCollection=new weavejs.util.JS.WeakMap;this.map_ICallbackCollection_ILinkableObject=new weavejs.util.JS.WeakMap;this.map_disposed=
new weavejs.util.JS.WeakMap;this.d2d_lhs_rhs_setState=new weavejs.util.Dictionary2D(true,true)};weavejs.core.SessionManager.debugUnbusy=false;
weavejs.core.SessionManager.prototype.newLinkableChild=function(linkableParent,linkableChildType,callback,useGroupedCallback){callback=typeof callback!=='undefined'?callback:null;useGroupedCallback=typeof useGroupedCallback!=='undefined'?useGroupedCallback:false;if(!Weave.isLinkable(linkableParent))throw new Error('newLinkableChild(): Parent does not implement ILinkableObject.');if(!linkableChildType)throw new Error('newLinkableChild(): Child type parameter cannot be null.');if(!Weave.isLinkable(linkableChildType)){var childQName=
Weave.className(linkableChildType);if(Weave.getDefinition(childQName))throw new Error('newLinkableChild(): Child class does not implement ILinkableObject.');else throw new Error('newLinkableChild(): Child class inaccessible via qualified class name: '+childQName);}var linkableChild=org.apache.flex.utils.Language.as(new linkableChildType,weavejs.api.core.ILinkableObject);return this.registerLinkableChild(linkableParent,linkableChild,callback,useGroupedCallback)};
weavejs.core.SessionManager.prototype.registerLinkableChild=function(linkableParent,linkableChild,callback,useGroupedCallback){callback=typeof callback!=='undefined'?callback:null;useGroupedCallback=typeof useGroupedCallback!=='undefined'?useGroupedCallback:false;if(!Weave.isLinkable(linkableParent))throw new Error('registerLinkableChild(): Parent does not implement ILinkableObject.');if(!Weave.isLinkable(linkableChild))throw new Error('registerLinkableChild(): Child parameter cannot be null.');if(linkableParent==
linkableChild)throw new Error('registerLinkableChild(): Invalid attempt to register sessioned property having itself as its parent');if(callback!=null){var cc=this.getCallbackCollection(linkableChild);if(useGroupedCallback)cc.addGroupedCallback(org.apache.flex.utils.Language.as(linkableParent,weavejs.api.core.ILinkableObject),callback);else cc.addImmediateCallback(org.apache.flex.utils.Language.as(linkableParent,weavejs.api.core.ILinkableObject),callback)}this.registerDisposableChild(linkableParent,
linkableChild);if(this.d2d_child_parent.get(linkableChild,linkableParent)===undefined){this.d2d_child_parent.set(linkableChild,linkableParent,true);this.d2d_parent_child.set(linkableParent,linkableChild,true);var parentCC=this.getCallbackCollection(org.apache.flex.utils.Language.as(linkableParent,weavejs.api.core.ILinkableObject));this.getCallbackCollection(linkableChild).addImmediateCallback(linkableParent,org.apache.flex.utils.Language.closure(parentCC.triggerCallbacks,parentCC,'triggerCallbacks'),
false,true)}this._treeCallbacks.triggerCallbacks();return linkableChild};weavejs.core.SessionManager.prototype.newDisposableChild=function(disposableParent,disposableChildType){return this.registerDisposableChild(disposableParent,new disposableChildType)};
weavejs.core.SessionManager.prototype.registerDisposableChild=function(disposableParent,disposableChild){if(!disposableParent)throw new Error('registerDisposableChild(): Parent parameter cannot be null.');if(!disposableChild)throw new Error('registerDisposableChild(): Child parameter cannot be null.');var handler;if(this.objectWasDisposed(disposableParent))throw new Error('registerDisposableChild(): Parent was previously disposed');if(!this.map_child_owner.has(disposableChild)){this.map_child_owner.set(disposableChild,
disposableParent);this.d2d_owner_child.set(disposableParent,disposableChild,true);if(this.objectWasDisposed(disposableChild))throw new Error('registerDisposableChild(): Child was previously disposed');handler=Weave.getAsyncInstanceHandler(disposableChild.constructor);if(handler!=null)handler(disposableChild)}return disposableChild};
weavejs.core.SessionManager.prototype.unregisterLinkableChild=function(parent,child){if(!parent)throw new Error('unregisterLinkableChild(): Parent parameter cannot be null.');if(!child)throw new Error('unregisterLinkableChild(): Child parameter cannot be null.');this.d2d_child_parent.remove(child,parent);this.d2d_parent_child.remove(parent,child);this.getCallbackCollection(child).removeCallback(parent,org.apache.flex.utils.Language.closure(this.getCallbackCollection(parent).triggerCallbacks,this.getCallbackCollection(parent),
'triggerCallbacks'));this._treeCallbacks.triggerCallbacks()};weavejs.core.SessionManager.prototype.excludeLinkableChildFromSessionState=function(parent,child){if(parent==null||child==null){weavejs.util.JS.error('SessionManager.excludeLinkableChildFromSessionState(): Parameters to this function cannot be null.');return}if(this.d2d_child_parent.get(child,parent))this.d2d_child_parent.set(child,parent,false);if(this.d2d_parent_child.get(parent,child))this.d2d_parent_child.set(parent,child,false)};
weavejs.core.SessionManager.prototype._getRegisteredChildren=function(parent){return this.d2d_parent_child.secondaryKeys(parent)};weavejs.core.SessionManager.prototype.getOwner=function(child){return this.map_child_owner.get(child)};weavejs.core.SessionManager.prototype.getLinkableOwner=function(child){return org.apache.flex.utils.Language.as(this.map_child_owner.get(child),weavejs.api.core.ILinkableObject)};weavejs.core.SessionManager.prototype.d2d_object_name_tree;
weavejs.core.SessionManager.prototype.getSessionStateTree=function(root,objectName){if(!root)return null;var treeItem=this.d2d_object_name_tree.get(root,objectName);if(!treeItem.data){treeItem.data=root;treeItem.children=org.apache.flex.utils.Language.closure(this.getTreeItemChildren,this,'getTreeItemChildren');var lhm=org.apache.flex.utils.Language.as(root,weavejs.api.core.ILinkableHashMap);treeItem.dependency=lhm?lhm.childListCallbacks:root}if(objectName)treeItem.label=objectName;return treeItem};
weavejs.core.SessionManager.prototype.getTreeItemChildren=function(treeItem){var object=org.apache.flex.utils.Language.as(treeItem.data,weavejs.api.core.ILinkableObject);var children=[];var names;var childObject;var ignoreList=new weavejs.util.JS.WeakMap;var lhm=org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableHashMap);if(lhm){names=lhm.getNames();var childObjects=lhm.getObjects();for(var i=0;i<names.length;i++){childObject=childObjects[i];if(this.d2d_child_parent.get(childObject,
lhm)){if(ignoreList.has(childObject))continue;ignoreList.set(childObject,true);children.push(this.getSessionStateTree(childObject,names[i]))}}}else{var ldo=org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableDynamicObject);if(ldo)names=ldo.targetPath?null:[null];else if(object){names=this.getLinkablePropertyNames(object);var className=Weave.className(object)}var foreachiter0_target=names;for(var foreachiter0 in foreachiter0_target){var name=foreachiter0_target[foreachiter0];if(ldo)childObject=
ldo.internalObject;else childObject=object[name];if(!childObject)continue;if(this.d2d_child_parent.get(childObject,object)){if(ignoreList.has(childObject))continue;ignoreList.set(childObject,true);children.push(this.getSessionStateTree(childObject,name))}}}if(children.length==0)children=null;return children};weavejs.core.SessionManager.prototype.getTypedStateTree=function(root){return this.getTypedStateFromTreeNode(this.getSessionStateTree(root,null))};
weavejs.core.SessionManager.prototype.getTypedStateFromTreeNode=function(node,i,a){i=typeof i!=='undefined'?i:0;a=typeof a!=='undefined'?a:null;var state;var children=node.children;if(org.apache.flex.utils.Language.is(node.data,weavejs.api.core.ILinkableVariable)||!children)state=this.getSessionState(org.apache.flex.utils.Language.as(node.data,weavejs.api.core.ILinkableObject));else state=children.map(org.apache.flex.utils.Language.closure(this.getTypedStateFromTreeNode,this,'getTypedStateFromTreeNode'));
return weavejs.api.core.DynamicState.create(node.label,Weave.className(node.data),state)};weavejs.core.SessionManager.prototype.addTreeCallback=function(relevantContext,groupedCallback,triggerCallbackNow){triggerCallbackNow=typeof triggerCallbackNow!=='undefined'?triggerCallbackNow:false;this._treeCallbacks.addGroupedCallback(relevantContext,groupedCallback,triggerCallbackNow)};
weavejs.core.SessionManager.prototype.removeTreeCallback=function(relevantContext,groupedCallback){this._treeCallbacks.removeCallback(relevantContext,groupedCallback)};weavejs.core.SessionManager.prototype._treeCallbacks;weavejs.core.SessionManager.prototype.copySessionState=function(source,destination){var sessionState=this.getSessionState(source);this.setSessionState(destination,sessionState,true)};
weavejs.core.SessionManager.prototype.applyDiffForLinkableVariable=function(base,diff){if(base===null||diff===null||typeof base!=='object'||typeof diff!=='object'||org.apache.flex.utils.Language.is(diff,Array))return diff;for(var key in diff){var value=diff[key];if(value===undefined)delete base[key];else base[key]=this.applyDiffForLinkableVariable(base[key],value)}return base};weavejs.core.SessionManager.DEPRECATED_STATE_MAPPING='deprecatedStateMapping';
weavejs.core.SessionManager.DEPRECATED_PATH_REWRITE='deprecatedPathRewrite';
weavejs.core.SessionManager.traverseAndSetState=function(state,mapping,removeMissingDynamicObjects){removeMissingDynamicObjects=typeof removeMissingDynamicObjects!=='undefined'?removeMissingDynamicObjects:true;var ilo=org.apache.flex.utils.Language.as(mapping,weavejs.api.core.ILinkableObject);if(ilo)Weave.setState(ilo,state,removeMissingDynamicObjects);else if(org.apache.flex.utils.Language.is(mapping,Function))mapping(state,removeMissingDynamicObjects);else if(org.apache.flex.utils.Language.is(mapping,
Array)){var foreachiter1_target=mapping;for(var foreachiter1 in foreachiter1_target){var item=foreachiter1_target[foreachiter1];weavejs.core.SessionManager.traverseAndSetState(state,item,removeMissingDynamicObjects)}}else if(state&&typeof state==='object'&&typeof mapping==='object')for(var key in mapping){var value=weavejs.api.core.DynamicState.traverseState(state,[key]);if(value!==undefined)weavejs.core.SessionManager.traverseAndSetState(value,mapping[key],removeMissingDynamicObjects)}};
weavejs.core.SessionManager.prototype.setSessionState=function(linkableObject,newState,removeMissingDynamicObjects){removeMissingDynamicObjects=typeof removeMissingDynamicObjects!=='undefined'?removeMissingDynamicObjects:true;if(linkableObject==null){weavejs.util.JS.error('SessionManager.setSessionState(): linkableObject cannot be null.');return}var lv=org.apache.flex.utils.Language.as(linkableObject,weavejs.api.core.ILinkableVariable);if(lv){if(removeMissingDynamicObjects==false&&newState&&Weave.className(newState)==
'Object')lv.setSessionState(this.applyDiffForLinkableVariable(weavejs.util.JS.copyObject(lv.getSessionState()),newState));else lv.setSessionState(newState);return}var lco=org.apache.flex.utils.Language.as(linkableObject,weavejs.api.core.ILinkableCompositeObject);if(lco){if(org.apache.flex.utils.Language.is(newState,String))newState=[newState];if(newState!=null&&!org.apache.flex.utils.Language.is(newState,Array)){var array=[];for(var key in newState)array.push(weavejs.api.core.DynamicState.create(key,
null,newState[key]));newState=array}lco.setSessionState(org.apache.flex.utils.Language.as(newState,Array),removeMissingDynamicObjects);return}if(newState==null)return;var objectCC=this.getCallbackCollection(linkableObject);objectCC.delayCallbacks();var name;var propertyNames=this.getLinkablePropertyNames(linkableObject);var foundMissingProperty=false;var hasDeprecatedStateMapping=org.apache.flex.utils.Language.is(linkableObject,weavejs.api.core.ILinkableObjectWithNewProperties)||weavejs.util.JS.hasProperty(linkableObject,
weavejs.core.SessionManager.DEPRECATED_STATE_MAPPING);var foreachiter2_target=propertyNames;for(var foreachiter2 in foreachiter2_target){name=foreachiter2_target[foreachiter2];if(!newState.hasOwnProperty(name)){if(removeMissingDynamicObjects&&hasDeprecatedStateMapping)foundMissingProperty=true;continue}var property=null;try{property=org.apache.flex.utils.Language.as(linkableObject[name],weavejs.api.core.ILinkableObject)}catch(e){weavejs.util.JS.error('SessionManager.setSessionState(): Unable to get property "'+
name+'" of class "'+Weave.className(linkableObject)+'"',e)}if(property==null)continue;if(!this.d2d_child_parent.get(property,linkableObject))continue;this.setSessionState(property,newState[name],removeMissingDynamicObjects)}if(hasDeprecatedStateMapping){var doMapping=false;if(foundMissingProperty){var foreachiter3_target=propertyNames;for(var foreachiter3 in foreachiter3_target){name=foreachiter3_target[foreachiter3];if(!newState.hasOwnProperty(name)){doMapping=true;break}}}else for(name in newState){try{property=
org.apache.flex.utils.Language.as(linkableObject[name],weavejs.api.core.ILinkableObject)}catch(e){weavejs.util.JS.error('SessionManager.setSessionState(): Unable to get property "'+name+'" of class "'+Weave.className(linkableObject)+'"',e)}if(!property||!Weave.isLinkable(property)||!this.d2d_child_parent.get(property,linkableObject)){doMapping=true;break}}if(doMapping){var mapping=linkableObject[weavejs.core.SessionManager.DEPRECATED_STATE_MAPPING];if(org.apache.flex.utils.Language.is(mapping,Function))mapping.call(linkableObject,
newState,removeMissingDynamicObjects);else weavejs.core.SessionManager.traverseAndSetState(newState,mapping,removeMissingDynamicObjects)}}objectCC.resumeCallbacks()};weavejs.core.SessionManager.prototype.map_obj_getSessionStateIgnore;
weavejs.core.SessionManager.prototype.getSessionState=function(linkableObject){if(linkableObject==null){weavejs.util.JS.error('SessionManager.getSessionState(): linkableObject cannot be null.');return null}var result=null;if(org.apache.flex.utils.Language.is(linkableObject,weavejs.api.core.ILinkableVariable))result=org.apache.flex.utils.Language.as(linkableObject,weavejs.api.core.ILinkableVariable).getSessionState();else if(org.apache.flex.utils.Language.is(linkableObject,weavejs.api.core.ILinkableCompositeObject))result=
org.apache.flex.utils.Language.as(linkableObject,weavejs.api.core.ILinkableCompositeObject).getSessionState();else{var propertyNames=this.getLinkablePropertyNames(linkableObject,true);var resultNames=[];var resultProperties=[];var property=null;var i;var foreachiter4_target=propertyNames;for(var foreachiter4 in foreachiter4_target){var name=foreachiter4_target[foreachiter4];try{property=null;property=org.apache.flex.utils.Language.as(linkableObject[name],weavejs.api.core.ILinkableObject)}catch(e){weavejs.util.JS.error('Unable to get property "'+
name+'" of class "'+Weave.className(linkableObject)+'"')}if(property!=null&&!this.map_obj_getSessionStateIgnore.get(property)){if(!this.d2d_child_parent.get(property,linkableObject))continue;this.map_obj_getSessionStateIgnore.set(property,true);resultNames.push(name);resultProperties.push(property)}else;}if(resultNames.length>0){result=new Object;for(i=0;i<resultNames.length;i++){var value=this.getSessionState(resultProperties[i]);property=org.apache.flex.utils.Language.as(resultProperties[i],weavejs.api.core.ILinkableObject);
if(value==null&&!org.apache.flex.utils.Language.is(property,weavejs.api.core.ILinkableVariable)&&!org.apache.flex.utils.Language.is(property,weavejs.api.core.ILinkableCompositeObject))continue;result[resultNames[i]]=value}}}this.map_obj_getSessionStateIgnore.set(linkableObject,undefined);return result};weavejs.core.SessionManager.LINKABLE_PROPERTIES='linkableProperties';
weavejs.core.SessionManager.prototype.getLinkablePropertyNames=function(linkableObject,filtered){filtered=typeof filtered!=='undefined'?filtered:false;if(linkableObject==null){weavejs.util.JS.error('SessionManager.getLinkablePropertyNames(): linkableObject cannot be null.');return[]}var propertyNames;var linkableNames;var name;var property;var info=weavejs.WeaveAPI.ClassRegistry.getClassInfo(linkableObject);if(info&&false){if(!info[weavejs.core.SessionManager.LINKABLE_PROPERTIES]){info[weavejs.core.SessionManager.LINKABLE_PROPERTIES]=
propertyNames=[];var foreachiter5_target=[info.variables,info.accessors];for(var foreachiter5 in foreachiter5_target){var lookup=foreachiter5_target[foreachiter5];for(name in lookup)if(Weave.isLinkable(Weave.getDefinition(lookup[name].type)))propertyNames.push(name)}}propertyNames=info[weavejs.core.SessionManager.LINKABLE_PROPERTIES];if(!filtered)return propertyNames}else if(Weave.isAsyncClass(linkableObject['constructor']))propertyNames=weavejs.util.JS.getOwnPropertyNames(linkableObject);else propertyNames=
weavejs.util.JS.getPropertyNames(linkableObject,true);linkableNames=[];var foreachiter6_target=propertyNames;for(var foreachiter6 in foreachiter6_target){name=foreachiter6_target[foreachiter6];property=linkableObject[name];if(Weave.isLinkable(property))if(!filtered||this.d2d_child_parent.get(property,linkableObject))linkableNames.push(name)}return linkableNames};weavejs.core.SessionManager.prototype.map_child_owner;weavejs.core.SessionManager.prototype.d2d_owner_child;weavejs.core.SessionManager.prototype.d2d_child_parent;
weavejs.core.SessionManager.prototype.d2d_parent_child;weavejs.core.SessionManager.prototype.getLinkableDescendants=function(root,filter){filter=typeof filter!=='undefined'?filter:null;var result=[];if(root)this.internalGetDescendants(result,root,filter,new weavejs.util.JS.WeakMap,Number.MAX_VALUE);if(result.length>0&&result[0]==root)result.shift();return result};
weavejs.core.SessionManager.prototype.internalGetDescendants=function(output,root,filter,ignoreList,depth){if(root==null||ignoreList.has(root))return;ignoreList.set(root,true);if(filter==null||org.apache.flex.utils.Language.is(root,filter))output.push(root);if(--depth<=0)return;var children=this.d2d_parent_child.secondaryKeys(root);var foreachiter7_target=children;for(var foreachiter7 in foreachiter7_target){var child=foreachiter7_target[foreachiter7];this.internalGetDescendants(output,child,filter,
ignoreList,depth)}};weavejs.core.SessionManager.prototype.map_task_stackTrace;weavejs.core.SessionManager.prototype.d2d_owner_task;weavejs.core.SessionManager.prototype.d2d_task_owner;weavejs.core.SessionManager.prototype.map_busyTraversal;weavejs.core.SessionManager.prototype.array_busyTraversal;weavejs.core.SessionManager.prototype.map_unbusyTriggerCounts;weavejs.core.SessionManager.prototype.map_unbusyStackTraces;
weavejs.core.SessionManager.prototype.disposeBusyTaskPointers=function(disposedObject){this.d2d_owner_task.removeAllPrimary(disposedObject);this.d2d_task_owner.removeAllSecondary(disposedObject)};
weavejs.core.SessionManager.prototype.assignBusyTask=function(taskToken,busyObject){if(weavejs.WeaveAPI.debugAsyncStack)this.map_task_stackTrace.set(taskToken,new Error('Stack trace when task was last assigned'));if(this.d2d_task_owner.get(taskToken,busyObject))return;if(weavejs.util.WeavePromise.isThenable(taskToken)&&!weavejs.WeaveAPI.ProgressIndicator.hasTask(taskToken)){var unassign=this.unassignBusyTask.bind(this,taskToken);taskToken.then(unassign,unassign)}this.d2d_owner_task.set(busyObject,
taskToken,true);this.d2d_task_owner.set(taskToken,busyObject,true)};
weavejs.core.SessionManager.prototype.unassignBusyTask=function(taskToken){if(weavejs.WeaveAPI.ProgressIndicator.hasTask(taskToken)){weavejs.WeaveAPI.ProgressIndicator.removeTask(taskToken);return}var owners=this.d2d_task_owner.secondaryKeys(taskToken);this.d2d_task_owner.removeAllPrimary(taskToken);var foreachiter8_target=owners;for(var foreachiter8 in foreachiter8_target){var owner=foreachiter8_target[foreachiter8];this.d2d_owner_task.remove(owner,taskToken);var map_task=this.d2d_owner_task.map.get(owner);
if(map_task&&map_task.size)continue;this.map_unbusyTriggerCounts.set(owner,this.getCallbackCollection(owner).triggerCounter);weavejs.WeaveAPI.Scheduler.startTask(null,org.apache.flex.utils.Language.closure(this.unbusyTrigger,this,'unbusyTrigger'),weavejs.WeaveAPI.TASK_PRIORITY_IMMEDIATE);if(weavejs.WeaveAPI.debugAsyncStack){var stackTrace=new Error('Stack trace when last task was unassigned');this.map_unbusyStackTraces.set(owner,{assigned:this.map_task_stackTrace.get(taskToken),unassigned:stackTrace,
token:taskToken})}}};
weavejs.core.SessionManager.prototype.unbusyTrigger=function(stopTime){while(this.map_unbusyTriggerCounts.size){if(weavejs.util.JS.now()>stopTime)return 0;var entries=weavejs.util.JS.mapEntries(this.map_unbusyTriggerCounts);var foreachiter9_target=entries;for(var foreachiter9 in foreachiter9_target){var owner_triggerCount=foreachiter9_target[foreachiter9];var owner=owner_triggerCount[0];var triggerCount=Number(owner_triggerCount[1]);this.map_unbusyTriggerCounts['delete'](owner);var cc=this.getCallbackCollection(owner);
if(org.apache.flex.utils.Language.is(cc,weavejs.core.CallbackCollection)?org.apache.flex.utils.Language.as(cc,weavejs.core.CallbackCollection).wasDisposed:this.objectWasDisposed(owner))continue;if(cc.triggerCounter!=triggerCount)continue;if(this.linkableObjectIsBusy(owner))continue;if(weavejs.WeaveAPI.debugAsyncStack&&weavejs.core.SessionManager.debugUnbusy){var stackTraces=this.map_unbusyStackTraces.get(owner);weavejs.util.JS.log('Triggering callbacks because they have not triggered since owner has becoming unbusy:',
owner);weavejs.util.JS.log(stackTraces.assigned);weavejs.util.JS.log(stackTraces.unassigned)}cc.triggerCallbacks()}}return 1};
weavejs.core.SessionManager.prototype.linkableObjectIsBusy=function(linkableObject){if(org.apache.flex.utils.Language.is(linkableObject,weavejs.api.core.ICallbackCollection))linkableObject=this.getLinkableObjectFromCallbackCollection(org.apache.flex.utils.Language.as(linkableObject,weavejs.api.core.ICallbackCollection));if(!linkableObject)return false;var busy=false;this.array_busyTraversal[this.array_busyTraversal.length]=linkableObject;this.map_busyTraversal.set(linkableObject,true);outerLoop:for(var i=
0;i<this.array_busyTraversal.length;i++){linkableObject=this.array_busyTraversal[i];var ilowbs=org.apache.flex.utils.Language.as(linkableObject,weavejs.api.core.ILinkableObjectWithBusyStatus);if(ilowbs){if(ilowbs.isBusy()){busy=true;break}continue}var tasks=this.d2d_owner_task.secondaryKeys(linkableObject);var foreachiter10_target=tasks;for(var foreachiter10 in foreachiter10_target){var task=foreachiter10_target[foreachiter10];if(weavejs.WeaveAPI.debugAsyncStack)var stackTrace=org.apache.flex.utils.Language.string(this.map_task_stackTrace.get(task));
busy=true;break outerLoop}var children=this.d2d_parent_child.secondaryKeys(linkableObject);var foreachiter11_target=children;for(var foreachiter11 in foreachiter11_target){var child=foreachiter11_target[foreachiter11];if(!this.map_busyTraversal.get(child)){this.array_busyTraversal[this.array_busyTraversal.length]=child;this.map_busyTraversal.set(child,true)}}}var foreachiter12_target=this.array_busyTraversal;for(var foreachiter12 in foreachiter12_target){linkableObject=foreachiter12_target[foreachiter12];
this.map_busyTraversal.set(linkableObject,false)}this.array_busyTraversal.length=0;return busy};weavejs.core.SessionManager.prototype.map_ILinkableObject_ICallbackCollection;weavejs.core.SessionManager.prototype.map_ICallbackCollection_ILinkableObject;
weavejs.core.SessionManager.prototype.getCallbackCollection=function(linkableObject){if(linkableObject==null)return null;if(org.apache.flex.utils.Language.is(linkableObject,weavejs.api.core.ICallbackCollection))return org.apache.flex.utils.Language.as(linkableObject,weavejs.api.core.ICallbackCollection);var objectCC=this.map_ILinkableObject_ICallbackCollection.get(linkableObject);if(objectCC==null){objectCC=new weavejs.core.CallbackCollection;if(weavejs.WeaveAPI.debugAsyncStack)org.apache.flex.utils.Language.as(objectCC,
weavejs.core.CallbackCollection)._linkableObject=linkableObject;this.map_ILinkableObject_ICallbackCollection.set(linkableObject,objectCC);this.map_ICallbackCollection_ILinkableObject.set(objectCC,linkableObject);this.registerDisposableChild(linkableObject,objectCC)}return objectCC};weavejs.core.SessionManager.prototype.getLinkableObjectFromCallbackCollection=function(callbackCollection){return this.map_ICallbackCollection_ILinkableObject.get(callbackCollection)||callbackCollection};
weavejs.core.SessionManager.prototype.objectWasDisposed=function(object){if(object==null)return false;if(!this.d2d_owner_child.map.has(object)){this.d2d_owner_child.map.set(object,new weavejs.util.JS.Map);var handler=Weave.getAsyncInstanceHandler(object.constructor);if(handler!=null)handler(object)}if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableObject)){var cc=org.apache.flex.utils.Language.as(this.getCallbackCollection(org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableObject)),
weavejs.core.CallbackCollection);if(cc)return cc.wasDisposed}return this.map_disposed.has(object)};weavejs.core.SessionManager.prototype.map_disposed;weavejs.core.SessionManager.DISPOSE='dispose';
weavejs.core.SessionManager.prototype.disposeObject=function(object){var self=this;var __localFn0__=function(){self.debugDisposedObject(linkableObject,error)};if(object!=null&&!this.map_disposed.get(object)){this.map_disposed.set(object,true);this.disposeBusyTaskPointers(org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableObject));if(org.apache.flex.utils.Language.is(object,weavejs.api.core.IDisposableObject))org.apache.flex.utils.Language.as(object,weavejs.api.core.IDisposableObject).dispose();
else if(object.hasOwnProperty(weavejs.core.SessionManager.DISPOSE)&&typeof object[weavejs.core.SessionManager.DISPOSE]=='function'&&object[weavejs.core.SessionManager.DISPOSE].length==0)object[weavejs.core.SessionManager.DISPOSE]();var linkableObject=org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableObject);if(linkableObject){var objectCC=this.getCallbackCollection(linkableObject);if(objectCC!=linkableObject)this.disposeObject(objectCC)}var parents=this.d2d_child_parent.secondaryKeys(object);
var foreachiter13_target=parents;for(var foreachiter13 in foreachiter13_target){var parent=foreachiter13_target[foreachiter13];this.d2d_parent_child.remove(parent,object)}this.d2d_child_parent.removeAllPrimary(object);var owner=this.map_child_owner.get(object);if(owner!=null){this.d2d_owner_child.remove(owner,object);this.map_child_owner['delete'](object)}var children=this.d2d_owner_child.secondaryKeys(object);this.d2d_owner_child.removeAllPrimary(object);this.d2d_parent_child.removeAllPrimary(object);
var foreachiter14_target=children;for(var foreachiter14 in foreachiter14_target){var child=foreachiter14_target[foreachiter14];this.disposeObject(child)}if(weavejs.WeaveAPI.debugAsyncStack&&linkableObject){var error=new Error('This is the stack trace from when the object was previously disposed.');objectCC.addImmediateCallback(null,__localFn0__)}this._treeCallbacks.triggerCallbacks()}};
weavejs.core.SessionManager.prototype.debugDisposedObject=function(disposedObject,disposedError){var obj;var ownerPath=[];do{obj=this.getLinkableOwner(obj);if(obj)ownerPath.unshift(obj)}while(obj);var parents=this.d2d_child_parent.secondaryKeys(disposedObject);var children=this.d2d_parent_child.secondaryKeys(disposedObject);var sessionState=this.getSessionState(disposedObject);var msg='WARNING: An object triggered callbacks after previously being disposed.';if(org.apache.flex.utils.Language.is(disposedObject,
weavejs.api.core.ILinkableVariable))msg+=' (value \x3d '+org.apache.flex.utils.Language.as(disposedObject,weavejs.api.core.ILinkableVariable).getSessionState()+')';weavejs.util.JS.error(disposedError);weavejs.util.JS.error(msg,disposedObject)};
weavejs.core.SessionManager.prototype._getPaths=function(root,descendant){var results=[];var parents=this.d2d_child_parent.secondaryKeys(descendant);var foreachiter15_target=parents;for(var foreachiter15 in foreachiter15_target){var parent=foreachiter15_target[foreachiter15];var name=this._getChildPropertyName(org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableObject),descendant);if(name!=null){var result=this._getPaths(root,org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableObject));
if(result!=null){result.push(name);results.push(result)}}}if(results.length==0)return root==null?results:null;return results};
weavejs.core.SessionManager.prototype._getChildPropertyName=function(parent,child){if(org.apache.flex.utils.Language.is(parent,weavejs.api.core.ILinkableHashMap))return org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableHashMap).getName(child);var names=this.getLinkablePropertyNames(parent);var foreachiter16_target=names;for(var foreachiter16 in foreachiter16_target){var name=foreachiter16_target[foreachiter16];if(parent[name]==child)return name}return null};
weavejs.core.SessionManager.prototype.getPath=function(root,descendant){if(!root||!descendant)return null;var tree=this.getSessionStateTree(root,null);var path=this._getPath(tree,descendant);return path};
weavejs.core.SessionManager.prototype._getPath=function(tree,descendant){if(tree.data==descendant)return[];var children=tree.children;var foreachiter17_target=children;for(var foreachiter17 in foreachiter17_target){var child=foreachiter17_target[foreachiter17];var path=this._getPath(child,descendant);if(path){path.unshift(child.label);return path}}return null};
weavejs.core.SessionManager.prototype.getObject=function(root,path){if(!path)return null;var object=root;for(var i=0;i<path.length;i++){var propertyName=path[i];if(object==null||this.map_disposed.get(object))return null;if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableHashMap))if(org.apache.flex.utils.Language.is(propertyName,Number))object=org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableHashMap).getObjects()[propertyName];else object=org.apache.flex.utils.Language.as(object,
weavejs.api.core.ILinkableHashMap).getObject(String(propertyName));else if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableDynamicObject))object=org.apache.flex.utils.Language.as(object,weavejs.api.core.ILinkableDynamicObject).internalObject;else if(org.apache.flex.utils.Language.is(object[propertyName],weavejs.api.core.ILinkableObject))object=object[propertyName];else{if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableObjectWithNewPaths)||weavejs.util.JS.hasProperty(object,
weavejs.core.SessionManager.DEPRECATED_PATH_REWRITE)){var rewrittenPath=object[weavejs.core.SessionManager.DEPRECATED_PATH_REWRITE](path.slice(i));if(rewrittenPath)return this.getObject(object,rewrittenPath)}if(org.apache.flex.utils.Language.is(object,weavejs.api.core.ILinkableObjectWithNewProperties)||weavejs.util.JS.hasProperty(object,weavejs.core.SessionManager.DEPRECATED_STATE_MAPPING))return this.getObjectFromDeprecatedPath(object[weavejs.core.SessionManager.DEPRECATED_STATE_MAPPING],path,i);
return null}}return this.map_disposed.get(object)?null:object};
weavejs.core.SessionManager.prototype.getObjectFromDeprecatedPath=function(mapping,path,startAtIndex){var object;if(org.apache.flex.utils.Language.is(mapping,Array)){var foreachiter18_target=mapping;for(var foreachiter18 in foreachiter18_target){var item=foreachiter18_target[foreachiter18];object=this.getObjectFromDeprecatedPath(item,path,startAtIndex);if(object)return object}return null}for(var i=startAtIndex;i<path.length;i++){if(!mapping||typeof mapping!=='object')return null;mapping=mapping[path[i]];
object=org.apache.flex.utils.Language.as(mapping,weavejs.api.core.ILinkableObject);if(object)return i+1==path.length?object:this.getObject(object,path.slice(i+1))}return null};weavejs.core.SessionManager.prototype.d2d_lhs_rhs_setState;
weavejs.core.SessionManager.prototype.linkSessionState=function(primary,secondary){var self=this;var __localFn0__=function(){self.setSessionState(primary,self.getSessionState(secondary),true)};var __localFn1__=function(){self.setSessionState(secondary,self.getSessionState(primary),true)};if(primary==null||secondary==null){weavejs.util.JS.error('SessionManager.linkSessionState(): Parameters to this function cannot be null.');return}if(primary==secondary){weavejs.util.JS.error('Warning! Attempt to link session state of an object with itself');
return}if(org.apache.flex.utils.Language.is(this.d2d_lhs_rhs_setState.get(primary,secondary),Function))return;var setPrimary=__localFn0__;var setSecondary=__localFn1__;this.d2d_lhs_rhs_setState.set(primary,secondary,setPrimary);this.d2d_lhs_rhs_setState.set(secondary,primary,setSecondary);this.getCallbackCollection(secondary).addImmediateCallback(primary,setPrimary);this.getCallbackCollection(primary).addImmediateCallback(secondary,setSecondary,true)};
weavejs.core.SessionManager.prototype.unlinkSessionState=function(first,second){if(first==null||second==null){weavejs.util.JS.error('SessionManager.unlinkSessionState(): Parameters to this function cannot be null.');return}var setFirst=org.apache.flex.utils.Language.as(this.d2d_lhs_rhs_setState.remove(first,second),Function);var setSecond=org.apache.flex.utils.Language.as(this.d2d_lhs_rhs_setState.remove(second,first),Function);this.getCallbackCollection(second).removeCallback(first,setFirst);this.getCallbackCollection(first).removeCallback(second,
setSecond)};weavejs.core.SessionManager.DIFF_DELETE='delete';
weavejs.core.SessionManager.prototype.computeDiff=function(oldState,newState){if(oldState==null)oldState=null;if(newState==null)newState=null;var type=typeof oldState;var diffValue;if(typeof newState!=type)return weavejs.util.JS.copyObject(newState);if(type=='xml')throw new Error('XML is not supported as a primitive session state type.');else if(type=='number'){if(isNaN(org.apache.flex.utils.Language.as(oldState,Number))&&isNaN(org.apache.flex.utils.Language.as(newState,Number)))return undefined;
if(oldState!=newState)return newState;return undefined}else if(oldState===null||newState===null||type!='object'){if(oldState!==newState)return weavejs.util.JS.copyObject(newState);return undefined}else if(org.apache.flex.utils.Language.is(oldState,Array)&&org.apache.flex.utils.Language.is(newState,Array)){if(!weavejs.api.core.DynamicState.isDynamicStateArray(oldState)&&!weavejs.api.core.DynamicState.isDynamicStateArray(newState)){if(weavejs.util.StandardLib.compare(oldState,newState)==0)return undefined;
return weavejs.util.JS.copyObject(newState)}var i;var typedState;var changeDetected=false;var oldLookup={};var objectName;var className;var sessionState;for(i=0;i<oldState.length;i++){typedState=oldState[i];objectName=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.OBJECT_NAME]);oldLookup[objectName||'']=typedState}if(oldState.length!=newState.length)changeDetected=true;var result=[];for(i=0;i<newState.length;i++){typedState=newState[i];objectName=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.OBJECT_NAME]);
className=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.CLASS_NAME]);sessionState=typedState[weavejs.api.core.DynamicState.SESSION_STATE];var oldTypedState=oldLookup[objectName||''];delete oldLookup[objectName||''];if(oldTypedState!=null&&oldTypedState[weavejs.api.core.DynamicState.CLASS_NAME]==className){className=null;diffValue=this.computeDiff(oldTypedState[weavejs.api.core.DynamicState.SESSION_STATE],sessionState);if(diffValue===undefined){result.push(objectName);
if(!changeDetected&&oldState[i][weavejs.api.core.DynamicState.OBJECT_NAME]!=objectName)changeDetected=true;continue}sessionState=diffValue}else sessionState=weavejs.util.JS.copyObject(sessionState);result.push(weavejs.api.core.DynamicState.create(objectName||null,className,sessionState));changeDetected=true}for(objectName in oldLookup){result.push(weavejs.api.core.DynamicState.create(objectName||null,weavejs.core.SessionManager.DIFF_DELETE));changeDetected=true}if(changeDetected)return result;return undefined}else{var diff=
undefined;for(var oldName in oldState){diffValue=this.computeDiff(oldState[oldName],newState[oldName]);if(diffValue!==undefined){if(!diff)diff={};if(newState.hasOwnProperty(oldName))diff[oldName]=diffValue;else diff[oldName]=undefined}}for(var newName in newState)if(oldState[newName]===undefined&&newState[newName]!==undefined){if(!diff)diff={};diff[newName]=weavejs.util.JS.copyObject(newState[newName])}return diff}};
weavejs.core.SessionManager.prototype.combineDiff=function(baseDiff,diffToAdd){if(baseDiff==null)baseDiff=null;if(diffToAdd==null)diffToAdd=null;var baseType=typeof baseDiff;var diffType=typeof diffToAdd;if(baseDiff==null||diffToAdd==null||baseType!=diffType||baseType!='object')baseDiff=weavejs.util.JS.copyObject(diffToAdd);else if(org.apache.flex.utils.Language.is(baseDiff,Array)&&org.apache.flex.utils.Language.is(diffToAdd,Array)){var i;if(weavejs.api.core.DynamicState.isDynamicStateArray(baseDiff)||
weavejs.api.core.DynamicState.isDynamicStateArray(diffToAdd)){var typedState;var objectName;var baseLookup={};for(i=0;i<baseDiff.length;i++){typedState=baseDiff[i];if(org.apache.flex.utils.Language.is(typedState,String)||typedState==null)objectName=org.apache.flex.utils.Language.as(typedState,String);else objectName=org.apache.flex.utils.Language.as(typedState[weavejs.api.core.DynamicState.OBJECT_NAME],String);baseLookup[objectName]=typedState;baseDiff[i]=objectName}for(i=0;i<diffToAdd.length;i++){typedState=
diffToAdd[i];if(org.apache.flex.utils.Language.is(typedState,String)||typedState==null)objectName=org.apache.flex.utils.Language.as(typedState,String);else objectName=org.apache.flex.utils.Language.as(typedState[weavejs.api.core.DynamicState.OBJECT_NAME],String);if(baseLookup.hasOwnProperty(objectName)){for(var j=org.apache.flex.utils.Language.as(baseDiff,Array).indexOf(objectName);j<baseDiff.length-1;j++)baseDiff[j]=baseDiff[j+1];baseDiff[baseDiff.length-1]=objectName}else baseDiff.push(objectName);
var oldTypedState=baseLookup[objectName];if(org.apache.flex.utils.Language.is(oldTypedState,String)||oldTypedState==null)baseLookup[objectName]=weavejs.util.JS.copyObject(typedState);else if(!(org.apache.flex.utils.Language.is(typedState,String)||typedState==null)){var className=org.apache.flex.utils.Language.string(typedState[weavejs.api.core.DynamicState.CLASS_NAME]);if(className&&className!=oldTypedState[weavejs.api.core.DynamicState.CLASS_NAME])baseLookup[objectName]=weavejs.util.JS.copyObject(typedState);
else oldTypedState[weavejs.api.core.DynamicState.SESSION_STATE]=this.combineDiff(oldTypedState[weavejs.api.core.DynamicState.SESSION_STATE],typedState[weavejs.api.core.DynamicState.SESSION_STATE])}}for(i=0;i<baseDiff.length;i++)baseDiff[i]=baseLookup[baseDiff[i]]}else{i=Number(baseDiff.length=diffToAdd.length);while(i--){var value=diffToAdd[i];if(value==null||typeof value!='object')baseDiff[i]=value;else baseDiff[i]=this.combineDiff(baseDiff[i],value)}}}else for(var newName in diffToAdd)baseDiff[newName]=
this.combineDiff(baseDiff[newName],diffToAdd[newName]);return baseDiff};
weavejs.core.SessionManager.prototype.testDiff=function(){var states=[[{objectName:'a',className:'aClass',sessionState:'aVal'},{objectName:'b',className:'bClass',sessionState:'bVal1'}],[{objectName:'b',className:'bClass',sessionState:'bVal2'},{objectName:'a',className:'aClass',sessionState:'aVal'}],[{objectName:'a',className:'aNewClass',sessionState:'aVal'},{objectName:'b',className:'bClass',sessionState:null}],[{objectName:'b',className:'bClass',sessionState:null}]];var diffs=[];var combined=[];
var baseDiff=null;for(var i=1;i<states.length;i++){var diff=this.computeDiff(states[i-1],states[i]);diffs.push(diff);baseDiff=this.combineDiff(baseDiff,diff);combined.push(weavejs.util.JS.copyObject(baseDiff))}weavejs.util.JS.log('diffs',diffs);weavejs.util.JS.log('combined',combined)};weavejs.core.SessionManager.prototype.FLEXJS_CLASS_INFO={names:[{name:'SessionManager',qName:'weavejs.core.SessionManager'}],interfaces:[weavejs.api.core.ISessionManager]};
goog.exportSymbol('weavejs.core.SessionManager',weavejs.core.SessionManager);
weavejs.core.SessionManager.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'newLinkableChild':{type:'*',declaredBy:'weavejs.core.SessionManager'},'registerLinkableChild':{type:'*',declaredBy:'weavejs.core.SessionManager'},'newDisposableChild':{type:'*',declaredBy:'weavejs.core.SessionManager'},'registerDisposableChild':{type:'*',declaredBy:'weavejs.core.SessionManager'},'unregisterLinkableChild':{type:'void',
declaredBy:'weavejs.core.SessionManager'},'excludeLinkableChildFromSessionState':{type:'void',declaredBy:'weavejs.core.SessionManager'},'getOwner':{type:'Object',declaredBy:'weavejs.core.SessionManager'},'getLinkableOwner':{type:'ILinkableObject',declaredBy:'weavejs.core.SessionManager'},'getSessionStateTree':{type:'WeaveTreeItem',declaredBy:'weavejs.core.SessionManager'},'getTypedStateTree':{type:'Object',declaredBy:'weavejs.core.SessionManager'},'addTreeCallback':{type:'void',declaredBy:'weavejs.core.SessionManager'},
'removeTreeCallback':{type:'void',declaredBy:'weavejs.core.SessionManager'},'copySessionState':{type:'void',declaredBy:'weavejs.core.SessionManager'},'setSessionState':{type:'void',declaredBy:'weavejs.core.SessionManager'},'getSessionState':{type:'Object',declaredBy:'weavejs.core.SessionManager'},'getLinkablePropertyNames':{type:'Array',declaredBy:'weavejs.core.SessionManager'},'getLinkableDescendants':{type:'Array',declaredBy:'weavejs.core.SessionManager'},'assignBusyTask':{type:'void',declaredBy:'weavejs.core.SessionManager'},
'unassignBusyTask':{type:'void',declaredBy:'weavejs.core.SessionManager'},'linkableObjectIsBusy':{type:'Boolean',declaredBy:'weavejs.core.SessionManager'},'getCallbackCollection':{type:'ICallbackCollection',declaredBy:'weavejs.core.SessionManager'},'getLinkableObjectFromCallbackCollection':{type:'ILinkableObject',declaredBy:'weavejs.core.SessionManager'},'objectWasDisposed':{type:'Boolean',declaredBy:'weavejs.core.SessionManager'},'disposeObject':{type:'void',declaredBy:'weavejs.core.SessionManager'},
'_getPaths':{type:'Array',declaredBy:'weavejs.core.SessionManager'},'getPath':{type:'Array',declaredBy:'weavejs.core.SessionManager'},'getObject':{type:'ILinkableObject',declaredBy:'weavejs.core.SessionManager'},'linkSessionState':{type:'void',declaredBy:'weavejs.core.SessionManager'},'unlinkSessionState':{type:'void',declaredBy:'weavejs.core.SessionManager'},'computeDiff':{type:'*',declaredBy:'weavejs.core.SessionManager'},'combineDiff':{type:'Object',declaredBy:'weavejs.core.SessionManager'},'testDiff':{type:'void',
declaredBy:'weavejs.core.SessionManager'}}}}};goog.provide('weavejs.core.LinkableWatcher');goog.require('weavejs.core.SessionManager');goog.require('weavejs.api.core.IDisposableObject');goog.require('weavejs.api.core.ILinkableObject');
weavejs.core.LinkableWatcher=function(typeRestriction,immediateCallback,groupedCallback){typeRestriction=typeof typeRestriction!=='undefined'?typeRestriction:null;immediateCallback=typeof immediateCallback!=='undefined'?immediateCallback:null;groupedCallback=typeof groupedCallback!=='undefined'?groupedCallback:null;this._pathDependencies=new weavejs.util.Dictionary2D;this._typeRestriction=typeRestriction;if(immediateCallback!=null)Weave.getCallbacks(this).addImmediateCallback(null,immediateCallback);
if(groupedCallback!=null)Weave.getCallbacks(this).addGroupedCallback(null,groupedCallback)};weavejs.core.LinkableWatcher.prototype._typeRestriction;weavejs.core.LinkableWatcher.prototype._root;weavejs.core.LinkableWatcher.prototype._target;weavejs.core.LinkableWatcher.prototype._foundRoot=false;weavejs.core.LinkableWatcher.prototype._foundTarget=true;weavejs.core.LinkableWatcher.prototype._targetPath;weavejs.core.LinkableWatcher.prototype._pathDependencies;
weavejs.core.LinkableWatcher.prototype._warned=false;
weavejs.core.LinkableWatcher.prototype.internalSetTarget=function(newTarget){if(Weave.wasDisposed(newTarget))newTarget=null;if(newTarget&&this._foundTarget&&this._typeRestriction){var classDef=weavejs.core.LinkablePlaceholder.getClass(newTarget);if(!(classDef===this._typeRestriction||org.apache.flex.utils.Language.is(classDef.prototype,this._typeRestriction)))newTarget=null}if(this._target==newTarget)return;if(this._target){Weave.getCallbacks(this._target).removeCallback(this,org.apache.flex.utils.Language.closure(this._handleTargetTrigger,
this,'_handleTargetTrigger'));Weave.getCallbacks(this._target).removeCallback(this,org.apache.flex.utils.Language.closure(this._handleTargetDispose,this,'_handleTargetDispose'));if(Weave.getOwner(this._target)==this)Weave.dispose(this._target);else org.apache.flex.utils.Language.as(weavejs.WeaveAPI.SessionManager,weavejs.core.SessionManager).unregisterLinkableChild(this,this._target)}this._target=newTarget;if(this._target){Weave.linkableChild(this,this._target);Weave.getCallbacks(this._target).removeCallback(this,
org.apache.flex.utils.Language.closure(Weave.getCallbacks(this).triggerCallbacks,Weave.getCallbacks(this),'triggerCallbacks'));Weave.getCallbacks(this._target).addImmediateCallback(this,org.apache.flex.utils.Language.closure(this._handleTargetTrigger,this,'_handleTargetTrigger'),false,true);Weave.getCallbacks(this._target).addDisposeCallback(this,org.apache.flex.utils.Language.closure(this._handleTargetDispose,this,'_handleTargetDispose'))}if(this._foundTarget)this._handleTargetTrigger()};
weavejs.core.LinkableWatcher.prototype._handleTargetTrigger=function(){if(this._foundTarget)Weave.getCallbacks(this).triggerCallbacks();else this.handlePath()};weavejs.core.LinkableWatcher.prototype._handleTargetDispose=function(){if(this._targetPath)this.handlePath();else{this._target=null;Weave.getCallbacks(this).triggerCallbacks()}};
weavejs.core.LinkableWatcher.prototype.handlePath=function(){var self=this;var __localFn0__=function(){if(!self._foundRoot&&!self.root)weavejs.util.JS.error('Warning:',error)};if(!this._targetPath){this._foundTarget=true;this.internalSetTarget(null);return}this._foundRoot=this.root!=null;if(!this._foundRoot&&!this._warned){var error=new Error('LinkableWatcher has a targetPath but no root');weavejs.WeaveAPI.Scheduler.callLater(this,__localFn0__);this._warned=true}var node=Weave.followPath(this._root,
this._targetPath);if(!node){node=this._root;var subPath=[];var foreachiter0_target=this._targetPath;for(var foreachiter0 in foreachiter0_target){var name=foreachiter0_target[foreachiter0];if(org.apache.flex.utils.Language.is(node,weavejs.api.core.ILinkableCompositeObject))this.addPathDependency(org.apache.flex.utils.Language.as(node,weavejs.api.core.ILinkableCompositeObject),name);subPath[0]=name;var child=Weave.followPath(node,subPath);if(child)node=child;else{if(org.apache.flex.utils.Language.is(node,
weavejs.api.core.ILinkableHashMap))node=org.apache.flex.utils.Language.as(node,weavejs.api.core.ILinkableHashMap).childListCallbacks;if(org.apache.flex.utils.Language.is(node,weavejs.api.core.ILinkableDynamicObject))node=null;var lostTarget=this._foundTarget;this._foundTarget=false;this.internalSetTarget(node);if(lostTarget)Weave.getCallbacks(this).triggerCallbacks();return}}}this._foundTarget=!this._typeRestriction||org.apache.flex.utils.Language.is(node,this._typeRestriction);this.internalSetTarget(node)};
weavejs.core.LinkableWatcher.prototype.addPathDependency=function(parent,pathElement){var lhm=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableHashMap);if(lhm&&org.apache.flex.utils.Language.is(pathElement,String))return;var ldo=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableDynamicObject);if(ldo)pathElement=null;if(!this._pathDependencies.get(parent,pathElement)){var child=Weave.followPath(parent,[pathElement]);this._pathDependencies.set(parent,pathElement,child);
var dependencyCallbacks=this.getDependencyCallbacks(parent);dependencyCallbacks.addImmediateCallback(this,org.apache.flex.utils.Language.closure(this.handlePathDependencies,this,'handlePathDependencies'));dependencyCallbacks.addDisposeCallback(this,org.apache.flex.utils.Language.closure(this.handlePathDependencies,this,'handlePathDependencies'))}};
weavejs.core.LinkableWatcher.prototype.getDependencyCallbacks=function(parent){var lhm=org.apache.flex.utils.Language.as(parent,weavejs.api.core.ILinkableHashMap);if(lhm)return lhm.childListCallbacks;return Weave.getCallbacks(parent)};weavejs.core.LinkableWatcher.prototype.handlePathDependencies=function(){this._pathDependencies.forEach(org.apache.flex.utils.Language.closure(this.handlePathDependencies_each,this,'handlePathDependencies_each'),this)};
weavejs.core.LinkableWatcher.prototype.handlePathDependencies_each=function(parent,pathElement,child){var newChild=Weave.followPath(parent,[pathElement]);if(Weave.wasDisposed(parent)||child!=newChild){this.resetPathDependencies();this.handlePath();return true}return false};
weavejs.core.LinkableWatcher.prototype.resetPathDependencies=function(){this._pathDependencies.map.forEach(org.apache.flex.utils.Language.closure(this.resetPathDependencies_each,this,'resetPathDependencies_each'),this);this._pathDependencies=new weavejs.util.Dictionary2D};weavejs.core.LinkableWatcher.prototype.resetPathDependencies_each=function(map_child,parent){this.getDependencyCallbacks(parent).removeCallback(this,org.apache.flex.utils.Language.closure(this.handlePathDependencies,this,'handlePathDependencies'))};
weavejs.core.LinkableWatcher.prototype.dispose=function(){this._targetPath=null;this._target=null;this._root=null};
Object.defineProperties(weavejs.core.LinkableWatcher.prototype,{root:{get:function(){if(!this._root){var weave=Weave.getWeave(this);this._root=weave?weave.root:Weave.getRoot(this);if(this._root&&!this._foundRoot&&!this._foundTarget)this.handlePath()}return this._root},set:function(object){if(this.root!=object){var cc=Weave.getCallbacks(this);cc.delayCallbacks();this._root=object;if(this._targetPath){this.resetPathDependencies();this.handlePath()}cc.triggerCallbacks();cc.resumeCallbacks()}}},target:{get:function(){if(!this._foundRoot&&
!this._foundTarget)this.handlePath();return this._foundTarget?this._target:null},set:function(newTarget){var cc=Weave.getCallbacks(this);cc.delayCallbacks();this.targetPath=null;this.internalSetTarget(newTarget);cc.resumeCallbacks()}},foundPlaceholder:{get:function(){return org.apache.flex.utils.Language.is(this._target,weavejs.core.LinkablePlaceholder)}},targetPath:{get:function(){return this._targetPath?this._targetPath.concat():null},set:function(path){if(path&&path.length==0)path=null;if(weavejs.util.StandardLib.compare(this._targetPath,
path)!=0){var cc=Weave.getCallbacks(this);cc.delayCallbacks();this.resetPathDependencies();this._targetPath=path;this.handlePath();cc.triggerCallbacks();cc.resumeCallbacks()}}}});weavejs.core.LinkableWatcher.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableWatcher',qName:'weavejs.core.LinkableWatcher'}],interfaces:[weavejs.api.core.ILinkableObject,weavejs.api.core.IDisposableObject]};goog.exportSymbol('weavejs.core.LinkableWatcher',weavejs.core.LinkableWatcher);
weavejs.core.LinkableWatcher.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'root':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableWatcher'},'target':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableWatcher'},'foundPlaceholder':{type:'Boolean',declaredBy:'weavejs.core.LinkableWatcher'},'targetPath':{type:'Array',declaredBy:'weavejs.core.LinkableWatcher'}}},methods:function(){return{'LinkableWatcher':{type:'',declaredBy:'weavejs.core.LinkableWatcher'},
'dispose':{type:'void',declaredBy:'weavejs.core.LinkableWatcher'}}}}};goog.provide('weavejs.core.LinkableDynamicObject');goog.require('weavejs.core.LinkableWatcher');goog.require('weavejs.core.SessionManager');goog.require('weavejs.api.core.ICallbackCollection');goog.require('weavejs.api.core.ILinkableDynamicObject');
weavejs.core.LinkableDynamicObject=function(typeRestriction){typeRestriction=typeof typeRestriction!=='undefined'?typeRestriction:null;this.cc=Weave.disposableChild(this,weavejs.core.CallbackCollection);weavejs.core.LinkableDynamicObject.base(this,'constructor',typeRestriction)};goog.inherits(weavejs.core.LinkableDynamicObject,weavejs.core.LinkableWatcher);weavejs.core.LinkableDynamicObject.prototype.cc;weavejs.core.LinkableDynamicObject.prototype._locked=false;
weavejs.core.LinkableDynamicObject.ARRAY_CLASS_NAME='Array';weavejs.core.LinkableDynamicObject.prototype.getSessionState=function(){var obj=this.targetPath||this.target;if(!obj)return[];var className=Weave.className(weavejs.core.LinkablePlaceholder.getClass(obj));var sessionState=org.apache.flex.utils.Language.as(obj,Array)||Weave.getState(org.apache.flex.utils.Language.as(obj,weavejs.api.core.ILinkableObject));return[weavejs.api.core.DynamicState.create(null,className,sessionState)]};
weavejs.core.LinkableDynamicObject.prototype.setSessionState=function(newState,removeMissingDynamicObjects){if(newState==null)return;try{this.cc.delayCallbacks();if(!newState.length){if(removeMissingDynamicObjects)this.target=null;return}if(!weavejs.api.core.DynamicState.isDynamicStateArray(newState,true)){this.targetPath=newState;return}if(newState.length>1){this.handleDeprecatedSessionState(newState,removeMissingDynamicObjects);return}var dynamicState=newState[0];var className=org.apache.flex.utils.Language.string(dynamicState[weavejs.api.core.DynamicState.CLASS_NAME]);
var objectName=org.apache.flex.utils.Language.string(dynamicState[weavejs.api.core.DynamicState.OBJECT_NAME]);var sessionState=dynamicState[weavejs.api.core.DynamicState.SESSION_STATE];if(className=='weave.core::GlobalObjectReference'||className=='GlobalObjectReference'){className=weavejs.core.LinkableDynamicObject.ARRAY_CLASS_NAME;sessionState=[objectName]}if(className==weavejs.core.LinkableDynamicObject.ARRAY_CLASS_NAME||!className&&this.targetPath)this.targetPath=org.apache.flex.utils.Language.as(sessionState,
Array);else if(className==weavejs.core.SessionManager.DIFF_DELETE)this.target=null;else{var prevTarget=this.target;var classDef=Weave.getDefinition(className);if(className||removeMissingDynamicObjects)this.setLocalObjectType(classDef);var targetClassDef=weavejs.core.LinkablePlaceholder.getClass(this.target);if(!className&&this.target||classDef&&(targetClassDef===classDef||org.apache.flex.utils.Language.is(targetClassDef.prototype,classDef)))Weave.setState(this.target,sessionState,prevTarget!=this.target||
removeMissingDynamicObjects)}}finally{this.cc.resumeCallbacks()}};weavejs.core.LinkableDynamicObject.prototype.internalSetTarget=function(newTarget){if(newTarget===this||Weave.getDescendants(newTarget,weavejs.core.LinkableDynamicObject).indexOf(this)>=0)newTarget=null;weavejs.core.LinkableDynamicObject.base(this,'internalSetTarget',newTarget)};
weavejs.core.LinkableDynamicObject.prototype.setLocalObjectType=function(classDef){if(this._locked)return;this.cc.delayCallbacks();this.targetPath=null;if(Weave.isLinkable(classDef)&&(this._typeRestriction==null||classDef===this._typeRestriction||org.apache.flex.utils.Language.is(classDef.prototype,this._typeRestriction))){if(classDef!=weavejs.core.LinkablePlaceholder.getClass(this.target))if(Weave.isAsyncClass(classDef))org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,
this,'target',new weavejs.core.LinkablePlaceholder(classDef));else org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,this,'target',new classDef)}else org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,this,'target',null);this.cc.resumeCallbacks()};
weavejs.core.LinkableDynamicObject.prototype.requestLocalObject=function(objectType,lockObject){lockObject=typeof lockObject!=='undefined'?lockObject:false;if(org.apache.flex.utils.Language.is(objectType,String))objectType=Weave.getDefinition(String(objectType),true);this.cc.delayCallbacks();if(objectType)this.setLocalObjectType(objectType);else this.target=null;if(lockObject)this._locked=true;this.cc.resumeCallbacks();if(objectType)return org.apache.flex.utils.Language.as(this.target,objectType);
return this.target};
weavejs.core.LinkableDynamicObject.prototype.requestGlobalObject=function(name,objectType,lockObject){lockObject=typeof lockObject!=='undefined'?lockObject:false;if(org.apache.flex.utils.Language.is(objectType,String))objectType=Weave.getDefinition(String(objectType),true);if(!name)return this.requestLocalObject(objectType,lockObject);if(!this._locked){this.cc.delayCallbacks();this.targetPath=[name];Weave.getRoot(this).requestObject(name,objectType,lockObject);if(lockObject)this._locked=true;this.cc.resumeCallbacks()}if(objectType)return org.apache.flex.utils.Language.as(this.target,
objectType);return this.target};weavejs.core.LinkableDynamicObject.prototype.requestLocalObjectCopy=function(objectToCopy){this.cc.delayCallbacks();var classDef=weavejs.core.LinkablePlaceholder.getClass(objectToCopy);var object=this.requestLocalObject(classDef,false);if(object!=null&&objectToCopy!=null)Weave.copyState(objectToCopy,object);this.cc.resumeCallbacks()};
weavejs.core.LinkableDynamicObject.prototype.handleDeprecatedSessionState=function(newState,removeMissingDynamicObjects){var i=newState.length;while(i--){var item=newState[i];if(org.apache.flex.utils.Language.is(item,String))item=weavejs.api.core.DynamicState.create(null,weavejs.core.LinkableDynamicObject.ARRAY_CLASS_NAME,[item]);if(!weavejs.api.core.DynamicState.isDynamicState(item))break;if(item[weavejs.api.core.DynamicState.CLASS_NAME]==weavejs.core.SessionManager.DIFF_DELETE){if(this.globalName==
(item[weavejs.api.core.DynamicState.OBJECT_NAME]||null))this.target=null}else{this.setSessionState([item],removeMissingDynamicObjects);return}}if(removeMissingDynamicObjects)this.target=null};weavejs.core.LinkableDynamicObject.prototype.lock=function(){this._locked=true};weavejs.core.LinkableDynamicObject.prototype.removeObject=function(){if(!this._locked)org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,this,'target',null)};
weavejs.core.LinkableDynamicObject.prototype.dispose=function(){this.cc.dispose();weavejs.core.LinkableDynamicObject.base(this,'dispose')};weavejs.core.LinkableDynamicObject.prototype.addImmediateCallback=function(relevantContext,callback,runCallbackNow,alwaysCallLast){runCallbackNow=typeof runCallbackNow!=='undefined'?runCallbackNow:false;alwaysCallLast=typeof alwaysCallLast!=='undefined'?alwaysCallLast:false;this.cc.addImmediateCallback(relevantContext,callback,runCallbackNow,alwaysCallLast)};
weavejs.core.LinkableDynamicObject.prototype.addGroupedCallback=function(relevantContext,groupedCallback,triggerCallbackNow,delayWhileBusy){triggerCallbackNow=typeof triggerCallbackNow!=='undefined'?triggerCallbackNow:false;delayWhileBusy=typeof delayWhileBusy!=='undefined'?delayWhileBusy:true;this.cc.addGroupedCallback(relevantContext,groupedCallback,triggerCallbackNow,delayWhileBusy)};
weavejs.core.LinkableDynamicObject.prototype.addDisposeCallback=function(relevantContext,callback,allowDelay){allowDelay=typeof allowDelay!=='undefined'?allowDelay:false;this.cc.addDisposeCallback(relevantContext,callback,allowDelay)};weavejs.core.LinkableDynamicObject.prototype.removeCallback=function(relevantContext,callback){this.cc.removeCallback(relevantContext,callback)};weavejs.core.LinkableDynamicObject.prototype.triggerCallbacks=function(){this.cc.triggerCallbacks()};
weavejs.core.LinkableDynamicObject.prototype.delayCallbacks=function(){this.cc.delayCallbacks()};weavejs.core.LinkableDynamicObject.prototype.resumeCallbacks=function(){this.cc.resumeCallbacks()};
Object.defineProperties(weavejs.core.LinkableDynamicObject.prototype,{internalObject:{get:function(){return this.target}},target:{get:function(){return org.apache.flex.utils.Language.superGetter(weavejs.core.LinkableDynamicObject,this,'target')},set:function(newTarget){if(this._locked||this.target===newTarget)return;if(!newTarget){org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,this,'target',null);return}this.cc.delayCallbacks();var path=Weave.findPath(Weave.getRoot(this),
newTarget);if(path)this.targetPath=path;else{var owner=Weave.getOwner(newTarget);if(owner===this||!owner)org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,this,'target',newTarget);else org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,this,'target',null)}this.cc.resumeCallbacks()}},targetPath:{get:function(){return org.apache.flex.utils.Language.superGetter(weavejs.core.LinkableDynamicObject,this,'targetPath')},set:function(path){if(this._locked)return;
org.apache.flex.utils.Language.superSetter(weavejs.core.LinkableDynamicObject,this,'targetPath',path)}},globalName:{get:function(){if(this._targetPath&&this._targetPath.length==1)return this._targetPath[0];return null},set:function(newGlobalName){if(this._locked)return;if(!newGlobalName)newGlobalName=null;var oldGlobalName=this.globalName;if(oldGlobalName==newGlobalName)return;this.cc.delayCallbacks();if(newGlobalName==null)this.requestLocalObjectCopy(this.internalObject);else{var root=Weave.getRoot(this);
if(this.target&&!this.targetPath&&!root.getObject(newGlobalName))root.requestObjectCopy(newGlobalName,this.internalObject);this.targetPath=[newGlobalName]}this.cc.resumeCallbacks()}},locked:{get:function(){return this._locked}},triggerCounter:{get:function(){return this.cc.triggerCounter}},callbacksAreDelayed:{get:function(){return this.cc.callbacksAreDelayed}}});
weavejs.core.LinkableDynamicObject.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableDynamicObject',qName:'weavejs.core.LinkableDynamicObject'}],interfaces:[weavejs.api.core.ILinkableDynamicObject,weavejs.api.core.ICallbackCollection]};goog.exportSymbol('weavejs.core.LinkableDynamicObject',weavejs.core.LinkableDynamicObject);
weavejs.core.LinkableDynamicObject.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'internalObject':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableDynamicObject'},'target':{type:'ILinkableObject',declaredBy:'weavejs.core.LinkableDynamicObject'},'targetPath':{type:'Array',declaredBy:'weavejs.core.LinkableDynamicObject'},'globalName':{type:'String',declaredBy:'weavejs.core.LinkableDynamicObject'},'locked':{type:'Boolean',declaredBy:'weavejs.core.LinkableDynamicObject'},
'triggerCounter':{type:'uint',declaredBy:'weavejs.core.LinkableDynamicObject'},'callbacksAreDelayed':{type:'Boolean',declaredBy:'weavejs.core.LinkableDynamicObject'}}},methods:function(){return{'LinkableDynamicObject':{type:'',declaredBy:'weavejs.core.LinkableDynamicObject'},'getSessionState':{type:'Array',declaredBy:'weavejs.core.LinkableDynamicObject'},'setSessionState':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'requestLocalObject':{type:'*',declaredBy:'weavejs.core.LinkableDynamicObject'},
'requestGlobalObject':{type:'*',declaredBy:'weavejs.core.LinkableDynamicObject'},'requestLocalObjectCopy':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'lock':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'removeObject':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'dispose':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'addImmediateCallback':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'addGroupedCallback':{type:'void',
declaredBy:'weavejs.core.LinkableDynamicObject'},'addDisposeCallback':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'removeCallback':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'triggerCallbacks':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'delayCallbacks':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'},'resumeCallbacks':{type:'void',declaredBy:'weavejs.core.LinkableDynamicObject'}}}}};goog.provide('weavejs.core.LinkableNumber');goog.require('weavejs.core.LinkableVariable');
weavejs.core.LinkableNumber=function(defaultValue,verifier,defaultValueTriggersCallbacks){defaultValue=typeof defaultValue!=='undefined'?defaultValue:NaN;verifier=typeof verifier!=='undefined'?verifier:null;defaultValueTriggersCallbacks=typeof defaultValueTriggersCallbacks!=='undefined'?defaultValueTriggersCallbacks:true;weavejs.core.LinkableNumber.base(this,'constructor',Number,verifier,arguments.length?defaultValue:undefined,defaultValueTriggersCallbacks)};
goog.inherits(weavejs.core.LinkableNumber,weavejs.core.LinkableVariable);weavejs.core.LinkableNumber.prototype.getSessionState=function(){return Number(this._sessionStateExternal)};weavejs.core.LinkableNumber.prototype.setSessionState=function(value){if(!org.apache.flex.utils.Language.is(value,Number))value=weavejs.util.StandardLib.asNumber(value);weavejs.core.LinkableNumber.base(this,'setSessionState',value)};
weavejs.core.LinkableNumber.prototype.sessionStateEquals=function(otherSessionState){if(this._sessionStateInternal==null)this._sessionStateInternal=this._sessionStateExternal=NaN;if(isNaN(this._sessionStateInternal)&&isNaN(otherSessionState))return true;return this._sessionStateInternal==otherSessionState};Object.defineProperties(weavejs.core.LinkableNumber.prototype,{value:{get:function(){return Number(this._sessionStateExternal)},set:function(value){this.setSessionState(value)}}});
weavejs.core.LinkableNumber.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkableNumber',qName:'weavejs.core.LinkableNumber'}]};goog.exportSymbol('weavejs.core.LinkableNumber',weavejs.core.LinkableNumber);
weavejs.core.LinkableNumber.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'value':{type:'Number',declaredBy:'weavejs.core.LinkableNumber'}}},methods:function(){return{'LinkableNumber':{type:'',declaredBy:'weavejs.core.LinkableNumber'},'getSessionState':{type:'Object',declaredBy:'weavejs.core.LinkableNumber'},'setSessionState':{type:'void',declaredBy:'weavejs.core.LinkableNumber'}}}}};goog.provide('weavejs.core.LinkablePromise');goog.require('weavejs.api.core.IDisposableObject');goog.require('weavejs.api.core.ILinkableObject');
weavejs.core.LinkablePromise=function(task,description,validateNow){description=typeof description!=='undefined'?description:null;validateNow=typeof validateNow!=='undefined'?validateNow:false;this._task=task;this._description=description;this._callbackCollection=Weave.getCallbacks(this);this._callbackCollection.addImmediateCallback(this,org.apache.flex.utils.Language.closure(this._immediateCallback,this,'_immediateCallback'));this._callbackCollection.addGroupedCallback(this,org.apache.flex.utils.Language.closure(this._groupedCallback,
this,'_groupedCallback'),validateNow,false);if(validateNow){this._lazy=false;this._immediateCallback()}};
weavejs.core.LinkablePromise.fromIterativeTask=function(initialize,iterativeTask,priority,description,validateNow){description=typeof description!=='undefined'?description:null;validateNow=typeof validateNow!=='undefined'?validateNow:false;var __localFn0__=function(){var __localFn0__=function(resolve,reject){weavejs.WeaveAPI.Scheduler.startTask(linkablePromise,iterativeTask,priority,resolve)};if(initialize!=null)initialize();return new weavejs.util.JS.Promise(__localFn0__)};var linkablePromise;var asyncStart=
__localFn0__;return linkablePromise=new weavejs.core.LinkablePromise(asyncStart,description,validateNow)};weavejs.core.LinkablePromise.prototype._task;weavejs.core.LinkablePromise.prototype._description;weavejs.core.LinkablePromise.prototype._callbackCollection;weavejs.core.LinkablePromise.prototype._lazy=true;weavejs.core.LinkablePromise.prototype._invalidated=true;weavejs.core.LinkablePromise.prototype._jsPromise;weavejs.core.LinkablePromise.prototype._selfTriggeredCount=0;weavejs.core.LinkablePromise.prototype._result;
weavejs.core.LinkablePromise.prototype._error;weavejs.core.LinkablePromise.prototype.validate=function(){if(!this._lazy)return;this._lazy=false;if(this._invalidated)this._callbackCollection.triggerCallbacks()};
weavejs.core.LinkablePromise.prototype._immediateCallback=function(){if(this._callbackCollection.triggerCounter==this._selfTriggeredCount)return;this._invalidated=true;this._jsPromise=null;this._result=null;this._error=null;weavejs.WeaveAPI.ProgressIndicator.removeTask(org.apache.flex.utils.Language.closure(this._groupedCallback,this,'_groupedCallback'));if(this._lazy)return;if(weavejs.WeaveAPI.SessionManager.linkableObjectIsBusy(this)){this._invalidated=false;return}var _tmp_description=null;if(org.apache.flex.utils.Language.is(this._description,
Function))_tmp_description=org.apache.flex.utils.Language.string(org.apache.flex.utils.Language.as(this._description,Function)());else _tmp_description=org.apache.flex.utils.Language.as(this._description,String);weavejs.WeaveAPI.ProgressIndicator.addTask(org.apache.flex.utils.Language.closure(this._groupedCallback,this,'_groupedCallback'),this,_tmp_description)};
weavejs.core.LinkablePromise.prototype._groupedCallback=function(){try{if(this._lazy||!this._invalidated)return;var invokeResult=this._task.apply(null);if(!this._invalidated)return;this._invalidated=false;this._jsPromise=weavejs.util.WeavePromise.asPromise(invokeResult);if(this._jsPromise)this._jsPromise.then(this._handleResult.bind(this,this._jsPromise),this._handleFault.bind(this,this._jsPromise));else{this._result=invokeResult;weavejs.WeaveAPI.Scheduler.callLater(this,org.apache.flex.utils.Language.closure(this._handleResult,
this,'_handleResult'))}}catch(invokeError){this._invalidated=false;this._jsPromise=null;this._error=invokeError;weavejs.WeaveAPI.Scheduler.callLater(this,org.apache.flex.utils.Language.closure(this._handleFault,this,'_handleFault'))}};
weavejs.core.LinkablePromise.prototype._handleResult=function(jsPromise,result){jsPromise=typeof jsPromise!=='undefined'?jsPromise:null;result=typeof result!=='undefined'?result:undefined;if(this._invalidated||this._jsPromise!=jsPromise)return;weavejs.WeaveAPI.ProgressIndicator.removeTask(org.apache.flex.utils.Language.closure(this._groupedCallback,this,'_groupedCallback'));if(jsPromise)this._result=result;this._selfTriggeredCount=this._callbackCollection.triggerCounter+1;this._callbackCollection.triggerCallbacks()};
weavejs.core.LinkablePromise.prototype._handleFault=function(jsPromise,error){jsPromise=typeof jsPromise!=='undefined'?jsPromise:null;error=typeof error!=='undefined'?error:undefined;if(this._invalidated||this._jsPromise!=jsPromise)return;weavejs.WeaveAPI.ProgressIndicator.removeTask(org.apache.flex.utils.Language.closure(this._groupedCallback,this,'_groupedCallback'));if(jsPromise)this._error=error;this._selfTriggeredCount=this._callbackCollection.triggerCounter+1;this._callbackCollection.triggerCallbacks()};
weavejs.core.LinkablePromise.prototype.depend=function(dependency,otherDependencies){otherDependencies=Array.prototype.slice.call(arguments,1);otherDependencies.unshift(dependency);var foreachiter0_target=otherDependencies;for(var foreachiter0 in foreachiter0_target){dependency=foreachiter0_target[foreachiter0];Weave.linkableChild(this,dependency)}return this};
weavejs.core.LinkablePromise.prototype.dispose=function(){weavejs.WeaveAPI.ProgressIndicator.removeTask(org.apache.flex.utils.Language.closure(this._groupedCallback,this,'_groupedCallback'));this._lazy=true;this._invalidated=true;this._jsPromise=null;this._result=null;this._error=null};Object.defineProperties(weavejs.core.LinkablePromise.prototype,{result:{get:function(){this.validate();return this._result}},error:{get:function(){this.validate();return this._error}}});
weavejs.core.LinkablePromise.prototype.FLEXJS_CLASS_INFO={names:[{name:'LinkablePromise',qName:'weavejs.core.LinkablePromise'}],interfaces:[weavejs.api.core.ILinkableObject,weavejs.api.core.IDisposableObject]};goog.exportSymbol('weavejs.core.LinkablePromise',weavejs.core.LinkablePromise);
weavejs.core.LinkablePromise.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'result':{type:'Object',declaredBy:'weavejs.core.LinkablePromise'},'error':{type:'Object',declaredBy:'weavejs.core.LinkablePromise'}}},methods:function(){return{'LinkablePromise':{type:'',declaredBy:'weavejs.core.LinkablePromise'},'validate':{type:'void',declaredBy:'weavejs.core.LinkablePromise'},'depend':{type:'LinkablePromise',declaredBy:'weavejs.core.LinkablePromise'},
'dispose':{type:'void',declaredBy:'weavejs.core.LinkablePromise'}}}}};goog.provide('weavejs.util.ArrayUtils');weavejs.util.ArrayUtils=function(){};weavejs.util.ArrayUtils.map_primitive_lookup=new weavejs.util.JS.Map;weavejs.util.ArrayUtils.map_object_lookup=new weavejs.util.JS.WeakMap;weavejs.util.ArrayUtils._lookupId=0;weavejs.util.ArrayUtils._getLookup=function(key){var lookup=key===null||typeof key!=='object'?weavejs.util.ArrayUtils.map_primitive_lookup:weavejs.util.ArrayUtils.map_object_lookup;return lookup.get(key)};
weavejs.util.ArrayUtils._setLookup=function(key,value){var lookup=key===null||typeof key!=='object'?weavejs.util.ArrayUtils.map_primitive_lookup:weavejs.util.ArrayUtils.map_object_lookup;lookup.set(key,value)};
weavejs.util.ArrayUtils.union=function(arrays){arrays=Array.prototype.slice.call(arguments,0);var result=[];weavejs.util.ArrayUtils._lookupId++;var foreachiter0_target=arrays;for(var foreachiter0 in foreachiter0_target){var array=foreachiter0_target[foreachiter0];var foreachiter1_target=array;for(var foreachiter1 in foreachiter1_target){var item=foreachiter1_target[foreachiter1];if(weavejs.util.ArrayUtils._getLookup(item)!==weavejs.util.ArrayUtils._lookupId){weavejs.util.ArrayUtils._setLookup(item,
weavejs.util.ArrayUtils._lookupId);result.push(item)}}}return result};
weavejs.util.ArrayUtils.intersection=function(firstArray,secondArray,moreArrays){moreArrays=Array.prototype.slice.call(arguments,2);moreArrays.unshift(secondArray);var result=[];var item;var lastArray=moreArrays.pop();weavejs.util.ArrayUtils._lookupId++;var foreachiter2_target=lastArray;for(var foreachiter2 in foreachiter2_target){item=foreachiter2_target[foreachiter2];weavejs.util.ArrayUtils._setLookup(item,weavejs.util.ArrayUtils._lookupId)}var foreachiter3_target=moreArrays;for(var foreachiter3 in foreachiter3_target){var array=
foreachiter3_target[foreachiter3];var foreachiter4_target=array;for(var foreachiter4 in foreachiter4_target){item=foreachiter4_target[foreachiter4];if(weavejs.util.ArrayUtils._getLookup(item)===weavejs.util.ArrayUtils._lookupId)weavejs.util.ArrayUtils._setLookup(item,weavejs.util.ArrayUtils._lookupId+1)}weavejs.util.ArrayUtils._lookupId++}var foreachiter5_target=firstArray;for(var foreachiter5 in foreachiter5_target){item=foreachiter5_target[foreachiter5];if(weavejs.util.ArrayUtils._getLookup(item)===
weavejs.util.ArrayUtils._lookupId)result.push(item)}return result};
weavejs.util.ArrayUtils.subtract=function(array,itemsToRemove){var item;weavejs.util.ArrayUtils._lookupId++;var foreachiter6_target=itemsToRemove;for(var foreachiter6 in foreachiter6_target){item=foreachiter6_target[foreachiter6];weavejs.util.ArrayUtils._setLookup(item,weavejs.util.ArrayUtils._lookupId)}var result=[];var i=0;var foreachiter7_target=array;for(var foreachiter7 in foreachiter7_target){item=foreachiter7_target[foreachiter7];if(weavejs.util.ArrayUtils._getLookup(item)!==weavejs.util.ArrayUtils._lookupId)result[i++]=
item}return result};weavejs.util.ArrayUtils.copy=function(source,destination){destination=typeof destination!=='undefined'?destination:null;if(!destination)destination=[];destination.length=source.length;for(var i in source)destination[i]=source[i];return destination};weavejs.util.ArrayUtils.fillKeys=function(output,keys){var foreachiter8_target=keys;for(var foreachiter8 in foreachiter8_target){var key=foreachiter8_target[foreachiter8];output[key]=true}};
weavejs.util.ArrayUtils.isEmpty=function(object){for(var key in object)return false;return true};weavejs.util.ArrayUtils.removeDuplicatesFromSortedArray=function(sorted){var n=sorted.length;if(n==0)return;var write=0;var prev=sorted[0]===undefined?null:undefined;for(var read=0;read<n;++read){var item=sorted[read];if(item!==prev)sorted[write++]=prev=item}sorted.length=write};
weavejs.util.ArrayUtils.randomSort=function(array){var i=array.length;while(i){var j=Math.floor(Math.random()*i--);var temp=array[i];array[i]=array[j];array[j]=temp}};
weavejs.util.ArrayUtils.partition=function(list,firstIndex,lastIndex,pivotIndex,compareFunction){var temp;var pivotValue=list[pivotIndex];temp=list[pivotIndex];list[pivotIndex]=list[lastIndex];list[lastIndex]=temp;var storeIndex=firstIndex;for(var i=firstIndex;i<lastIndex;i++)if(compareFunction(list[i],pivotValue)<0){if(storeIndex!=i){temp=list[storeIndex];list[storeIndex]=list[i];list[i]=temp}storeIndex++}if(storeIndex!=lastIndex){temp=list[storeIndex];list[storeIndex]=list[lastIndex];list[lastIndex]=
temp}return storeIndex};weavejs.util.ArrayUtils.testPartition=function(){var list=[3,7,5,8,2];var pivotIndex=weavejs.util.ArrayUtils.partition(list,0,list.length-1,list.length/2,weavejs.util.StandardLib.compare);for(var i=0;i<list.length;i++)if(i<pivotIndex!=list[i]<list[pivotIndex])throw new Error('assertion fail');};
weavejs.util.ArrayUtils.getMedianIndex=function(list,compareFunction,firstIndex,lastIndex){firstIndex=typeof firstIndex!=='undefined'?firstIndex:0;lastIndex=typeof lastIndex!=='undefined'?lastIndex:-1;var left=firstIndex;var right=Number(lastIndex>=0?lastIndex:list.length-1);if(left>=right)return left;var medianIndex=org.apache.flex.utils.Language._int((left+right)/2);while(true){var pivotIndex=weavejs.util.ArrayUtils.partition(list,left,right,org.apache.flex.utils.Language._int((left+right)/2),compareFunction);
if(medianIndex==pivotIndex)break;if(medianIndex<pivotIndex)right=pivotIndex-1;else left=pivotIndex+1}return medianIndex};
weavejs.util.ArrayUtils.mergeSorted=function(sortedInputA,sortedInputB,mergedOutput,comparator){var indexA=0;var indexB=0;var indexOut=0;var lengthA=sortedInputA.length;var lengthB=sortedInputB.length;while(indexA<lengthA&&indexB<lengthB)if(comparator(sortedInputA[indexA],sortedInputB[indexB])<0)mergedOutput[indexOut++]=sortedInputA[indexA++];else mergedOutput[indexOut++]=sortedInputB[indexB++];while(indexA<lengthA)mergedOutput[indexOut++]=sortedInputA[indexA++];while(indexB<lengthB)mergedOutput[indexOut++]=
sortedInputB[indexB++];mergedOutput.length=indexOut};weavejs.util.ArrayUtils.flatten=function(source,destination){destination=typeof destination!=='undefined'?destination:null;if(destination==null)destination=[];if(source==null)return destination;for(var i=0;i<source.length;i++)if(org.apache.flex.utils.Language.is(source[i],Array))weavejs.util.ArrayUtils.flatten(source[i],destination);else destination.push(source[i]);return destination};
weavejs.util.ArrayUtils.flattenObject=function(input,output,prefix){output=typeof output!=='undefined'?output:null;prefix=typeof prefix!=='undefined'?prefix:'';if(output==null)output={};if(input==null)return output;for(var key in input)if(typeof input[key]=='object')weavejs.util.ArrayUtils.flattenObject(input[key],output,prefix+key+'.');else output[prefix+key]=input[key];return output};
weavejs.util.ArrayUtils.joinItems=function(arrayOfArrays,separator,includeEmptyItems){var maxLength=0;var itemList;var foreachiter9_target=arrayOfArrays;for(var foreachiter9 in foreachiter9_target){itemList=foreachiter9_target[foreachiter9];maxLength=Math.max(maxLength,itemList.length)}var result=[];for(var itemIndex=0;itemIndex<maxLength;itemIndex++){var joinedItem=[];for(var listIndex=0;listIndex<arrayOfArrays.length;listIndex++){itemList=org.apache.flex.utils.Language.as(arrayOfArrays[listIndex],
Array);var item='';if(itemList&&itemIndex<itemList.length)item=org.apache.flex.utils.Language.string(itemList[itemIndex]||'');if(item||includeEmptyItems)joinedItem.push(item)}result.push(joinedItem.join(separator))}return result};
weavejs.util.ArrayUtils.binarySearch=function(sortedUniqueValues,item,exactMatchOnly,compare){compare=typeof compare!=='undefined'?compare:null;var i=0,imin=0,imax=sortedUniqueValues.length-1;while(imin<=imax){i=org.apache.flex.utils.Language._int((imin+imax)/2);var a=sortedUniqueValues[i];var c=Number(compare!=null?compare(item,a):item<a?-1:item>a?1:0);if(c<0)imax=i-1;else if(c>0)imin=++i;else return i}return exactMatchOnly?-1:i};
weavejs.util.ArrayUtils.zipObject=function(keys,values){var n=Math.min(keys.length,values.length);var o={};for(var i=0;i<n;i++)o[keys[i]]=values[i];return o};
weavejs.util.ArrayUtils.getItems=function(object,keys,output){output=typeof output!=='undefined'?output:null;if(!output)output=org.apache.flex.utils.Language.is(object,Array)?[]:{};if(!object)return output;var keyIndex,keyValue,item;for(keyIndex in keys){keyValue=keys[keyIndex];item=object[keyValue];if(org.apache.flex.utils.Language.is(output,Array))output[keyIndex]=item;else output[keyValue]=item}if(org.apache.flex.utils.Language.is(output,Array))output.length=keys?keys.length:0;return output};
weavejs.util.ArrayUtils.compareProperties=function(object1,object2,propertyNames){var foreachiter10_target=propertyNames;for(var foreachiter10 in foreachiter10_target){var name=foreachiter10_target[foreachiter10];var result=weavejs.util.StandardLib.compare(object1[name],object2[name]);if(result)return result}return 0};
weavejs.util.ArrayUtils.removeByIndex=function(array,indices){var n=array.length;var skipList=weavejs.util.ArrayUtils.union(indices);var iSkip=0;var skip=Number(skipList[0]);var write=skip;for(var read=skip;read<n;++read)if(read==skip)skip=Number(skipList[++iSkip]);else array[write++]=array[read];array.length=write};weavejs.util.ArrayUtils.pluck=function(array,property){weavejs.util.ArrayUtils._pluckProperty=property;return array.map(weavejs.util.ArrayUtils._pluck)};weavejs.util.ArrayUtils._pluckProperty;
weavejs.util.ArrayUtils._pluck=function(item,i,a){return item!=null?item[weavejs.util.ArrayUtils._pluckProperty]:undefined};weavejs.util.ArrayUtils.transpose=function(table){var result=[];for(var iCol=0;iCol<table.length;iCol++){var col=table[iCol];for(var iRow=0;iRow<col.length;iRow++){var row=result[iRow]||(result[iRow]=[]);row[iCol]=col[iRow]}}return result};
weavejs.util.ArrayUtils.createLookup=function(array,propertyChain){propertyChain=Array.prototype.slice.call(arguments,1);var lookup=new weavejs.util.JS.Map;for(var key in array){var value=array[key];var foreachiter11_target=propertyChain;for(var foreachiter11 in foreachiter11_target){var prop=foreachiter11_target[foreachiter11];value=value[prop]}lookup.set(value,key)}return lookup};weavejs.util.ArrayUtils.prototype.FLEXJS_CLASS_INFO={names:[{name:'ArrayUtils',qName:'weavejs.util.ArrayUtils'}]};
goog.exportSymbol('weavejs.util.ArrayUtils',weavejs.util.ArrayUtils);weavejs.util.ArrayUtils.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.util.AsyncSort');goog.require('weavejs.api.core.ILinkableObject');weavejs.util.AsyncSort=function(){};weavejs.util.AsyncSort.debug=false;weavejs.util.AsyncSort._immediateSorter;
weavejs.util.AsyncSort.sortImmediately=function(array,compareFunction){compareFunction=typeof compareFunction!=='undefined'?compareFunction:null;if(!weavejs.util.AsyncSort._immediateSorter){weavejs.util.AsyncSort._immediateSorter=new weavejs.util.AsyncSort;weavejs.util.AsyncSort._immediateSorter._immediately=true}var sorter=weavejs.util.AsyncSort._immediateSorter;weavejs.util.AsyncSort._immediateSorter=null;sorter.beginSort(array,compareFunction);weavejs.util.AsyncSort._immediateSorter=sorter};
weavejs.util.AsyncSort.compareCaseInsensitive=function(a,b){return weavejs.util.StandardLib.stringCompare(a,b,true)};
weavejs.util.AsyncSort.primitiveCompare=function(a,b){if(a===b)return 0;if(a==null)return 1;if(b==null)return-1;var typeA=typeof a;var typeB=typeof b;if(typeA!=typeB)return weavejs.util.StandardLib.stringCompare(typeA,typeB);if(typeA=='boolean')return weavejs.util.StandardLib.numericCompare(Number(a),Number(b));if(typeA=='number')return weavejs.util.StandardLib.numericCompare(org.apache.flex.utils.Language.as(a,Number),org.apache.flex.utils.Language.as(b,Number));if(typeA=='string')return weavejs.util.StandardLib.stringCompare(org.apache.flex.utils.Language.as(a,
String),org.apache.flex.utils.Language.as(b,String));if(org.apache.flex.utils.Language.is(a,Date)&&org.apache.flex.utils.Language.is(b,Date))return weavejs.util.StandardLib.dateCompare(org.apache.flex.utils.Language.as(a,Date),org.apache.flex.utils.Language.as(b,Date));return 1};weavejs.util.AsyncSort.prototype.original;weavejs.util.AsyncSort.prototype.source;weavejs.util.AsyncSort.prototype.destination;weavejs.util.AsyncSort.prototype.compare;weavejs.util.AsyncSort.prototype.length;weavejs.util.AsyncSort.prototype.subArraySize;
weavejs.util.AsyncSort.prototype.middle;weavejs.util.AsyncSort.prototype.end;weavejs.util.AsyncSort.prototype.iLeft;weavejs.util.AsyncSort.prototype.iRight;weavejs.util.AsyncSort.prototype.iMerged;weavejs.util.AsyncSort.prototype.elapsed;weavejs.util.AsyncSort.prototype._immediately=false;
weavejs.util.AsyncSort.prototype.beginSort=function(arrayToSort,compareFunction){compareFunction=typeof compareFunction!=='undefined'?compareFunction:null;this.compare=compareFunction||weavejs.util.AsyncSort.primitiveCompare;this.original=arrayToSort||[];this.source=this.original;this.length=Number(this.original.length);var Type=org.apache.flex.utils.Language.as(this.source,Object).constructor;this.destination=new Type;this.destination.length=this.length;this.subArraySize=1;this.iLeft=0;this.iRight=
0;this.middle=0;this.end=0;this.elapsed=0;if(this._immediately){this.iterate(Number.MAX_VALUE);this.done()}else weavejs.WeaveAPI.Scheduler.startTask(this,org.apache.flex.utils.Language.closure(this.iterate,this,'iterate'),weavejs.WeaveAPI.TASK_PRIORITY_HIGH,org.apache.flex.utils.Language.closure(this.done,this,'done'),Weave.lang('Sorting {0} items',this.original.length))};
weavejs.util.AsyncSort.prototype.abort=function(){this.compare=null;this.source=this.original=this.destination=null;this.length=this.subArraySize=this.iLeft=this.iRight=this.middle=this.end=this.elapsed=0};
weavejs.util.AsyncSort.prototype.iterate=function(stopTime){var time=weavejs.util.JS.now();while(weavejs.util.JS.now()<stopTime)if(this.iLeft<this.middle)if(this.iRight<this.end&&this.compare(this.source[this.iRight],this.source[this.iLeft])<0)this.destination[this.iMerged++]=this.source[this.iRight++];else this.destination[this.iMerged++]=this.source[this.iLeft++];else if(this.iRight<this.end)this.destination[this.iMerged++]=this.source[this.iRight++];else if(this.end<this.length){var start=this.end;
this.middle=Math.min(start+this.subArraySize,this.length);this.end=Math.min(this.middle+this.subArraySize,this.length);this.iLeft=start;this.iRight=this.middle;this.iMerged=start}else{var merged=this.destination;this.destination=this.source;this.source=merged;this.end=0;this.subArraySize*=2;if(this.subArraySize>=this.length)break}this.elapsed+=weavejs.util.JS.now()-time;if(this.subArraySize>=this.length)return 1;return this.subArraySize/this.length};
weavejs.util.AsyncSort.prototype.done=function(){if(this.source!=this.original){var i=this.length;while(i--)this.original[i]=this.source[i]}this.source=null;this.destination=null;if(weavejs.util.AsyncSort.debug&&this.elapsed>0)weavejs.util.DebugUtils.debugTrace(this,this.result.length,'in',this.elapsed/1E3,'seconds');if(!this._immediately)Weave.getCallbacks(this).triggerCallbacks()};weavejs.util.AsyncSort._testArrays;weavejs.util.AsyncSort._testArraysSortOn;weavejs.util.AsyncSort._testType=-1;
weavejs.util.AsyncSort.initTestArrays=function(testType){if(testType!=weavejs.util.AsyncSort._testType){weavejs.util.AsyncSort._testType=testType;weavejs.util.AsyncSort._testArrays=[];weavejs.util.AsyncSort._testArraysSortOn=[];var foreachiter0_target=[0,1,2,3,4,5,50,3E3,6E3,12E3,25E3,5E4];for(var foreachiter0 in foreachiter0_target){var n=foreachiter0_target[foreachiter0];var array=[];var arraySortOn=[];for(var i=0;i<n;i++){var value;if(testType==0)value=org.apache.flex.utils.Language.uint(Math.random()*
100);else if(testType==1)value=Math.random()<.5?NaN:org.apache.flex.utils.Language.uint(Math.random()*100);else if(testType==2)value='a'+Math.random();array.push(value);arraySortOn.push({'value':value})}weavejs.util.AsyncSort._testArrays.push(array);weavejs.util.AsyncSort._testArraysSortOn.push(arraySortOn)}}var desc=org.apache.flex.utils.Language.string(['uint','uint and NaN','string'][testType]);org.apache.flex.utils.Language.trace('testType \x3d',testType,'('+desc+')')};
weavejs.util.AsyncSort.test=function(compare,testType){testType=typeof testType!=='undefined'?testType:0;weavejs.util.AsyncSort.initTestArrays(testType);weavejs.util.AsyncSort._debugCompareFunction=org.apache.flex.utils.Language.as(compare,Function);var foreachiter1_target=weavejs.util.AsyncSort._testArrays;for(var foreachiter1 in foreachiter1_target){var _array=foreachiter1_target[foreachiter1];var array1=_array.concat();var array2=_array.concat();var start=weavejs.util.JS.now();weavejs.util.AsyncSort._debugCompareCount=
0;if(compare===null)array1.sort(0);else if(org.apache.flex.utils.Language.is(compare,Function))array1.sort(weavejs.util.AsyncSort._debugCompareCounter);else array1.sort(compare);org.apache.flex.utils.Language.trace('Array.sort',array1.length,'numbers;',(weavejs.util.JS.now()-start)/1E3,'seconds;',weavejs.util.AsyncSort._debugCompareCount?weavejs.util.AsyncSort._debugCompareCount+' comparisons':'');start=weavejs.util.JS.now();weavejs.util.AsyncSort._debugCompareCount=0;weavejs.util.AsyncSort.sortImmediately(array2,
org.apache.flex.utils.Language.is(compare,Function)?weavejs.util.AsyncSort._debugCompareCounter:null);org.apache.flex.utils.Language.trace('Merge Sort',array2.length,'numbers;',(weavejs.util.JS.now()-start)/1E3,'seconds;',weavejs.util.AsyncSort._debugCompareCount?weavejs.util.AsyncSort._debugCompareCount+' comparisons':'');if(array2.length==1&&weavejs.util.StandardLib.compare(array1[0],array2[0])!=0)throw new Error('sort failed on array length 1');weavejs.util.AsyncSort.verifyNumbersSorted(array2)}};
weavejs.util.AsyncSort.testSortOn=function(compare,testType){testType=typeof testType!=='undefined'?testType:0;weavejs.util.AsyncSort.initTestArrays(testType);weavejs.util.AsyncSort._debugCompareFunction=weavejs.util.AsyncSort.newSortOnCompare('value',org.apache.flex.utils.Language.as(compare,Function)||weavejs.util.AsyncSort.primitiveCompare);var foreachiter2_target=weavejs.util.AsyncSort._testArraysSortOn;for(var foreachiter2 in foreachiter2_target){var _array=foreachiter2_target[foreachiter2];
var array1=_array.concat();var array2=_array.concat();var array3=_array.concat();var array4=_array.concat();var start;start=weavejs.util.JS.now();weavejs.util.AsyncSort._debugCompareCount=0;var plucked=new Array(_array.length);var i=_array.length;while(i--)plucked[i]=_array[i]['value'];if(compare===null)plucked.sort(0);else if(org.apache.flex.utils.Language.is(compare,Function))plucked.sort(weavejs.util.AsyncSort._debugCompareCounter);else plucked.sort(compare);org.apache.flex.utils.Language.trace('Pluck \x26 sort',
plucked.length,'numbers;',(weavejs.util.JS.now()-start)/1E3,'seconds;',weavejs.util.AsyncSort._debugCompareCount?weavejs.util.AsyncSort._debugCompareCount+' comparisons':'');start=weavejs.util.JS.now();weavejs.util.AsyncSort._debugCompareCount=0;weavejs.util.StandardLib.sortOn(array3,'value');org.apache.flex.utils.Language.trace('StdLib sortOn',array3.length,'numbers;',(weavejs.util.JS.now()-start)/1E3,'seconds;',weavejs.util.AsyncSort._debugCompareCount?weavejs.util.AsyncSort._debugCompareCount+
' comparisons':'');start=weavejs.util.JS.now();weavejs.util.AsyncSort._debugCompareCount=0;weavejs.util.StandardLib.sortOn(array4,['value']);org.apache.flex.utils.Language.trace('StdLib sortOn[]',array4.length,'numbers;',(weavejs.util.JS.now()-start)/1E3,'seconds;',weavejs.util.AsyncSort._debugCompareCount?weavejs.util.AsyncSort._debugCompareCount+' comparisons':'');start=weavejs.util.JS.now();weavejs.util.AsyncSort._debugCompareCount=0;weavejs.util.AsyncSort.sortImmediately(array2,weavejs.util.AsyncSort._debugCompareCounter);
org.apache.flex.utils.Language.trace('Merge SortOn',array2.length,'numbers;',(weavejs.util.JS.now()-start)/1E3,'seconds;',weavejs.util.AsyncSort._debugCompareCount?weavejs.util.AsyncSort._debugCompareCount+' comparisons':'');if(array2.length==1&&weavejs.util.StandardLib.compare(array1[0],array2[0])!=0)throw new Error('sort failed on array length 1');weavejs.util.AsyncSort.verifyNumbersSorted(array2)}};
weavejs.util.AsyncSort.newSortOnCompare=function(prop,compare){var __localFn0__=function(a,b){return compare(a[prop],b[prop])};return __localFn0__};weavejs.util.AsyncSort.verifyNumbersSorted=function(array){for(var i=1;i<array.length;i++)if(weavejs.util.StandardLib.numericCompare(array[i-1],array[i])>0)throw new Error('ASSERTION FAIL '+array[i-1]+' \x3e '+array[i]);};weavejs.util.AsyncSort._debugCompareCount=0;weavejs.util.AsyncSort._debugCompareFunction=null;
weavejs.util.AsyncSort._debugCompareCounter=function(a,b){weavejs.util.AsyncSort._debugCompareCount++;return weavejs.util.AsyncSort._debugCompareFunction(a,b)};Object.defineProperties(weavejs.util.AsyncSort.prototype,{result:{get:function(){return this.source?null:this.original}}});weavejs.util.AsyncSort.prototype.FLEXJS_CLASS_INFO={names:[{name:'AsyncSort',qName:'weavejs.util.AsyncSort'}],interfaces:[weavejs.api.core.ILinkableObject]};goog.exportSymbol('weavejs.util.AsyncSort',weavejs.util.AsyncSort);
weavejs.util.AsyncSort.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{'result':{type:'*',declaredBy:'weavejs.util.AsyncSort'}}},methods:function(){return{'beginSort':{type:'void',declaredBy:'weavejs.util.AsyncSort'},'abort':{type:'void',declaredBy:'weavejs.util.AsyncSort'}}}}};goog.provide('weavejs.util.ColorNode');weavejs.util.ColorNode=function(position,color){this.position=position;this.color=color};weavejs.util.ColorNode.prototype.position;weavejs.util.ColorNode.prototype.color;weavejs.util.ColorNode.prototype.FLEXJS_CLASS_INFO={names:[{name:'ColorNode',qName:'weavejs.util.ColorNode'}]};goog.exportSymbol('weavejs.util.ColorNode',weavejs.util.ColorNode);
weavejs.util.ColorNode.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'position':{type:'Number'},'color':{type:'Number'}}},accessors:function(){return{}},methods:function(){return{'ColorNode':{type:'',declaredBy:'weavejs.util.ColorNode'}}}}};goog.provide('weavejs.util.ColorRamp');goog.require('weavejs.core.LinkableVariable');goog.require('weavejs.util.ColorNode');weavejs.util.ColorRamp=function(sessionState){sessionState=typeof sessionState!=='undefined'?sessionState:null;this._colorNodes=[];weavejs.util.ColorRamp.base(this,'constructor',null,org.apache.flex.utils.Language.closure(this.verifyState,this,'verifyState'),sessionState||weavejs.util.ColorRamp.getColorRampByName('Blues').colors)};goog.inherits(weavejs.util.ColorRamp,weavejs.core.LinkableVariable);
weavejs.util.ColorRamp.COLOR='color';weavejs.util.ColorRamp.POSITION='position';
weavejs.util.ColorRamp.prototype.verifyState=function(state){if(org.apache.flex.utils.Language.is(state,String)){var reversed=false;var colors=weavejs.WeaveAPI.CSVParser.parseCSVRow(org.apache.flex.utils.Language.as(state,String));if(reversed)colors.reverse();this.setSessionState(colors);return false}var type=weavejs.util.StandardLib.getArrayType(org.apache.flex.utils.Language.as(state,Array));if(type==Number){var array=[];var foreachiter0_target=state;for(var foreachiter0 in foreachiter0_target){var number=
foreachiter0_target[foreachiter0];array.push('0x'+weavejs.util.StandardLib.numberToBase(number,16,6).toUpperCase())}this.setSessionState(array);return false}return type==String||type==Object||org.apache.flex.utils.Language.is(state,Array)&&!state.length};weavejs.util.ColorRamp.prototype._validateTriggerCount=0;
weavejs.util.ColorRamp.prototype.validate=function(){if(this._validateTriggerCount==this.triggerCounter)return;this._validateTriggerCount=this.triggerCounter;this._colorNodes=[];var foreachiter1_target=this.getSessionState();for(var foreachiter1 in foreachiter1_target){var item=foreachiter1_target[foreachiter1];if(typeof item=='object')this._colorNodes.push(new weavejs.util.ColorNode(item[weavejs.util.ColorRamp.POSITION],item[weavejs.util.ColorRamp.COLOR]));else this._colorNodes.push(new weavejs.util.ColorNode(this._colorNodes.length,
weavejs.util.StandardLib.asNumber(item)))}var positions=weavejs.util.ArrayUtils.pluck(this._colorNodes,weavejs.util.ColorRamp.POSITION);var minPos=Number(Math.min.apply(null,positions));var maxPos=Number(Math.max.apply(null,positions));var foreachiter2_target=this._colorNodes;for(var foreachiter2 in foreachiter2_target){var node=foreachiter2_target[foreachiter2];node.position=weavejs.util.StandardLib.normalize(node.position,minPos,maxPos)}weavejs.util.StandardLib.sortOn(this._colorNodes,'position')};
weavejs.util.ColorRamp.prototype.reverse=function(){var array=org.apache.flex.utils.Language.as(this.getSessionState(),Array);if(array)this.setSessionState(array.reverse())};weavejs.util.ColorRamp.prototype._colorNodes;weavejs.util.ColorRamp.prototype.getColors=function(){this.validate();var colors=[];for(var i=0;i<this._colorNodes.length;i++)colors.push(org.apache.flex.utils.Language.as(this._colorNodes[i],weavejs.util.ColorNode).color);return colors};
weavejs.util.ColorRamp.prototype.getHexColors=function(){var colors=this.getColors();for(var i=0;i<colors.length;i++)colors[i]=weavejs.util.StandardLib.getHexColor(colors[i]);return colors};
weavejs.util.ColorRamp.prototype.getColorFromNorm=function(normValue){this.validate();if(isNaN(normValue)||normValue<0||normValue>1||this._colorNodes.length==0)return NaN;var rightIndex=0;while(rightIndex<this._colorNodes.length&&normValue>=org.apache.flex.utils.Language.as(this._colorNodes[rightIndex],weavejs.util.ColorNode).position)rightIndex++;var leftIndex=Math.max(0,rightIndex-1);var leftNode=org.apache.flex.utils.Language.as(this._colorNodes[leftIndex],weavejs.util.ColorNode);var rightNode=
org.apache.flex.utils.Language.as(this._colorNodes[rightIndex],weavejs.util.ColorNode);if(rightIndex==0)return rightNode.color;if(rightIndex==this._colorNodes.length)return leftNode.color;var interpolationValue=(normValue-leftNode.position)/(rightNode.position-leftNode.position);return weavejs.util.StandardLib.interpolateColor(interpolationValue,leftNode.color,rightNode.color)};
weavejs.util.ColorRamp.prototype.getColor=function(value,min,max){min=typeof min!=='undefined'?min:0;max=typeof max!=='undefined'?max:1;var normValue=min==0&&max==1?value:weavejs.util.StandardLib.normalize(value,min,max);return this.getColorFromNorm(normValue)};
weavejs.util.ColorRamp.prototype.getHexColor=function(value,min,max){min=typeof min!=='undefined'?min:0;max=typeof max!=='undefined'?max:1;var normValue=min==0&&max==1?value:weavejs.util.StandardLib.normalize(value,min,max);var color=this.getColorFromNorm(normValue);if(!isFinite(color))return null;return'#'+weavejs.util.StandardLib.numberToBase(color,16,6)};
weavejs.util.ColorRamp.getColorRampByName=function(rampName){var foreachiter3_target=weavejs.util.ColorRamp.allColorRamps;for(var foreachiter3 in foreachiter3_target){var ramp=foreachiter3_target[foreachiter3];if(ramp.name===rampName)return ramp}return null};
weavejs.util.ColorRamp.findMatchingColorRamp=function(ramp){var colors=ramp.getColors();var foreachiter4_target=weavejs.util.ColorRamp.allColorRamps;for(var foreachiter4 in foreachiter4_target){var obj=foreachiter4_target[foreachiter4];if(weavejs.util.StandardLib.compare(obj.colors,colors)==0)return obj}return null};
weavejs.util.ColorRamp.allColorRamps=[{name:'Campfire',tags:'OIC,aesthetic',colors:[6684672,16711680,16776960]},{name:'Pink Rose',tags:'OIC,aesthetic',colors:[16762874,16384148,6684774]},{name:'Linear Gray',tags:'OIC,visualization,colorblind-safe,single-hue',colors:[0,16777215]},{name:'Blue Green Red',tags:'OIC,visualization',colors:[255,65280,16711680]},{name:'Red Scale',tags:'OIC,visualization,single-hue',colors:[0,16711680,16764108]},{name:'Blue To Cyan',tags:'OIC,visualization',colors:[0,47094,
771327,6881279,16777215]},{name:'Blue To Yellow',tags:'OIC,visualization',colors:[255,16776960]},{name:'Heated',tags:'OIC,visualization,single-hue',colors:[1245184,6362369,11692801,15765550,16497670,16711422]},{name:'MCH - Brown',tags:'OIC,visualization,single-hue',colors:[6362369,11692801,15765550,16497670]},{name:'Jet',tags:'OIC,visualization,qualitative',colors:[134,255,65535,16776960,16711680,8781824]},{name:'Linearized Optimal',tags:'OIC,visualization',colors:[0,8847360,8912384,8912895,16777215]},
{name:'Rainbow',tags:'OIC,visualization',colors:[0,4653143,1525135,6275142,10537036,16757646,16777215]},{name:'Traffic Light',tags:'OIC,basic',colors:[65280,16776960,16711680]},{name:'Arizona Skyline',tags:'OIC,aesthetic',colors:[5669817,16773281,14719259,12727808,5255168]},{name:'Watermelon',tags:'OIC,aesthetic',colors:[4086547,6402317,13421830,16748424,6488064]},{name:'Thunderstorm',tags:'OIC,aesthetic',colors:[5789236,4686261,7322367,16776960]},{name:'Old Leather',tags:'OIC,aesthetic',colors:[4211488,
7427342,9004849,14537216,6068154,6068154]},{name:'Autumn',tags:'OIC,aesthetic',colors:[1703936,7416576,16760712,16739072,16384E3]},{name:'Eggplant',tags:'OIC,aesthetic',colors:[262153,5111925,8257701,14853392,16777113]},{name:'Antique Flag',tags:'OIC,aesthetic',colors:[1133384,45047,14416367,11253865,16711680]},{name:'Agate',tags:'OIC,aesthetic',colors:[7228760,9542054,16768183,16677405,13303808]},{name:'Bee',tags:'OIC,aesthetic,single-hue',colors:[0,16776960]},{name:'Ornamental Cabbage',tags:'OIC,aesthetic',
colors:[4074084,6404114,12896075,13419931,11810682,11810682]},{name:'Neon',tags:'OIC,aesthetic',colors:[3360819,14113679,16711808,16776960,53504]},{name:'High Desert',tags:'OIC,aesthetic',colors:[11825222,7496042,13748168,16777215,10414]},{name:'Vermilion Cliffs',tags:'OIC,aesthetic',colors:[6558464,13837568,16741632,16763517,210,210]},{name:'Papaya',tags:'OIC,aesthetic',colors:[1055745,4163409,3697664,16621056,15663104]},{name:'Van Gogh',tags:'OIC,aesthetic',colors:[3227994,6331853,16776960,15315968,
12463616]},{name:'Outer Banks',tags:'OIC,aesthetic',colors:[6770488,14035456,16231680,16444091,38596]},{name:'Desert Sands',tags:'OIC,aesthetic',colors:[16311144,13548032,8481536,11884544,5513216,2367488]},{name:'Moonlight',tags:'OIC,aesthetic',colors:[263429,3552821,656680,13758692,14468096,14468096]},{name:'Twilight',tags:'OIC,aesthetic',colors:[3089697,13151486,16777215,15007488]},{name:'Rosebud',tags:'OIC,aesthetic',colors:[6904142,11382600,16707838,15925387,13434910]},{name:'Morning Glory',tags:'OIC,aesthetic',
colors:[5834323,16761343,16776960,6095103,3932377]},{name:'Cloudy Night',tags:'OIC,aesthetic',colors:[459793,6763438,16777215,16739840]},{name:'Vintage Map',tags:'OIC,aesthetic',colors:[16447974,16512626,16767391,11846482,9627082,16620971]},{name:'Doppler Radar',tags:'OIC,aesthetic,qualitative',colors:[322023,40436,131572,130049,50176,35840,16644097,16355840,16580608,12320768,16253181,9983174]},{name:'Bu Gn',tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[15595771,11723490,6734500,2925151,
27948]},{name:'Bu Pu',tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[15595771,11783651,9213638,8935079,8458108]},{name:'Gn Bu',tags:'ColorBrewer,basic,sequential,printer-friendly,colorblind-safe',colors:[15792616,12248252,8113348,4432586,551084]},{name:'Or Rd',tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[16707801,16632970,16551257,14895667,11730944]},{name:'Pu Bu',tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[15855350,12437985,7645647,2854078,285325]},{name:'Pu Bu Gn',
tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[16183287,12437985,6793679,1872025,93273]},{name:'Pu Rd',tags:'ColorBrewer,basic,sequential,printer-friendly,colorblind-safe',colors:[15855350,14136792,14640560,14490743,9961539]},{name:'Rd Pu',tags:'ColorBrewer,basic,sequential,printer-friendly,colorblind-safe',colors:[16706530,16495801,16214177,12917642,7995767]},{name:'Yl Gn',tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[16777164,12773017,7915129,3253076,26679]},{name:'Yl Gn Bu',
tags:'ColorBrewer,basic,sequential,printer-friendly,colorblind-safe',colors:[16777164,10607284,4306628,2916280,2438292]},{name:'Yl Or Br',tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[16777172,16701838,16685353,14245646,10040324]},{name:'Yl Or Rd',tags:'ColorBrewer,basic,sequential,colorblind-safe',colors:[16777138,16698460,16616764,15743776,12386342]},{name:'Blues',tags:'ColorBrewer,basic,sequential,single-hue,colorblind-safe',colors:[15725567,12441575,7057110,3244733,545180]},{name:'Greens',
tags:'ColorBrewer,basic,sequential,single-hue,colorblind-safe',colors:[15595753,12248243,7652470,3253076,27948]},{name:'Greys',tags:'ColorBrewer,basic,sequential,single-hue,colorblind-safe',colors:[16250871,13421772,9868950,6513507,2434341]},{name:'Oranges',tags:'ColorBrewer,basic,sequential,single-hue,colorblind-safe',colors:[16707038,16629381,16616764,15095053,10892803]},{name:'Purples',tags:'ColorBrewer,basic,sequential,single-hue,colorblind-safe',colors:[15921399,13355490,10394312,7695281,5515151]},
{name:'Reds',tags:'ColorBrewer,basic,sequential,single-hue,colorblind-safe',colors:[16704985,16559761,16476746,14560550,10817301]},{name:'Br BG',tags:'ColorBrewer,basic,diverging,colorblind-safe,printer-friendly',colors:[10903834,14664317,16119285,8441281,99697]},{name:'Pi YG',tags:'ColorBrewer,basic,diverging,colorblind-safe',colors:[13638795,15840986,16250871,12116358,5090342]},{name:'PR Gn',tags:'ColorBrewer,basic,diverging,colorblind-safe,printer-friendly',colors:[8073876,12756431,16250871,10935200,
34871]},{name:'Pu Or',tags:'ColorBrewer,basic,diverging,colorblind-safe',colors:[15098113,16627811,16250871,11709394,6175897]},{name:'Rd Bu',tags:'ColorBrewer,basic,diverging,colorblind-safe,printer-friendly',colors:[13238304,16033154,16250871,9618910,356784]},{name:'Rd Gy',tags:'ColorBrewer,basic,diverging,printer-friendly',colors:[13238304,16033154,16777215,12237498,4210752]},{name:'Rd Yl Bu',tags:'ColorBrewer,basic,diverging,colorblind-safe,printer-friendly',colors:[14096668,16625249,16777151,
11262441,2915254]},{name:'Rd Yl Gn',tags:'ColorBrewer,basic,diverging,printer-friendly',colors:[14096668,16625249,16777151,10934634,1742401]},{name:'Spectral',tags:'ColorBrewer,basic,diverging,printer-friendly,photocopy-friendly',colors:[14096668,16625249,16777151,11263396,2851770]},{name:'Accent',tags:'ColorBrewer,basic,qualitative',colors:[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]},{name:'Dark2',tags:'ColorBrewer,basic,qualitative,printer-friendly',colors:[1810039,14245634,
7696563,15149450,6727198,15117058,10909213,6710886]},{name:'Paired',tags:'ColorBrewer,basic,qualitative',colors:[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192]},{name:'Pastel 1',tags:'ColorBrewer,basic,qualitative',colors:[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652]},{name:'Pastel 2',tags:'ColorBrewer,basic,qualitative',colors:[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]},{name:'Set 1',tags:'ColorBrewer,basic,qualitative,printer-friendly',
colors:[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607]},{name:'Set 2',tags:'ColorBrewer,basic,qualitative',colors:[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]},{name:'Set 3',tags:'ColorBrewer,basic,qualitative,printer-friendly',colors:[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781]}];weavejs.util.ColorRamp.prototype.FLEXJS_CLASS_INFO={names:[{name:'ColorRamp',qName:'weavejs.util.ColorRamp'}]};
goog.exportSymbol('weavejs.util.ColorRamp',weavejs.util.ColorRamp);
weavejs.util.ColorRamp.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'ColorRamp':{type:'',declaredBy:'weavejs.util.ColorRamp'},'reverse':{type:'void',declaredBy:'weavejs.util.ColorRamp'},'getColors':{type:'Array',declaredBy:'weavejs.util.ColorRamp'},'getHexColors':{type:'Array',declaredBy:'weavejs.util.ColorRamp'},'getColorFromNorm':{type:'Number',declaredBy:'weavejs.util.ColorRamp'},'getColor':{type:'Number',
declaredBy:'weavejs.util.ColorRamp'},'getHexColor':{type:'String',declaredBy:'weavejs.util.ColorRamp'}}}}};goog.provide('weavejs.util.DateUtils');weavejs.util.DateUtils=function(){};weavejs.util.DateUtils.moment=weavejs.util.JS.global.moment;weavejs.util.DateUtils.parse=function(date,moment_fmt,force_utc,force_local){force_utc=typeof force_utc!=='undefined'?force_utc:false;force_local=typeof force_local!=='undefined'?force_local:false;if(moment_fmt)return weavejs.util.DateUtils.moment(date,moment_fmt,true).toDate();return weavejs.util.DateUtils.moment(date).toDate()};
weavejs.util.DateUtils.format=function(date,moment_fmt){return weavejs.util.DateUtils.moment(date).format(moment_fmt)};weavejs.util.DateUtils.formatDuration=function(date){return!isNaN(org.apache.flex.utils.Language.as(date,Number))?weavejs.util.DateUtils.moment.duration(date).humanize():''};
weavejs.util.DateUtils.detectFormats=function(dates,moment_formats){var validFormatsSparse=[].concat(moment_formats);var fmt;var foreachiter0_target=dates;for(var foreachiter0 in foreachiter0_target){var date=foreachiter0_target[foreachiter0];for(var fmtIdx in validFormatsSparse){fmt=org.apache.flex.utils.Language.string(validFormatsSparse[fmtIdx]);if(!fmt)continue;var m=new weavejs.util.DateUtils.moment(date,fmt,true);if(!m.isValid())validFormatsSparse[fmtIdx]=null}}var validFormats=[];var foreachiter1_target=
validFormatsSparse;for(var foreachiter1 in foreachiter1_target){fmt=foreachiter1_target[foreachiter1];if(fmt!==null)validFormats.push(fmt)}return validFormats};weavejs.util.DateUtils.prototype.FLEXJS_CLASS_INFO={names:[{name:'DateUtils',qName:'weavejs.util.DateUtils'}]};goog.exportSymbol('weavejs.util.DateUtils',weavejs.util.DateUtils);weavejs.util.DateUtils.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.util.StringView');
weavejs.util.StringView=function(vInput,sEncoding,nOffset,nLength){sEncoding=typeof sEncoding!=='undefined'?sEncoding:null;nOffset=typeof nOffset!=='undefined'?nOffset:NaN;nLength=typeof nLength!=='undefined'?nLength:NaN;var fTAView,aWhole,aRaw,fPutOutptCode,fGetOutptChrSize,nInptLen,nStartIdx=isFinite(nOffset)?nOffset:0,nTranscrType=15;var nChrCode,nChrIdx;if(sEncoding)this.encoding=sEncoding.toString();encSwitch:switch(this.encoding){case 'UTF-8':fPutOutptCode=weavejs.util.StringView.putUTF8CharCode;
fGetOutptChrSize=weavejs.util.StringView.getUTF8CharLength;fTAView=weavejs.util.StringView.Uint8Array;break encSwitch;case 'UTF-16':fPutOutptCode=weavejs.util.StringView.putUTF16CharCode;fGetOutptChrSize=weavejs.util.StringView.getUTF16CharLength;fTAView=weavejs.util.StringView.Uint16Array;break encSwitch;case 'UTF-32':fTAView=weavejs.util.StringView.Uint32Array;nTranscrType&=14;break encSwitch;default:fTAView=weavejs.util.StringView.Uint8Array;nTranscrType&=14}typeSwitch:switch(typeof vInput){case 'string':nTranscrType&=
7;break typeSwitch;case 'object':classSwitch:switch(vInput.constructor){case weavejs.util.StringView:nTranscrType&=3;break typeSwitch;case String:nTranscrType&=7;break typeSwitch;case weavejs.util.StringView.ArrayBuffer:aWhole=new fTAView(vInput);nInptLen=Number(this.encoding==='UTF-32'?vInput.byteLength>>>2:this.encoding==='UTF-16'?vInput.byteLength>>>1:vInput.byteLength);aRaw=nStartIdx===0&&(!isFinite(nLength)||nLength===nInptLen)?aWhole:new fTAView(vInput,nStartIdx,!isFinite(nLength)?nInptLen-
nStartIdx:nLength);break typeSwitch;case weavejs.util.StringView.Uint32Array:case weavejs.util.StringView.Uint16Array:case weavejs.util.StringView.Uint8Array:fTAView=vInput.constructor;nInptLen=Number(vInput.length);aWhole=vInput.byteOffset===0&&vInput.length===(fTAView===weavejs.util.StringView.Uint32Array?vInput.buffer.byteLength>>>2:fTAView===weavejs.util.StringView.Uint16Array?vInput.buffer.byteLength>>>1:vInput.buffer.byteLength)?vInput:new fTAView(vInput.buffer);aRaw=nStartIdx===0&&(!isFinite(nLength)||
nLength===nInptLen)?vInput:vInput.subarray(nStartIdx,isFinite(nLength)?nStartIdx+nLength:nInptLen);break typeSwitch;default:aWhole=new fTAView(vInput);nInptLen=aWhole.length;aRaw=nStartIdx===0&&(!isFinite(nLength)||nLength===nInptLen)?aWhole:aWhole.subarray(nStartIdx,isFinite(nLength)?nStartIdx+nLength:nInptLen)}break typeSwitch;default:aWhole=aRaw=new fTAView(Number(vInput)||0)}if(nTranscrType<8){var vSource,nOutptLen,nCharStart,nCharEnd,nEndIdx,fGetInptChrSize,fGetInptChrCode;if(nTranscrType&4){vSource=
vInput;nOutptLen=nInptLen=Number(vSource.length);nTranscrType^=this.encoding==='UTF-32'?0:2;nStartIdx=nCharStart=nOffset?Math.max((nOutptLen+nOffset)%nOutptLen,0):0;nEndIdx=nCharEnd=(weavejs.util.StringView.Number_isInteger(nLength)?Math.min(Math.max(nLength,0)+nStartIdx,nOutptLen):nOutptLen)-1}else{vSource=vInput.rawData;nInptLen=Number(vInput.makeIndex());nStartIdx=nCharStart=nOffset?Math.max((nInptLen+nOffset)%nInptLen,0):0;nOutptLen=weavejs.util.StringView.Number_isInteger(nLength)?Math.min(Math.max(nLength,
0),nInptLen-nCharStart):nInptLen;nEndIdx=nCharEnd=nOutptLen+nCharStart;if(vInput.encoding==='UTF-8'){fGetInptChrSize=weavejs.util.StringView.getUTF8CharLength;fGetInptChrCode=weavejs.util.StringView.loadUTF8CharCode}else if(vInput.encoding==='UTF-16'){fGetInptChrSize=weavejs.util.StringView.getUTF16CharLength;fGetInptChrCode=weavejs.util.StringView.loadUTF16CharCode}else nTranscrType&=1}if(nOutptLen===0||nTranscrType<4&&vSource.encoding===this.encoding&&nCharStart===0&&nOutptLen===nInptLen)nTranscrType=
7;conversionSwitch:switch(nTranscrType){case 0:aWhole=new fTAView(nOutptLen);for(var nOutptIdx=0;nOutptIdx<nOutptLen;aWhole[nOutptIdx]=vSource[nStartIdx+nOutptIdx++])break conversionSwitch;case 1:nOutptLen=0;for(var nInptIdx=nStartIdx;nInptIdx<nEndIdx;nInptIdx++)nOutptLen+=Number(fGetOutptChrSize(vSource[nInptIdx]));aWhole=new fTAView(nOutptLen);for(nInptIdx=nStartIdx,nOutptIdx=0;nOutptIdx<nOutptLen;nInptIdx++)nOutptIdx=Number(fPutOutptCode(aWhole,vSource[nInptIdx],nOutptIdx));break conversionSwitch;
case 2:nStartIdx=0;for(nChrIdx=0;nChrIdx<nCharStart;nChrIdx++){nChrCode=Number(fGetInptChrCode(vSource,nStartIdx));nStartIdx+=Number(fGetInptChrSize(nChrCode))}aWhole=new fTAView(nOutptLen);for(nInptIdx=nStartIdx,nOutptIdx=0;nOutptIdx<nOutptLen;nInptIdx+=Number(fGetInptChrSize(nChrCode)),nOutptIdx++){nChrCode=Number(fGetInptChrCode(vSource,nInptIdx));aWhole[nOutptIdx]=nChrCode}break conversionSwitch;case 3:nOutptLen=0;for(nChrIdx=0,nInptIdx=0;nChrIdx<nCharEnd;nInptIdx+=Number(fGetInptChrSize(nChrCode))){nChrCode=
Number(fGetInptChrCode(vSource,nInptIdx));if(nChrIdx===nCharStart)nStartIdx=nInptIdx;if(++nChrIdx>nCharStart)nOutptLen+=Number(fGetOutptChrSize(nChrCode))}aWhole=new fTAView(nOutptLen);for(nInptIdx=nStartIdx,nOutptIdx=0;nOutptIdx<nOutptLen;nInptIdx+=Number(fGetInptChrSize(nChrCode))){nChrCode=Number(fGetInptChrCode(vSource,nInptIdx));nOutptIdx=Number(fPutOutptCode(aWhole,nChrCode,nOutptIdx))}break conversionSwitch;case 4:aWhole=new fTAView(nOutptLen);for(var nIdx=0;nIdx<nOutptLen;nIdx++)aWhole[nIdx]=
vSource.charCodeAt(nIdx)&255;break conversionSwitch;case 5:nOutptLen=0;for(var nMapIdx=0;nMapIdx<nInptLen;nMapIdx++){if(nMapIdx===nCharStart)nStartIdx=nOutptLen;nOutptLen+=Number(fGetOutptChrSize(vSource.charCodeAt(nMapIdx)));if(nMapIdx===nCharEnd)nEndIdx=nOutptLen}aWhole=new fTAView(nOutptLen);for(nOutptIdx=0,nChrIdx=0;nOutptIdx<nOutptLen;nChrIdx++)nOutptIdx=Number(fPutOutptCode(aWhole,vSource.charCodeAt(nChrIdx),nOutptIdx));break conversionSwitch;case 6:aWhole=new fTAView(nOutptLen);for(nIdx=0;nIdx<
nOutptLen;nIdx++)aWhole[nIdx]=vSource.charCodeAt(nIdx);break conversionSwitch;case 7:aWhole=new fTAView(nOutptLen?vSource:0);break conversionSwitch}aRaw=nTranscrType>3&&(nStartIdx>0||nEndIdx<aWhole.length-1)?aWhole.subarray(nStartIdx,nEndIdx):aWhole}this.buffer=aWhole.buffer;this.bufferView=aWhole;this.rawData=aRaw};weavejs.util.StringView.ArrayBuffer=weavejs.util.JS.global.ArrayBuffer;weavejs.util.StringView.Uint32Array=weavejs.util.JS.global.Uint32Array;weavejs.util.StringView.Uint16Array=weavejs.util.JS.global.Uint16Array;
weavejs.util.StringView.Uint8Array=weavejs.util.JS.global.Uint8Array;weavejs.util.StringView.prototype.buffer;weavejs.util.StringView.prototype.bufferView;weavejs.util.StringView.prototype.rawData;weavejs.util.StringView.Number_isInteger=function(nVal){return typeof nVal==='number'&&isFinite(nVal)&&nVal>-9007199254740992&&nVal<9007199254740992&&Math.floor(nVal)===nVal};
weavejs.util.StringView.loadUTF8CharCode=function(aChars,nIdx){var nLen=aChars.length,nPart=Number(aChars[nIdx]);return nPart>251&&nPart<254&&nIdx+5<nLen?(nPart-252)*1073741824+(aChars[nIdx+1]-128<<24)+(aChars[nIdx+2]-128<<18)+(aChars[nIdx+3]-128<<12)+(aChars[nIdx+4]-128<<6)+aChars[nIdx+5]-128:nPart>247&&nPart<252&&nIdx+4<nLen?(nPart-248<<24)+(aChars[nIdx+1]-128<<18)+(aChars[nIdx+2]-128<<12)+(aChars[nIdx+3]-128<<6)+aChars[nIdx+4]-128:nPart>239&&nPart<248&&nIdx+3<nLen?(nPart-240<<18)+(aChars[nIdx+
1]-128<<12)+(aChars[nIdx+2]-128<<6)+aChars[nIdx+3]-128:nPart>223&&nPart<240&&nIdx+2<nLen?(nPart-224<<12)+(aChars[nIdx+1]-128<<6)+aChars[nIdx+2]-128:nPart>191&&nPart<224&&nIdx+1<nLen?(nPart-192<<6)+aChars[nIdx+1]-128:nPart};
weavejs.util.StringView.putUTF8CharCode=function(aTarget,nChar,nPutAt){var nIdx=nPutAt;if(nChar<128)aTarget[nIdx++]=nChar;else if(nChar<2048){aTarget[nIdx++]=192+(nChar>>>6);aTarget[nIdx++]=128+(nChar&63)}else if(nChar<65536){aTarget[nIdx++]=224+(nChar>>>12);aTarget[nIdx++]=128+(nChar>>>6&63);aTarget[nIdx++]=128+(nChar&63)}else if(nChar<2097152){aTarget[nIdx++]=240+(nChar>>>18);aTarget[nIdx++]=128+(nChar>>>12&63);aTarget[nIdx++]=128+(nChar>>>6&63);aTarget[nIdx++]=128+(nChar&63)}else if(nChar<67108864){aTarget[nIdx++]=
248+(nChar>>>24);aTarget[nIdx++]=128+(nChar>>>18&63);aTarget[nIdx++]=128+(nChar>>>12&63);aTarget[nIdx++]=128+(nChar>>>6&63);aTarget[nIdx++]=128+(nChar&63)}else{aTarget[nIdx++]=252+nChar/1073741824;aTarget[nIdx++]=128+(nChar>>>24&63);aTarget[nIdx++]=128+(nChar>>>18&63);aTarget[nIdx++]=128+(nChar>>>12&63);aTarget[nIdx++]=128+(nChar>>>6&63);aTarget[nIdx++]=128+(nChar&63)}return nIdx};
weavejs.util.StringView.getUTF8CharLength=function(nChar){return nChar<128?1:nChar<2048?2:nChar<65536?3:nChar<2097152?4:nChar<67108864?5:6};weavejs.util.StringView.loadUTF16CharCode=function(aChars,nIdx){var nFrstChr=Number(aChars[nIdx]);return nFrstChr>55231&&nIdx+1<aChars.length?(nFrstChr-55296<<10)+aChars[nIdx+1]+9216:nFrstChr};
weavejs.util.StringView.putUTF16CharCode=function(aTarget,nChar,nPutAt){var nIdx=nPutAt;if(nChar<65536)aTarget[nIdx++]=nChar;else{aTarget[nIdx++]=55232+(nChar>>>10);aTarget[nIdx++]=56320+(nChar&1023)}return nIdx};weavejs.util.StringView.getUTF16CharLength=function(nChar){return nChar<65536?1:2};weavejs.util.StringView.b64ToUint6=function(nChr){return nChr>64&&nChr<91?nChr-65:nChr>96&&nChr<123?nChr-71:nChr>47&&nChr<58?nChr+4:nChr===43?62:nChr===47?63:0};
weavejs.util.StringView.uint6ToB64=function(nUint6){return nUint6<26?nUint6+65:nUint6<52?nUint6+71:nUint6<62?nUint6-4:nUint6===62?43:nUint6===63?47:65};
weavejs.util.StringView.bytesToBase64=function(aBytes){var sB64Enc='';var nMod3,nLen=aBytes.length,nUint24=0,nIdx=0;for(;nIdx<nLen;nIdx++){nMod3=nIdx%3;if(nIdx>0&&nIdx*4/3%76===0)sB64Enc+='\r\n';nUint24|=aBytes[nIdx]<<(16>>>nMod3&24);if(nMod3===2||aBytes.length-nIdx===1){sB64Enc+=String.fromCharCode(weavejs.util.StringView.uint6ToB64(nUint24>>>18&63),weavejs.util.StringView.uint6ToB64(nUint24>>>12&63),weavejs.util.StringView.uint6ToB64(nUint24>>>6&63),weavejs.util.StringView.uint6ToB64(nUint24&63));
nUint24=0}}return sB64Enc.replace(/A(?=A$|$)/g,'\x3d')};
weavejs.util.StringView.base64ToBytes=function(sBase64,nBlockBytes){nBlockBytes=typeof nBlockBytes!=='undefined'?nBlockBytes:undefined;var sB64Enc=sBase64.replace(/[^A-Za-z0-9\+\/]/g,''),nInLen=sB64Enc.length,nOutLen=Number(nBlockBytes?Math.ceil((nInLen*3+1>>>2)/nBlockBytes)*nBlockBytes:nInLen*3+1>>>2),aBytes=new weavejs.util.StringView.Uint8Array(nOutLen);var nMod3,nMod4,nUint24=0,nOutIdx=0,nInIdx=0;for(;nInIdx<nInLen;nInIdx++){nMod4=nInIdx&3;nUint24|=weavejs.util.StringView.b64ToUint6(sB64Enc.charCodeAt(nInIdx))<<
18-6*nMod4;if(nMod4===3||nInLen-nInIdx===1){for(nMod3=0;nMod3<3&&nOutIdx<nOutLen;nMod3++,nOutIdx++)aBytes[nOutIdx]=nUint24>>>(16>>>nMod3&24)&255;nUint24=0}}return aBytes};weavejs.util.StringView.makeFromBase64=function(sB64Inpt,sEncoding,nByteOffset,nLength){return new weavejs.util.StringView(sEncoding==='UTF-16'||sEncoding==='UTF-32'?weavejs.util.StringView.base64ToBytes(sB64Inpt,sEncoding==='UTF-16'?2:4).buffer:weavejs.util.StringView.base64ToBytes(sB64Inpt),sEncoding,nByteOffset,nLength)};
weavejs.util.StringView.prototype.encoding='UTF-8';
weavejs.util.StringView.prototype.makeIndex=function(nChrLength,nStartFrom){nChrLength=typeof nChrLength!=='undefined'?nChrLength:undefined;nStartFrom=typeof nStartFrom!=='undefined'?nStartFrom:undefined;var aTarget=this.rawData,nChrEnd,nRawLength=aTarget.length,nStartIdx=nStartFrom||0,nIdxEnd=nStartIdx,nStopAtChr=isNaN(nChrLength)?Infinity:nChrLength;if(nChrLength+1>aTarget.length)throw new RangeError("public function makeIndex - The offset can't be major than the length of the array - 1.");switch(this.encoding){case 'UTF-8':var nPart;
for(nChrEnd=0;nIdxEnd<nRawLength&&nChrEnd<nStopAtChr;nChrEnd++){nPart=Number(aTarget[nIdxEnd]);nIdxEnd+=nPart>251&&nPart<254&&nIdxEnd+5<nRawLength?6:nPart>247&&nPart<252&&nIdxEnd+4<nRawLength?5:nPart>239&&nPart<248&&nIdxEnd+3<nRawLength?4:nPart>223&&nPart<240&&nIdxEnd+2<nRawLength?3:nPart>191&&nPart<224&&nIdxEnd+1<nRawLength?2:1}break;case 'UTF-16':for(nChrEnd=nStartIdx;nIdxEnd<nRawLength&&nChrEnd<nStopAtChr;nChrEnd++)nIdxEnd+=aTarget[nIdxEnd]>55231&&nIdxEnd+1<aTarget.length?2:1;break;default:nIdxEnd=
nChrEnd=isFinite(nChrLength)?nChrLength:nRawLength-1}if(nChrLength)return nIdxEnd;return nChrEnd};
weavejs.util.StringView.prototype.toBase64=function(bWholeBuffer){return weavejs.util.StringView.bytesToBase64(bWholeBuffer?this.bufferView.constructor===weavejs.util.StringView.Uint8Array?this.bufferView:new weavejs.util.StringView.Uint8Array(this.buffer):this.rawData.constructor===weavejs.util.StringView.Uint8Array?this.rawData:new weavejs.util.StringView.Uint8Array(this.buffer,this.rawData.byteOffset,this.rawData.length<<(this.rawData.constructor===weavejs.util.StringView.Uint16Array?1:2)))};
weavejs.util.StringView.prototype.subview=function(nCharOffset,nCharLength){var nChrLen,nCharStart,nStrLen,bVariableLen=this.encoding==='UTF-8'||this.encoding==='UTF-16',nStartOffset=nCharOffset,nStringLength,nRawLen=this.rawData.length;if(nRawLen===0)return new weavejs.util.StringView(this.buffer,this.encoding);nStringLength=bVariableLen?this.makeIndex():nRawLen;nCharStart=nCharOffset?Math.max((nStringLength+nCharOffset)%nStringLength,0):0;nStrLen=weavejs.util.StringView.Number_isInteger(nCharLength)?
Math.max(nCharLength,0)+nCharStart>nStringLength?nStringLength-nCharStart:nCharLength:nStringLength;if(nCharStart===0&&nStrLen===nStringLength)return this;if(bVariableLen){nStartOffset=this.makeIndex(nCharStart);nChrLen=this.makeIndex(nStrLen,nStartOffset)-nStartOffset}else{nStartOffset=nCharStart;nChrLen=nCharLength-nCharStart}if(this.encoding==='UTF-16')nStartOffset<<=1;else if(this.encoding==='UTF-32')nStartOffset<<=2;return new weavejs.util.StringView(this.buffer,this.encoding,nStartOffset,nChrLen)};
weavejs.util.StringView.prototype.forEachChar=function(fCallback,oThat,nChrOffset,nChrLen){var aSource=this.rawData,nRawEnd,nRawIdx;if(this.encoding==='UTF-8'||this.encoding==='UTF-16'){var fGetInptChrSize,fGetInptChrCode;if(this.encoding==='UTF-8'){fGetInptChrSize=weavejs.util.StringView.getUTF8CharLength;fGetInptChrCode=weavejs.util.StringView.loadUTF8CharCode}else if(this.encoding==='UTF-16'){fGetInptChrSize=weavejs.util.StringView.getUTF16CharLength;fGetInptChrCode=weavejs.util.StringView.loadUTF16CharCode}nRawIdx=
isFinite(nChrOffset)?this.makeIndex(nChrOffset):0;nRawEnd=Number(isFinite(nChrLen)?this.makeIndex(nChrLen,nRawIdx):aSource.length);var nChrCode,nChrIdx=0;for(;nRawIdx<nRawEnd;nChrIdx++){nChrCode=Number(fGetInptChrCode(aSource,nRawIdx));fCallback.call(oThat||null,nChrCode,nChrIdx,nRawIdx,aSource);nRawIdx+=Number(fGetInptChrSize(nChrCode))}}else{nRawIdx=isFinite(nChrOffset)?nChrOffset:0;nRawEnd=Number(isFinite(nChrLen)?nChrLen+nRawIdx:aSource.length);for(;nRawIdx<nRawEnd;nRawIdx++)fCallback.call(oThat||
null,aSource[nRawIdx],nRawIdx,nRawIdx,aSource)}};
weavejs.util.StringView.prototype.toString=function(){if(this.encoding!=='UTF-8'&&this.encoding!=='UTF-16')return String.fromCharCode.apply(null,this.rawData);var fGetCode,fGetIncr,sView='';if(this.encoding==='UTF-8'){fGetIncr=weavejs.util.StringView.getUTF8CharLength;fGetCode=weavejs.util.StringView.loadUTF8CharCode}else if(this.encoding==='UTF-16'){fGetIncr=weavejs.util.StringView.getUTF16CharLength;fGetCode=weavejs.util.StringView.loadUTF16CharCode}var nChr,nLen=this.rawData.length,nIdx=0;for(;nIdx<
nLen;nIdx+=Number(fGetIncr(nChr))){nChr=Number(fGetCode(this.rawData,nIdx));sView+=String.fromCharCode(nChr)}return sView};weavejs.util.StringView.prototype.FLEXJS_CLASS_INFO={names:[{name:'StringView',qName:'weavejs.util.StringView'}]};goog.exportSymbol('weavejs.util.StringView',weavejs.util.StringView);
weavejs.util.StringView.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'buffer':{type:'*'},'encoding':{type:'String'}}},accessors:function(){return{}},methods:function(){return{'StringView':{type:'',declaredBy:'weavejs.util.StringView'},'makeIndex':{type:'Number',declaredBy:'weavejs.util.StringView'},'toBase64':{type:'String',declaredBy:'weavejs.util.StringView'},'subview':{type:'StringView',declaredBy:'weavejs.util.StringView'},'forEachChar':{type:'void',declaredBy:'weavejs.util.StringView'},
'toString':{type:'String',declaredBy:'weavejs.util.StringView'}}}}};goog.provide('weavejs.util.JSByteArray');goog.require('weavejs.util.StringView');
weavejs.util.JSByteArray=function(data,littleEndian){littleEndian=typeof littleEndian!=='undefined'?littleEndian:false;this.objectEncoding=this.ENCODING_AMF3;this.stringTable=[];this.objectTable=[];this.traitTable=[];var data_any=org.apache.flex.utils.Language.as(data,weavejs.util.JS.Uint8Array)||new weavejs.util.JS.Uint8Array(data);this.data=data_any;this.dataView=new weavejs.util.JS.DataView(this.data.buffer,this.data.byteOffset,this.data.length);this.littleEndian=littleEndian;this.length=this.data.length;
this.stringTable=[];this.objectTable=[];this.traitTable=[]};weavejs.util.JSByteArray.prototype.ENCODING_AMF0=0;weavejs.util.JSByteArray.prototype.ENCODING_AMF3=3;weavejs.util.JSByteArray.prototype.AMF0_Number=0;weavejs.util.JSByteArray.prototype.AMF0_Boolean=1;weavejs.util.JSByteArray.prototype.AMF0_String=2;weavejs.util.JSByteArray.prototype.AMF0_Object=3;weavejs.util.JSByteArray.prototype.AMF0_MovieClip=4;weavejs.util.JSByteArray.prototype.AMF0_Null=5;
weavejs.util.JSByteArray.prototype.AMF0_Undefined=6;weavejs.util.JSByteArray.prototype.AMF0_Reference=7;weavejs.util.JSByteArray.prototype.AMF0_ECMAArray=8;weavejs.util.JSByteArray.prototype.AMF0_ObjectEnd=9;weavejs.util.JSByteArray.prototype.AMF0_StrictArray=10;weavejs.util.JSByteArray.prototype.AMF0_Date=11;weavejs.util.JSByteArray.prototype.AMF0_LongString=12;weavejs.util.JSByteArray.prototype.AMF0_Unsupported=13;weavejs.util.JSByteArray.prototype.AMF0_Recordset=14;
weavejs.util.JSByteArray.prototype.AMF0_XMLObject=15;weavejs.util.JSByteArray.prototype.AMF0_TypedObject=16;weavejs.util.JSByteArray.prototype.AMF0_AvmPlusObject=17;weavejs.util.JSByteArray.prototype.AMF3_Undefined=0;weavejs.util.JSByteArray.prototype.AMF3_Null=1;weavejs.util.JSByteArray.prototype.AMF3_False=2;weavejs.util.JSByteArray.prototype.AMF3_True=3;weavejs.util.JSByteArray.prototype.AMF3_Integer=4;weavejs.util.JSByteArray.prototype.AMF3_Double=5;
weavejs.util.JSByteArray.prototype.AMF3_String=6;weavejs.util.JSByteArray.prototype.AMF3_XML=7;weavejs.util.JSByteArray.prototype.AMF3_Date=8;weavejs.util.JSByteArray.prototype.AMF3_Array=9;weavejs.util.JSByteArray.prototype.AMF3_Object=10;weavejs.util.JSByteArray.prototype.AMF3_AvmPlusXml=11;weavejs.util.JSByteArray.prototype.AMF3_ByteArray=12;weavejs.util.JSByteArray.prototype.data;weavejs.util.JSByteArray.prototype.dataView;weavejs.util.JSByteArray.prototype.length=0;
weavejs.util.JSByteArray.prototype.position=0;weavejs.util.JSByteArray.prototype.littleEndian=false;weavejs.util.JSByteArray.prototype.objectEncoding;weavejs.util.JSByteArray.prototype.stringTable;weavejs.util.JSByteArray.prototype.objectTable;weavejs.util.JSByteArray.prototype.traitTable;weavejs.util.JSByteArray.prototype.readByte=function(){return this.data[this.position++]};weavejs.util.JSByteArray.prototype.readUnsignedByte=function(){return this.data[this.position++]&255};
weavejs.util.JSByteArray.prototype.readBoolean=function(){return this.data[this.position++]&255?true:false};weavejs.util.JSByteArray.prototype.readUInt30=function(){if(this.littleEndian)return this.readUInt30LE();var ch1=this.data[this.position++]&255;var ch2=this.data[this.position++]&255;var ch3=this.data[this.position++]&255;var ch4=this.data[this.position++]&255;if(ch1>=64)return undefined;return ch4|ch3<<8|ch2<<16|ch1<<24};
weavejs.util.JSByteArray.prototype.readUnsignedInt=function(){var value=Number(this.dataView.getUint32(this.position,this.littleEndian));this.position+=4;return value};weavejs.util.JSByteArray.prototype.readInt=function(){var value=Number(this.dataView.getInt32(this.position,this.littleEndian));this.position+=4;return value};weavejs.util.JSByteArray.prototype.readUnsignedShort=function(){var value=Number(this.dataView.getUint16(this.position,this.littleEndian));this.position+=2;return value};
weavejs.util.JSByteArray.prototype.readShort=function(){var value=Number(this.dataView.getInt16(this.position,this.littleEndian));this.position+=2;return value};weavejs.util.JSByteArray.prototype.readFloat=function(){var value=Number(this.dataView.getFloat32(this.position,this.littleEndian));this.position+=4;return value};weavejs.util.JSByteArray.prototype.readDouble=function(){var value=Number(this.dataView.getFloat64(this.position,this.littleEndian));this.position+=8;return value};
weavejs.util.JSByteArray.prototype.readUInt29=function(){var value;var b=this.data[this.position++]&255;if(b<128)return b;value=(b&127)<<7;b=this.data[this.position++]&255;if(b<128)return value|b;value=(value|b&127)<<7;b=this.data[this.position++]&255;if(b<128)return value|b;value=(value|b&127)<<8;b=this.data[this.position++]&255;return value|b};
weavejs.util.JSByteArray.prototype.readUInt30LE=function(){var ch1=this.data[this.position++]&255;var ch2=this.data[this.position++]&255;var ch3=this.data[this.position++]&255;var ch4=this.data[this.position++]&255;if(ch4>=64)return undefined;return ch1|ch2<<8|ch3<<16|ch4<<24};weavejs.util.JSByteArray.prototype.readDate=function(){var time_ms=this.readDouble();var tz_min=this.readUnsignedShort();return new Date(time_ms+tz_min*60*1E3)};
weavejs.util.JSByteArray.prototype.readUTFBytes=function(len){var str=(new weavejs.util.StringView(this.data,'UTF-8',this.position,len)).toString();this.position+=len;return str};weavejs.util.JSByteArray.prototype.readUTF=function(){return this.readUTFBytes(this.readUnsignedShort())};weavejs.util.JSByteArray.prototype.readLongUTF=function(){return this.readUTFBytes(this.readUInt30())};
weavejs.util.JSByteArray.prototype.stringToXML=function(str){var xmlDoc;if(weavejs.util.JS.global.DOMParser){var parser=new weavejs.util.JS.global.DOMParser;xmlDoc=parser.parseFromString(str,'text/xml')}else{xmlDoc=new weavejs.util.JS.global.ActiveXObject('Microsoft.XMLDOM');xmlDoc.async=false;xmlDoc.loadXML(str)}return xmlDoc};weavejs.util.JSByteArray.prototype.readXML=function(){var xml=this.readLongUTF();return this.stringToXML(xml)};
weavejs.util.JSByteArray.prototype.readStringAMF3=function(){var ref=this.readUInt29();if((ref&1)==0)return this.stringTable[ref>>1];var len=ref>>1;if(0==len)return'';var str=this.readUTFBytes(len);this.stringTable.push(str);return str};
weavejs.util.JSByteArray.prototype.readTraits=function(ref){var traitInfo={};traitInfo.properties=[];if((ref&3)==1)return this.traitTable[ref>>2];traitInfo.externalizable=(ref&4)==4;traitInfo.dynamic=(ref&8)==8;traitInfo.count=ref>>4;traitInfo.className=this.readStringAMF3();this.traitTable.push(traitInfo);for(var i=0;i<traitInfo.count;i++){var propName=this.readStringAMF3();traitInfo.properties.push(propName)}return traitInfo};weavejs.util.JSByteArray.prototype.readExternalizable=function(className){return this.readObject()};
weavejs.util.JSByteArray.prototype.readObject=function(){if(this.objectEncoding==this.ENCODING_AMF0)return this.readAMF0Object();else if(this.objectEncoding==this.ENCODING_AMF3)return this.readAMF3Object();return undefined};
weavejs.util.JSByteArray.prototype.readAMF0Object=function(){var marker=this.data[this.position++]&255;var value,o;if(marker==this.AMF0_Number)return this.readDouble();else if(marker==this.AMF0_Boolean)return this.readBoolean();else if(marker==this.AMF0_String)return this.readUTF();else if(marker==this.AMF0_Object||marker==this.AMF0_ECMAArray){o={};var ismixed=marker==this.AMF0_ECMAArray;if(ismixed)this.readUInt30();while(true){var c1=this.data[this.position++]&255;var c2=this.data[this.position++]&
255;var name=this.readUTFBytes(c1<<8|c2);var k=this.data[this.position++]&255;if(k==this.AMF0_ObjectEnd)break;this.position--;o[name]=this.readObject()}return o}else if(marker==this.AMF0_StrictArray){var size=this.readInt();var a=[];for(var i=0;i<size;++i)a.push(this.readObject());return a}else if(marker==this.AMF0_TypedObject){o={};var typeName=this.readUTF();var propertyName=this.readUTF();var type=this.data[this.position++]&255;while(type!=this.AMF0_ObjectEnd){value=this.readObject();o[propertyName]=
value;propertyName=this.readUTF();type=this.data[this.position++]&255}return o}else if(marker==this.AMF0_AvmPlusObject)return this.readAMF3Object();else if(marker==this.AMF0_Null)return null;else if(marker==this.AMF0_Undefined)return undefined;else if(marker==this.AMF0_Reference){var refNum=this.readUnsignedShort();value=this.objectTable[refNum];return value}else if(marker==this.AMF0_Date)return this.readDate();else if(marker==this.AMF0_LongString)return this.readLongUTF();else if(marker==this.AMF0_XMLObject)return this.readXML();
return undefined};
weavejs.util.JSByteArray.prototype.readAMF3Object=function(){var marker=this.data[this.position++]&255;var ref,len,i,value;if(marker==this.AMF3_Undefined)return undefined;else if(marker==this.AMF3_Null)return null;else if(marker==this.AMF3_False)return false;else if(marker==this.AMF3_True)return true;else if(marker==this.AMF3_Integer){var int29=this.readUInt29();if(int29>=268435456)int29-=536870912;return int29}else if(marker==this.AMF3_Double)return this.readDouble();else if(marker==this.AMF3_String)return this.readStringAMF3();
else if(marker==this.AMF3_XML)return this.readXML();else if(marker==this.AMF3_Date){ref=this.readUInt29();if((ref&1)==0)return this.objectTable[ref>>1];var d=this.readDouble();value=new Date(d);this.objectTable.push(value);return value}else if(marker==this.AMF3_Array){ref=this.readUInt29();if((ref&1)==0)return this.objectTable[ref>>1];len=ref>>1;var key=this.readStringAMF3();if(key==''){var a=[];for(i=0;i<len;i++){value=this.readObject();a.push(value)}return a}var result={};while(key!=''){result[key]=
this.readObject();key=this.readStringAMF3()}for(i=0;i<len;i++)result[i]=this.readObject();return result}else if(marker==this.AMF3_Object){var o={};this.objectTable.push(o);ref=this.readUInt29();if((ref&1)==0)return this.objectTable[ref>>1];var ti=this.readTraits(ref);var className=org.apache.flex.utils.Language.string(ti.className);var externalizable=ti.externalizable;if(externalizable)o=this.readExternalizable(className);else{len=Number(ti.properties.length);for(i=0;i<len;i++){var propName=org.apache.flex.utils.Language.string(ti.properties[i]);
value=this.readObject();o[propName]=value}if(ti.dynamic)for(;;){var name=this.readStringAMF3();if(name==null||name.length==0)break;value=this.readObject();o[name]=value}}return o}else if(marker==this.AMF3_AvmPlusXml){ref=this.readUInt29();if((ref&1)==0)return this.stringToXML(this.objectTable[ref>>1]);len=ref>>1;if(0==len)return null;var str=this.readUTFBytes(len);var xml=this.stringToXML(str);this.objectTable.push(xml);return xml}else if(marker==this.AMF3_ByteArray){ref=this.readUInt29();if((ref&
1)==0)return this.objectTable[ref>>1];len=ref>>1;var ba=new weavejs.util.JSByteArray(this.data.subarray(this.position,this.position+=len));this.objectTable.push(ba);return ba}return undefined};weavejs.util.JSByteArray.prototype.FLEXJS_CLASS_INFO={names:[{name:'JSByteArray',qName:'weavejs.util.JSByteArray'}]};goog.exportSymbol('weavejs.util.JSByteArray',weavejs.util.JSByteArray);
weavejs.util.JSByteArray.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'ENCODING_AMF0':{type:'int'},'ENCODING_AMF3':{type:'int'},'data':{type:'Array'},'dataView':{type:'Object'},'length':{type:'int'},'position':{type:'int'},'littleEndian':{type:'Boolean'},'objectEncoding':{type:'int'},'stringTable':{type:'Array'},'objectTable':{type:'Array'},'traitTable':{type:'Array'}}},accessors:function(){return{}},methods:function(){return{'JSByteArray':{type:'',declaredBy:'weavejs.util.JSByteArray'},
'readByte':{type:'int',declaredBy:'weavejs.util.JSByteArray'},'readUnsignedByte':{type:'int',declaredBy:'weavejs.util.JSByteArray'},'readBoolean':{type:'Boolean',declaredBy:'weavejs.util.JSByteArray'},'readUnsignedInt':{type:'int',declaredBy:'weavejs.util.JSByteArray'},'readInt':{type:'int',declaredBy:'weavejs.util.JSByteArray'},'readUnsignedShort':{type:'int',declaredBy:'weavejs.util.JSByteArray'},'readShort':{type:'int',declaredBy:'weavejs.util.JSByteArray'},'readFloat':{type:'Number',declaredBy:'weavejs.util.JSByteArray'},
'readDouble':{type:'Number',declaredBy:'weavejs.util.JSByteArray'},'readUTFBytes':{type:'String',declaredBy:'weavejs.util.JSByteArray'},'readUTF':{type:'String',declaredBy:'weavejs.util.JSByteArray'},'readLongUTF':{type:'String',declaredBy:'weavejs.util.JSByteArray'},'readXML':{type:'Object',declaredBy:'weavejs.util.JSByteArray'},'readObject':{type:'Object',declaredBy:'weavejs.util.JSByteArray'}}}}};goog.provide('weavejs.util.WeaveMenuItem');goog.require('weavejs.util.WeaveTreeItem');weavejs.util.WeaveMenuItem=function(params){this.childItemClass=weavejs.util.WeaveMenuItem;if(params==weavejs.util.WeaveMenuItem.TYPE_SEPARATOR){this.type=weavejs.util.WeaveMenuItem.TYPE_SEPARATOR;params=null}weavejs.util.WeaveMenuItem.base(this,'constructor',params)};goog.inherits(weavejs.util.WeaveMenuItem,weavejs.util.WeaveTreeItem);
weavejs.util.WeaveMenuItem.createMenuItems=function(items){var flattened=[];var foreachiter0_target=items;for(var foreachiter0 in foreachiter0_target){var param=foreachiter0_target[foreachiter0];if(org.apache.flex.utils.Language.is(param,Array)){var groupedItems=weavejs.util.WeaveTreeItem.createItems(weavejs.util.WeaveMenuItem,org.apache.flex.utils.Language.as(param,Array));weavejs.util.WeaveMenuItem._pushSeparator(flattened);flattened.push.apply(flattened,groupedItems);weavejs.util.WeaveMenuItem._pushSeparator(flattened)}else flattened.push(param)}weavejs.util.WeaveMenuItem._pushSeparator(flattened);
flattened.pop();return weavejs.util.WeaveTreeItem.createItems(weavejs.util.WeaveMenuItem,flattened)};weavejs.util.WeaveMenuItem._pushSeparator=function(output){if(!output.length)return;var last=output[output.length-1];if(last==weavejs.util.WeaveMenuItem.TYPE_SEPARATOR)return;if(org.apache.flex.utils.Language.is(last,weavejs.util.WeaveMenuItem)&&org.apache.flex.utils.Language.as(last,weavejs.util.WeaveMenuItem).type==weavejs.util.WeaveMenuItem.TYPE_SEPARATOR)return;output.push(weavejs.util.WeaveMenuItem.TYPE_SEPARATOR)};
weavejs.util.WeaveMenuItem.TYPE_SEPARATOR='separator';weavejs.util.WeaveMenuItem.TYPE_CHECK='check';weavejs.util.WeaveMenuItem.TYPE_RADIO='radio';weavejs.util.WeaveMenuItem.prototype.click=null;weavejs.util.WeaveMenuItem.prototype.type=null;weavejs.util.WeaveMenuItem.prototype.groupName=null;weavejs.util.WeaveMenuItem.prototype._enabled=true;weavejs.util.WeaveMenuItem.prototype._shown=true;weavejs.util.WeaveMenuItem.prototype._toggled=false;
weavejs.util.WeaveMenuItem.prototype._filterShown=function(item,index,array){return item.shown};weavejs.util.WeaveMenuItem.prototype.runClickFunction=function(){if(org.apache.flex.utils.Language.is(this.click,Function))this.evalFunction(org.apache.flex.utils.Language.as(this.click,Function));var lv=org.apache.flex.utils.Language.as(this.click,weavejs.api.core.ILinkableVariable);if(lv&&lv!=this._toggled)lv.setSessionState(!lv.getSessionState())};
Object.defineProperties(weavejs.util.WeaveMenuItem.prototype,{label:{get:function(){return org.apache.flex.utils.Language.superGetter(weavejs.util.WeaveMenuItem,this,'label')||' '},set:function(value){org.apache.flex.utils.Language.superSetter(weavejs.util.WeaveMenuItem,this,'label',value)}},toggled:{get:function(){return this.getBoolean(this._toggled,'toggled')},set:function(value){if(org.apache.flex.utils.Language.is(value,Boolean)){if(org.apache.flex.utils.Language.is(this._toggled,weavejs.api.core.ILinkableVariable)){org.apache.flex.utils.Language.as(this._toggled,
weavejs.api.core.ILinkableVariable).setSessionState(value);return}if(org.apache.flex.utils.Language.is(this._toggled,Function))return}this._toggled=value}},enabled:{get:function(){return this.getBoolean(this._enabled,'enabled')},set:function(value){this._enabled=value}},shown:{get:function(){return this.getBoolean(this._shown,'shown')},set:function(value){this._shown=value}},children:{get:function(){var items=org.apache.flex.utils.Language.as(org.apache.flex.utils.Language.superGetter(weavejs.util.WeaveMenuItem,
this,'children'),Array);if(!items)return null;items=items.filter(org.apache.flex.utils.Language.closure(this._filterShown,this,'_filterShown'));while(items.length&&org.apache.flex.utils.Language.as(items[0],weavejs.util.WeaveMenuItem,true).type==weavejs.util.WeaveMenuItem.TYPE_SEPARATOR)items.shift();while(items.length&&org.apache.flex.utils.Language.as(items[items.length-1],weavejs.util.WeaveMenuItem,true).type==weavejs.util.WeaveMenuItem.TYPE_SEPARATOR)items.pop();for(var i=items.length-1;i>1;i--)if(org.apache.flex.utils.Language.as(items[i],
weavejs.util.WeaveMenuItem,true).type==weavejs.util.WeaveMenuItem.TYPE_SEPARATOR&&org.apache.flex.utils.Language.as(items[i-1],weavejs.util.WeaveMenuItem,true).type==weavejs.util.WeaveMenuItem.TYPE_SEPARATOR)items.splice(i,1);return items},set:function(value){org.apache.flex.utils.Language.superSetter(weavejs.util.WeaveMenuItem,this,'children',value)}}});weavejs.util.WeaveMenuItem.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeaveMenuItem',qName:'weavejs.util.WeaveMenuItem'}]};
goog.exportSymbol('weavejs.util.WeaveMenuItem',weavejs.util.WeaveMenuItem);
weavejs.util.WeaveMenuItem.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'click':{type:'*'},'type':{type:'String'},'groupName':{type:'String'}}},accessors:function(){return{'label':{type:'*',declaredBy:'weavejs.util.WeaveMenuItem'},'toggled':{type:'*',declaredBy:'weavejs.util.WeaveMenuItem'},'enabled':{type:'*',declaredBy:'weavejs.util.WeaveMenuItem'},'shown':{type:'*',declaredBy:'weavejs.util.WeaveMenuItem'},'children':{type:'*',declaredBy:'weavejs.util.WeaveMenuItem'}}},
methods:function(){return{'WeaveMenuItem':{type:'',declaredBy:'weavejs.util.WeaveMenuItem'},'runClickFunction':{type:'void',declaredBy:'weavejs.util.WeaveMenuItem'}}}}};goog.provide('WeaveTest');goog.require('weavejs.core.EventCallbackCollection');goog.require('weavejs.core.LinkableCallbackScript');goog.require('weavejs.core.LinkableDynamicObject');goog.require('weavejs.core.LinkableFunction');goog.require('weavejs.core.LinkableHashMap');goog.require('weavejs.core.LinkableNumber');goog.require('weavejs.core.LinkablePromise');goog.require('weavejs.util.ArrayUtils');goog.require('weavejs.util.AsyncSort');goog.require('weavejs.util.ColorRamp');goog.require('weavejs.util.DateUtils');
goog.require('weavejs.util.JSByteArray');goog.require('weavejs.util.WeaveMenuItem');WeaveTest=function(){};
WeaveTest.dependencies=[weavejs.api.core.ILinkableVariable,weavejs.core.LinkableNumber,weavejs.core.LinkableString,weavejs.core.LinkableBoolean,weavejs.core.LinkableVariable,weavejs.core.LinkableHashMap,weavejs.core.LinkableDynamicObject,weavejs.core.LinkableWatcher,weavejs.core.LinkableCallbackScript,weavejs.core.LinkableFunction,weavejs.util.WeaveMenuItem,weavejs.core.EventCallbackCollection,weavejs.util.ColorRamp,weavejs.core.LinkablePromise,weavejs.util.JSByteArray,weavejs.util.AsyncSort,weavejs.util.ArrayUtils,
weavejs.util.StandardLib,weavejs.util.DateUtils,weavejs.core.CallbackCollection,null];
WeaveTest.test=function(weave){var __localFn0__=function(){weavejs.util.JS.log('immediate',lv.state)};var __localFn1__=function(){weavejs.util.JS.log('grouped',lv.state)};var __localFn2__=function(){weavejs.util.JS.log(this+'',this.getState())};var __localFn3__=function(){weavejs.util.JS.log(this.weave.path('ls2').getState())};var __localFn4__=function(){weavejs.util.JS.log('column',this.getMetadata('title'));var foreachiter0_target=this.keys;for(var foreachiter0 in foreachiter0_target){var key=foreachiter0_target[foreachiter0];
weavejs.util.JS.log(key,this.getValueFromKey(key),this.getValueFromKey(key,Number),this.getValueFromKey(key,String))}};weavejs.core.SessionStateLog.debug=true;var lv=weave.root.requestObject('ls',weavejs.core.LinkableString,false);lv.addImmediateCallback(weave,__localFn0__,true);lv.addGroupedCallback(weave,__localFn1__,true);lv.state='hello';lv.state='hello';weave.path('ls').state('hi').addCallback(null,__localFn2__);lv.state='world';weave.path('script').request('LinkableCallbackScript').state('script',
'console.log(Weave.className(this), this.get("ldo").target.value, Weave.getState(this));').push('variables','ldo').request('LinkableDynamicObject').state(['ls']);lv.state='2';lv.state=2;lv.state='3';weave.path('ls2').request('LinkableString');weave.path('sync').request('LinkableSynchronizer').state('primaryPath',['ls']).state('primaryTransform','state + "_transformed"').state('secondaryPath',['ls2']).call(__localFn3__);var print=__localFn4__};
WeaveTest.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeaveTest',qName:'WeaveTest'}]};goog.exportSymbol('WeaveTest',WeaveTest);WeaveTest.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.core.EditorManager');goog.require('weavejs.api.ui.IEditorManager');weavejs.core.EditorManager=function(){this.labels=new weavejs.util.JS.WeakMap};weavejs.core.EditorManager.prototype.labels;weavejs.core.EditorManager.prototype.setLabel=function(object,label){this.labels.set(object,label);Weave.getCallbacks(this).triggerCallbacks()};weavejs.core.EditorManager.prototype.getLabel=function(object){return this.labels.get(object)};
weavejs.core.EditorManager.prototype.FLEXJS_CLASS_INFO={names:[{name:'EditorManager',qName:'weavejs.core.EditorManager'}],interfaces:[weavejs.api.ui.IEditorManager]};goog.exportSymbol('weavejs.core.EditorManager',weavejs.core.EditorManager);weavejs.core.EditorManager.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'setLabel':{type:'void',declaredBy:'weavejs.core.EditorManager'},'getLabel':{type:'String',declaredBy:'weavejs.core.EditorManager'}}}}};goog.provide('weavejs.core.ProgressIndicator');goog.require('weavejs.api.core.IProgressIndicator');weavejs.core.ProgressIndicator=function(){this.map_task_progress=new weavejs.util.JS.Map;this.map_task_description=new weavejs.util.JS.Map;this.map_task_stackTrace=new weavejs.util.JS.Map};
weavejs.core.ProgressIndicator.prototype.debugTasks=function(){var result=[];var tasks=weavejs.util.JS.mapKeys(this.map_task_progress);var foreachiter0_target=tasks;for(var foreachiter0 in foreachiter0_target){var task=foreachiter0_target[foreachiter0];result.push(weavejs.util.DebugUtils.debugId(task))}return result};
weavejs.core.ProgressIndicator.prototype.getDescriptions=function(){var result=[];var tasks=weavejs.util.JS.mapKeys(this.map_task_progress);var foreachiter1_target=tasks;for(var foreachiter1 in foreachiter1_target){var task=foreachiter1_target[foreachiter1];var desc=org.apache.flex.utils.Language.string(this.map_task_description.get(task)||'Unnamed task');if(desc)result.push([task,this.map_task_progress.get(task),desc])}return result};weavejs.core.ProgressIndicator.prototype.getTaskCount=function(){return this._taskCount};
weavejs.core.ProgressIndicator.prototype.addTask=function(taskToken,busyObject,description){busyObject=typeof busyObject!=='undefined'?busyObject:null;description=typeof description!=='undefined'?description:null;var cc=Weave.getCallbacks(this);cc.delayCallbacks();var isNewTask=!this.map_task_progress.has(taskToken);this.map_task_description.set(taskToken,description);this.updateTask(taskToken,NaN);if(isNewTask&&weavejs.util.WeavePromise.isThenable(taskToken)){var remove=this.removeTask.bind(this,
taskToken);taskToken.then(remove,remove)}if(busyObject)weavejs.WeaveAPI.SessionManager.assignBusyTask(taskToken,busyObject);cc.resumeCallbacks()};weavejs.core.ProgressIndicator.prototype.hasTask=function(taskToken){return this.map_task_progress.has(taskToken)};
weavejs.core.ProgressIndicator.prototype.updateTask=function(taskToken,progress){if(!this.map_task_progress.has(taskToken)){if(!isNaN(progress))throw new Error('updateTask() called, but task was not previously added with addTask()');if(weavejs.WeaveAPI.debugAsyncStack)this.map_task_stackTrace.set(taskToken,new Error('Stack trace'));this._taskCount++;this._maxTaskCount++}if(this.map_task_progress.get(taskToken)!==progress){this.map_task_progress.set(taskToken,progress);Weave.getCallbacks(this).triggerCallbacks()}};
weavejs.core.ProgressIndicator.prototype.removeTask=function(taskToken){if(!this.map_task_progress.has(taskToken))return;var stackTrace=org.apache.flex.utils.Language.string(this.map_task_stackTrace.get(taskToken));this.map_task_progress['delete'](taskToken);this.map_task_description['delete'](taskToken);this.map_task_stackTrace['delete'](taskToken);this._taskCount--;if(this._taskCount==1)this._maxTaskCount=this._taskCount;weavejs.WeaveAPI.SessionManager.unassignBusyTask(taskToken);Weave.getCallbacks(this).triggerCallbacks()};
weavejs.core.ProgressIndicator.prototype.getNormalizedProgress=function(){var sum=0;var tasks=weavejs.util.JS.mapKeys(this.map_task_progress);var foreachiter2_target=tasks;for(var foreachiter2 in foreachiter2_target){var task=foreachiter2_target[foreachiter2];var stackTrace=org.apache.flex.utils.Language.string(this.map_task_stackTrace.get(task));var progress=Number(this.map_task_progress.get(task));if(isFinite(progress))sum+=progress}sum+=this._maxTaskCount-this._taskCount;if(sum)return sum/this._maxTaskCount;
return this._taskCount?0:1};weavejs.core.ProgressIndicator.prototype._taskCount=0;weavejs.core.ProgressIndicator.prototype._maxTaskCount=1;weavejs.core.ProgressIndicator.prototype.map_task_progress;weavejs.core.ProgressIndicator.prototype.map_task_description;weavejs.core.ProgressIndicator.prototype.map_task_stackTrace;
weavejs.core.ProgressIndicator.prototype.test=function(){var tasks=weavejs.util.JS.mapKeys(this.map_task_progress);var foreachiter3_target=tasks;for(var foreachiter3 in foreachiter3_target){var task=foreachiter3_target[foreachiter3];var stackTrace=org.apache.flex.utils.Language.string(this.map_task_stackTrace.get(task));var description=org.apache.flex.utils.Language.string(this.map_task_description.get(task));weavejs.util.JS.log(weavejs.util.DebugUtils.debugId(task),description,stackTrace)}};
weavejs.core.ProgressIndicator.prototype.FLEXJS_CLASS_INFO={names:[{name:'ProgressIndicator',qName:'weavejs.core.ProgressIndicator'}],interfaces:[weavejs.api.core.IProgressIndicator]};goog.exportSymbol('weavejs.core.ProgressIndicator',weavejs.core.ProgressIndicator);
weavejs.core.ProgressIndicator.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'debugTasks':{type:'Array',declaredBy:'weavejs.core.ProgressIndicator'},'getDescriptions':{type:'Array',declaredBy:'weavejs.core.ProgressIndicator'},'getTaskCount':{type:'int',declaredBy:'weavejs.core.ProgressIndicator'},'addTask':{type:'void',declaredBy:'weavejs.core.ProgressIndicator'},'hasTask':{type:'Boolean',declaredBy:'weavejs.core.ProgressIndicator'},
'updateTask':{type:'void',declaredBy:'weavejs.core.ProgressIndicator'},'removeTask':{type:'void',declaredBy:'weavejs.core.ProgressIndicator'},'getNormalizedProgress':{type:'Number',declaredBy:'weavejs.core.ProgressIndicator'},'test':{type:'void',declaredBy:'weavejs.core.ProgressIndicator'}}}}};goog.provide('weavejs.util.DebugTimer');weavejs.util.DebugTimer=function(){};weavejs.util.DebugTimer.debugTimes=[];weavejs.util.DebugTimer.begin=function(){weavejs.util.DebugTimer.debugTimes.push(weavejs.util.JS.now())};weavejs.util.DebugTimer.cancel=function(){weavejs.util.DebugTimer.debugTimes.pop()};
weavejs.util.DebugTimer.lap=function(debugString,debugStrings){debugStrings=Array.prototype.slice.call(arguments,1);debugStrings.unshift(debugString);var elapsedTime=Number(weavejs.util.DebugTimer.end.apply(null,debugStrings));weavejs.util.DebugTimer.begin();return elapsedTime};
weavejs.util.DebugTimer.end=function(debugString,debugStrings){debugStrings=Array.prototype.slice.call(arguments,1);debugStrings.unshift(debugString);var elapsedTime=weavejs.util.JS.now()-weavejs.util.DebugTimer.debugTimes.pop();var elapsed='['+elapsedTime+' ms elapsed] ';var elapsedIndent=weavejs.util.StandardLib.lpad('| ',elapsed.length);var indent=weavejs.util.StandardLib.rpad('',weavejs.util.DebugTimer.debugTimes.length*2,'| ');var lines=debugStrings.join(' ').split('\n');for(var i=0;i<lines.length;i++)if(lines.length==
1)lines[i]=indent+',-'+elapsed+lines[i];else if(i==0)lines[i]=indent+',-'+elapsed+lines[i];else if(i>0&&i<lines.length-1)lines[i]=indent+'| '+elapsedIndent+lines[i];else lines[i]=indent+'|-'+elapsed+lines[i];org.apache.flex.utils.Language.trace(lines.join('\n'));if(elapsedTime>1E3)org.apache.flex.utils.Language.trace();return elapsedTime};weavejs.util.DebugTimer.prototype.FLEXJS_CLASS_INFO={names:[{name:'DebugTimer',qName:'weavejs.util.DebugTimer'}]};goog.exportSymbol('weavejs.util.DebugTimer',weavejs.util.DebugTimer);
weavejs.util.DebugTimer.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{}}}};goog.provide('weavejs.core.Scheduler');goog.require('weavejs.util.DebugTimer');goog.require('weavejs.api.core.IDisposableObject');goog.require('weavejs.api.core.IScheduler');
weavejs.core.Scheduler=function(){this._frameCallbacks=Weave.disposableChild(this,weavejs.core.CallbackCollection);this._currentFrameStartTime=weavejs.util.JS.now();this.frameTimes=[];this.map_task_stackTrace=new weavejs.util.JS.WeakMap;this.map_task_elapsedTime=new weavejs.util.JS.WeakMap;this.map_task_startTime=new weavejs.util.JS.WeakMap;this._priorityCallLaterQueues=[[],[],[],[]];this._activePriority=weavejs.WeaveAPI.TASK_PRIORITY_IMMEDIATE+1;this._priorityAllocatedTimes=[Number.MAX_VALUE,300,
200,100];this.map_task_time=new weavejs.util.JS.WeakMap;this.d2d_context_task_token=new weavejs.util.Dictionary2D(true,true,Object);this._frameCallbacks.addImmediateCallback(this,org.apache.flex.utils.Language.closure(this._requestNextFrame,this,'_requestNextFrame'),true);this._frameCallbacks.addImmediateCallback(this,org.apache.flex.utils.Language.closure(this._handleCallLater,this,'_handleCallLater'));this.initVisibilityHandler()};weavejs.core.Scheduler.debug_fps=false;
weavejs.core.Scheduler.debug_async_time=false;weavejs.core.Scheduler.debug_async_stack_elapsed=false;weavejs.core.Scheduler.debug_delayTasks=false;weavejs.core.Scheduler.debug_callLater=false;weavejs.core.Scheduler.debug_visibility=false;weavejs.core.Scheduler.prototype._frameCallbacks;weavejs.core.Scheduler.prototype._nextAnimationFrame;
weavejs.core.Scheduler.prototype._requestNextFrame=function(){this._nextAnimationFrame=weavejs.util.JS.requestAnimationFrame(org.apache.flex.utils.Language.closure(this._frameCallbacks.triggerCallbacks,this._frameCallbacks,'triggerCallbacks'))};weavejs.core.Scheduler.prototype.dispose=function(){weavejs.util.JS.cancelAnimationFrame(this._nextAnimationFrame)};weavejs.core.Scheduler.prototype.averageFrameTime=0;weavejs.core.Scheduler.prototype._currentFrameStartTime;
weavejs.core.Scheduler.prototype._previousFrameElapsedTime=0;weavejs.core.Scheduler.prototype.frameTimes;weavejs.core.Scheduler.prototype.map_task_stackTrace;weavejs.core.Scheduler.prototype.map_task_elapsedTime;weavejs.core.Scheduler.prototype.map_task_startTime;weavejs.core.Scheduler.prototype._currentTaskStopTime=0;weavejs.core.Scheduler.prototype._priorityCallLaterQueues;weavejs.core.Scheduler.prototype._activePriority;weavejs.core.Scheduler.prototype._activePriorityElapsedTime=0;weavejs.core.Scheduler.prototype._priorityAllocatedTimes;
weavejs.core.Scheduler.prototype._deactivatedMaxComputationTimePerFrame=1E3;weavejs.core.Scheduler.prototype.getMaxComputationTimePerFrame=function(){return this.maxComputationTimePerFrame};weavejs.core.Scheduler.prototype.setMaxComputationTimePerFrame=function(value){this.maxComputationTimePerFrame=value};weavejs.core.Scheduler.prototype.getTaskPriorityTimeAllocation=function(priority){return org.apache.flex.utils.Language.uint(this._priorityAllocatedTimes[priority])};
weavejs.core.Scheduler.prototype.setTaskPriorityTimeAllocation=function(priority,milliseconds){this._priorityAllocatedTimes[priority]=Math.max(milliseconds,5)};weavejs.core.Scheduler.prototype.maxComputationTimePerFrame=100;weavejs.core.Scheduler.prototype.maxComputationTimePerFrame_noActivity=250;weavejs.core.Scheduler._time;weavejs.core.Scheduler._times=[];
weavejs.core.Scheduler.debugTime=function(str){var now=weavejs.util.JS.now();var dur=now-weavejs.core.Scheduler._time;if(dur>100)weavejs.core.Scheduler._times.push(dur+' '+str);else{var dots='...';var n=weavejs.core.Scheduler._times.length;if(n&&weavejs.core.Scheduler._times[n-1]!=dots)weavejs.core.Scheduler._times.push(dots)}weavejs.core.Scheduler._time=now;return dur};weavejs.core.Scheduler.resetDebugTime=function(){weavejs.core.Scheduler._times.length=0;weavejs.core.Scheduler._time=weavejs.util.JS.now()};
weavejs.core.Scheduler.prototype.HIDDEN;weavejs.core.Scheduler.prototype.VISIBILITY_CHANGE;weavejs.core.Scheduler.prototype.deactivated=true;weavejs.core.Scheduler.prototype.useDeactivatedFrameRate=false;
weavejs.core.Scheduler.prototype.initVisibilityHandler=function(){if(typeof weavejs.util.JS.global.document.hidden!=='undefined'){this.HIDDEN='hidden';this.VISIBILITY_CHANGE='visibilitychange'}else if(typeof weavejs.util.JS.global.document.mozHidden!=='undefined'){this.HIDDEN='mozHidden';this.VISIBILITY_CHANGE='mozvisibilitychange'}else if(typeof weavejs.util.JS.global.document.msHidden!=='undefined'){this.HIDDEN='msHidden';this.VISIBILITY_CHANGE='msvisibilitychange'}else if(typeof weavejs.util.JS.global.document.webkitHidden!==
'undefined'){this.HIDDEN='webkitHidden';this.VISIBILITY_CHANGE='webkitvisibilitychange'}if(typeof weavejs.util.JS.global.document.addEventListener!=='undefined'&&typeof weavejs.util.JS.global.document[this.HIDDEN]!=='undefined')weavejs.util.JS.global.document.addEventListener(this.VISIBILITY_CHANGE,org.apache.flex.utils.Language.closure(this.handleVisibilityChange,this,'handleVisibilityChange'),false)};
weavejs.core.Scheduler.prototype.handleVisibilityChange=function(){if(weavejs.util.JS.global.document[this.HIDDEN])this.deactivated=true;else this.deactivated=false;this.useDeactivatedFrameRate=false;if(weavejs.core.Scheduler.debug_visibility)weavejs.util.JS.log('visibility change; hidden \x3d',this.deactivated)};
weavejs.core.Scheduler.prototype._handleCallLater=function(){if(this.deactivated){var wasted=weavejs.util.JS.now()-this._currentFrameStartTime;if(weavejs.core.Scheduler.debug_fps)weavejs.util.JS.log('wasted',wasted);this.useDeactivatedFrameRate=wasted>100}var prevStartTime=this._currentFrameStartTime;this._currentFrameStartTime=weavejs.util.JS.now();this._previousFrameElapsedTime=this._currentFrameStartTime-prevStartTime;if(this.maxComputationTimePerFrame==0)this.maxComputationTimePerFrame=100;var maxComputationTime;
if(this.useDeactivatedFrameRate)maxComputationTime=this._deactivatedMaxComputationTimePerFrame;else maxComputationTime=this.maxComputationTimePerFrame;weavejs.core.Scheduler.resetDebugTime();if(weavejs.core.Scheduler.debug_fps){this.frameTimes.push(this.previousFrameElapsedTime);if(weavejs.util.StandardLib.sum(this.frameTimes)>=1E3){this.averageFrameTime=weavejs.util.StandardLib.mean(this.frameTimes);var fps=weavejs.util.StandardLib.roundSignificant(1E3/this.averageFrameTime,2);weavejs.util.JS.log(fps,
'fps; max computation time',maxComputationTime);this.frameTimes.length=0}}if(this._previousFrameElapsedTime>3E3)weavejs.util.JS.log('Previous frame took',this._previousFrameElapsedTime,'ms');var args;var context;var args2;var stackTrace;var now;var allStop=this._currentFrameStartTime+maxComputationTime;this._currentTaskStopTime=allStop;var queue=org.apache.flex.utils.Language.as(this._priorityCallLaterQueues[weavejs.WeaveAPI.TASK_PRIORITY_IMMEDIATE],Array);var countdown;for(countdown=queue.length;countdown>
0;countdown--){if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.begin();now=weavejs.util.JS.now();if(now>allStop){if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.cancel();return}args=queue.shift();stackTrace=org.apache.flex.utils.Language.string(this.map_task_stackTrace.get(args));context=args[0];if(!weavejs.WeaveAPI.SessionManager.objectWasDisposed(context)){args2=org.apache.flex.utils.Language.as(args[2],Array);if(args2!=null&&args2.length>0)org.apache.flex.utils.Language.as(args[1],
Function).apply(context,args2);else org.apache.flex.utils.Language.as(args[1],Function).apply(context)}if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.end(stackTrace)}var minPriority=weavejs.WeaveAPI.TASK_PRIORITY_IMMEDIATE+1;var lastPriority=this._activePriority==minPriority?this._priorityCallLaterQueues.length-1:this._activePriority-1;var pStart=weavejs.util.JS.now();var pAlloc=org.apache.flex.utils.Language._int(this._priorityAllocatedTimes[this._activePriority]);if(this.useDeactivatedFrameRate)pAlloc=
pAlloc*this._deactivatedMaxComputationTimePerFrame/this.maxComputationTimePerFrame;var pStop=Math.min(allStop,pStart+pAlloc-this._activePriorityElapsedTime);queue=org.apache.flex.utils.Language.as(this._priorityCallLaterQueues[this._activePriority],Array);countdown=queue.length;while(true){if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.begin();now=weavejs.util.JS.now();if(countdown==0||now>pStop){this._activePriorityElapsedTime+=now-pStart;if(now>allStop||this._activePriority==
lastPriority){if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.cancel();if(weavejs.core.Scheduler.debug_fps)weavejs.util.JS.log('spent',this.currentFrameElapsedTime,'ms');return}var remaining=0;for(var i=minPriority;i<this._priorityCallLaterQueues.length;i++)remaining+=org.apache.flex.utils.Language.as(this._priorityCallLaterQueues[i],Array).length;if(remaining==0){if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.cancel();break}this._activePriority++;this._activePriorityElapsedTime=
0;if(this._activePriority==this._priorityCallLaterQueues.length)this._activePriority=minPriority;pStart=now;pAlloc=org.apache.flex.utils.Language._int(this._priorityAllocatedTimes[this._activePriority]);if(this.useDeactivatedFrameRate)pAlloc=pAlloc*this._deactivatedMaxComputationTimePerFrame/this.maxComputationTimePerFrame;pStop=Math.min(allStop,pStart+pAlloc);queue=org.apache.flex.utils.Language.as(this._priorityCallLaterQueues[this._activePriority],Array);countdown=queue.length;if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.cancel();
continue}countdown--;this._currentTaskStopTime=pStop;args=org.apache.flex.utils.Language.as(queue.shift(),Array);stackTrace=org.apache.flex.utils.Language.string(this.map_task_stackTrace.get(args));context=args[0];if(!weavejs.WeaveAPI.SessionManager.objectWasDisposed(context)){args2=org.apache.flex.utils.Language.as(args[2],Array);if(args2!=null&&args2.length>0)org.apache.flex.utils.Language.as(args[1],Function).apply(context,args2);else org.apache.flex.utils.Language.as(args[1],Function).apply(context)}if(weavejs.core.Scheduler.debug_callLater)weavejs.util.DebugTimer.end(stackTrace)}};
weavejs.core.Scheduler.prototype.callLater=function(relevantContext,method,parameters){parameters=typeof parameters!=='undefined'?parameters:null;this._callLaterPriority(weavejs.WeaveAPI.TASK_PRIORITY_IMMEDIATE,relevantContext,method,parameters)};
weavejs.core.Scheduler.prototype._callLaterPriority=function(priority,relevantContext,method,parameters){parameters=typeof parameters!=='undefined'?parameters:null;if(method==null){weavejs.util.JS.error('StageUtils.callLater(): received null "method" parameter');return}var args=[relevantContext,method,parameters];this._priorityCallLaterQueues[priority].push(args);if(weavejs.WeaveAPI.debugAsyncStack)this.map_task_stackTrace.set(args,new Error('This is the stack trace from when callLater() was called.'))};
weavejs.core.Scheduler.generateCompoundIterativeTask=function(iterativeTasks){iterativeTasks=Array.prototype.slice.call(arguments,0);var __localFn0__=function(stopTime){if(stopTime<0){iTask=0;return 0}if(iTask>=iterativeTasks.length)return 1;var i=iTask;var iterate=org.apache.flex.utils.Language.as(iterativeTasks[iTask],Function);var progress;if(iterate.length)progress=Number(iterate.call(this,stopTime));else while(iTask==i&&(progress=Number(iterate.call(this)))<1&&weavejs.util.JS.now()<stopTime);
if(iTask!=i)return 0;var totalProgress=(iTask+progress)/iterativeTasks.length;if(progress==1)iTask++;return totalProgress};var iTask=0;return __localFn0__};weavejs.core.Scheduler.prototype.map_task_time;weavejs.core.Scheduler.prototype.d2d_context_task_token;
weavejs.core.Scheduler.prototype.startTask=function(relevantContext,iterativeTask,priority,finalCallback,description){finalCallback=typeof finalCallback!=='undefined'?finalCallback:null;description=typeof description!=='undefined'?description:null;var taskToken=this.d2d_context_task_token.get(relevantContext||weavejs.util.JS.global,iterativeTask);if(weavejs.WeaveAPI.ProgressIndicator.hasTask(taskToken))return;if(weavejs.core.Scheduler.debug_async_time){if(this.map_task_time.get(iterativeTask)){var value=
this.map_task_time.get(iterativeTask);this.map_task_time['delete'](iterativeTask);weavejs.util.JS.log('interrupted',weavejs.util.JS.now()-this.map_task_time.get(iterativeTask)[0],priority,this.map_task_time.get(iterativeTask)[1],value)}this.map_task_time.set(iterativeTask,[weavejs.util.JS.now(),new Error('Stack trace')])}if(priority>=this._priorityCallLaterQueues.length){weavejs.util.JS.error('Invalid priority value: '+priority);priority=weavejs.WeaveAPI.TASK_PRIORITY_NORMAL}if(weavejs.WeaveAPI.debugAsyncStack)this.map_task_stackTrace.set(iterativeTask,
[weavejs.util.DebugUtils.debugId(iterativeTask),new Error('Stack trace')]);if(weavejs.core.Scheduler.debug_async_stack_elapsed){this.map_task_startTime.set(iterativeTask,weavejs.util.JS.now());this.map_task_elapsedTime.set(iterativeTask,0)}weavejs.WeaveAPI.ProgressIndicator.addTask(taskToken,org.apache.flex.utils.Language.as(relevantContext,weavejs.api.core.ILinkableObject),description);var useTimeParameter=iterativeTask.length>0;this._callLaterPriority(priority,null,org.apache.flex.utils.Language.closure(this._iterateTask,
this,'_iterateTask'),[relevantContext,iterativeTask,priority,finalCallback,useTimeParameter])};
weavejs.core.Scheduler.prototype._iterateTask=function(context,task,priority,finalCallback,useTimeParameter){var taskToken=this.d2d_context_task_token.get(context||weavejs.util.JS.global,task);if(weavejs.WeaveAPI.SessionManager.objectWasDisposed(context)){if(weavejs.core.Scheduler.debug_async_time&&this.map_task_time.get(task)){var value=this.map_task_time.get(task);this.map_task_time['delete'](task);weavejs.util.JS.log('disposed',weavejs.util.JS.now()-this.map_task_time.get(task)[0],priority,this.map_task_time.get(task)[1],
value)}weavejs.WeaveAPI.ProgressIndicator.removeTask(taskToken);return}var debug_time=weavejs.WeaveAPI.debugAsyncStack?weavejs.util.JS.now():-1;var stackTrace=org.apache.flex.utils.Language.string(weavejs.WeaveAPI.debugAsyncStack?this.map_task_stackTrace.get(task):null);var progress=undefined;var time;while((time=weavejs.util.JS.now())<=this._currentTaskStopTime){if(useTimeParameter)progress=org.apache.flex.utils.Language.as(task.call(context,this._currentTaskStopTime),Number);else progress=org.apache.flex.utils.Language.as(task.call(context),
Number);if(progress===null||isNaN(progress)||progress<0||progress>1){weavejs.util.JS.error('Received unexpected result from iterative task ('+progress+').  Expecting a number between 0 and 1.  Task cancelled.');if(weavejs.WeaveAPI.debugAsyncStack){weavejs.util.JS.log(stackTrace);if(useTimeParameter)progress=org.apache.flex.utils.Language.as(task.call(context,this._currentTaskStopTime),Number);else progress=org.apache.flex.utils.Language.as(task.call(context),Number)}progress=1}if(weavejs.WeaveAPI.debugAsyncStack&&
this.currentFrameElapsedTime>3E3){weavejs.util.JS.log(weavejs.util.JS.now()-time,stackTrace);if(useTimeParameter)progress=org.apache.flex.utils.Language.as(task.call(context,this._currentTaskStopTime),Number);else progress=org.apache.flex.utils.Language.as(task.call(context),Number)}if(progress==1){if(weavejs.core.Scheduler.debug_async_time&&this.map_task_time.get(task)){var value2=this.map_task_time.get(task);this.map_task_time['delete'](task);weavejs.util.JS.log('completed',weavejs.util.JS.now()-
this.map_task_time.get(task)[0],priority,this.map_task_time.get(task)[1],value2)}weavejs.WeaveAPI.ProgressIndicator.removeTask(taskToken);if(finalCallback!=null)finalCallback.call(context);return}if(useTimeParameter)break;if(weavejs.core.Scheduler.debug_delayTasks)break}if(weavejs.core.Scheduler.debug_async_stack_elapsed){var start=org.apache.flex.utils.Language._int(this.map_task_startTime.get(task));var elapsed=org.apache.flex.utils.Language._int(this.map_task_elapsedTime.get(task))+(time-debug_time);
this.map_task_elapsedTime.set(task,elapsed);weavejs.util.JS.log(elapsed,'/',time-start,'\x3d',weavejs.util.StandardLib.roundSignificant(elapsed/(time-start),2),stackTrace)}if(progress!==undefined)weavejs.WeaveAPI.ProgressIndicator.updateTask(taskToken,progress);this._callLaterPriority(priority,null,org.apache.flex.utils.Language.closure(this._iterateTask,this,'_iterateTask'),weavejs.util.JS.toArray(arguments))};
Object.defineProperties(weavejs.core.Scheduler.prototype,{frameCallbacks:{get:function(){return this._frameCallbacks}},previousFrameElapsedTime:{get:function(){return this._previousFrameElapsedTime}},currentFrameElapsedTime:{get:function(){return weavejs.util.JS.now()-this._currentFrameStartTime}}});weavejs.core.Scheduler.prototype.FLEXJS_CLASS_INFO={names:[{name:'Scheduler',qName:'weavejs.core.Scheduler'}],interfaces:[weavejs.api.core.IScheduler,weavejs.api.core.IDisposableObject]};
goog.exportSymbol('weavejs.core.Scheduler',weavejs.core.Scheduler);
weavejs.core.Scheduler.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{'averageFrameTime':{type:'int'},'maxComputationTimePerFrame':{type:'uint'}}},accessors:function(){return{'frameCallbacks':{type:'ICallbackCollection',declaredBy:'weavejs.core.Scheduler'},'previousFrameElapsedTime':{type:'int',declaredBy:'weavejs.core.Scheduler'},'currentFrameElapsedTime':{type:'int',declaredBy:'weavejs.core.Scheduler'}}},methods:function(){return{'Scheduler':{type:'',declaredBy:'weavejs.core.Scheduler'},
'dispose':{type:'void',declaredBy:'weavejs.core.Scheduler'},'getMaxComputationTimePerFrame':{type:'uint',declaredBy:'weavejs.core.Scheduler'},'setMaxComputationTimePerFrame':{type:'void',declaredBy:'weavejs.core.Scheduler'},'getTaskPriorityTimeAllocation':{type:'uint',declaredBy:'weavejs.core.Scheduler'},'setTaskPriorityTimeAllocation':{type:'void',declaredBy:'weavejs.core.Scheduler'},'callLater':{type:'void',declaredBy:'weavejs.core.Scheduler'},'startTask':{type:'void',declaredBy:'weavejs.core.Scheduler'}}}}};
weavejs.core.Scheduler.WindowFrameHandler=function(window,scheduler){};weavejs.core.Scheduler.WindowFrameHandler.prototype.window;weavejs.core.Scheduler.WindowFrameHandler.prototype.scheduler;weavejs.core.Scheduler.WindowFrameHandler.prototype.FLEXJS_CLASS_INFO={names:[{name:'WindowFrameHandler',qName:'weavejs.core.Scheduler.WindowFrameHandler'}]};goog.exportSymbol('weavejs.core.Scheduler.WindowFrameHandler',weavejs.core.Scheduler.WindowFrameHandler);
weavejs.core.Scheduler.WindowFrameHandler.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'WindowFrameHandler':{type:'',declaredBy:'weavejs.core.Scheduler.WindowFrameHandler'}}}}};goog.provide('WeaveJS');goog.require('Weave');goog.require('WeaveTest');goog.require('weavejs.WeaveAPI');goog.require('weavejs.core.EditorManager');goog.require('weavejs.core.LinkableDynamicObject');goog.require('weavejs.core.LinkableHashMap');goog.require('weavejs.core.ProgressIndicator');goog.require('weavejs.core.Scheduler');goog.require('weavejs.core.SessionManager');WeaveJS=function(){};
WeaveJS.prototype.start=function(){weavejs.WeaveAPI.ClassRegistry['defaultPackages'].push('','weavejs','weavejs.api','weavejs.api.core','weavejs.api.data','weavejs.api.service','weavejs.api.ui','weavejs.core','weavejs.data','weavejs.data.bin','weavejs.data.column','weavejs.data.hierarchy','weavejs.data.key','weavejs.data.source','weavejs.geom','weavejs.path','weavejs.util');weavejs.WeaveAPI.ClassRegistry.registerImplementation(weavejs.api.core.ISessionManager,weavejs.core.SessionManager);weavejs.WeaveAPI.ClassRegistry.registerImplementation(weavejs.api.core.IScheduler,
weavejs.core.Scheduler);weavejs.WeaveAPI.ClassRegistry.registerImplementation(weavejs.api.core.IProgressIndicator,weavejs.core.ProgressIndicator);weavejs.WeaveAPI.ClassRegistry.registerImplementation(weavejs.api.ui.IEditorManager,weavejs.core.EditorManager);weavejs.WeaveAPI.ClassRegistry.registerImplementation(weavejs.api.core.ILinkableHashMap,weavejs.core.LinkableHashMap);weavejs.WeaveAPI.ClassRegistry.registerImplementation(weavejs.api.core.ILinkableDynamicObject,weavejs.core.LinkableDynamicObject);
Weave;WeaveTest};WeaveJS.prototype.FLEXJS_CLASS_INFO={names:[{name:'WeaveJS',qName:'WeaveJS'}]};goog.exportSymbol('WeaveJS',WeaveJS);WeaveJS.prototype.FLEXJS_REFLECTION_INFO=function(){return{variables:function(){return{}},accessors:function(){return{}},methods:function(){return{'WeaveJS':{type:'',declaredBy:'WeaveJS'},'start':{type:'void',declaredBy:'WeaveJS'}}}}};

new WeaveJS().start();
//console.log(weavejs);
var weavejs = weavejs || {};
weavejs.util = weavejs.util || {};
weavejs.util.DateUtils = weavejs.util.DateUtils || {};
weavejs.util.StandardLib = weavejs.util.StandardLib || {};
weavejs.util.DateUtils.moment = moment;
weavejs.util.StandardLib.lodash = _;

"use strict";

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var __decorate = undefined && undefined.__decorate || function (decorators, target, key, desc) {
    var c = arguments.length,
        r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
        d;
    if ((typeof Reflect === "undefined" ? "undefined" : _typeof(Reflect)) === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {
        if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    }return c > 3 && r && Object.defineProperty(target, key, r), r;
};
/// <reference path="./../typings/GeoJSON/GeoJSON.d.ts"/>
/// <reference path="./../typings/classnames/classnames.d.ts"/>
/// <reference path="./../typings/jszip/jszip.d.ts"/>
/// <reference path="./../typings/lodash/lodash.d.ts"/>
/// <reference path="./../typings/moment/moment-node.d.ts"/>
/// <reference path="./../typings/moment/moment.d.ts"/>
/// <reference path="./../typings/openlayers/openlayers.d.ts"/>
/// <reference path="./../typings/pixi.js/pixi.js.d.ts"/>
/// <reference path="./../typings/proj4/proj4.d.ts"/>
/// <reference path="./../typings/react/react-addons-create-fragment.d.ts"/>
/// <reference path="./../typings/react/react-addons-css-transition-group.d.ts"/>
/// <reference path="./../typings/react/react-addons-linked-state-mixin.d.ts"/>
/// <reference path="./../typings/react/react-addons-perf.d.ts"/>
/// <reference path="./../typings/react/react-addons-pure-render-mixin.d.ts"/>
/// <reference path="./../typings/react/react-addons-test-utils.d.ts"/>
/// <reference path="./../typings/react/react-addons-transition-group.d.ts"/>
/// <reference path="./../typings/react/react-addons-update.d.ts"/>
/// <reference path="./../typings/react/react-dom.d.ts"/>
/// <reference path="./../typings/react/react-global.d.ts"/>
/// <reference path="./../typings/react/react.d.ts"/>
/// <reference path="./../typings/weave/as-types.d.ts"/>
/// <reference path="./../typings/weave/weavejs-core.d.ts"/>
function int(a) {
    return Math.floor(Number(a));
}
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var core;
    (function (core) {
        var ILinkableObject = weavejs.api.core.ILinkableObject;
        var LinkableVariable = weavejs.core.LinkableVariable;
        var LinkableFunction = weavejs.core.LinkableFunction;
        var LinkableWatcher = weavejs.core.LinkableWatcher;
        var JS = weavejs.util.JS;
        var LinkableSynchronizer_1 = void 0;
        var LinkableSynchronizer = LinkableSynchronizer_1 = function () {
            function LinkableSynchronizer() {
                var _this = this;

                _classCallCheck(this, LinkableSynchronizer);

                this.primaryPath = Weave.linkableChild(this, new LinkableVariable(Array), this.setPrimaryPath);
                this.secondaryPath = Weave.linkableChild(this, new LinkableVariable(Array), this.setSecondaryPath);
                this.primaryTransform = Weave.linkableChild(this, new LinkableFunction(null, false, LinkableSynchronizer_1.ARG_VARS), this.handlePrimaryTransform);
                this.secondaryTransform = Weave.linkableChild(this, new LinkableFunction(null, false, LinkableSynchronizer_1.ARG_VARS), this.handleSecondaryTransform);
                this._delayedSynchronize = false;
                this.selfCallback = function () {
                    if (_this._delayedSynchronize) _this.synchronize();
                };
                this.synchronize = function () {
                    if (_this._callbacks.callbacksAreDelayed) {
                        _this._delayedSynchronize = true;
                        return;
                    }
                    _this._delayedSynchronize = false;
                    var primary = _this.primaryWatcher.target;
                    var secondary = _this.secondaryWatcher.target;
                    if (_this._primary != primary || _this._secondary != secondary) {
                        // check objects individually since one may have been disposed
                        if (_this._primary) Weave.getCallbacks(_this._primary).removeCallback(_this, _this.primaryCallback);
                        if (_this._secondary) Weave.getCallbacks(_this._secondary).removeCallback(_this, _this.secondaryCallback);
                        _this._primary = primary;
                        _this._secondary = secondary;
                        if (primary && secondary) {
                            Weave.getCallbacks(_this._secondary).addImmediateCallback(_this, _this.secondaryCallback);
                            Weave.getCallbacks(_this._primary).addImmediateCallback(_this, _this.primaryCallback);
                            // if primaryTransform is not given but secondaryTransform is, call secondaryCallback.
                            // otherwise, call primaryCallback.
                            if (!_this.primaryTransform.value && _this.secondaryTransform.value) _this.secondaryCallback();else _this.primaryCallback();
                        }
                    }
                };
                /* These need to go *after* this.synchronize is defined, otherwise no callback is attached. */
                this.primaryWatcher = Weave.disposableChild(this, new LinkableWatcher(null, this.synchronize));
                this.secondaryWatcher = Weave.disposableChild(this, new LinkableWatcher(null, this.synchronize));
                this._callbacks = Weave.getCallbacks(this);
                this._callbacks.addImmediateCallback(null, this.selfCallback);
            }

            _createClass(LinkableSynchronizer, [{
                key: "setPrimaryPath",
                value: function setPrimaryPath() {
                    this.primaryWatcher.targetPath = Weave.AS(this.primaryPath.getSessionState(), Array);
                }
            }, {
                key: "setSecondaryPath",
                value: function setSecondaryPath() {
                    this.secondaryWatcher.targetPath = Weave.AS(this.secondaryPath.getSessionState(), Array);
                }
            }, {
                key: "handlePrimaryTransform",
                value: function handlePrimaryTransform() {
                    // if callbacks are delayed, it means we're loading a session state, so we don't want to apply the transform.
                    if (!this._callbacks.callbacksAreDelayed && this._primary && this._secondary) this.primaryCallback();
                }
            }, {
                key: "handleSecondaryTransform",
                value: function handleSecondaryTransform() {
                    // if callbacks are delayed, it means we're loading a session state, so we don't want to apply the transform.
                    if (!this._callbacks.callbacksAreDelayed && this._primary && this._secondary) this.secondaryCallback();
                }
            }, {
                key: "primaryCallback",
                value: function primaryCallback() {
                    if (this._callbacks.callbacksAreDelayed) {
                        this._delayedSynchronize = true;
                        this._callbacks.triggerCallbacks();
                        return;
                    }
                    if (this.primaryTransform.value) {
                        try {
                            var state = Weave.getState(this._primary);
                            var transformedState = this.primaryTransform.apply(null, [state, this._primary, this._secondary]);
                            Weave.setState(this._secondary, transformedState, true);
                        } catch (e) {
                            JS.error("Error evaluating primaryTransform", e);
                        }
                    } else if (!this.secondaryTransform.value) {
                        Weave.copyState(this._primary, this._secondary);
                    }
                }
            }, {
                key: "secondaryCallback",
                value: function secondaryCallback() {
                    if (this._callbacks.callbacksAreDelayed) {
                        this._delayedSynchronize = true;
                        this._callbacks.triggerCallbacks();
                        return;
                    }
                    if (this.secondaryTransform.value) {
                        try {
                            var state = Weave.getState(this._secondary);
                            var transformedState = this.secondaryTransform.apply(null, [state, this._primary, this._secondary]);
                            Weave.setState(this._primary, transformedState, true);
                        } catch (e) {
                            JS.error("Error evaluating secondaryTransform", e);
                        }
                    } else if (!this.primaryTransform.value) {
                        Weave.copyState(this._secondary, this._primary);
                    }
                }
            }]);

            return LinkableSynchronizer;
        }();
        LinkableSynchronizer.VAR_STATE = 'state';
        LinkableSynchronizer.VAR_PRIMARY = 'primary';
        LinkableSynchronizer.VAR_SECONDARY = 'secondary';
        LinkableSynchronizer.ARG_VARS = [LinkableSynchronizer.VAR_STATE, LinkableSynchronizer.VAR_PRIMARY, LinkableSynchronizer.VAR_SECONDARY];
        LinkableSynchronizer = LinkableSynchronizer_1 = __decorate([Weave.classInfo({ id: "weavejs.core.LinkableSynchronizer", interfaces: [ILinkableObject] })], LinkableSynchronizer);
        core.LinkableSynchronizer = LinkableSynchronizer;
    })(core = weavejs.core || (weavejs.core = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        /**
         * Binary Line Generalization Tree
         * This class defines a structure to represent a streamed polygon.
         *
         * Reference: van Oosterom, P. 1990. Reactive data structures
         *  for geographic information systems. PhD thesis, Department
         *  of Computer Science, Leiden University, The Netherlands.
         *
         *
         * @author adufilie
         */
        var BLGTree = function () {
            /**
             * Create an empty tree.
             */
            function BLGTree() {
                _classCallCheck(this, BLGTree);

                /**
                 * This is the root of the BLGTree.
                 */
                this.rootNode = null;
                /**
                 * operationStack and nodeStack
                 * used internally in getPointVector() to keep track of the current traversal operation
                 */
                this.operationStack = [];
                this.nodeStack = [];
                /**
                 * This vector is used in getPointVector().  It contains pointers to nodes that
                 * are currently being traversed. The first entry in the vector is the root node,
                 * and each other entry corresponds to a child node of the previous entry.
                 */
                this.traversalVector = [];
                /**
                 * This is the minImportance value from the last traversal.
                 * It can be used to avoid redundant traversal computations.
                 */
                this.previousTraversalMinImportance = -1;
                /**
                 * This is the visibleBounds value from the last traversal.
                 * It can be used to avoid redundant traversal computations.
                 */
                this.previousTraversalVisibleBounds = new geom.Bounds2D();
            }

            _createClass(BLGTree, [{
                key: "insert",

                /**
                 * Insert a new vertex into the BLGTree.
                 */
                value: function insert(index, importance, x, y) {
                    // if this new point would have been in the previous traversal,
                    // then the previous traversal is now invalid.
                    if (importance >= this.previousTraversalMinImportance) this.previousTraversalMinImportance = -1; // reset this value so previous traversal won't be reused
                    // create a new node object to hold these values
                    var newNode = new geom.BLGNode(index, importance, x, y);
                    this._insert(newNode);
                }
                /**
                 * @private
                 */

            }, {
                key: "_insert",
                value: function _insert(newNode) {
                    // base case: tree is empty, save as root node
                    if (this.rootNode == null) {
                        this.rootNode = newNode;
                        return;
                    }
                    // iteratively traverse the tree until an appropriate insertion point is found
                    var currentNode = this.rootNode;
                    while (true) {
                        // base case: if the new index is the same as the current index, keep old node
                        if (currentNode.index == newNode.index) {
                            if (newNode.left != null || newNode.right != null) throw new Error("BLGNode.insert: new node with children has index identical to an existing node");
                            return;
                        }
                        // if the new importance is greater than this importance, tree needs to be restructured.
                        if (newNode.importance > currentNode.importance) {
                            // pull out the values of this node and replace with new node
                            var tempIndex = currentNode.index;
                            var tempImportance = currentNode.importance;
                            var tempX = currentNode.x;
                            var tempY = currentNode.y;
                            var tempLeft = currentNode.left;
                            var tempRight = currentNode.right;
                            currentNode.index = newNode.index;
                            currentNode.importance = newNode.importance;
                            currentNode.x = newNode.x;
                            currentNode.y = newNode.y;
                            currentNode.left = newNode.left;
                            currentNode.right = newNode.right;
                            newNode.index = tempIndex;
                            newNode.importance = tempImportance;
                            newNode.x = tempX;
                            newNode.y = tempY;
                            newNode.left = tempLeft;
                            newNode.right = tempRight;
                        }
                        // the new node's importance is <= the importance of this node
                        // if the new index is < this index, place it to the left 
                        if (newNode.index < currentNode.index) {
                            if (currentNode.left != null) {
                                // travel down the tree to find the appropriate insertion spot
                                currentNode = currentNode.left;
                                continue;
                            }
                            // found insertion point
                            currentNode.left = newNode;
                            // newNode.left is ok because all child indices will be < currentNode; newNode.right is questionable
                            newNode = newNode.right;
                            currentNode.left.right = null; // clear previous reference to newNode
                            break;
                        } else {
                            if (currentNode.right != null) {
                                // travel down the tree to find the appropriate insertion spot
                                currentNode = currentNode.right;
                                continue;
                            }
                            // found insertion point, done
                            currentNode.right = newNode;
                            // newNode.right is ok because all child indices will be > currentNode; newNode.left is questionable
                            newNode = newNode.left;
                            currentNode.right.left = null; // clear previous reference to newNode
                            break;
                        }
                    }
                    // currentNode is a node that was just inserted
                    // newNode is a tree to shuffle around currentNode
                    var leftTraversalNode = currentNode; // for traversing down the left side of currentNode
                    var rightTraversalNode = currentNode; // for traversing down the right side of currentNode
                    while (newNode != null) {
                        // shuffle newNode around currentNode
                        if (newNode.index < currentNode.index) {
                            if (newNode.index < leftTraversalNode.index) {
                                /*
                                // for debugging
                                if (leftTraversalNode != currentNode)
                                    throw new Error("Unexpected error. leftTraversalNode != currentNode");
                                */
                                if (leftTraversalNode.left != null) {
                                    // travel down the tree to find the appropriate insertion spot
                                    leftTraversalNode = leftTraversalNode.left;
                                    continue;
                                }
                                // found insertion point
                                leftTraversalNode.left = newNode;
                                // newNode.left is ok because all child indices will be < currentNode; newNode.right is questionable
                                newNode = newNode.right;
                                leftTraversalNode.left.right = null; // clear previous reference to newNode
                                continue;
                            }
                            // everything under leftTraversalNode is < currentNode, so insert to the right of leftTraversalNode
                            if (leftTraversalNode.right != null) {
                                // travel down the tree to find the appropriate insertion spot
                                leftTraversalNode = leftTraversalNode.right;
                                continue;
                            }
                            // found insertion point
                            leftTraversalNode.right = newNode;
                            // newNode.left is ok because all child indices will be < currentNode; newNode.right is questionable
                            newNode = newNode.right;
                            leftTraversalNode.right.right = null; // clear previous reference to newNode
                        } else {
                            if (newNode.index > rightTraversalNode.index) {
                                /*
                                // for debugging
                                if (rightTraversalNode != currentNode)
                                    throw new Error("Unexpected error. rightTraversalNode != currentNode");
                                */
                                if (rightTraversalNode.right != null) {
                                    // travel down the tree to find the appropriate insertion spot
                                    rightTraversalNode = rightTraversalNode.right;
                                    continue;
                                }
                                // found insertion point
                                rightTraversalNode.right = newNode;
                                // newNode.right is ok because all child indices will be > currentNode; newNode.left is questionable
                                newNode = newNode.left;
                                rightTraversalNode.right.left = null; // clear previous reference to newNode
                                continue;
                            }
                            // everything under rightTraversalNode is > currentNode, so insert to the left of rightTraversalNode
                            if (rightTraversalNode.left != null) {
                                // travel down the tree to find the appropriate insertion spot
                                rightTraversalNode = rightTraversalNode.left;
                                continue;
                            }
                            // found insertion point
                            rightTraversalNode.left = newNode;
                            // newNode.right is ok because all child indices will be > currentNode; newNode.left is questionable
                            newNode = newNode.left;
                            rightTraversalNode.left.left = null; // clear previous reference to newNode
                        }
                    }
                }
                /**
                 * This function performs an in-order traversal of nodes, skipping those
                 * with importance &lt; minImportance.  The visit operation is to append the
                 * current node to the traversalVector.
                 * @param minImportance No points with importance less than this value will be returned.
                 * @param visibleBounds If not null, this bounds will be used to remove unnecessary offscreen points.
                 * @return A list of BLGNodes, ordered by point index.
                 */

            }, {
                key: "getPointVector",
                value: function getPointVector() {
                    var minImportance = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                    var visibleBounds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    if (minImportance == this.previousTraversalMinImportance && this.previousTraversalVisibleBounds.equals(visibleBounds)) return this.traversalVector; // avoid redundant computation
                    var resultCount = 0; // the number of nodes that have been stored in the traversalVector
                    if (this.rootNode != null) {
                        // traverse the tree
                        // begin by putting a traverse operation on the stack
                        this.operationStack[0] = BLGTree.OP_TRAVERSE;
                        this.nodeStack[0] = this.rootNode;
                        var prevPrevGridTest = 0;
                        var prevGridTest = 0;
                        var gridTest;
                        var stackPos = 0;
                        var node;
                        var operation;
                        // loop until the stack is empty
                        while (stackPos >= 0) {
                            // get next node & operation
                            node = this.nodeStack[stackPos];
                            operation = this.operationStack[stackPos];
                            // pop off stacks with cleanup
                            this.nodeStack[stackPos] = null;
                            this.operationStack[stackPos] = null;
                            stackPos--;
                            // handle operation
                            if (operation == BLGTree.OP_TRAVERSE) {
                                // if this node is unimportant, its children are also unimportant, so do nothing
                                if (node.importance < minImportance) continue;
                                // push three new operations on the stack, reverse order
                                // push third operation if necessary
                                if (node.right != null) {
                                    stackPos++;
                                    this.operationStack[stackPos] = BLGTree.OP_TRAVERSE;
                                    this.nodeStack[stackPos] = node.right; // right side last for in-order traversal
                                }
                                // push second operation
                                stackPos++;
                                this.operationStack[stackPos] = BLGTree.OP_VISIT;
                                this.nodeStack[stackPos] = node;
                                // push first operation if necessary
                                if (node.left != null) {
                                    stackPos++;
                                    this.operationStack[stackPos] = BLGTree.OP_TRAVERSE;
                                    this.nodeStack[stackPos] = node.left; // left side first for in-order traversal
                                }
                            } else {
                                /*
                                // for debugging
                                if (resultCount > 0 && traversalVector[resultCount - 1].index > node.index)
                                {
                                    var errorMsg:String = StandardLib.substitute(
                                        "Unexpected error. OP_VISIT out of order ({0} to {1})",
                                        traversalVector[resultCount - 1].index,
                                        node.index
                                    );
                                    throw new Error(errorMsg);
                                }
                                */
                                if (visibleBounds != null) {
                                    gridTest = visibleBounds.getGridTest(node.x, node.y);
                                    if (prevPrevGridTest & prevGridTest & gridTest) {
                                        // Drop previous node.  Keep current prevPrevGridTest value.
                                        resultCount--;
                                    } else {
                                        // Don't drop previous node.  Shift prev grid test values.
                                        prevPrevGridTest = prevGridTest;
                                    }
                                    prevGridTest = gridTest;
                                }
                                // copy this node to the results
                                this.traversalVector[resultCount++] = node;
                            }
                        }
                    }
                    // truncate vector to number of results
                    this.traversalVector.length = resultCount;
                    this.previousTraversalMinImportance = minImportance; // remember this value to avoid rudundant computation
                    this.previousTraversalVisibleBounds.copyFrom(visibleBounds); // remember this value to avoid rudundant computation
                    /*
                    // for debugging
                    for (var i:int = 0, prev:int = -1; i < traversalVector.length; i++)
                    {
                        if (traversalVector[i].index < prev)
                        {
                            trace("PROBLEM:",prev,"to",traversalVector[i].index);
                            break;
                        }
                        prev = traversalVector[i].index;
                    }
                    */
                    return this.traversalVector;
                }
            }, {
                key: "splitAtIndex",

                /**
                 * @param splitIndex An index to split the tree at.
                 * @return A new BLGTree containing all the points whose index >= splitIndex.
                 */
                value: function splitAtIndex(splitIndex) {
                    // reset these values so previous traversal won't be reused
                    this.previousTraversalMinImportance = -1;
                    this.traversalVector.length = 0;
                    // create new tree for points whose index >= splitIndex
                    var newTree = new BLGTree();
                    while (true) {
                        // traverse down right side of this tree until we find a subtree that should go to the new tree
                        var parent = null;
                        var subtree = this.rootNode;
                        while (subtree && subtree.index < splitIndex) {
                            parent = subtree;
                            subtree = subtree.right;
                        }
                        // stop if no appropriate subtree found
                        if (!subtree) break;
                        // remove subtree
                        if (parent) parent.right = null;else this.rootNode = null;
                        // add to new tree
                        newTree._insert(subtree);
                        // traverse down left side of new tree until we find a subtree that should go back to the old tree
                        parent = null;
                        subtree = newTree.rootNode;
                        while (subtree && subtree.index >= splitIndex) {
                            parent = subtree;
                            subtree = subtree.left;
                        }
                        // stop if no appropriate subtree found
                        if (!subtree) break;
                        // remove subtree
                        if (parent) parent.left = null;else newTree.rootNode = null;
                        // add to old tree
                        this._insert(subtree);
                    }
                    //assertValid(this.rootNode, function(node:BLGNode):void{ assertTrue(node.index < splitIndex); });
                    //assertValid(newTree.rootNode, function(node:BLGNode):void{ assertTrue(node.index >= splitIndex); });
                    // return new tree
                    return newTree;
                }
                /**
                 * Removes all points from the BLGTree.
                 */

            }, {
                key: "clear",
                value: function clear() {
                    this.rootNode = null;
                    this.traversalVector.length = 0;
                    this.previousTraversalMinImportance = -1;
                }
            }, {
                key: "isEmpty",
                get: function get() {
                    return this.rootNode == null;
                }
            }], [{
                key: "assertTrue",
                value: function assertTrue(bool) {
                    if (!bool) throw new Error("Assertion failed");
                }
            }, {
                key: "assertValid",
                value: function assertValid(node, assertNode) {
                    if (!node) return;
                    assertNode(node);
                    if (node.left) {
                        BLGTree.assertTrue(node.left.index < node.index);
                        BLGTree.assertValid(node.left, assertNode);
                    }
                    if (node.right) {
                        BLGTree.assertTrue(node.index < node.right.index);
                        BLGTree.assertValid(node.right, assertNode);
                    }
                }
            }]);

            return BLGTree;
        }();

        BLGTree.OP_VISIT = 0; // constant used with operationStack
        BLGTree.OP_TRAVERSE = 1; // constant used with operationStack
        geom.BLGTree = BLGTree;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        /**
         * This class defines a single node for a KDTree.  It corresponds to a splitting
         * plane in a single dimension and maps a k-dimensional key to an object.
         * This class should not be used outside the KDTree class definition.
         *
         * @author adufilie
         */
        var KDNode = function () {
            function KDNode() {
                _classCallCheck(this, KDNode);

                /**
                 * The numbers in K-Dimensions used to locate the object
                 */
                this.key = [];
                /**
                 * Child node corresponding to the left side of the splitting plane
                 */
                this.left = null;
                /**
                 * Child node corresponding to the right side of the splitting plane
                 */
                this.right = null;
            }
            /**
             * This function does what the name says.  It can be used for tree balancing algorithms.
             * @param value the new split dimension
             */


            _createClass(KDNode, [{
                key: "clearChildrenAndSetSplitDimension",
                value: function clearChildrenAndSetSplitDimension() {
                    var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;

                    this.left = null;
                    this.right = null;
                    this.splitDimension = value;
                    this.location = this.key[this.splitDimension];
                }
            }]);

            return KDNode;
        }();
        KDNode = __decorate([Weave.classInfo({ id: "weavejs.geom.KDNode" })], KDNode);
        geom.KDNode = KDNode;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        /**
         * This class defines a 1-dimensional continuous range of values by begin and end values.
         * The difference between the begin and end values can be either positive or negative.
         *
         * @author adufilie
         */
        var NumericRange = function () {
            function NumericRange() {
                var begin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NaN;
                var end = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : NaN;

                _classCallCheck(this, NumericRange);

                this.begin = begin;
                this.end = end;
            }
            /**
             * @param value A number within this Range
             * @return A number in the range [0,1]
             */


            _createClass(NumericRange, [{
                key: "normalize",
                value: function normalize(value) {
                    if (value == this.end) return 1;
                    return (value - this.begin) / (this.end - this.begin);
                }
                /**
                 * @param A number in the range [0,1]
                 * @return A number within this Range
                 */

            }, {
                key: "denormalize",
                value: function denormalize(value) {
                    return this.begin + (this.end - this.begin) * value;
                }
                /**
                 * This is the minimum value of the range.
                 */

            }, {
                key: "setRange",

                /**
                 * @param begin The new begin value.
                 * @param end The new end value.
                 */
                value: function setRange(begin, end) {
                    this.begin = begin;
                    this.end = end;
                }
                /**
                 * This will shift the begin and end values by a delta value.
                 */

            }, {
                key: "offset",
                value: function offset(delta) {
                    this.begin += delta;
                    this.end += delta;
                }
                /**
                 * This function will constrain a value to be within this Range.
                 * @return A number contained in this Range.
                 */

            }, {
                key: "constrain",
                value: function constrain(value) {
                    if (this.begin < this.end) return Math.max(this.begin, Math.min(value, this.end));
                    return Math.max(this.end, Math.min(value, this.begin));
                }
                /**
                 * @param value A number to check
                 * @return true if the given value is within this Range
                 */

            }, {
                key: "contains",
                value: function contains(value) {
                    if (this.begin < this.end) return this.begin <= value && value <= this.end;
                    return this.end <= value && value <= this.begin;
                }
                /**
                 * @param value A number to check
                 * @return -1 if value &lt; min, 1 if value &gt; max, 0 if min &lt;= value &lt;= max, or NaN otherwise
                 */

            }, {
                key: "compare",
                value: function compare(value) {
                    var min = this.min;
                    var max = this.max;
                    if (value < min) return -1;
                    if (value > max) return 1;
                    if (min <= value && value <= max) return 0;
                    return NaN;
                }
                /**
                 * This function will reposition another Range object
                 * such that one range will completely contain the other.
                 * @param rangeToConstrain The range to be repositioned.
                 * @param allowShrinking If set to true, the rangeToConstrain may be resized to fit within this range.
                 */

            }, {
                key: "constrainRange",
                value: function constrainRange(rangeToConstrain) {
                    var allowShrinking = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                    // don't constrain if this range is NaN
                    if (isNaN(this.coverage)) return;
                    if (rangeToConstrain.coverage < this.coverage) {
                        // shift rangeToConstrain enough so it is contained within this Range.
                        if (rangeToConstrain.min < this.min) rangeToConstrain.offset(this.min - rangeToConstrain.min);else if (rangeToConstrain.max > this.max) rangeToConstrain.offset(this.max - rangeToConstrain.max);
                    } else if (allowShrinking) {
                        // rangeToConstrain should be resized to fit within this Range.
                        rangeToConstrain.setRange(this.begin, this.end);
                    } else {
                        // shift rangeToConstrain enough so it contains this Range
                        if (rangeToConstrain.min > this.min) rangeToConstrain.offset(this.min - rangeToConstrain.min);else if (rangeToConstrain.max < this.max) rangeToConstrain.offset(this.max - rangeToConstrain.max);
                    }
                }
                /**
                 * This function will expand the range as necessary to include the specified value.
                 * @param value The value to include in the range.
                 */

            }, {
                key: "includeInRange",
                value: function includeInRange(value) {
                    if (this.end < this.begin) {
                        if (value < this.end) this.end = value;
                        if (value > this.begin) this.begin = value;
                    } else {
                        if (value < this.begin) this.begin = value;
                        if (value > this.end) this.end = value;
                    }
                }
            }, {
                key: "toString",
                value: function toString() {
                    return "[" + this.begin.toFixed(2) + " to " + this.end.toFixed(2) + "]";
                }
            }, {
                key: "min",
                get: function get() {
                    return Math.min(this.begin, this.end);
                }
                /**
                 * This is the maximum value of the range.
                 */

            }, {
                key: "max",
                get: function get() {
                    return Math.max(this.begin, this.end);
                }
                /**
                 * The coverage of a Range is defined by the positive distance
                 * from the min numeric value to the max numeric value.
                 */

            }, {
                key: "coverage",
                get: function get() {
                    return Math.abs(this.end - this.begin);
                }
            }]);

            return NumericRange;
        }();

        geom.NumericRange = NumericRange;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        /**
         * This class defines a 1-dimensional continuous range of values by begin and end values.
         * The difference between the begin and end values can be either positive or negative.
         *
         * @author adufilie
         */
        var Range = function () {
            function Range() {
                var begin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NaN;
                var end = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : NaN;

                _classCallCheck(this, Range);

                this.begin = begin;
                this.end = end;
            }
            /**
             * @param value A number within this Range
             * @return A number in the range [0,1]
             */


            _createClass(Range, [{
                key: "normalize",
                value: function normalize(value) {
                    if (value == this.end) return 1;
                    return (value - this.begin) / (this.end - this.begin);
                }
                /**
                 * @param A number in the range [0,1]
                 * @return A number within this Range
                 */

            }, {
                key: "denormalize",
                value: function denormalize(value) {
                    return this.begin + (this.end - this.begin) * value;
                }
                /**
                 * This is the minimum value of the range.
                 */

            }, {
                key: "setRange",

                /**
                 * @param begin The new begin value.
                 * @param end The new end value.
                 */
                value: function setRange(begin, end) {
                    this.begin = begin;
                    this.end = end;
                }
                /**
                 * This will shift the begin and end values by a delta value.
                 */

            }, {
                key: "offset",
                value: function offset(delta) {
                    this.begin += delta;
                    this.end += delta;
                }
                /**
                 * This function will constrain a value to be within this Range.
                 * @return A number contained in this Range.
                 */

            }, {
                key: "constrain",
                value: function constrain(value) {
                    if (this.begin < this.end) return Math.max(this.begin, Math.min(value, this.end));
                    return Math.max(this.end, Math.min(value, this.begin));
                }
                /**
                 * @param value A number to check
                 * @return true if the given value is within this Range
                 */

            }, {
                key: "contains",
                value: function contains(value) {
                    if (this.begin < this.end) return this.begin <= value && value <= this.end;
                    return this.end <= value && value <= this.begin;
                }
                /**
                 * @param value A number to check
                 * @return -1 if value &lt; min, 1 if value &gt; max, 0 if min &lt;= value &lt;= max, or NaN otherwise
                 */

            }, {
                key: "compare",
                value: function compare(value) {
                    var min = this.min;
                    var max = this.max;
                    if (value < min) return -1;
                    if (value > max) return 1;
                    if (min <= value && value <= max) return 0;
                    return NaN;
                }
                /**
                 * This function will reposition another Range object
                 * such that one range will completely contain the other.
                 * @param rangeToConstrain The range to be repositioned.
                 * @param allowShrinking If set to true, the rangeToConstrain may be resized to fit within this range.
                 */

            }, {
                key: "constrainRange",
                value: function constrainRange(rangeToConstrain) {
                    var allowShrinking = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                    // don't constrain if this range is NaN
                    if (isNaN(this.coverage)) return;
                    if (rangeToConstrain.coverage < this.coverage) {
                        // shift rangeToConstrain enough so it is contained within this Range.
                        if (rangeToConstrain.min < this.min) rangeToConstrain.offset(this.min - rangeToConstrain.min);else if (rangeToConstrain.max > this.max) rangeToConstrain.offset(this.max - rangeToConstrain.max);
                    } else if (allowShrinking) {
                        // rangeToConstrain should be resized to fit within this Range.
                        rangeToConstrain.setRange(this.begin, this.end);
                    } else {
                        // shift rangeToConstrain enough so it contains this Range
                        if (rangeToConstrain.min > this.min) rangeToConstrain.offset(this.min - rangeToConstrain.min);else if (rangeToConstrain.max < this.max) rangeToConstrain.offset(this.max - rangeToConstrain.max);
                    }
                }
                /**
                 * This function will expand the range as necessary to include the specified value.
                 * @param value The value to include in the range.
                 */

            }, {
                key: "includeInRange",
                value: function includeInRange(value) {
                    if (this.end < this.begin) {
                        if (value < this.end) this.end = value;
                        if (value > this.begin) this.begin = value;
                    } else {
                        if (value < this.begin) this.begin = value;
                        if (value > this.end) this.end = value;
                    }
                }
            }, {
                key: "toString",
                value: function toString() {
                    return "[" + this.begin.toFixed(2) + " to " + this.end.toFixed(2) + "]";
                }
            }, {
                key: "min",
                get: function get() {
                    return Math.min(this.begin, this.end);
                }
                /**
                 * This is the maximum value of the range.
                 */

            }, {
                key: "max",
                get: function get() {
                    return Math.max(this.begin, this.end);
                }
                /**
                 * The coverage of a Range is defined by the positive distance
                 * from the min numeric value to the max numeric value.
                 */

            }, {
                key: "coverage",
                get: function get() {
                    return Math.abs(this.end - this.begin);
                }
            }]);

            return Range;
        }();

        geom.Range = Range;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        /**
         * VertexChainLink
         * @author adufilie
         */
        var VertexChainLink = function () {
            function VertexChainLink(vertexID, x, y) {
                _classCallCheck(this, VertexChainLink);

                this.initialize(vertexID, x, y);
            }

            _createClass(VertexChainLink, [{
                key: "initialize",
                value: function initialize(vertexID, x, y) {
                    this.vertexID = vertexID;
                    this.x = x;
                    this.y = y;
                    this.importance = -1;
                    this.importanceIsValid = false;
                    // make this vertex adjacent to itself
                    this.prev = this;
                    this.next = this;
                }
                /**
                 * insert
                 * Adds a new vertex to the end of the chain.
                 */

            }, {
                key: "insert",
                value: function insert(newVertex) {
                    this.prev.next = newVertex; // add new vertex to end of chain
                    newVertex.prev = this.prev; // the current last vertex appears before the new one
                    newVertex.next = this; // the new vertex wraps around to this one
                    this.prev = newVertex; // this vertex wraps backwards around to the new one
                }
                /**
                 * equals2D
                 * Returns true if x and y are equal between two VertexChainLink objects.
                 */

            }, {
                key: "equals2D",
                value: function equals2D(other) {
                    return this.x == other.x && this.y == other.y;
                }
                /**
                 * removeFromChain
                 * Updates prev and next pointers on adjacent VertexChainLinks so this link is removed.
                 */

            }, {
                key: "removeFromChain",
                value: function removeFromChain() {
                    // promote adjacent vertices and invalidate their importance
                    this.prev.promoteAndInvalidateImportance(this.importance);
                    this.next.promoteAndInvalidateImportance(this.importance);
                    // make next and prev adjacent to each other
                    this.prev.next = this.next;
                    this.next.prev = this.prev;
                    // make this vertex adjacent to itself
                    this.prev = this;
                    this.next = this;
                    VertexChainLink.saveUnusedInstance(this);
                }
                /**
                 * promoteAndInvalidateImportance
                 * @param minImportance If the importance value of this vertex is less than minImportance, it will be set to minImportance.
                 */

            }, {
                key: "promoteAndInvalidateImportance",
                value: function promoteAndInvalidateImportance(minImportance) {
                    this.importance = Math.max(this.importance, minImportance);
                    this.importanceIsValid = false;
                }
                /**
                 * updateImportance
                 * This function re-calculates the importance of the current point.
                 * It may only increase the importance, not decrease it.
                 */

            }, {
                key: "validateImportance",
                value: function validateImportance() {
                    this.importanceIsValid = true;
                    // stop if already marked required
                    if (this.importance == Infinity) return;
                    // the importance of a point is the area formed by it and its two neighboring points
                    // update importance
                    //TODO: use distance as well as area in determining importance?
                    var area = this.areaOfTriangle(this.prev, this, this.next);
                    this.importance = Math.max(this.importance, area);
                }
                /**
                 * areaOfTriangle
                 * @param a First point in a triangle.
                 * @param b Second point in a triangle.
                 * @param c Third point in a triangle.
                 * @return The area of the triangle ABC.
                 */

            }, {
                key: "areaOfTriangle",
                value: function areaOfTriangle(a, b, c) {
                    // http://www.softsurfer.com/Archive/algorithm_0101/algorithm_0101.htm
                    // get signed area of the triangle formed by three points
                    var signedArea = ((b.x - a.x) * (c.y - a.y) - (c.x - a.x) * (b.y - a.y)) / 2;
                    // return absolute value
                    if (signedArea < 0) return -signedArea;
                    return signedArea;
                }
            }], [{
                key: "getUnusedInstance",
                value: function getUnusedInstance(vertexID, x, y) {
                    if (VertexChainLink.unusedInstances.length > 0) {
                        var link = VertexChainLink.unusedInstances.pop();
                        link.initialize(vertexID, x, y);
                    }
                    return new VertexChainLink(vertexID, x, y);
                }
            }, {
                key: "saveUnusedInstance",
                value: function saveUnusedInstance(vertex) {
                    vertex.prev = vertex.next = null;
                    VertexChainLink.unusedInstances.push(vertex);
                }
            }, {
                key: "clearUnusedInstances",
                value: function clearUnusedInstances() {
                    VertexChainLink.unusedInstances.length = 0;
                }
            }]);

            return VertexChainLink;
        }();

        VertexChainLink.unusedInstances = [];
        /**
         * The importance property name.
         */
        VertexChainLink.IMPORTANCE = 'importance';
        geom.VertexChainLink = VertexChainLink;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var CenteredIcon = function (_React$Component) {
            _inherits(CenteredIcon, _React$Component);

            function CenteredIcon(props) {
                _classCallCheck(this, CenteredIcon);

                return _possibleConstructorReturn(this, (CenteredIcon.__proto__ || Object.getPrototypeOf(CenteredIcon)).call(this, props));
            }

            _createClass(CenteredIcon, [{
                key: "render",
                value: function render() {
                    return React.createElement(
                        "button",
                        _extends({}, this.props, { className: classNames("weave-transparent-button", this.props.className || "weave-icon") }),
                        this.props.children || React.createElement("i", _extends({ "aria-hidden": true }, this.props.iconProps))
                    );
                }
            }]);

            return CenteredIcon;
        }(React.Component);

        ui.CenteredIcon = CenteredIcon;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var DynamicComponent = function (_React$Component2) {
            _inherits(DynamicComponent, _React$Component2);

            function DynamicComponent(props) {
                _classCallCheck(this, DynamicComponent);

                var _this3 = _possibleConstructorReturn(this, (DynamicComponent.__proto__ || Object.getPrototypeOf(DynamicComponent)).call(this, props));

                DynamicComponent.setDependencies(_this3, props.dependencies);
                return _this3;
            }

            _createClass(DynamicComponent, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(newProps) {
                    DynamicComponent.setDependencies(this, newProps.dependencies);
                }
            }, {
                key: "render",
                value: function render() {
                    return this.props.render && this.props.render();
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    DynamicComponent.setDependencies(this, []);
                }
            }], [{
                key: "setDependencies",
                value: function setDependencies(component, dependencies) {
                    var oldDeps = DynamicComponent.map_component_dependencies.get(component);
                    var newDeps = new Set(dependencies && dependencies.filter(_.identity));
                    var _iteratorNormalCompletion = true;
                    var _didIteratorError = false;
                    var _iteratorError = undefined;

                    try {
                        for (var _iterator = newDeps[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                            var dep = _step.value;

                            if (!oldDeps || !oldDeps.has(dep)) Weave.getCallbacks(dep).addGroupedCallback(component, component.forceUpdate);
                        }
                    } catch (err) {
                        _didIteratorError = true;
                        _iteratorError = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion && _iterator.return) {
                                _iterator.return();
                            }
                        } finally {
                            if (_didIteratorError) {
                                throw _iteratorError;
                            }
                        }
                    }

                    if (oldDeps) {
                        var _iteratorNormalCompletion2 = true;
                        var _didIteratorError2 = false;
                        var _iteratorError2 = undefined;

                        try {
                            for (var _iterator2 = oldDeps[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                                var _dep = _step2.value;

                                if (!newDeps.has(_dep)) Weave.getCallbacks(_dep).removeCallback(component, component.forceUpdate);
                            }
                        } catch (err) {
                            _didIteratorError2 = true;
                            _iteratorError2 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion2 && _iterator2.return) {
                                    _iterator2.return();
                                }
                            } finally {
                                if (_didIteratorError2) {
                                    throw _iteratorError2;
                                }
                            }
                        }
                    }DynamicComponent.map_component_dependencies.set(component, newDeps);
                }
            }]);

            return DynamicComponent;
        }(React.Component);

        DynamicComponent.map_component_dependencies = new WeakMap();
        ui.DynamicComponent = DynamicComponent;
        weavejs.WeaveAPI.ClassRegistry.registerClass(DynamicComponent, 'weavejs.ui.DynamicComponent');
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var FileInput = function (_React$Component3) {
            _inherits(FileInput, _React$Component3);

            function FileInput(props) {
                _classCallCheck(this, FileInput);

                var _this4 = _possibleConstructorReturn(this, (FileInput.__proto__ || Object.getPrototypeOf(FileInput)).call(this, props));

                _this4.onChange = function (e) {
                    if (_this4.props.onChange) _this4.props.onChange(e);
                    // Might need to simulate the click event we previously stopped
                    // DOMUtils.eventFire(ReactDOM.findDOMNode(this) as HTMLElement, "click");
                };
                _this4.handleClick = function (e) {
                    e.stopPropagation(); // prevent the click event from running on the menubar
                    // which causes the file menu to be unmounted
                };
                return _this4;
            }

            _createClass(FileInput, [{
                key: "render",
                value: function render() {
                    var _this5 = this;

                    //value prop on input = "" because it allows us to load the same file again by clearing the value explicitly
                    var style = this.props.style || {};
                    style.position = "relative";
                    var props = _.clone(this.props);
                    delete props.children;
                    return React.createElement(
                        "div",
                        { onClick: function onClick(e) {
                                return _this5.input.click();
                            }, style: { position: "relative", display: "flex" }, className: "ui fluid action input " + this.props.className },
                        React.createElement("input", _extends({ ref: function ref(c) {
                                return _this5.input = c;
                            }, type: "file", value: "", onClick: this.handleClick }, props, { onChange: this.onChange, style: { display: "none" } })),
                        this.props.children
                    );
                }
            }]);

            return FileInput;
        }(React.Component);

        ui.FileInput = FileInput;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var Input = function (_React$Component4) {
            _inherits(Input, _React$Component4);

            function Input(props) {
                _classCallCheck(this, Input);

                return _possibleConstructorReturn(this, (Input.__proto__ || Object.getPrototypeOf(Input)).call(this, props));
            }

            _createClass(Input, [{
                key: "render",
                value: function render() {
                    var _this7 = this;

                    var inputProps = {};
                    // since typescript doesn't support destructuring yet
                    // we manually remove children from props
                    for (var key in this.props) {
                        if (key != "children") {
                            inputProps[key] = this.props[key];
                        }
                    }
                    delete inputProps.title;
                    delete inputProps.className;
                    delete inputProps.style;
                    var inputClass = classNames({
                        'ui input': true,
                        'fluid': this.props.fluid,
                        'disabled': this.props.disabled
                    }, this.props.className);
                    return React.createElement(
                        "div",
                        { className: inputClass, style: this.props.style },
                        React.createElement("input", _extends({}, inputProps, { ref: function ref(c) {
                                return _this7.inputElement = c;
                            } })),
                        this.props.children
                    );
                }
            }]);

            return Input;
        }(React.Component);

        Input.defaultProps = {
            fluid: true,
            disabled: false
        };
        ui.Input = Input;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var ILinkableVariable = weavejs.api.core.ILinkableVariable;
        var LinkableVariable = weavejs.core.LinkableVariable;

        var LinkableDynamicComponent = function (_React$Component5) {
            _inherits(LinkableDynamicComponent, _React$Component5);

            function LinkableDynamicComponent() {
                var _ref;

                _classCallCheck(this, LinkableDynamicComponent);

                for (var _len = arguments.length, args = Array(_len), _key2 = 0; _key2 < _len; _key2++) {
                    args[_key2] = arguments[_key2];
                }

                var _this8 = _possibleConstructorReturn(this, (_ref = LinkableDynamicComponent.__proto__ || Object.getPrototypeOf(LinkableDynamicComponent)).call.apply(_ref, [this].concat(args)));

                _this8.linkableState = Weave.linkableChild(_this8, LinkableVariable, _this8.forceUpdate, true);
                _this8.refHandler = function (instance) {
                    if (instance instanceof React.Component) Weave.disposableChild(_this8, instance);
                };
                return _this8;
            }

            _createClass(LinkableDynamicComponent, [{
                key: "getSessionState",
                value: function getSessionState() {
                    return this.linkableState.state;
                }
            }, {
                key: "setSessionState",
                value: function setSessionState(value) {
                    this.linkableState.state = value;
                }
            }, {
                key: "render",
                value: function render() {
                    return this.renderFromState(this.linkableState.state);
                }
            }, {
                key: "renderFromState",
                value: function renderFromState(state) {
                    if ((typeof state === "undefined" ? "undefined" : _typeof(state)) != 'object') return state;
                    var ComponentClass = state ? Weave.getDefinition(state.class) : null;
                    if (!ComponentClass) return null;
                    var props = _.omit(state, 'class');
                    if (!Array.isArray(props.children)) props.children = [props.children];
                    props.children = props.children.map(this.renderFromState, this);
                    if (Array.isArray(props.children) && props.children.length == 1) props.children = props.children[0];
                    return React.createElement(ComponentClass, _extends({ ref: this.refHandler }, props));
                }
            }]);

            return LinkableDynamicComponent;
        }(React.Component);

        LinkableDynamicComponent.WEAVE_INFO = Weave.setClassInfo(LinkableDynamicComponent, {
            id: 'weavejs.ui.LinkableDynamicComponent',
            interfaces: [ILinkableVariable]
        });
        ui.LinkableDynamicComponent = LinkableDynamicComponent;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var LogComponent = function (_React$Component6) {
            _inherits(LogComponent, _React$Component6);

            function LogComponent(props) {
                _classCallCheck(this, LogComponent);

                return _possibleConstructorReturn(this, (LogComponent.__proto__ || Object.getPrototypeOf(LogComponent)).call(this, props));
            }

            _createClass(LogComponent, [{
                key: "render",
                value: function render() {
                    if (this.props.messages.length) {
                        return React.createElement(
                            "div",
                            _extends({ className: ["ui", this.props.uiClass || "negative", "message"].join(" ") }, this.props),
                            React.createElement("i", { className: "close icon", onClick: this.props.clearFunc }),
                            React.createElement(
                                "div",
                                { className: "header" },
                                this.props.header
                            ),
                            React.createElement(
                                "ul",
                                { className: "list" },
                                this.props.messages.map(function (message, idx) {
                                    return React.createElement(
                                        "li",
                                        { key: idx },
                                        message
                                    );
                                })
                            )
                        );
                    } else {
                        return React.createElement("div", null);
                    }
                }
            }]);

            return LogComponent;
        }(React.Component);

        ui.LogComponent = LogComponent;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var toolOverlayStyle = {
            background: "#000",
            opacity: .2,
            boxSizing: "border-box",
            backgroundClip: "padding",
            position: "absolute",
            visibility: "hidden",
            pointerEvents: "none"
        };

        var PanelOverlay = function (_React$Component7) {
            _inherits(PanelOverlay, _React$Component7);

            function PanelOverlay(props) {
                _classCallCheck(this, PanelOverlay);

                var _this10 = _possibleConstructorReturn(this, (PanelOverlay.__proto__ || Object.getPrototypeOf(PanelOverlay)).call(this, props));

                _this10.state = {
                    style: _.clone(toolOverlayStyle)
                };
                return _this10;
            }

            _createClass(PanelOverlay, [{
                key: "render",
                value: function render() {
                    return React.createElement("div", { style: this.state.style });
                }
            }]);

            return PanelOverlay;
        }(React.Component);

        ui.PanelOverlay = PanelOverlay;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        /* stateless component */
        function ProgressBar(props) {
            return React.createElement(
                "div",
                _extends({}, props, { className: classNames("weave-progress-bar-background", props.className), style: _.merge({ width: "100%", position: "relative" }, props.style) }),
                props.visible ? React.createElement("div", { className: "weave-progress-bar", style: { width: (props.progressValue || 0) / (props.total || 1) * 100 + "%", position: "absolute" } }) : null
            );
        }
        ui.ProgressBar = ProgressBar;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var StatefulRangeSlider = function (_React$Component8) {
            _inherits(StatefulRangeSlider, _React$Component8);

            function StatefulRangeSlider(props) {
                _classCallCheck(this, StatefulRangeSlider);

                var _this11 = _possibleConstructorReturn(this, (StatefulRangeSlider.__proto__ || Object.getPrototypeOf(StatefulRangeSlider)).call(this, props));

                _this11.state = { value: 0 };
                _this11.handleInputChange = function (event) {
                    _this11.setState({ value: Number(event.target.value) });
                };
                return _this11;
            }

            _createClass(StatefulRangeSlider, [{
                key: "render",
                value: function render() {
                    var props = _.clone(this.props);
                    delete props.children;
                    var valueString = this.props.valueFormat ? this.props.valueFormat(this.state.value) : "";
                    return React.createElement(
                        "span",
                        null,
                        React.createElement("input", _extends({}, props, { onChange: this.handleInputChange, type: "range", value: this.state.value !== undefined && this.state.value.toString() })),
                        valueString
                    );
                }
            }]);

            return StatefulRangeSlider;
        }(React.Component);

        ui.StatefulRangeSlider = StatefulRangeSlider;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var flexbox;
        (function (flexbox) {
            var BoxProps = function () {
                function BoxProps() {
                    _classCallCheck(this, BoxProps);
                }

                _createClass(BoxProps, null, [{
                    key: "renderBox",
                    value: function renderBox(props, options) {
                        var attributes = _.omit(props, 'padded', 'overflow');
                        var style = _.merge({
                            display: "flex"
                        }, props.style, {
                            flexDirection: options.flexDirection
                        });
                        var className = classNames(props.padded ? options.paddedClassName : options.unpaddedClassName, { "weave-auto-overflow": !props.overflow }, props.className);
                        return React.createElement("div", _extends({}, attributes, { style: style, className: className }));
                    }
                }]);

                return BoxProps;
            }();

            flexbox.BoxProps = BoxProps;
        })(flexbox = ui.flexbox || (ui.flexbox = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var flexbox;
        (function (flexbox) {
            var Label = function (_React$Component9) {
                _inherits(Label, _React$Component9);

                function Label() {
                    _classCallCheck(this, Label);

                    return _possibleConstructorReturn(this, (Label.__proto__ || Object.getPrototypeOf(Label)).apply(this, arguments));
                }

                _createClass(Label, [{
                    key: "render",
                    value: function render() {
                        var style = _.merge({
                            overflow: "hidden",
                            textOverflow: "ellipsis"
                        }, this.props.style);
                        var className = classNames('weave-label', this.props.className);
                        return React.createElement("label", _extends({}, this.props, { style: style, className: className }));
                    }
                }]);

                return Label;
            }(React.Component);

            flexbox.Label = Label;
        })(flexbox = ui.flexbox || (ui.flexbox = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var flexbox;
        (function (flexbox) {
            var Section = function (_React$Component10) {
                _inherits(Section, _React$Component10);

                function Section() {
                    _classCallCheck(this, Section);

                    return _possibleConstructorReturn(this, (Section.__proto__ || Object.getPrototypeOf(Section)).apply(this, arguments));
                }

                _createClass(Section, [{
                    key: "render",
                    value: function render() {
                        return flexbox.BoxProps.renderBox(this.props, Section.options);
                    }
                }]);

                return Section;
            }(React.Component);

            Section.options = {
                flexDirection: "column",
                unpaddedClassName: classNames('weave-section', 'weave-vbox'),
                paddedClassName: classNames('weave-section', 'weave-padded-vbox')
            };
            flexbox.Section = Section;
        })(flexbox = ui.flexbox || (ui.flexbox = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        ;
        ;
        ;

        var MiscUtils = function () {
            function MiscUtils() {
                _classCallCheck(this, MiscUtils);
            }

            _createClass(MiscUtils, null, [{
                key: "rgba",

                /**
                 * Generates an "rgba()" string for CSS.
                 *
                 * @param r A number between 0 and 255.
                 * @param g A number between 0 and 255.
                 * @param b A number between 0 and 255.
                 * @param a A number between 0 and 1.
                 * @return an "rgba()" string for CSS
                 */
                value: function rgba(r, g, b, a) {
                    return "rgba(" + r + "," + g + "," + b + "," + a + ")";
                }
                /**
                 * Generates an "rgba()" string for CSS.
                 *
                 * @param rgb A number between 0x000000 and 0xFFFFFF.
                 * @param a A number between 0 and 1.
                 * @return an "rgba()" string for CSS
                 */

            }, {
                key: "rgb_a",
                value: function rgb_a(rgb, a) {
                    return "rgba(" + ((rgb & 0xFF0000) >> 16) + "," + ((rgb & 0x00FF00) >> 8) + "," + (rgb & 0x0000FF) + "," + a + ")";
                }
                /**
                 * Generates an "rgba()" string for CSS.
                 *
                 * @param hex  A hexidecimal between 000000 and FFFFFF.
                 * @param a   A number between 0 and 1.
                 */

            }, {
                key: "hex2rgba",
                value: function hex2rgba(hex, a) {
                    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
                    hex = hex.replace(shorthandRegex, function (m, r, g, b) {
                        return r + r + g + g + b + b;
                    });
                    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                    return "rgba(" + parseInt(result[1], 16) + "," + parseInt(result[2], 16) + "," + parseInt(result[3], 16) + "," + a + ")";
                }
                /**
                 * Searches for the first nested object with matching properties
                 *
                 * @param root The root Object.
                 * @param match Either an Object with properties to match, or a Function that checks for a match.
                 *
                 * @returns returns an object with the matching properties
                 */

            }, {
                key: "findDeep",
                value: function findDeep(root, match /*, matchArrayLength:boolean = true*/) {
                    if (typeof match !== "function") {
                        // for lodash 4.0.0
                        // * @param matchArrayLength Specifies whether or not array length should be considered when comparing objects.
                        /*if (matchArrayLength)
                            match = (obj:any) => _.isMatchWith(obj, match, (obj:any, src:any) => {
                                var objIsArray = Array.isArray(obj);
                                var srcIsArray = Array.isArray(src);
                                if (objIsArray || srcIsArray)
                                    if (!objIsArray || !srcIsArray || obj.length != src.length)
                                        return false;
                            });
                        else*/
                        match = _.matches(match);
                    }
                    if (match(root)) return root;
                    if ((typeof root === "undefined" ? "undefined" : _typeof(root)) == "object") {
                        var key;
                        for (key in root) {
                            var found = this.findDeep(root[key], match);
                            if (found) return found;
                        }
                    }
                }
                /**
                 * Temporary polyfill workaround for String.startsWith for projects that are
                 * targetting es5
                 *
                 * determines whether a string begins with the characters of another string,
                 * returning true or false as appropriate.
                 *
                 * @param str
                 *            {string} the str string in which to search for in
                 *            str.startsWith
                 * @param searchString
                 *            {string} The characters to be searched for at the start of
                 *            this string.
                 * @param position
                 *            {number?} Optional. The position in this string at which to
                 *            begin searching for searchString; defaults to 0.
                 *
                 * @returns true or false
                 *
                 */

            }, {
                key: "startsWith",
                value: function startsWith(str, searchString, position) {
                    position = position || 0;
                    return str.indexOf(searchString, position) === position;
                }
            }, {
                key: "resolveRelative",
                value: function resolveRelative(base, path) {
                    // Upper directory
                    if (MiscUtils.startsWith(path, "../")) return MiscUtils.resolveRelative(base.replace(/\/[^\/]*$/, ""), path.slice(3));
                    // Relative to the root
                    if (MiscUtils.startsWith(path, "/")) {
                        var match = base.match(/(\w*:\/\/)?[^\/]*\//) || [base];
                        return match[0] + path.slice(1);
                    }
                    // relative to the current directory
                    return base.replace(/\/[^\/]*$/, "") + "/" + path;
                }
                /**
                 *
                 * This function return and object whose keys are url parameters and value
                 */

            }, {
                key: "makeUrlParams",
                value: function makeUrlParams(queryParams) {
                    var queryParamString = "";
                    var queryParamArray = [];
                    var _iteratorNormalCompletion3 = true;
                    var _didIteratorError3 = false;
                    var _iteratorError3 = undefined;

                    try {
                        for (var _iterator3 = Object.keys(queryParams)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                            var key = _step3.value;

                            var value = queryParams[key];
                            queryParamArray.push(encodeURIComponent(key) + "=" + encodeURIComponent(value));
                        }
                    } catch (err) {
                        _didIteratorError3 = true;
                        _iteratorError3 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion3 && _iterator3.return) {
                                _iterator3.return();
                            }
                        } finally {
                            if (_didIteratorError3) {
                                throw _iteratorError3;
                            }
                        }
                    }

                    return queryParamArray.join("&");
                }
            }, {
                key: "getUrlParams",
                value: function getUrlParams() {
                    return MiscUtils.getParams(window.location.search.substring(1));
                }
            }, {
                key: "getHashParams",
                value: function getHashParams() {
                    return MiscUtils.getParams(window.location.hash.substring(1));
                }
            }, {
                key: "getParams",
                value: function getParams(query) {
                    if (!query) return {};
                    var queryParams = {};
                    var vars = query.split("&");
                    for (var i = 0; i < vars.length; i++) {
                        var name;
                        var pos = vars[i].indexOf('=');
                        var name = pos < 0 ? vars[i] : vars[i].substr(0, pos);
                        var value = pos < 0 ? undefined : decodeURIComponent(vars[i].substr(pos + 1));
                        if (typeof queryParams[name] === 'undefined') {
                            queryParams[name] = value;
                        } else if (typeof queryParams[name] === 'string') {
                            // second entry with this name
                            if (typeof value === 'string') queryParams[name] = [queryParams[name], value];
                        } else {
                            // third or later entry with this name
                            queryParams[name].push(value);
                        }
                    }
                    return queryParams;
                }
            }, {
                key: "evalTemplateString",
                value: function evalTemplateString(str) {
                    var thisArg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    try {
                        return str && util.JS.compile('`' + str + '`').call(thisArg);
                    } catch (e) {
                        return str;
                    }
                }
            }, {
                key: "_pickDefined",
                value: function _pickDefined(obj) {
                    for (var _len2 = arguments.length, keys = Array(_len2 > 1 ? _len2 - 1 : 0), _key3 = 1; _key3 < _len2; _key3++) {
                        keys[_key3 - 1] = arguments[_key3];
                    }

                    return MiscUtils._pickBy(_.pick(obj, keys), _.negate(_.isUndefined));
                }
            }, {
                key: "_pickBy",
                value: function _pickBy(obj, predicate) {
                    var result = {};
                    for (var key in obj) {
                        var value = obj[key];
                        if (predicate(value, key)) result[key] = value;
                    }
                    return result;
                }
                /**
                 * Tests if a value is an object with a single property.
                 * @param value An object to test.
                 * @return The single property name, or null if the given value was not an object with a single property.
                 */

            }, {
                key: "testSinglePropertyObject",
                value: function testSinglePropertyObject(value) {
                    if ((typeof value === "undefined" ? "undefined" : _typeof(value)) != 'object' || !value) return null;
                    var result = null;
                    for (var key in value) {
                        if (result == null) result = key;else return null;
                    }
                    return result;
                }
                // TODO needs documentation

            }, {
                key: "normalizeStructure",
                value: function normalizeStructure(value, structure) {
                    var nullable = false;
                    while (MiscUtils.testSinglePropertyObject(structure) == 'nullable') {
                        nullable = true;
                        structure = structure.nullable;
                    }
                    if (Array.isArray(structure)) {
                        var a = Array.isArray(value) ? value : null;
                        if (!a && nullable) return null;
                        return _.map(a, function (item) {
                            return MiscUtils.normalizeStructure(item, structure[0]);
                        });
                    } else if ((typeof structure === "undefined" ? "undefined" : _typeof(structure)) == "object" && structure) {
                        if (!value && nullable) return null;
                        var o = {};
                        for (var key in structure) {
                            o[key] = MiscUtils.normalizeStructure(value && value[key], structure[key]);
                        }
                        return o;
                    } else if (typeof structure == "function") {
                        return structure(value);
                    } else if (structure == "string") {
                        return util.StandardLib.asString(value);
                    } else if (structure == "number") {
                        return util.StandardLib.asNumber(value);
                    } else if (structure == "boolean") {
                        return util.StandardLib.asBoolean(value);
                    }
                    return value === undefined ? null : value;
                }
            }, {
                key: "nullableStructure",
                value: function nullableStructure(structure) {
                    return { nullable: structure };
                }
            }]);

            return MiscUtils;
        }();

        util.MiscUtils = MiscUtils;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        var LinkableWatcher = weavejs.core.LinkableWatcher;
        var LinkablePlaceholder = weavejs.core.LinkablePlaceholder;
        var SessionManager = weavejs.core.SessionManager;
        // This makes Weave handle linkable React classes appropriately.
        Weave.registerAsyncClass(React.Component, function (component) {
            util.ReactUtils.onUnmount(component, function (component) {
                if (Weave.findPath(Weave.getOwner(component), component)) LinkablePlaceholder.replaceInstanceWithPlaceholder(component);
                Weave.dispose(component);
            });
        });
        var UNLINK = "unlinkReactState";
        var map_ref_mapping = new WeakMap();

        var WeaveReactUtils = function () {
            function WeaveReactUtils() {
                _classCallCheck(this, WeaveReactUtils);
            }

            _createClass(WeaveReactUtils, null, [{
                key: "unlinkReactState",
                value: function unlinkReactState(component) {
                    if (component && component.componentWillUpdate && component.componentWillUpdate[UNLINK]) component.componentWillUpdate[UNLINK]();
                }
            }, {
                key: "linkReactStateRef",
                value: function linkReactStateRef(context, mapping) {
                    var delay = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

                    if (weavejs.WeaveAPI.debugAsyncStack) var stackTrace = new Error("Stack trace for WeaveReactUtils.linkReactStateRef()");
                    var prevComponent;
                    return function (component) {
                        if (component) {
                            WeaveReactUtils.linkReactState(context, component, mapping, delay);
                            map_ref_mapping.set(component, mapping);
                        } else if (prevComponent) {
                            WeaveReactUtils.unlinkReactState(prevComponent);
                        }
                        prevComponent = component;
                    };
                }
            }, {
                key: "linkReactState",
                value: function linkReactState(context, component, mapping) {
                    var delay = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

                    if (!component) throw new Error("linkReactState(): component cannot be null");
                    WeaveReactUtils.unlinkReactState(component);
                    var localContext = Weave.disposableChild(context, {});
                    var reactState = component.state != null ? component.state : {};
                    var reactUpdateSpec = void 0;
                    var authority = _.isEqual(map_ref_mapping.get(component), mapping) ? updateWeaveState : updateReactState;
                    function updateReactState() {
                        var callingLater = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        //console.log('updateReactState(callingLater = ' + callingLater + ')', 'authority', !callingLater || authority == updateReactState, 'hasFocus', ReactUtils.hasFocus(component));
                        if (callingLater && authority != updateReactState) return;
                        // delay while component has focus because we don't want to overwrite something the user is actively typing
                        if (util.ReactUtils.hasFocus(component)) {
                            authority = updateReactState;
                            weavejs.WeaveAPI.Scheduler.callLater(localContext, updateReactState, [true]);
                            return;
                        }
                        authority = null;
                        var updatedReactState = React.addons.update(reactState, reactUpdateSpec);
                        if (!_.isEqual(reactState, updatedReactState)) component.setState(reactState = updatedReactState);
                    }
                    var delayedUpdateWeaveState = void 0;
                    function updateWeaveState() {
                        var callingLater = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        //console.log('updateWeaveState(callingLater = ' + callingLater + ')', 'authority', !callingLater || authority == updateWeaveState);
                        if (callingLater && authority != updateWeaveState) return;
                        // stop if context was disposed
                        if (Weave.wasDisposed(context)) {
                            WeaveReactUtils.unlinkReactState(component);
                            return;
                        }
                        // delay while component has focus
                        if (!callingLater && delay > 0 && util.ReactUtils.hasFocus(component)) {
                            authority = updateWeaveState;
                            delayedUpdateWeaveState();
                            return;
                        }
                        // update weave state
                        authority = null;
                        SessionManager.traverseAndSetState(reactState, mapping);
                        // Always update react state after setting weave state because
                        // callbacks won't get triggered if the weave state didn't change,
                        // and we want to make sure the react value matches the weave value.
                        updateReactState();
                    }
                    if (delay > 0) delayedUpdateWeaveState = _.debounce(updateWeaveState.bind(null, true), delay, { leading: false });
                    var mapValue = function mapValue(value) {
                        if (Weave.isLinkable(value)) {
                            Weave.getCallbacks(value).addGroupedCallback(localContext, updateReactState, false, false); // don't delay while busy
                            return {
                                get $set() {
                                    var state = Weave.getState(value);
                                    // Replace NaN with undefined because undefined is more likely to appear as "" when displayed as a string,
                                    // and undefined automatically converts back to NaN when used as a number.
                                    if (typeof state === 'number' && isNaN(state)) return undefined;
                                    return state;
                                }
                            };
                        }
                        return util.JS.isPrimitive(value) ? value : _.mapValues(value, mapValue);
                    };
                    reactUpdateSpec = mapValue(mapping);
                    var superComponentWillUpdate = component.componentWillUpdate;
                    function newComponentWillUpdate(nextProps, nextState, nextContext) {
                        // store nextState so it can be accessed and modified inside Weave callbacks
                        reactState = nextState;
                        // set weave state now before render
                        updateWeaveState();
                        // call original function with possibly-updated reactState
                        if (superComponentWillUpdate) superComponentWillUpdate.call(component, nextProps, reactState, nextContext);
                    }
                    newComponentWillUpdate[UNLINK] = function () {
                        component.componentWillUpdate = superComponentWillUpdate;
                        Weave.dispose(localContext);
                    };
                    component.componentWillUpdate = newComponentWillUpdate;
                    util.ReactUtils.onUnmount(component, WeaveReactUtils.unlinkReactState);
                    authority();
                }
                /**
                 * Shortcut for boilerplate code that creates a LinkableWatcher which calls forceUpdate() on a component.
                 */

            }, {
                key: "forceUpdateWatcher",
                value: function forceUpdateWatcher(component, type) {
                    var defaultPath = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    var watcher = Weave.disposableChild(component, new LinkableWatcher(type, null, component.forceUpdate.bind(component)));
                    if (defaultPath) watcher.targetPath = defaultPath;
                    return watcher;
                }
            }, {
                key: "requestObject",
                value: function requestObject(weave, path /* TODO change to WeavePathArray */, type, onCreate) {
                    var oldObject = weave.getObject(path);
                    weave.requestObject(path, type);
                    var newObject = weave.getObject(path);
                    var lp = Weave.AS(newObject, LinkablePlaceholder);
                    if (oldObject != newObject && lp) {
                        Weave.getCallbacks(lp).addDisposeCallback(this, function () {
                            if (onCreate && lp.getInstance()) onCreate(lp.getInstance());
                        });
                    }
                }
            }]);

            return WeaveReactUtils;
        }();

        util.WeaveReactUtils = WeaveReactUtils;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        function polyfill(window) {
            new window.Function("\n\n//SVGPathSeg API polyfill\n//https://github.com/progers/pathseg\n//\n//This is a drop-in replacement for the SVGPathSeg and SVGPathSegList APIs that were removed from\n//SVG2 (https://lists.w3.org/Archives/Public/www-svg/2015Jun/0044.html), including the latest spec\n//changes which were implemented in Firefox 43 and Chrome 46.\n//Chrome 48 removes these APIs, so this polyfill is required.\n\n(function() { \"use strict\";\n if (!(\"SVGPathSeg\" in window)) {\n     // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSeg\n     window.SVGPathSeg = function(type, typeAsLetter, owningPathSegList) {\n         this.pathSegType = type;\n         this.pathSegTypeAsLetter = typeAsLetter;\n         this._owningPathSegList = owningPathSegList;\n     }\n\n     SVGPathSeg.PATHSEG_UNKNOWN = 0;\n     SVGPathSeg.PATHSEG_CLOSEPATH = 1;\n     SVGPathSeg.PATHSEG_MOVETO_ABS = 2;\n     SVGPathSeg.PATHSEG_MOVETO_REL = 3;\n     SVGPathSeg.PATHSEG_LINETO_ABS = 4;\n     SVGPathSeg.PATHSEG_LINETO_REL = 5;\n     SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS = 6;\n     SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL = 7;\n     SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS = 8;\n     SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL = 9;\n     SVGPathSeg.PATHSEG_ARC_ABS = 10;\n     SVGPathSeg.PATHSEG_ARC_REL = 11;\n     SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS = 12;\n     SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL = 13;\n     SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS = 14;\n     SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL = 15;\n     SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS = 16;\n     SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL = 17;\n     SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS = 18;\n     SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL = 19;\n\n     // Notify owning PathSegList on any changes so they can be synchronized back to the path element.\n     SVGPathSeg.prototype._segmentChanged = function() {\n         if (this._owningPathSegList)\n             this._owningPathSegList.segmentChanged(this);\n     }\n\n     window.SVGPathSegClosePath = function(owningPathSegList) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CLOSEPATH, \"z\", owningPathSegList);\n     }\n     SVGPathSegClosePath.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegClosePath.prototype.toString = function() { return \"[object SVGPathSegClosePath]\"; }\n     SVGPathSegClosePath.prototype._asPathString = function() { return this.pathSegTypeAsLetter; }\n     SVGPathSegClosePath.prototype.clone = function() { return new SVGPathSegClosePath(undefined); }\n\n     window.SVGPathSegMovetoAbs = function(owningPathSegList, x, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_MOVETO_ABS, \"M\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n     }\n     SVGPathSegMovetoAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegMovetoAbs.prototype.toString = function() { return \"[object SVGPathSegMovetoAbs]\"; }\n     SVGPathSegMovetoAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegMovetoAbs.prototype.clone = function() { return new SVGPathSegMovetoAbs(undefined, this._x, this._y); }\n     Object.defineProperty(SVGPathSegMovetoAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegMovetoAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegMovetoRel = function(owningPathSegList, x, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_MOVETO_REL, \"m\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n     }\n     SVGPathSegMovetoRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegMovetoRel.prototype.toString = function() { return \"[object SVGPathSegMovetoRel]\"; }\n     SVGPathSegMovetoRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegMovetoRel.prototype.clone = function() { return new SVGPathSegMovetoRel(undefined, this._x, this._y); }\n     Object.defineProperty(SVGPathSegMovetoRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegMovetoRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegLinetoAbs = function(owningPathSegList, x, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_ABS, \"L\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n     }\n     SVGPathSegLinetoAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegLinetoAbs.prototype.toString = function() { return \"[object SVGPathSegLinetoAbs]\"; }\n     SVGPathSegLinetoAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegLinetoAbs.prototype.clone = function() { return new SVGPathSegLinetoAbs(undefined, this._x, this._y); }\n     Object.defineProperty(SVGPathSegLinetoAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegLinetoAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegLinetoRel = function(owningPathSegList, x, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_REL, \"l\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n     }\n     SVGPathSegLinetoRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegLinetoRel.prototype.toString = function() { return \"[object SVGPathSegLinetoRel]\"; }\n     SVGPathSegLinetoRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegLinetoRel.prototype.clone = function() { return new SVGPathSegLinetoRel(undefined, this._x, this._y); }\n     Object.defineProperty(SVGPathSegLinetoRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegLinetoRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoCubicAbs = function(owningPathSegList, x, y, x1, y1, x2, y2) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS, \"C\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._x1 = x1;\n         this._y1 = y1;\n         this._x2 = x2;\n         this._y2 = y2;\n     }\n     SVGPathSegCurvetoCubicAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoCubicAbs.prototype.toString = function() { return \"[object SVGPathSegCurvetoCubicAbs]\"; }\n     SVGPathSegCurvetoCubicAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x1 + \" \" + this._y1 + \" \" + this._x2 + \" \" + this._y2 + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoCubicAbs.prototype.clone = function() { return new SVGPathSegCurvetoCubicAbs(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2); }\n     Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, \"x1\", { get: function() { return this._x1; }, set: function(x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, \"y1\", { get: function() { return this._y1; }, set: function(y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, \"x2\", { get: function() { return this._x2; }, set: function(x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, \"y2\", { get: function() { return this._y2; }, set: function(y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoCubicRel = function(owningPathSegList, x, y, x1, y1, x2, y2) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL, \"c\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._x1 = x1;\n         this._y1 = y1;\n         this._x2 = x2;\n         this._y2 = y2;\n     }\n     SVGPathSegCurvetoCubicRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoCubicRel.prototype.toString = function() { return \"[object SVGPathSegCurvetoCubicRel]\"; }\n     SVGPathSegCurvetoCubicRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x1 + \" \" + this._y1 + \" \" + this._x2 + \" \" + this._y2 + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoCubicRel.prototype.clone = function() { return new SVGPathSegCurvetoCubicRel(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2); }\n     Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, \"x1\", { get: function() { return this._x1; }, set: function(x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, \"y1\", { get: function() { return this._y1; }, set: function(y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, \"x2\", { get: function() { return this._x2; }, set: function(x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, \"y2\", { get: function() { return this._y2; }, set: function(y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoQuadraticAbs = function(owningPathSegList, x, y, x1, y1) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS, \"Q\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._x1 = x1;\n         this._y1 = y1;\n     }\n     SVGPathSegCurvetoQuadraticAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoQuadraticAbs.prototype.toString = function() { return \"[object SVGPathSegCurvetoQuadraticAbs]\"; }\n     SVGPathSegCurvetoQuadraticAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x1 + \" \" + this._y1 + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoQuadraticAbs.prototype.clone = function() { return new SVGPathSegCurvetoQuadraticAbs(undefined, this._x, this._y, this._x1, this._y1); }\n     Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, \"x1\", { get: function() { return this._x1; }, set: function(x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, \"y1\", { get: function() { return this._y1; }, set: function(y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoQuadraticRel = function(owningPathSegList, x, y, x1, y1) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL, \"q\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._x1 = x1;\n         this._y1 = y1;\n     }\n     SVGPathSegCurvetoQuadraticRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoQuadraticRel.prototype.toString = function() { return \"[object SVGPathSegCurvetoQuadraticRel]\"; }\n     SVGPathSegCurvetoQuadraticRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x1 + \" \" + this._y1 + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoQuadraticRel.prototype.clone = function() { return new SVGPathSegCurvetoQuadraticRel(undefined, this._x, this._y, this._x1, this._y1); }\n     Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, \"x1\", { get: function() { return this._x1; }, set: function(x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, \"y1\", { get: function() { return this._y1; }, set: function(y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegArcAbs = function(owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_ARC_ABS, \"A\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._r1 = r1;\n         this._r2 = r2;\n         this._angle = angle;\n         this._largeArcFlag = largeArcFlag;\n         this._sweepFlag = sweepFlag;\n     }\n     SVGPathSegArcAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegArcAbs.prototype.toString = function() { return \"[object SVGPathSegArcAbs]\"; }\n     SVGPathSegArcAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._r1 + \" \" + this._r2 + \" \" + this._angle + \" \" + (this._largeArcFlag ? \"1\" : \"0\") + \" \" + (this._sweepFlag ? \"1\" : \"0\") + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegArcAbs.prototype.clone = function() { return new SVGPathSegArcAbs(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag); }\n     Object.defineProperty(SVGPathSegArcAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcAbs.prototype, \"r1\", { get: function() { return this._r1; }, set: function(r1) { this._r1 = r1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcAbs.prototype, \"r2\", { get: function() { return this._r2; }, set: function(r2) { this._r2 = r2; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcAbs.prototype, \"angle\", { get: function() { return this._angle; }, set: function(angle) { this._angle = angle; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcAbs.prototype, \"largeArcFlag\", { get: function() { return this._largeArcFlag; }, set: function(largeArcFlag) { this._largeArcFlag = largeArcFlag; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcAbs.prototype, \"sweepFlag\", { get: function() { return this._sweepFlag; }, set: function(sweepFlag) { this._sweepFlag = sweepFlag; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegArcRel = function(owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_ARC_REL, \"a\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._r1 = r1;\n         this._r2 = r2;\n         this._angle = angle;\n         this._largeArcFlag = largeArcFlag;\n         this._sweepFlag = sweepFlag;\n     }\n     SVGPathSegArcRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegArcRel.prototype.toString = function() { return \"[object SVGPathSegArcRel]\"; }\n     SVGPathSegArcRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._r1 + \" \" + this._r2 + \" \" + this._angle + \" \" + (this._largeArcFlag ? \"1\" : \"0\") + \" \" + (this._sweepFlag ? \"1\" : \"0\") + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegArcRel.prototype.clone = function() { return new SVGPathSegArcRel(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag); }\n     Object.defineProperty(SVGPathSegArcRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcRel.prototype, \"r1\", { get: function() { return this._r1; }, set: function(r1) { this._r1 = r1; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcRel.prototype, \"r2\", { get: function() { return this._r2; }, set: function(r2) { this._r2 = r2; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcRel.prototype, \"angle\", { get: function() { return this._angle; }, set: function(angle) { this._angle = angle; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcRel.prototype, \"largeArcFlag\", { get: function() { return this._largeArcFlag; }, set: function(largeArcFlag) { this._largeArcFlag = largeArcFlag; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegArcRel.prototype, \"sweepFlag\", { get: function() { return this._sweepFlag; }, set: function(sweepFlag) { this._sweepFlag = sweepFlag; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegLinetoHorizontalAbs = function(owningPathSegList, x) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS, \"H\", owningPathSegList);\n         this._x = x;\n     }\n     SVGPathSegLinetoHorizontalAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegLinetoHorizontalAbs.prototype.toString = function() { return \"[object SVGPathSegLinetoHorizontalAbs]\"; }\n     SVGPathSegLinetoHorizontalAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x; }\n     SVGPathSegLinetoHorizontalAbs.prototype.clone = function() { return new SVGPathSegLinetoHorizontalAbs(undefined, this._x); }\n     Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegLinetoHorizontalRel = function(owningPathSegList, x) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL, \"h\", owningPathSegList);\n         this._x = x;\n     }\n     SVGPathSegLinetoHorizontalRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegLinetoHorizontalRel.prototype.toString = function() { return \"[object SVGPathSegLinetoHorizontalRel]\"; }\n     SVGPathSegLinetoHorizontalRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x; }\n     SVGPathSegLinetoHorizontalRel.prototype.clone = function() { return new SVGPathSegLinetoHorizontalRel(undefined, this._x); }\n     Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegLinetoVerticalAbs = function(owningPathSegList, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS, \"V\", owningPathSegList);\n         this._y = y;\n     }\n     SVGPathSegLinetoVerticalAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegLinetoVerticalAbs.prototype.toString = function() { return \"[object SVGPathSegLinetoVerticalAbs]\"; }\n     SVGPathSegLinetoVerticalAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._y; }\n     SVGPathSegLinetoVerticalAbs.prototype.clone = function() { return new SVGPathSegLinetoVerticalAbs(undefined, this._y); }\n     Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegLinetoVerticalRel = function(owningPathSegList, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL, \"v\", owningPathSegList);\n         this._y = y;\n     }\n     SVGPathSegLinetoVerticalRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegLinetoVerticalRel.prototype.toString = function() { return \"[object SVGPathSegLinetoVerticalRel]\"; }\n     SVGPathSegLinetoVerticalRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._y; }\n     SVGPathSegLinetoVerticalRel.prototype.clone = function() { return new SVGPathSegLinetoVerticalRel(undefined, this._y); }\n     Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoCubicSmoothAbs = function(owningPathSegList, x, y, x2, y2) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS, \"S\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._x2 = x2;\n         this._y2 = y2;\n     }\n     SVGPathSegCurvetoCubicSmoothAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoCubicSmoothAbs.prototype.toString = function() { return \"[object SVGPathSegCurvetoCubicSmoothAbs]\"; }\n     SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x2 + \" \" + this._y2 + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoCubicSmoothAbs.prototype.clone = function() { return new SVGPathSegCurvetoCubicSmoothAbs(undefined, this._x, this._y, this._x2, this._y2); }\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, \"x2\", { get: function() { return this._x2; }, set: function(x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, \"y2\", { get: function() { return this._y2; }, set: function(y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoCubicSmoothRel = function(owningPathSegList, x, y, x2, y2) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL, \"s\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n         this._x2 = x2;\n         this._y2 = y2;\n     }\n     SVGPathSegCurvetoCubicSmoothRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoCubicSmoothRel.prototype.toString = function() { return \"[object SVGPathSegCurvetoCubicSmoothRel]\"; }\n     SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x2 + \" \" + this._y2 + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoCubicSmoothRel.prototype.clone = function() { return new SVGPathSegCurvetoCubicSmoothRel(undefined, this._x, this._y, this._x2, this._y2); }\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, \"x2\", { get: function() { return this._x2; }, set: function(x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, \"y2\", { get: function() { return this._y2; }, set: function(y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoQuadraticSmoothAbs = function(owningPathSegList, x, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS, \"T\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n     }\n     SVGPathSegCurvetoQuadraticSmoothAbs.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString = function() { return \"[object SVGPathSegCurvetoQuadraticSmoothAbs]\"; }\n     SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone = function() { return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, this._x, this._y); }\n     Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     window.SVGPathSegCurvetoQuadraticSmoothRel = function(owningPathSegList, x, y) {\n         SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL, \"t\", owningPathSegList);\n         this._x = x;\n         this._y = y;\n     }\n     SVGPathSegCurvetoQuadraticSmoothRel.prototype = Object.create(SVGPathSeg.prototype);\n     SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString = function() { return \"[object SVGPathSegCurvetoQuadraticSmoothRel]\"; }\n     SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString = function() { return this.pathSegTypeAsLetter + \" \" + this._x + \" \" + this._y; }\n     SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone = function() { return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, this._x, this._y); }\n     Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype, \"x\", { get: function() { return this._x; }, set: function(x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n     Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype, \"y\", { get: function() { return this._y; }, set: function(y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n     // Add createSVGPathSeg* functions to SVGPathElement.\n     // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathElement.\n     SVGPathElement.prototype.createSVGPathSegClosePath = function() { return new SVGPathSegClosePath(undefined); }\n     SVGPathElement.prototype.createSVGPathSegMovetoAbs = function(x, y) { return new SVGPathSegMovetoAbs(undefined, x, y); }\n     SVGPathElement.prototype.createSVGPathSegMovetoRel = function(x, y) { return new SVGPathSegMovetoRel(undefined, x, y); }\n     SVGPathElement.prototype.createSVGPathSegLinetoAbs = function(x, y) { return new SVGPathSegLinetoAbs(undefined, x, y); }\n     SVGPathElement.prototype.createSVGPathSegLinetoRel = function(x, y) { return new SVGPathSegLinetoRel(undefined, x, y); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs = function(x, y, x1, y1, x2, y2) { return new SVGPathSegCurvetoCubicAbs(undefined, x, y, x1, y1, x2, y2); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel = function(x, y, x1, y1, x2, y2) { return new SVGPathSegCurvetoCubicRel(undefined, x, y, x1, y1, x2, y2); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs = function(x, y, x1, y1) { return new SVGPathSegCurvetoQuadraticAbs(undefined, x, y, x1, y1); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel = function(x, y, x1, y1) { return new SVGPathSegCurvetoQuadraticRel(undefined, x, y, x1, y1); }\n     SVGPathElement.prototype.createSVGPathSegArcAbs = function(x, y, r1, r2, angle, largeArcFlag, sweepFlag) { return new SVGPathSegArcAbs(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag); }\n     SVGPathElement.prototype.createSVGPathSegArcRel = function(x, y, r1, r2, angle, largeArcFlag, sweepFlag) { return new SVGPathSegArcRel(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag); }\n     SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs = function(x) { return new SVGPathSegLinetoHorizontalAbs(undefined, x); }\n     SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel = function(x) { return new SVGPathSegLinetoHorizontalRel(undefined, x); }\n     SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs = function(y) { return new SVGPathSegLinetoVerticalAbs(undefined, y); }\n     SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel = function(y) { return new SVGPathSegLinetoVerticalRel(undefined, y); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs = function(x, y, x2, y2) { return new SVGPathSegCurvetoCubicSmoothAbs(undefined, x, y, x2, y2); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel = function(x, y, x2, y2) { return new SVGPathSegCurvetoCubicSmoothRel(undefined, x, y, x2, y2); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs = function(x, y) { return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, x, y); }\n     SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel = function(x, y) { return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, x, y); }\n }\n\n if (!(\"SVGPathSegList\" in window)) {\n     // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSegList\n     window.SVGPathSegList = function(pathElement) {\n         this._pathElement = pathElement;\n         this._list = this._parsePath(this._pathElement.getAttribute(\"d\"));\n\n         // Use a MutationObserver to catch changes to the path's \"d\" attribute.\n         this._mutationObserverConfig = { \"attributes\": true, \"attributeFilter\": [\"d\"] };\n         this._pathElementMutationObserver = new MutationObserver(this._updateListFromPathMutations.bind(this));\n         this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);\n     }\n\n     Object.defineProperty(SVGPathSegList.prototype, \"numberOfItems\", {\n         get: function() {\n             this._checkPathSynchronizedToList();\n             return this._list.length;\n         },\n         enumerable: true\n     });\n\n     // Add the pathSegList accessors to SVGPathElement.\n     // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGAnimatedPathData\n     Object.defineProperty(SVGPathElement.prototype, \"pathSegList\", {\n         get: function() {\n             if (!this._pathSegList)\n                 this._pathSegList = new SVGPathSegList(this);\n             return this._pathSegList;\n         },\n         enumerable: true\n     });\n     // FIXME: The following are not implemented and simply return SVGPathElement.pathSegList.\n     Object.defineProperty(SVGPathElement.prototype, \"normalizedPathSegList\", { get: function() { return this.pathSegList; }, enumerable: true });\n     Object.defineProperty(SVGPathElement.prototype, \"animatedPathSegList\", { get: function() { return this.pathSegList; }, enumerable: true });\n     Object.defineProperty(SVGPathElement.prototype, \"animatedNormalizedPathSegList\", { get: function() { return this.pathSegList; }, enumerable: true });\n\n     // Process any pending mutations to the path element and update the list as needed.\n     // This should be the first call of all public functions and is needed because\n     // MutationObservers are not synchronous so we can have pending asynchronous mutations.\n     SVGPathSegList.prototype._checkPathSynchronizedToList = function() {\n         this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords());\n     }\n\n     SVGPathSegList.prototype._updateListFromPathMutations = function(mutationRecords) {\n         if (!this._pathElement)\n             return;\n         var hasPathMutations = false;\n         mutationRecords.forEach(function(record) {\n             if (record.attributeName == \"d\")\n                 hasPathMutations = true;\n         });\n         if (hasPathMutations)\n             this._list = this._parsePath(this._pathElement.getAttribute(\"d\"));\n     }\n\n     // Serialize the list and update the path's 'd' attribute.\n     SVGPathSegList.prototype._writeListToPath = function() {\n         this._pathElementMutationObserver.disconnect();\n         this._pathElement.setAttribute(\"d\", SVGPathSegList._pathSegArrayAsString(this._list));\n         this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);\n     }\n\n     // When a path segment changes the list needs to be synchronized back to the path element.\n     SVGPathSegList.prototype.segmentChanged = function(pathSeg) {\n         this._writeListToPath();\n     }\n\n     SVGPathSegList.prototype.clear = function() {\n         this._checkPathSynchronizedToList();\n\n         this._list.forEach(function(pathSeg) {\n             pathSeg._owningPathSegList = null;\n         });\n         this._list = [];\n         this._writeListToPath();\n     }\n\n     SVGPathSegList.prototype.initialize = function(newItem) {\n         this._checkPathSynchronizedToList();\n\n         this._list = [newItem];\n         newItem._owningPathSegList = this;\n         this._writeListToPath();\n         return newItem;\n     }\n\n     SVGPathSegList.prototype._checkValidIndex = function(index) {\n         if (isNaN(index) || index < 0 || index >= this.numberOfItems)\n             throw \"INDEX_SIZE_ERR\";\n     }\n\n     SVGPathSegList.prototype.getItem = function(index) {\n         this._checkPathSynchronizedToList();\n\n         this._checkValidIndex(index);\n         return this._list[index];\n     }\n\n     SVGPathSegList.prototype.insertItemBefore = function(newItem, index) {\n         this._checkPathSynchronizedToList();\n\n         // Spec: If the index is greater than or equal to numberOfItems, then the new item is appended to the end of the list.\n         if (index > this.numberOfItems)\n             index = this.numberOfItems;\n         if (newItem._owningPathSegList) {\n             // SVG2 spec says to make a copy.\n             newItem = newItem.clone();\n         }\n         this._list.splice(index, 0, newItem);\n         newItem._owningPathSegList = this;\n         this._writeListToPath();\n         return newItem;\n     }\n\n     SVGPathSegList.prototype.replaceItem = function(newItem, index) {\n         this._checkPathSynchronizedToList();\n\n         if (newItem._owningPathSegList) {\n             // SVG2 spec says to make a copy.\n             newItem = newItem.clone();\n         }\n         this._checkValidIndex(index);\n         this._list[index] = newItem;\n         newItem._owningPathSegList = this;\n         this._writeListToPath();\n         return newItem;\n     }\n\n     SVGPathSegList.prototype.removeItem = function(index) {\n         this._checkPathSynchronizedToList();\n\n         this._checkValidIndex(index);\n         var item = this._list[index];\n         this._list.splice(index, 1);\n         this._writeListToPath();\n         return item;\n     }\n\n     SVGPathSegList.prototype.appendItem = function(newItem) {\n         this._checkPathSynchronizedToList();\n\n         if (newItem._owningPathSegList) {\n             // SVG2 spec says to make a copy.\n             newItem = newItem.clone();\n         }\n         this._list.push(newItem);\n         newItem._owningPathSegList = this;\n         // TODO: Optimize this to just append to the existing attribute.\n         this._writeListToPath();\n         return newItem;\n     }\n\n     SVGPathSegList._pathSegArrayAsString = function(pathSegArray) {\n         var string = \"\";\n         var first = true;\n         pathSegArray.forEach(function(pathSeg) {\n             if (first) {\n                 first = false;\n                 string += pathSeg._asPathString();\n             } else {\n                 string += \" \" + pathSeg._asPathString();\n             }\n         });\n         return string;\n     }\n\n     // This closely follows SVGPathParser::parsePath from Source/core/svg/SVGPathParser.cpp.\n     SVGPathSegList.prototype._parsePath = function(string) {\n         if (!string || string.length == 0)\n             return [];\n\n         var owningPathSegList = this;\n\n         var Builder = function() {\n             this.pathSegList = [];\n         }\n\n         Builder.prototype.appendSegment = function(pathSeg) {\n             this.pathSegList.push(pathSeg);\n         }\n\n         var Source = function(string) {\n             this._string = string;\n             this._currentIndex = 0;\n             this._endIndex = this._string.length;\n             this._previousCommand = SVGPathSeg.PATHSEG_UNKNOWN;\n\n             this._skipOptionalSpaces();\n         }\n\n         Source.prototype._isCurrentSpace = function() {\n             var character = this._string[this._currentIndex];\n             return character <= \" \" && (character == \" \" || character == \"\\n\" || character == \"\\t\" || character == \"\\r\" || character == \"\\f\");\n         }\n\n         Source.prototype._skipOptionalSpaces = function() {\n             while (this._currentIndex < this._endIndex && this._isCurrentSpace())\n                 this._currentIndex++;\n             return this._currentIndex < this._endIndex;\n         }\n\n         Source.prototype._skipOptionalSpacesOrDelimiter = function() {\n             if (this._currentIndex < this._endIndex && !this._isCurrentSpace() && this._string.charAt(this._currentIndex) != \",\")\n                 return false;\n             if (this._skipOptionalSpaces()) {\n                 if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == \",\") {\n                     this._currentIndex++;\n                     this._skipOptionalSpaces();\n                 }\n             }\n             return this._currentIndex < this._endIndex;\n         }\n\n         Source.prototype.hasMoreData = function() {\n             return this._currentIndex < this._endIndex;\n         }\n\n         Source.prototype.peekSegmentType = function() {\n             var lookahead = this._string[this._currentIndex];\n             return this._pathSegTypeFromChar(lookahead);\n         }\n\n         Source.prototype._pathSegTypeFromChar = function(lookahead) {\n             switch (lookahead) {\n             case \"Z\":\n             case \"z\":\n                 return SVGPathSeg.PATHSEG_CLOSEPATH;\n             case \"M\":\n                 return SVGPathSeg.PATHSEG_MOVETO_ABS;\n             case \"m\":\n                 return SVGPathSeg.PATHSEG_MOVETO_REL;\n             case \"L\":\n                 return SVGPathSeg.PATHSEG_LINETO_ABS;\n             case \"l\":\n                 return SVGPathSeg.PATHSEG_LINETO_REL;\n             case \"C\":\n                 return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;\n             case \"c\":\n                 return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;\n             case \"Q\":\n                 return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;\n             case \"q\":\n                 return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;\n             case \"A\":\n                 return SVGPathSeg.PATHSEG_ARC_ABS;\n             case \"a\":\n                 return SVGPathSeg.PATHSEG_ARC_REL;\n             case \"H\":\n                 return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;\n             case \"h\":\n                 return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;\n             case \"V\":\n                 return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;\n             case \"v\":\n                 return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;\n             case \"S\":\n                 return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;\n             case \"s\":\n                 return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;\n             case \"T\":\n                 return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;\n             case \"t\":\n                 return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;\n             default:\n                 return SVGPathSeg.PATHSEG_UNKNOWN;\n             }\n         }\n\n         Source.prototype._nextCommandHelper = function(lookahead, previousCommand) {\n             // Check for remaining coordinates in the current command.\n             if ((lookahead == \"+\" || lookahead == \"-\" || lookahead == \".\" || (lookahead >= \"0\" && lookahead <= \"9\")) && previousCommand != SVGPathSeg.PATHSEG_CLOSEPATH) {\n                 if (previousCommand == SVGPathSeg.PATHSEG_MOVETO_ABS)\n                     return SVGPathSeg.PATHSEG_LINETO_ABS;\n                 if (previousCommand == SVGPathSeg.PATHSEG_MOVETO_REL)\n                     return SVGPathSeg.PATHSEG_LINETO_REL;\n                 return previousCommand;\n             }\n             return SVGPathSeg.PATHSEG_UNKNOWN;\n         }\n\n         Source.prototype.initialCommandIsMoveTo = function() {\n             // If the path is empty it is still valid, so return true.\n             if (!this.hasMoreData())\n                 return true;\n             var command = this.peekSegmentType();\n             // Path must start with moveTo.\n             return command == SVGPathSeg.PATHSEG_MOVETO_ABS || command == SVGPathSeg.PATHSEG_MOVETO_REL;\n         }\n\n         // Parse a number from an SVG path. This very closely follows genericParseNumber(...) from Source/core/svg/SVGParserUtilities.cpp.\n         // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-PathDataBNF\n         Source.prototype._parseNumber = function() {\n             var exponent = 0;\n             var integer = 0;\n             var frac = 1;\n             var decimal = 0;\n             var sign = 1;\n             var expsign = 1;\n\n             var startIndex = this._currentIndex;\n\n             this._skipOptionalSpaces();\n\n             // Read the sign.\n             if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == \"+\")\n                 this._currentIndex++;\n             else if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == \"-\") {\n                 this._currentIndex++;\n                 sign = -1;\n             }\n\n             if (this._currentIndex == this._endIndex || ((this._string.charAt(this._currentIndex) < \"0\" || this._string.charAt(this._currentIndex) > \"9\") && this._string.charAt(this._currentIndex) != \".\"))\n                 // The first character of a number must be one of [0-9+-.].\n                 return undefined;\n\n             // Read the integer part, build right-to-left.\n             var startIntPartIndex = this._currentIndex;\n             while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= \"0\" && this._string.charAt(this._currentIndex) <= \"9\")\n                 this._currentIndex++; // Advance to first non-digit.\n\n             if (this._currentIndex != startIntPartIndex) {\n                 var scanIntPartIndex = this._currentIndex - 1;\n                 var multiplier = 1;\n                 while (scanIntPartIndex >= startIntPartIndex) {\n                     integer += multiplier * (this._string.charAt(scanIntPartIndex--) - \"0\");\n                     multiplier *= 10;\n                 }\n             }\n\n             // Read the decimals.\n             if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == \".\") {\n                 this._currentIndex++;\n\n                 // There must be a least one digit following the .\n                 if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < \"0\" || this._string.charAt(this._currentIndex) > \"9\")\n                     return undefined;\n                 while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= \"0\" && this._string.charAt(this._currentIndex) <= \"9\")\n                     decimal += (this._string.charAt(this._currentIndex++) - \"0\") * (frac *= 0.1);\n             }\n\n             // Read the exponent part.\n             if (this._currentIndex != startIndex && this._currentIndex + 1 < this._endIndex && (this._string.charAt(this._currentIndex) == \"e\" || this._string.charAt(this._currentIndex) == \"E\") && (this._string.charAt(this._currentIndex + 1) != \"x\" && this._string.charAt(this._currentIndex + 1) != \"m\")) {\n                 this._currentIndex++;\n\n                 // Read the sign of the exponent.\n                 if (this._string.charAt(this._currentIndex) == \"+\") {\n                     this._currentIndex++;\n                 } else if (this._string.charAt(this._currentIndex) == \"-\") {\n                     this._currentIndex++;\n                     expsign = -1;\n                 }\n\n                 // There must be an exponent.\n                 if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < \"0\" || this._string.charAt(this._currentIndex) > \"9\")\n                     return undefined;\n\n                 while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= \"0\" && this._string.charAt(this._currentIndex) <= \"9\") {\n                     exponent *= 10;\n                     exponent += (this._string.charAt(this._currentIndex) - \"0\");\n                     this._currentIndex++;\n                 }\n             }\n\n             var number = integer + decimal;\n             number *= sign;\n\n             if (exponent)\n                 number *= Math.pow(10, expsign * exponent);\n\n             if (startIndex == this._currentIndex)\n                 return undefined;\n\n             this._skipOptionalSpacesOrDelimiter();\n\n             return number;\n         }\n\n         Source.prototype._parseArcFlag = function() {\n             if (this._currentIndex >= this._endIndex)\n                 return undefined;\n             var flag = false;\n             var flagChar = this._string.charAt(this._currentIndex++);\n             if (flagChar == \"0\")\n                 flag = false;\n             else if (flagChar == \"1\")\n                 flag = true;\n             else\n                 return undefined;\n\n             this._skipOptionalSpacesOrDelimiter();\n             return flag;\n         }\n\n         Source.prototype.parseSegment = function() {\n             var lookahead = this._string[this._currentIndex];\n             var command = this._pathSegTypeFromChar(lookahead);\n             if (command == SVGPathSeg.PATHSEG_UNKNOWN) {\n                 // Possibly an implicit command. Not allowed if this is the first command.\n                 if (this._previousCommand == SVGPathSeg.PATHSEG_UNKNOWN)\n                     return null;\n                 command = this._nextCommandHelper(lookahead, this._previousCommand);\n                 if (command == SVGPathSeg.PATHSEG_UNKNOWN)\n                     return null;\n             } else {\n                 this._currentIndex++;\n             }\n\n             this._previousCommand = command;\n\n             switch (command) {\n             case SVGPathSeg.PATHSEG_MOVETO_REL:\n                 return new SVGPathSegMovetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n             case SVGPathSeg.PATHSEG_MOVETO_ABS:\n                 return new SVGPathSegMovetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n             case SVGPathSeg.PATHSEG_LINETO_REL:\n                 return new SVGPathSegLinetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n             case SVGPathSeg.PATHSEG_LINETO_ABS:\n                 return new SVGPathSegLinetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n             case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:\n                 return new SVGPathSegLinetoHorizontalRel(owningPathSegList, this._parseNumber());\n             case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:\n                 return new SVGPathSegLinetoHorizontalAbs(owningPathSegList, this._parseNumber());\n             case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:\n                 return new SVGPathSegLinetoVerticalRel(owningPathSegList, this._parseNumber());\n             case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:\n                 return new SVGPathSegLinetoVerticalAbs(owningPathSegList, this._parseNumber());\n             case SVGPathSeg.PATHSEG_CLOSEPATH:\n                 this._skipOptionalSpaces();\n                 return new SVGPathSegClosePath(owningPathSegList);\n             case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:\n                 var points = {x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegCurvetoCubicRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);\n             case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:\n                 var points = {x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegCurvetoCubicAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);\n             case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:\n                 var points = {x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegCurvetoCubicSmoothRel(owningPathSegList, points.x, points.y, points.x2, points.y2);\n             case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:\n                 var points = {x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegCurvetoCubicSmoothAbs(owningPathSegList, points.x, points.y, points.x2, points.y2);\n             case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:\n                 var points = {x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegCurvetoQuadraticRel(owningPathSegList, points.x, points.y, points.x1, points.y1);\n             case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:\n                 var points = {x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegCurvetoQuadraticAbs(owningPathSegList, points.x, points.y, points.x1, points.y1);\n             case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:\n                 return new SVGPathSegCurvetoQuadraticSmoothRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n             case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:\n                 return new SVGPathSegCurvetoQuadraticSmoothAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n             case SVGPathSeg.PATHSEG_ARC_REL:\n                 var points = {x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegArcRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);\n             case SVGPathSeg.PATHSEG_ARC_ABS:\n                 var points = {x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber()};\n                 return new SVGPathSegArcAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);\n             default:\n                 throw \"Unknown path seg type.\"\n             }\n         }\n\n         var builder = new Builder();\n         var source = new Source(string);\n\n         if (!source.initialCommandIsMoveTo())\n             return [];\n         while (source.hasMoreData()) {\n             var pathSeg = source.parseSegment();\n             if (!pathSeg)\n                 return [];\n             builder.appendSegment(pathSeg);\n         }\n\n         return builder.pathSegList;\n     }\n }\n}());\n\n")();
        }
        util.polyfill = polyfill;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var layout;
        (function (layout) {
            var DirectionTypes;
            (function (DirectionTypes) {
                DirectionTypes.VERTICAL = "vertical";
                DirectionTypes.HORIZONTAL = "horizontal";
            })(DirectionTypes = layout.DirectionTypes || (layout.DirectionTypes = {}));
        })(layout = ui.layout || (ui.layout = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var Button = function (_React$Component11) {
            _inherits(Button, _React$Component11);

            function Button(props) {
                _classCallCheck(this, Button);

                return _possibleConstructorReturn(this, (Button.__proto__ || Object.getPrototypeOf(Button)).call(this, props));
            }

            _createClass(Button, [{
                key: "render",
                value: function render() {
                    return React.createElement(
                        "button",
                        _extends({}, this.props, { className: "ui " + this.props.colorClass + " button " + (this.props.className || "") }),
                        this.props.children
                    );
                }
            }]);

            return Button;
        }(React.Component);

        Button.defaultProps = {
            colorClass: ""
        };
        ui.Button = Button;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var css;
    (function (css) {
        var react_prefixes = ["Moz", "Webkit", "ms"]; // ms or Ms ?
        var dom_prefixes = ["Moz", "webKit", "ms"];
        var vendorSpecificProperties = [];
        var vendor;
        var styleKeys;
        function getVendorSpecificProperties() {
            if (vendorSpecificProperties.length) return vendorSpecificProperties;
            if (!styleKeys) styleKeys = Object.keys(document.createElement("div").style);
            var _iteratorNormalCompletion4 = true;
            var _didIteratorError4 = false;
            var _iteratorError4 = undefined;

            try {
                for (var _iterator4 = styleKeys[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
                    var property = _step4.value;
                    var _iteratorNormalCompletion5 = true;
                    var _didIteratorError5 = false;
                    var _iteratorError5 = undefined;

                    try {
                        for (var _iterator5 = dom_prefixes[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
                            var prefix = _step5.value;

                            if (property.toLowerCase().startsWith(prefix.toLowerCase())) vendorSpecificProperties.push(property.replace(prefix, ""));
                        }
                    } catch (err) {
                        _didIteratorError5 = true;
                        _iteratorError5 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion5 && _iterator5.return) {
                                _iterator5.return();
                            }
                        } finally {
                            if (_didIteratorError5) {
                                throw _iteratorError5;
                            }
                        }
                    }
                }
            } catch (err) {
                _didIteratorError4 = true;
                _iteratorError4 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion4 && _iterator4.return) {
                        _iterator4.return();
                    }
                } finally {
                    if (_didIteratorError4) {
                        throw _iteratorError4;
                    }
                }
            }

            return vendorSpecificProperties;
        }
        function prefixer(style) {
            var newStyle = {};
            var _iteratorNormalCompletion6 = true;
            var _didIteratorError6 = false;
            var _iteratorError6 = undefined;

            try {
                for (var _iterator6 = Object.keys(style)[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
                    var property = _step6.value;

                    var prefixIndex = getVendorSpecificProperties().indexOf(property);
                    if (prefixIndex >= 0) {
                        var _iteratorNormalCompletion7 = true;
                        var _didIteratorError7 = false;
                        var _iteratorError7 = undefined;

                        try {
                            for (var _iterator7 = react_prefixes[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {
                                var prefix = _step7.value;

                                newStyle[prefix + property] = style[property];
                            }
                        } catch (err) {
                            _didIteratorError7 = true;
                            _iteratorError7 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion7 && _iterator7.return) {
                                    _iterator7.return();
                                }
                            } finally {
                                if (_didIteratorError7) {
                                    throw _iteratorError7;
                                }
                            }
                        }
                    } else {
                        newStyle[property] = style[property];
                    }
                }
            } catch (err) {
                _didIteratorError6 = true;
                _iteratorError6 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion6 && _iterator6.return) {
                        _iterator6.return();
                    }
                } finally {
                    if (_didIteratorError6) {
                        throw _iteratorError6;
                    }
                }
            }

            return newStyle;
        }
        css.prefixer = prefixer;
    })(css = weavejs.css || (weavejs.css = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var layout;
        (function (layout) {
            var prefixer = weavejs.css.prefixer;
            var HORIZONTAL = weavejs.ui.layout.DirectionTypes.HORIZONTAL;
            var STYLE_BASE = {
                background: "#e6e6e6",
                boxSizing: "border-box",
                backgroundClip: "padding"
            };
            var STYLE_HORIZONTAL = _.merge({
                cursor: "col-resize"
            }, STYLE_BASE);
            var STYLE_VERTICAL = _.merge({
                cursor: "row-resize"
            }, STYLE_BASE);

            var Resizer = function (_React$Component12) {
                _inherits(Resizer, _React$Component12);

                function Resizer(props) {
                    _classCallCheck(this, Resizer);

                    var _this15 = _possibleConstructorReturn(this, (Resizer.__proto__ || Object.getPrototypeOf(Resizer)).call(this, props));

                    _this15.onMouseDown = function (event) {
                        _this15.setState({
                            active: true
                        });
                    };
                    _this15.state = {
                        active: false
                    };
                    return _this15;
                }

                _createClass(Resizer, [{
                    key: "componentDidMount",
                    value: function componentDidMount() {
                        ReactDOM.findDOMNode(this).addEventListener("mousedown", this.onMouseDown);
                    }
                }, {
                    key: "componentWillUnmount",
                    value: function componentWillUnmount() {
                        ReactDOM.findDOMNode(this).removeEventListener("mousedown", this.onMouseDown);
                    }
                }, {
                    key: "render",
                    value: function render() {
                        var style = this.props.direction === HORIZONTAL ? STYLE_HORIZONTAL : STYLE_VERTICAL;
                        // makes a copy
                        style = prefixer(style);
                        var spacing = this.props.spacing || Resizer.DEFAULT_SPACING;
                        if (this.props.direction === HORIZONTAL) style.width = spacing;else style.height = spacing;
                        return React.createElement("span", { style: style });
                    }
                }]);

                return Resizer;
            }(React.Component);

            Resizer.DEFAULT_SPACING = 4;
            layout.Resizer = Resizer;
        })(layout = ui.layout || (ui.layout = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        /**
         * Provides a way to render a div separately by setting its state.
         */
        var Div = function (_React$Component13) {
            _inherits(Div, _React$Component13);

            function Div() {
                _classCallCheck(this, Div);

                return _possibleConstructorReturn(this, (Div.__proto__ || Object.getPrototypeOf(Div)).apply(this, arguments));
            }

            _createClass(Div, [{
                key: "render",
                value: function render() {
                    return React.createElement("div", _extends({}, this.props, this.state));
                }
            }]);

            return Div;
        }(React.Component);

        ui.Div = Div;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        var MouseUtils = function () {
            function MouseUtils(window) {
                var _this17 = this;

                _classCallCheck(this, MouseUtils);

                /**
                 * A bitmask for mouse button state. left=1, right=2, middle=4
                 */
                this.mouseButtonDown = 0;
                /**
                 * The last mouse event.
                 */
                this.mouseEvent = new MouseEvent('mousemove');
                this.mouseDownEvent = null;
                this.canRelyOnButtonsProp = false;
                this.handleMouseEvent = function (event) {
                    _this17.mouseEvent = event;
                    if (event.type == 'mousedown') {
                        _this17.mouseDownEvent = event;
                        _this17.mouseDownTarget = event.target;
                    }
                    if (event.buttons || _this17.canRelyOnButtonsProp) {
                        _this17.canRelyOnButtonsProp = true;
                        _this17.mouseButtonDown = event.buttons;
                    } else if (event.type == 'mousedown') {
                        _this17.mouseButtonDown |= MouseUtils.buttonToButtonsMapping[event.button];
                    } else if (event.type == 'mouseup') {
                        _this17.mouseButtonDown &= ~MouseUtils.buttonToButtonsMapping[event.button];
                    }
                };
                this.handleDragEvent = function (event) {
                    _this17.mouseEvent = event;
                    if (event.buttons || _this17.canRelyOnButtonsProp) {
                        _this17.canRelyOnButtonsProp = true;
                        _this17.mouseButtonDown = event.buttons;
                    } else if (event.type == 'dragend' || event.type == 'drop') {
                        _this17.mouseButtonDown &= ~MouseUtils.buttonToButtonsMapping[event.button];
                    }
                };
                this.debugEvent = function (event) {
                    console.log(event.type, 'mouseButtonDown =', _this17.mouseButtonDown, Weave.stringify({ x: event.clientX, y: event.clientY, button: event.button, buttons: event.buttons }));
                };
                MouseUtils.mouseEventTypes.forEach(function (eventType) {
                    return window.document.addEventListener(eventType, _this17.handleMouseEvent, true);
                });
                MouseUtils.dragEventTypes.forEach(function (eventType) {
                    return window.document.addEventListener(eventType, _this17.handleDragEvent, true);
                });
                // for debugging
                //mouseEventTypes.concat(dragEventTypes).forEach(eventType => window.document.addEventListener(eventType, this.debugEvent, true));
            }

            _createClass(MouseUtils, null, [{
                key: "addPointClickListener",
                value: function addPointClickListener(target, listener) {
                    var pixelThreshold = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;

                    var _listener = listener;
                    _listener.onMouseDown = function (event) {
                        _listener.mouseDownEvent = event;
                    };
                    _listener.onClick = function (event) {
                        var mde = _listener.mouseDownEvent;
                        if (Math.abs(mde.clientX - event.clientX) <= pixelThreshold && Math.abs(mde.clientY - event.clientY) <= pixelThreshold) listener(event);
                    };
                    target.addEventListener('mousedown', _listener.onMouseDown);
                    target.addEventListener('click', _listener.onClick);
                }
            }, {
                key: "removePointClickListener",
                value: function removePointClickListener(target, listener) {
                    target.removeEventListener('mousedown', listener.onMouseDown);
                    target.removeEventListener('click', listener.onClick);
                }
            }, {
                key: "getOffsetPoint",
                value: function getOffsetPoint(relativeTo) {
                    var event = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    if (!event) event = MouseUtils.forElement(relativeTo).mouseEvent;
                    if (!event) {
                        console.error("Warning: MouseUtils.getOffsetPoint(element, null) will not be correct the first time it is called.", "To work around this, call MouseUtils.forElement(element) before the mouse event occurs.");
                        return { x: 0, y: 0 };
                    }
                    var rect = relativeTo.getBoundingClientRect();
                    return {
                        x: (event.clientX - rect.left) * (relativeTo.offsetWidth / rect.width || 1),
                        y: (event.clientY - rect.top) * (relativeTo.offsetHeight / rect.height || 1)
                    };
                }
                /**
                 * This function can be used to check if the user clicked on an element
                 * even if the 'click' event doesn't get dispatched due to DOM changes
                 * @param element the Element in question
                 * @returns {boolean} return true if the element received the last 'mousedown' event.
                 */

            }, {
                key: "receivedMouseDown",
                value: function receivedMouseDown(element) {
                    var instance = MouseUtils.forElement(element);
                    return instance.mouseDownEvent && element && element.contains(instance.mouseDownTarget);
                }
            }, {
                key: "isMouseOver",
                value: function isMouseOver(element) {
                    var event = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var edgeInclusive = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

                    var rect = element.getBoundingClientRect();
                    if (!event) event = MouseUtils.forElement(element).mouseEvent;
                    if (!event) {
                        console.error("Warning: MouseUtils.isMouseOver(element, null) will not be correct the first time it is called.", "To work around this, call MouseUtils.forElement(element) before the mouse event occurs.");
                        return false;
                    }
                    if (edgeInclusive) return event.clientX >= rect.left && event.clientX <= rect.left + rect.width && event.clientY >= rect.top && event.clientY <= rect.top + rect.height;
                    return event.clientX > rect.left && event.clientX < rect.left + rect.width && event.clientY > rect.top && event.clientY < rect.top + rect.height;
                }
            }, {
                key: "forInstance",
                value: function forInstance(instance) {
                    return MouseUtils.forElement(util.ReactUtils.getElement(instance));
                }
            }, {
                key: "forComponent",
                value: function forComponent(component) {
                    return MouseUtils.forElement(ReactDOM.findDOMNode(component));
                }
            }, {
                key: "forElement",
                value: function forElement(element) {
                    var window = util.DOMUtils.getWindow(element);
                    var instance = MouseUtils.map_window_MouseUtils.get(window);
                    if (!instance) {
                        instance = new MouseUtils(window);
                        MouseUtils.map_window_MouseUtils.set(window, instance);
                    }
                    return instance;
                }
            }, {
                key: "echoWindowEventsToOpener",
                value: function echoWindowEventsToOpener(sourceElement) {
                    var sourceWindow = util.DOMUtils.getWindow(sourceElement);
                    var destinationWindow = sourceWindow.opener;
                    if (!sourceElement || !destinationWindow) return;
                    var allEvents = MouseUtils.mouseEventTypes.concat(MouseUtils.dragEventTypes);
                    allEvents.forEach(function (eventType) {
                        sourceWindow.document.addEventListener(eventType, function (event) {
                            if (event.target instanceof Element && sourceElement.contains(event.target) || MouseUtils.forElement(sourceElement).mouseButtonDown && MouseUtils.receivedMouseDown(sourceElement)) {
                                sourceWindow.requestAnimationFrame(function () {
                                    destinationWindow.document.dispatchEvent(event);
                                });
                            }
                        });
                    });
                }
            }]);

            return MouseUtils;
        }();

        MouseUtils.map_window_MouseUtils = new WeakMap();
        MouseUtils.mouseEventTypes = ['click', 'dblclick', 'mousedown', 'mouseenter', 'mouseleave', 'mousemove', 'mouseout', 'mouseover', 'mouseup', 'wheel'];
        MouseUtils.dragEventTypes = ['dragstart', 'drag', 'dragenter', 'dragleave', 'dragover', 'drop', 'dragend'];
        MouseUtils.buttonToButtonsMapping = [1, 4, 2];
        util.MouseUtils = MouseUtils;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        var KeyboardUtils = function KeyboardUtils() {
            _classCallCheck(this, KeyboardUtils);
        };

        KeyboardUtils.KEYCODES = {
            TAB: 9,
            ENTER: 13,
            ESC: 27,
            SPACE: 32,
            LEFT_ARROW: 37,
            UP_ARROW: 38,
            RIGHT_ARROW: 39,
            DOWN_ARROW: 40,
            Z: 90,
            Y: 89
        };
        util.KeyboardUtils = KeyboardUtils;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var flexbox;
        (function (flexbox) {
            var VBox = function (_React$Component14) {
                _inherits(VBox, _React$Component14);

                function VBox() {
                    _classCallCheck(this, VBox);

                    return _possibleConstructorReturn(this, (VBox.__proto__ || Object.getPrototypeOf(VBox)).apply(this, arguments));
                }

                _createClass(VBox, [{
                    key: "render",
                    value: function render() {
                        return flexbox.BoxProps.renderBox(this.props, VBox.options);
                    }
                }]);

                return VBox;
            }(React.Component);

            VBox.options = {
                flexDirection: 'column',
                unpaddedClassName: 'weave-vbox',
                paddedClassName: 'weave-padded-vbox'
            };
            flexbox.VBox = VBox;
        })(flexbox = ui.flexbox || (ui.flexbox = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var flexbox;
        (function (flexbox) {
            var HBox = function (_React$Component15) {
                _inherits(HBox, _React$Component15);

                function HBox() {
                    _classCallCheck(this, HBox);

                    return _possibleConstructorReturn(this, (HBox.__proto__ || Object.getPrototypeOf(HBox)).apply(this, arguments));
                }

                _createClass(HBox, [{
                    key: "render",
                    value: function render() {
                        return flexbox.BoxProps.renderBox(this.props, HBox.options);
                    }
                }]);

                return HBox;
            }(React.Component);

            HBox.options = {
                flexDirection: 'row',
                unpaddedClassName: 'weave-hbox',
                paddedClassName: 'weave-padded-hbox'
            };
            flexbox.HBox = HBox;
        })(flexbox = ui.flexbox || (ui.flexbox = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var HBox = weavejs.ui.flexbox.HBox;
        var VBox = weavejs.ui.flexbox.VBox;
        var TOP = "top";
        var BOTTOM = "bottom";

        var Tabs = function (_React$Component16) {
            _inherits(Tabs, _React$Component16);

            function Tabs(props) {
                _classCallCheck(this, Tabs);

                var _this20 = _possibleConstructorReturn(this, (Tabs.__proto__ || Object.getPrototypeOf(Tabs)).call(this, props));

                _this20.state = {
                    activeTabIndex: props.initialActiveTabIndex || props.activeTabIndex || 0
                };
                return _this20;
            }

            _createClass(Tabs, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(props) {
                    if (props.activeTabIndex != null) this.setState({
                        activeTabIndex: props.activeTabIndex
                    });
                }
            }, {
                key: "changeTabView",
                value: function changeTabView(index) {
                    if (this.state.activeTabIndex != index) {
                        this.setState({
                            activeTabIndex: index
                        });
                        this.props.onViewChange && this.props.onViewChange(index);
                    }
                }
            }, {
                key: "render",
                value: function render() {
                    var _this21 = this;

                    return React.createElement(
                        "div",
                        { className: classNames(this.props.tabContainerClassName || "weave-tab-container", this.props.location), style: _.merge({}, this.props.style, {
                                overflow: "hidden",
                                flex: 1,
                                display: "flex",
                                flexDirection: this.props.location === BOTTOM ? "column" : "column-reverse"
                            }) },
                        React.createElement(
                            VBox,
                            { key: "content", className: classNames(this.props.tabContentClassName || "weave-tab-content", this.props.location), style: { flex: 1, overflow: "auto" } },
                            this.props.tabs[this.state.activeTabIndex]
                        ),
                        React.createElement(
                            HBox,
                            { overflow: true, key: "tabs", className: classNames(this.props.tabBarClassName || "weave-tab-label-container", this.props.location), style: this.props.tabBarStyle },
                            this.props.labels.map(function (label, index) {
                                return React.createElement(
                                    HBox,
                                    { overflow: true, key: index, className: classNames(_this21.props.tabLabelClassName || "weave-tab-label", { "active": _this21.state.activeTabIndex == index }, _this21.props.location), style: _this21.props.tabLabelStyle, onClick: function onClick(event) {
                                            if (_this21.props.onTabClick) _this21.props.onTabClick(index, event);
                                            if (!event.defaultPrevented) _this21.changeTabView(index);
                                        }, onDoubleClick: function onDoubleClick(event) {
                                            return _this21.props.onTabDoubleClick && _this21.props.onTabDoubleClick(index, event);
                                        } },
                                    label
                                );
                            }),
                            this.props.tabBarChildren
                        )
                    );
                }
            }]);

            return Tabs;
        }(React.Component);

        Tabs.defaultProps = {
            labels: [],
            tabs: [],
            location: "top"
        };
        ui.Tabs = Tabs;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var prefixer = weavejs.css.prefixer;

        var HDividedBox = function (_React$Component17) {
            _inherits(HDividedBox, _React$Component17);

            function HDividedBox(props) {
                _classCallCheck(this, HDividedBox);

                var _this22 = _possibleConstructorReturn(this, (HDividedBox.__proto__ || Object.getPrototypeOf(HDividedBox)).call(this, props));

                _this22.isEqualWidthChildrenRendered = false;
                // caching the widths of all left child
                // this ensures when we switch resizer the width is maintained
                // string for percentage values
                _this22.leftChildWidths = [];
                _this22.containerWidth = NaN;
                _this22.state = {
                    activeResizerIndex: NaN,
                    resizingLeftChildWidth: null,
                    mouseXPos: NaN,
                    dragging: false
                };
                // set the state with initial values from mouse event
                _this22.resizerMouseDownHandler = function (index, event) {
                    // as resizer index is same as left child index , easy to identify from refs
                    var leftChild = ReactDOM.findDOMNode(_this22.children[index]);
                    _this22.containerWidth = ReactDOM.findDOMNode(_this22).getBoundingClientRect().width;
                    _this22.setState({
                        mouseXPos: event.clientX,
                        activeResizerIndex: index,
                        dragging: true,
                        resizingLeftChildWidth: leftChild.getBoundingClientRect().width
                    });
                    // important to add mouseup/mousemove on the window /document /parent div
                    // listeners are added only resizer is selected
                    ReactDOM.findDOMNode(_this22).addEventListener("mousemove", _this22.resizerMouseMoveHandler);
                    ReactDOM.findDOMNode(_this22).addEventListener("mouseup", _this22.resizerMouseUpHandler);
                    event.stopPropagation();
                    event.preventDefault();
                };
                // resizingLeftChildWidth and mouseXPos state values are updated while dragging
                _this22.resizerMouseMoveHandler = function (event) {
                    // ensures no value is calculated when no resizer is active
                    // todo: try removing mousemove when
                    if (!_this22.state.dragging) {
                        return;
                    }
                    //calculates width of the child left to active resizer
                    var deltaXPos = event.clientX - _this22.state.mouseXPos;
                    var newWidth = _this22.state.resizingLeftChildWidth + deltaXPos;
                    _this22.setState({
                        resizingLeftChildWidth: newWidth,
                        mouseXPos: event.clientX
                    });
                    event.stopPropagation();
                    event.preventDefault();
                };
                _this22.resizerMouseUpHandler = function (event) {
                    if (!isNaN(_this22.state.activeResizerIndex)) {
                        //cache the width of left child for released resizer
                        _this22.leftChildWidths[_this22.state.activeResizerIndex] = _this22.state.resizingLeftChildWidth;
                    }
                    // reset all values to avoid conflicts in next resizing event
                    _this22.setState({
                        dragging: false,
                        activeResizerIndex: NaN,
                        resizingLeftChildWidth: null,
                        mouseXPos: NaN
                    });
                    //important: remove listeners from this component when resizing is stopped
                    //this ensures this component wont wait for mouseup / mousemove events
                    //when there is no resizing
                    ReactDOM.findDOMNode(_this22).removeEventListener("mousemove", _this22.resizerMouseMoveHandler);
                    ReactDOM.findDOMNode(_this22).removeEventListener("mouseup", _this22.resizerMouseUpHandler);
                    event.stopPropagation();
                    event.preventDefault();
                };
                return _this22;
            }
            /**
             * Creates a copy of a style object and adds { display: "flex", flexDirection: "row" }
             * @param style A style object.
             * @return A new style object.
             */


            _createClass(HDividedBox, [{
                key: "render",
                value: function render() {
                    var _this23 = this;

                    // setting the flag to true to ensure on next rendering, width value comes from user interaction
                    if (this.state.dragging && this.props.loadWithEqualWidthChildren) {
                        this.isEqualWidthChildrenRendered = true;
                    }
                    var childrenUI = [];
                    // storing childCount is important, to make sure resizer is not added after last child
                    var childCount = React.Children.count(this.props.children);
                    // summing up all child width , helps to set the last child width by subtracting from container width
                    var leftChildWidthSum = 0;
                    this.children = [];
                    React.Children.forEach(this.props.children, function (child, index) {
                        if (!child) return;
                        /* ***** Child ****** */
                        var childStyle = {
                            overflow: "auto"
                        };
                        // special case
                        // when rendered for first time, if equalchildrenwidth requested
                        // render all child width as percentage
                        // note: only once (mostly for absolute child in the container)
                        if (_this23.props.loadWithEqualWidthChildren && !_this23.isEqualWidthChildrenRendered) {
                            childStyle.width = String(100 / childCount) + "%";
                        } else if (childCount - 1 == index) {
                            childStyle.flex = 1;
                        } else {
                            //set left child width
                            if (_this23.state.dragging) {
                                childStyle.width = _this23.state.activeResizerIndex == index ? _this23.state.resizingLeftChildWidth : _this23.leftChildWidths[index];
                            } else {
                                childStyle.width = _this23.leftChildWidths[index];
                            }
                            leftChildWidthSum = leftChildWidthSum + childStyle.width;
                        }
                        var childElement = child;
                        if (typeof childElement.ref == 'string') console.error("Children of HDividedBox cannot have string ref names. Please use ref functions instead.");
                        // make sure the child Style overflow property is set along with calculated width
                        var mutateProps = _.merge({}, childElement.props, {
                            key: "child" + index,
                            ref: function ref(instance) {
                                if (typeof childElement.ref == 'function') childElement.ref(instance);
                                _this23.children[index] = instance;
                            },
                            style: prefixer(childStyle)
                        });
                        var childUI = React.cloneElement(childElement, mutateProps);
                        childrenUI.push(childUI);
                        /* ***** Resizer ****** */
                        //resizer is added right after every child except last child
                        if (childCount - 1 !== index) {
                            var resizerStyle = _this23.props.resizerStyle ? _this23.props.resizerStyle : {};
                            // index matches with left child
                            var ref = "resizer" + index;
                            var resizerUI = React.createElement(Resizer, { key: ref, ref: ref, size: _this23.props.resizerSize, style: resizerStyle, type: VERTICAL, onMouseDown: _this23.resizerMouseDownHandler.bind(_this23, index) });
                            childrenUI.push(resizerUI);
                            leftChildWidthSum = leftChildWidthSum + (_this23.props.resizerSize ? _this23.props.resizerSize : 1);
                        }
                    });
                    var styleObj = HDividedBox.style(this.props.style);
                    styleObj.position = "relative"; //important to accommodate if any children is absolute
                    return React.createElement("div", _extends({}, this.props, { className: classNames("weave-hDividedBox", this.props.className), style: styleObj, children: childrenUI }));
                }
            }], [{
                key: "style",
                value: function style(_style) {
                    return _.merge({}, _style, { display: "flex", flexDirection: "row", overflow: "auto" });
                }
            }]);

            return HDividedBox;
        }(React.Component);

        ui.HDividedBox = HDividedBox;
        var VERTICAL = "vertical";
        var HORIZONTAL = "horizontal";

        var Resizer = function (_React$Component18) {
            _inherits(Resizer, _React$Component18);

            function Resizer() {
                _classCallCheck(this, Resizer);

                return _possibleConstructorReturn(this, (Resizer.__proto__ || Object.getPrototypeOf(Resizer)).apply(this, arguments));
            }

            _createClass(Resizer, [{
                key: "render",
                value: function render() {
                    // background-clip: padding-box
                    // this ensures the cursor comes when it reached the padding region
                    var styleObj = _.merge({}, this.props.style, {
                        boxSizing: "border-box",
                        backgroundClip: "padding-box"
                    });
                    // setting padding and margin with equal positive and negative values, will ensure the resize-cursor is visible when its 4 px near the resizer
                    // positive and negative negates the 4px layout for rendering Engine, but cursor will become visible when its 4px near
                    if (this.props.type === VERTICAL) {
                        _.merge(styleObj, {
                            paddingLeft: "4px",
                            marginLeft: "-4px",
                            paddingRight: "4px",
                            marginRight: "-4px",
                            cursor: "col-resize"
                        });
                    } else if (this.props.type === HORIZONTAL) {
                        _.merge(styleObj, {
                            paddingTop: "4px",
                            marginTop: "-4px",
                            paddingBottom: "4px",
                            marginBottom: "-4px",
                            cursor: "row-resize"
                        });
                    }
                    if (this.props.size) {
                        if (this.props.type === VERTICAL) {
                            styleObj.width = 1;
                        } else if (this.props.type === HORIZONTAL) {
                            styleObj.height = 1;
                        }
                    }
                    var className = this.props.className ? this.props.className : "weave-hDividedBox-resizer";
                    return React.createElement("span", { style: styleObj, onMouseDown: this.props.onMouseDown, className: className });
                }
            }]);

            return Resizer;
        }(React.Component);
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var HBox = weavejs.ui.flexbox.HBox;

        var CheckBoxList = function (_React$Component19) {
            _inherits(CheckBoxList, _React$Component19);

            function CheckBoxList(props) {
                _classCallCheck(this, CheckBoxList);

                var _this25 = _possibleConstructorReturn(this, (CheckBoxList.__proto__ || Object.getPrototypeOf(CheckBoxList)).call(this, props));

                _this25.values = [];
                _this25.labels = [];
                if (!props.options) {
                    _this25.state = {
                        checkboxStates: []
                    };
                } else {
                    if (props.selectedValues) {
                        _this25.state = {
                            checkboxStates: props.options.map(function (option) {
                                return props.selectedValues.indexOf(option.value) >= 0;
                            })
                        };
                    } else {
                        _this25.state = {
                            checkboxStates: props.options.map(function () {
                                return false;
                            })
                        };
                    }
                }
                _this25.values = _.pluck(_this25.props.options, "value");
                _this25.labels = _.pluck(_this25.props.options, "label");
                return _this25;
            }

            _createClass(CheckBoxList, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(nextProps) {
                    this.values = _.pluck(this.props.options, "value");
                    this.labels = _.pluck(this.props.options, "label");
                    if (!nextProps.options) {
                        this.setState({
                            checkboxStates: []
                        });
                    } else {
                        if (nextProps.selectedValues) {
                            var checkboxStates = nextProps.options.map(function (option) {
                                return nextProps.selectedValues.indexOf(option.value) >= 0;
                            });
                            this.setState({
                                checkboxStates: checkboxStates
                            });
                        }
                    }
                }
            }, {
                key: "handleChange",
                value: function handleChange(checkboxState, index) {
                    var _this26 = this;

                    var checkboxStates = this.state.checkboxStates.concat();
                    checkboxStates[index] = checkboxState;
                    var selectedValues = [];
                    checkboxStates.forEach(function (checkboxState, index) {
                        if (checkboxState) {
                            selectedValues.push(_this26.props.options[index].value);
                        }
                    });
                    if (this.props.onChange) this.props.onChange(selectedValues);
                    this.setState({
                        checkboxStates: checkboxStates
                    });
                }
            }, {
                key: "render",
                value: function render() {
                    var _this27 = this;

                    var labelPosition = this.props.labelPosition || "right";
                    return React.createElement(
                        "div",
                        { style: { flex: 1, alignItems: "center", overflow: "auto" }, className: "weave-checkbox-list" },
                        this.state.checkboxStates.map(function (checkBoxState, index) {
                            var label = _this27.labels[index];
                            if (labelPosition == "right") {
                                return React.createElement(
                                    HBox,
                                    { key: index, className: "weave-checkbox-list-item" },
                                    React.createElement(ui.Checkbox, { value: checkBoxState, onChange: function onChange(value) {
                                            return _this27.handleChange(value, index);
                                        }, label: " " }),
                                    label
                                );
                            } else {
                                return React.createElement(
                                    HBox,
                                    { key: index, className: "weave-checkbox-list-item" },
                                    label,
                                    React.createElement(ui.Checkbox, { value: checkBoxState, onChange: function onChange(value) {
                                            return _this27.handleChange(value, index);
                                        }, label: " " })
                                );
                            }
                        })
                    );
                }
            }]);

            return CheckBoxList;
        }(React.Component);

        ui.CheckBoxList = CheckBoxList;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        var Dictionary2D = weavejs.util.Dictionary2D;

        var DOMUtils = function () {
            function DOMUtils() {
                _classCallCheck(this, DOMUtils);
            }

            _createClass(DOMUtils, null, [{
                key: "getWindow",
                value: function getWindow(element) {
                    var node = element;
                    return node && (node.ownerDocument && node.ownerDocument.defaultView || node.document && node || node.defaultView);
                }
                /**
                 * This function returns the width of a text string, in pixels, based on its font style
                 */

            }, {
                key: "getTextWidth",
                value: function getTextWidth(text, font) {
                    // create a dummy canvas element to perform the calculation
                    var canvas = document.createElement("canvas");
                    var context = canvas.getContext("2d");
                    context.font = font;
                    var metrics = context.measureText(text);
                    return metrics.width;
                }
            }, {
                key: "getTextHeightForClasses",
                value: function getTextHeightForClasses(text, classNames) {
                    var result = this.textHeightForClassCache.get(text, classNames);
                    if (result !== undefined) return result;
                    var body = document.getElementsByTagName("body")[0];
                    var dummy = document.createElement("div");
                    var dummyText = document.createTextNode("M");
                    dummy.appendChild(dummyText);
                    dummy.setAttribute("class", classNames);
                    body.appendChild(dummy);
                    result = dummy.offsetHeight;
                    body.removeChild(dummy);
                    this.textHeightForClassCache.set(text, classNames, result);
                    return result;
                }
            }, {
                key: "getTextHeight",
                value: function getTextHeight(text, font) {
                    var result = this.textHeightCache.get(text, font);
                    if (result !== undefined) return result;
                    var body = document.getElementsByTagName("body")[0];
                    var dummy = document.createElement("div");
                    var dummyText = document.createTextNode("M");
                    dummy.appendChild(dummyText);
                    dummy.setAttribute("style", font);
                    body.appendChild(dummy);
                    result = dummy.offsetHeight;
                    body.removeChild(dummy);
                    this.textHeightCache.set(text, font, result);
                    return result;
                }
            }, {
                key: "eventFire",
                value: function eventFire(el, etype) {
                    var elt = el;
                    if (elt.fireEvent) {
                        elt.fireEvent('on' + etype);
                    } else {
                        var evObj = document.createEvent('Events');
                        evObj.initEvent(etype, true, false);
                        el.dispatchEvent(evObj);
                    }
                }
            }, {
                key: "getOffsetRect",
                value: function getOffsetRect(ancestor, descendant) {
                    var rect = { left: 0, top: 0, width: descendant.offsetWidth, height: descendant.offsetHeight, bottom: NaN, right: NaN };
                    while (descendant) {
                        if (descendant == ancestor) return rect;
                        rect.left += descendant.offsetLeft;
                        rect.top += descendant.offsetTop;
                        descendant = descendant.offsetParent;
                    }
                    return null;
                }
                /**
                 * Detects if an element overflows with respect to its container.
                 * @param element the element to check.
                 * @param container an optional element container or the window by default.
                 * @returns {{left: boolean, top: boolean, bottom: boolean, right: boolean}}
                 */

            }, {
                key: "detectOverflow",
                value: function detectOverflow(element, container) {
                    var overflow = {
                        left: false,
                        right: false,
                        top: false,
                        bottom: false
                    };
                    if (!element) return overflow;
                    if (!container) container = DOMUtils.getWindow(element);
                    var elementRect = element.getBoundingClientRect();
                    if (container instanceof Window) {
                        overflow.left = elementRect.left < 0;
                        overflow.right = elementRect.right > container.innerWidth;
                        overflow.bottom = elementRect.bottom > container.innerHeight;
                        overflow.top = elementRect.top < 0;
                    } else {
                        var containerRect = container.getBoundingClientRect();
                        overflow.left = elementRect.left < containerRect.left;
                        overflow.right = elementRect.right > containerRect.right;
                        overflow.top = elementRect.top < containerRect.top;
                        overflow.bottom = elementRect.bottom > containerRect.bottom;
                    }
                    return overflow;
                }
            }]);

            return DOMUtils;
        }();

        DOMUtils.textHeightCache = new Dictionary2D();
        DOMUtils.textHeightForClassCache = new Dictionary2D();
        util.DOMUtils = DOMUtils;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        var DOMUtils = weavejs.util.DOMUtils;
        var HBox = weavejs.ui.flexbox.HBox;
        var VBox = weavejs.ui.flexbox.VBox;
        var KeyboardUtils = weavejs.util.KeyboardUtils;
        ;

        var ReactUtils = function () {
            function ReactUtils() {
                _classCallCheck(this, ReactUtils);
            }

            _createClass(ReactUtils, null, [{
                key: "openPopout",
                value: function openPopout(jsx, onLoad, onBeforeUnLoad, windowOptions) {
                    var popoutWindow,
                        container,
                        update,
                        close,
                        divId = windowOptions.divId || 'popout-container',
                        url = windowOptions.url || '_blank',
                        title = windowOptions.title || '',
                        windowSettings = windowOptions.windowSettings || "width=900, height=700",
                        popoutWindow = window.open(title, url, windowSettings);
                    if (!popoutWindow) {
                        console.error("Popout window was blocked");
                        return;
                    }
                    popoutWindow.onbeforeunload = function () {
                        if (container) {
                            onBeforeUnLoad && onBeforeUnLoad();
                            ReactDOM.unmountComponentAtNode(container);
                        }
                    };
                    var onloadHandler = function onloadHandler() {
                        if (container) {
                            var existing = popoutWindow.document.getElementById(divId);
                            if (!existing) {
                                ReactDOM.unmountComponentAtNode(container);
                                container = null;
                            } else {
                                return;
                            }
                        }
                        popoutWindow.document.title = windowOptions.windowName || "Weave Pop-Out";
                        container = popoutWindow.document.createElement('div');
                        container.id = divId;
                        popoutWindow.document.body.appendChild(container);
                        if (windowOptions.transferStyle) {
                            var links = document.getElementsByTagName("link");
                            // make link href absolute
                            for (var i = 0; i < links.length; ++i) {
                                var link = links[i].cloneNode();
                                link.setAttribute("href", link.href || "");
                                popoutWindow.document.head.appendChild(link);
                            }
                        }
                        util.polyfill(popoutWindow);
                        ReactDOM.render(jsx, container);
                        onLoad && onLoad();
                    };
                    popoutWindow.onload = onloadHandler;
                    popoutWindow.update = function (jsx) {
                        ReactDOM.render(jsx, container);
                    };
                    onloadHandler();
                    return popoutWindow;
                }
            }, {
                key: "openPopup",
                value: function openPopup(context, jsx) {
                    var closeOnMouseDown = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
                    var onClose = arguments[3];

                    var document = ReactUtils.getDocument(context);
                    var container = ReactUtils.map_document_popupContainer.get(document);
                    if (!container) {
                        container = document.body.appendChild(document.createElement("div"));
                        container.setAttribute("class", "weave");
                        container.setAttribute("style", "position:fixed; left:0px; top:0px; width:100%; height:100%; pointer-events: none;");
                        ReactUtils.map_document_popupContainer.set(document, container);
                    }
                    var element = container.appendChild(document.createElement("div"));
                    var popup = ReactDOM.render(jsx, element);
                    var handler = null;
                    if (closeOnMouseDown) {
                        handler = function handler(event) {
                            if (event.type == "mousedown") {
                                if (element.contains(event.target)) return;
                            }
                            if (event.type == "keydown") {
                                if (event.keyCode != KeyboardUtils.KEYCODES.SPACE && event.keyCode != KeyboardUtils.KEYCODES.ENTER && event.keyCode != KeyboardUtils.KEYCODES.ESC) return;
                            }
                            onClose && onClose(popup);
                            ReactUtils.closePopup(popup);
                        };
                        document.addEventListener("mousedown", handler);
                        document.addEventListener("keydown", handler);
                    }
                    ReactUtils.map_popup_element.set(popup, [element, handler]);
                    return popup;
                }
            }, {
                key: "closePopup",
                value: function closePopup(popup) {
                    if (!ReactUtils.map_popup_element.has(popup)) throw new Error("closePopup() can only be called for popups created by openPopup()");

                    var _ReactUtils$map_popup = ReactUtils.map_popup_element.get(popup),
                        _ReactUtils$map_popup2 = _slicedToArray(_ReactUtils$map_popup, 2),
                        element = _ReactUtils$map_popup2[0],
                        handler = _ReactUtils$map_popup2[1];

                    if (!element.parentNode) return;
                    var document = DOMUtils.getWindow(element).document;
                    if (handler) {
                        document.removeEventListener("mousedown", handler);
                        document.removeEventListener("keydown", handler);
                    }
                    ReactDOM.unmountComponentAtNode(element);
                    var container = ReactUtils.map_document_popupContainer.get(document);
                    container.removeChild(element);
                }
            }, {
                key: "generateTable",
                value: function generateTable(params) {
                    var header = params.header,
                        body = params.body,
                        styles = params.styles,
                        classes = params.classes,
                        props = params.props;

                    styles = styles || {};
                    classes = classes || {};
                    var tableHead = header && React.createElement(
                        "thead",
                        { style: styles.thead, className: classes.thead },
                        header.map(function (cell, index) {
                            var style = Array.isArray(styles.th) ? styles.th[index] : styles.th;
                            return React.createElement(
                                "th",
                                { key: index, style: style, className: classes.th },
                                cell
                            );
                        })
                    );
                    var tableBody = body && React.createElement(
                        "tbody",
                        { style: styles.tbody, className: classes.tbody },
                        body.filter(_.identity).map(function (row, index) {
                            return React.createElement(
                                "tr",
                                { key: index, style: styles.tr, className: classes.tr },
                                row.map(function (cell, index) {
                                    if (cell === undefined) return null;
                                    var style = Array.isArray(styles.td) ? styles.td[index] : styles.td;
                                    var className = Array.isArray(classes.td) ? classes.td[index] : classes.td;
                                    var colSpan = 1;
                                    for (var next = index + 1; next < row.length; next++) {
                                        if (row[next] === undefined) colSpan++;
                                    }return React.createElement("td", { key: index, style: style, className: className, colSpan: colSpan, children: cell });
                                })
                            );
                        })
                    );
                    return React.createElement(
                        "table",
                        { style: styles.table, className: classes.table },
                        tableHead,
                        tableBody
                    );
                    // var allRows = [header].concat(body);
                    // var columns = _.zip(allRows);
                    // return (
                    // 	<HBox style={_.merge({flex: 1}, styles.table)} className={classes.table}>
                    // 	{
                    // 		columns.map((column, i) => {
                    // 			return (
                    // 				<VBox key={i} style={{flex: 1}}>
                    // 				{
                    // 					column.map((cell, j) => {
                    // 						if (j == 0)
                    // 							return <HBox key={j} style={_.merge({flex: 1}, styles.td)} className={classes.thead}> {cell} </HBox>
                    // 						let style = Array.isArray(styles.td) ? (styles.td as React.CSSProperties[])[j] : styles.td;
                    // 						return <HBox key={j} style={_.merge({flex: 1}, styles.td)} className={classes.td}> {cell} </HBox>
                    // 					})
                    // 				}
                    // 				</VBox>
                    // 			)
                    //
                    // 		})
                    // 	}
                    // 	</HBox>
                    // )
                }
                /**
                 * Checks if a component has focus.
                 */

            }, {
                key: "hasFocus",
                value: function hasFocus(component) {
                    return ReactDOM.findDOMNode(component).contains(ReactUtils.getDocument(component).activeElement);
                }
                /**
                 * Calls component.setState(newValues) only if they are different than the current values.
                 */

            }, {
                key: "updateState",
                value: function updateState(component, newValues) {
                    for (var key in newValues) {
                        if (!_.isEqual(component.state[key], newValues[key])) {
                            component.setState(newValues);
                            return;
                        }
                    }
                }
                /**
                 * Replaces the entire component state if it is different from the current state.
                 */

            }, {
                key: "replaceState",
                value: function replaceState(component, newState) {
                    ReactUtils.updateState(component, ReactUtils.includeMissingPropertyPlaceholders(component.state, newState));
                }
                /**
                 * Adds undefined values to new state for properties in current state not
                 * found in new state.
                 */

            }, {
                key: "includeMissingPropertyPlaceholders",
                value: function includeMissingPropertyPlaceholders(currentState, newState) {
                    var key;
                    for (key in currentState) {
                        if (!newState.hasOwnProperty(key)) newState[key] = undefined;
                    }return newState;
                }
            }, {
                key: "onUnmount",
                value: function onUnmount(component, callback) {
                    // add listener to replace instance with placeholder when it is unmounted
                    var superWillUnmount = component.componentWillUnmount;
                    component.componentWillUnmount = function () {
                        if (superWillUnmount) superWillUnmount.call(component);
                        callback(component);
                    };
                }
            }, {
                key: "onWillUpdate",
                value: function onWillUpdate(component, callback) {
                    var superComponentWillUpdate = component.componentWillUpdate;
                    component.componentWillUpdate = function (nextProps, nextState, nextContext) {
                        if (superComponentWillUpdate) superComponentWillUpdate.call(component, nextProps, nextState, nextContext);
                        callback(component, nextProps, nextState, nextContext);
                    };
                }
            }, {
                key: "onWillUpdateRef",
                value: function onWillUpdateRef(callback) {
                    var ref = ReactUtils.map_callback_onWillUpdateRef.get(callback);
                    if (ref) return ref;
                    var prevComponent = void 0;
                    var oldMethod = void 0;
                    ref = function ref(component) {
                        if (component) {
                            oldMethod = component.componentWillUpdate;
                            component.componentWillUpdate = function (nextProps, nextState, nextContext) {
                                if (oldMethod) oldMethod.call(component, nextProps, nextState, nextContext);
                                callback(component, nextProps, nextState, nextContext);
                            };
                            callback(component, component.props, component.state, component.context);
                        } else if (prevComponent) {
                            prevComponent.componentWillUpdate = oldMethod;
                            oldMethod = null;
                        }
                        prevComponent = component;
                    };
                    ReactUtils.map_callback_onWillUpdateRef.set(callback, ref);
                    return ref;
                }
            }, {
                key: "getWindow",
                value: function getWindow(instance) {
                    return DOMUtils.getWindow(ReactUtils.getElement(instance));
                }
            }, {
                key: "getDocument",
                value: function getDocument(instance) {
                    return ReactUtils.getWindow(instance).document;
                }
            }, {
                key: "getElement",
                value: function getElement(instance) {
                    if (instance instanceof React.Component) return ReactDOM.findDOMNode(instance);else return instance;
                }
                /**
                 * Generates a ref function that makes it possible to use ReactUtils.findComponent() on the resulting DOM Element.
                 */

            }, {
                key: "registerComponentRef",
                value: function registerComponentRef(component, then) {
                    var componentSet = null;
                    return function (instance) {
                        if (componentSet) componentSet.delete(component);
                        var element = ReactUtils.getElement(instance);
                        if (element) {
                            componentSet = ReactUtils.map_element_componentSet.get(element);
                            if (!componentSet) {
                                componentSet = new Set();
                                ReactUtils.map_element_componentSet.set(element, componentSet);
                            }
                            componentSet.add(component);
                        } else {
                            componentSet = null;
                        }
                        if (then) then.call(this, instance);
                    };
                }
                /**
                 * Returns the first ancestor React Component of a particular type which has been registered via ReactUtils.registerComponentRef().
                 */

            }, {
                key: "findComponent",
                value: function findComponent(instance, type) {
                    var element = ReactUtils.getElement(instance);
                    if (!element) return null;
                    var rcs = ReactUtils.map_element_componentSet.get(element);
                    if (rcs) {
                        // get the last matching component that was added to the set 
                        var result = null;
                        var _iteratorNormalCompletion8 = true;
                        var _didIteratorError8 = false;
                        var _iteratorError8 = undefined;

                        try {
                            for (var _iterator8 = rcs[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {
                                var rc = _step8.value;

                                if (!type || rc instanceof type) result = rc;
                            }
                        } catch (err) {
                            _didIteratorError8 = true;
                            _iteratorError8 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion8 && _iterator8.return) {
                                    _iterator8.return();
                                }
                            } finally {
                                if (_didIteratorError8) {
                                    throw _iteratorError8;
                                }
                            }
                        }

                        if (result) return result;
                    }
                    return ReactUtils.findComponent(element.parentElement, type);
                }
            }]);

            return ReactUtils;
        }();

        ReactUtils.map_document_popupContainer = new WeakMap();
        ReactUtils.map_popup_element = new WeakMap();
        ReactUtils.generateFlexBoxLayout = function (flexValues, rowsUI) {
            var cellStyles = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
            var cellClassNames = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];

            var wrappedRowsUI = rowsUI.map(function (cells, rowIndex) {
                var cellsUI = [];
                for (var cellIndex = 0; cellIndex < cells.length; cellIndex++) {
                    var customCellStyle = cellStyles[cellIndex] ? cellStyles[cellIndex] : {};
                    // overflow hidden ensures flex values are maintained // default if no overflow values are mentioned
                    var cellStyle = _.merge({ overflow: "hidden" }, customCellStyle, { flex: flexValues[cellIndex] });
                    var cell = React.createElement(
                        "div",
                        { key: cellIndex, style: cellStyle, className: cellClassNames[cellIndex] },
                        cells[cellIndex]
                    );
                    cellsUI.push(cell);
                }
                return React.createElement(
                    HBox,
                    { key: rowIndex, className: "weave-padded-hbox", style: { alignItems: "center" } },
                    cellsUI
                );
            });
            //div wrapper is must if this dom becomes child of flexBox display has to be block for overflow to work correctly
            return React.createElement(
                "div",
                null,
                React.createElement(
                    VBox,
                    { className: "weave-padded-vbox" },
                    wrappedRowsUI
                )
            );
        };
        ReactUtils.generateGridLayout = function (gridValues, gridRowsUI) {
            var columnGridUI = gridRowsUI.map(function (row) {
                var cellsUI = [];
                for (var index = 0; index < row.length; index++) {
                    var cell = React.createElement(
                        "div",
                        { className: gridValues[index] + " wide column" },
                        row[index]
                    );
                    cellsUI.push(cell);
                }
                return cellsUI;
            });
            //div wrapper is must if this dom becomes child of flexBox display has to be block for overflow to work correctly
            return React.createElement(
                "div",
                null,
                React.createElement(
                    "div",
                    { className: "ui grid" },
                    columnGridUI
                )
            );
        };
        ReactUtils.map_callback_onWillUpdateRef = new WeakMap();
        ReactUtils.map_element_componentSet = new WeakMap();
        util.ReactUtils = ReactUtils;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var layout;
        (function (layout) {
            var prefixer = weavejs.css.prefixer;
            var MouseUtils = weavejs.util.MouseUtils;
            var ReactUtils = weavejs.util.ReactUtils;
            var HORIZONTAL = weavejs.ui.layout.DirectionTypes.HORIZONTAL;
            var mouseevents = ["mouseover", "mouseout", "mouseleave"];
            var STYLE_BASE = {
                background: "#000",
                opacity: .3,
                boxSizing: "border-box",
                backgroundClip: "padding",
                position: "absolute"
            };
            ;

            var ResizerOverlay = function (_React$Component20) {
                _inherits(ResizerOverlay, _React$Component20);

                function ResizerOverlay(props) {
                    _classCallCheck(this, ResizerOverlay);

                    var _this28 = _possibleConstructorReturn(this, (ResizerOverlay.__proto__ || Object.getPrototypeOf(ResizerOverlay)).call(this, props));

                    _this28.stopEventPropagation = function (event) {
                        if (_this28.state.active) {
                            event.stopImmediatePropagation();
                        }
                    };
                    _this28.onMouseMove = function (event) {
                        if (_this28.state.active) {
                            event.stopImmediatePropagation();
                            var container = ReactDOM.findDOMNode(_this28).parentNode;
                            var offsetPoint = MouseUtils.getOffsetPoint(container, event);
                            var mousePos = _this28.props.direction === HORIZONTAL ? offsetPoint.x : offsetPoint.y;
                            mousePos = Math.max(_this28.state.range[0], Math.min(mousePos, _this28.state.range[1]));
                            if (_this28.props.direction === HORIZONTAL) {
                                _this28.setState({
                                    x: mousePos - _this28.thickness / 2,
                                    y: 0
                                });
                            } else {
                                _this28.setState({
                                    x: 0,
                                    y: mousePos - _this28.thickness / 2
                                });
                            }
                        }
                    };
                    _this28.state = {
                        active: false,
                        range: [],
                        x: 0,
                        y: 0
                    };
                    return _this28;
                }

                _createClass(ResizerOverlay, [{
                    key: "componentDidMount",
                    value: function componentDidMount() {
                        var _this29 = this;

                        var document = ReactUtils.getDocument(this);
                        document.addEventListener("mousemove", this.onMouseMove, true);
                        mouseevents.forEach(function (mouseevent) {
                            return document.addEventListener(mouseevent, _this29.stopEventPropagation, true);
                        });
                    }
                }, {
                    key: "componentWillUnmount",
                    value: function componentWillUnmount() {
                        var _this30 = this;

                        var document = ReactUtils.getDocument(this);
                        document.removeEventListener("mousemove", this.onMouseMove);
                        mouseevents.forEach(function (mouseevent) {
                            return document.removeEventListener(mouseevent, _this30.stopEventPropagation);
                        });
                    }
                }, {
                    key: "render",
                    value: function render() {
                        var style = _.merge({
                            zIndex: 1,
                            left: this.state.x,
                            top: this.state.y,
                            visibility: this.state.active ? "visible" : "hidden"
                        }, STYLE_BASE);
                        if (this.props.direction == HORIZONTAL) {
                            style.cursor = "col-resize";
                            style.width = this.thickness || layout.Resizer.DEFAULT_SPACING;
                            style.height = "100%";
                        } else {
                            style.cursor = "row-resize";
                            style.width = "100%";
                            style.height = this.thickness || layout.Resizer.DEFAULT_SPACING;
                        }
                        return React.createElement("span", { style: prefixer(style) });
                    }
                }, {
                    key: "thickness",
                    get: function get() {
                        return this.props.thickness || 4;
                    }
                }]);

                return ResizerOverlay;
            }(React.Component);

            layout.ResizerOverlay = ResizerOverlay;
        })(layout = ui.layout || (ui.layout = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var layout;
        (function (layout_1) {
            var prefixer = weavejs.css.prefixer;
            var ReactUtils = weavejs.util.ReactUtils;
            var MouseUtils = weavejs.util.MouseUtils;
            var HORIZONTAL = weavejs.ui.layout.DirectionTypes.HORIZONTAL;
            ;

            var Layout = function (_React$Component21) {
                _inherits(Layout, _React$Component21);

                function Layout(props, state) {
                    _classCallCheck(this, Layout);

                    var _this31 = _possibleConstructorReturn(this, (Layout.__proto__ || Object.getPrototypeOf(Layout)).call(this, props, state));

                    _this31.panelDragging = false;
                    _this31.onMouseDown = function (event) {
                        _this31.resizers.forEach(function (resizer, index) {
                            if (resizer.state && resizer.state.active) {
                                var _this31$getResizerRan = _this31.getResizerRange(index),
                                    _this31$getResizerRan2 = _slicedToArray(_this31$getResizerRan, 2),
                                    begin = _this31$getResizerRan2[0],
                                    end = _this31$getResizerRan2[1];

                                _this31.overlay.setState({
                                    active: true,
                                    range: [begin + _this31.minSize, end + _this31.minSize]
                                });
                                _this31.overlay.onMouseMove(event);
                            }
                        });
                    };
                    _this31.onMouseMove = function (event) {};
                    _this31.onMouseUp = function (event) {
                        var newState = _.cloneDeep(_this31.state);
                        var element = ReactDOM.findDOMNode(_this31);
                        var offsetPoint = MouseUtils.getOffsetPoint(element, event);
                        _this31.resizers.forEach(function (resizer, index) {
                            if (resizer.state && resizer.state.active) {
                                var _this31$getResizerRan3 = _this31.getResizerRange(index),
                                    _this31$getResizerRan4 = _slicedToArray(_this31$getResizerRan3, 2),
                                    begin = _this31$getResizerRan4[0],
                                    end = _this31$getResizerRan4[1];

                                var pos = _this31.state.direction === HORIZONTAL ? offsetPoint.x : offsetPoint.y;
                                var size = _this31.state.direction === HORIZONTAL ? element.offsetWidth : element.offsetHeight;
                                var element1Index = index;
                                var element2Index = index + 1;
                                if (_this31.state.direction === HORIZONTAL && weavejs.WeaveAPI.Locale.reverseLayout) {
                                    element1Index = index + 1;
                                    element2Index = index;
                                }
                                pos = Math.max(begin + _this31.minSize, Math.min(pos, end - _this31.minSize));
                                newState.children[element1Index].flex = (pos - begin) / size;
                                newState.children[element2Index].flex = (end - pos) / size;
                                resizer.setState({ active: false });
                                _this31.overlay.setState({ active: false });
                                _this31.setState(newState);
                            }
                        });
                        _this31.panelDragging = false;
                    };
                    var ps = props.state || {};
                    _this31.state = { id: ps.id, direction: ps.direction, children: ps.children, flex: ps.flex || 1, maximized: ps.maximized };
                    _this31.minSize = 25;
                    _this31.dragging = false;
                    return _this31;
                }

                _createClass(Layout, [{
                    key: "componentDidMount",
                    value: function componentDidMount() {
                        var document = ReactUtils.getDocument(this);
                        document.addEventListener("mouseup", this.onMouseUp);
                        document.addEventListener("mousedown", this.onMouseDown);
                        document.addEventListener("mousemove", this.onMouseMove);
                    }
                }, {
                    key: "componentWillReceiveProps",
                    value: function componentWillReceiveProps(nextProps) {
                        ReactUtils.replaceState(this, nextProps.state);
                    }
                }, {
                    key: "componentWillUnmount",
                    value: function componentWillUnmount() {
                        var document = ReactUtils.getDocument(this);
                        document.removeEventListener("mouseup", this.onMouseUp);
                        document.removeEventListener("mousedown", this.onMouseDown);
                        document.removeEventListener("mousemove", this.onMouseMove);
                    }
                }, {
                    key: "shouldComponentUpdate",
                    value: function shouldComponentUpdate(nextProps, nextState) {
                        return !_.isEqual(this.state, nextState) || !_.isEqual(this.state, nextProps.state) || !_.isEqual(this.props, nextProps);
                    }
                }, {
                    key: "componentDidUpdate",
                    value: function componentDidUpdate() {
                        if (this.props.onStateChange && this.state) this.props.onStateChange(this.state);
                    }
                }, {
                    key: "getElementFromId",
                    value: function getElementFromId(id) {
                        var component = this.getComponentFromId(id);
                        return component ? ReactDOM.findDOMNode(component) : null;
                    }
                }, {
                    key: "getComponentFromId",
                    value: function getComponentFromId(id) {
                        if (this.state.id && _.isEqual(this.state.id, id)) {
                            return this;
                        } else {
                            var _iteratorNormalCompletion9 = true;
                            var _didIteratorError9 = false;
                            var _iteratorError9 = undefined;

                            try {
                                for (var _iterator9 = this.children[Symbol.iterator](), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {
                                    var child = _step9.value;

                                    var component = child && child.getComponentFromId(id);
                                    if (component) return component;
                                }
                            } catch (err) {
                                _didIteratorError9 = true;
                                _iteratorError9 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion9 && _iterator9.return) {
                                        _iterator9.return();
                                    }
                                } finally {
                                    if (_didIteratorError9) {
                                        throw _iteratorError9;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                }, {
                    key: "getResizerRange",
                    value: function getResizerRange(resizerIndex) {
                        var element1Index = resizerIndex;
                        var element2Index = resizerIndex + 1;
                        if (this.state.direction === HORIZONTAL && weavejs.WeaveAPI.Locale.reverseLayout) {
                            element1Index = resizerIndex + 1;
                            element2Index = resizerIndex;
                        }
                        var element1 = ReactDOM.findDOMNode(this.children[element1Index]);
                        var element2 = ReactDOM.findDOMNode(this.children[element2Index]);
                        if (this.state.direction === HORIZONTAL) return [element1.offsetLeft, element2.offsetLeft + element2.offsetWidth];else return [element1.offsetTop, element2.offsetTop + element2.offsetHeight];
                    }
                }, {
                    key: "generateStyle",
                    value: function generateStyle() {
                        var style = {
                            display: "flex",
                            flex: this.state.flex || 1,
                            position: "relative",
                            outline: "none",
                            overflow: "hidden",
                            userSelect: "none",
                            flexDirection: this.state.direction === HORIZONTAL ? "row" : "column"
                        };
                        return prefixer(style);
                    }
                }, {
                    key: "render",
                    value: function render() {
                        var _this32 = this;

                        return React.createElement(
                            "div",
                            { style: this.generateStyle() },
                            this.props.children,
                            Array.isArray(this.props.children) && this.props.children.length ? React.createElement(layout_1.ResizerOverlay, { ref: function ref(overlay) {
                                    return _this32.overlay = overlay;
                                }, direction: this.state.direction, thickness: this.props.spacing }) : null
                        );
                    }
                }], [{
                    key: "renderLayout",
                    value: function renderLayout(props) {
                        var key = props.key,
                            state = props.state,
                            onStateChange = props.onStateChange,
                            spacing = props.spacing;

                        var ref = props.ref;
                        var parentLayout;
                        var elements = [];
                        var children = [];
                        var resizers = [];
                        if (state && state.children && state.children.length > 0) {
                            var onChildStateChange = function onChildStateChange(childIndex, childState) {
                                if (!parentLayout) return;
                                var stateCopy = _.cloneDeep(parentLayout.state);
                                stateCopy.children[childIndex] = childState;
                                parentLayout.setState(stateCopy);
                            };
                            var saveChild = function saveChild(i, child) {
                                return children[i] = child;
                            };
                            var saveResizer = function saveResizer(i, resizer) {
                                return resizers[i] = resizer;
                            };
                            state.children.forEach(function (childState, i) {
                                if (i > 0) elements.push(React.createElement(layout_1.Resizer, { key: "resizer[" + (i - 1) + "]", ref: saveResizer.bind(null, i - 1), direction: state.direction, spacing: spacing }));
                                elements.push(Layout.renderLayout({
                                    key: "child[" + i + "]",
                                    ref: saveChild.bind(null, i),
                                    state: childState,
                                    onStateChange: onChildStateChange.bind(null, i),
                                    spacing: spacing
                                }));
                            });
                            if (state.direction === HORIZONTAL && weavejs.WeaveAPI.Locale.reverseLayout) elements.reverse();
                        }
                        var refCallback = function refCallback(layout) {
                            parentLayout = layout;
                            if (layout) {
                                layout.children = children;
                                layout.resizers = resizers;
                            }
                            if (ref) ref(layout);
                        };
                        return React.createElement(Layout, { key: key, ref: refCallback, children: elements, state: _.cloneDeep(Object(state)), onStateChange: onStateChange, spacing: spacing });
                    }
                }]);

                return Layout;
            }(React.Component);

            layout_1.Layout = Layout;
        })(layout = ui.layout || (ui.layout = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var ReactUtils = weavejs.util.ReactUtils;
        /**
         * Provides a way to make elements using percentage coordinates resize properly within a div that uses flex layout.
         */

        var ResizingDiv = function (_React$Component22) {
            _inherits(ResizingDiv, _React$Component22);

            function ResizingDiv() {
                var _ref2;

                _classCallCheck(this, ResizingDiv);

                for (var _len3 = arguments.length, args = Array(_len3), _key4 = 0; _key4 < _len3; _key4++) {
                    args[_key4] = arguments[_key4];
                }

                var _this33 = _possibleConstructorReturn(this, (_ref2 = ResizingDiv.__proto__ || Object.getPrototypeOf(ResizingDiv)).call.apply(_ref2, [this].concat(args)));

                _this33.state = {};
                return _this33;
            }

            _createClass(ResizingDiv, [{
                key: "componentDidMount",
                value: function componentDidMount() {
                    this.outerDiv = ReactDOM.findDOMNode(this);
                    weavejs.WeaveAPI.Scheduler.frameCallbacks.addImmediateCallback(this, this.handleFrame);
                }
            }, {
                key: "handleFrame",
                value: function handleFrame() {
                    var rect = this.outerDiv.getBoundingClientRect();
                    var width = this.outerDiv.offsetWidth == this.outerDiv.clientWidth ? rect.width : this.outerDiv.offsetWidth;
                    var height = this.outerDiv.offsetHeight == this.outerDiv.clientHeight ? rect.height : this.outerDiv.offsetHeight;
                    ReactUtils.updateState(this, {
                        width: Math.floor(width),
                        height: Math.floor(height)
                    });
                }
            }, {
                key: "componentDidUpdate",
                value: function componentDidUpdate() {
                    if (this.props.onResize) this.props.onResize(this.state);
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    weavejs.WeaveAPI.Scheduler.frameCallbacks.removeCallback(this, this.handleFrame);
                }
            }, {
                key: "render",
                value: function render() {
                    var outerStyle = _.merge({ flex: 1 }, this.props.style, { overflow: 'hidden' });
                    var innerStyle = _.merge({}, this.state, this.props.innerStyle);
                    return React.createElement(
                        "div",
                        _extends({}, this.props, { style: outerStyle }),
                        React.createElement(
                            "div",
                            { style: innerStyle },
                            this.props.children
                        )
                    );
                }
            }]);

            return ResizingDiv;
        }(React.Component);

        ui.ResizingDiv = ResizingDiv;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var HBox = weavejs.ui.flexbox.HBox;
        var KeyboardUtils = weavejs.util.KeyboardUtils;
        var ReactUtils = weavejs.util.ReactUtils;

        var List = function (_React$Component23) {
            _inherits(List, _React$Component23);

            function List(props) {
                _classCallCheck(this, List);

                var _this34 = _possibleConstructorReturn(this, (List.__proto__ || Object.getPrototypeOf(List)).call(this, props));

                _this34.listItems = [];
                _this34.handleKeyDown = function (event) {
                    if (event.keyCode == KeyboardUtils.KEYCODES.UP_ARROW || event.keyCode == KeyboardUtils.KEYCODES.DOWN_ARROW) {
                        event.preventDefault();
                        if (event.keyCode == KeyboardUtils.KEYCODES.UP_ARROW) {
                            _this34.focusPreviousItem();
                        } else if (event.keyCode == KeyboardUtils.KEYCODES.DOWN_ARROW) {
                            _this34.focusNextItem();
                        }
                    }
                };
                _this34.handleKeyDownOnListItem = function (value, event) {
                    if (event.keyCode == KeyboardUtils.KEYCODES.SPACE) {
                        event.preventDefault();
                        _this34.handleChange(value, event);
                    }
                };
                _this34.handleChange = function (value, event) {
                    var selectedValues = _this34.state.selectedValues.concat();
                    // new state of the item in the list
                    var currentIndexClicked = selectedValues.indexOf(value);
                    // ctrl selection
                    if ((event.ctrlKey || event.metaKey) && _this34.props.multiple) {
                        if (currentIndexClicked > -1) {
                            selectedValues.splice(currentIndexClicked, 1);
                        } else {
                            selectedValues.push(value);
                        }
                        _this34.lastSelectedIndex = currentIndexClicked;
                    } else if (event.shiftKey && _this34.props.multiple) {
                        selectedValues = [];
                        if (_this34.lastSelectedIndex == null) {} else {
                            var start = _this34.lastSelectedIndex;
                            var end = _this34.values.indexOf(value);
                            if (start > end) {
                                var temp = start;
                                start = end;
                                end = temp;
                            }
                            for (var i = start; i <= end; i++) {
                                selectedValues.push(_this34.values[i]);
                            }
                        }
                    } else {
                        // if there was only one record selected
                        // and we are clicking on it again, then we want to
                        // clear the selection unless allowClear is not enabled.
                        if (selectedValues.length == 1 && selectedValues[0] == value && _this34.props.allowClear) {
                            selectedValues = [];
                            _this34.lastSelectedIndex = null;
                        } else {
                            selectedValues = [value];
                            _this34.lastSelectedIndex = _this34.values.indexOf(value);
                        }
                    }
                    if (_this34.props.onChange) _this34.props.onChange(selectedValues);
                    _this34.setState({
                        selectedValues: selectedValues
                    });
                };
                _this34.state = {
                    selectedValues: props.selectedValues || []
                };
                if (props.selectedValues) {
                    _this34.lastSelectedIndex = props.selectedValues.length - 1;
                }
                if (_this34.props.options && _this34.props.options.length) {
                    _this34.values = _this34.props.options.map(function (option) {
                        return option.value;
                    });
                    _this34.labels = _this34.props.options.map(function (option) {
                        return option.label;
                    });
                } else {
                    _this34.values = [];
                    _this34.labels = [];
                }
                return _this34;
            }

            _createClass(List, [{
                key: "componentDidMount",
                value: function componentDidMount() {
                    this.listContainer = ReactDOM.findDOMNode(this);
                }
            }, {
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(nextProps) {
                    this.values = nextProps.options.map(function (option) {
                        return option.value;
                    });
                    this.labels = nextProps.options.map(function (option) {
                        return option.label;
                    });
                    if (nextProps.selectedValues) {
                        this.setState({
                            selectedValues: nextProps.selectedValues
                        });
                    }
                }
            }, {
                key: "focusNextItem",
                value: function focusNextItem() {
                    var index = _.min([this.listItems.indexOf(ReactUtils.getDocument(this).activeElement) + 1, this.numberOfOptions]);
                    this.focusItem(index);
                }
            }, {
                key: "focusPreviousItem",
                value: function focusPreviousItem() {
                    var index = _.max([this.listItems.indexOf(ReactUtils.getDocument(this).activeElement) - 1, 0]);
                    this.focusItem(index);
                }
            }, {
                key: "focusItem",
                value: function focusItem(index) {
                    this.listItems[index].focus();
                }
            }, {
                key: "render",
                value: function render() {
                    var _this35 = this;

                    //order in merge is important as props.style is readonly and overlfow "auto" is compulsory
                    var styleObj = _.merge({}, this.props.style, { overflow: "auto" });
                    var listClassName = "weave-list " + this.props.className ? this.props.className : "";
                    return React.createElement(
                        "div",
                        { style: styleObj, "aria-role": "listbox", className: listClassName, tabIndex: 0, onKeyDown: this.handleKeyDown },
                        this.values.map(function (value, index) {
                            var selected = _this35.state.selectedValues.indexOf(value) >= 0;
                            var style = {
                                alignItems: "center",
                                whiteSpace: "nowrap",
                                textOverflow: "ellipsis",
                                overflow: "hidden"
                            };
                            var className = classNames({
                                'weave-list-item': true,
                                'weave-list-item-selected': selected
                            });
                            return React.createElement(
                                HBox,
                                { key: index, ref: function ref(c) {
                                        _this35.listItems[index] = ReactDOM.findDOMNode(c);
                                    }, "aria-role": "option", style: style, tabIndex: 0, onMouseEnter: function onMouseEnter() {
                                        return _this35.listItems[index].focus();
                                    }, onMouseLeave: function onMouseLeave() {
                                        return _this35.listItems[index].blur();
                                    }, className: className, onClick: function onClick(event) {
                                        return _this35.handleChange(value, event);
                                    }, onKeyDown: function onKeyDown(event) {
                                        return _this35.handleKeyDownOnListItem(value, event);
                                    } },
                                _this35.labels[index] || String(value)
                            );
                        })
                    );
                }
            }, {
                key: "numberOfOptions",
                get: function get() {
                    return this.props.options.length - 1;
                }
            }], [{
                key: "defaultProps",
                value: function defaultProps() {
                    return {
                        options: [],
                        multiple: true,
                        allowClear: true
                    };
                }
            }]);

            return List;
        }(React.Component);

        ui.List = List;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var HBox = weavejs.ui.flexbox.HBox;
        var ReactUtils = weavejs.util.ReactUtils;

        var HelpIcon = function (_React$Component24) {
            _inherits(HelpIcon, _React$Component24);

            function HelpIcon(props) {
                _classCallCheck(this, HelpIcon);

                return _possibleConstructorReturn(this, (HelpIcon.__proto__ || Object.getPrototypeOf(HelpIcon)).call(this, props));
            }

            _createClass(HelpIcon, [{
                key: "removePopup",
                value: function removePopup() {
                    if (this.popup) ReactUtils.closePopup(this.popup);
                    this.popup = null;
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    this.removePopup();
                }
            }, {
                key: "render",
                value: function render() {
                    var _this37 = this;

                    var props = {};
                    for (var key in this.props) {
                        if (key != "children" && key != "ref" && key != "key") props[key] = this.props[key];
                    }return React.createElement("i", _extends({}, props, { className: "weave-help-icon fa fa-question-circle fa-fw" + (" " + this.props.className || ""), onMouseEnter: function onMouseEnter(event) {
                            _this37.popup = ReactUtils.openPopup(_this37, React.createElement(HBox, { style: {
                                    position: "absolute",
                                    left: event.clientX + 10,
                                    top: event.clientY + 10,
                                    maxWidth: 400
                                }, className: "weave-help-tooltip", children: _this37.props.children }));
                        }, onMouseLeave: function onMouseLeave() {
                            return _this37.removePopup();
                        } }));
                }
            }]);

            return HelpIcon;
        }(React.Component);

        ui.HelpIcon = HelpIcon;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var ReactUtils = weavejs.util.ReactUtils;
        var KeyboardUtils = weavejs.util.KeyboardUtils;

        var Popup = function (_React$Component25) {
            _inherits(Popup, _React$Component25);

            function Popup() {
                var _ref3;

                _classCallCheck(this, Popup);

                for (var _len4 = arguments.length, args = Array(_len4), _key5 = 0; _key5 < _len4; _key5++) {
                    args[_key5] = arguments[_key5];
                }

                var _this38 = _possibleConstructorReturn(this, (_ref3 = Popup.__proto__ || Object.getPrototypeOf(Popup)).call.apply(_ref3, [this].concat(args)));

                _this38.onContextMenu = function (event) {
                    //ContextMenu.open(event); // this would create a circular dependency...
                    if (_this38.props.onContextMenu) _this38.props.onContextMenu(event);
                };
                return _this38;
            }

            _createClass(Popup, [{
                key: "componentDidMount",
                value: function componentDidMount() {
                    ReactUtils.getDocument(this).addEventListener("keydown", this.onKeyDown);
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    ReactUtils.getDocument(this).addEventListener("keydown", this.onKeyDown);
                }
            }, {
                key: "onKeyDown",
                value: function onKeyDown(event) {
                    var code = event.keyCode;
                    if (code == KeyboardUtils.KEYCODES.ESC) {
                        var activePopup = Array.from(Popup.popupSet.keys()).pop();
                        if (this == activePopup) Popup.close(activePopup);
                    }
                }
            }, {
                key: "render",
                value: function render() {
                    return React.createElement(
                        "div",
                        _extends({}, this.props, this.state, { onContextMenu: this.onContextMenu }),
                        React.createElement(
                            "div",
                            { style: { pointerEvents: "auto" } },
                            this.props.children
                        )
                    );
                }
            }], [{
                key: "open",
                value: function open(context, jsx) {
                    var closeOnMouseDown = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
                    var onClose = arguments[3];

                    var popup = ReactUtils.openPopup(context, React.createElement(
                        Popup,
                        { style: { zIndex: 0 } },
                        jsx
                    ), closeOnMouseDown, function (popup) {
                        Popup.close(popup);
                        if (onClose) onClose(popup);
                    });
                    Popup.popupSet.add(popup);
                    Popup.alignPopups();
                    return popup;
                }
            }, {
                key: "close",
                value: function close(popup) {
                    Popup.popupSet.delete(popup);
                    ReactUtils.closePopup(popup);
                }
            }, {
                key: "alignPopups",
                value: function alignPopups() {
                    var index = 0;
                    var _iteratorNormalCompletion10 = true;
                    var _didIteratorError10 = false;
                    var _iteratorError10 = undefined;

                    try {
                        for (var _iterator10 = Popup.popupSet[Symbol.iterator](), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {
                            var popup = _step10.value;

                            popup.setState({
                                style: {
                                    position: "absolute",
                                    top: 0,
                                    left: 0,
                                    width: "100%",
                                    height: "100%",
                                    pointerEvents: "none",
                                    zIndex: index
                                }
                            });
                            index++;
                        }
                    } catch (err) {
                        _didIteratorError10 = true;
                        _iteratorError10 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion10 && _iterator10.return) {
                                _iterator10.return();
                            }
                        } finally {
                            if (_didIteratorError10) {
                                throw _iteratorError10;
                            }
                        }
                    }
                }
            }, {
                key: "bringToFront",
                value: function bringToFront(popup) {
                    Popup.popupSet.delete(popup);
                    Popup.popupSet.add(popup);
                    Popup.alignPopups();
                }
            }]);

            return Popup;
        }(React.Component);

        Popup.popupSet = new Set();
        ui.Popup = Popup;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var menu;
        (function (menu_1) {
            var HBox = weavejs.ui.flexbox.HBox;
            var ReactUtils = weavejs.util.ReactUtils;
            var KeyboardUtils = weavejs.util.KeyboardUtils;
            var DOMUtils = weavejs.util.DOMUtils;
            var REACT_COMPONENT = "reactComponent";
            var GET_MENU_ITEMS = "getMenuItems";
            var SEPARATOR = {};
            var renderDivider = function renderDivider(index) {
                return React.createElement("div", { key: "divider#" + index, className: "divider weave-menu-divider" });
            };

            var Menu = function (_React$Component26) {
                _inherits(Menu, _React$Component26);

                function Menu(props) {
                    _classCallCheck(this, Menu);

                    var _this39 = _possibleConstructorReturn(this, (Menu.__proto__ || Object.getPrototypeOf(Menu)).call(this, props));

                    _this39.lastOverflow = { left: false, top: false, right: false, bottom: false };
                    _this39.handleKeyPress = function (event) {
                        var nextIndex = -1;
                        if (event.keyCode == KeyboardUtils.KEYCODES.UP_ARROW) {
                            nextIndex = _this39.state.activeIndex - 1;
                        } else if (event.keyCode == KeyboardUtils.KEYCODES.DOWN_ARROW) {
                            nextIndex = _this39.state.activeIndex + 1;
                        }
                        var nextItem = _this39.menuItemList[nextIndex];
                        var nextElt = null;
                        if (nextItem) nextElt = ReactDOM.findDOMNode(nextItem);
                        if (nextElt) nextElt.focus();
                    };
                    _this39.onMouseEnter = function (index) {
                        var menuItem = _this39.menuItemList[index];
                        if (menuItem) menuItem.focus();
                    };
                    _this39.onMouseLeave = function (index) {
                        var menuItem = _this39.menuItemList[index];
                        if (menuItem) menuItem.blur();
                    };
                    _this39.onFocus = function (index) {
                        _this39.setState({
                            activeIndex: index
                        });
                    };
                    _this39.onBlur = function () {
                        _this39.setState({
                            activeIndex: -1
                        });
                    };
                    _this39.state = {
                        activeIndex: -1,
                        top: props.style ? props.style.top : null,
                        left: props.style ? props.style.left : null
                    };
                    _this39.menuItemList = [];
                    return _this39;
                }

                _createClass(Menu, [{
                    key: "componentDidMount",
                    value: function componentDidMount() {
                        // we could get these elements in the ref function
                        // but it's safer here
                        this.element = ReactDOM.findDOMNode(this);
                        this.opener = this.props.opener ? ReactDOM.findDOMNode(this.props.opener) : null;
                        ReactUtils.getDocument(this).addEventListener("keydown", this.handleKeyPress);
                        // if (this.element && WeaveAPI.Locale.reverseLayout)
                        // {
                        // 	// TODO fix this logic
                        // 	// var menuRect = this.element.getBoundingClientRect();
                        // 	// menuStyle.left = 0 - this.element.clientWidth;
                        // 	// if (menuRect.left - menuStyle.left < 0)
                        // 	// 	menuStyle.left = 0;
                        // }
                        if (this.opener) {
                            var openerRect = this.opener.getBoundingClientRect();
                            this.setState({
                                top: openerRect.top + openerRect.height,
                                left: openerRect.left
                            });
                        } else {
                            this.forceUpdate();
                        }
                    }
                }, {
                    key: "componentDidUpdate",
                    value: function componentDidUpdate() {
                        this.handleOverflow();
                    }
                }, {
                    key: "handleOverflow",
                    value: function handleOverflow() {
                        var overflow = DOMUtils.detectOverflow(this.element);
                        var menuRect = this.element.getBoundingClientRect();
                        var newState = _.clone(this.state);
                        if (overflow.bottom && !overflow.top && !this.lastOverflow.top) {
                            newState.top -= menuRect.height;
                            if (this.opener) newState.top -= this.opener.clientHeight;
                        }
                        if (overflow.right && !overflow.left && !this.lastOverflow.left) {
                            newState.left -= menuRect.width;
                            if (this.opener) newState.left -= this.opener.clientWidth;
                        }
                        // if there is a top overflow as a result of a flip due to bottom overflow
                        // put the menu back to the bottom
                        if (overflow.top && this.lastOverflow.bottom) {
                            newState.top += menuRect.height;
                            if (this.opener) newState.top += this.opener.clientHeight;
                        }
                        if (overflow.left && this.lastOverflow.right) {
                            newState.left += menuRect.width;
                            if (this.opener) newState.left += this.opener.clientWidth;
                        }
                        this.lastOverflow = overflow;
                        ReactUtils.updateState(this, newState);
                    }
                }, {
                    key: "componentWillUnmount",
                    value: function componentWillUnmount() {
                        ReactUtils.getDocument(this).removeEventListener("keydown", this.handleKeyPress);
                    }
                }, {
                    key: "renderMenuItems",
                    value: function renderMenuItems(menu) {
                        var _this40 = this;

                        var filteredMenu = [];
                        // remove hidden menu elements
                        filteredMenu = menu.filter(function (menuItem) {
                            return menuItem.hasOwnProperty('shown') ? !!menuItem.shown : true;
                        });
                        // remove redundant separators
                        filteredMenu = filteredMenu.filter(function (menuItem, index, array) {
                            var item = menuItem;
                            var next_item = array[index + 1];
                            return !(_.isEqual(item, SEPARATOR) && _.isEqual(next_item, SEPARATOR));
                        });
                        // remove the first item if it is a separator
                        if (_.isEqual(filteredMenu[0], SEPARATOR)) filteredMenu.shift();
                        // remove the last item if it is a separtor
                        if (_.isEqual(filteredMenu[filteredMenu.length - 1], SEPARATOR)) filteredMenu.pop();
                        var dividerIndex = 0;
                        var menuIndex = 0;
                        return filteredMenu.map(function (menuItem) {
                            if (_.isEqual(menuItem, SEPARATOR)) {
                                return renderDivider(dividerIndex++);
                            } else {
                                return _this40.renderMenuItem(menuIndex++, menuItem);
                            }
                        });
                    }
                }, {
                    key: "renderMenuItem",
                    value: function renderMenuItem(index, props) {
                        var _this41 = this;

                        var enabled = props.hasOwnProperty('enabled') ? !!props.enabled : true; // default true
                        var labelClass = classNames({
                            'weave-menuitem-label': true,
                            'weave-menuitem-label-padding-left': !!props.leftIcon,
                            'weave-menuitem-label-padding-right': !!props.rightIcon
                        });
                        var menuItemClass = classNames({
                            'disabled': !enabled,
                            'weave-menuitem': true,
                            'weave-menuitem-focused': this.state.activeIndex == index
                        });
                        var click = function click(event) {
                            if (event.type != "keydown" && event.type != "mouseup") return;
                            if (event.type == "keydown" && event.keyCode != KeyboardUtils.KEYCODES.SPACE && event.keyCode != KeyboardUtils.KEYCODES.ENTER) return;
                            if (!props.menu && props.click && enabled) props.click();else {
                                // block if the menu item is disabled
                                // so that the menu doesn't close
                                event.preventDefault();
                                event.stopPropagation();
                            }
                        };
                        return React.createElement(
                            "div",
                            { className: menuItemClass, tabIndex: 0, ref: function ref(e) {
                                    return _this41.menuItemList[index] = e;
                                }, onMouseUp: click, onKeyDown: click, onFocus: function onFocus() {
                                    return _this41.onFocus(index);
                                }, onBlur: this.onBlur, onMouseEnter: function onMouseEnter() {
                                    return _this41.onMouseEnter(index);
                                }, onMouseLeave: function onMouseLeave() {
                                    return _this41.onMouseLeave(index);
                                }, key: "item#" + index, style: props.itemStyleOverride },
                            React.createElement(
                                HBox,
                                null,
                                React.createElement(
                                    "div",
                                    null,
                                    props.leftIcon
                                ),
                                React.createElement(
                                    HBox,
                                    { className: labelClass },
                                    props.label
                                ),
                                React.createElement(
                                    "div",
                                    null,
                                    props.rightIcon
                                )
                            ),
                            React.createElement(
                                "span",
                                null,
                                props.secondaryLabel
                            ),
                            props.menu ? React.createElement(Menu, { menu: props.menu }) : null
                        );
                    }
                }, {
                    key: "render",
                    value: function render() {
                        var menuStyle = { position: "absolute" };
                        // get positions and other styles
                        menuStyle = _.merge(menuStyle, this.props.style, { left: this.state.left, top: this.state.top });
                        return React.createElement(
                            "div",
                            _extends({ className: "weave-menu" }, this.props, { style: menuStyle }),
                            this.props.header ? React.createElement(
                                "div",
                                { className: "header" },
                                this.props.header
                            ) : null,
                            this.renderMenuItems(this.props.menu)
                        );
                    }
                }], [{
                    key: "registerMenuSource",
                    value: function registerMenuSource(component) {
                        ReactDOM.findDOMNode(component)[REACT_COMPONENT] = component;
                    }
                }, {
                    key: "getMenuItems",
                    value: function getMenuItems(element) {
                        //var elt = element as any;
                        while (element != null) {
                            var elt = element;
                            if (elt[REACT_COMPONENT] && elt[REACT_COMPONENT][GET_MENU_ITEMS]) {
                                return elt[REACT_COMPONENT][GET_MENU_ITEMS]();
                            } else {
                                element = element.parentElement;
                            }
                        }
                        return [];
                    }
                }]);

                return Menu;
            }(React.Component);

            menu_1.Menu = Menu;
        })(menu = ui.menu || (ui.menu = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var StatefulTextField = function (_React$Component27) {
            _inherits(StatefulTextField, _React$Component27);

            function StatefulTextField(props) {
                _classCallCheck(this, StatefulTextField);

                var _this42 = _possibleConstructorReturn(this, (StatefulTextField.__proto__ || Object.getPrototypeOf(StatefulTextField)).call(this, props));

                _this42.handleSelectOnFocus = function () {
                    if (_this42.props.selectOnFocus) {
                        _this42.input.inputElement.select();
                    }
                };
                _this42.handleInputChange = function (event) {
                    var value = event.target.value;
                    _this42.setState({ value: value || "" });
                };
                _this42.state = {
                    value: props.value
                };
                return _this42;
            }

            _createClass(StatefulTextField, [{
                key: "render",
                value: function render() {
                    var _this43 = this;

                    return React.createElement(ui.Input, _extends({ type: "text" }, this.props, { ref: function ref(input) {
                            return _this43.input = input;
                        }, onChange: this.handleInputChange, onBlur: this.handleInputChange, onSubmit: this.handleInputChange, onFocus: this.handleSelectOnFocus, value: this.state.value }));
                }
            }]);

            return StatefulTextField;
        }(React.Component);

        StatefulTextField.defaultProps = {
            fluid: true,
            disabled: false
        };
        ui.StatefulTextField = StatefulTextField;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var StatefulTextArea = function (_React$Component28) {
            _inherits(StatefulTextArea, _React$Component28);

            function StatefulTextArea(props) {
                _classCallCheck(this, StatefulTextArea);

                var _this44 = _possibleConstructorReturn(this, (StatefulTextArea.__proto__ || Object.getPrototypeOf(StatefulTextArea)).call(this, props));

                _this44.handleSelectOnFocus = function () {
                    if (_this44.props.selectOnFocus) {
                        _this44.textArea.select();
                    }
                };
                _this44.handleTextAreaChange = function (event) {
                    var value = event.target.value;
                    _this44.setState({ value: value || "" });
                };
                _this44.state = {
                    value: props.value
                };
                return _this44;
            }

            _createClass(StatefulTextArea, [{
                key: "render",
                value: function render() {
                    var _this45 = this;

                    return React.createElement(
                        "div",
                        { className: "ui form" },
                        React.createElement("textarea", _extends({ rows: 4 }, this.props, { ref: function ref(textArea) {
                                return _this45.textArea = textArea;
                            }, onChange: this.handleTextAreaChange, onBlur: this.handleTextAreaChange, onSubmit: this.handleTextAreaChange, onFocus: this.handleSelectOnFocus, value: this.state.value }))
                    );
                }
            }]);

            return StatefulTextArea;
        }(React.Component);

        StatefulTextArea.defaultProps = {
            fluid: true,
            disabled: false
        };
        ui.StatefulTextArea = StatefulTextArea;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var menu;
        (function (menu) {
            var Menu = weavejs.ui.menu.Menu;
            var ReactUtils = weavejs.util.ReactUtils;
            var Popup = weavejs.ui.Popup;

            var ContextMenu = function (_Menu) {
                _inherits(ContextMenu, _Menu);

                function ContextMenu() {
                    var _ref4;

                    _classCallCheck(this, ContextMenu);

                    for (var _len5 = arguments.length, args = Array(_len5), _key6 = 0; _key6 < _len5; _key6++) {
                        args[_key6] = arguments[_key6];
                    }

                    var _this46 = _possibleConstructorReturn(this, (_ref4 = ContextMenu.__proto__ || Object.getPrototypeOf(ContextMenu)).call.apply(_ref4, [this].concat(args)));

                    _this46.handleClick = function () {
                        Popup.close(_this46.popup);
                    };
                    return _this46;
                }

                _createClass(ContextMenu, [{
                    key: "render",
                    value: function render() {
                        return React.createElement(Menu, _extends({ ref: ReactUtils.registerComponentRef }, this.props, { onClick: this.handleClick }));
                    }
                }], [{
                    key: "open",
                    value: function open(event) {
                        var contextMenuItems = Menu.getMenuItems(event.target);
                        if (!contextMenuItems.length) return;
                        event.preventDefault();
                        var contextMenu = null;
                        var popup = Popup.open(event.target, React.createElement(ContextMenu, { menu: contextMenuItems, ref: function ref(c) {
                                return contextMenu = c;
                            }, style: {
                                top: event.clientY,
                                left: event.clientX
                            } }), true);
                        contextMenu.popup = popup;
                    }
                }]);

                return ContextMenu;
            }(Menu);

            menu.ContextMenu = ContextMenu;
        })(menu = ui.menu || (ui.menu = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        /**
         * A SmartComponent knows when it should update and when it's ok to setState().
         */
        var SmartComponent = function (_React$Component29) {
            _inherits(SmartComponent, _React$Component29);

            function SmartComponent(props) {
                _classCallCheck(this, SmartComponent);

                var _this47 = _possibleConstructorReturn(this, (SmartComponent.__proto__ || Object.getPrototypeOf(SmartComponent)).call(this, props));

                if (!_this47.state) _this47.state = {};
                return _this47;
            }

            _createClass(SmartComponent, [{
                key: "setState",
                value: function setState(newState, callback) {
                    if (this.context) {
                        _get(SmartComponent.prototype.__proto__ || Object.getPrototypeOf(SmartComponent.prototype), "setState", this).call(this, newState, callback);
                        return;
                    }
                    if (typeof newState === 'function') newState = newState(this.state, this.props);
                    this.state = _.merge(this.state, newState);
                    if (callback) callback();
                }
            }, {
                key: "shouldComponentUpdate",
                value: function shouldComponentUpdate(nextProps, nextState, nextContext) {
                    return !_.isEqual(this.state, nextState) || !_.isEqual(this.props, nextProps) || !_.isEqual(this.context, nextContext);
                }
            }]);

            return SmartComponent;
        }(React.Component);

        ui.SmartComponent = SmartComponent;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var LinkablePlaceholder = weavejs.core.LinkablePlaceholder;
        var ReactUtils = weavejs.util.ReactUtils;
        var VBox = weavejs.ui.flexbox.VBox;
        var SmartComponent = weavejs.ui.SmartComponent;
        var LinkableWatcher = weavejs.core.LinkableWatcher;

        var WeaveComponentRenderer = function (_SmartComponent) {
            _inherits(WeaveComponentRenderer, _SmartComponent);

            function WeaveComponentRenderer(props) {
                _classCallCheck(this, WeaveComponentRenderer);

                var _this48 = _possibleConstructorReturn(this, (WeaveComponentRenderer.__proto__ || Object.getPrototypeOf(WeaveComponentRenderer)).call(this, props));

                _this48.watcher = Weave.disposableChild(_this48, new LinkableWatcher(null, null, _this48.handleWatcher.bind(_this48)));
                _this48.key = 0;
                _this48.handleGeneratedComponent = function (component) {
                    if (component) {
                        _this48.generatedComponent = component;
                        LinkablePlaceholder.setInstance(_this48.watcher.target, component);
                    }
                    ReactUtils.updateState(_this48, { target: component });
                };
                _this48.state = {};
                _this48.handleProps(props);
                return _this48;
            }

            _createClass(WeaveComponentRenderer, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(props) {
                    this.handleProps(props);
                }
            }, {
                key: "handleProps",
                value: function handleProps(props) {
                    var weaveChanged = this.props.weave != props.weave;
                    var pathChanged = !_.isEqual(this.props.path, props.path);
                    if (weaveChanged || pathChanged) {
                        // force React to create a new component
                        this.key++;
                        // replace the generated component with a placeholder before it gets unmounted and disposed due to the key changing
                        LinkablePlaceholder.replaceInstanceWithPlaceholder(this.generatedComponent);
                    }
                    this.watcher.root = props.weave && props.weave.root;
                    this.watcher.targetPath = props.path;
                    this.handleWatcher(props);
                }
            }, {
                key: "requestObject",
                value: function requestObject(weave, path, type) {
                    var _this49 = this;

                    var oldObject = weave.getObject(path);
                    weave.requestObject(path, type);
                    var newObject = weave.getObject(path);
                    var lp = Weave.AS(newObject, LinkablePlaceholder);
                    if (oldObject != newObject && lp) {
                        Weave.getCallbacks(lp).addDisposeCallback(this, function () {
                            if (_this49.props.onCreate && lp.getInstance() == _this49.generatedComponent) _this49.props.onCreate(_this49.generatedComponent);
                        });
                    }
                }
            }, {
                key: "handleWatcher",
                value: function handleWatcher() {
                    var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    if (!props) props = this.props;
                    if (props.weave) {
                        if (props.requestType) this.requestObject(props.weave, props.path, props.requestType);else if (props.defaultType && !this.watcher.target) this.requestObject(props.weave, props.path, props.defaultType);
                    }
                    var ComponentClass = LinkablePlaceholder.getClass(this.watcher.target);
                    if (!React.Component.isPrototypeOf(ComponentClass)) ComponentClass = null;
                    // make sure React unmounts disposed component
                    if (Weave.wasDisposed(this.generatedComponent)) this.key++;
                    this.setState({
                        actualType: ComponentClass,
                        target: this.watcher.target
                    });
                }
            }, {
                key: "render",
                value: function render() {
                    var content = null;
                    // if the watcher finds a component that was not generated by us, display an error message
                    if (this.watcher.target instanceof React.Component && this.watcher.target != this.generatedComponent) {
                        content = React.createElement(
                            VBox,
                            { style: { flex: 1, justifyContent: "center", alignItems: "center", padding: 10 } },
                            React.createElement(
                                "span",
                                null,
                                Weave.lang('This component was already mounted elsewhere in the DOM')
                            )
                        );
                    } else if (this.state.actualType) {
                        content = React.createElement(this.state.actualType, _.merge({ key: this.key, ref: this.handleGeneratedComponent }, this.props.props));
                    } else {
                        this.generatedComponent = null;
                    }
                    var props = _.clone(this.props);
                    props.style = _.merge({ flex: 1 }, props.style);
                    delete props.weave;
                    delete props.path;
                    delete props.defaultType;
                    delete props.requestType;
                    delete props.props;
                    return React.createElement(
                        VBox,
                        _extends({}, props, { className: classNames(props.className, "weave") }),
                        content
                    );
                }
            }]);

            return WeaveComponentRenderer;
        }(SmartComponent);

        ui.WeaveComponentRenderer = WeaveComponentRenderer;
        weavejs.WeaveAPI.ClassRegistry.registerClass(WeaveComponentRenderer, 'weavejs.ui.WeaveComponentRenderer');
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var prefixer = weavejs.css.prefixer;
        var SmartComponent = weavejs.ui.SmartComponent;

        var IconButton = function (_SmartComponent2) {
            _inherits(IconButton, _SmartComponent2);

            function IconButton(props) {
                _classCallCheck(this, IconButton);

                var _this50 = _possibleConstructorReturn(this, (IconButton.__proto__ || Object.getPrototypeOf(IconButton)).call(this, props));

                _this50.clickHandler = function (event) {
                    if (_this50.props.clickHandler) _this50.props.clickHandler(event);
                };
                _this50.mouseOverHandler = function () {
                    _this50.setState({
                        mouseOver: true
                    });
                };
                _this50.mouseOutHandler = function () {
                    _this50.setState({
                        mouseOver: false
                    });
                };
                _this50.state = {
                    mouseOver: false
                };
                return _this50;
            }

            _createClass(IconButton, [{
                key: "render",
                value: function render() {
                    var className = "weave-icon-button";
                    var borderStyle = {};
                    if (this.props.style) {
                        if (this.props.style.borderWidth) {
                            borderStyle.borderWidth = this.props.style.borderWidth;
                            borderStyle.borderStyle = this.props.style.borderStyle ? this.props.style.borderStyle : "solid";
                        } else if (this.props.style.border) {
                            borderStyle.border = this.props.style.border;
                        } else {
                            borderStyle.border = "1px solid";
                        }
                        if (this.props.style.borderRightColor || this.props.style.borderTopColor || this.props.style["borderBottomColor"] || this.props.style.borderLeftColor) {
                            borderStyle["borderRightColor"] = this.props.style.borderRightColor;
                            borderStyle["borderTopColor"] = this.props.style.borderTopColor;
                            borderStyle["borderBottomColor"] = this.props.style["borderBottomColor"];
                            borderStyle["borderLeftColor"] = this.props.style.borderLeftColor;
                        } else if (this.props.style.borderColor) {
                            borderStyle.borderColor = this.props.style.borderColor;
                        } else {
                            borderStyle.borderColor = "rgba(0, 0, 0, 0)";
                        }
                    }
                    // important to set border color in rgba mode with alpha to 0
                    // to ensure border is used in layout Calculation (CSS BOX  Model),
                    // but not visible at same time
                    // this will avoid the flickering in the screen when border gets visible
                    var iconStyle = {
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "center",
                        cursor: "pointer"
                    };
                    iconStyle = _.merge(iconStyle, borderStyle);
                    if (this.props.style) {
                        // the order of merge ensures iconStyle overrider props style
                        // empty object required  to copy the props style as they are read-only
                        iconStyle = _.merge({}, this.props.style, iconStyle);
                    }
                    if (this.state.mouseOver) {
                        className = "weave-icon-button-mouse-over";
                        if (this.props.mouseOverStyle) {
                            iconStyle = _.merge({}, iconStyle, this.props.mouseOverStyle);
                        }
                    }
                    var iconUI = null;
                    if (this.props.iconName) {
                        if (this.props.iconName.indexOf("&") == -1 && this.props.iconName.indexOf("fa ") != -1) {
                            iconUI = React.createElement("i", { className: this.props.iconName });
                        } else if (this.props.iconName.indexOf("&") != -1) {
                            iconUI = React.createElement("span", { dangerouslySetInnerHTML: { __html: this.props.iconName } });
                        }
                    }
                    var labelUI = null;
                    if (this.props.children) {
                        labelUI = React.createElement(
                            "span",
                            null,
                            "\xA0",
                            Weave.lang(this.props.children)
                        );
                    }
                    return React.createElement(
                        "span",
                        { className: className, title: Weave.lang(this.props.toolTip), style: prefixer(iconStyle), onClick: this.clickHandler, onMouseOver: this.mouseOverHandler, onMouseOut: this.mouseOutHandler },
                        iconUI,
                        labelUI
                    );
                }
            }]);

            return IconButton;
        }(SmartComponent);

        ui.IconButton = IconButton;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var IconButton = weavejs.ui.IconButton;
        var SmartComponent = weavejs.ui.SmartComponent;

        var SideBar = function (_SmartComponent3) {
            _inherits(SideBar, _SmartComponent3);

            function SideBar(props) {
                _classCallCheck(this, SideBar);

                //todo make it toggle open rather close
                var _this51 = _possibleConstructorReturn(this, (SideBar.__proto__ || Object.getPrototypeOf(SideBar)).call(this, props));

                _this51.onCloseClick = function () {
                    _this51.setState({
                        open: !_this51.state.open
                    });
                    if (_this51.props.onClose) _this51.props.onClose(!_this51.state.open);
                };
                _this51.state = {
                    open: _this51.props.open === undefined ? false : _this51.props.open
                };
                // we ned to bind this once for the component
                _this51.onCloseClick = _this51.onCloseClick.bind(_this51);
                return _this51;
            }

            _createClass(SideBar, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(nextProps) {
                    if (this.props.open != nextProps.open) {
                        this.setState({
                            open: nextProps.open
                        });
                    }
                }
            }, {
                key: "render",
                value: function render() {
                    //if side bar is part of sidebar container through this.props.onClose this section wont get rendered
                    if (!this.state.open) return React.createElement("div", null);
                    var defaultStyle = {
                        background: "#f4f4f4",
                        display: "flex"
                    };
                    var closeButtonStyle = {
                        alignSelf: "flex-end",
                        paddingRight: "8px"
                    };
                    var closeIconStyle = {
                        justifyContent: this.props.location == "right" || this.props.location == "bottom" ? "flex-start" : "flex-end"
                    };
                    if (this.props.location == "left" || this.props.location == "right" || !this.props.location) {
                        defaultStyle.flexDirection = "column";
                        if (this.props.location == "right") {
                            defaultStyle.right = 0;
                            defaultStyle.borderLeft = "1px solid lightGrey";
                            closeButtonStyle.alignSelf = "flex-start";
                        } else {
                            defaultStyle.left = 0;
                            defaultStyle.borderRight = "1px solid lightGrey";
                            closeButtonStyle.alignSelf = "flex-end";
                        }
                    } else if (this.props.location == "top" || this.props.location == "bottom") {
                        defaultStyle.flexDirection = "row-reverse"; // this makes close icon on right
                        if (this.props.location == "top") {
                            defaultStyle.top = 0;
                            defaultStyle["borderBottom"] = "1px solid lightGrey";
                            closeButtonStyle.alignSelf = "flex-end";
                        } else {
                            defaultStyle.bottom = 0;
                            defaultStyle.borderTop = "1px solid lightGrey";
                            closeButtonStyle.alignSelf = "flex-end";
                        }
                    }
                    // this ensures default style overrides user defined style, to make sure layout style in not changed
                    var style = _.merge({ flex: 1 }, this.props.style, defaultStyle);
                    var closeButtonUI = null;
                    if (this.props.enableClose) {
                        closeButtonUI = React.createElement(
                            "div",
                            { style: closeButtonStyle },
                            React.createElement(IconButton, { clickHandler: this.onCloseClick, iconName: "&#x2715", style: { fontSize: "16px" }, mouseOverStyle: { color: "red", background: "none" }, toolTip: "Close" })
                        );
                    }
                    return React.createElement(
                        "div",
                        { className: this.props.className, style: style },
                        closeButtonUI,
                        React.createElement(
                            "div",
                            { style: { display: "flex", flexDirection: "inherit", flex: 1, overflow: "auto" } },
                            this.props.children
                        )
                    );
                }
            }]);

            return SideBar;
        }(SmartComponent);

        ui.SideBar = SideBar;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var ResizingDiv = weavejs.ui.ResizingDiv;
        var SideBar = weavejs.ui.SideBar;
        var HBox = weavejs.ui.flexbox.HBox;
        var VBox = weavejs.ui.flexbox.VBox;
        var HDividedBox = weavejs.ui.HDividedBox;
        var SmartComponent = weavejs.ui.SmartComponent;
        /**
         * Provides a way to make elements using percentage coordinates resize properly within a div that uses flex layout.
         */

        var SideBarContainer = function (_SmartComponent4) {
            _inherits(SideBarContainer, _SmartComponent4);

            function SideBarContainer(props) {
                _classCallCheck(this, SideBarContainer);

                return _possibleConstructorReturn(this, (SideBarContainer.__proto__ || Object.getPrototypeOf(SideBarContainer)).call(this, props));
            }

            _createClass(SideBarContainer, [{
                key: "render",
                value: function render() {
                    var _this53 = this;

                    var barSize = this.props.barSize;
                    var scaleValue = 1;
                    var transformOriginValue = "";
                    var topOrBottomBarWidth = 1;
                    if (this.props.leftChildren) {
                        if (this.props.mode == "scale") {
                            scaleValue = scaleValue - barSize;
                            transformOriginValue = "right";
                        }
                        topOrBottomBarWidth = 1 - barSize;
                    }
                    if (this.props.rightChildren) {
                        if (this.props.mode == "scale") {
                            scaleValue = scaleValue - barSize;
                            transformOriginValue = this.props.leftChildren ? "center" : "left";
                        }
                        topOrBottomBarWidth = topOrBottomBarWidth - barSize;
                    }
                    if (this.props.mode == "scale") {
                        if (this.props.topChildren) {
                            scaleValue = scaleValue < 1 ? scaleValue : scaleValue - barSize;
                            if (transformOriginValue != "center") {
                                if (transformOriginValue == "") transformOriginValue = "bottom";else transformOriginValue = transformOriginValue + " bottom";
                            }
                        }
                        if (this.props.bottomChildren) {
                            scaleValue = this.props.topChildren ? 1 - 2 * barSize : scaleValue;
                            if (transformOriginValue != "center") {
                                if (transformOriginValue == "") {
                                    transformOriginValue = "top";
                                } else {
                                    if (this.props.topChildren) transformOriginValue = "center";else transformOriginValue = transformOriginValue + " top";
                                }
                            }
                        }
                    }
                    var wrapperStyle = {
                        position: this.props.mode == "scale" ? "absolute" : "relative",
                        display: "flex",
                        flex: 1
                    };
                    if (this.props.mode == "scale" && scaleValue != 1) {
                        wrapperStyle.transform = "scale(" + scaleValue + ")";
                        wrapperStyle.transformOrigin = transformOriginValue;
                    }
                    var leftSideBar = null;
                    var rightSideBar = null;
                    var topSideBar = null;
                    var bottomSideBar = null;
                    var sideBars = [];
                    var locations = [['left', this.props.leftChildren], ['right', this.props.rightChildren], ['top', this.props.topChildren], ['bottom', this.props.bottomChildren]];
                    locations.map(function (_ref5) {
                        var _ref6 = _slicedToArray(_ref5, 2),
                            location = _ref6[0],
                            children = _ref6[1];

                        if (!children) return null;
                        var barStyle = {
                            position: _this53.props.mode == "scale" ? "absolute" : "relative"
                        };
                        var barPercentageSize = barSize * 100 + "%";
                        var sideBarUI = React.createElement(SideBar, { key: location, style: barStyle, open: true, location: location, children: children });
                        if (location == "right" || location == "left") {
                            if (_this53.props.mode == "resize") barStyle.maxWidth = barPercentageSize;else if (_this53.props.mode == "scale") barStyle.width = barPercentageSize;else barStyle.flex = barSize;
                            //barStyle.height = "100%";
                            if (_this53.props.mode != "scale") {
                                if (location == "right") rightSideBar = sideBarUI;else leftSideBar = sideBarUI;
                            } else {
                                sideBars.push(sideBarUI);
                            }
                        } else if (location == "top" || location == "bottom") {
                            barStyle.width = topOrBottomBarWidth * 100 + "%";
                            if (_this53.props.mode == "resize") barStyle.maxHeight = barPercentageSize;else if (_this53.props.mode == "scale") barStyle.height = barPercentageSize;else barStyle.flex = barSize;
                            barStyle.left = _this53.props.leftChildren ? barPercentageSize : "0";
                            if (_this53.props.mode != "scale") {
                                if (location == "top") topSideBar = sideBarUI;else bottomSideBar = sideBarUI;
                            } else {
                                sideBars.push(sideBarUI);
                            }
                        }
                    });
                    var containerUI = null;
                    var containerStyle = {
                        position: "relative",
                        background: "#e0e0e0",
                        display: "flex"
                    };
                    if (this.props.mode == "scale") {
                        // important to set " style={ {width:"100%",height:"100%"} }" ensures calculated size values are passed on
                        // wrapperStyle passed the width height values here
                        containerUI = React.createElement(
                            ResizingDiv,
                            { style: containerStyle },
                            sideBars,
                            React.createElement(
                                "div",
                                { style: wrapperStyle },
                                this.props.children
                            )
                        );
                    } else if (this.props.mode == "resize") {
                        // important to set " style={ {width:"100%",height:"100%"} }" ensures calculated size values are passed on
                        containerUI = React.createElement(
                            ResizingDiv,
                            { style: containerStyle },
                            React.createElement(
                                VBox,
                                { style: { width: "100%", height: "100%" } },
                                topSideBar,
                                React.createElement(
                                    HDividedBox,
                                    { style: { flex: 1 } },
                                    leftSideBar,
                                    React.createElement(
                                        "div",
                                        { style: wrapperStyle },
                                        this.props.children
                                    ),
                                    rightSideBar
                                ),
                                bottomSideBar
                            )
                        );
                    } else {
                        // important to set inner style to make sure flex chain is not broken for automated calculations
                        // setting height percent dont go well with edge browser, so flex values are preferred
                        // flex 1 as ResizingDiv will always have only one child, so flex values grow and shrink both can remain 1
                        containerUI = React.createElement(
                            ResizingDiv,
                            { style: containerStyle, innerStyle: { display: "flex", flex: 1 } },
                            React.createElement(
                                VBox,
                                { style: { width: "100%" } },
                                topSideBar,
                                React.createElement(
                                    HBox,
                                    { style: { flex: "1 0" } },
                                    leftSideBar,
                                    React.createElement(
                                        "div",
                                        { style: wrapperStyle },
                                        this.props.children
                                    ),
                                    rightSideBar
                                ),
                                bottomSideBar
                            )
                        );
                    }
                    return containerUI;
                }
            }]);

            return SideBarContainer;
        }(SmartComponent);

        ui.SideBarContainer = SideBarContainer;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var SmartComponent = weavejs.ui.SmartComponent;
        /**
         * Provides a way to make elements using percentage coordinates resize properly within a div that uses flex layout.
         */

        var FloatingDiv = function (_SmartComponent5) {
            _inherits(FloatingDiv, _SmartComponent5);

            function FloatingDiv(props) {
                _classCallCheck(this, FloatingDiv);

                var _this54 = _possibleConstructorReturn(this, (FloatingDiv.__proto__ || Object.getPrototypeOf(FloatingDiv)).call(this, props));

                weavejs.WeaveAPI.Scheduler.frameCallbacks.addImmediateCallback(_this54, _this54.handleFrame);
                return _this54;
            }

            _createClass(FloatingDiv, [{
                key: "handleFrame",
                value: function handleFrame() {
                    var outer = FloatingDiv.getOffsetSize(this.outerDiv);
                    var inner = FloatingDiv.getOffsetSize(this.innerDiv);
                    var state = { outerWidth: null, outerHeight: null, innerWidth: null, innerHeight: null };
                    if (this.props.useContentWidth) state.outerWidth = inner.width;else state.innerWidth = outer.width;
                    if (this.props.useContentHeight) state.outerHeight = inner.height;else state.innerHeight = outer.height;
                    this.setState(state);
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    weavejs.WeaveAPI.Scheduler.frameCallbacks.removeCallback(this, this.handleFrame);
                }
            }, {
                key: "render",
                value: function render() {
                    var _this55 = this;

                    var outerProps = _.omit(this.props, "useContentHeight", "useContentWidth", "innerStyle");
                    outerProps.style = _.merge({
                        position: 'static',
                        width: this.state.outerWidth,
                        height: this.state.outerHeight
                    }, outerProps.style, { overflow: 'hidden' });
                    var innerStyle = _.merge({
                        position: 'absolute',
                        width: this.state.innerWidth,
                        height: this.state.innerHeight
                    }, this.state, this.props.innerStyle);
                    return React.createElement(
                        "div",
                        _extends({ ref: function ref(e) {
                                return _this55.outerDiv = e;
                            } }, outerProps),
                        React.createElement(
                            "div",
                            { ref: function ref(e) {
                                    return _this55.innerDiv = e;
                                }, style: innerStyle },
                            this.props.children
                        )
                    );
                }
            }], [{
                key: "getOffsetSize",
                value: function getOffsetSize(element) {
                    // get floor of fractional width/height values if possible
                    var rect = element.getBoundingClientRect();
                    var width = element.offsetWidth == element.clientWidth ? Math.floor(rect.width) : element.offsetWidth;
                    var height = element.offsetHeight == element.clientHeight ? Math.floor(rect.height) : element.offsetHeight;
                    return { width: width, height: height };
                }
            }]);

            return FloatingDiv;
        }(SmartComponent);

        ui.FloatingDiv = FloatingDiv;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var VBox = weavejs.ui.flexbox.VBox;

        var EditableTextCell = function (_ui$SmartComponent) {
            _inherits(EditableTextCell, _ui$SmartComponent);

            function EditableTextCell(props) {
                _classCallCheck(this, EditableTextCell);

                var _this56 = _possibleConstructorReturn(this, (EditableTextCell.__proto__ || Object.getPrototypeOf(EditableTextCell)).call(this, props));

                _this56.handleEditableContent = function (event) {
                    var textEntered = event.target.value;
                    _this56.setState({
                        textContent: textEntered
                    });
                };
                _this56.enableEditMode = function () {
                    _this56.setState({
                        editMode: true
                    });
                };
                _this56.disableEditMode = function (event) {
                    //check if the click target is not within the element and the editable mode is on
                    if (!_this56.element.contains(event.target) && _this56.state.editMode) {
                        _this56.setDisabledState();
                    }
                };
                _this56.setDisabledState = function () {
                    _this56.setState({
                        editMode: false
                    });
                    _this56.props.onChange && _this56.props.onChange(_this56.state.textContent); //onChange called once element is no longer in focus
                };
                _this56.handleKeyPress = function (event) {
                    if (event.key == 'Enter') {
                        _this56.setDisabledState();
                    }
                };
                _this56.state = {
                    editMode: false,
                    textContent: props.textContent
                };
                return _this56;
            }

            _createClass(EditableTextCell, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(nextProps) {
                    if (nextProps.textContent != this.props.textContent) {
                        this.setState({
                            textContent: nextProps.textContent
                        });
                    }
                }
            }, {
                key: "componentDidMount",
                value: function componentDidMount() {
                    this.element = ReactDOM.findDOMNode(this); //done so that findDomNode needs to be invoked only once
                    document.addEventListener('mousedown', this.disableEditMode);
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    document.removeEventListener('mousedown', this.disableEditMode);
                }
                //TODO fix styles

            }, {
                key: "render",
                value: function render() {
                    return React.createElement(
                        VBox,
                        { style: this.props.style, onDoubleClick: this.enableEditMode },
                        this.state.editMode ? React.createElement(ui.Input, { value: this.state.textContent, onChange: this.handleEditableContent, onKeyPress: this.handleKeyPress }) : React.createElement(
                            "div",
                            { className: "weave-input-div" },
                            this.state.textContent ? this.state.textContent : this.props.emptyText
                        )
                    );
                }
            }]);

            return EditableTextCell;
        }(ui.SmartComponent);

        EditableTextCell.defaultProps = {
            emptyText: 'Double click to edit and rename'
        };
        ui.EditableTextCell = EditableTextCell;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var Menu = weavejs.ui.menu.Menu;
        //import InteractiveTour = weavejs.dialog.InteractiveTour;
        var SmartComponent = weavejs.ui.SmartComponent;
        var Popup = weavejs.ui.Popup;
        var ReactUtils = weavejs.util.ReactUtils;
        var KeyboardUtils = weavejs.util.KeyboardUtils;

        var Dropdown = function (_SmartComponent6) {
            _inherits(Dropdown, _SmartComponent6);

            function Dropdown(props) {
                _classCallCheck(this, Dropdown);

                var _this57 = _possibleConstructorReturn(this, (Dropdown.__proto__ || Object.getPrototypeOf(Dropdown)).call(this, props));

                _this57.onMouseLeave = function (event) {
                    if (_this57.props.closeOnMouseLeave) _this57.closeMenu();
                    _this57.props.onMouseLeave && _this57.props.onMouseLeave(event);
                };
                _this57.onMouseEnter = function (event) {
                    if (_this57.props.openOnMouseEnter) _this57.openMenu();
                    _this57.props.onMouseEnter && _this57.props.onMouseEnter(event);
                };
                _this57.onMenuMouseUp = function (event) {
                    var menuID = typeof _this57.props.children == "string" ? _this57.props.children + " menu" : "menu";
                    //InteractiveTour.targetComponentOnClick(menuID);
                    // close the menu once an item has been clicked
                    _this57.closeMenu();
                };
                _this57.onClick = function (event) {
                    _this57.toggleMenu();
                    if (_this57.props.onClick) _this57.props.onClick(event);
                };
                _this57.onKeyUp = function (event) {
                    if (event.keyCode == KeyboardUtils.KEYCODES.SPACE || event.keyCode == KeyboardUtils.KEYCODES.ENTER) {
                        _this57.toggleMenu();
                        event.preventDefault();
                    }
                    if (_this57.props.onKeyUp) _this57.props.onKeyUp(event);
                };
                _this57.closeMenu = function () {
                    Popup.close(_this57.menu);
                    _this57.menu = null;
                    var document = ReactUtils.getDocument(_this57);
                    document.removeEventListener("mousedown", _this57.onDocumentMouseDown);
                    document.removeEventListener("keydown", _this57.onDocumentKeyDown);
                    document.removeEventListener("keyup", _this57.onDocumentKeyUp);
                    if (_this57.props.onClose) _this57.props.onClose();
                };
                _this57.onDocumentMouseDown = function (event) {
                    // close the menu when you mousedown anywhere except the
                    // dropdown item and the menu
                    var menuElt = ReactDOM.findDOMNode(_this57.menu);
                    var dropDownElt = ReactDOM.findDOMNode(_this57);
                    var targetElt = event.target;
                    if (menuElt && menuElt.contains(targetElt) || dropDownElt.contains(targetElt)) return;else _this57.closeMenu();
                };
                _this57.onDocumentKeyDown = function (event) {
                    // close the menu if key down on space
                    if (event.keyCode == KeyboardUtils.KEYCODES.ESC) _this57.closeMenu();
                };
                _this57.onDocumentKeyUp = function (event) {
                    // close the menu if key up on space
                    if (event.keyCode == KeyboardUtils.KEYCODES.SPACE || event.keyCode == KeyboardUtils.KEYCODES.ENTER) _this57.closeMenu();
                };
                _this57.openMenu = function () {
                    // var menuStyle:React.CSSProperties= {};
                    // if (this.props.upward)
                    // {
                    // 	var rect = ReactDOM.findDOMNode(this).getBoundingClientRect();
                    // 	var menuStyle = {
                    // 		top: rect.top + rect.height
                    // 	}
                    // }
                    _this57.menu = Popup.open(_this57, React.createElement(Menu, { opener: _this57, ref: _this57.getMenuRef, menu: _this57.props.menuGetter(), onMouseUp: _this57.onMenuMouseUp }));
                    var document = ReactUtils.getDocument(_this57);
                    document.addEventListener("mousedown", _this57.onDocumentMouseDown);
                    document.addEventListener("keydown", _this57.onDocumentKeyDown);
                    document.addEventListener("keyup", _this57.onDocumentKeyUp);
                    if (_this57.props.onOpen) _this57.props.onOpen();
                };
                _this57.toggleMenu = function () {
                    if (_this57.menu) _this57.closeMenu();else _this57.openMenu();
                };
                _this57.getMenuRef = function (ele) {
                    var menuID = typeof _this57.props.children == "string" ? _this57.props.children + " menu" : "menu";
                    //InteractiveTour.callComponentRefCallback(menuID, ele);
                };
                _this57.state = {
                    toggleMenu: _this57.props.open === undefined ? false : _this57.props.open,
                    menuMounted: false
                };
                return _this57;
            }

            _createClass(Dropdown, [{
                key: "render",
                value: function render() {
                    return React.createElement(
                        "button",
                        _extends({}, this.props, { className: classNames("weave-transparent-button", "weave-dropdown", this.props.className), role: "button", onKeyUp: this.onKeyUp, onMouseDown: this.onClick, onMouseEnter: this.onMouseEnter, onMouseLeave: this.onMouseLeave }),
                        this.props.children
                    );
                }
            }]);

            return Dropdown;
        }(SmartComponent);

        Dropdown.defaultProps = {
            open: false,
            openOnMouseEnter: false,
            closeOnMouseLeave: false
        };
        ui.Dropdown = Dropdown;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var menu;
        (function (menu) {
            var Dropdown = weavejs.ui.Dropdown;

            var MenuButton = function (_React$Component30) {
                _inherits(MenuButton, _React$Component30);

                function MenuButton(props) {
                    _classCallCheck(this, MenuButton);

                    return _possibleConstructorReturn(this, (MenuButton.__proto__ || Object.getPrototypeOf(MenuButton)).call(this, props));
                }

                _createClass(MenuButton, [{
                    key: "componentDidMount",
                    value: function componentDidMount() {
                        this.element = ReactDOM.findDOMNode(this);
                    }
                }, {
                    key: "render",
                    value: function render() {
                        var _this59 = this;

                        var props = _.clone(this.props);
                        delete props.menu;
                        delete props.showIcon;
                        var dropdownClass = classNames({
                            "button": true,
                            "icon": !!this.props.showIcon
                        });
                        return React.createElement(
                            Dropdown,
                            _extends({ className: dropdownClass, menuGetter: function menuGetter() {
                                    return _this59.props.menu;
                                } }, props),
                            React.createElement(
                                "div",
                                { style: { display: "flex", justifyContent: "center" } },
                                this.props.showIcon ? React.createElement("i", { className: "fa fa-bars fa-fw" }) : '',
                                this.props.showIcon ? ' ' : '',
                                this.props.children
                            )
                        );
                    }
                }]);

                return MenuButton;
            }(React.Component);

            MenuButton.defaultProps = {
                showIcon: true,
                menu: []
            };
            menu.MenuButton = MenuButton;
        })(menu = ui.menu || (ui.menu = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var menu;
        (function (menu) {
            var HBox = weavejs.ui.flexbox.HBox;
            //import InteractiveTour = weavejs.dialog.InteractiveTour;
            var Dropdown = weavejs.ui.Dropdown;
            var ReactUtils = weavejs.util.ReactUtils;
            var KeyboardUtils = weavejs.util.KeyboardUtils;

            var MenuBar = function (_React$Component31) {
                _inherits(MenuBar, _React$Component31);

                function MenuBar(props) {
                    _classCallCheck(this, MenuBar);

                    var _this60 = _possibleConstructorReturn(this, (MenuBar.__proto__ || Object.getPrototypeOf(MenuBar)).call(this, props));

                    _this60.onMouseLeave = function (index) {
                        if (_this60.activeDropdown) {
                            var dropdown = ReactDOM.findDOMNode(_this60.dropdownItems[index]);
                            if (dropdown && dropdown.blur) dropdown.blur();
                        } else {
                            _this60.setState({ activeIndex: -1 });
                        }
                    };
                    _this60.onBlur = function () {
                        // clear the hover style if no dropdown is open
                        if (!_this60.activeDropdown) _this60.setState({ activeIndex: -1 });
                    };
                    _this60.onMouseUp = function (index) {
                        _this60.flickerItem(index);
                    };
                    _this60.onKeyUp = function (index, event) {
                        if (event.keyCode == KeyboardUtils.KEYCODES.SPACE || event.keyCode == KeyboardUtils.KEYCODES.ENTER) _this60.flickerItem(index);
                    };
                    _this60.flickerItem = function (index) {
                        _this60.setState({
                            clickedIndex: index
                        }, function () {
                            // small delay and disable active style
                            setTimeout(function () {
                                _this60.setState({
                                    clickedIndex: -1
                                });
                            }, 100);
                        });
                    };
                    /**
                     * when the dropdown closes by itself
                     * clean up
                     */
                    _this60.onDropdownClose = function () {
                        _this60.activeDropdown = null;
                        _this60.setState({
                            activeIndex: -1
                        });
                    };
                    _this60.handleDocumentClick = function (event) {
                        if (!event.target.contains(ReactDOM.findDOMNode(_this60.activeDropdown))) _this60.setState({
                            activeIndex: -1
                        });
                    };
                    _this60.handleDocumentKeyDown = function (event) {
                        var nextIndex = -1;
                        if (_this60.state.activeIndex >= 0 && _this60.state.activeIndex < _this60.dropdownItems.length) {
                            if (event.keyCode == KeyboardUtils.KEYCODES.LEFT_ARROW) {
                                nextIndex = _this60.state.activeIndex - 1;
                            } else if (event.keyCode == KeyboardUtils.KEYCODES.RIGHT_ARROW) {
                                nextIndex = _this60.state.activeIndex + 1;
                            }
                            var nextItem = _this60.dropdownItems[nextIndex];
                            var nextElt = null;
                            if (nextItem) nextElt = ReactDOM.findDOMNode(nextItem);
                            if (nextElt) nextElt.focus();
                        }
                        if (event.keyCode == KeyboardUtils.KEYCODES.ESC) {
                            if (_this60.activeDropdown) {
                                var dropdown = ReactDOM.findDOMNode(_this60.activeDropdown);
                                if (dropdown && dropdown.blur) dropdown.blur();
                            }
                            _this60.setState({ activeIndex: -1 });
                        }
                    };
                    _this60.dropdownItems = [];
                    _this60.state = {
                        activeIndex: -1,
                        clickedIndex: -1
                    };
                    return _this60;
                }

                _createClass(MenuBar, [{
                    key: "onMouseEnter",
                    value: function onMouseEnter(index) {
                        if (this.activeDropdown) {
                            var dropdown = ReactDOM.findDOMNode(this.dropdownItems[index]);
                            if (dropdown && dropdown.focus) dropdown.focus();
                        } else {
                            this.setState({ activeIndex: index });
                        }
                    }
                }, {
                    key: "onFocus",
                    value: function onFocus(index) {
                        // allow toggling between dropdowns once the menubar has been clicked on
                        if (this.activeDropdown) this.openNextDropdown(index);else {
                            this.setState({ activeIndex: index });
                        }
                    }
                }, {
                    key: "openNextDropdown",
                    value: function openNextDropdown(index) {
                        var newDropdown = this.dropdownItems[index];
                        this.openDropdown(newDropdown);
                        this.setState({ activeIndex: index });
                    }
                }, {
                    key: "openDropdown",
                    value: function openDropdown(newDropdown) {
                        if (this.activeDropdown) this.activeDropdown.closeMenu();
                        if (this.activeDropdown != newDropdown) {
                            this.activeDropdown = newDropdown;
                            this.activeDropdown.openMenu();
                        }
                    }
                }, {
                    key: "onDropdownOpen",
                    value: function onDropdownOpen(index) {
                        this.setState({
                            activeIndex: index
                        });
                        this.activeDropdown = this.dropdownItems[index];
                    }
                }, {
                    key: "componentDidMount",
                    value: function componentDidMount() {
                        ReactUtils.getDocument(this).addEventListener("keydown", this.handleDocumentKeyDown);
                        ReactUtils.getDocument(this).addEventListener("click", this.handleDocumentClick);
                    }
                }, {
                    key: "componentWillUnmount",
                    value: function componentWillUnmount() {
                        ReactUtils.getDocument(this).removeEventListener("keydown", this.handleDocumentKeyDown);
                        ReactUtils.getDocument(this).removeEventListener("click", this.handleDocumentClick);
                    }
                }, {
                    key: "renderMenuBarItem",
                    value: function renderMenuBarItem(index, props) {
                        var _this61 = this;

                        var menuBarClass = classNames({
                            "weave-menubar-item": true,
                            "weave-menubar-item-hovered": this.state.activeIndex == index,
                            "weave-menubar-item-clicked": this.state.clickedIndex == index,
                            "weave-menubar-item-bold": !!props.bold
                        });
                        return React.createElement(
                            Dropdown,
                            { className: menuBarClass, menuGetter: function menuGetter() {
                                    return _this61.props.config[index].menu;
                                }, key: index, ref: function ref(c) {
                                    _this61.dropdownItems[index] = c;
                                    //InteractiveTour.callComponentRefCallback(props.label, c);
                                }, onMouseEnter: function onMouseEnter() {
                                    return _this61.onMouseEnter(index);
                                }, onFocus: function onFocus() {
                                    return _this61.onFocus(index);
                                }, onBlur: this.onBlur, onMouseLeave: function onMouseLeave() {
                                    return _this61.onMouseLeave(index);
                                }, onOpen: function onOpen() {
                                    _this61.onDropdownOpen(index);
                                    //InteractiveTour.targetComponentOnClick(props.label)
                                }, onClose: this.onDropdownClose, onMouseUp: function onMouseUp() {
                                    return _this61.onMouseUp(index);
                                }, onKeyUp: function onKeyUp(event) {
                                    return _this61.onKeyUp(index, event);
                                } },
                            props.label
                        );
                    }
                }, {
                    key: "render",
                    value: function render() {
                        var _this62 = this;

                        var style = _.merge({ alignItems: 'center' }, this.props.style);
                        return React.createElement(
                            HBox,
                            _extends({ overflow: true, className: "weave-menubar" }, this.props, { style: style }),
                            this.props.config.map(function (menuBarItemProps, index) {
                                return _this62.renderMenuBarItem(index, menuBarItemProps);
                            }),
                            this.props.children
                        );
                    }
                }]);

                return MenuBar;
            }(React.Component);

            menu.MenuBar = MenuBar;
        })(menu = ui.menu || (ui.menu = {}));
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var ReactUtils = weavejs.util.ReactUtils;
        var SmartComponent = weavejs.ui.SmartComponent;
        //todo:
        // support for key board events
        // header for multiple ComboBox
        // scroll to selected option when opened

        var ComboBox = function (_React$Component32) {
            _inherits(ComboBox, _React$Component32);

            function ComboBox(props) {
                _classCallCheck(this, ComboBox);

                //props.options turns into structured ComboBoxOption object
                //props.value.value turns into state.value object
                var _this63 = _possibleConstructorReturn(this, (ComboBox.__proto__ || Object.getPrototypeOf(ComboBox)).call(this, props));

                _this63.getStateFromProps = function (props) {
                    var options = props.options.map(function (option) {
                        if ((typeof option === "undefined" ? "undefined" : _typeof(option)) === "object" && option) {
                            return option;
                        } else {
                            return {
                                label: option,
                                value: option
                            };
                        }
                    });
                    var value = props.value;
                    // if value is sent as ComboBoxOption Signature, extract the original value from them
                    if (value && value.hasOwnProperty("label") && value.hasOwnProperty("value")) {
                        // so get the original value from Value Object
                        value = props.value.value;
                        // make options have unique value
                        options = _.uniq(_.union(options, [props.value]), "value");
                    } else if (Array.isArray(value) && value[0] && value[0].hasOwnProperty("label") && value[0].hasOwnProperty("value")) {
                        // so get the original values from each Value Object
                        value = props.value.map(function (val) {
                            return val.value;
                        });
                        // make options have unique value
                        options = _.uniq(_.union(props.value, options), "value");
                    }
                    if (props.noneOption) {
                        options.push({
                            label: props.noneOption.label,
                            value: props.noneOption.value !== undefined ? props.noneOption.value : null
                        });
                    }
                    return {
                        value: value,
                        options: options
                    };
                };
                // toggles menu open /close
                _this63.onClickListener = function (event) {
                    var openState = !_this63.state.openMenu;
                    _this63.setState({
                        openMenu: openState
                    });
                    // if search enabled, make the focus to input element when opened
                    // so that user knows there is a input element
                    if (openState && _this63.props.searchable) _this63.inputElement && _this63.inputElement.focus();else _this63.resetSearchQuery();
                    _this63.props.onClick && _this63.props.onClick(event);
                };
                _this63.onChange = function (index, option, event) {
                    if (_this63.props.onNew && option.label) {
                        _this63.props.onNew && _this63.props.onNew(option.label);
                    } else {
                        var value = _this63.state.options[index].value;
                        var openState = false;
                        if (_this63.props.type == "multiple") {
                            _this63.props.onAdded && _this63.props.onAdded(value);
                            // arrays are compared to ensured none is not selected
                            if (!_.isEqual(value, _this63.props.noneOption && _this63.props.noneOption.value)) {
                                // push to state value array
                                _this63.state.value.push(value);
                                // put the reference of this.state.value to local value object
                                // to call props.onChange
                                value = _this63.state.value;
                                openState = true;
                                _this63.resetSearchQuery();
                                // if search enabled, make the focus to input element when opened
                                // so that user knows there is a input element
                                if (openState && _this63.props.searchable) _this63.inputElement && _this63.inputElement.focus();
                            } else {
                                openState = false;
                            }
                        }
                        _this63.setState({
                            value: value,
                            openMenu: openState
                        });
                        if (!openState) _this63.resetSearchQuery();
                        _this63.props.onChange && _this63.props.onChange(value);
                    }
                };
                _this63.resetSearchQuery = function () {
                    if (_this63.props.searchable) {
                        // search is done and user selected the option
                        // set search query back to empty
                        _this63.setState({
                            searchQuery: ""
                        });
                        if (_this63.inputElement) {
                            _this63.inputElement.value = "";
                        }
                    }
                };
                _this63.addNewOption = function (event) {
                    var newOption = {
                        label: _this63.state.searchQuery,
                        value: _this63.state.searchQuery
                    };
                    _this63.state.options.unshift(newOption);
                    _this63.setState({
                        options: _this63.state.options,
                        openMenu: false,
                        value: _this63.state.searchQuery,
                        searchQuery: ""
                    });
                    if (_this63.inputElement) {
                        _this63.inputElement.value = "";
                    }
                    _this63.props.onAddNewOption && _this63.props.onAddNewOption(newOption.value);
                };
                _this63.selectedValueRemoveListener = function (index, option, event) {
                    _this63.state.value.splice(index, 1);
                    //menu has to be remained opened when removing a selection
                    _this63.setState({
                        value: _this63.state.value,
                        openMenu: true
                    });
                    _this63.props.onRemoved && _this63.props.onRemoved(option.value);
                    _this63.props.onChange && _this63.props.onChange(_this63.state.value);
                    //required to stop the execution of event listener under this close UI
                    event.stopPropagation();
                };
                _this63.onDocumentMouseDown = function (event) {
                    // close the menu when you mousedown anywhere except the dropdown item
                    var dropDownElt = ReactDOM.findDOMNode(_this63);
                    var targetElt = event.target;
                    if (dropDownElt.contains(targetElt)) {
                        return;
                    } else {
                        _this63.setState({
                            openMenu: false
                        });
                        _this63.resetSearchQuery();
                    }
                };
                _this63.menuRect = null;
                // called when menu is mounted and unmounted
                // todo : make combobox update direction even window is resizing
                _this63.menuRefCallback = function (c) {
                    if (c) {
                        ReactUtils.getDocument(_this63).addEventListener("mousedown", _this63.onDocumentMouseDown);
                        var menuElement = ReactDOM.findDOMNode(c);
                        _this63.menuRect = menuElement.getBoundingClientRect();
                        // todo : make combobox update direction based on it given parent container, default should be window
                        if (_this63.menuRect.top + _this63.menuRect.height > window.innerHeight) {
                            //re-render again
                            _this63.setState({
                                direction: "upward"
                            });
                        }
                    } else {
                        _this63.menuRect = null;
                        ReactUtils.getDocument(_this63).removeEventListener("mousedown", _this63.onDocumentMouseDown);
                    }
                };
                _this63.getMenuPositionStyle = function () {
                    if (_this63.menuRect && _this63.state.direction == "upward") {
                        return {
                            top: -_this63.menuRect.height
                        };
                    }
                    return null;
                };
                _this63.inputElement = null;
                _this63.inputRefCallback = function (c) {
                    _this63.inputElement = c;
                };
                _this63.inputClickListener = function (event) {
                    // this ensures, click on input doesn't listen to listeners attached to its container
                    event.stopPropagation();
                    // if the state is close , make it open
                    if (!_this63.state.openMenu) {
                        _this63.setState({
                            openMenu: true
                        });
                    }
                };
                _this63.renderInput = function () {
                    var isHidden = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                    var inputProps = {
                        type: isHidden ? "hidden" : ""
                    };
                    if (!isHidden) {
                        inputProps.role = 'combobox';
                        inputProps['aria-expanded'] = _this63.state.openMenu ? "true" : "false";
                        inputProps['aria-haspopup'] = _this63.state.openMenu ? "true" : "false";
                        inputProps['aria-labelledby'] = _this63.props['aria-labelledby'];
                        inputProps['aria-label'] = _this63.props['aria-label'];
                        inputProps.autoComplete = "off";
                        inputProps.className = "search";
                        inputProps.onChange = _this63.searchQueryChangeListener;
                        inputProps.ref = _this63.inputRefCallback;
                        inputProps.onClick = _this63.inputClickListener;
                        inputProps.style = {
                            zIndex: 0
                        };
                    }
                    return React.createElement("input", inputProps);
                };
                // todo: What if value is JSON Object
                _this63.isNoneOption = function () {
                    if (!_this63.props.noneOption) {
                        return false;
                    }
                    // !== is used as null == undefined will return true where as null === undefined will return false
                    if (_this63.state.value === _this63.props.noneOption.value) {
                        return true;
                    } else {
                        //checking array length is important as [] === [] will return false
                        if (Array.isArray(_this63.state.value)) {
                            var arrayFlag = _this63.state.value.length > 0 === (Array.isArray(_this63.props.noneOption.value) && _this63.props.noneOption.value.length > 0);
                            return arrayFlag;
                        }
                        return false;
                    }
                };
                _this63.searchQueryChangeListener = function (event) {
                    var query = event.target.value;
                    if (_this63.state.searchQuery !== query) {
                        _this63.setState({
                            searchQuery: query
                        });
                    }
                };
                var stateObj = _this63.getStateFromProps(props);
                stateObj.openMenu = false;
                stateObj.direction = props.direction || "downward";
                stateObj.searchQuery = "";
                _this63.state = stateObj;
                return _this63;
            }

            _createClass(ComboBox, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(nextProps) {
                    // == , === will return false for array for same elements as its reference comparison
                    if (!_.isEqual(this.props.options, nextProps.options) || !_.isEqual(this.props.value, nextProps.value)) {
                        this.setState(this.getStateFromProps(nextProps));
                    }
                    if (this.props.direction != nextProps.direction) {
                        this.setState({
                            direction: nextProps.direction
                        });
                    }
                }
            }, {
                key: "shouldComponentUpdate",
                value: function shouldComponentUpdate(nextProps, nextState) {
                    return !_.isEqual(this.state, nextState) || !_.isEqual(this.props, nextProps);
                }
                // important to get option from value
                // as this.state.value are updated programatically (for ex:LinkReactStateref)

            }, {
                key: "getOptionFromValue",
                value: function getOptionFromValue(value) {
                    // if value is not equal to none Option value find the option
                    if (value !== (this.props.noneOption && this.props.noneOption.value)) {
                        var equalityFunc = this.props.valueEqualityFunc || _.isEqual;
                        var index = this.state.options && this.state.options.findIndex(function (option) {
                            return equalityFunc(option.value, value);
                        });
                        return this.state.options[index];
                    } else {
                        return this.props.noneOption;
                    }
                }
            }, {
                key: "render",
                value: function render() {
                    var _this64 = this;

                    var textUIs = null;
                    var selectedOptions = null;
                    /***** Render Value UI ******/
                    //1. check for none option 
                    //2. check for single option
                    //3. check for multiple option
                    //4. check for placeholder
                    if (this.isNoneOption()) {
                        // render Text UI only When search Query is not in operation
                        // for non multiple type
                        if (this.state.searchQuery.length == 0) {
                            var textStyle = {
                                zIndex: 0 //override semantic Z-order
                            };
                            if (this.props.searchable && this.state.openMenu) {
                                textStyle.color = "grey";
                                textStyle.pointerEvents = "none";
                            }
                            textUIs = React.createElement(
                                "div",
                                { className: "text", style: textStyle },
                                Weave.lang(this.props.noneOption.label)
                            );
                        }
                    } else if (this.props.type == "multiple" && Array.isArray(this.state.value) && this.state.value.length > 0) {
                        selectedOptions = [];
                        textUIs = this.state.value.map(function (value, index) {
                            var option = _this64.getOptionFromValue(value);
                            if (option) selectedOptions[index] = option;
                            //option may not be available instantly for those cases render the value
                            //todo: if its a object, convert to string ?
                            var valueText = option && option.label ? option.label : typeof value == "string" ? value : "";
                            return React.createElement(
                                "a",
                                { key: index, className: "ui label" },
                                Weave.lang(valueText),
                                React.createElement("i", { className: "delete icon", onClick: _this64.selectedValueRemoveListener.bind(_this64, index, option) })
                            );
                        });
                    } else if (this.state.value) {
                        // render Text UI only When search Query is not in operation
                        // for non multiple type
                        if (this.state.searchQuery.length == 0) {
                            var option = this.getOptionFromValue(this.state.value);
                            if (option) selectedOptions = option;
                            //option may not be available instantly for those cases render the value
                            var valueText = option && option.label ? option.label : typeof this.state.value == "string" ? this.state.value : "";
                            var _textStyle = {
                                zIndex: 0 //override semantic Z-order
                            };
                            // if input is clicked, but user yet to type the search query
                            // in that case, color the current selection grey
                            if (this.props.searchable && this.state.openMenu) {
                                _textStyle.color = "grey";
                                _textStyle.pointerEvents = "none";
                            }
                            textUIs = React.createElement(
                                "div",
                                { className: "text", style: _textStyle },
                                Weave.lang(valueText)
                            );
                        }
                    } else if (this.props.placeholder) {
                        textUIs = React.createElement(
                            "div",
                            { className: "default text" },
                            this.props.placeholder
                        );
                    }
                    /***** Render Menu UI ******/
                    var menuUI = null;
                    if (this.state.openMenu) {
                        menuUI = React.createElement(ComboBoxMenu, { ref: this.menuRefCallback, className: "menu transition visible", header: this.props.header, style: this.getMenuPositionStyle(), onSelect: this.onChange, selectedOptions: selectedOptions, searchQuery: this.state.searchQuery, options: this.state.options, allowAdditions: this.props.allowAdditions, additionListener: this.props.allowAdditions ? this.addNewOption : null });
                    }
                    var styleObj = _.merge({}, this.props.style, {
                        position: "relative",
                        transform: "none" /* override Semantic UI rotateZ(0)*/
                    });
                    var className = "ui " + (this.props.type || "") + (this.props.searchable ? " search " : "") + (this.props.fluid ? " fluid" : "") + " selection dropdown " + this.state.direction + (this.state.openMenu ? " active visible" : " ") + +(this.props.className || "");
                    var comboxProps = {
                        onClick: this.onClickListener,
                        className: className,
                        style: styleObj,
                        tabIndex: 0
                    };
                    /***** Render Input UIs ******/
                    //todo: use of hidden input might require, we might need ot create event manually and disaptch change
                    //todo: so we might need to be set value to it
                    var hiddenInputUI = this.renderInput(true);
                    var inputUI = null;
                    if (this.props.searchable) {
                        inputUI = this.renderInput();
                    }
                    return React.createElement(
                        "div",
                        comboxProps,
                        hiddenInputUI,
                        React.createElement("i", { className: "dropdown icon", style: { zIndex: 0 } }),
                        textUIs,
                        inputUI,
                        menuUI
                    );
                }
            }]);

            return ComboBox;
        }(React.Component);

        ComboBox.defaultProps = {
            fluid: true,
            noneOption: null,
            searchable: false
        };
        ui.ComboBox = ComboBox;

        var ComboBoxMenu = function (_SmartComponent7) {
            _inherits(ComboBoxMenu, _SmartComponent7);

            function ComboBoxMenu(props) {
                _classCallCheck(this, ComboBoxMenu);

                var _this65 = _possibleConstructorReturn(this, (ComboBoxMenu.__proto__ || Object.getPrototypeOf(ComboBoxMenu)).call(this, props));

                _this65.clickListener = function (index, option, event) {
                    event.preventDefault();
                    event.stopPropagation();
                    _this65.props.onSelect && _this65.props.onSelect(index, option, event);
                };
                return _this65;
            }

            _createClass(ComboBoxMenu, [{
                key: "render",
                value: function render() {
                    var _this66 = this;

                    var styleObject = _.merge({}, this.props.style, {
                        display: "block",
                        position: "absolute"
                    });
                    var isMultipleMode = Array.isArray(this.props.selectedOptions);
                    var queryLen = this.props.searchQuery.length;
                    var optionsUI = this.props.options.map(function (option, index) {
                        var className = "item";
                        var textUI = null;
                        if (_this66.props.searchQuery && queryLen > 0) {
                            var regExp = new RegExp(_this66.props.searchQuery, 'igm');
                            var pos = option.label.search(regExp);
                            if (pos == -1) return null;
                            var beginText = option.label.substr(0, pos);
                            var endText = option.label.substr(pos + queryLen, option.label.length - 1);
                            textUI = React.createElement(
                                "span",
                                null,
                                beginText,
                                React.createElement(
                                    "b",
                                    null,
                                    _this66.props.searchQuery
                                ),
                                endText
                            );
                        } else {
                            textUI = Weave.lang(option.label);
                        }
                        if (isMultipleMode) {
                            if (_this66.props.selectedOptions.indexOf(option) != -1) {
                                return null;
                            }
                        } else {
                            if (_this66.props.selectedOptions == option && (!_this66.props.allowAdditions || _this66.props.searchQuery.length == 0)) className = className + " active selected";
                        }
                        return React.createElement(
                            "div",
                            { className: className, role: "option", onClick: _this66.clickListener.bind(_this66, index, option), style: _this66.props.optionStyle, key: index, "data-value": index },
                            textUI
                        );
                    });
                    var additionUI = null;
                    if (this.props.allowAdditions && this.props.searchQuery.length > 0) {
                        additionUI = React.createElement(
                            "div",
                            { role: "option", className: "addition item selected", key: this.props.searchQuery, onClick: this.props.additionListener, "data-value": this.props.searchQuery },
                            "Add \xA0",
                            React.createElement(
                                "b",
                                null,
                                this.props.searchQuery
                            )
                        );
                        optionsUI.unshift(additionUI);
                    }
                    var headerUI = null;
                    if (this.props.header) {
                        headerUI = React.createElement(
                            "div",
                            { className: "header" },
                            this.props.header
                        );
                    }
                    return React.createElement(
                        "div",
                        { style: styleObject, tabIndex: -1, className: this.props.className },
                        headerUI,
                        optionsUI
                    );
                }
            }]);

            return ComboBoxMenu;
        }(SmartComponent);
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var SmartComponent = weavejs.ui.SmartComponent;

        var Checkbox = function (_SmartComponent8) {
            _inherits(Checkbox, _SmartComponent8);

            function Checkbox(props) {
                _classCallCheck(this, Checkbox);

                var _this67 = _possibleConstructorReturn(this, (Checkbox.__proto__ || Object.getPrototypeOf(Checkbox)).call(this, props));

                _this67.handleChange = function (event) {
                    _this67.setState({
                        value: !_this67.state.value
                    });
                    _this67.props.onChange && _this67.props.onChange(!_this67.state.value, event);
                };
                _this67.state = {
                    value: props.value
                };
                return _this67;
            }

            _createClass(Checkbox, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(nextProps) {
                    if (nextProps.value !== undefined && nextProps.value !== null) this.setState({
                        value: nextProps.value
                    });
                }
            }, {
                key: "render",
                value: function render() {
                    var props = _.clone(this.props);
                    delete props.children;
                    delete props.className;
                    delete props.style;
                    return React.createElement(
                        "div",
                        { className: "ui " + this.props.type + " checkbox " + (this.state.value ? "checked " : "") + (this.props.disabled ? "disabled " : "") + (this.props.className || ""), style: this.props.style },
                        React.createElement("input", _extends({}, props, { type: this.props.type ? this.props.type : "checkbox", value: String(this.state.value), checked: this.state.value, disabled: this.props.disabled, title: this.props.title, name: this.props.name, onChange: this.handleChange })),
                        this.props.label ? React.createElement(
                            "label",
                            null,
                            this.props.label || " "
                        ) : null
                    );
                }
            }]);

            return Checkbox;
        }(SmartComponent);

        Checkbox.defaultProps = {
            type: "",
            label: ""
        };
        ui.Checkbox = Checkbox;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var SmartComponent = weavejs.ui.SmartComponent;
        var ReactUtils = weavejs.util.ReactUtils;

        var Accordion = function (_SmartComponent9) {
            _inherits(Accordion, _SmartComponent9);

            function Accordion(props) {
                _classCallCheck(this, Accordion);

                var _this68 = _possibleConstructorReturn(this, (Accordion.__proto__ || Object.getPrototypeOf(Accordion)).call(this, props));

                _this68.handleClick = function (childID, event) {
                    _this68.setState({
                        activeChild: childID
                    });
                    _this68.props.onClick && _this68.props.onClick.call(_this68, [childID, event]);
                };
                _this68.state = {
                    activeChild: props.activeChild ? props.activeChild : 0
                };
                return _this68;
            }

            _createClass(Accordion, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(nextProps) {
                    if (nextProps.activeChild !== nextProps.activeChild) this.setState({
                        activeChild: nextProps.activeChild
                    });
                }
            }, {
                key: "render",
                value: function render() {
                    var _this69 = this;

                    var headerStyle = { cursor: this.props.collapsible ? null : "default" };
                    var childrenUI = [];
                    // for each child in props.children - two children are created with title and Content as in Semantic UI 
                    React.Children.forEach(this.props.children, function (child, index) {
                        var activeStatus = !_this69.props.collapsible || _this69.state.activeChild == index ? "active" : "";
                        var accordionTitle = _this69.props.titles[index];
                        childrenUI.push(React.createElement(
                            "div",
                            { className: "title " + activeStatus, key: "title" + index, onClick: _this69.props.collapsible ? _this69.handleClick.bind(_this69, index) : null, style: headerStyle },
                            _this69.props.collapsible ? React.createElement("i", { className: "dropdown icon" }) : null,
                            Weave.lang(accordionTitle)
                        ), React.createElement(
                            "div",
                            { className: "content " + activeStatus, key: "content" + index },
                            child
                        ));
                    });
                    return React.createElement(
                        "div",
                        { className: "ui styled accordion" },
                        childrenUI
                    );
                }
            }], [{
                key: "render",
                value: function render() {
                    for (var _len6 = arguments.length, sections = Array(_len6), _key7 = 0; _key7 < _len6; _key7++) {
                        sections[_key7] = arguments[_key7];
                    }

                    var classes = {
                        td: ["weave-left-cell", "weave-right-cell"]
                    };
                    sections = sections.filter(_.identity);
                    return React.createElement(Accordion, { titles: sections.map(function (_ref7) {
                            var _ref8 = _slicedToArray(_ref7, 2),
                                header = _ref8[0],
                                content = _ref8[1];

                            return header;
                        }), children: sections.map(function (_ref9, index) {
                            var _ref10 = _slicedToArray(_ref9, 2),
                                header = _ref10[0],
                                content = _ref10[1];

                            return Array.isArray(content) ? ReactUtils.generateTable({
                                body: content,
                                props: { key: index },
                                classes: classes
                            }) : content;
                        }) });
                }
            }]);

            return Accordion;
        }(SmartComponent);

        ui.Accordion = Accordion;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var beans;
        (function (beans) {
            var ConnectionInfo = function () {
                function ConnectionInfo() {
                    _classCallCheck(this, ConnectionInfo);

                    /*Bindable*/this.name = "";
                    /*Bindable*/this.pass = "";
                    /*Bindable*/this.folderName = "";
                    /*Bindable*/this.connectString = "";
                    /*Bindable*/this.is_superuser = false;
                }
                /**
                 * This is a list of supported DBMS values.
                 */


                _createClass(ConnectionInfo, null, [{
                    key: "getDefaultPort",

                    /**
                     * This function will get the default port for a DBMS.
                     * @param dbms A supported DBMS.
                     * @return The default port for the dbms.
                     */
                    value: function getDefaultPort(dbms) {
                        switch (dbms) {
                            case ConnectionInfo.MYSQL:
                                return 3306;
                            case ConnectionInfo.POSTGRESQL:
                                return 5432;
                            case ConnectionInfo.SQLSERVER:
                                return 1433;
                            case ConnectionInfo.ORACLE:
                                return 1521;
                            case ConnectionInfo.SQLITE:
                                return 0;
                        }
                        return 0;
                    }
                }, {
                    key: "dbmsList",
                    get: function get() {
                        return [ConnectionInfo.MYSQL, ConnectionInfo.POSTGRESQL, ConnectionInfo.SQLSERVER, ConnectionInfo.ORACLE, ConnectionInfo.SQLITE];
                    }
                }]);

                return ConnectionInfo;
            }();

            ConnectionInfo.MYSQL = 'MySQL';
            ConnectionInfo.POSTGRESQL = 'PostGreSQL';
            ConnectionInfo.SQLSERVER = 'Microsoft SQL Server';
            ConnectionInfo.ORACLE = 'Oracle';
            ConnectionInfo.SQLITE = 'SQLite';
            ConnectionInfo.DIRECTORY_SERVICE_CONNECTION_NAME = 'Directory Service';
            beans.ConnectionInfo = ConnectionInfo;
        })(beans = net.beans || (net.beans = {}));
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var beans;
        (function (beans) {
            var WeaveFileInfo = function WeaveFileInfo() {
                _classCallCheck(this, WeaveFileInfo);
            };

            beans.WeaveFileInfo = WeaveFileInfo;
        })(beans = net.beans || (net.beans = {}));
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var beans;
        (function (beans) {
            var DatabaseConfigInfo = function DatabaseConfigInfo() {
                _classCallCheck(this, DatabaseConfigInfo);

                /*Bindable*/this.connection = "";
                /*Bindable*/this.schema = "weave";
                /*Bindable*/this.idFields = null;
            };

            beans.DatabaseConfigInfo = DatabaseConfigInfo;
        })(beans = net.beans || (net.beans = {}));
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var beans;
        (function (beans) {
            var GeometryStreamMetadata = function GeometryStreamMetadata() {
                _classCallCheck(this, GeometryStreamMetadata);
            };

            beans.GeometryStreamMetadata = GeometryStreamMetadata;
        })(beans = net.beans || (net.beans = {}));
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var beans;
        (function (beans) {
            var TableData = function TableData() {
                _classCallCheck(this, TableData);
            };

            beans.TableData = TableData;
        })(beans = net.beans || (net.beans = {}));
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var beans;
        (function (beans) {
            var AttributeColumnData = function AttributeColumnData() {
                _classCallCheck(this, AttributeColumnData);
            };

            AttributeColumnData.NO_TABLE_ID = -1;
            beans.AttributeColumnData = AttributeColumnData;
        })(beans = net.beans || (net.beans = {}));
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var WeaveAPI = weavejs.WeaveAPI;
        var WeavePromise = weavejs.util.WeavePromise;

        var JsonCache = function () {
            function JsonCache() {
                _classCallCheck(this, JsonCache);

                this.requestHeaders = null;
                this.cache = new Map();
            }

            _createClass(JsonCache, [{
                key: "JsonCache",

                /**
                 * @param requestHeaders Optionally set this to an Object mapping header names to values.
                 */
                value: function JsonCache() {
                    var requestHeaders = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    this.requestHeaders = requestHeaders;
                }
            }, {
                key: "clearCache",
                value: function clearCache() {
                    var _iteratorNormalCompletion11 = true;
                    var _didIteratorError11 = false;
                    var _iteratorError11 = undefined;

                    try {
                        for (var _iterator11 = this.cache[Symbol.iterator](), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {
                            var _step11$value = _slicedToArray(_step11.value, 2),
                                url = _step11$value[0],
                                promise = _step11$value[1];

                            Weave.dispose(promise);
                        }
                    } catch (err) {
                        _didIteratorError11 = true;
                        _iteratorError11 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion11 && _iterator11.return) {
                                _iterator11.return();
                            }
                        } finally {
                            if (_didIteratorError11) {
                                throw _iteratorError11;
                            }
                        }
                    }

                    this.cache.clear();
                    Weave.getCallbacks(this).triggerCallbacks();
                }
                /**
                 * @param url The URL to get JSON data
                 * @return The cached Object.
                 */

            }, {
                key: "getJsonObject",
                value: function getJsonObject(url) {
                    return this.getJsonPromise(url).getResult();
                }
            }, {
                key: "getJsonPromise",
                value: function getJsonPromise(url) {
                    var promise = this.cache.get(url);
                    if (!promise) {
                        var request = new net.URLRequest(url);
                        request.requestHeaders = this.requestHeaders;
                        request.responseType = net.ResponseType.JSON;
                        promise = new WeavePromise(this).setResult(WeaveAPI.URLRequestUtils.request(this, request)).then(function (result) {
                            return result || {};
                        });
                        this.cache.set(url, promise);
                    }
                    return promise;
                }
            }], [{
                key: "buildURL",
                value: function buildURL(base, params) {
                    var paramsStr = '';
                    for (var key in params) {
                        paramsStr += (paramsStr ? '&' : '?') + encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);
                    }return base + paramsStr;
                }
            }]);

            return JsonCache;
        }();

        JsonCache.WEAVE_INFO = Weave.setClassInfo(JsonCache, { id: "weavejs.net.JsonCache" });
        net.JsonCache = JsonCache;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var Protocol = function Protocol() {
            _classCallCheck(this, Protocol);
        };

        Protocol.URL_PARAMS = "url params/jsonrpc 2.0";
        Protocol.COMPRESSED_AMF = "amf3/compressed amf3";
        Protocol.JSONRPC_2_0 = "jsonrpc 2.0";
        Protocol.JSONRPC_2_0_AMF = "jsonrpc 2.0/amf3";
        net.Protocol = Protocol;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            /**
             * This is an interface for an asynchronous service.
             * The invokeAsyncMethod() function invokes an asynchronous method and returns an AsyncToken which you can add IResponder objects to.
             * This is an ILinkableObject so its busy status can be checked and its URL requests will be cancelled when it is disposed.
             */

            var IAsyncService = function (_ILinkableObject) {
                _inherits(IAsyncService, _ILinkableObject);

                function IAsyncService() {
                    _classCallCheck(this, IAsyncService);

                    return _possibleConstructorReturn(this, (IAsyncService.__proto__ || Object.getPrototypeOf(IAsyncService)).apply(this, arguments));
                }

                return IAsyncService;
            }(ILinkableObject);

            net.IAsyncService = IAsyncService;
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var WeaveAPI = weavejs.WeaveAPI;
        var IAsyncService = weavejs.api.net.IAsyncService;
        var JSByteArray = weavejs.util.JSByteArray;
        var WeavePromise = weavejs.util.WeavePromise;
        var Protocol = weavejs.net.Protocol;
        var JS = weavejs.util.JS;
        /**
         * This is an IAsyncService interface for a servlet that takes its parameters from URL variables.
         *
         * @author adufilie
         */
        var Servlet_1 = void 0;
        var Servlet = Servlet_1 = function () {
            /**
             * @param servletURL The URL of the servlet (everything before the question mark in a URL request).
             * @param methodParamName This is the name of the URL parameter that specifies the method to be called on the servlet.
             * @param urlRequestDataFormat This is the format to use when sending parameters to the servlet.
             */
            function Servlet(servletURL, methodVariableName, protocol) {
                _classCallCheck(this, Servlet);

                /**
                 * WeavePromise -> [methodName, params, id]
                 */
                this.map_promise_methodParamsId = new WeakMap();
                this.nextId = 1;
                /**
                 * The name of the property which contains the remote method name.
                 */
                this.METHOD = "method";
                /**
                 * The name of the property which contains method parameters.
                 */
                this.PARAMS = "params";
                this._invokeLater = false;
                if ([Protocol.URL_PARAMS, Protocol.JSONRPC_2_0, Protocol.JSONRPC_2_0_AMF].indexOf(protocol) < 0) throw new Error(Weave.className(Servlet_1) + ': protocol not supported: "' + protocol + '"');
                this._servletURL = servletURL;
                this._protocol = protocol;
                this.METHOD = methodVariableName;
            }
            /**
             * This is the base URL of the servlet.
             * The base url is everything before the question mark in a url request like the following:
             *     http://www.example.com/servlet?param=123
             */


            _createClass(Servlet, [{
                key: "invokeAsyncMethod",

                /**
                 * This function makes a remote procedure call.
                 * @param methodName The name of the method to call.
                 * @param methodParameters The parameters to use when calling the method.
                 * @return A WeavePromise generated for the call.
                 */
                value: function invokeAsyncMethod(methodName) {
                    var methodParameters = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    var promise = new WeavePromise(this);
                    this.map_promise_methodParamsId.set(promise, [methodName, methodParameters, this.nextId++]);
                    if (!this._invokeLater) this.invokeNow(promise);
                    return promise;
                }
                /**
                 * This function may be overrided to give different servlet URLs for different methods.
                 * @param methodName The method.
                 * @return The servlet url for the method.
                 */

            }, {
                key: "getServletURLForMethod",
                value: function getServletURLForMethod(methodName) {
                    return this._servletURL;
                }
                /**
                 * This will make a url request that was previously delayed.
                 * @param promise A WeavePromise generated from a previous call to invokeAsyncMethod().
                 */

            }, {
                key: "invokeNow",
                value: function invokeNow(promise) {
                    //TODO - need a way to cancel previous request
                    // if promise.setResult was called with a urlPromise, dispose the old urlPromise or re-invoke it
                    var method0_params1_id2 = this.map_promise_methodParamsId.get(promise);
                    if (!method0_params1_id2) return;
                    var method = method0_params1_id2[0];
                    var params = method0_params1_id2[1];
                    var id = method0_params1_id2[2];
                    var url = this.getServletURLForMethod(method);
                    var request = new net.URLRequest(url);
                    if (this._protocol == Protocol.URL_PARAMS) {
                        params = _.cloneDeep(params);
                        params[this.METHOD] = method;
                        request.url = Servlet_1.buildUrlWithParams(url, params);
                        request.method = net.RequestMethod.GET;
                    } else if (this._protocol == Protocol.JSONRPC_2_0) {
                        request.method = net.RequestMethod.POST;
                        request.data = JSON.stringify({
                            jsonrpc: "2.0",
                            method: method,
                            params: params,
                            id: id
                        });
                        request.responseType = net.ResponseType.JSON;
                    } else if (this._protocol == Protocol.JSONRPC_2_0_AMF) {
                        request.method = net.RequestMethod.POST;
                        request.data = JSON.stringify({
                            jsonrpc: "2.0/AMF3",
                            method: method,
                            params: params,
                            id: id
                        });
                    }
                    var result = WeaveAPI.URLRequestUtils.request(this, request);
                    if (this._protocol == Protocol.JSONRPC_2_0_AMF) result = result.then(Servlet_1.readAmf3Object);
                    promise.setResult(result);
                }
                /**
                 * This function reads an object that has been AMF3-serialized into a ByteArray and compressed.
                 * @param compressedSerializedObject The ByteArray that contains the compressed AMF3 serialization of an object.
                 * @return The result of calling readObject() on the ByteArray, or null if the RPC returns void.
                 * @throws Error if unable to read the result.
                 */

            }, {
                key: "servletURL",
                get: function get() {
                    return this._servletURL;
                }
            }], [{
                key: "readAmf3Object",
                value: function readAmf3Object(bytes) {
                    // length may be zero for void result
                    var obj = bytes && bytes.length && new JSByteArray(bytes).readObject();
                    // TEMPORARY SOLUTION to detect errors
                    if (obj && obj.faultCode && obj.faultString) throw new Error(obj.faultCode + ": " + obj.faultString);
                    return obj;
                }
            }, {
                key: "buildUrlWithParams",
                value: function buildUrlWithParams(url, params) {
                    var queryString = '';
                    var qi = url.indexOf('?');
                    if (qi >= 0) {
                        queryString = url.substr(qi + 1);
                        url = url.substr(0, qi);
                    }
                    for (var key in params) {
                        if (queryString) queryString += '&';
                        var value = params[key];
                        if (params != null && (typeof params === "undefined" ? "undefined" : _typeof(params)) === 'object') value = JS.isPrimitive(value) ? value : JSON.stringify(value);
                        queryString += encodeURIComponent(key) + '=' + encodeURIComponent(value);
                    }
                    return url + '?' + queryString;
                }
            }]);

            return Servlet;
        }();
        Servlet = Servlet_1 = __decorate([Weave.classInfo({ id: "weavejs.net.Servlet", interfaces: [IAsyncService] })], Servlet);
        net.Servlet = Servlet;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var Servlet = weavejs.net.Servlet;
        var IAsyncService = weavejs.api.net.IAsyncService;
        var AMF3Servlet = function (_Servlet) {
            _inherits(AMF3Servlet, _Servlet);

            /**
             * @param servletURL The URL of the servlet (everything before the question mark in a URL request).
             * @param invokeImmediately Set this to false if you don't want the ProxyAsyncTokens created by invokeAsyncMethod() to be invoked automatically.
             */
            function AMF3Servlet(servletURL) {
                var invokeImmediately = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

                _classCallCheck(this, AMF3Servlet);

                var _this71 = _possibleConstructorReturn(this, (AMF3Servlet.__proto__ || Object.getPrototypeOf(AMF3Servlet)).call(this, servletURL, "method", net.Protocol.JSONRPC_2_0_AMF));
                // params get sent as an AMF3-serialized object


                _this71._invokeLater = !invokeImmediately;
                return _this71;
            }
            /**
             * If <code>invokeImmediately</code> was set to false in the constructor, this will invoke a deferred request.
             */


            _createClass(AMF3Servlet, [{
                key: "invokeDeferred",
                value: function invokeDeferred(promise) {
                    this.invokeNow(promise);
                }
            }]);

            return AMF3Servlet;
        }(Servlet);
        AMF3Servlet = __decorate([Weave.classInfo({ id: "weavejs.net.AMF3Servlet", interfaces: [IAsyncService] })], AMF3Servlet);
        net.AMF3Servlet = AMF3Servlet;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var IDisposableObject = weavejs.api.core.IDisposableObject;
        var ILinkableObjectWithBusyStatus = weavejs.api.core.ILinkableObjectWithBusyStatus;
        var WeaveAPI = weavejs.WeaveAPI;
        /**
         * this class contains functions that handle a queue of remote procedure calls
         *
         * @author adufilie
         */
        var AsyncInvocationQueue_1 = void 0;
        var AsyncInvocationQueue = AsyncInvocationQueue_1 = function () {
            /**
             * @param paused When set to true, no queries will be executed until begin() is called.
             */
            function AsyncInvocationQueue() {
                var paused = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                _classCallCheck(this, AsyncInvocationQueue);

                this._paused = false;
                this.map_queryToService = new WeakMap();
                // Queue to handle concurrent requests to be downloaded.
                this._downloadQueue = new Array();
                this._paused = paused;
            }

            _createClass(AsyncInvocationQueue, [{
                key: "isBusy",
                value: function isBusy() {
                    this.assertQueueValid();
                    return this._downloadQueue.length > 0;
                }
            }, {
                key: "dispose",
                value: function dispose() {
                    this.assertQueueValid();
                    var _iteratorNormalCompletion12 = true;
                    var _didIteratorError12 = false;
                    var _iteratorError12 = undefined;

                    try {
                        for (var _iterator12 = this._downloadQueue[Symbol.iterator](), _step12; !(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done); _iteratorNormalCompletion12 = true) {
                            var query = _step12.value;

                            WeaveAPI.ProgressIndicator.removeTask(query);
                        }
                    } catch (err) {
                        _didIteratorError12 = true;
                        _iteratorError12 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion12 && _iterator12.return) {
                                _iterator12.return();
                            }
                        } finally {
                            if (_didIteratorError12) {
                                throw _iteratorError12;
                            }
                        }
                    }

                    this._downloadQueue.length = 0;
                }
                /**
                 * If the 'paused' constructor parameter was set to true, use this function to start invoking queued queries.
                 */

            }, {
                key: "begin",
                value: function begin() {
                    this.assertQueueValid();
                    if (this._paused) {
                        this._paused = false;
                        var _iteratorNormalCompletion13 = true;
                        var _didIteratorError13 = false;
                        var _iteratorError13 = undefined;

                        try {
                            for (var _iterator13 = this._downloadQueue[Symbol.iterator](), _step13; !(_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done); _iteratorNormalCompletion13 = true) {
                                var query = _step13.value;

                                WeaveAPI.ProgressIndicator.addTask(query);
                            }
                        } catch (err) {
                            _didIteratorError13 = true;
                            _iteratorError13 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion13 && _iterator13.return) {
                                    _iterator13.return();
                                }
                            } finally {
                                if (_didIteratorError13) {
                                    throw _iteratorError13;
                                }
                            }
                        }

                        if (this._downloadQueue.length) this.performQuery(this._downloadQueue[0]);
                    }
                }
                // interface to add a query to the download queue. 

            }, {
                key: "addToQueue",
                value: function addToQueue(query, service) {
                    this.assertQueueValid();
                    //trace("addToQueue",query);
                    // if this query has already been queued, then do not queue it again
                    if (this._downloadQueue.indexOf(query) >= 0) {
                        //JS.error("already queued", query);
                        return;
                    }
                    if (!this._paused) WeaveAPI.ProgressIndicator.addTask(query);
                    this.map_queryToService.set(query, service);
                    if (AsyncInvocationQueue_1.debug) {
                        query.then(function (result) {
                            console.log('Query returned: ', query);
                        }, function (fault) {
                            console.log('Query failed: ', query);
                        });
                    }
                    this._downloadQueue.push(query);
                    if (!this._paused && this._downloadQueue.length == 1) {
                        //trace("downloading immediately", query);
                        this.performQuery(query);
                    } else {}
                }
                // perform a query in the queue

            }, {
                key: "performQuery",
                value: function performQuery(query) {
                    var _this72 = this;

                    this.assertQueueValid();
                    //trace("performQuery (timeout = "+query.webService.requestTimeout+")",query.toString());
                    //
                    query.then(function (result) {
                        _this72.handleQueryResultOrFault(result, query);
                    }, function (fault) {
                        _this72.handleQueryResultOrFault(fault, query);
                    });
                    //URLRequestUtils.reportProgress = false;
                    var service = this.map_queryToService.get(query);
                    if (service) {
                        if (AsyncInvocationQueue_1.debug) console.log('Query sent: ', query);
                        service.invokeDeferred(query);
                    } else if (AsyncInvocationQueue_1.debug) console.log('Query had no associated service: ', query);
                    //URLRequestUtils.reportProgress = true;
                }
                // This function gets called when a query has been downloaded.  It will download the next query if available

            }, {
                key: "handleQueryResultOrFault",
                value: function handleQueryResultOrFault(result, query) {
                    if (Weave.wasDisposed(this)) return;
                    WeaveAPI.ProgressIndicator.removeTask(query);
                    // see if the query is in the queue
                    var index = this._downloadQueue.indexOf(query);
                    // stop if query not found in queue
                    if (index < 0) {
                        console.log("Query not found in queue: ", query);
                        return;
                    }
                    //trace("remove from queue (position "+index+", length: "+_downloadQueue.length+")", query);
                    // remove the query from the queue
                    this._downloadQueue.splice(index, 1);
                    // if the position was 0, start downloading the next query
                    if (index == 0 && this._downloadQueue.length > 0) {
                        //trace("perform next query", _downloadQueue[0] as DelayedAsyncCall);
                        // get the next item in the list
                        this.performQuery(this._downloadQueue[0]);
                    }
                    return;
                }
            }, {
                key: "assertQueueValid",
                value: function assertQueueValid() {
                    if (Weave.wasDisposed(this)) throw new Error("AsyncInvocationQueue was already disposed");
                }
            }]);

            return AsyncInvocationQueue;
        }();
        AsyncInvocationQueue.debug = false;
        AsyncInvocationQueue = AsyncInvocationQueue_1 = __decorate([Weave.classInfo({ id: "weavejs.net.AsyncInvocationQueue", interfaces: [ILinkableObjectWithBusyStatus, IDisposableObject] })], AsyncInvocationQueue);
        net.AsyncInvocationQueue = AsyncInvocationQueue;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an interface for an object which references a URL.
             * It is intended to be used in conjunction with IWeaveTreeNode.
             */
            var IExternalLink = function IExternalLink() {
                _classCallCheck(this, IExternalLink);
            };

            IExternalLink.WEAVE_INFO = Weave.setClassInfo(IExternalLink, {
                id: "weavejs.api.data.IExternalLink"
            });
            data.IExternalLink = IExternalLink;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * Provides an interface for getting KeySet event-related information.
             */
            var IKeySetCallbackInterface = function (_ICallbackCollection) {
                _inherits(IKeySetCallbackInterface, _ICallbackCollection);

                function IKeySetCallbackInterface() {
                    _classCallCheck(this, IKeySetCallbackInterface);

                    return _possibleConstructorReturn(this, (IKeySetCallbackInterface.__proto__ || Object.getPrototypeOf(IKeySetCallbackInterface)).apply(this, arguments));
                }

                return IKeySetCallbackInterface;
            }(ICallbackCollection);
            IKeySetCallbackInterface = __decorate([Weave.classInfo({ id: "weavejs.api.data.IKeySetCallbackInterface" })], IKeySetCallbackInterface);
            data.IKeySetCallbackInterface = IKeySetCallbackInterface;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key) {
            var IKeySetCallbackInterface = weavejs.api.data.IKeySetCallbackInterface;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IDisposableObject = weavejs.api.core.IDisposableObject;
            /**
             * Provides an interface for getting KeySet event-related information.
             */
            var KeySetCallbackInterface = function (_CallbackCollection) {
                _inherits(KeySetCallbackInterface, _CallbackCollection);

                function KeySetCallbackInterface() {
                    _classCallCheck(this, KeySetCallbackInterface);

                    var _this74 = _possibleConstructorReturn(this, (KeySetCallbackInterface.__proto__ || Object.getPrototypeOf(KeySetCallbackInterface)).call(this));
                    // specify the preCallback function in super() so list callback
                    // variables will be set before each change callback.
                    // super(this.setCallbackVariables);


                    _this74._keysAdded = [];
                    _this74._keysRemoved = [];
                    _this74._preCallback = function () {
                        return _this74.setCallbackVariables();
                    };
                    return _this74;
                }

                _createClass(KeySetCallbackInterface, [{
                    key: "setCallbackVariables",
                    value: function setCallbackVariables() {
                        var keysAdded = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                        var keysRemoved = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        this._keysAdded = keysAdded || [];
                        this._keysRemoved = keysRemoved || [];
                    }
                }, {
                    key: "flushKeys",
                    value: function flushKeys() {
                        if (this._keysAdded.length || this._keysRemoved.length) this._runCallbacksImmediately(this._keysAdded, this._keysRemoved);
                        this.setCallbackVariables([], []); // reset the variables to new arrays
                    }
                }, {
                    key: "keysAdded",
                    get: function get() {
                        return this._keysAdded;
                    },
                    set: function set(qkeys) {
                        this._keysAdded = qkeys;
                    }
                }, {
                    key: "keysRemoved",
                    get: function get() {
                        return this._keysRemoved;
                    },
                    set: function set(qkeys) {
                        this._keysRemoved = qkeys;
                    }
                }]);

                return KeySetCallbackInterface;
            }(CallbackCollection);
            KeySetCallbackInterface = __decorate([Weave.classInfo({ id: "weavejs.data.key.KeySetCallbackInterface", interfaces: [IKeySetCallbackInterface, ICallbackCollection, IDisposableObject] })], KeySetCallbackInterface);
            key.KeySetCallbackInterface = KeySetCallbackInterface;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableDynamicObject = weavejs.api.core.ILinkableDynamicObject;
            /**
             * This is a wrapper for a dynamically created object implementing IKeySet.
             *
             * @author adufilie
             */
            var IDynamicKeySet = function (_ILinkableDynamicObje) {
                _inherits(IDynamicKeySet, _ILinkableDynamicObje);

                function IDynamicKeySet() {
                    _classCallCheck(this, IDynamicKeySet);

                    return _possibleConstructorReturn(this, (IDynamicKeySet.__proto__ || Object.getPrototypeOf(IDynamicKeySet)).apply(this, arguments));
                }

                return IDynamicKeySet;
            }(ILinkableDynamicObject);
            IDynamicKeySet = __decorate([Weave.classInfo({ id: "weavejs.api.data.IDynamicKeySet" })], IDynamicKeySet);
            data.IDynamicKeySet = IDynamicKeySet;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var ui;
        (function (ui) {
            /**
             * An Object with a description.
             */
            var IObjectWithDescription = function IObjectWithDescription() {
                _classCallCheck(this, IObjectWithDescription);
            };
            IObjectWithDescription = __decorate([Weave.classInfo({ id: "weavejs.api.ui.IObjectWithDescription" })], IObjectWithDescription);
            ui.IObjectWithDescription = IObjectWithDescription;
        })(ui = api.ui || (api.ui = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        var CallbackUtils = function () {
            function CallbackUtils() {
                _classCallCheck(this, CallbackUtils);
            }

            _createClass(CallbackUtils, null, [{
                key: "generateDelayedCallback",

                /**
                 * This function generates a delayed version of a callback.
                 * @param relevantContext If this is not null, then the callback will be removed when the relevantContext object is disposed via SessionManager.dispose().  This parameter is typically a 'this' pointer.
                 * @param callback The callback function.
                 * @param delay The number of milliseconds to delay before running the callback.
                 * @param passDelayedParameters If this is set to true, the most recent parameters passed to the delayed callback will be passed to the original callback when it is called.  If this is set to false, no parameters will be passed to the original callback.
                 * @return A wrapper around the callback that remembers the parameters and delays calling the original callback.
                 */
                value: function generateDelayedCallback(relevantContext, callback) {
                    var delay = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 500;
                    var passDelayedParameters = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;

                    var _timeout = 0;
                    var _delayedThisArg;
                    var _delayedParams;
                    // this function gets called immediately and delays calling the original callback
                    var delayedCallback = function delayedCallback() {
                        if (_timeout) clearTimeout(_timeout);
                        _timeout = setTimeout(callback_apply, delay);
                        // remember the params passed to this delayedCallback
                        _delayedThisArg = this;

                        for (var _len7 = arguments.length, params = Array(_len7), _key8 = 0; _key8 < _len7; _key8++) {
                            params[_key8] = arguments[_key8];
                        }

                        _delayedParams = params;
                    };
                    // this function gets called when the timer completes
                    var callback_apply = function (_callback_apply) {
                        function callback_apply() {
                            return _callback_apply.apply(this, arguments);
                        }

                        callback_apply.toString = function () {
                            return _callback_apply.toString();
                        };

                        return callback_apply;
                    }(function () {
                        if (Weave.wasDisposed(relevantContext)) {
                            if (_timeout) clearTimeout(_timeout);
                            _timeout = 0;
                            _delayedThisArg = null;
                            _delayedParams = null;
                            relevantContext = null;
                            callback = null;
                            callback_apply = null;
                            delayedCallback = null;
                        } else {
                            // call the original callback with the params passed to delayedCallback
                            callback.apply(_delayedThisArg, passDelayedParameters ? _delayedParams : null);
                        }
                    });
                    return delayedCallback;
                }
            }]);

            return CallbackUtils;
        }();

        util.CallbackUtils = CallbackUtils;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var EntityType = function EntityType() {
                _classCallCheck(this, EntityType);
            };

            EntityType.TABLE = 'table';
            EntityType.COLUMN = 'column';
            EntityType.HIERARCHY = 'hierarchy';
            EntityType.CATEGORY = 'category';
            EntityType.ALL_TYPES = [EntityType.TABLE, EntityType.COLUMN, EntityType.HIERARCHY, EntityType.CATEGORY];
            data.EntityType = EntityType;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var GeometryType = function () {
            function GeometryType() {
                _classCallCheck(this, GeometryType);
            }

            _createClass(GeometryType, null, [{
                key: "fromGeoJsonType",
                value: function fromGeoJsonType(type) {
                    switch (type) {
                        case geom.GeoJSON.T_MULTI_POINT:
                        case geom.GeoJSON.T_POINT:
                            return GeometryType.POINT;
                        case geom.GeoJSON.T_MULTI_LINE_STRING:
                        case geom.GeoJSON.T_LINE_STRING:
                            return GeometryType.LINE;
                        case geom.GeoJSON.T_MULTI_POLYGON:
                        case geom.GeoJSON.T_POLYGON:
                            return GeometryType.POLYGON;
                        default:
                            return null;
                    }
                }
            }, {
                key: "toGeoJsonType",
                value: function toGeoJsonType(type, multi) {
                    if (type == GeometryType.POINT) return multi ? geom.GeoJSON.T_MULTI_POINT : geom.GeoJSON.T_POINT;
                    if (type == GeometryType.LINE) return multi ? geom.GeoJSON.T_MULTI_LINE_STRING : geom.GeoJSON.T_LINE_STRING;
                    if (type == GeometryType.POLYGON) return multi ? geom.GeoJSON.T_MULTI_POLYGON : geom.GeoJSON.T_POLYGON;
                    return null;
                }
            }, {
                key: "fromPostGISType",
                value: function fromPostGISType(postGISType) {
                    /*
                    PostGIS Specific geometry types.
                    */
                    switch (postGISType) {
                        case 1: //POINT
                        case 4:
                            return GeometryType.POINT;
                        case 2: //LINESTRING
                        case 5:
                            return GeometryType.LINE;
                        case 3: //POLYGON
                        case 6:
                            return GeometryType.POLYGON;
                        default:
                            return null;
                    }
                }
            }]);

            return GeometryType;
        }();

        GeometryType.POINT = "Point";
        GeometryType.LINE = "Arc";
        GeometryType.POLYGON = "Polygon";
        geom.GeometryType = GeometryType;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var StandardLib = weavejs.util.StandardLib;
        /**
         * This object defines the data bounds of a visualization, either directly with
         * absolute coordinates or indirectly with center coordinates and area.
         * Screen coordinates are never directly specified in the session state.
         *
         * @author adufilie
         */
        var ZoomBounds = function () {
            function ZoomBounds() {
                _classCallCheck(this, ZoomBounds);

                this._tempBounds = new geom.Bounds2D(); // reusable temporary object
                this._dataBounds = new geom.Bounds2D();
                this._screenBounds = new geom.Bounds2D();
                this._useFixedAspectRatio = false;
            }
            /**
             * The session state has two modes: absolute coordinates and centered area coordinates.
             * @return The current session state.
             */


            _createClass(ZoomBounds, [{
                key: "getSessionState",
                value: function getSessionState() {
                    if (this._useFixedAspectRatio) {
                        return {
                            xCenter: StandardLib.roundSignificant(this._dataBounds.getXCenter()),
                            yCenter: StandardLib.roundSignificant(this._dataBounds.getYCenter()),
                            area: StandardLib.roundSignificant(this._dataBounds.getArea())
                        };
                    } else {
                        return {
                            xMin: this._dataBounds.getXMin(),
                            yMin: this._dataBounds.getYMin(),
                            xMax: this._dataBounds.getXMax(),
                            yMax: this._dataBounds.getYMax()
                        };
                    }
                }
                /**
                 * The session state can be specified in two ways: absolute coordinates and centered area coordinates.
                 * @param The new session state.
                 */

            }, {
                key: "setSessionState",
                value: function setSessionState(state) {
                    var cc = Weave.getCallbacks(this);
                    cc.delayCallbacks();
                    if (state == null) {
                        if (!this._dataBounds.isUndefined()) cc.triggerCallbacks();
                        this._dataBounds.reset();
                    } else {
                        var useFixedAspectRatio = false;
                        if (state.hasOwnProperty("xCenter")) {
                            useFixedAspectRatio = true;
                            if (StandardLib.roundSignificant(this._dataBounds.getXCenter()) != state.xCenter) {
                                this._dataBounds.setXCenter(state.xCenter);
                                cc.triggerCallbacks();
                            }
                        }
                        if (state.hasOwnProperty("yCenter")) {
                            useFixedAspectRatio = true;
                            if (StandardLib.roundSignificant(this._dataBounds.getYCenter()) != state.yCenter) {
                                this._dataBounds.setYCenter(state.yCenter);
                                cc.triggerCallbacks();
                            }
                        }
                        if (state.hasOwnProperty("area")) {
                            useFixedAspectRatio = true;
                            if (StandardLib.roundSignificant(this._dataBounds.getArea()) != state.area) {
                                // We can't change the screen area.  Adjust the dataBounds to match the specified area.
                                /*
                                    Ad = Wd * Hd
                                    Wd/Hd = Ws/Hs
                                    Wd = Hd * Ws/Hs
                                    Ad = Hd^2 * Ws/Hs
                                    Hd^2 = Ad * Hs/Ws
                                    Hd = sqrt(Ad * Hs/Ws)
                                */
                                var Ad = state.area;
                                var HsWsRatio = this._screenBounds.getYCoverage() / this._screenBounds.getXCoverage();
                                if (!isFinite(HsWsRatio)) HsWsRatio = 1;
                                var Hd = Math.sqrt(Ad * HsWsRatio);
                                var Wd = Ad / Hd;
                                this._dataBounds.centeredResize(Wd, Hd);
                                cc.triggerCallbacks();
                            }
                        }
                        if (!useFixedAspectRatio) {
                            var names = ["xMin", "yMin", "xMax", "yMax"];
                            var _iteratorNormalCompletion14 = true;
                            var _didIteratorError14 = false;
                            var _iteratorError14 = undefined;

                            try {
                                for (var _iterator14 = (names || [])[Symbol.iterator](), _step14; !(_iteratorNormalCompletion14 = (_step14 = _iterator14.next()).done); _iteratorNormalCompletion14 = true) {
                                    var name = _step14.value;

                                    if (state.hasOwnProperty(name) && this._dataBounds[name] != state[name]) {
                                        this._dataBounds[name] = state[name];
                                        cc.triggerCallbacks();
                                    }
                                }
                            } catch (err) {
                                _didIteratorError14 = true;
                                _iteratorError14 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion14 && _iterator14.return) {
                                        _iterator14.return();
                                    }
                                } finally {
                                    if (_didIteratorError14) {
                                        throw _iteratorError14;
                                    }
                                }
                            }
                        }
                        this._useFixedAspectRatio = useFixedAspectRatio;
                    }
                    cc.resumeCallbacks();
                }
                /**
                 * This function will copy the internal dataBounds to another IBounds2D.
                 * @param outputScreenBounds The destination.
                 */

            }, {
                key: "getDataBounds",
                value: function getDataBounds(outputDataBounds) {
                    outputDataBounds.copyFrom(this._dataBounds);
                }
                /**
                 * This function will copy the internal screenBounds to another IBounds2D.
                 * @param outputScreenBounds The destination.
                 */

            }, {
                key: "getScreenBounds",
                value: function getScreenBounds(outputScreenBounds) {
                    outputScreenBounds.copyFrom(this._screenBounds);
                }
                /**
                 * This will project a Point from data coordinates to screen coordinates.
                 * @param inputAndOutput The Point object containing output coordinates.  Reprojected coordinates will be stored in this same Point object.
                 */

            }, {
                key: "projectDataToScreen",
                value: function projectDataToScreen(inputAndOutput) {
                    this._dataBounds.projectPointTo(inputAndOutput, this._screenBounds);
                }
                /**
                 * This will project a Point from screen coordinates to data coordinates.
                 * @param inputAndOutput The Point object containing output coordinates.  Reprojected coordinates will be stored in this same Point object.
                 */

            }, {
                key: "projectScreenToData",
                value: function projectScreenToData(inputAndOutput) {
                    this._screenBounds.projectPointTo(inputAndOutput, this._dataBounds);
                }
                /**
                 * This function will set all the information required to define the session state of the ZoomBounds.
                 * @param dataBounds The data range of a visualization.
                 * @param screenBounds The pixel range of a visualization.
                 * @param useFixedAspectRatio Set this to true if you want to maintain an identical x and y data-per-pixel ratio.
                 */

            }, {
                key: "setBounds",
                value: function setBounds(dataBounds, screenBounds, useFixedAspectRatio) {
                    if (this._dataBounds.equals(dataBounds) && this._screenBounds.equals(screenBounds) && this._useFixedAspectRatio == useFixedAspectRatio) return;
                    this._dataBounds.copyFrom(dataBounds);
                    this._screenBounds.copyFrom(screenBounds);
                    this._useFixedAspectRatio = useFixedAspectRatio;
                    this._fixAspectRatio();
                    Weave.getCallbacks(this).triggerCallbacks();
                }
                /**
                 * This function will zoom to the specified dataBounds and fix the aspect ratio if necessary.
                 * @param dataBounds The bounds to zoom to.
                 * @param zoomOutIfNecessary Set this to true if you are using a fixed aspect ratio and you want the resulting fixed bounds to be expanded to include the specified dataBounds.
                 */

            }, {
                key: "setDataBounds",
                value: function setDataBounds(dataBounds) {
                    var zoomOutIfNecessary = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                    if (this._dataBounds.equals(dataBounds)) return;
                    this._dataBounds.copyFrom(dataBounds);
                    this._fixAspectRatio(zoomOutIfNecessary);
                    Weave.getCallbacks(this).triggerCallbacks();
                }
                /**
                 * This function will update the screenBounds and fix the aspect ratio of the dataBounds if necessary.
                 * @param screenBounds The new screenBounds.
                 * @param useFixedAspectRatio Set this to true if you want to maintain an identical x and y data-per-pixel ratio.
                 */

            }, {
                key: "setScreenBounds",
                value: function setScreenBounds(screenBounds, useFixedAspectRatio) {
                    if (this._useFixedAspectRatio == useFixedAspectRatio && this._screenBounds.equals(screenBounds)) return;
                    this._useFixedAspectRatio = useFixedAspectRatio;
                    this._screenBounds.copyFrom(screenBounds);
                    this._fixAspectRatio();
                    Weave.getCallbacks(this).triggerCallbacks();
                }
            }, {
                key: "_fixAspectRatio",
                value: function _fixAspectRatio() {
                    var zoomOutIfNecessary = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                    if (this._useFixedAspectRatio && !this._screenBounds.isEmpty()) {
                        var xInvScale = this._dataBounds.getXCoverage() / this._screenBounds.getXCoverage();
                        var yInvScale = this._dataBounds.getYCoverage() / this._screenBounds.getYCoverage();
                        if (xInvScale != yInvScale) {
                            var scale = zoomOutIfNecessary ? Math.max(xInvScale, yInvScale) : Math.sqrt(xInvScale * yInvScale);
                            this._dataBounds.centeredResize(this._screenBounds.getXCoverage() * scale, this._screenBounds.getYCoverage() * scale);
                        }
                    }
                }
                /**
                 * A scale of N means there is an N:1 correspondance of pixels to data coordinates.
                 */

            }, {
                key: "getXScale",
                value: function getXScale() {
                    return this._screenBounds.getXCoverage() / this._dataBounds.getXCoverage();
                }
                /**
                 * A scale of N means there is an N:1 correspondance of pixels to data coordinates.
                 */

            }, {
                key: "getYScale",
                value: function getYScale() {
                    return this._screenBounds.getYCoverage() / this._dataBounds.getYCoverage();
                }
            }]);

            return ZoomBounds;
        }();
        ZoomBounds = __decorate([Weave.classInfo({ id: "weavejs.geom.ZoomBounds" })], ZoomBounds);
        geom.ZoomBounds = ZoomBounds;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var ArrayUtils = weavejs.util.ArrayUtils;
        var StandardLib = weavejs.util.StandardLib;
        /**
         * This class defines a K-Dimensional Tree.
         *
         * @author adufilie
         */
        var KDTree_1 = void 0;
        var KDTree = KDTree_1 = function () {
            /**
             * Constructs an empty KDTree with the given dimensionality.
             *
             * TODO: add parameter for an Array of key,object pairs and create a balanced tree from those.
             */
            function KDTree(dimensionality) {
                _classCallCheck(this, KDTree);

                /**
                 * This is the root of the tree.
                 */
                this.rootNode = null;
                /**
                 * This Array contains pointers to all nodes in the tree.
                 */
                this.allNodes = [];
                /**
                 * If this is true, the tree will automatically balance itself when queried after nodes are inserted.
                 *
                 * NOTE: Balancing a large tree is very slow, so this will not give any benefit if the tree changes often.
                 */
                this.autoBalance = false; // should stay false except for special cases
                /**
                 * This flag will be true if the tree needs to be balanced before querying.
                 */
                this.needsBalancing = false;
                this.balanceStack = [];
                /**
                 * used internally to keep track of the current traversal operation
                 */
                this.nodeStack = [];
                this.dimensionality = dimensionality;
                if (dimensionality <= 0) throw "KDTree dimensionality must be > 0. (Given: " + dimensionality + ")";
            }
            /**
             * The number of nodes in the tree.
             */


            _createClass(KDTree, [{
                key: "balance",

                /**
                 * Balance the tree so there are an (approximately) equal number of points
                 * on either side of any given node. A balanced tree yields faster query
                 * times compared to an unbalanced tree.
                 *
                 * NOTE: Balancing a large tree is very slow, so this should not be called very often.
                 */
                value: function balance() {
                    //trace("balance "+nodeCount+" nodes");
                    // tree will be balanced after calling this function, so clear needsBalancing flag
                    this.needsBalancing = false;
                    // do nothing if there are no nodes
                    if (this.nodeCount == 0) return;
                    var params;
                    var medianIndex, firstIndex, lastIndex;
                    var medianNode;
                    var nextAxis;
                    // begin by sorting the entire collection of nodes on the first dimension (axis)
                    var stackPos = 0;
                    this.balanceStack[0] = { parent: null, firstIndex: 0, lastIndex: this.allNodes.length - 1, axis: 0 };
                    while (stackPos >= 0) {
                        // pop params off stack
                        params = this.balanceStack[stackPos];
                        this.balanceStack[stackPos] = null;
                        stackPos--;
                        // get values from params
                        firstIndex = params.firstIndex;
                        lastIndex = params.lastIndex;
                        nextAxis = params.axis;
                        // set static variable used by the compareNodes function
                        KDTree_1.compareNodesSortDimension = nextAxis;
                        // get index of median node
                        medianIndex = ArrayUtils.getMedianIndex(this.allNodes, KDTree_1.compareNodes, firstIndex, lastIndex);
                        //if (params.parent == null)
                        //	trace("sort "+nodes.length+" "+DebugUtils.getTime());
                        // get median node and initialize split dimension
                        medianNode = this.allNodes[medianIndex];
                        medianNode.clearChildrenAndSetSplitDimension(params.axis);
                        // add median node to tree according to params
                        if (params.parent == null) this.rootNode = medianNode;else if (params.side == KDTree_1.LEFT_SIDE) Weave.AS(params.parent, geom.KDNode).left = medianNode;else Weave.AS(params.parent, geom.KDNode).right = medianNode;
                        // calculate split dimension for next group of nodes
                        nextAxis = (params.axis + 1) % this.dimensionality;
                        // push params for balancing left side of median
                        if (medianIndex > firstIndex) {
                            this.balanceStack[++stackPos] = {
                                parent: medianNode,
                                side: KDTree_1.LEFT_SIDE,
                                firstIndex: firstIndex,
                                lastIndex: medianIndex - 1,
                                axis: nextAxis
                            };
                        }
                        if (medianIndex < lastIndex) {
                            // push params for balancing right side of median
                            this.balanceStack[++stackPos] = {
                                parent: medianNode,
                                side: KDTree_1.RIGHT_SIDE,
                                firstIndex: medianIndex + 1,
                                lastIndex: lastIndex,
                                axis: nextAxis
                            };
                        }
                    }
                }
                /**
                 * This function inserts a new key,object pair into the KDTree.
                 * Warning: This function could cause the tree to become unbalanced and degrade performance.
                 * @param key The k-dimensional key that corresponds to the object.
                 * @param object The object to insert in the tree.
                 * @return A KDNode object that can be used as a parameter to the remove() function.
                 */

            }, {
                key: "insert",
                value: function insert(key, obj) {
                    if (key.length != this.dimensionality) throw new Error("KDTree.insert key parameter must have same dimensionality as tree");
                    var newNode;
                    if (this.autoBalance) {
                        // add the node to the list of all nodes
                        newNode = KDTree_1.getUnusedNode(key, obj);
                        this.allNodes.push(newNode);
                        // make sure the tree will balance itself before querying
                        this.needsBalancing = true;
                        return newNode;
                    }
                    // base case: if object is null, don't insert it in the tree.
                    if (obj == null) return null;
                    // base case: if the tree is empty, store this key,object pair at the root node
                    if (this.rootNode == null) {
                        this.rootNode = KDTree_1.getUnusedNode(key, obj);
                        this.allNodes.push(this.rootNode);
                        return this.rootNode;
                    }
                    var node = this.rootNode;
                    while (true) {
                        if (key[node.splitDimension] < node.location) {
                            // left side
                            if (node.left == null) {
                                // no node to the left, insert there
                                node.left = KDTree_1.getUnusedNode(key, obj, (node.splitDimension + 1) % this.dimensionality);
                                this.allNodes.push(node.left);
                                return node.left;
                            }
                            // go down the tree
                            node = node.left;
                        } else if (StandardLib.compare(key, node.key) == 0) {
                            // identical key
                            if (node.siblings == null) node.siblings = [];
                            newNode = KDTree_1.getUnusedNode(key, obj, node.splitDimension);
                            node.siblings.push(newNode);
                            return newNode;
                        } else {
                            // right side
                            if (node.right == null) {
                                // no node to the right, insert there
                                node.right = KDTree_1.getUnusedNode(key, obj, (node.splitDimension + 1) % this.dimensionality);
                                this.allNodes.push(node.right);
                                return node.right;
                            }
                            // go down the tree
                            node = node.right;
                        }
                    }
                    // throw "unreachable";
                }
                /**
                 * Remove a single node from the tree.
                 * @param node The node to remove from the tree.
                 */

            }, {
                key: "remove",
                value: function remove(node) {
                    var index = this.allNodes.indexOf(node);
                    // stop if node not in tree
                    if (index < 0) return;
                    // remove node from allNodes Array
                    this.allNodes.splice(index, 1);
                    //temporary solution: set object to null so it won't be returned in future query results
                    node.object = null;
                    //TODO: should restructure the tree by re-inserting descendants of this node.
                }
                /**
                 * Remove all nodes from the tree.
                 */

            }, {
                key: "clear",
                value: function clear() {
                    this.rootNode = null;
                    for (var i = this.allNodes.length; i--;) {
                        KDTree_1.saveUnusedNode(Weave.AS(this.allNodes[i], geom.KDNode));
                    }this.allNodes.length = 0; // clear references to nodes
                }
                /**
                 * @param minKey The minimum key values allowed for results of this query
                 * @param maxKey The maximum key values allowed for results of this query
                 * @param boundaryInclusive Specify whether to include the boundary for the query
                 * @param sortDimension Specify an integer >= 0 for the dimension to sort by
                 * @param sortDirection Specify either ASCENDING or DESCENDING
                 * @return An array of pointers to objects with K-Dimensional keys that fall between minKey and maxKey.
                 */

            }, {
                key: "queryRange",
                value: function queryRange(minKey, maxKey) {
                    var boundaryInclusive = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
                    var sortDimension = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : -1;
                    var sortDirection = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'ascending';

                    var queryResult = new Array();
                    if (minKey.length != this.dimensionality || maxKey.length != this.dimensionality) throw new Error("KDTree.queryRange parameters must have same dimensionality as tree");
                    // if tree needs to be balanced before querying, balance it now
                    if (this.needsBalancing) this.balance();
                    var i;
                    // make sure parameters are valid before continuing
                    var parametersAreValid = true;
                    for (i = 0; i < this.dimensionality; i++) {
                        if (isNaN(minKey[i]) || isNaN(maxKey[i])) parametersAreValid = false;
                    }var map_ignore = new Map();
                    var resultCount = 0;
                    // only continue if root node is not null and rootNode location is defined
                    if (this.rootNode != null && !isNaN(this.rootNode.location) && parametersAreValid) {
                        // declare temp variables
                        var inRange;
                        var node, sibling, key, keyVal, dimension, location;
                        // traverse the tree
                        // begin by putting the root node on the stack
                        var stackPos = 0;
                        this.nodeStack[0] = this.rootNode;
                        // loop until the stack is empty
                        while (stackPos >= 0) {
                            // pop a node off the stack (and clean up pointer)
                            node = this.nodeStack[stackPos];
                            this.nodeStack[stackPos] = null;
                            stackPos--;
                            key = node.key;
                            dimension = node.splitDimension;
                            location = node.location;
                            if (node.object != null && !map_ignore.has(node.object)) {
                                // see if this node falls within query range
                                inRange = true;
                                for (i = 0; i < this.dimensionality; i++) {
                                    keyVal = key[i];
                                    if (boundaryInclusive == true) {
                                        if (keyVal < minKey[i] || keyVal > maxKey[i]) {
                                            inRange = false; // no hit if key out of range
                                            break;
                                        }
                                    } else {
                                        if (keyVal <= minKey[i] || keyVal >= maxKey[i]) {
                                            inRange = false; // no hit if key out of range
                                            break;
                                        }
                                    }
                                }
                                // if this node is in range, append associated object to query results
                                if (inRange) {
                                    // if sort dimension is specified, add node to query result array
                                    if (sortDimension >= 0) {
                                        queryResult[resultCount++] = node;
                                        var _iteratorNormalCompletion15 = true;
                                        var _didIteratorError15 = false;
                                        var _iteratorError15 = undefined;

                                        try {
                                            for (var _iterator15 = (node.siblings || [])[Symbol.iterator](), _step15; !(_iteratorNormalCompletion15 = (_step15 = _iterator15.next()).done); _iteratorNormalCompletion15 = true) {
                                                sibling = _step15.value;

                                                queryResult[resultCount++] = sibling;
                                            }
                                        } catch (err) {
                                            _didIteratorError15 = true;
                                            _iteratorError15 = err;
                                        } finally {
                                            try {
                                                if (!_iteratorNormalCompletion15 && _iterator15.return) {
                                                    _iterator15.return();
                                                }
                                            } finally {
                                                if (_didIteratorError15) {
                                                    throw _iteratorError15;
                                                }
                                            }
                                        }
                                    } else {
                                        queryResult[resultCount++] = node.object;
                                        var _iteratorNormalCompletion16 = true;
                                        var _didIteratorError16 = false;
                                        var _iteratorError16 = undefined;

                                        try {
                                            for (var _iterator16 = (node.siblings || [])[Symbol.iterator](), _step16; !(_iteratorNormalCompletion16 = (_step16 = _iterator16.next()).done); _iteratorNormalCompletion16 = true) {
                                                sibling = _step16.value;

                                                queryResult[resultCount++] = sibling.object;
                                            }
                                        } catch (err) {
                                            _didIteratorError16 = true;
                                            _iteratorError16 = err;
                                        } finally {
                                            try {
                                                if (!_iteratorNormalCompletion16 && _iterator16.return) {
                                                    _iterator16.return();
                                                }
                                            } finally {
                                                if (_didIteratorError16) {
                                                    throw _iteratorError16;
                                                }
                                            }
                                        }
                                    }
                                    // avoid adding the object to the result more than once
                                    map_ignore.set(node.object, true);
                                }
                            }
                            // traverse left as long as there may be results on the left side of the splitting plane
                            if (node.left != null && !(minKey[dimension] > location)) {
                                // push left child node on the stack
                                this.nodeStack[++stackPos] = node.left;
                            }
                            // traverse right as long as there may be results on the right side of the splitting plane
                            if (node.right != null && !(maxKey[dimension] < location)) {
                                // push right child node on the stack
                                this.nodeStack[++stackPos] = node.right;
                            }
                        }
                    }
                    queryResult.length = resultCount;
                    // if sort dimension is specified, sort queryResult and replace nodes with objects
                    // otherwise, queryResult is already an array of objects
                    if (sortDimension >= 0) {
                        KDTree_1.compareNodesSortDimension = sortDimension;
                        KDTree_1.compareNodesDescending = sortDirection == KDTree_1.DESCENDING;
                        StandardLib.sortOn(queryResult, KDTree_1.getNodeSortValue, KDTree_1.compareNodesDescending ? -1 : 1);
                        // replace nodes with objects in queryResult
                        i = resultCount;
                        while (i--) {
                            queryResult[i] = Weave.AS(queryResult[i], geom.KDNode).object;
                        }
                    }
                    return queryResult;
                }
                /**
                 * This function is used to sort the results of queryRange().
                 */

            }, {
                key: "nodeCount",
                get: function get() {
                    return this.allNodes.length;
                }
            }], [{
                key: "getNodeSortValue",
                value: function getNodeSortValue(node) {
                    return node.key[KDTree_1.compareNodesSortDimension];
                }
            }, {
                key: "compareNodes",
                value: function compareNodes(node1, node2) {
                    var result = StandardLib.numericCompare(node1.key[KDTree_1.compareNodesSortDimension], node2.key[KDTree_1.compareNodesSortDimension]);
                    return KDTree_1.compareNodesDescending ? -result : result;
                }
                /**
                 * This function is used to save old nodes for later use.
                 * @param node The node to save for later.
                 */

            }, {
                key: "saveUnusedNode",
                value: function saveUnusedNode(node) {
                    var _iteratorNormalCompletion17 = true;
                    var _didIteratorError17 = false;
                    var _iteratorError17 = undefined;

                    try {
                        for (var _iterator17 = (node.siblings || [])[Symbol.iterator](), _step17; !(_iteratorNormalCompletion17 = (_step17 = _iterator17.next()).done); _iteratorNormalCompletion17 = true) {
                            var sibling = _step17.value;

                            KDTree_1.saveUnusedNode(sibling);
                        } // clear all pointers stored in node
                    } catch (err) {
                        _didIteratorError17 = true;
                        _iteratorError17 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion17 && _iterator17.return) {
                                _iterator17.return();
                            }
                        } finally {
                            if (_didIteratorError17) {
                                throw _iteratorError17;
                            }
                        }
                    }

                    node.object = null;
                    node.left = null;
                    node.right = null;
                    if (node.siblings) node.siblings.length = 0;
                    // save node
                    KDTree_1.unusedNodes.push(node);
                }
                /**
                 * This function uses object pooling to get an instance of KDNode.
                 * @return Either a previously saved unused node, or a new node.
                 */

            }, {
                key: "getUnusedNode",
                value: function getUnusedNode(key, object) {
                    var splitDimension = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

                    var node;
                    // if no more unused nodes left, return new node
                    if (this.unusedNodes.length == 0) node = new geom.KDNode();else node = Weave.AS(this.unusedNodes.pop(), geom.KDNode);
                    // initialize node
                    var i = node.key.length = key.length;
                    while (i--) {
                        node.key[i] = key[i];
                    }node.object = object;
                    node.clearChildrenAndSetSplitDimension(splitDimension);
                    return node;
                }
            }]);

            return KDTree;
        }();
        KDTree.LEFT_SIDE = 0;
        KDTree.RIGHT_SIDE = 1;
        /**
         * Use these values for the sortDirection parameter of queryRange().
         */
        KDTree.ASCENDING = "ascending";
        KDTree.DESCENDING = "descending";
        KDTree.compareNodesSortDimension = 0;
        KDTree.compareNodesDescending = false;
        /**
         * This array contains nodes no longer in use.
         */
        KDTree.unusedNodes = [];
        KDTree = KDTree_1 = __decorate([Weave.classInfo({ id: "weavejs.geom.KDTree" })], KDTree);
        geom.KDTree = KDTree;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            ; /* Added to work around bug in sourcemap generation */
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an interface for a set of filtered keys.
             *
             * @author adufilie
             */
            var IFilteredKeySet = function IFilteredKeySet() {
                _classCallCheck(this, IFilteredKeySet);
            };
            IFilteredKeySet = __decorate([Weave.classInfo({ id: "weavejs.api.data.IFilteredKeySet" })], IFilteredKeySet);
            data.IFilteredKeySet = IFilteredKeySet;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableDynamicObject = weavejs.api.core.ILinkableDynamicObject;
            /**
             * This is a wrapper for a dynamically created object implementing IKeyFilter.
             *
             * @author adufilie
             */
            var IDynamicKeyFilter = function (_ILinkableDynamicObje2) {
                _inherits(IDynamicKeyFilter, _ILinkableDynamicObje2);

                function IDynamicKeyFilter() {
                    _classCallCheck(this, IDynamicKeyFilter);

                    return _possibleConstructorReturn(this, (IDynamicKeyFilter.__proto__ || Object.getPrototypeOf(IDynamicKeyFilter)).apply(this, arguments));
                }

                return IDynamicKeyFilter;
            }(ILinkableDynamicObject);
            IDynamicKeyFilter = __decorate([Weave.classInfo({ id: "weavejs.api.data.IDynamicKeyFilter" })], IDynamicKeyFilter);
            data.IDynamicKeyFilter = IDynamicKeyFilter;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an interface for getting cached numerical statistics on columns.
             *
             * @author adufilie
             */
            var IStatisticsCache = function IStatisticsCache() {
                _classCallCheck(this, IStatisticsCache);
            };
            IStatisticsCache = __decorate([Weave.classInfo({ id: "weavejs.api.data.IStatisticsCache" })], IStatisticsCache);
            data.IStatisticsCache = IStatisticsCache;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom_1) {
        var StandardLib = weavejs.util.StandardLib;

        var GeoJSON = function () {
            function GeoJSON() {
                _classCallCheck(this, GeoJSON);
            }

            _createClass(GeoJSON, null, [{
                key: "isGeoJSONObject",

                //-------------------------------------------------------------------------------------------
                value: function isGeoJSONObject(obj) {
                    return GeoJSON.isFeatureObject(obj) || GeoJSON.isFeatureCollectionObject(obj) || GeoJSON.isGeometryObject(obj);
                }
            }, {
                key: "couldBeGeoJSONObject",
                value: function couldBeGeoJSONObject(obj) {
                    return obj && obj.type && (!obj.crs || GeoJSON.isCRSObject(obj.crs)) && (!obj.bbox || GeoJSON.isBBOXObject(obj.bbox));
                }
            }, {
                key: "isFeatureObject",
                value: function isFeatureObject(obj) {
                    return GeoJSON.couldBeGeoJSONObject(obj) && obj.type == GeoJSON.T_FEATURE && obj.geometry && (obj.geometry === null || GeoJSON.isGeometryObject(obj.geometry)) && obj.properties && _typeof(obj.properties) == 'object';
                }
            }, {
                key: "isFeatureCollectionObject",
                value: function isFeatureCollectionObject(obj) {
                    return GeoJSON.couldBeGeoJSONObject(obj) && obj.type == GeoJSON.T_FEATURE_COLLECTION && obj.features && Weave.IS(obj.features, Array) && obj.features.every(GeoJSON.isFeatureObject);
                }
            }, {
                key: "isGeometryObject",
                value: function isGeometryObject(obj) {
                    if (!GeoJSON.couldBeGeoJSONObject(obj)) return false;
                    var coords = obj.coordinates || null;
                    switch (obj.type) {
                        case GeoJSON.T_POINT:
                            return GeoJSON.isPositionCoords(coords);
                        case GeoJSON.T_MULTI_POINT:
                            return coords && coords.every(GeoJSON.isPositionCoords);
                        case GeoJSON.T_LINE_STRING:
                            return GeoJSON.isLineStringCoords(coords);
                        case GeoJSON.T_MULTI_LINE_STRING:
                            return coords && coords.every(GeoJSON.isLineStringCoords);
                        case GeoJSON.T_POLYGON:
                            return GeoJSON.isPolygonCoords(coords);
                        case GeoJSON.T_MULTI_POLYGON:
                            return coords && coords.every(GeoJSON.isPolygonCoords);
                        case GeoJSON.T_GEOMETRY_COLLECTION:
                            return GeoJSON.isGeometryCollectionObject(obj);
                        default:
                            return false;
                    }
                }
            }, {
                key: "isGeometryCollectionObject",
                value: function isGeometryCollectionObject(obj) {
                    return GeoJSON.couldBeGeoJSONObject(obj) && obj.geometries && Weave.IS(obj, Array) && obj.geometries.every(GeoJSON.isGeometryObject);
                }
            }, {
                key: "isPositionCoords",
                value: function isPositionCoords(coords) {
                    return coords && coords.length >= 2 && StandardLib.getArrayType(coords) == Number;
                }
            }, {
                key: "isLineStringCoords",
                value: function isLineStringCoords(coords) {
                    return coords && coords.length >= 2 && coords.every(GeoJSON.isPositionCoords);
                }
            }, {
                key: "isLinearRingCoords",
                value: function isLinearRingCoords(coords) {
                    return coords && coords.length >= 4 && coords.every(GeoJSON.isPositionCoords) && StandardLib.compare(coords[0], coords[coords.length - 1]) == 0;
                }
            }, {
                key: "isPolygonCoords",
                value: function isPolygonCoords(coords) {
                    return coords && coords.every(GeoJSON.isLinearRingCoords);
                }
            }, {
                key: "isCRSObject",
                value: function isCRSObject(obj) {
                    // null CRS is valid
                    if (obj == null) return true;
                    // check for required properties
                    if (!obj.type || !obj.properties) return false;
                    var props;
                    switch (obj.type) {
                        case GeoJSON.CRS_T_NAME:
                            props = obj.properties;
                            return props && props.name && Weave.IS(props.name, String);
                        case GeoJSON.CRS_T_LINK:
                            props = obj.properties;
                            return props && props.href && Weave.IS(props.href, String) && !props.type || Weave.IS(props.type, String);
                        default:
                            return false;
                    }
                }
            }, {
                key: "isBBOXObject",
                value: function isBBOXObject(obj) {
                    return StandardLib.getArrayType(obj) == Number && obj.length >= 4 && obj.length % 2 == 0;
                }
                //-------------------------------------------------------------------------------------------
                /**
                 * Wraps a GeoJSON object in a GeoJSON FeatureCollection object if it isn't one already.
                 * @param obj A GeoJSON object.
                 * @return A GeoJSON FeatureCollection object.
                 */

            }, {
                key: "asFeatureCollection",
                value: function asFeatureCollection(obj) {
                    // feature collection
                    if (GeoJSON.isFeatureCollectionObject(obj)) return obj;
                    var features = null;
                    // single feature
                    if (GeoJSON.isFeatureObject(obj)) features = [obj];
                    // geometry collection
                    if (GeoJSON.isGeometryCollectionObject(obj)) features = obj.geometries.map(GeoJSON.geometryAsFeature);
                    // single geometry
                    if (GeoJSON.isGeometryObject(obj)) features = [GeoJSON.geometryAsFeature(obj)];
                    var featureCollection = {
                        type: GeoJSON.T_FEATURE_COLLECTION,
                        features: features || []
                    };
                    return featureCollection;
                }
            }, {
                key: "geometryAsFeature",
                value: function geometryAsFeature(obj) {
                    var id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;

                    return {
                        type: "Feature",
                        id: id || "id",
                        geometry: obj,
                        properties: null
                    };
                }
                /**
                 * Combines an Array of GeoJson Geometry objects into a single "Multi" Geometry object.
                 * This assumes all geometry objects are of the same type.
                 * @param geoms An Array of GeoJson Geometry objects sharing a common type.
                 * @return A single GeoJson Geometry object with type MultiPoint/MultiLineString/MultiPolygon
                 */

            }, {
                key: "getMultiGeomObject",
                value: function getMultiGeomObject(geoms) {
                    var first = geoms[0];
                    var type = first ? first.type : GeoJSON.T_MULTI_POINT;
                    var multiType = GeoJSON.typeToMultiType(type);
                    var allCoords = geoms.map(function (geom) {
                        return geom.coordinates;
                    });
                    var multiCoords;
                    if (type == multiType) {
                        multiCoords = [];
                        multiCoords = multiCoords.concat.apply(multiCoords, allCoords);
                    } else {
                        multiCoords = allCoords;
                    }
                    return {
                        type: multiType,
                        coordinates: multiCoords
                    };
                }
            }, {
                key: "typeToMultiType",
                value: function typeToMultiType(type) {
                    if (type == GeoJSON.T_POINT || type == GeoJSON.T_MULTI_POINT) return GeoJSON.T_MULTI_POINT;
                    if (type == GeoJSON.T_LINE_STRING || type == GeoJSON.T_MULTI_LINE_STRING) return GeoJSON.T_MULTI_LINE_STRING;
                    if (type == GeoJSON.T_POLYGON || type == GeoJSON.T_MULTI_POLYGON) return GeoJSON.T_MULTI_POLYGON;
                    return null;
                }
            }, {
                key: "getProjectionFromURN",
                value: function getProjectionFromURN(ogc_crs_urn) {
                    var array = ogc_crs_urn.split(':');
                    if (array.length > 2) return array[array.length - 3] + ':' + array[array.length - 1];
                    return ogc_crs_urn;
                }
            }]);

            return GeoJSON;
        }();

        GeoJSON.CRS_T_NAME = 'name';
        GeoJSON.CRS_T_LINK = 'link';
        // GeoJSON object types
        GeoJSON.T_POINT = 'Point';
        GeoJSON.T_MULTI_POINT = 'MultiPoint';
        GeoJSON.T_LINE_STRING = 'LineString';
        GeoJSON.T_MULTI_LINE_STRING = 'MultiLineString';
        GeoJSON.T_POLYGON = 'Polygon';
        GeoJSON.T_MULTI_POLYGON = 'MultiPolygon';
        GeoJSON.T_GEOMETRY_COLLECTION = 'GeometryCollection';
        GeoJSON.T_FEATURE = 'Feature';
        GeoJSON.T_FEATURE_COLLECTION = 'FeatureCollection';
        geom_1.GeoJSON = GeoJSON;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        /**
         * BLGNode
         * Binary Line Generalization Tree Node
         * This class defines a structure to represent a streamed polygon vertex.
         *
         * Reference: van Oosterom, P. 1990. Reactive data structures
         *  for geographic information systems. PhD thesis, Department
         *  of Computer Science, Leiden University, The Netherlands.
         *
         *
         * @author adufilie
         */
        var BLGNode = function BLGNode(index, importance, x, y) {
            _classCallCheck(this, BLGNode);

            // left child node
            this.left = null;
            // right child node
            this.right = null;
            this.index = index;
            this.importance = importance;
            this.x = x;
            this.y = y;
            this.left = null;
            this.right = null;
        };

        geom.BLGNode = BLGNode;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            /**
             * This is an interface for getting cached numerical statistics on a column.
             *
             * @author adufilie
             */
            var IColumnStatistics = function (_ILinkableObject2) {
                _inherits(IColumnStatistics, _ILinkableObject2);

                function IColumnStatistics() {
                    _classCallCheck(this, IColumnStatistics);

                    return _possibleConstructorReturn(this, (IColumnStatistics.__proto__ || Object.getPrototypeOf(IColumnStatistics)).apply(this, arguments));
                }

                return IColumnStatistics;
            }(ILinkableObject);
            IColumnStatistics = __decorate([Weave.classInfo({ id: "weavejs.api.data.IColumnStatistics" })], IColumnStatistics);
            data.IColumnStatistics = IColumnStatistics;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an interface to a geometry object defined by an array of vertices
             * and a type.
             *
             * @author kmonico
             */
            var ISimpleGeometry = function ISimpleGeometry() {
                _classCallCheck(this, ISimpleGeometry);
            };
            ISimpleGeometry = __decorate([Weave.classInfo({ id: "weavejs.api.data.ISimpleGeometry" })], ISimpleGeometry);
            data.ISimpleGeometry = ISimpleGeometry;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom_2) {
        /**
         * This class acts as a wrapper for a general polygon.
         *
         * @author kmonico
         */
        var SimpleGeometry = function () {
            /**
             * @param type One of the constants defined in GeometryType.
             * @param points An optional Array of Objects to pass to setVertices().
             * @see weave.primitives.GeometryType
             * @see #setVertices()
             */
            function SimpleGeometry() {
                var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "Polygon";
                var points = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                _classCallCheck(this, SimpleGeometry);

                this.bounds = new geom_2.Bounds2D();
                /**
                 * An Array of objects, each having "x" and "y" properties.
                 */
                this._vertices = null;
                this._type = '';
                this._type = type;
                if (points) this.setVertices(points);
            }
            /**
             * Gets the points of the geometry.
             * @return An Array of objects, each having "x" and "y" properties.
             */


            _createClass(SimpleGeometry, [{
                key: "getVertices",
                value: function getVertices() {
                    return this._vertices;
                }
                /**
                 * Initializes the geometry.
                 * @param points An Array of objects, each having "x" and "y" properties.
                 */

            }, {
                key: "setVertices",
                value: function setVertices(points) {
                    this._vertices = points.concat();
                    this.bounds.reset();
                    var _iteratorNormalCompletion18 = true;
                    var _didIteratorError18 = false;
                    var _iteratorError18 = undefined;

                    try {
                        for (var _iterator18 = (this._vertices || [])[Symbol.iterator](), _step18; !(_iteratorNormalCompletion18 = (_step18 = _iterator18.next()).done); _iteratorNormalCompletion18 = true) {
                            var obj = _step18.value;

                            this.bounds.includeCoords(obj.x, obj.y);
                        }
                    } catch (err) {
                        _didIteratorError18 = true;
                        _iteratorError18 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion18 && _iterator18.return) {
                                _iterator18.return();
                            }
                        } finally {
                            if (_didIteratorError18) {
                                throw _iteratorError18;
                            }
                        }
                    }
                }
            }, {
                key: "isPolygon",
                value: function isPolygon() {
                    return this._type == geom_2.GeometryType.POLYGON;
                }
            }, {
                key: "isLine",
                value: function isLine() {
                    return this._type == geom_2.GeometryType.LINE;
                }
            }, {
                key: "isPoint",
                value: function isPoint() {
                    return this._type == geom_2.GeometryType.POINT;
                }
                /**
                 * A static helper function to convert a bounds object into an ISimpleGeometry object.
                 *
                 * @param bounds The bounds to transform.
                 * @return A new ISimpleGeometry object.
                 */

            }], [{
                key: "getNewGeometryFromBounds",
                value: function getNewGeometryFromBounds(bounds) {
                    var xMin = bounds.getXMin();
                    var xMax = bounds.getXMax();
                    var yMin = bounds.getYMin();
                    var yMax = bounds.getYMax();
                    var geom = new SimpleGeometry(geom_2.GeometryType.POLYGON);
                    geom.setVertices([new geom_2.Point(xMin, yMin), new geom_2.Point(xMax, yMin), new geom_2.Point(xMax, yMax), new geom_2.Point(xMin, yMax)]);
                    return geom;
                }
            }]);

            return SimpleGeometry;
        }();

        geom_2.SimpleGeometry = SimpleGeometry;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom_3) {
        var ArrayUtils = weavejs.util.ArrayUtils;
        /**
         * GeneralizedGeometry
         * A generalized geometry is one that lends itself to be displayed at different quality levels.
         * The geometry coordinates may be inserted individually through the "coordinates" property,
         * or they can all be processed at once through the setCoordinates() function.
         * The bounds object is separate from the coordinates, so if coordinates are inserted individually,
         * the bounds object should be updated accordingly if you want it to be accurate.
         *
         * @author adufilie
         */

        var GeneralizedGeometry = function () {
            /**
             * Create an empty geometry.
             * @param geomType The type of the geometry (GeometryType.LINE, GeometryType.POINT, or GeometryType.POLYGON).
             */
            function GeneralizedGeometry() {
                var geomType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "Polygon";

                _classCallCheck(this, GeneralizedGeometry);

                /**
                 * Each of these integers corresponds to a vertexID that separates the current part from the next part.
                 * For example, partMarkers[0] is the vertexID that marks the end of part 0 and the start of part 1.
                 * If there are no part markers, it is assumed that there is only one part.
                 */
                this.partMarkers = [];
                /**
                 * This maps BLGTree from the parts Array to a Boolean.
                 * If there are multiple parts in this geometry, only parts that map to values of true will be included in getSimplifiedGeometry() results.
                 */
                this.map_blgTree_receivedPartMarker = new WeakMap();
                /**
                 * These are the coordinates associated with the geometry.
                 * Each element in this vector is a separate part of the geometry.
                 * Each could be either a new polygon or a hole in a previous polygon.
                 */
                this.parts = [];
                /**
                 * This is a bounding box for the geometry.
                 * It is useful for spatial indexing when not all the points are available yet.
                 */
                this.bounds = new geom_3.Bounds2D();
                // _simplifiedParts: A place to store results from getSimplifiedGeometry()
                this._simplifiedParts = [];
                this.geomType = geomType;
                this.parts[0] = new geom_3.BLGTree();
            }
            /**
             * Derives GeneralizedGeometry objects from a GeoJSON geometry object.
             * @param geoJsonGeom A GeoJSON geometry object.
             * @return An array of GeneralizedGeometry objects
             */


            _createClass(GeneralizedGeometry, [{
                key: "toGeoJson",

                /**
                 * Generates a GeoJson Geometry object.
                 * @param minImportance No points with importance less than this value will be returned.
                 * @param visibleBounds If not null, this bounds will be used to remove unnecessary offscreen points.
                 * @return A GeoJson Geometry object, or null if there are no coordinates.
                 */
                value: function toGeoJson() {
                    var minImportance = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                    var visibleBounds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    var type = geom_3.GeometryType.toGeoJsonType(this.geomType, true); // Multi- geoms can represent non-Multi geoms
                    var coords = [];
                    var parts = this.getSimplifiedGeometry(minImportance, visibleBounds);
                    if (type == geom_3.GeoJSON.T_MULTI_POINT) {
                        var _iteratorNormalCompletion19 = true;
                        var _didIteratorError19 = false;
                        var _iteratorError19 = undefined;

                        try {
                            for (var _iterator19 = (parts || [])[Symbol.iterator](), _step19; !(_iteratorNormalCompletion19 = (_step19 = _iterator19.next()).done); _iteratorNormalCompletion19 = true) {
                                var part = _step19.value;
                                var _iteratorNormalCompletion20 = true;
                                var _didIteratorError20 = false;
                                var _iteratorError20 = undefined;

                                try {
                                    for (var _iterator20 = (part || [])[Symbol.iterator](), _step20; !(_iteratorNormalCompletion20 = (_step20 = _iterator20.next()).done); _iteratorNormalCompletion20 = true) {
                                        var node = _step20.value;

                                        coords.push([node.x, node.y]);
                                    }
                                } catch (err) {
                                    _didIteratorError20 = true;
                                    _iteratorError20 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion20 && _iterator20.return) {
                                            _iterator20.return();
                                        }
                                    } finally {
                                        if (_didIteratorError20) {
                                            throw _iteratorError20;
                                        }
                                    }
                                }
                            }
                        } catch (err) {
                            _didIteratorError19 = true;
                            _iteratorError19 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion19 && _iterator19.return) {
                                    _iterator19.return();
                                }
                            } finally {
                                if (_didIteratorError19) {
                                    throw _iteratorError19;
                                }
                            }
                        }
                    } else if (type == geom_3.GeoJSON.T_MULTI_LINE_STRING) {
                        var _iteratorNormalCompletion21 = true;
                        var _didIteratorError21 = false;
                        var _iteratorError21 = undefined;

                        try {
                            for (var _iterator21 = (parts || [])[Symbol.iterator](), _step21; !(_iteratorNormalCompletion21 = (_step21 = _iterator21.next()).done); _iteratorNormalCompletion21 = true) {
                                var part = _step21.value;

                                var lineString = [];
                                var _iteratorNormalCompletion22 = true;
                                var _didIteratorError22 = false;
                                var _iteratorError22 = undefined;

                                try {
                                    for (var _iterator22 = (part || [])[Symbol.iterator](), _step22; !(_iteratorNormalCompletion22 = (_step22 = _iterator22.next()).done); _iteratorNormalCompletion22 = true) {
                                        var node = _step22.value;

                                        lineString.push([node.x, node.y]);
                                    }
                                } catch (err) {
                                    _didIteratorError22 = true;
                                    _iteratorError22 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion22 && _iterator22.return) {
                                            _iterator22.return();
                                        }
                                    } finally {
                                        if (_didIteratorError22) {
                                            throw _iteratorError22;
                                        }
                                    }
                                }

                                if (lineString.length) coords.push(lineString);
                            }
                        } catch (err) {
                            _didIteratorError21 = true;
                            _iteratorError21 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion21 && _iterator21.return) {
                                    _iterator21.return();
                                }
                            } finally {
                                if (_didIteratorError21) {
                                    throw _iteratorError21;
                                }
                            }
                        }
                    } else if (type == geom_3.GeoJSON.T_MULTI_POLYGON) {
                        var polygon = [];
                        var _iteratorNormalCompletion23 = true;
                        var _didIteratorError23 = false;
                        var _iteratorError23 = undefined;

                        try {
                            for (var _iterator23 = (parts || [])[Symbol.iterator](), _step23; !(_iteratorNormalCompletion23 = (_step23 = _iterator23.next()).done); _iteratorNormalCompletion23 = true) {
                                var part = _step23.value;

                                var linearRing = [];
                                var _iteratorNormalCompletion24 = true;
                                var _didIteratorError24 = false;
                                var _iteratorError24 = undefined;

                                try {
                                    for (var _iterator24 = (part || [])[Symbol.iterator](), _step24; !(_iteratorNormalCompletion24 = (_step24 = _iterator24.next()).done); _iteratorNormalCompletion24 = true) {
                                        var node = _step24.value;

                                        linearRing.push([node.x, node.y]);
                                    }
                                    // make sure it's a linear ring
                                } catch (err) {
                                    _didIteratorError24 = true;
                                    _iteratorError24 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion24 && _iterator24.return) {
                                            _iterator24.return();
                                        }
                                    } finally {
                                        if (_didIteratorError24) {
                                            throw _iteratorError24;
                                        }
                                    }
                                }

                                var first = linearRing[0];
                                var last = linearRing[linearRing.length - 1];
                                if (first && !(first[0] == last[0] && first[1] == last[1])) linearRing.push(first.concat());
                                if (linearRing.length) polygon.push(linearRing);
                            }
                        } catch (err) {
                            _didIteratorError23 = true;
                            _iteratorError23 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion23 && _iterator23.return) {
                                    _iterator23.return();
                                }
                            } finally {
                                if (_didIteratorError23) {
                                    throw _iteratorError23;
                                }
                            }
                        }

                        if (polygon.length) coords.push(polygon);
                    }
                    if (!coords.length) return null;
                    var geom = {
                        type: type,
                        coordinates: coords
                    };
                    return geom;
                }
                /**
                 * geometry types
                 */

            }, {
                key: "isLine",
                value: function isLine() {
                    return this.geomType == geom_3.GeometryType.LINE;
                }
            }, {
                key: "isPoint",
                value: function isPoint() {
                    return this.geomType == geom_3.GeometryType.POINT;
                }
            }, {
                key: "isPolygon",
                value: function isPolygon() {
                    return this.geomType == geom_3.GeometryType.POLYGON;
                }
                /**
                 * @return true if the geometry has no information on its individual coordinates.
                 */

            }, {
                key: "getSimpleGeometries",

                /**
                 * @param minImportance No points with importance less than this value will be returned.
                 * @param visibleBounds If not null, this bounds will be used to remove unnecessary offscreen points.
                 * @return An Array of ISimpleGeometry objects
                 * @see weave.api.data.ISimpleGeometry
                 */
                value: function getSimpleGeometries() {
                    var minImportance = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                    var visibleBounds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var output = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    var result = output || [];
                    var parts = this.getSimplifiedGeometry(minImportance, visibleBounds);
                    for (var i = 0; i < parts.length; i++) {
                        var part = parts[i];
                        var geom = result[i] || new geom_3.SimpleGeometry(this.geomType); // re-use existing or create new
                        geom.setVertices(ArrayUtils.copy(part, []));
                        result[i] = geom;
                    }
                    return result;
                }
                /**
                 * @param minImportance No points with importance less than this value will be returned.
                 * @param visibleBounds If not null, this bounds will be used to remove unnecessary offscreen points.
                 * @return A vector of results from BLGTree.getPointVector(minImportance, visibleBounds) from each part.
                 */

            }, {
                key: "getSimplifiedGeometry",
                value: function getSimplifiedGeometry() {
                    var minImportance = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                    var visibleBounds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // if bounds is completely contained in visibleBounds, don't pass visibleBounds to getPointVector() (faster this way)
                    if (visibleBounds && visibleBounds.containsBounds(this.bounds)) visibleBounds = null;
                    this._simplifiedParts.length = 0;
                    var part;
                    for (var i = 0; i < this.parts.length; i++) {
                        part = this.parts[i];
                        // skip this part if we're not sure it's actually a single part
                        if (this.parts.length > 1 && !this.map_blgTree_receivedPartMarker.get(part)) continue;
                        var simplifiedPart = part.getPointVector(minImportance, visibleBounds);
                        // skip parts without enough vertices
                        if (simplifiedPart.length == 0) continue;
                        if (simplifiedPart.length == 1 && this.geomType != geom_3.GeometryType.POINT) continue;
                        if (simplifiedPart.length == 2 && this.geomType == geom_3.GeometryType.POLYGON) continue;
                        this._simplifiedParts.push(simplifiedPart);
                    }
                    return this._simplifiedParts;
                }
                /**
                 * Inserts a new point into the appropriate part of the geometry.
                 */

            }, {
                key: "addPoint",
                value: function addPoint(vertexID, importance, x, y) {
                    var partID = ArrayUtils.binarySearch(this.partMarkers, vertexID, false);
                    // special case - if this vertex is exactly at a part marker, it should go to the next part
                    if (partID < this.partMarkers.length && this.partMarkers[partID] == vertexID) partID++;
                    var part = this.parts[partID];
                    part.insert(vertexID, importance, x, y);
                }
                /**
                 * Specifies a range of vertexIDs that correspond to a single part.
                 * @param beginIndex The index of the first vertex of a geometry part.
                 * @param endIndex The index after the last vertex of the geometry part.
                 */

            }, {
                key: "addPartMarker",
                value: function addPartMarker(beginIndex, endIndex) {
                    // split BLG trees appropriately.
                    this.splitAtIndex(beginIndex);
                    this.splitAtIndex(endIndex);
                    // find the corresponding part and mark it as received.
                    var partID = ArrayUtils.binarySearch(this.partMarkers, endIndex, false);
                    var part = this.parts[partID];
                    this.map_blgTree_receivedPartMarker.set(part, true);
                }
                /**
                 * If necessary, this will split a BLGTree for a particular part into two and update the partMarkers.
                 */

            }, {
                key: "splitAtIndex",
                value: function splitAtIndex(vertexID) {
                    if (vertexID <= 0 || vertexID >= Number.MAX_VALUE || ArrayUtils.binarySearch(this.partMarkers, vertexID, true) >= 0) return;
                    // partMarkers[i] marks the end of parts[i]
                    for (var i = this.partMarkers.length; i > 0; i--) {
                        if (vertexID > this.partMarkers[i - 1]) break;
                        this.partMarkers[i] = this.partMarkers[i - 1];
                        this.parts[i + 1] = this.parts[i];
                    }
                    this.partMarkers[i] = vertexID;
                    this.parts[i + 1] = this.parts[i].splitAtIndex(vertexID);
                    // We don't have to worry about receivedPartMarkers here because if we need
                    // to split an existing part it means we haven't received its partMarker yet.
                }
                /**
                 * This function assigns importance values to a list of coordinates and replaces the contents of the BLGTree.
                 * @param xyCoordinates An array of Numbers, even index values being x coordinates and odd index values being y coordinates.
                 *                      To indicate part markers, use a sequence of two NaN values.
                 */

            }, {
                key: "setCoordinates",
                value: function setCoordinates(xyCoordinates) {
                    var method = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "BLGTreeUtils.METHOD_SAMPLE";

                    // reset bounds and parts before processing coordinates
                    this.bounds.reset();
                    this.partMarkers.length = 0;
                    this.parts.length = 1;
                    var coordinates = this.parts[0];
                    coordinates.clear();
                    this.map_blgTree_receivedPartMarker.set(coordinates, true);
                    var firstVertex = null;
                    var newVertex;
                    var x, y;
                    var firstVertexID = 0;
                    var ix = 0; // index of current x coordinate in xyCoordinates
                    // point data doesn't apply to the generalization algorithm
                    if (this.geomType == geom_3.GeometryType.POINT) {
                        for (; ix + 1 < xyCoordinates.length; ix += 2) {
                            x = xyCoordinates[ix];
                            y = xyCoordinates[ix + 1];
                            coordinates.insert(ix / 2, Infinity, x, y);
                            this.bounds.includeCoords(x, y);
                        }
                        return;
                    }
                    // process each part of the geometry (additional parts may be islands or lakes)
                    while (ix + 1 < xyCoordinates.length) {
                        // loop through coordinates
                        var numPoints = 0;
                        for (; ix + 1 < xyCoordinates.length; ix += 2) {
                            x = xyCoordinates[ix];
                            y = xyCoordinates[ix + 1];
                            // check for part marker
                            if (isNaN(x) && isNaN(y)) {
                                if (numPoints > 0) {
                                    ix += 2; // skip part marker
                                    break; // end of part
                                }
                                continue; // haven't seen beginning of part yet
                            }
                            // skip invalid points
                            if (!isFinite(x) || !isFinite(y)) continue;
                            // create chain link for this coordinate
                            newVertex = geom_3.VertexChainLink.getUnusedInstance(firstVertexID + numPoints, x, y);
                            if (numPoints == 0) {
                                firstVertex = newVertex;
                            } else {
                                // don't add consecutive duplicate points
                                if (newVertex.equals2D(firstVertex.prev)) {
                                    geom_3.VertexChainLink.saveUnusedInstance(newVertex);
                                    continue;
                                }
                                // stop adding points when the current coord is equal to the first coord
                                if (newVertex.equals2D(firstVertex)) {
                                    ix += 2; // make sure to skip this coord
                                    geom_3.VertexChainLink.saveUnusedInstance(newVertex);
                                    break; // end of part
                                }
                                firstVertex.insert(newVertex);
                            }
                            // include this vertex in the geometry bounds
                            this.bounds.includeCoords(x, y);
                            numPoints++;
                        }
                        // end of part
                        if (numPoints > 0) {
                            // ARC: end points of a part are required points
                            if (this.geomType == geom_3.GeometryType.LINE && numPoints > 0) {
                                firstVertex.importance = Infinity;
                                firstVertex.prev.importance = Infinity;
                            }
                            if (firstVertexID > 0) {
                                // create new part and add part marker
                                coordinates = new geom_3.BLGTree();
                                this.map_blgTree_receivedPartMarker.set(coordinates, true);
                                this.parts.push(coordinates);
                                this.partMarkers.push(firstVertexID);
                            }
                            // assign importance values to points and save them
                            geom_3.BLGTreeUtils.buildBLGTree(firstVertex, coordinates, method);
                        }
                        // done copying points for this part, advance firstVertexID to after the current part
                        firstVertexID += numPoints;
                    }
                }
            }, {
                key: "isEmpty",
                get: function get() {
                    if (this.partMarkers.length > 0) return false;
                    return this.parts[0].isEmpty;
                }
            }], [{
                key: "fromGeoJson",
                value: function fromGeoJson(geoJsonGeom) {
                    var type = geoJsonGeom.type;
                    var coords = geoJsonGeom.coordinates;
                    // convert coords to MultiPolygon format: multi[ poly[ line[ point[] ] ] ]
                    if (type == geom_3.GeoJSON.T_POINT) type = geom_3.GeometryType.POINT, coords = [[[coords]]];else if (type == geom_3.GeoJSON.T_MULTI_POINT) type = geom_3.GeometryType.POINT, coords = [[coords]];else if (type == geom_3.GeoJSON.T_LINE_STRING) type = geom_3.GeometryType.LINE, coords = [[coords]];else if (type == geom_3.GeoJSON.T_MULTI_LINE_STRING) type = geom_3.GeometryType.LINE, coords = [coords];else if (type == geom_3.GeoJSON.T_POLYGON) type = geom_3.GeometryType.POLYGON, coords = [coords];else if (type == geom_3.GeoJSON.T_MULTI_POLYGON) type = geom_3.GeometryType.POLYGON;
                    var result = [];
                    var _iteratorNormalCompletion25 = true;
                    var _didIteratorError25 = false;
                    var _iteratorError25 = undefined;

                    try {
                        for (var _iterator25 = (coords || [])[Symbol.iterator](), _step25; !(_iteratorNormalCompletion25 = (_step25 = _iterator25.next()).done); _iteratorNormalCompletion25 = true) {
                            var poly = _step25.value;

                            var geom = new GeneralizedGeometry(type);
                            var xyCoords = [];
                            var _iteratorNormalCompletion26 = true;
                            var _didIteratorError26 = false;
                            var _iteratorError26 = undefined;

                            try {
                                for (var _iterator26 = (poly || [])[Symbol.iterator](), _step26; !(_iteratorNormalCompletion26 = (_step26 = _iterator26.next()).done); _iteratorNormalCompletion26 = true) {
                                    var part = _step26.value;

                                    // add part marker if this is not the first part
                                    if (xyCoords.length > 0) xyCoords.push(NaN, NaN);
                                    // push x,y coords
                                    var _iteratorNormalCompletion27 = true;
                                    var _didIteratorError27 = false;
                                    var _iteratorError27 = undefined;

                                    try {
                                        for (var _iterator27 = (part || [])[Symbol.iterator](), _step27; !(_iteratorNormalCompletion27 = (_step27 = _iterator27.next()).done); _iteratorNormalCompletion27 = true) {
                                            var point = _step27.value;

                                            xyCoords.push(point[0], point[1]);
                                        }
                                    } catch (err) {
                                        _didIteratorError27 = true;
                                        _iteratorError27 = err;
                                    } finally {
                                        try {
                                            if (!_iteratorNormalCompletion27 && _iterator27.return) {
                                                _iterator27.return();
                                            }
                                        } finally {
                                            if (_didIteratorError27) {
                                                throw _iteratorError27;
                                            }
                                        }
                                    }
                                }
                            } catch (err) {
                                _didIteratorError26 = true;
                                _iteratorError26 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion26 && _iterator26.return) {
                                        _iterator26.return();
                                    }
                                } finally {
                                    if (_didIteratorError26) {
                                        throw _iteratorError26;
                                    }
                                }
                            }

                            geom.setCoordinates(xyCoords, geom_3.BLGTreeUtils.METHOD_SAMPLE);
                            result.push(geom);
                        }
                    } catch (err) {
                        _didIteratorError25 = true;
                        _iteratorError25 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion25 && _iterator25.return) {
                                _iterator25.return();
                            }
                        } finally {
                            if (_didIteratorError25) {
                                throw _iteratorError25;
                            }
                        }
                    }

                    return result;
                }
            }]);

            return GeneralizedGeometry;
        }();

        geom_3.GeneralizedGeometry = GeneralizedGeometry;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            var beans;
            (function (beans) {
                var EntityHierarchyInfo = function EntityHierarchyInfo() {
                    _classCallCheck(this, EntityHierarchyInfo);
                };

                beans.EntityHierarchyInfo = EntityHierarchyInfo;
            })(beans = net.beans || (net.beans = {}));
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            /**
             * A class implementing IBinClassifier should contain sessioned properties
             * that define what values are contained in the bin.
             *
             * @author adufilie
             */
            var IBinClassifier = function (_ILinkableObject3) {
                _inherits(IBinClassifier, _ILinkableObject3);

                function IBinClassifier() {
                    _classCallCheck(this, IBinClassifier);

                    return _possibleConstructorReturn(this, (IBinClassifier.__proto__ || Object.getPrototypeOf(IBinClassifier)).apply(this, arguments));
                }

                return IBinClassifier;
            }(ILinkableObject);
            IBinClassifier = __decorate([Weave.classInfo({ id: "weavejs.api.data.IBinClassifier" })], IBinClassifier);
            data.IBinClassifier = IBinClassifier;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IBinClassifier = weavejs.api.data.IBinClassifier;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var StandardLib = weavejs.util.StandardLib;
            /**
             * A classifier that accepts a list of String values.
             *
             * @author adufilie
             */
            var StringClassifier = function (_LinkableVariable) {
                _inherits(StringClassifier, _LinkableVariable);

                function StringClassifier() {
                    _classCallCheck(this, StringClassifier);

                    /**
                     * This object maps the discrete values contained in this classifier to values of true.
                     */
                    var _this79 = _possibleConstructorReturn(this, (StringClassifier.__proto__ || Object.getPrototypeOf(StringClassifier)).call(this, Array /*, this.isStringArray*/));

                    _this79._valueMap = null;
                    _this79._triggerCount = 0;
                    // can't call super with 'this' in typescript 1.8.10
                    _this79._verifier = _this79.isStringArray;
                    return _this79;
                }
                /* override */

                _createClass(StringClassifier, [{
                    key: "setSessionState",
                    value: function setSessionState(value) {
                        // backwards compatibility
                        if (Weave.IS(value, String)) value = WeaveAPI.CSVParser.parseCSVRow(value);
                        _get(StringClassifier.prototype.__proto__ || Object.getPrototypeOf(StringClassifier.prototype), "setSessionState", this).call(this, value);
                    }
                }, {
                    key: "isStringArray",
                    value: function isStringArray(array) {
                        return StandardLib.getArrayType(array) == String;
                    }
                    /**
                     * @param value A value to test.
                     * @return true If this IBinClassifier contains the given value.
                     */

                }, {
                    key: "contains",
                    value: function contains(value) {
                        if (this._triggerCount != this.triggerCounter) {
                            this._triggerCount = this.triggerCounter;
                            this._valueMap = {};
                            var _iteratorNormalCompletion28 = true;
                            var _didIteratorError28 = false;
                            var _iteratorError28 = undefined;

                            try {
                                for (var _iterator28 = (this._sessionStateInternal || [])[Symbol.iterator](), _step28; !(_iteratorNormalCompletion28 = (_step28 = _iterator28.next()).done); _iteratorNormalCompletion28 = true) {
                                    var str = _step28.value;

                                    this._valueMap[str] = true;
                                }
                            } catch (err) {
                                _didIteratorError28 = true;
                                _iteratorError28 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion28 && _iterator28.return) {
                                        _iterator28.return();
                                    }
                                } finally {
                                    if (_didIteratorError28) {
                                        throw _iteratorError28;
                                    }
                                }
                            }
                        }
                        return this._valueMap[value] != undefined;
                    }
                }]);

                return StringClassifier;
            }(LinkableVariable);
            StringClassifier = __decorate([Weave.classInfo({ id: "weavejs.data.bin", interfaces: [IBinClassifier] })], StringClassifier);
            bin.StringClassifier = StringClassifier;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var IBinClassifier = weavejs.api.data.IBinClassifier;
            var LinkableVariable = weavejs.core.LinkableVariable;
            /**
             * This classifies a single value.
             *
             * @author adufilie
             */
            var SingleValueClassifier = function (_LinkableVariable2) {
                _inherits(SingleValueClassifier, _LinkableVariable2);

                function SingleValueClassifier() {
                    _classCallCheck(this, SingleValueClassifier);

                    return _possibleConstructorReturn(this, (SingleValueClassifier.__proto__ || Object.getPrototypeOf(SingleValueClassifier)).apply(this, arguments));
                }

                _createClass(SingleValueClassifier, [{
                    key: "contains",

                    /**
                     * @param value A value to test.
                     * @return true If this IBinClassifier contains the given value.
                     */
                    value: function contains(value) {
                        return this.sessionStateEquals(value);
                    }
                }]);

                return SingleValueClassifier;
            }(LinkableVariable);
            SingleValueClassifier = __decorate([Weave.classInfo({ id: "weavejs.data.bin.SingleValueClassifier", interfaces: [IBinClassifier] })], SingleValueClassifier);
            bin.SingleValueClassifier = SingleValueClassifier;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            /**
             * The ShpType class is a place holder for the ESRI Shapefile defined
             * shape types.
             * @author Edwin van Rijkom
             *
             */
            var ShpType = function ShpType() {
                _classCallCheck(this, ShpType);
            };
            /**
             * Unknow Shape Type (for internal use)
             */


            ShpType.SHAPE_UNKNOWN = -1;
            /**
             * ESRI Shapefile Null Shape shape type.
             */
            ShpType.SHAPE_NULL = 0;
            /**
             * ESRI Shapefile Point Shape shape type.
             */
            ShpType.SHAPE_POINT = 1;
            /**
             * ESRI Shapefile PolyLine Shape shape type.
             */
            ShpType.SHAPE_POLYLINE = 3;
            /**
             * ESRI Shapefile Polygon Shape shape type.
             */
            ShpType.SHAPE_POLYGON = 5;
            /**
             * ESRI Shapefile Multipoint Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_MULTIPOINT = 8;
            /**
             * ESRI Shapefile PointZ Shape shape type.
             */
            ShpType.SHAPE_POINTZ = 11;
            /**
             * ESRI Shapefile PolylineZ Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_POLYLINEZ = 13;
            /**
             * ESRI Shapefile PolygonZ Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_POLYGONZ = 15;
            /**
             * ESRI Shapefile MultipointZ Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_MULTIPOINTZ = 18;
            /**
             * ESRI Shapefile PointM Shape shape type
             */
            ShpType.SHAPE_POINTM = 21;
            /**
             * ESRI Shapefile PolyLineM Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_POLYLINEM = 23;
            /**
             * ESRI Shapefile PolygonM Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_POLYGONM = 25;
            /**
             * ESRI Shapefile MultiPointM Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_MULTIPOINTM = 28;
            /**
             * ESRI Shapefile MultiPatch Shape shape type
             * (currently unsupported).
             */
            ShpType.SHAPE_MULTIPATCH = 31;
            shp.ShpType = ShpType;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            /**
             * The ShpObject class is the base class of all specialized Shapefile
             * record type parsers.
             * @author Edwin van Rijkom
             * @see org.vanrijkom.shp.ShpPoint
             * @see org.vanrijkom.shp.ShpPointZ
             * @see org.vanrijkom.shp.ShpPolygon
             * @see org.vanrijkom.shp.ShpPolyline
             */
            var ShpObject = function ShpObject() {
                _classCallCheck(this, ShpObject);
            };

            shp.ShpObject = ShpObject;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var Point = function () {
            function Point() {
                var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NaN;
                var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : NaN;

                _classCallCheck(this, Point);

                this.x = x;
                this.y = y;
            }

            _createClass(Point, null, [{
                key: "distance",
                value: function distance(p1, p2) {
                    var dx = p2.x - p1.x;
                    var dy = p2.y - p1.y;
                    return Math.sqrt(dx * dx + dy * dy);
                }
            }, {
                key: "interpolate",
                value: function interpolate(p1, p2, percentage) {
                    var dx = p2.x - p1.x;
                    var dy = p2.y - p1.y;
                    return new Point(p1.x + percentage * dx, p1.y + percentage * dy);
                }
            }]);

            return Point;
        }();

        geom.Point = Point;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var Point = weavejs.geom.Point;
        /**
         * Bounds2D provides a flexible interface to a Rectangle-like object.
         * The bounds values are stored as xMin,yMin,xMax,yMax instead of x,y,width,height
         * because information is lost when storing as width,height and it causes rounding
         * errors when using includeBounds() and includePoint(), depending on the order you
         * include multiple points.
         *
         * @author adufilie
         */

        var Bounds2D = function () {
            /**
             * The default coordinates are all NaN so that includeCoords() will behave as expected after
             * creating an empty Bounds2D.
             * @param xMin The starting X coordinate.
             * @param yMin The starting Y coordinate.
             * @param xMax The ending X coordinate.
             * @param yMax The ending Y coordinate.
             */
            function Bounds2D() {
                var xMin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NaN;
                var yMin = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : NaN;
                var xMax = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : NaN;
                var yMax = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : NaN;

                _classCallCheck(this, Bounds2D);

                this.setBounds(xMin, yMin, xMax, yMax);
            }

            _createClass(Bounds2D, [{
                key: "getXMin",
                value: function getXMin() {
                    return this.xMin;
                }
            }, {
                key: "getYMin",
                value: function getYMin() {
                    return this.yMin;
                }
            }, {
                key: "getXMax",
                value: function getXMax() {
                    return this.xMax;
                }
            }, {
                key: "getYMax",
                value: function getYMax() {
                    return this.yMax;
                }
            }, {
                key: "setXMin",
                value: function setXMin(value) {
                    this.xMin = value;
                }
            }, {
                key: "setYMin",
                value: function setYMin(value) {
                    this.yMin = value;
                }
            }, {
                key: "setXMax",
                value: function setXMax(value) {
                    this.xMax = value;
                }
            }, {
                key: "setYMax",
                value: function setYMax(value) {
                    this.yMax = value;
                }
                /**
                 * This function copies the bounds from another Bounds2D object.
                 * @param A Bounds2D object to copy the bounds from.
                 */

            }, {
                key: "copyFrom",
                value: function copyFrom(other) {
                    if (other == null) {
                        this.reset();
                        return;
                    }
                    this.xMin = other.xMin;
                    this.yMin = other.yMin;
                    this.xMax = other.xMax;
                    this.yMax = other.yMax;
                }
                /**
                 * This function makes a copy of the Bounds2D object.
                 * @return An equivalent copy of this Bounds2D object.
                 */

            }, {
                key: "cloneBounds",
                value: function cloneBounds() {
                    return new Bounds2D(this.xMin, this.yMin, this.xMax, this.yMax);
                }
                /**
                 * For the x and y dimensions, this function swaps min and max values if min > max.
                 */

            }, {
                key: "makeSizePositive",
                value: function makeSizePositive() {
                    var temp;
                    // make width positive
                    if (this.xMin > this.xMax) {
                        temp = this.xMin;
                        this.xMin = this.xMax;
                        this.xMax = temp;
                    }
                    // make height positive
                    if (this.yMin > this.yMax) {
                        temp = this.yMin;
                        this.yMin = this.yMax;
                        this.yMax = temp;
                    }
                }
                /**
                 * This function resets all coordinates to NaN.
                 */

            }, {
                key: "reset",
                value: function reset() {
                    this.xMin = NaN;
                    this.yMin = NaN;
                    this.xMax = NaN;
                    this.yMax = NaN;
                }
                /**
                 * This function checks if any coordinates are undefined or infinite.
                 * @return true if any coordinate is not a finite number.
                 */

            }, {
                key: "isUndefined",
                value: function isUndefined() {
                    return !isFinite(this.xMin) || !isFinite(this.yMin) || !isFinite(this.xMax) || !isFinite(this.yMax);
                }
                /**
                 * This function checks if the Bounds2D is empty.
                 * @return true if the width or height is 0, or is undefined.
                 */

            }, {
                key: "isEmpty",
                value: function isEmpty() {
                    return this.xMin == this.xMax || this.yMin == this.yMax || this.isUndefined();
                }
                /**
                 * This function compares the Bounds2D with another Bounds2D.
                 * @param other Another Bounds2D to compare to
                 * @return true if given Bounds2D is equivalent, even if values are undefined
                 */

            }, {
                key: "equals",
                value: function equals(other) {
                    if (other == null) return this.isUndefined();
                    return (this.xMin == other.xMin || isNaN(this.xMin) && isNaN(other.xMin)) && (this.yMin == other.yMin || isNaN(this.yMin) && isNaN(other.yMin)) && (this.xMax == other.xMax || isNaN(this.xMax) && isNaN(other.xMax)) && (this.yMax == other.yMax || isNaN(this.yMax) && isNaN(other.yMax));
                }
                /**
                 * This function sets the four coordinates that define the bounds.
                 * @param xMin The new xMin value.
                 * @param yMin The new yMin value.
                 * @param xMax The new xMax value.
                 * @param yMax The new yMax value.
                 */

            }, {
                key: "setBounds",
                value: function setBounds(xMin, yMin, xMax, yMax) {
                    // allow any values for fastest performance
                    this.xMin = xMin;
                    this.yMin = yMin;
                    this.xMax = xMax;
                    this.yMax = yMax;
                }
                /**
                 * @param xMin_yMin_xMax_yMax An Array of four Numbers like [xMin, yMin, xMax, yMax]
                 */

            }, {
                key: "setCoords",
                value: function setCoords(xMin_yMin_xMax_yMax) {
                    this.xMin = xMin_yMin_xMax_yMax[0];
                    this.yMin = xMin_yMin_xMax_yMax[1];
                    this.xMax = xMin_yMin_xMax_yMax[2];
                    this.yMax = xMin_yMin_xMax_yMax[3];
                }
                /**
                 * @return [xMin, yMin, xMax, yMax]
                 */

            }, {
                key: "getCoords",
                value: function getCoords() {
                    return [this.xMin, this.yMin, this.xMax, this.yMax];
                }
                /**
                 * This function sets the bounds coordinates using x, y, width and height values.
                 * @param x The new xMin value.
                 * @param y The new yMin value.
                 * @param width The new width of the bounds.
                 * @param height The new height of the bounds.
                 */

            }, {
                key: "setRectangle",
                value: function setRectangle(x, y, width, height) {
                    // allow any values for fastest performance
                    this.xMin = x;
                    this.yMin = y;
                    this.xMax = x + width;
                    this.yMax = y + height;
                }
                /**
                 * This function copies the values from this Bounds2D object into a Rectangle object.
                 * @param output A Rectangle to store the result in.
                 * @param makeSizePositive If true, this will give the Rectangle positive width/height values.
                 * @return Either the given output Rectangle, or a new Rectangle if none was specified.
                 */

            }, {
                key: "getRectangle",
                value: function getRectangle() {
                    var output = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                    var makeSizePositive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

                    if (output == null) output = new geom.Rectangle();
                    if (makeSizePositive) {
                        output.x = this.getXNumericMin();
                        output.y = this.getYNumericMin();
                        output.width = this.getXCoverage();
                        output.height = this.getYCoverage();
                    } else {
                        output.x = this.xMin;
                        output.y = this.yMin;
                        output.width = this.getWidth();
                        output.height = this.getHeight();
                    }
                    return output;
                }
                //		/**
                //		 * This will apply transformations to an existing Matrix for projecting coordinates from this bounds to another.
                //		 * @param destinationBounds The destination bounds used to calculate the transformation.
                //		 * @param outputMatrix The Matrix used to store the transformation.
                //		 * @param startWithIdentity If this is true, then outputMatrix.identity() will be applied first.
                //		 */
                //		public transformMatrix(destinationBounds:Bounds2D, outputMatrix:Matrix, startWithIdentity:boolean):void
                //		{
                //			if (startWithIdentity)
                //				outputMatrix.identity();
                //			outputMatrix.translate(-xMin, -yMin);
                //			outputMatrix.scale(
                //				destinationBounds.getWidth() / getWidth(),
                //				destinationBounds.getHeight() / getHeight()
                //			);
                //			outputMatrix.translate(destinationBounds.getXMin(), destinationBounds.getYMin());
                //		}
                /**
                 * This function will expand this Bounds2D to include a point.
                 * @param newPoint A point to include in this Bounds2D.
                 */

            }, {
                key: "includePoint",
                value: function includePoint(newPoint) {
                    this.includeCoords(newPoint.x, newPoint.y);
                }
                /**
                 * This function will expand this Bounds2D to include a point.
                 * @param newX The X coordinate of a point to include in this Bounds2D.
                 * @param newY The Y coordinate of a point to include in this Bounds2D.
                 */

            }, {
                key: "includeCoords",
                value: function includeCoords(newX, newY) {
                    if (isFinite(newX)) {
                        // If x coordinates are undefined, define them now.
                        if (isNaN(this.xMin)) {
                            if (isNaN(this.xMax)) this.xMin = this.xMax = newX;else this.xMin = this.xMax;
                        } else if (isNaN(this.xMax)) this.xMax = this.xMin;
                        // update min,max values for both positive and negative width values
                        if (this.xMin > this.xMax) {
                            if (newX > this.xMin) this.xMin = newX; // xMin = Math.max(xMin, newX);
                            if (newX < this.xMax) this.xMax = newX; // xMax = Math.min(xMax, newX);
                        } else {
                            if (newX < this.xMin) this.xMin = newX; // xMin = Math.min(xMin, newX);
                            if (newX > this.xMax) this.xMax = newX; // xMax = Math.max(xMax, newX);
                        }
                    }
                    if (isFinite(newY)) {
                        // If y coordinates are undefined, define them now.
                        if (isNaN(this.yMin)) {
                            if (isNaN(this.yMax)) this.yMin = this.yMax = newY;else this.yMin = this.yMax;
                        } else if (isNaN(this.yMax)) this.yMax = this.yMin;
                        // update min,max values for both positive and negative height values
                        if (this.yMin > this.yMax) {
                            if (newY > this.yMin) this.yMin = newY; // yMin = Math.max(yMin, newY);
                            if (newY < this.yMax) this.yMax = newY; // yMax = Math.min(yMax, newY);
                        } else {
                            if (newY < this.yMin) this.yMin = newY; // yMin = Math.min(yMin, newY);
                            if (newY > this.yMax) this.yMax = newY; // yMax = Math.max(yMax, newY);
                        }
                    }
                }
                /**
                 * This function will expand this Bounds2D to include an X value.
                 * @param newX The X coordinate to include in this Bounds2D.
                 */

            }, {
                key: "includeX",
                value: function includeX(newX) {
                    this.includeCoords(newX, NaN);
                }
                /**
                 * This function will expand this Bounds2D to include a Y value.
                 * @param newY The Y coordinate to include in this Bounds2D.
                 */

            }, {
                key: "includeY",
                value: function includeY(newY) {
                    this.includeCoords(NaN, newY);
                }
                /**
                 * This function will expand this Bounds2D to include another Bounds2D.
                 * @param otherBounds Another Bounds2D object to include within this Bounds2D.
                 */

            }, {
                key: "includeBounds",
                value: function includeBounds(otherBounds) {
                    this.includeCoords(otherBounds.xMin, otherBounds.yMin);
                    this.includeCoords(otherBounds.xMax, otherBounds.yMax);
                }
                // this function supports comparisons of bounds with negative width/height

            }, {
                key: "overlaps",
                value: function overlaps(other) {
                    var includeEdges = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

                    // load re-usable objects and make sizes positive to make it easier to compare
                    var a = Bounds2D.staticBounds2D_A;
                    a.copyFrom(this);
                    a.makeSizePositive();
                    var b = Bounds2D.staticBounds2D_B;
                    b.copyFrom(other);
                    b.makeSizePositive();
                    // test for overlap
                    if (includeEdges) return a.xMin <= b.xMax && b.xMin <= a.xMax && a.yMin <= b.yMax && b.yMin <= a.yMax;else return a.xMin < b.xMax && b.xMin < a.xMax && a.yMin < b.yMax && b.yMin < a.yMax;
                }
                /**
                 * This function supports a Bounds2D object having negative width and height, unlike the Rectangle object
                 * @param point A point to test.
                 * @return A value of true if the point is contained within this Bounds2D.
                 */

            }, {
                key: "containsPoint",
                value: function containsPoint(point) {
                    return this.contains(point.x, point.y);
                }
                /**
                 * This function supports a Bounds2D object having negative width and height, unlike the Rectangle object
                 * @param x An X coordinate for a point.
                 * @param y A Y coordinate for a point.
                 * @return A value of true if the point is contained within this Bounds2D.
                 */

            }, {
                key: "contains",
                value: function contains(x, y) {
                    if (this.xMin < this.xMax ? this.xMin <= x && x <= this.xMax : this.xMax <= x && x <= this.xMin) if (this.yMin < this.yMax ? this.yMin <= y && y <= this.yMax : this.yMax <= y && y <= this.yMin) return true;
                    return false;
                }
                /**
                 * This function supports a Bounds2D object having negative width and height, unlike the Rectangle object
                 * @param other Another Bounds2D object to check.
                 * @return A value of true if the other Bounds2D is contained within this Bounds2D.
                 */

            }, {
                key: "containsBounds",
                value: function containsBounds(other) {
                    return this.contains(other.xMin, other.yMin) && this.contains(other.xMax, other.yMax);
                }
                /**
                 * This function is used to determine which vertices of a polygon can be skipped when rendering within the bounds of this Bounds2D.
                 * While iterating over vertices, test each one with this function.
                 * If (firstGridTest &amp; secondGridTest &amp; thirdGridTest) is non-zero, then the second vertex can be skipped.
                 * @param x The x-coordinate to test.
                 * @param y The y-coordinate to test.
                 * @return A value to be ANDed with other results of getGridTest().
                 */

            }, {
                key: "getGridTest",
                value: function getGridTest(x, y) {
                    // Note: This function is optimized for speed
                    // If three consecutive vertices all share one of (X_HI, X_LO, Y_HI, Y_LO) test results,
                    // then the middle point can be skipped when rendering inside the bounds.
                    var x0, x1, y0, y1;
                    if (this.xMin < this.xMax) x0 = this.xMin, x1 = this.xMax;else x1 = this.xMin, x0 = this.xMax;
                    if (this.yMin < this.yMax) y0 = this.yMin, y1 = this.yMax;else y1 = this.yMin, y0 = this.yMax;
                    return (x < x0 ? 0x0001 /*X_LO*/ : x > x1 ? 0x0010 /*X_HI*/ : 0) | (y < y0 ? 0x0100 /*Y_LO*/ : y > y1 ? 0x1000 /*Y_HI*/ : 0);
                }
                /**
                 * This function projects the coordinates of a Point object from this bounds to a
                 * destination bounds. The specified point object will be modified to contain the result.
                 * @param point The Point object containing coordinates to project.
                 * @param toBounds The destination bounds.
                 */

            }, {
                key: "projectPointTo",
                value: function projectPointTo(point, toBounds) {
                    // this function is optimized for speed
                    var toXMin;
                    var toXMax;
                    var toYMin;
                    var toYMax;
                    toXMin = toBounds.xMin;
                    toXMax = toBounds.xMax;
                    toYMin = toBounds.yMin;
                    toYMax = toBounds.yMax;
                    var x = toXMin + (point.x - this.xMin) / (this.xMax - this.xMin) * (toXMax - toXMin);
                    if (x <= Infinity) point.x = x;else point.x = (toXMin + toXMax) / 2;
                    var y = toYMin + (point.y - this.yMin) / (this.yMax - this.yMin) * (toYMax - toYMin);
                    if (y <= Infinity) point.y = y;else point.y = (toYMin + toYMax) / 2;
                }
                /**
                 * This function projects all four coordinates of a Bounds2D object from this bounds
                 * to a destination bounds. The specified coords object will be modified to contain the result.
                 * @param inputAndOutput A Bounds2D object containing coordinates to project.
                 * @param toBounds The destination bounds.
                 */

            }, {
                key: "projectCoordsTo",
                value: function projectCoordsTo(coords, toBounds) {
                    // project min coords
                    coords.getMinPoint(Bounds2D.tempPoint);
                    this.projectPointTo(Bounds2D.tempPoint, toBounds);
                    coords.setMinPoint(Bounds2D.tempPoint);
                    // project max coords
                    coords.getMaxPoint(Bounds2D.tempPoint);
                    this.projectPointTo(Bounds2D.tempPoint, toBounds);
                    coords.setMaxPoint(Bounds2D.tempPoint);
                }
                /**
                 * This constrains a point to be within this Bounds2D. The specified point object will be modified to contain the result.
                 * @param point The point to constrain.
                 */

            }, {
                key: "constrainPoint",
                value: function constrainPoint(point) {
                    // find numerical min,max x values and constrain x coordinate
                    if (!isNaN(this.xMin) && !isNaN(this.xMax)) point.x = Math.max(Math.min(this.xMin, this.xMax), Math.min(point.x, Math.max(this.xMin, this.xMax)));
                    // find numerical min,max y values and constrain y coordinate
                    if (!isNaN(this.yMin) && !isNaN(this.yMax)) point.y = Math.max(Math.min(this.yMin, this.yMax), Math.min(point.y, Math.max(this.yMin, this.yMax)));
                }
                /**
                 * This constrains the center point of another Bounds2D to be overlapping the center of this Bounds2D.
                 * The specified boundsToConstrain object will be modified to contain the result.
                 * @param boundsToConstrain The Bounds2D objects to constrain.
                 */

            }, {
                key: "constrainBoundsCenterPoint",
                value: function constrainBoundsCenterPoint(boundsToConstrain) {
                    if (this.isUndefined()) return;
                    // find the point in the boundsToConstrain closest to the center point of this bounds
                    // then offset the boundsToConstrain so it overlaps the center point of this bounds
                    boundsToConstrain.getCenterPoint(Bounds2D.tempPoint);
                    this.constrainPoint(Bounds2D.tempPoint);
                    boundsToConstrain.setCenterPoint(Bounds2D.tempPoint);
                }
                /**
                 * This function will reposition a bounds such that for the x and y dimensions of this
                 * bounds and another bounds, at least one bounds will completely contain the other bounds.
                 * The specified boundsToConstrain object will be modified to contain the result.
                 * @param boundsToConstrain the bounds we want to constrain to be within this bounds
                 * @param preserveSize if set to true, width,height of boundsToConstrain will remain the same
                 */

            }, {
                key: "constrainBounds",
                value: function constrainBounds(boundsToConstrain) {
                    var preserveSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

                    if (preserveSize) {
                        var b2c = boundsToConstrain;
                        // constrain x values
                        Bounds2D.staticRange_A.setRange(this.xMin, this.xMax);
                        Bounds2D.staticRange_B.setRange(b2c.xMin, b2c.xMax);
                        Bounds2D.staticRange_A.constrainRange(Bounds2D.staticRange_B);
                        boundsToConstrain.setXRange(Bounds2D.staticRange_B.begin, Bounds2D.staticRange_B.end);
                        // constrain y values
                        Bounds2D.staticRange_A.setRange(this.yMin, this.yMax);
                        Bounds2D.staticRange_B.setRange(b2c.yMin, b2c.yMax);
                        Bounds2D.staticRange_A.constrainRange(Bounds2D.staticRange_B);
                        boundsToConstrain.setYRange(Bounds2D.staticRange_B.begin, Bounds2D.staticRange_B.end);
                    } else {
                        // constrain min point
                        boundsToConstrain.getMinPoint(Bounds2D.tempPoint);
                        this.constrainPoint(Bounds2D.tempPoint);
                        boundsToConstrain.setMinPoint(Bounds2D.tempPoint);
                        // constrain max point
                        boundsToConstrain.getMaxPoint(Bounds2D.tempPoint);
                        this.constrainPoint(Bounds2D.tempPoint);
                        boundsToConstrain.setMaxPoint(Bounds2D.tempPoint);
                    }
                }
            }, {
                key: "offset",
                value: function offset(xOffset, yOffset) {
                    this.xMin += xOffset;
                    this.xMax += xOffset;
                    this.yMin += yOffset;
                    this.yMax += yOffset;
                }
            }, {
                key: "getXRange",
                value: function getXRange() {
                    return [this.xMin, this.xMax];
                }
            }, {
                key: "getYRange",
                value: function getYRange() {
                    return [this.yMin, this.yMax];
                }
            }, {
                key: "setXRange",
                value: function setXRange(xMin, xMax) {
                    this.xMin = xMin;
                    this.xMax = xMax;
                }
            }, {
                key: "setYRange",
                value: function setYRange(yMin, yMax) {
                    this.yMin = yMin;
                    this.yMax = yMax;
                }
            }, {
                key: "setCenteredXRange",
                value: function setCenteredXRange(xCenter, width) {
                    this.xMin = xCenter - width / 2;
                    this.xMax = xCenter + width / 2;
                }
            }, {
                key: "setCenteredYRange",
                value: function setCenteredYRange(yCenter, height) {
                    this.yMin = yCenter - height / 2;
                    this.yMax = yCenter + height / 2;
                }
            }, {
                key: "setCenteredRectangle",
                value: function setCenteredRectangle(xCenter, yCenter, width, height) {
                    this.setCenteredXRange(xCenter, width);
                    this.setCenteredYRange(yCenter, height);
                }
                /**
                 * This function will set the width and height to the new values while keeping the
                 * center point constant.  This function works with both positive and negative values.
                 */

            }, {
                key: "centeredResize",
                value: function centeredResize(width, height) {
                    this.setCenteredXRange(this.getXCenter(), width);
                    this.setCenteredYRange(this.getYCenter(), height);
                }
            }, {
                key: "getXCenter",
                value: function getXCenter() {
                    return (this.xMin + this.xMax) / 2;
                }
            }, {
                key: "setXCenter",
                value: function setXCenter(xCenter) {
                    if (isNaN(this.xMin) || isNaN(this.xMax)) this.xMin = this.xMax = xCenter;else {
                        var xShift = xCenter - (this.xMin + this.xMax) / 2;
                        this.xMin += xShift;
                        this.xMax += xShift;
                    }
                }
            }, {
                key: "getYCenter",
                value: function getYCenter() {
                    return (this.yMin + this.yMax) / 2;
                }
            }, {
                key: "setYCenter",
                value: function setYCenter(yCenter) {
                    if (isNaN(this.yMin) || isNaN(this.yMax)) this.yMin = this.yMax = yCenter;else {
                        var yShift = yCenter - (this.yMin + this.yMax) / 2;
                        this.yMin += yShift;
                        this.yMax += yShift;
                    }
                }
                /**
                 * This function stores the xCenter and yCenter coordinates into a Point object.
                 * @param value The Point object to store the xCenter and yCenter coordinates in.
                 */

            }, {
                key: "getCenterPoint",
                value: function getCenterPoint(output) {
                    output.x = this.getXCenter();
                    output.y = this.getYCenter();
                }
                /**
                 * This function will shift the bounds coordinates so that the xCenter and yCenter
                 * become the coordinates in a specified Point object.
                 * @param value The Point object containing the desired xCenter and yCenter coordinates.
                 */

            }, {
                key: "setCenterPoint",
                value: function setCenterPoint(value) {
                    this.setXCenter(value.x);
                    this.setYCenter(value.y);
                }
                /**
                 * This function will shift the bounds coordinates so that the xCenter and yCenter
                 * become the specified values.
                 * @param xCenter The desired value for xCenter.
                 * @param yCenter The desired value for yCenter.
                 */

            }, {
                key: "setCenter",
                value: function setCenter(xCenter, yCenter) {
                    this.setXCenter(xCenter);
                    this.setYCenter(yCenter);
                }
                /**
                 * This function stores the xMin and yMin coordinates in a Point object.
                 * @param output The Point to store the xMin and yMin coordinates in.
                 */

            }, {
                key: "getMinPoint",
                value: function getMinPoint(output) {
                    output.x = this.xMin;
                    output.y = this.yMin;
                }
                /**
                 * This function sets the xMin and yMin values from a Point object.
                 * @param value The Point containing new xMin and yMin coordinates.
                 */

            }, {
                key: "setMinPoint",
                value: function setMinPoint(value) {
                    this.xMin = value.x;
                    this.yMin = value.y;
                }
                /**
                 * This function stores the xMax and yMax coordinates in a Point object.
                 * @param output The Point to store the xMax and yMax coordinates in.
                 */

            }, {
                key: "getMaxPoint",
                value: function getMaxPoint(output) {
                    output.x = this.xMax;
                    output.y = this.yMax;
                }
                /**
                 * This function sets the xMax and yMax values from a Point object.
                 * @param value The Point containing new xMax and yMax coordinates.
                 */

            }, {
                key: "setMaxPoint",
                value: function setMaxPoint(value) {
                    this.xMax = value.x;
                    this.yMax = value.y;
                }
                /**
                 * This function sets the xMin and yMin values.
                 * @param x The new xMin coordinate.
                 * @param y The new yMin coordinate.
                 */

            }, {
                key: "setMinCoords",
                value: function setMinCoords(x, y) {
                    this.xMin = x;
                    this.yMin = y;
                }
                /**
                 * This function sets the xMax and yMax values.
                 * @param x The new xMax coordinate.
                 * @param y The new yMax coordinate.
                 */

            }, {
                key: "setMaxCoords",
                value: function setMaxCoords(x, y) {
                    this.xMax = x;
                    this.yMax = y;
                }
                /**
                 * This is equivalent to ObjectUtil.numericCompare(xMax, xMin)
                 */

            }, {
                key: "getXDirection",
                value: function getXDirection() {
                    if (this.xMin > this.xMax) return -1;
                    if (this.xMin < this.xMax) return 1;
                    return 0;
                }
                /**
                 * This is equivalent to ObjectUtil.numericCompare(yMax, yMin)
                 */

            }, {
                key: "getYDirection",
                value: function getYDirection() {
                    if (this.yMin > this.yMax) return -1;
                    if (this.yMin < this.yMax) return 1;
                    return 0;
                }
                /**
                 * The width of the bounds is defined as xMax - xMin.
                 */

            }, {
                key: "getWidth",
                value: function getWidth() {
                    var _width = this.xMax - this.xMin;
                    return isNaN(_width) ? 0 : _width;
                }
                /**
                 * The height of the bounds is defined as yMax - yMin.
                 */

            }, {
                key: "getHeight",
                value: function getHeight() {
                    var _height = this.yMax - this.yMin;
                    return isNaN(_height) ? 0 : _height;
                }
                /**
                 * This function will set the width by adjusting the xMin and xMax values relative to xCenter.
                 * @param value The new width value.
                 */

            }, {
                key: "setWidth",
                value: function setWidth(value) {
                    this.setCenteredXRange(this.getXCenter(), value);
                }
                /**
                 * This function will set the height by adjusting the yMin and yMax values relative to yCenter.
                 * @param value The new height value.
                 */

            }, {
                key: "setHeight",
                value: function setHeight(value) {
                    this.setCenteredYRange(this.getYCenter(), value);
                }
                /**
                 * Area is defined as the absolute value of width * height.
                 * @return The area of the bounds.
                 */

            }, {
                key: "getArea",
                value: function getArea() {
                    var area = (this.xMax - this.xMin) * (this.yMax - this.yMin);
                    return area < 0 ? -area : area; // Math.abs(area);
                }
                /**
                 * The xCoverage is defined as the absolute value of the width.
                 * @return The xCoverage of the bounds.
                 */

            }, {
                key: "getXCoverage",
                value: function getXCoverage() {
                    return this.xMin < this.xMax ? this.xMax - this.xMin : this.xMin - this.xMax; // Math.abs(xMax - xMin);
                }
                /**
                 * The yCoverage is defined as the absolute value of the height.
                 * @return The yCoverage of the bounds.
                 */

            }, {
                key: "getYCoverage",
                value: function getYCoverage() {
                    return this.yMin < this.yMax ? this.yMax - this.yMin : this.yMin - this.yMax; // Math.abs(yMax - yMin);
                }
                /**
                 * The xNumericMin is defined as the minimum of xMin and xMax.
                 * @return The numeric minimum x coordinate.
                 */

            }, {
                key: "getXNumericMin",
                value: function getXNumericMin() {
                    return this.xMax < this.xMin ? this.xMax : this.xMin; // if any are NaN, returns xMin
                }
                /**
                 * The yNumericMin is defined as the minimum of yMin and yMax.
                 * @return The numeric minimum y coordinate.
                 */

            }, {
                key: "getYNumericMin",
                value: function getYNumericMin() {
                    return this.yMax < this.yMin ? this.yMax : this.yMin; // if any are NaN, returns yMin
                }
                /**
                 * The xNumericMax is defined as the maximum of xMin and xMax.
                 * @return The numeric maximum x coordinate.
                 */

            }, {
                key: "getXNumericMax",
                value: function getXNumericMax() {
                    return this.xMax < this.xMin ? this.xMin : this.xMax; // if any are NaN, returns xMax
                }
                /**
                 * The xNumericMax is defined as the maximum of xMin and xMax.
                 * @return The numeric maximum y coordinate.
                 */

            }, {
                key: "getYNumericMax",
                value: function getYNumericMax() {
                    return this.yMax < this.yMin ? this.yMin : this.yMax; // if any are NaN, returns yMax
                }
                /**
                 * This function returns a String suitable for debugging the Bounds2D coordinates.
                 * @return A String containing the coordinates of the bounds.
                 */

            }, {
                key: "toString",
                value: function toString() {
                    return "(xMin=" + this.xMin + ", " + "yMin=" + this.yMin + ", " + "xMax=" + this.xMax + ", " + "yMax=" + this.yMax + ")";
                }
            }]);

            return Bounds2D;
        }();
        // re-usable temporary objects


        Bounds2D.staticBounds2D_A = new Bounds2D();
        Bounds2D.staticBounds2D_B = new Bounds2D();
        // reusable temporary objects
        Bounds2D.tempPoint = new Point();
        Bounds2D.staticRange_A = new geom.NumericRange();
        Bounds2D.staticRange_B = new geom.NumericRange();
        geom.Bounds2D = Bounds2D;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var VBox = weavejs.ui.flexbox.VBox;
        var SmartComponent = weavejs.ui.SmartComponent;
        var MouseUtils = weavejs.util.MouseUtils;
        var ReactUtils = weavejs.util.ReactUtils;
        var Div = weavejs.ui.Div;
        var Bounds2D = weavejs.geom.Bounds2D;
        var DOMUtils = weavejs.util.DOMUtils;
        var Handle;
        (function (Handle) {
            Handle[Handle["LEFT"] = 1] = "LEFT";
            Handle[Handle["TOP"] = 2] = "TOP";
            Handle[Handle["RIGHT"] = 4] = "RIGHT";
            Handle[Handle["BOTTOM"] = 8] = "BOTTOM";
        })(Handle || (Handle = {}));
        ;

        var DraggableDiv = function (_SmartComponent10) {
            _inherits(DraggableDiv, _SmartComponent10);

            function DraggableDiv(props) {
                _classCallCheck(this, DraggableDiv);

                var _this81 = _possibleConstructorReturn(this, (DraggableDiv.__proto__ || Object.getPrototypeOf(DraggableDiv)).call(this, props));

                _this81.overlayStyle = {
                    visibility: "hidden",
                    position: "absolute",
                    backgroundColor: "rgba(0, 0, 0, 0.2)"
                };
                _this81.onDragStart = function (event) {
                    if (_this81.props.movable) {
                        if (!_this81.props.liveMoving) _this81.updateOverlayStyle(_this81.state);
                        event.preventDefault();
                        event.stopPropagation();
                        _this81.mouseDownOffset = _this81.getMouseOffset();
                        _this81.mouseDownBounds = _this81.getOffsetBounds();
                        _this81.moving = true;
                    }
                    if (_this81.props.onDragStart) _this81.props.onDragStart(event);
                };
                _this81.onDrag = function (event) {
                    if (_this81.activeResizeHandle || _this81.moving) _this81.reposition();
                };
                _this81.onDragEnd = function (event) {
                    // if live update is disabled, we reposition when drag ends
                    if (_this81.activeResizeHandle || _this81.moving) _this81.reposition(true);
                    _this81.moving = false;
                    _this81.activeResizeHandle = null;
                };
                _this81.setState(_this81.toDraggableDivState(props.style));
                return _this81;
            }

            _createClass(DraggableDiv, [{
                key: "componentWillReceiveProps",
                value: function componentWillReceiveProps(props) {
                    // allow new props to override state
                    this.setState(_.merge({}, this.state, this.toDraggableDivState(props.style)));
                }
            }, {
                key: "componentDidMount",
                value: function componentDidMount() {
                    MouseUtils.forComponent(this); // initializes MouseUtils document listeners so getOffsetPoint() will be correct the first time
                    // center div if left or top style is undefined
                    var parent = this.element.offsetParent;
                    var style = this.props.style || {};
                    var newState = _.clone(this.state);
                    if (style.top === undefined) newState.top = (parent.offsetHeight - this.element.offsetHeight) / 2;
                    if (style.left === undefined) newState.left = (parent.offsetWidth - this.element.offsetWidth) / 2;
                    this.setState(newState);
                    var document = ReactUtils.getDocument(this);
                    document.addEventListener("mouseup", this.onDragEnd, true);
                    document.addEventListener("mousemove", this.onDrag, true);
                }
            }, {
                key: "onResizeStart",
                value: function onResizeStart(event, handle) {
                    if (!this.props.liveResizing) this.updateOverlayStyle(this.state);
                    this.mouseDownOffset = this.getMouseOffset();
                    this.mouseDownBounds = this.getOffsetBounds();
                    this.activeResizeHandle = handle;
                }
            }, {
                key: "updateOverlayStyle",
                value: function updateOverlayStyle() {
                    for (var _len8 = arguments.length, styles = Array(_len8), _key9 = 0; _key9 < _len8; _key9++) {
                        styles[_key9] = arguments[_key9];
                    }

                    this.overlayStyle = _.merge.apply(_, [{}, this.overlayStyle].concat(styles));
                    this.overlay.setState({ style: this.overlayStyle });
                }
            }, {
                key: "toDraggableDivState",
                value: function toDraggableDivState(obj) {
                    return _.pick(obj, "left", "top", "width", "height");
                }
            }, {
                key: "getMouseOffset",
                value: function getMouseOffset() {
                    return MouseUtils.getOffsetPoint(this.element.offsetParent);
                }
            }, {
                key: "getOffsetBounds",
                value: function getOffsetBounds() {
                    var rect = DOMUtils.getOffsetRect(this.element.offsetParent, this.element);
                    var bounds = new Bounds2D();
                    bounds.setRectangle(rect.left, rect.top, rect.width, rect.height);
                    return bounds;
                }
            }, {
                key: "shouldLiveUpdate",
                value: function shouldLiveUpdate() {
                    return this.activeResizeHandle && this.props.liveResizing || this.moving && this.props.liveMoving;
                }
            }, {
                key: "getNumberFromStyleValue",
                value: function getNumberFromStyleValue(part, whole) {
                    var str = String(part);
                    if (str.substr(-1) == '%') part = Number(str.substr(0, str.length - 1)) * whole / 100;
                    return Number(part) || 0;
                }
            }, {
                key: "reposition",
                value: function reposition() {
                    var forceLiveUpdate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                    var parent = this.element.offsetParent;
                    var parentWidth = parent.offsetWidth;
                    var parentHeight = parent.offsetHeight;
                    var mouseOffset = this.getMouseOffset();
                    var mouseDeltaX = mouseOffset.x - this.mouseDownOffset.x;
                    var mouseDeltaY = mouseOffset.y - this.mouseDownOffset.y;
                    var minWidth = this.getNumberFromStyleValue(this.props.style && this.props.style.minWidth, parentWidth);
                    var minHeight = this.getNumberFromStyleValue(this.props.style && this.props.style.minHeight, parentHeight);
                    var oldBounds = this.mouseDownBounds;
                    var newBounds = oldBounds.cloneBounds();
                    if (this.activeResizeHandle) {
                        if (this.activeResizeHandle & Handle.LEFT) {
                            newBounds.xMin += mouseDeltaX;
                            newBounds.xMin = Math.max(newBounds.xMin, oldBounds.xMax - parentWidth, 0);
                            newBounds.xMin = Math.min(newBounds.xMin, oldBounds.xMax - minWidth);
                        }
                        if (this.activeResizeHandle & Handle.TOP) {
                            newBounds.yMin += mouseDeltaY;
                            newBounds.yMin = Math.max(newBounds.yMin, oldBounds.yMax - parentHeight, 0);
                            newBounds.yMin = Math.min(newBounds.yMin, oldBounds.yMax - minHeight);
                        }
                        if (this.activeResizeHandle & Handle.RIGHT) {
                            newBounds.xMax += mouseDeltaX;
                            newBounds.xMax = Math.max(newBounds.xMax, oldBounds.xMin + minWidth);
                            newBounds.xMax = Math.min(newBounds.xMax, oldBounds.xMin + parentWidth, parentWidth);
                        }
                        if (this.activeResizeHandle & Handle.BOTTOM) {
                            newBounds.yMax += mouseDeltaY;
                            newBounds.yMax = Math.max(newBounds.yMax, oldBounds.yMin + minHeight);
                            newBounds.yMax = Math.min(newBounds.yMax, oldBounds.yMin + parentHeight, parentHeight);
                        }
                    } else {
                        newBounds.xMin += mouseDeltaX;
                        newBounds.xMin = Math.max(newBounds.xMin, 0);
                        newBounds.xMin = Math.min(newBounds.xMin, parentWidth - oldBounds.getWidth());
                        newBounds.xMax = newBounds.xMin + oldBounds.getWidth(); // preserve width
                        newBounds.yMin += mouseDeltaY;
                        newBounds.yMin = Math.max(newBounds.yMin, 0);
                        newBounds.yMin = Math.min(newBounds.yMin, parentHeight - oldBounds.getHeight());
                        newBounds.yMax = newBounds.yMin + oldBounds.getHeight(); // preserve height
                    }
                    var newState;
                    if (this.props.percentageMode) {
                        newBounds.xMin = Math.round(100 * newBounds.xMin / parentWidth);
                        newBounds.yMin = Math.round(100 * newBounds.yMin / parentHeight);
                        var width, height;
                        if (this.moving) {
                            // preserve original width and height while moving
                            width = Math.round(100 * oldBounds.getWidth() / parentWidth);
                            height = Math.round(100 * oldBounds.getHeight() / parentHeight);
                        } else {
                            newBounds.xMax = Math.round(100 * newBounds.xMax / parentWidth);
                            newBounds.yMax = Math.round(100 * newBounds.yMax / parentHeight);
                            width = newBounds.getWidth();
                            height = newBounds.getHeight();
                        }
                        newState = {
                            left: newBounds.xMin + '%',
                            top: newBounds.yMin + '%',
                            width: width + '%',
                            height: height + '%'
                        };
                    } else {
                        newState = {
                            left: newBounds.xMin,
                            top: newBounds.yMin,
                            width: newBounds.getWidth(),
                            height: newBounds.getHeight()
                        };
                    }
                    if (this.shouldLiveUpdate() || forceLiveUpdate) {
                        this.setState(newState);
                        this.updateOverlayStyle({ visibility: "hidden" });
                        if (this.props.onReposition) this.props.onReposition(newState);
                    } else {
                        this.updateOverlayStyle(newState, { visibility: "visible", minWidth: minWidth, minHeight: minHeight });
                    }
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    var document = ReactUtils.getDocument(this);
                    document.removeEventListener("mouseup", this.onDragEnd, true);
                    document.removeEventListener("mousemove", this.onDrag, true);
                }
            }, {
                key: "renderResizers",
                value: function renderResizers() {
                    var _this82 = this;

                    var n = 5;
                    var nnnn = n * 4;
                    //TODO fix type
                    var items = [
                    // sides
                    [Handle.LEFT, 'ew-resize', { left: 0, width: n, top: nnnn, bottom: nnnn }], [Handle.RIGHT, 'ew-resize', { right: 0, width: n, top: nnnn, bottom: nnnn }], [Handle.TOP, 'ns-resize', { top: 0, height: n, left: nnnn, right: nnnn }], [Handle.BOTTOM, 'ns-resize', { bottom: 0, height: n, left: nnnn, right: nnnn }],
                    // horizontal boxes in corners
                    [Handle.TOP | Handle.LEFT, 'nwse-resize', { left: 0, width: nnnn, top: 0, height: n }], [Handle.TOP | Handle.RIGHT, 'nesw-resize', { right: 0, width: nnnn, top: 0, height: n }], [Handle.BOTTOM | Handle.LEFT, 'nesw-resize', { left: 0, width: nnnn, bottom: 0, height: n }], [Handle.BOTTOM | Handle.RIGHT, 'nwse-resize', { right: 0, width: nnnn, bottom: 0, height: n }],
                    // vertical boxes in corners
                    [Handle.TOP | Handle.LEFT, 'nwse-resize', { left: 0, width: n, top: 0, height: nnnn }], [Handle.TOP | Handle.RIGHT, 'nesw-resize', { right: 0, width: n, top: 0, height: nnnn }], [Handle.BOTTOM | Handle.LEFT, 'nesw-resize', { left: 0, width: n, bottom: 0, height: nnnn }], [Handle.BOTTOM | Handle.RIGHT, 'nwse-resize', { right: 0, width: n, bottom: 0, height: nnnn }]];
                    return items.map(function (_ref11, index) {
                        var _ref12 = _slicedToArray(_ref11, 3),
                            handle = _ref12[0],
                            cursor = _ref12[1],
                            style = _ref12[2];

                        return React.createElement("div", { key: index, onMouseDown: function onMouseDown(event) {
                                return _this82.onResizeStart(event, handle);
                            }, style: _.merge({ position: "absolute", cursor: cursor }, style) });
                    });
                }
            }, {
                key: "render",
                value: function render() {
                    var _this83 = this;

                    var content = React.createElement(
                        VBox,
                        _extends({ overflow: true, draggable: true }, this.props, { onDragStart: this.onDragStart, style: _.merge({ position: "absolute" }, this.props.style, this.state), ref: function ref(c) {
                                return _this83.element = ReactDOM.findDOMNode(c);
                            } }),
                        this.props.children,
                        this.props.resizable ? this.renderResizers() : null
                    );
                    if (!this.props.getExternalOverlay && (this.props.liveMoving || this.props.liveResizing)) return React.createElement(
                        "div",
                        null,
                        content,
                        React.createElement(Div, { ref: function ref(c) {
                                _this83.internalOverlay = c;
                            }, style: this.overlayStyle })
                    );
                    return content;
                }
            }, {
                key: "externalOverlay",
                get: function get() {
                    return this.props.getExternalOverlay ? this.props.getExternalOverlay() : null;
                }
            }, {
                key: "overlay",
                get: function get() {
                    return this.externalOverlay || this.internalOverlay;
                }
            }]);

            return DraggableDiv;
        }(SmartComponent);

        DraggableDiv.defaultProps = {
            resizable: true,
            movable: true,
            liveMoving: true,
            liveResizing: true,
            percentageMode: true
        };
        ui.DraggableDiv = DraggableDiv;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var ReactUtils = weavejs.util.ReactUtils;
        var DraggableDiv = weavejs.ui.DraggableDiv;
        var Popup = weavejs.ui.Popup;
        var KeyboardUtils = weavejs.util.KeyboardUtils;
        var HBox = weavejs.ui.flexbox.HBox;
        var VBox = weavejs.ui.flexbox.VBox;
        var SmartComponent = weavejs.ui.SmartComponent;
        var prefixer = weavejs.css.prefixer;
        var Button = weavejs.ui.Button;
        var ContextMenu = weavejs.ui.menu.ContextMenu;

        var PopupWindow = function (_SmartComponent11) {
            _inherits(PopupWindow, _SmartComponent11);

            function PopupWindow(props) {
                _classCallCheck(this, PopupWindow);

                var _this84 = _possibleConstructorReturn(this, (PopupWindow.__proto__ || Object.getPrototypeOf(PopupWindow)).call(this, props));

                _this84.minWidth = 320;
                _this84.minHeight = 240;
                _this84.onKeyDown = function (event) {
                    var code = event.keyCode;
                    if (code == KeyboardUtils.KEYCODES.ENTER && _this84.props.modal && !_this84.props.suspendEnter && ReactUtils.hasFocus(_this84)) _this84.onOk();else if (code == KeyboardUtils.KEYCODES.ESC && _this84.props.modal && !_this84.props.suspendEnter && ReactUtils.hasFocus(_this84)) _this84.onCancel();
                };
                _this84.state = {};
                return _this84;
            }

            _createClass(PopupWindow, [{
                key: "bringToFront",
                value: function bringToFront() {
                    Popup.bringToFront(this.popup);
                }
            }, {
                key: "componentDidMount",
                value: function componentDidMount() {
                    ReactUtils.getDocument(this).addEventListener("keydown", this.onKeyDown);
                }
            }, {
                key: "componentWillUnmount",
                value: function componentWillUnmount() {
                    ReactUtils.getDocument(this).removeEventListener("keydown", this.onKeyDown);
                }
            }, {
                key: "onOk",
                value: function onOk() {
                    if (this.props.onOk) this.props.onOk();
                    this.close();
                }
            }, {
                key: "onCancel",
                value: function onCancel() {
                    if (this.props.onCancel) this.props.onCancel();
                    this.close();
                }
                /**
                 * Given an Element or React Component, uses ReactUtils.findComponent() to find the enclosing PopupWindow and close it.
                 */

            }, {
                key: "close",
                value: function close() {
                    if (this.props.onClose) this.props.onClose();
                    Popup.close(this.popup);
                }
            }, {
                key: "renderOverlay",
                value: function renderOverlay(modal) {
                    var style = {
                        position: "fixed",
                        width: "100%",
                        height: "100%",
                        top: 0,
                        left: 0
                    };
                    var className;
                    if (modal) className = "weave-dialog-overlay";
                    return React.createElement("div", { style: style, className: className });
                }
            }, {
                key: "render",
                value: function render() {
                    var _this85 = this;

                    var windowStyle = {
                        top: this.props.top,
                        left: this.props.left,
                        width: this.props.width,
                        height: this.props.height,
                        minWidth: this.minWidth,
                        minHeight: this.minHeight
                    };
                    var popupWindow = React.createElement(
                        DraggableDiv,
                        { style: windowStyle, className: "weave-window", draggable: false, resizable: this.props.resizable, onMouseDown: function onMouseDown() {
                                Popup.bringToFront(_this85.popup);
                            } },
                        this.props.title ? React.createElement(
                            HBox,
                            { className: "weave-header weave-window-header", draggable: this.props.draggable },
                            React.createElement(
                                "div",
                                { style: { flex: 1 } },
                                this.props.title
                            ),
                            React.createElement("i", { className: "ui close icon", onClick: this.onCancel.bind(this) })
                        ) : null,
                        React.createElement(
                            VBox,
                            { className: "weave-padded-vbox weave-window-content", style: { flex: 1 } },
                            React.createElement(
                                VBox,
                                { style: { flex: 1, overflow: "auto" } },
                                this.state.content || this.props.content,
                                this.props.children
                            ),
                            this.props.footerContent ? React.createElement(
                                HBox,
                                { className: "weave-window-footer" },
                                this.props.footerContent
                            ) : React.createElement(
                                HBox,
                                { className: "weave-window-footer" },
                                React.createElement(
                                    HBox,
                                    { className: "weave-padded-hbox", style: prefixer({ flex: 1, justifyContent: "flex-end" }) },
                                    React.createElement(
                                        Button,
                                        { colorClass: "primary", onClick: this.onOk.bind(this) },
                                        Weave.lang(this.props.modal ? "Ok" : "Done")
                                    ),
                                    this.props.modal ? React.createElement(
                                        Button,
                                        { colorClass: "secondary", onClick: this.onCancel.bind(this), style: { marginLeft: 8 } },
                                        Weave.lang("Cancel")
                                    ) : null
                                )
                            )
                        )
                    );
                    return React.createElement(
                        "div",
                        { ref: ReactUtils.registerComponentRef(this), onContextMenu: ContextMenu.open },
                        this.props.modal ? this.renderOverlay(this.props.modal) : null,
                        popupWindow
                    );
                }
            }], [{
                key: "open",
                value: function open(props) {
                    // set active window to non active
                    var popupWindow = null;
                    var popup = Popup.open(props.context, React.createElement(PopupWindow, _extends({}, props, { ref: function ref(c) {
                            return popupWindow = c;
                        } })));
                    popupWindow.popup = popup;
                    return popupWindow;
                }
            }, {
                key: "generateOpener",
                value: function generateOpener(propsGetter) {
                    var popup;
                    return function () {
                        if (popup) popup.bringToFront();else {
                            var props = propsGetter();
                            popup = PopupWindow.open(_.merge({}, props, {
                                onClose: function onClose() {
                                    if (props.onClose) props.onClose();
                                    popup = null;
                                }
                            }));
                        }
                        return popup;
                    };
                }
            }, {
                key: "close",
                value: function close(instance) {
                    var popup = ReactUtils.findComponent(instance, PopupWindow);
                    if (popup) popup.close();
                }
            }]);

            return PopupWindow;
        }(SmartComponent);

        PopupWindow.defaultProps = {
            resizable: true,
            draggable: true,
            suspendEnter: false
        };
        ui.PopupWindow = PopupWindow;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var StandardLib = weavejs.util.StandardLib;
        var LinkableVariable = weavejs.core.LinkableVariable;
        var ILinkableVariable = weavejs.api.core.ILinkableVariable;
        var ICallbackCollection = weavejs.api.core.ICallbackCollection;
        var IDisposableObject = weavejs.api.core.IDisposableObject;
        var Bounds2D = weavejs.geom.Bounds2D;
        /**
         * This is a linkable version of a Bounds2D object.
         *
         * @author adufilie
         */
        var LinkableBounds2D_1 = void 0;
        var LinkableBounds2D = LinkableBounds2D_1 = function (_LinkableVariable3) {
            _inherits(LinkableBounds2D, _LinkableVariable3);

            function LinkableBounds2D() {
                _classCallCheck(this, LinkableBounds2D);

                return _possibleConstructorReturn(this, (LinkableBounds2D.__proto__ || Object.getPrototypeOf(LinkableBounds2D)).apply(this, arguments));
            }

            _createClass(LinkableBounds2D, [{
                key: "setBounds",
                value: function setBounds(xMin, yMin, xMax, yMax) {
                    LinkableBounds2D_1.tempBounds.setBounds(xMin, yMin, xMax, yMax);
                    this.setSessionState(LinkableBounds2D_1.tempBounds);
                }
            }, {
                key: "copyFrom",
                value: function copyFrom(sourceBounds) {
                    LinkableBounds2D_1.tempBounds.copyFrom(sourceBounds);
                    this.setSessionState(LinkableBounds2D_1.tempBounds);
                }
            }, {
                key: "copyTo",
                value: function copyTo(destinationBounds) {
                    LinkableBounds2D_1.tempBounds.reset();
                    this.detectChanges();
                    if (this._sessionStateInternal && _typeof(this._sessionStateInternal) == 'object') {
                        LinkableBounds2D_1.tempBounds.xMin = StandardLib.asNumber(this._sessionStateInternal.xMin);
                        LinkableBounds2D_1.tempBounds.yMin = StandardLib.asNumber(this._sessionStateInternal.yMin);
                        LinkableBounds2D_1.tempBounds.xMax = StandardLib.asNumber(this._sessionStateInternal.xMax);
                        LinkableBounds2D_1.tempBounds.yMax = StandardLib.asNumber(this._sessionStateInternal.yMax);
                    }
                    destinationBounds.copyFrom(LinkableBounds2D_1.tempBounds);
                }
            }]);

            return LinkableBounds2D;
        }(LinkableVariable);
        LinkableBounds2D.tempBounds = new Bounds2D(); // reusable temporary object
        LinkableBounds2D = LinkableBounds2D_1 = __decorate([Weave.classInfo({ id: "weavejs.geom.LinkableBounds2D", interfaces: [ILinkableVariable, ICallbackCollection, IDisposableObject] })], LinkableBounds2D);
        geom.LinkableBounds2D = LinkableBounds2D;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var StandardLib = weavejs.util.StandardLib;
        var Bounds2D = weavejs.geom.Bounds2D;
        /**
         * This is an all-static class for building Binary Line Generalization Trees.
         *
         * @author adufilie
         */

        var BLGTreeUtils = function () {
            function BLGTreeUtils() {
                _classCallCheck(this, BLGTreeUtils);
            }

            _createClass(BLGTreeUtils, null, [{
                key: "buildBLGTree",
                value: function buildBLGTree(vertexChain, output) {
                    var method = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    switch (method) {
                        default:
                        case BLGTreeUtils.METHOD_SORT:
                            return BLGTreeUtils.buildBLGTreeSortMethod(vertexChain, output);
                        case BLGTreeUtils.METHOD_SAMPLE:
                            return BLGTreeUtils.buildBLGTreeSampleMethod(vertexChain, output);
                    }
                }
                /**
                 * Sorts points by importance value, removes least important points first.
                 * @param firstVertex The first vertex in a chain.
                 * @param outputCoordinates The BLGTree to store the processed points in.
                 */

            }, {
                key: "buildBLGTreeSortMethod",
                value: function buildBLGTreeSortMethod(firstVertex, outputCoordinates) {
                    var startingChainLength = 0;
                    // get the bounding box of the chain
                    var vertex = firstVertex;
                    BLGTreeUtils.tempBounds.reset();
                    do {
                        BLGTreeUtils.tempBounds.includeCoords(vertex.x, vertex.y);
                        startingChainLength++; // keep track of the length of the chain
                        vertex = vertex.next;
                    } while (vertex != firstVertex);
                    // calculate the maximum possible importance of vertices in this chain
                    var maxImportance = BLGTreeUtils.tempBounds.getArea();
                    if (maxImportance == 0) {
                        var length = BLGTreeUtils.tempBounds.getWidth() + BLGTreeUtils.tempBounds.getHeight();
                        if (length > 0) maxImportance = length * length;else maxImportance = Infinity; // a single point
                    }
                    // begin removing vertices
                    var minSize = 2; // geomType == GEOM_TYPE_POLYGON ? 3 : 2;
                    var sortArray = [];
                    var index;
                    var currentChainLength = startingChainLength;
                    while (startingChainLength > minSize) {
                        // validate importance of vertices, then sort by importance
                        sortArray.length = startingChainLength;
                        vertex = firstVertex;
                        for (index = 0; index < startingChainLength; index++) {
                            vertex.validateImportance();
                            sortArray[index] = vertex;
                            vertex = vertex.next;
                        }
                        StandardLib.sortOn(sortArray, geom.VertexChainLink.IMPORTANCE);
                        // in sorted order, extract each point as long as its
                        // surrounding points have not been invalidated
                        for (index = 0; index < startingChainLength && currentChainLength > minSize; index++) {
                            vertex = sortArray[index];
                            // skip vertices whose importance needs to be updated
                            if (!vertex.importanceIsValid) continue;
                            // set firstVertex to next one to make sure next loop iteration will work
                            firstVertex = vertex.next;
                            // extract this vertex, invalidating adjacent vertices
                            outputCoordinates.insert(vertex.vertexID, vertex.importance, vertex.x, vertex.y);
                            vertex.removeFromChain();
                            currentChainLength--;
                        }
                        // prepare for next loop iteration
                        startingChainLength = currentChainLength;
                    }
                    // remaining vertices are required for displaying this shape
                    // extract remaining points, setting importance value
                    for (index = 0; index < startingChainLength; index++) {
                        vertex = firstVertex.next;
                        outputCoordinates.insert(vertex.vertexID, maxImportance, vertex.x, vertex.y);
                        vertex.removeFromChain();
                    }
                }
            }, {
                key: "buildBLGTreeSampleMethod",
                value: function buildBLGTreeSampleMethod(firstVertex, output) {
                    var sampleInterval = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 3;

                    var tree = output;
                    var vertex = firstVertex;
                    var chainLength = 0;
                    // get the bounding box of the chain
                    do {
                        chainLength++; //determine lenfth of chain
                        vertex = vertex.next;
                    } while (vertex != firstVertex);
                    while (chainLength != 0) {
                        for (var i = 0; i < sampleInterval - 1; i++) {
                            vertex = vertex.next;
                        }vertex.next.validateImportance();
                        output.insert(vertex.next.vertexID, vertex.next.importance, vertex.next.x, vertex.next.y);
                        vertex.next.removeFromChain();
                        chainLength--;
                    }
                }
            }]);

            return BLGTreeUtils;
        }();

        BLGTreeUtils.METHOD_SORT = "BLGTreeUtils.METHOD_SORT";
        BLGTreeUtils.METHOD_SAMPLE = "BLGTreeUtils.METHOD_SAMPLE";
        /**
         * Reusable temporary object, helps reduce garbage collection activity.
         */
        BLGTreeUtils.tempBounds = new Bounds2D();
        geom.BLGTreeUtils = BLGTreeUtils;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * An interface for an object that reprojects points from one specific coordinate system to another.
             *
             * @author adufilie
             */
            var IProjector = function IProjector() {
                _classCallCheck(this, IProjector);
            };
            IProjector = __decorate([Weave.classInfo({ id: "weavejs.api.data.IProjector" })], IProjector);
            data.IProjector = IProjector;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom) {
        var Rectangle = function Rectangle() {
            var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NaN;
            var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : NaN;
            var width = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : NaN;
            var height = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : NaN;

            _classCallCheck(this, Rectangle);

            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
        };

        geom.Rectangle = Rectangle;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            /**
             * Instances of the ShpError class are thrown from the SHP library classes
             * on encountering errors.
             * @author Edwin van Rijkom
             */
            var ShpError = function (_Error) {
                _inherits(ShpError, _Error);

                /**
                 * Constructor.
                 * @param msg
                 * @param id
                 * @return
                 *
                 */
                function ShpError(msg) {
                    var id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                    _classCallCheck(this, ShpError);

                    var _this87 = _possibleConstructorReturn(this, (ShpError.__proto__ || Object.getPrototypeOf(ShpError)).call(this, msg));

                    _this87.errorID = id;
                    return _this87;
                }

                return ShpError;
            }(Error);
            /**
             * Defines the identifier value of an undefined error.
             */


            ShpError.ERROR_UNDEFINED = 0;
            /**
             * Defines the identifier value of a 'no data' error, which is thrown
             * when a ByteArray runs out of data.
             */
            ShpError.ERROR_NODATA = 1;
            shp.ShpError = ShpError;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            var ShpObject = org.vanrijkom.shp.ShpObject;
            var ShpError = org.vanrijkom.shp.ShpError;
            var ShpType = org.vanrijkom.shp.ShpType;
            /**
             * The ShpPoint class parses an ESRI Shapefile Point record from a ByteArray.
             * @author Edwin van Rijkom
             *
             */

            var ShpPoint = function (_ShpObject) {
                _inherits(ShpPoint, _ShpObject);

                function ShpPoint() {
                    var src = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                    var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                    _classCallCheck(this, ShpPoint);

                    var _this88 = _possibleConstructorReturn(this, (ShpPoint.__proto__ || Object.getPrototypeOf(ShpPoint)).call(this));

                    _this88.type = ShpType.SHAPE_POINTZ;
                    if (src) {
                        if (src.length - src.position < size) throw new ShpError("Not a Point record (to small)");
                        _this88.x = size > 0 ? src.readDouble() : NaN;
                        _this88.y = size > 8 ? src.readDouble() : NaN;
                    }
                    //trace("Point", x,y);		
                    return _this88;
                }

                return ShpPoint;
            }(ShpObject);

            shp.ShpPoint = ShpPoint;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            var Rectangle = weavejs.geom.Rectangle;
            var ShpPoint = org.vanrijkom.shp.ShpPoint;
            var ShpObject = org.vanrijkom.shp.ShpObject;
            var ShpType = org.vanrijkom.shp.ShpType;
            var ShpError = org.vanrijkom.shp.ShpError;
            /**
             * The ShpPoint class parses an ESRI Shapefile Polygon record from a ByteArray.
             * @author Edwin van Rijkom
             *
             */

            var ShpPolygon = function (_ShpObject2) {
                _inherits(ShpPolygon, _ShpObject2);

                /**
                 * Constructor.
                 * @param src
                 * @param size
                 * @return
                 * @throws org.vanrijkom.shp.ShpError Not a Polygon record
                 */
                function ShpPolygon() {
                    var src = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                    var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                    _classCallCheck(this, ShpPolygon);

                    var _this89 = _possibleConstructorReturn(this, (ShpPolygon.__proto__ || Object.getPrototypeOf(ShpPolygon)).call(this));

                    _this89.type = ShpType.SHAPE_POLYGON;
                    _this89.rings = [];
                    if (src) {
                        if (src.length - src.position < size) throw new ShpError("Not a Polygon record (to small)");
                        src.littleEndian = true;
                        _this89.box = new Rectangle(src.readDouble(), src.readDouble(), src.readDouble(), src.readDouble());
                        var rc = src.readInt();
                        var pc = src.readInt();
                        var ringOffsets = [];
                        while (rc--) {
                            ringOffsets.push(src.readInt());
                        }
                        var points = [];
                        while (pc--) {
                            points.push(new ShpPoint(src, 16));
                        }
                        // convert points, and ringOffsets arrays to an array of rings:
                        var removed = 0;
                        var split;
                        ringOffsets.shift();
                        while (ringOffsets.length) {
                            split = ringOffsets.shift();
                            _this89.rings.push(points.splice(0, split - removed));
                            removed = split;
                        }
                        _this89.rings.push(points);
                    }
                    return _this89;
                }

                return ShpPolygon;
            }(ShpObject);

            shp.ShpPolygon = ShpPolygon;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package;
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            var ShpPolygon = org.vanrijkom.shp.ShpPolygon;
            /**
             * The ShpPoint class parses an ESRI Shapefile Polyline record from a ByteArray.
             * @author Edwin van Rijkom
             *
             */

            var ShpPolyline = function (_ShpPolygon) {
                _inherits(ShpPolyline, _ShpPolygon);

                /**
                 * Constructor.
                 * @param src
                 * @param size
                 * @return
                 *
                 */
                function ShpPolyline() {
                    var src = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                    var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                    _classCallCheck(this, ShpPolyline);

                    var _this90 = _possibleConstructorReturn(this, (ShpPolyline.__proto__ || Object.getPrototypeOf(ShpPolyline)).call(this, src, size));

                    _this90.type = shp.ShpType.SHAPE_POLYLINE;
                    return _this90;
                }

                return ShpPolyline;
            }(ShpPolygon);

            shp.ShpPolyline = ShpPolyline;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package;
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            var ShpPoint = org.vanrijkom.shp.ShpPoint;
            var ShpType = org.vanrijkom.shp.ShpType;
            /**
             * The ShpPointZ class parses an ESRI Shapefile PointZ record from a ByteArray.
             * @author Edwin van Rijkom
             *
             */

            var ShpPointZ = function (_ShpPoint) {
                _inherits(ShpPointZ, _ShpPoint);

                /**
                 * Constructor
                 * @param src
                 * @param size
                 * @return
                 *
                 */
                function ShpPointZ() {
                    var src = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                    var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                    _classCallCheck(this, ShpPointZ);

                    var _this91 = _possibleConstructorReturn(this, (ShpPointZ.__proto__ || Object.getPrototypeOf(ShpPointZ)).call(this));

                    _this91.type = ShpType.SHAPE_POINT;
                    if (src) {
                        _this91.z = size > 16 ? src.readDouble() : NaN;
                        _this91.m = size > 24 ? src.readDouble() : NaN;
                    }
                    return _this91;
                }

                return ShpPointZ;
            }(ShpPoint);

            shp.ShpPointZ = ShpPointZ;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            var ShpPointZ = org.vanrijkom.shp.ShpPointZ;
            var ShpError = org.vanrijkom.shp.ShpError;
            var ShpPoint = org.vanrijkom.shp.ShpPoint;
            var ShpPolygon = org.vanrijkom.shp.ShpPolygon;
            var ShpType = org.vanrijkom.shp.ShpType;
            var ShpPolyline = org.vanrijkom.shp.ShpPolyline;
            /**
            * The ShpPoint class parses an ESRI Shapefile Record Header from a ByteArray
            * as well as its associated Shape Object. The parsed object is stored as a
            * ShpObject that can be cast to a specialized ShpObject deriving class using
            * the found shapeType value.
            * @author Edwin van Rijkom
            *
            */

            var ShpRecord =
            /**
             * Constructor.
             * @param src
             * @return
             * @throws org.vanrijkom.shp.ShpError Not a valid header
             * @throws Shape type is currently unsupported by this library
             * @throws Encountered unknown shape type
             *
             */
            function ShpRecord(src) {
                _classCallCheck(this, ShpRecord);

                var availableBytes = src.length - src.position;
                if (availableBytes == 0) throw new ShpError("", ShpError.ERROR_NODATA);
                if (src.length - src.position < 8) throw new ShpError("Not a valid record header (too small)");
                src.littleEndian = false;
                this.number = src.readInt();
                this.contentLength = src.readInt();
                this.contentLengthBytes = this.contentLength * 2 - 4;
                src.littleEndian = true;
                var shapeOffset = src.position;
                this.shapeType = src.readInt();
                switch (this.shapeType) {
                    // Added for Weave
                    case ShpType.SHAPE_NULL:
                        break;
                    case ShpType.SHAPE_POINT:
                        this.shape = new ShpPoint(src, this.contentLengthBytes);
                        break;
                    case ShpType.SHAPE_POINTZ:
                        this.shape = new ShpPointZ(src, this.contentLengthBytes);
                        break;
                    case ShpType.SHAPE_POLYGON:
                        this.shape = new ShpPolygon(src, this.contentLengthBytes);
                        break;
                    case ShpType.SHAPE_POLYLINE:
                        this.shape = new ShpPolyline(src, this.contentLengthBytes);
                        break;
                    case ShpType.SHAPE_MULTIPATCH:
                    case ShpType.SHAPE_MULTIPOINT:
                    case ShpType.SHAPE_MULTIPOINTM:
                    case ShpType.SHAPE_MULTIPOINTZ:
                    case ShpType.SHAPE_POINTM:
                    case ShpType.SHAPE_POLYGONM:
                    case ShpType.SHAPE_POLYGONZ:
                    case ShpType.SHAPE_POLYLINEZ:
                    case ShpType.SHAPE_POLYLINEM:
                        throw new ShpError(this.shapeType + " Shape type is currently unsupported by this library");
                    default:
                        throw new ShpError("Encountered unknown shape type (" + this.shapeType + ")");
                }
            };

            shp.ShpRecord = ShpRecord;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            var ShpRecord = org.vanrijkom.shp.ShpRecord;
            var ShpError = org.vanrijkom.shp.ShpError;
            /**
             * The ShpTools class contains static tool methods for working with
             * ESRI Shapefiles.
             * @author Edwin van Rijkom
             *
             */

            var ShpTools = function () {
                function ShpTools() {
                    _classCallCheck(this, ShpTools);
                }

                _createClass(ShpTools, null, [{
                    key: "readRecords",

                    /**
                     * Reads all available ESRI Shape records from the specified ByteArray.
                     * Reading starts at the ByteArrays current offset.
                     *
                     * @param src ByteArray to read ESRI Shape records from.
                     * @return An Array containing zoomero or more ShpRecord typed values.
                     * @see org.vanrijkom.shp.ShpRecord
                     */
                    value: function readRecords(src) {
                        var record;
                        var records = [];
                        while (true) {
                            try {
                                record = new ShpRecord(src);
                                records.push(record);
                            } catch (e) {
                                if (e.errorID == ShpError.ERROR_NODATA) break;else throw e;
                            }
                        }
                        return records;
                    }
                }]);

                return ShpTools;
            }();

            shp.ShpTools = ShpTools;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  SHP (ESRI ShapeFile Reader)												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var shp;
        (function (shp) {
            var ShpError = org.vanrijkom.shp.ShpError;
            var Rectangle = weavejs.geom.Rectangle;
            var Point = weavejs.geom.Point;
            /**
             * The ShpHeader class parses an ESRI Shapefile Header from a ByteArray.
             * @author Edwin van Rijkom
             *
             */

            var ShpHeader =
            /**
             * Constructor.
             * @param src
             * @return
             * @throws vanrijkom.shp.ShpError Not a valid shape file header
             * @throws vanrijkom.shp.ShpError Not a valid signature
             *
             */
            function ShpHeader(src) {
                _classCallCheck(this, ShpHeader);

                // endian:
                src.littleEndian = false;
                // check length:
                if (src.length - src.position < 100) throw new ShpError("Not a valid shape file header (too small)");
                // check signature	
                if (src.readInt() != 9994) throw new ShpError("Not a valid signature. Expected 9994");
                // skip 5 numberegers;
                src.position += 5 * 4;
                // read file-length:
                this.fileLength = src.readInt();
                // switch endian:
                src.littleEndian = true;
                // read version:
                this.version = src.readInt();
                // read shape-type:
                this.shapeType = src.readInt();
                // read bounds:
                this.boundsXY = new Rectangle(src.readDouble(), src.readDouble(), src.readDouble(), src.readDouble());
                this.boundsZ = new Point(src.readDouble(), src.readDouble());
                this.boundsM = new Point(src.readDouble(), src.readDouble());
            };

            shp.ShpHeader = ShpHeader;
        })(shp = vanrijkom.shp || (vanrijkom.shp = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom_4) {
        var ShpHeader = org.vanrijkom.shp.ShpHeader;
        var ShpPoint = org.vanrijkom.shp.ShpPoint;
        var ShpPolygon = org.vanrijkom.shp.ShpPolygon;
        var ShpPolyline = org.vanrijkom.shp.ShpPolyline;
        var ShpTools = org.vanrijkom.shp.ShpTools;
        var WeaveAPI = weavejs.WeaveAPI;
        var GeneralizedGeometry = weavejs.geom.GeneralizedGeometry;
        var GeometryType = weavejs.geom.GeometryType;
        /**
         * The callbacks for this object get called when all queued decoding completes.
         *
         * @author adufilie
         * @author awilkins
         */

        var ShpFileReader = function () {
            function ShpFileReader(shpData) {
                _classCallCheck(this, ShpFileReader);

                this.irecord = 0;
                this.geoms = [];
                this._processingIsDone = false;
                this.shp = new ShpHeader(shpData);
                this.records = ShpTools.readRecords(shpData);
                // high priority because not much can be done without data
                WeaveAPI.Scheduler.startTask(this, this.iterate, WeaveAPI.TASK_PRIORITY_HIGH, this.asyncComplete);
            }

            _createClass(ShpFileReader, [{
                key: "iterate",
                value: function iterate(stopTime) {
                    for (; this.irecord < this.records.length; this.irecord++) {
                        if (Date.now() > stopTime) return this.irecord / this.records.length;
                        var iring;
                        var ipoint;
                        var point;
                        var ring;
                        //trace( irecord, records.length );
                        var geom = new GeneralizedGeometry();
                        var points = [];
                        var record = this.records[this.irecord];
                        if (Weave.IS(record.shape, ShpPolygon)) {
                            geom.geomType = GeometryType.POLYGON;
                            var poly = Weave.AS(record.shape, ShpPolygon);
                            for (iring = 0; iring < poly.rings.length; iring++) {
                                // add part marker if this is not the first part
                                if (iring > 0) points.push(NaN, NaN);
                                ring = poly.rings[iring];
                                for (ipoint = 0; ipoint < ring.length; ipoint++) {
                                    point = Weave.AS(ring[ipoint], ShpPoint);
                                    points.push(point.x, point.y);
                                }
                            }
                        }
                        if (Weave.IS(record.shape, ShpPolyline)) geom.geomType = GeometryType.LINE;
                        if (Weave.IS(record.shape, ShpPoint)) {
                            geom.geomType = GeometryType.POINT;
                            point = Weave.AS(record.shape, ShpPoint);
                            points.push(point.x, point.y);
                        }
                        if (points) geom.setCoordinates(points, geom_4.BLGTreeUtils.METHOD_SAMPLE);
                        this.geoms.push(geom);
                    }
                    return 1;
                }
            }, {
                key: "asyncComplete",
                value: function asyncComplete() {
                    this._processingIsDone = true;
                    Weave.getCallbacks(this).triggerCallbacks();
                }
            }, {
                key: "geomsReady",
                get: function get() {
                    return this._processingIsDone;
                }
            }]);

            return ShpFileReader;
        }();

        ShpFileReader.WEAVE_INFO = Weave.setClassInfo(ShpFileReader, {
            id: "weavejs.geom.ShpFileReader"
        });
        geom_4.ShpFileReader = ShpFileReader;
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ************************************************************************ */
/*																			*/
/*  DBF (XBase File Reader) 												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var dbf;
        (function (dbf) {
            /**
             * Instances of the DbfError class are thrown from the DBF library classes
             * on encountering errors.
             * @author Edwin van Rijkom
             *
             */
            var DbfError = function (_Error2) {
                _inherits(DbfError, _Error2);

                function DbfError(msg) {
                    var id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                    _classCallCheck(this, DbfError);

                    var _this92 = _possibleConstructorReturn(this, (DbfError.__proto__ || Object.getPrototypeOf(DbfError)).call(this, msg));

                    _this92.errorID = id;
                    return _this92;
                }

                return DbfError;
            }(Error);
            /**
             * Defines the identifier value of an undefined error.
             */


            DbfError.ERROR_UNDEFINED = 0;
            /**
             * Defines the identifier value of a 'out of bounds' error, which is thrown
             * when an invalid item index is passed.
             */
            DbfError.ERROR_OUTOFBOUNDS = 1;
            dbf.DbfError = DbfError;
        })(dbf = vanrijkom.dbf || (vanrijkom.dbf = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  DBF (XBase File Reader) 												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var dbf;
        (function (dbf) {
            /**
             * The DbfRecord class parses a record from a DBF file loade to a ByteArray.
             * To do so it requires a DbfHeader instance previously read from the
             * ByteArray.
             * @author Edwin van Rijkom
             * @see vanrijkom.dbf.DbfHeader
             *
             */
            var DbfRecord = function DbfRecord(src, header) {
                _classCallCheck(this, DbfRecord);

                this.offset = src.position;
                this.map_field_value = new Map();
                var _iteratorNormalCompletion29 = true;
                var _didIteratorError29 = false;
                var _iteratorError29 = undefined;

                try {
                    for (var _iterator29 = header.fields[Symbol.iterator](), _step29; !(_iteratorNormalCompletion29 = (_step29 = _iterator29.next()).done); _iteratorNormalCompletion29 = true) {
                        var field = _step29.value;

                        this.map_field_value.set(field.name, src.readUTFBytes(field.length));
                    }
                } catch (err) {
                    _didIteratorError29 = true;
                    _iteratorError29 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion29 && _iterator29.return) {
                            _iterator29.return();
                        }
                    } finally {
                        if (_didIteratorError29) {
                            throw _iteratorError29;
                        }
                    }
                }
            };

            dbf.DbfRecord = DbfRecord;
        })(dbf = vanrijkom.dbf || (vanrijkom.dbf = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  DBF (XBase File Reader) 												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var dbf;
        (function (dbf) {
            var DbfRecord = org.vanrijkom.dbf.DbfRecord;
            var DbfError = org.vanrijkom.dbf.DbfError;
            /**
             * The DbfTools class bundles a utility functions used by the remainder of
             * the DBF library.
             * @author Edwin van Rijkom
             *
             */

            var DbfTools = function () {
                function DbfTools() {
                    _classCallCheck(this, DbfTools);
                }

                _createClass(DbfTools, null, [{
                    key: "readZeroTermANSIString",

                    /**
                     * Read a zero terminated ANSI string from a ByteArray.
                     * @param src ByteArray instance to read from.
                     * @return
                     *
                     */
                    value: function readZeroTermANSIString(src) {
                        var r = "";
                        var b;
                        while (true) {
                            b = src.readUnsignedByte();
                            if (!b) break;
                            r += String.fromCharCode(b);
                        }
                        return r;
                    }
                    /**
                     * Read a fixed length ANSI string from a ByteArray.
                     * @param src ByteArray instance to read from.
                     * @param length Number of character to read.
                     * @return
                     *
                     */

                }, {
                    key: "readANSIString",
                    value: function readANSIString(src, length) {
                        var r = "";
                        while (length--) {
                            r += String.fromCharCode(src.readUnsignedByte());
                        }
                        return r;
                    }
                    /**
                     * Read a DBF record from a DBF file.
                     * @param src ByteArray instance to read from.
                     * @param header DbfHeader instance previously read from the ByteArray.
                     * @param index Index of the record to read.
                     * @return
                     * @see vanrijkom.dbf.DbfHeader
                     *
                     */

                }, {
                    key: "getRecord",
                    value: function getRecord(src, header, index) {
                        if (index > header.recordCount) throw new DbfError("", DbfError.ERROR_OUTOFBOUNDS);
                        src.position = header.recordsOffset + index * header.recordSize;
                        return new DbfRecord(src, header);
                    }
                }]);

                return DbfTools;
            }();

            dbf.DbfTools = DbfTools;
        })(dbf = vanrijkom.dbf || (vanrijkom.dbf = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  DBF (XBase File Reader) 												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var dbf;
        (function (dbf) {
            var DbfTools = org.vanrijkom.dbf.DbfTools;
            /**
             * The DbfField class parses a field definition from a DBF file loaded to a
             * ByteArray.
             * @author Edwin van Rijkom
             *
             */

            var DbfField =
            /**
             * Constructor.
             * @param src
             * @return
             *
             */
            function DbfField(src) {
                _classCallCheck(this, DbfField);

                this.name = DbfTools.readZeroTermANSIString(src);
                // fixed length: 10, so:
                src.position += 10 - this.name.length;
                this.type = src.readUnsignedByte();
                this.address = src.readUnsignedInt();
                this.length = src.readUnsignedByte();
                this.decimals = src.readUnsignedByte();
                // skip 2:
                src.position += 2;
                this.id = src.readUnsignedByte();
                // skip 2:
                src.position += 2;
                this.setFlag = src.readUnsignedByte();
                // skip 7:
                src.position += 7;
                this.indexFlag = src.readUnsignedByte();
            };

            dbf.DbfField = DbfField;
        })(dbf = vanrijkom.dbf || (vanrijkom.dbf = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  DBF (XBase File Reader) 												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var dbf;
        (function (dbf) {
            var DbfField = org.vanrijkom.dbf.DbfField;
            /**
             * The DbfHeader class parses a DBF file loaded to a ByteArray
             * @author Edwin van Rijkom
             *
             */

            var DbfHeader = function () {
                /**
                 * Constructor
                 * @param src
                 * @return
                 *
                 */
                function DbfHeader(src) {
                    _classCallCheck(this, DbfHeader);

                    // endian:
                    src.littleEndian = true;
                    this.version = src.readByte();
                    this.updateYear = 1900 + src.readUnsignedByte();
                    this.updateMonth = src.readUnsignedByte();
                    this.updateDay = src.readUnsignedByte();
                    this.recordCount = src.readUnsignedInt();
                    this.headerSize = src.readUnsignedShort();
                    this.recordSize = src.readUnsignedShort();
                    //skip 2:
                    src.position += 2;
                    this.incompleteTransaction = src.readUnsignedByte();
                    this.encrypted = src.readUnsignedByte();
                    // skip 12:
                    src.position += 12;
                    this.mdx = src.readUnsignedByte();
                    this.language = src.readUnsignedByte();
                    // skip 2;
                    src.position += 2;
                    // iterate field descriptors:
                    this.fields = [];
                    while (src.readByte() != 0X0D) {
                        src.position--;
                        this.fields.push(new DbfField(src));
                    }
                    this._recordsOffset = this.headerSize + 1;
                }

                _createClass(DbfHeader, [{
                    key: "recordsOffset",
                    get: function get() {
                        return this._recordsOffset;
                    }
                }]);

                return DbfHeader;
            }();

            dbf.DbfHeader = DbfHeader;
        })(dbf = vanrijkom.dbf || (vanrijkom.dbf = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ************************************************************************ */
/*																			*/
/*  DBF (XBase File Reader) 												*/
/*  Copyright (c)2007 Edwin van Rijkom										*/
/*  http://www.vanrijkom.org												*/
/*																			*/
/* This library is free software; you can redistribute it and/or			*/
/* modify it under the terms of the GNU Lesser General Public				*/
/* License as published by the Free Software Foundation; either				*/
/* version 2.1 of the License, or (at your option) any later version.		*/
/*																			*/
/* This library is distributed in the hope that it will be useful,			*/
/* but WITHOUT ANY WARRANTY; without even the implied warranty of			*/
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU		*/
/* Lesser General Public License or the LICENSE file for more details.		*/
/*																			*/
/* ************************************************************************ */
var org;
(function (org) {
    var vanrijkom;
    (function (vanrijkom) {
        var dbf;
        (function (dbf) {
            var DbfTools = org.vanrijkom.dbf.DbfTools;
            /**
             * The DbfFilter class is a utility class that allows for collecting records
             * that match on one of the given values for a field.
             * @author Edwin
             *
             */

            var DbfFilter = function () {
                function DbfFilter() {
                    _classCallCheck(this, DbfFilter);
                }

                _createClass(DbfFilter, [{
                    key: "DbfFilter",

                    /**
                     * Constructor.
                     * @param src ByteArray containing the DBF file to filter.
                     * @param header DbfHeader instance previously read from the ByteArray.
                     * @param field Field to filter on.
                     * @param values Array of values to match field against.
                     * @param append If specified, the found records will be added to the specified Array instead of to the instance's matches array.
                     * @return
                     * @see vanrijkom.dbf.DbfHeader
                     *
                     */
                    value: function DbfFilter(src, header, field, values) {
                        var append = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;

                        this.matches = append || [];
                        src.position = header.recordsOffset;
                        var record;
                        var i, j;
                        for (i = 0; i < header.recordCount; i++) {
                            record = DbfTools.getRecord(src, header, i);
                            for (j = 0; j < values.length; j++) {
                                if (record.map_field_value.get(field.toString()).match(values[j])) {
                                    this.matches.push(record);
                                    break;
                                }
                            }
                        }
                    }
                }]);

                return DbfFilter;
            }();

            dbf.DbfFilter = DbfFilter;
        })(dbf = vanrijkom.dbf || (vanrijkom.dbf = {}));
    })(vanrijkom = org.vanrijkom || (org.vanrijkom = {}));
})(org || (org = {})); // package
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This class manages a global list of IQualifiedKey objects.
             *
             * The getQKey() function must be used to get IQualifiedKey objects.  Each IQualifiedKey returned by
             * getQKey() with the same parameters will be the same object, so IQualifiedKeys can be compared
             * with the == operator or used as keys in a Dictionary.
             *
             * @author adufilie
             */
            var IQualifiedKeyManager = function IQualifiedKeyManager() {
                _classCallCheck(this, IQualifiedKeyManager);
            };
            IQualifiedKeyManager = __decorate([Weave.classInfo({ id: "weavejs.api.data.IQualifiedKeyManager" })], IQualifiedKeyManager);
            data.IQualifiedKeyManager = IQualifiedKeyManager;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data_1) {
            var DataTypes = function () {
                function DataTypes() {
                    _classCallCheck(this, DataTypes);
                }

                _createClass(DataTypes, null, [{
                    key: "getClass",

                    /**
                     * Gets the Class associated with a dataType metadata value.
                     * This Class indicates the type of values stored in a column with given dataType metadata value.
                     * @param dataType A dataType metadata value.
                     * @return The associated Class, which can be used to pass to IAttributeColumn.getValueFromKey().
                     * @see weave.api.data.IAttributeColumn#getValueFromKey()
                     */
                    value: function getClass(dataType) {
                        switch (dataType) {
                            case DataTypes.NUMBER:
                                return Number;
                            case DataTypes.DATE:
                                return Date;
                            case DataTypes.GEOMETRY:
                                return Array;
                            default:
                                return String;
                        }
                    }
                    /**
                     * @param data An Array of data values.
                     * @return A dataType metadata value, or null if no data was found.
                     */

                }, {
                    key: "getDataTypeFromData",
                    value: function getDataTypeFromData(data) {
                        var _iteratorNormalCompletion30 = true;
                        var _didIteratorError30 = false;
                        var _iteratorError30 = undefined;

                        try {
                            for (var _iterator30 = (data || [])[Symbol.iterator](), _step30; !(_iteratorNormalCompletion30 = (_step30 = _iterator30.next()).done); _iteratorNormalCompletion30 = true) {
                                var value = _step30.value;

                                if (Weave.IS(value, Number)) return DataTypes.NUMBER;
                                if (Weave.IS(value, Date)) return DataTypes.DATE;
                                if (value != null) return DataTypes.STRING;
                            }
                        } catch (err) {
                            _didIteratorError30 = true;
                            _iteratorError30 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion30 && _iterator30.return) {
                                    _iterator30.return();
                                }
                            } finally {
                                if (_didIteratorError30) {
                                    throw _iteratorError30;
                                }
                            }
                        }

                        return null;
                    }
                }]);

                return DataTypes;
            }();

            DataTypes.NUMBER = "number";
            DataTypes.STRING = "string";
            DataTypes.DATE = "date";
            DataTypes.GEOMETRY = "geometry";
            DataTypes.ALL_TYPES = [DataTypes.NUMBER, DataTypes.STRING, DataTypes.DATE, DataTypes.GEOMETRY];
            data_1.DataTypes = DataTypes;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            /**
             * This is an interface to an object that decides which IQualifiedKey objects are included in a set or not.
             *
             * @author adufilie
             */
            var IKeyFilter = function (_ILinkableObject4) {
                _inherits(IKeyFilter, _ILinkableObject4);

                function IKeyFilter() {
                    _classCallCheck(this, IKeyFilter);

                    return _possibleConstructorReturn(this, (IKeyFilter.__proto__ || Object.getPrototypeOf(IKeyFilter)).apply(this, arguments));
                }

                return IKeyFilter;
            }(ILinkableObject);
            IKeyFilter = __decorate([Weave.classInfo({ id: "weavejs.api.data.IKeyFilter" })], IKeyFilter);
            data.IKeyFilter = IKeyFilter;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key) {
            var IDynamicKeyFilter = weavejs.api.data.IDynamicKeyFilter;
            var IKeyFilter = weavejs.api.data.IKeyFilter;
            var LinkableDynamicObject = weavejs.core.LinkableDynamicObject;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var ILinkableDynamicObject = weavejs.api.core.ILinkableDynamicObject;
            var IDisposableObject = weavejs.api.core.IDisposableObject;
            /**
             * This is a wrapper for a dynamically created object implementing IKeyFilter.
             *
             * @author adufilie
             */
            var DynamicKeyFilter = function (_LinkableDynamicObjec) {
                _inherits(DynamicKeyFilter, _LinkableDynamicObjec);

                function DynamicKeyFilter() {
                    _classCallCheck(this, DynamicKeyFilter);

                    return _possibleConstructorReturn(this, (DynamicKeyFilter.__proto__ || Object.getPrototypeOf(DynamicKeyFilter)).call(this, IKeyFilter));
                }

                _createClass(DynamicKeyFilter, [{
                    key: "getInternalKeyFilter",
                    value: function getInternalKeyFilter() {
                        return Weave.AS(this.internalObject, IKeyFilter);
                    }
                }]);

                return DynamicKeyFilter;
            }(LinkableDynamicObject);
            DynamicKeyFilter = __decorate([Weave.classInfo({ id: "weavejs.data.key.DynamicKeyFilter", interfaces: [IDynamicKeyFilter, ILinkableDynamicObject, ICallbackCollection, IDisposableObject] })], DynamicKeyFilter);
            key.DynamicKeyFilter = DynamicKeyFilter;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an extension of IKeyFilter that adds a complete list of the IQualifiedKey objects contained in the key set.
             *
             * @author adufilie
             */
            var IKeySet = function (_data$IKeyFilter) {
                _inherits(IKeySet, _data$IKeyFilter);

                function IKeySet() {
                    _classCallCheck(this, IKeySet);

                    return _possibleConstructorReturn(this, (IKeySet.__proto__ || Object.getPrototypeOf(IKeySet)).apply(this, arguments));
                }

                return IKeySet;
            }(data.IKeyFilter);
            IKeySet = __decorate([Weave.classInfo({ id: "weavejs.api.data.IKeySet" })], IKeySet);
            data.IKeySet = IKeySet;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key) {
            var IKeySet = weavejs.api.data.IKeySet;
            var LinkableDynamicObject = weavejs.core.LinkableDynamicObject;
            var IDynamicKeyFilter = weavejs.api.data.IDynamicKeyFilter;
            var ILinkableDynamicObject = weavejs.api.core.ILinkableDynamicObject;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IDisposableObject = weavejs.api.core.IDisposableObject;
            /**
             * This is a wrapper for a dynamically created object implementing IKeySet.
             *
             * @author adufilie
             */
            var DynamicKeySet = function (_LinkableDynamicObjec2) {
                _inherits(DynamicKeySet, _LinkableDynamicObjec2);

                function DynamicKeySet() {
                    _classCallCheck(this, DynamicKeySet);

                    return _possibleConstructorReturn(this, (DynamicKeySet.__proto__ || Object.getPrototypeOf(DynamicKeySet)).call(this, IKeySet));
                }

                _createClass(DynamicKeySet, [{
                    key: "getInternalKeySet",
                    value: function getInternalKeySet() {
                        return Weave.AS(this.internalObject, IKeySet);
                    }
                }]);

                return DynamicKeySet;
            }(LinkableDynamicObject);
            DynamicKeySet = __decorate([Weave.classInfo({ id: "weavejs.data.key.DynamicKeySet", interfaces: [IDynamicKeyFilter, ILinkableDynamicObject, ICallbackCollection, IDisposableObject] })], DynamicKeySet);
            key.DynamicKeySet = DynamicKeySet;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * Constants associated with different aggregation methods.
             * @see weave.api.data.ColumnMetadata
             */
            var Aggregation = function Aggregation() {
                _classCallCheck(this, Aggregation);
            };

            Aggregation.SAME = "same";
            Aggregation.FIRST = "first";
            Aggregation.LAST = "last";
            Aggregation.MEAN = "mean";
            Aggregation.SUM = "sum";
            Aggregation.MIN = "min";
            Aggregation.MAX = "max";
            Aggregation.COUNT = "count";
            Aggregation.ALL_TYPES = [Aggregation.SAME, Aggregation.FIRST, Aggregation.LAST, Aggregation.MEAN, Aggregation.SUM, Aggregation.MIN, Aggregation.MAX, Aggregation.COUNT];
            /**
             * The default aggregation mode.
             */
            Aggregation.DEFAULT = Aggregation.SAME;
            /**
             * The string displayed when data for a record is ambiguous.
             */
            Aggregation.AMBIGUOUS_DATA = "Ambiguous data";
            /**
             * Maps an aggregation method to a short description of its behavior.
             */
            Aggregation.HELP = {
                'same': 'Keep the value only if it is the same for each record in the group.',
                'first': 'Use the first of a group of values.',
                'last': 'Use the last of a group of values.',
                'mean': 'Calculate the mean (average) from a group of numeric values.',
                'sum': 'Calculate the sum (total) from a group of numeric values.',
                'min': 'Use the minimum of a group of numeric values.',
                'max': 'Use the maximum of a group of numeric values.',
                'count': 'Count the number of values in a group.'
            };
            data.Aggregation = Aggregation;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * A Qualified Key contains a namespace (keyType) and a local name within that namespace.
             *
             * @author adufilie
             */
            var IQualifiedKey = function IQualifiedKey() {
                _classCallCheck(this, IQualifiedKey);
            };
            IQualifiedKey = __decorate([Weave.classInfo({ id: "weavejs.api.data.IQualifiedKey" })], IQualifiedKey);
            data.IQualifiedKey = IQualifiedKey;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source) {
            var WeaveAPI = weavejs.WeaveAPI;
            var GeoJSON = weavejs.geom.GeoJSON;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var AsyncSort = weavejs.util.AsyncSort;

            var GeoJSONDataSourceData = function () {
                function GeoJSONDataSourceData(obj, keyType, keyPropertyName) {
                    _classCallCheck(this, GeoJSONDataSourceData);

                    /**
                     * The projection specified in the GeoJSON object.
                     */
                    this.projection = null;
                    /**
                     * An Array of "id" values corresponding to the GeoJSON features.
                     */
                    this.ids = null;
                    /**
                     * An Array of "geometry" objects corresponding to the GeoJSON features.
                     */
                    this.geometries = null;
                    /**
                     * An Array of "properties" objects corresponding to the GeoJSON features.
                     */
                    this.properties = null;
                    /**
                     * A list of property names found in the jsonProperties objects.
                     */
                    this.propertyNames = null;
                    /**
                     * propertyName -> typeof
                     */
                    this.propertyTypes = null;
                    /**
                     * An Array of IQualifiedKey objects corresponding to the GeoJSON features.
                     * This can be reinitialized via resetQKeys().
                     */
                    this.qkeys = null;
                    // get projection
                    var crs = obj.crs;
                    if (crs && crs.type == GeoJSON.CRS_T_NAME) this.projection = GeoJSON.getProjectionFromURN(crs.properties.name);
                    // get features
                    var featureCollection = GeoJSON.asFeatureCollection(obj);
                    var features = featureCollection.features;
                    // save data from features
                    this.ids = ArrayUtils.pluck(features, "id");
                    this.geometries = ArrayUtils.pluck(features, "geometries");
                    this.properties = ArrayUtils.pluck(features, "properties");
                    // if there are no ids, use index values
                    if (this.ids.every(function (item, i, a) {
                        return item === undefined;
                    })) this.ids = features.map(function (o, i, a) {
                        return i;
                    });
                    // get property names and determine types
                    this.propertyNames = [];
                    this.propertyTypes = {};
                    this.properties.forEach(function (props, i, a) {
                        for (var key in props) {
                            var value = props[key];
                            // don't let null affect type
                            if (value == null) continue;
                            var oldType = this.propertyTypes[key];
                            var newType = typeof value === "undefined" ? "undefined" : _typeof(value);
                            if (!this.propertyTypes.hasOwnProperty(key)) {
                                this.propertyTypes[key] = newType;
                                this.propertyNames.push(key);
                            } else if (oldType != newType) {
                                // adjust type
                                this.propertyTypes[key] = 'object';
                            }
                        }
                    }, this);
                    AsyncSort.sortImmediately(this.propertyNames);
                    this.resetQKeys(keyType, keyPropertyName);
                }
                /**
                 * Updates the qkeys Vector using the given keyType and property values under the given property name.
                 * If the property name is not found, index values will be used.
                 * @param keyType The keyType of each IQualifiedKey.
                 * @param propertyName The name of a property in the propertyNames Array.
                 */


                _createClass(GeoJSONDataSourceData, [{
                    key: "resetQKeys",
                    value: function resetQKeys(keyType, propertyName) {
                        var values = this.ids;
                        if (propertyName && this.propertyNames.indexOf(propertyName) >= 0) values = ArrayUtils.pluck(this.properties, propertyName);
                        this.qkeys = WeaveAPI.QKeyManager.getQKeys(keyType, values);
                    }
                }]);

                return GeoJSONDataSourceData;
            }();

            source.GeoJSONDataSourceData = GeoJSONDataSourceData;
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key) {
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            /**
             * This class is internal to QKeyManager because instances
             * of QKey should not be instantiated outside QKeyManager.
             */
            var QKey_1 = void 0;
            var QKey = QKey_1 = function () {
                function QKey(keyType, localName, toString) {
                    _classCallCheck(this, QKey);

                    this.kt = keyType;
                    this.ln = localName;
                    this._toNumber = QKey_1.serial++;
                    this._toString = toString;
                }
                /**
                 * This is the namespace of the QKey.
                 */


                _createClass(QKey, [{
                    key: "toNumber",
                    value: function toNumber() {
                        return this._toNumber;
                    }
                }, {
                    key: "toString",
                    value: function toString() {
                        return this._toString;
                    }
                }, {
                    key: "keyType",
                    get: function get() {
                        return this.kt;
                    }
                    /**
                     * This is local record identifier in the namespace of the QKey.
                     */

                }, {
                    key: "localName",
                    get: function get() {
                        return this.ln;
                    }
                }]);

                return QKey;
            }();
            QKey.serial = 0;
            QKey = QKey_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.QKey ", interfaces: [IQualifiedKey] })], QKey);
            key.QKey = QKey;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key_1) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IKeySet = weavejs.api.data.IKeySet;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var IKeyFilter = weavejs.api.data.IKeyFilter;
            var JS = weavejs.util.JS;
            /**
             * This class contains a set of IQualifiedKeys and functions for adding/removing keys from the set.
             *
             * @author adufilie
             */
            var KeySet_1 = void 0;
            var KeySet = KeySet_1 = function (_LinkableVariable4) {
                _inherits(KeySet, _LinkableVariable4);

                function KeySet() {
                    _classCallCheck(this, KeySet);

                    /**
                     * An interface for keys added and removed
                     */
                    var _this97 = _possibleConstructorReturn(this, (KeySet.__proto__ || Object.getPrototypeOf(KeySet)).call(this, Array));

                    _this97.keyCallbacks = Weave.linkableChild(_this97, key_1.KeySetCallbackInterface);
                    /**
                     * This flag is used to avoid recursion while the keys are being synchronized with the session state.
                     */
                    _this97._currentlyUpdating = false;
                    /**
                     * This object maps keys to index values
                     */
                    _this97.map_key_index = new Map();
                    /**
                     * This maps index values to IQualifiedKey objects
                     */
                    _this97._keys = [];
                    _this97._verifier = _this97.verifySessionState;
                    // The first callback will update the keys from the session state.
                    _this97.addImmediateCallback(_this97, _this97.updateKeys);
                    return _this97;
                }
                /**
                 * Verifies that the value is a two-dimensional array or null.
                 */


                _createClass(KeySet, [{
                    key: "verifySessionState",
                    value: function verifySessionState(value) {
                        var _iteratorNormalCompletion31 = true;
                        var _didIteratorError31 = false;
                        var _iteratorError31 = undefined;

                        try {
                            for (var _iterator31 = (value || [])[Symbol.iterator](), _step31; !(_iteratorNormalCompletion31 = (_step31 = _iterator31.next()).done); _iteratorNormalCompletion31 = true) {
                                var row = _step31.value;

                                if (!Weave.IS(row, Array)) return false;
                            }
                        } catch (err) {
                            _didIteratorError31 = true;
                            _iteratorError31 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion31 && _iterator31.return) {
                                    _iterator31.return();
                                }
                            } finally {
                                if (_didIteratorError31) {
                                    throw _iteratorError31;
                                }
                            }
                        }

                        return true;
                    }
                    /**
                     * This is the first callback that runs when the KeySet changes.
                     * The keys will be updated based on the session state.
                     */

                }, {
                    key: "updateKeys",
                    value: function updateKeys() {
                        // avoid recursion
                        if (this._currentlyUpdating) return;
                        // each row of CSV represents a different keyType (keyType is the first token in the row)
                        var newKeys = [];
                        var _iteratorNormalCompletion32 = true;
                        var _didIteratorError32 = false;
                        var _iteratorError32 = undefined;

                        try {
                            for (var _iterator32 = (this._sessionStateInternal || [])[Symbol.iterator](), _step32; !(_iteratorNormalCompletion32 = (_step32 = _iterator32.next()).done); _iteratorNormalCompletion32 = true) {
                                var row = _step32.value;

                                newKeys.push.apply(newKeys, WeaveAPI.QKeyManager.getQKeys(row[0], row.slice(1)));
                            } // avoid internal recursion while still allowing callbacks to cause recursion afterwards
                        } catch (err) {
                            _didIteratorError32 = true;
                            _iteratorError32 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion32 && _iterator32.return) {
                                    _iterator32.return();
                                }
                            } finally {
                                if (_didIteratorError32) {
                                    throw _iteratorError32;
                                }
                            }
                        }

                        this.delayCallbacks();
                        this._currentlyUpdating = true;
                        this.replaceKeys(newKeys);
                        this.keyCallbacks.flushKeys();
                        this._currentlyUpdating = false;
                        this.resumeCallbacks();
                    }
                    /**
                     * This function will derive the session state from the IQualifiedKey objects in the keys array.
                     */

                }, {
                    key: "updateSessionState",
                    value: function updateSessionState() {
                        // avoid recursion
                        if (this._currentlyUpdating) return;
                        // from the IQualifiedKey objects, generate the session state
                        var _keyTypeToKeysMap = {};
                        var _iteratorNormalCompletion33 = true;
                        var _didIteratorError33 = false;
                        var _iteratorError33 = undefined;

                        try {
                            for (var _iterator33 = (this._keys || [])[Symbol.iterator](), _step33; !(_iteratorNormalCompletion33 = (_step33 = _iterator33.next()).done); _iteratorNormalCompletion33 = true) {
                                var key = _step33.value;

                                if (_keyTypeToKeysMap[key.keyType] == undefined) _keyTypeToKeysMap[key.keyType] = [];
                                _keyTypeToKeysMap[key.keyType].push(key.localName);
                            }
                            // for each keyType, create a row for the CSV parser
                        } catch (err) {
                            _didIteratorError33 = true;
                            _iteratorError33 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion33 && _iterator33.return) {
                                    _iterator33.return();
                                }
                            } finally {
                                if (_didIteratorError33) {
                                    throw _iteratorError33;
                                }
                            }
                        }

                        var keyTable = [];
                        for (var keyType in _keyTypeToKeysMap) {
                            var newKeys = _keyTypeToKeysMap[keyType];
                            newKeys.unshift(keyType);
                            keyTable.push(newKeys);
                        }
                        // avoid internal recursion while still allowing callbacks to cause recursion afterwards
                        this.delayCallbacks();
                        this._currentlyUpdating = true;
                        this.setSessionState(keyTable);
                        this.keyCallbacks.flushKeys();
                        this._currentlyUpdating = false;
                        this.resumeCallbacks();
                    }
                    /**
                     * A list of keys included in this KeySet.
                     */

                }, {
                    key: "replaceKeys",

                    /**
                     * Overwrite the current set of keys.
                     * @param newKeys An Array of IQualifiedKey objects.
                     * @return true if the set changes as a result of calling this function.
                     */
                    value: function replaceKeys(newKeys) {
                        if (this._locked) return false;
                        WeaveAPI.QKeyManager.convertToQKeys(newKeys);
                        if (newKeys == this._keys) this._keys = this._keys.concat();
                        var key;
                        var changeDetected = false;
                        // copy the previous key-to-index mapping for detecting changes
                        var prevKeyIndex = this.map_key_index;
                        // initialize new key index
                        this.map_key_index = new Map();
                        // copy new keys and create new key index
                        this._keys.length = newKeys.length; // allow space for all keys
                        var outputIndex = 0; // index to store internally
                        for (var inputIndex = 0; inputIndex < newKeys.length; inputIndex++) {
                            key = newKeys[inputIndex];
                            // avoid storing duplicate keys
                            if (this.map_key_index.has(key)) continue;
                            // copy key
                            this._keys[outputIndex] = key;
                            // save key-to-index mapping
                            this.map_key_index.set(key, outputIndex);
                            // if the previous key index did not have this key, a change has been detected.
                            if (prevKeyIndex.get(key) === undefined) {
                                changeDetected = true;
                                this.keyCallbacks.keysAdded.push(key);
                            }
                            // increase stored index
                            outputIndex++;
                        }
                        this._keys.length = outputIndex; // trim to actual length
                        // loop through old keys and see if any were removed
                        var oldKeys = JS.mapKeys(prevKeyIndex);
                        var _iteratorNormalCompletion34 = true;
                        var _didIteratorError34 = false;
                        var _iteratorError34 = undefined;

                        try {
                            for (var _iterator34 = (oldKeys || [])[Symbol.iterator](), _step34; !(_iteratorNormalCompletion34 = (_step34 = _iterator34.next()).done); _iteratorNormalCompletion34 = true) {
                                var key = _step34.value;

                                if (!this.map_key_index.has(key)) {
                                    changeDetected = true;
                                    this.keyCallbacks.keysRemoved.push(key);
                                }
                            }
                        } catch (err) {
                            _didIteratorError34 = true;
                            _iteratorError34 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion34 && _iterator34.return) {
                                    _iterator34.return();
                                }
                            } finally {
                                if (_didIteratorError34) {
                                    throw _iteratorError34;
                                }
                            }
                        }

                        if (changeDetected) this.updateSessionState();
                        return changeDetected;
                    }
                    /**
                     * Clear the current set of keys.
                     * @return true if the set changes as a result of calling this function.
                     */

                }, {
                    key: "clearKeys",
                    value: function clearKeys() {
                        if (this._locked) return false;
                        // stop if there are no keys to remove
                        if (this._keys.length == 0) return false; // set did not change
                        this.keyCallbacks.keysRemoved = this.keyCallbacks.keysRemoved.concat(this._keys);
                        // clear key-to-index mapping
                        this.map_key_index = new Map();
                        this._keys = [];
                        this.updateSessionState();
                        // set changed
                        return true;
                    }
                    /**
                     * @param key A IQualifiedKey object to check.
                     * @return true if the given key is included in the set.
                     */

                }, {
                    key: "containsKey",
                    value: function containsKey(key) {
                        // the key is included in the set if it is in the key-to-index mapping.
                        return this.map_key_index.has(key);
                    }
                    /**
                     * Adds a vector of additional keys to the set.
                     * @param additionalKeys A list of keys to add to this set.
                     * @return true if the set changes as a result of calling this function.
                     */

                }, {
                    key: "addKeys",
                    value: function addKeys(additionalKeys) {
                        if (this._locked) return false;
                        var changeDetected = false;
                        WeaveAPI.QKeyManager.convertToQKeys(additionalKeys);
                        var _iteratorNormalCompletion35 = true;
                        var _didIteratorError35 = false;
                        var _iteratorError35 = undefined;

                        try {
                            for (var _iterator35 = (additionalKeys || [])[Symbol.iterator](), _step35; !(_iteratorNormalCompletion35 = (_step35 = _iterator35.next()).done); _iteratorNormalCompletion35 = true) {
                                var key = _step35.value;

                                if (!this.map_key_index.has(key)) {
                                    // add key
                                    var newIndex = this._keys.length;
                                    this._keys[newIndex] = key;
                                    this.map_key_index.set(key, newIndex);
                                    changeDetected = true;
                                    this.keyCallbacks.keysAdded.push(key);
                                }
                            }
                        } catch (err) {
                            _didIteratorError35 = true;
                            _iteratorError35 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion35 && _iterator35.return) {
                                    _iterator35.return();
                                }
                            } finally {
                                if (_didIteratorError35) {
                                    throw _iteratorError35;
                                }
                            }
                        }

                        if (changeDetected) this.updateSessionState();
                        return changeDetected;
                    }
                    /**
                     * Removes a vector of additional keys to the set.
                     * @param unwantedKeys A list of keys to remove from this set.
                     * @return true if the set changes as a result of calling this function.
                     */

                }, {
                    key: "removeKeys",
                    value: function removeKeys(unwantedKeys) {
                        if (this._locked) return false;
                        if (unwantedKeys == this._keys) return this.clearKeys();
                        var changeDetected = false;
                        WeaveAPI.QKeyManager.convertToQKeys(unwantedKeys);
                        var _iteratorNormalCompletion36 = true;
                        var _didIteratorError36 = false;
                        var _iteratorError36 = undefined;

                        try {
                            for (var _iterator36 = (unwantedKeys || [])[Symbol.iterator](), _step36; !(_iteratorNormalCompletion36 = (_step36 = _iterator36.next()).done); _iteratorNormalCompletion36 = true) {
                                var key = _step36.value;

                                if (this.map_key_index.has(key)) {
                                    // drop key from _keys vector
                                    var droppedIndex = this.map_key_index.get(key);
                                    if (droppedIndex < this._keys.length - 1) {
                                        // move the last entry to the droppedIndex slot
                                        var lastKey = this._keys[this.keys.length - 1];
                                        this._keys[droppedIndex] = lastKey;
                                        this.map_key_index.set(lastKey, droppedIndex);
                                    }
                                    // update length of vector
                                    this._keys.length--;
                                    // drop key from object mapping
                                    this.map_key_index.delete(key);
                                    changeDetected = true;
                                    this.keyCallbacks.keysRemoved.push(key);
                                }
                            }
                        } catch (err) {
                            _didIteratorError36 = true;
                            _iteratorError36 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion36 && _iterator36.return) {
                                    _iterator36.return();
                                }
                            } finally {
                                if (_didIteratorError36) {
                                    throw _iteratorError36;
                                }
                            }
                        }

                        if (changeDetected) this.updateSessionState();
                        return changeDetected;
                    }
                    /**
                     * This function sets the session state for the KeySet.
                     * @param value A CSV-formatted String where each row is a keyType followed by a list of key strings of that keyType.
                     */
                    /* override */
                }, {
                    key: "setSessionState",
                    value: function setSessionState(value) {
                        // backwards compatibility 0.9.6
                        if (!Weave.IS(value, String) && !Weave.IS(value, Array) && value != null) {
                            var keysProperty = 'sessionedKeys';
                            var keyTypeProperty = 'sessionedKeyType';
                            if (value.hasOwnProperty(keysProperty) && value.hasOwnProperty(keyTypeProperty)) if (value[keyTypeProperty] != null && value[keysProperty] != null) value = WeaveAPI.CSVParser.createCSVRow([value[keyTypeProperty]]) + ',' + value[keysProperty];
                        }
                        // backwards compatibility -- parse CSV String
                        if (Weave.IS(value, String)) value = WeaveAPI.CSVParser.parseCSV(value);
                        // expecting a two-dimensional Array at this point
                        _get(KeySet.prototype.__proto__ || Object.getPrototypeOf(KeySet.prototype), "setSessionState", this).call(this, value);
                    }
                    //---------------------------------------------------------------------------------
                    // test code
                    // { test(); }

                }, {
                    key: "keys",
                    get: function get() {
                        return this._keys;
                    }
                }], [{
                    key: "test",
                    value: function test() {
                        var k = new KeySet_1();
                        var k2 = new KeySet_1();
                        k.addImmediateCallback(null, function () {
                            this.traceKeySet(k);
                        });
                        KeySet_1.testFunction(k, k.replaceKeys, 'create k', 't', ['a', 'b', 'c'], 't', ['a', 'b', 'c']);
                        KeySet_1.testFunction(k, k.addKeys, 'add', 't', ['b', 'c', 'd', 'e'], 't', ['a', 'b', 'c', 'd', 'e']);
                        KeySet_1.testFunction(k, k.removeKeys, 'remove', 't', ['d', 'e', 'f', 'g'], 't', ['a', 'b', 'c']);
                        KeySet_1.testFunction(k, k.replaceKeys, 'replace', 't', ['b', 'x'], 't', ['b', 'x']);
                        k2.replaceKeys(WeaveAPI.QKeyManager.getQKeys('t', ['a', 'b', 'x', 'y']));
                        console.log('copy k2 to k');
                        WeaveAPI.SessionManager.copySessionState(k2, k);
                        KeySet_1.assert(k, WeaveAPI.QKeyManager.getQKeys('t', ['a', 'b', 'x', 'y']));
                        console.log('test deprecated session state');
                        WeaveAPI.SessionManager.setSessionState(k, { sessionedKeyType: 't2', sessionedKeys: 'a,b,x,y' }, true);
                        KeySet_1.assert(k, WeaveAPI.QKeyManager.getQKeys('t2', ['a', 'b', 'x', 'y']));
                        KeySet_1.testFunction(k, k.replaceKeys, 'replace k', 't', ['1'], 't', ['1']);
                        KeySet_1.testFunction(k, k.addKeys, 'add k', 't2', ['1'], 't', ['1'], 't2', ['1']);
                        KeySet_1.testFunction(k, k.removeKeys, 'remove k', 't', ['1'], 't2', ['1']);
                        KeySet_1.testFunction(k, k.addKeys, 'add k', 't2', ['1'], 't2', ['1']);
                        var _iteratorNormalCompletion37 = true;
                        var _didIteratorError37 = false;
                        var _iteratorError37 = undefined;

                        try {
                            for (var _iterator37 = (WeaveAPI.QKeyManager.getAllKeyTypes() || [])[Symbol.iterator](), _step37; !(_iteratorNormalCompletion37 = (_step37 = _iterator37.next()).done); _iteratorNormalCompletion37 = true) {
                                var t = _step37.value;

                                console.log('all keys (' + t + '):', KeySet_1.getKeyStrings(WeaveAPI.QKeyManager.getAllQKeys(t)));
                            }
                        } catch (err) {
                            _didIteratorError37 = true;
                            _iteratorError37 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion37 && _iterator37.return) {
                                    _iterator37.return();
                                }
                            } finally {
                                if (_didIteratorError37) {
                                    throw _iteratorError37;
                                }
                            }
                        }
                    }
                }, {
                    key: "getKeyStrings",
                    value: function getKeyStrings(qkeys) {
                        var keyStrings = [];
                        var _iteratorNormalCompletion38 = true;
                        var _didIteratorError38 = false;
                        var _iteratorError38 = undefined;

                        try {
                            for (var _iterator38 = (qkeys || [])[Symbol.iterator](), _step38; !(_iteratorNormalCompletion38 = (_step38 = _iterator38.next()).done); _iteratorNormalCompletion38 = true) {
                                var key = _step38.value;

                                keyStrings.push(key.keyType + '#' + key.localName);
                            }
                        } catch (err) {
                            _didIteratorError38 = true;
                            _iteratorError38 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion38 && _iterator38.return) {
                                    _iterator38.return();
                                }
                            } finally {
                                if (_didIteratorError38) {
                                    throw _iteratorError38;
                                }
                            }
                        }

                        return keyStrings;
                    }
                }, {
                    key: "traceKeySet",
                    value: function traceKeySet(keySet) {
                        console.log(' ->', KeySet_1.getKeyStrings(keySet.keys));
                        console.log('   ', Weave.stringify(WeaveAPI.SessionManager.getSessionState(keySet)));
                    }
                }, {
                    key: "testFunction",
                    value: function testFunction(keySet, func, comment, keyType, keys, expectedResultKeyType, expectedResultKeys) {
                        var expectedResultKeyType2 = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : null;
                        var expectedResultKeys2 = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : null;

                        console.log(comment, keyType, keys);
                        func(WeaveAPI.QKeyManager.getQKeys(keyType, keys));
                        var keys1 = expectedResultKeys ? WeaveAPI.QKeyManager.getQKeys(expectedResultKeyType, expectedResultKeys) : [];
                        var keys2 = expectedResultKeys2 ? WeaveAPI.QKeyManager.getQKeys(expectedResultKeyType2, expectedResultKeys2) : [];
                        KeySet_1.assert(keySet, keys1, keys2);
                    }
                }, {
                    key: "assert",
                    value: function assert(keySet, expectedKeys1) {
                        var expectedKeys2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                        var qkey;
                        var map_key = new Map();
                        var _arr = [expectedKeys1, expectedKeys2];
                        for (var _i = 0; _i < _arr.length; _i++) {
                            var keys = _arr[_i];var _iteratorNormalCompletion40 = true;
                            var _didIteratorError40 = false;
                            var _iteratorError40 = undefined;

                            try {
                                for (var _iterator40 = (keys || [])[Symbol.iterator](), _step40; !(_iteratorNormalCompletion40 = (_step40 = _iterator40.next()).done); _iteratorNormalCompletion40 = true) {
                                    qkey = _step40.value;

                                    if (!keySet.containsKey(qkey)) throw new Error("KeySet does not contain expected keys");
                                    map_key.set(qkey, true);
                                }
                            } catch (err) {
                                _didIteratorError40 = true;
                                _iteratorError40 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion40 && _iterator40.return) {
                                        _iterator40.return();
                                    }
                                } finally {
                                    if (_didIteratorError40) {
                                        throw _iteratorError40;
                                    }
                                }
                            }
                        }
                        var _iteratorNormalCompletion39 = true;
                        var _didIteratorError39 = false;
                        var _iteratorError39 = undefined;

                        try {
                            for (var _iterator39 = (keySet.keys || [])[Symbol.iterator](), _step39; !(_iteratorNormalCompletion39 = (_step39 = _iterator39.next()).done); _iteratorNormalCompletion39 = true) {
                                qkey = _step39.value;

                                if (!map_key.has(qkey)) throw new Error("KeySet contains unexpected keys");
                            }
                        } catch (err) {
                            _didIteratorError39 = true;
                            _iteratorError39 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion39 && _iterator39.return) {
                                    _iterator39.return();
                                }
                            } finally {
                                if (_didIteratorError39) {
                                    throw _iteratorError39;
                                }
                            }
                        }
                    }
                }]);

                return KeySet;
            }(LinkableVariable);
            KeySet = KeySet_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.KeySet", interfaces: [IKeySet, IKeyFilter] })], KeySet);
            key_1.KeySet = KeySet;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key_2) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IKeyFilter = weavejs.api.data.IKeyFilter;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            var LinkableString = weavejs.core.LinkableString;
            /**
             * This class is used to include and exclude IQualifiedKeys from a set.
             *
             * @author adufilie
             */
            var KeyFilter_1 = void 0;
            var KeyFilter = KeyFilter_1 = function () {
                function KeyFilter() {
                    _classCallCheck(this, KeyFilter);

                    // option to include missing keys or not
                    this.includeMissingKeys = Weave.linkableChild(this, LinkableBoolean, this.cacheValues);
                    this.includeMissingKeyTypes = Weave.linkableChild(this, LinkableBoolean, this.cacheValues);
                    this.included = Weave.linkableChild(this, key_2.KeySet, this.handleIncludeChange);
                    this.excluded = Weave.linkableChild(this, key_2.KeySet, this.handleExcludeChange);
                    this.filters = Weave.linkableChild(this, new LinkableHashMap(IKeyFilter));
                    this.filterSetOp = Weave.linkableChild(this, new LinkableString(KeyFilter_1.INTERSECTION, this.verifyFilterSetOp), this.cacheValues);
                    this._includedKeyTypeMap = {};
                    this._excludedKeyTypeMap = {};
                    this._deprecatedState = null;
                    this.includeMissingKeys.value = false;
                    this.includeMissingKeyTypes.value = true;
                    this.filters.childListCallbacks.addImmediateCallback(this, this.cacheValues);
                }

                _createClass(KeyFilter, [{
                    key: "verifyFilterSetOp",
                    value: function verifyFilterSetOp(value) {
                        return value === KeyFilter_1.UNION || value === KeyFilter_1.INTERSECTION;
                    }
                }, {
                    key: "cacheValues",
                    value: function cacheValues() {
                        this._includeMissingKeys = this.includeMissingKeys.value;
                        this._includeMissingKeyTypes = this.includeMissingKeyTypes.value;
                        this._filters = this.filters.getObjects();
                        this._filterSetOp = this.filterSetOp.value;
                    }
                    /**
                     * This replaces the included and excluded keys in the filter with the parameters specified.
                     */

                }, {
                    key: "replaceKeys",
                    value: function replaceKeys(includeMissingKeys, includeMissingKeyTypes) {
                        var includeKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
                        var excludeKeys = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                        Weave.getCallbacks(this).delayCallbacks();
                        this.includeMissingKeys.value = includeMissingKeys;
                        this.includeMissingKeyTypes.value = includeMissingKeyTypes;
                        if (includeKeys) this.included.replaceKeys(includeKeys);else this.included.clearKeys();
                        if (excludeKeys) this.excluded.replaceKeys(excludeKeys);else this.excluded.clearKeys();
                        Weave.getCallbacks(this).resumeCallbacks();
                    }
                    // adds keys to include list

                }, {
                    key: "includeKeys",
                    value: function includeKeys(keys) {
                        this.included.addKeys(keys);
                    }
                    // adds keys to exclude list

                }, {
                    key: "excludeKeys",
                    value: function excludeKeys(keys) {
                        this.excluded.addKeys(keys);
                    }
                    // removes keys from exclude list that were just added to include list

                }, {
                    key: "handleIncludeChange",
                    value: function handleIncludeChange() {
                        var includedKeys = this.included.keys;
                        this._includedKeyTypeMap = {};
                        var _iteratorNormalCompletion41 = true;
                        var _didIteratorError41 = false;
                        var _iteratorError41 = undefined;

                        try {
                            for (var _iterator41 = (includedKeys || [])[Symbol.iterator](), _step41; !(_iteratorNormalCompletion41 = (_step41 = _iterator41.next()).done); _iteratorNormalCompletion41 = true) {
                                var key = _step41.value;

                                this._includedKeyTypeMap[key.keyType] = true;
                            }
                        } catch (err) {
                            _didIteratorError41 = true;
                            _iteratorError41 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion41 && _iterator41.return) {
                                    _iterator41.return();
                                }
                            } finally {
                                if (_didIteratorError41) {
                                    throw _iteratorError41;
                                }
                            }
                        }

                        this.excluded.removeKeys(includedKeys);
                    }
                    // removes keys from include list that were just added to exclude list

                }, {
                    key: "handleExcludeChange",
                    value: function handleExcludeChange() {
                        var excludedKeys = this.excluded.keys;
                        this._excludedKeyTypeMap = {};
                        var _iteratorNormalCompletion42 = true;
                        var _didIteratorError42 = false;
                        var _iteratorError42 = undefined;

                        try {
                            for (var _iterator42 = (excludedKeys || [])[Symbol.iterator](), _step42; !(_iteratorNormalCompletion42 = (_step42 = _iterator42.next()).done); _iteratorNormalCompletion42 = true) {
                                var key = _step42.value;

                                this._excludedKeyTypeMap[key.keyType] = true;
                            }
                        } catch (err) {
                            _didIteratorError42 = true;
                            _iteratorError42 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion42 && _iterator42.return) {
                                    _iterator42.return();
                                }
                            } finally {
                                if (_didIteratorError42) {
                                    throw _iteratorError42;
                                }
                            }
                        }

                        this.included.removeKeys(excludedKeys);
                    }
                    /**
                     * @param key A key to test.
                     * @return true if this filter includes the key, false if the filter excludes it.
                     */

                }, {
                    key: "containsKey",
                    value: function containsKey(key) {
                        if (this._filterSetOp === KeyFilter_1.INTERSECTION) {
                            var _iteratorNormalCompletion43 = true;
                            var _didIteratorError43 = false;
                            var _iteratorError43 = undefined;

                            try {
                                for (var _iterator43 = (this._filters || [])[Symbol.iterator](), _step43; !(_iteratorNormalCompletion43 = (_step43 = _iterator43.next()).done); _iteratorNormalCompletion43 = true) {
                                    var filter = _step43.value;

                                    if (!filter.containsKey(key)) return false;
                                }
                            } catch (err) {
                                _didIteratorError43 = true;
                                _iteratorError43 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion43 && _iterator43.return) {
                                        _iterator43.return();
                                    }
                                } finally {
                                    if (_didIteratorError43) {
                                        throw _iteratorError43;
                                    }
                                }
                            }
                        } else if (this._filterSetOp === KeyFilter_1.UNION) {
                            var found = false;
                            var _iteratorNormalCompletion44 = true;
                            var _didIteratorError44 = false;
                            var _iteratorError44 = undefined;

                            try {
                                for (var _iterator44 = (this._filters || [])[Symbol.iterator](), _step44; !(_iteratorNormalCompletion44 = (_step44 = _iterator44.next()).done); _iteratorNormalCompletion44 = true) {
                                    var filter = _step44.value;

                                    if (filter.containsKey(key)) {
                                        found = true;
                                        break;
                                    }
                                }
                            } catch (err) {
                                _didIteratorError44 = true;
                                _iteratorError44 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion44 && _iterator44.return) {
                                        _iterator44.return();
                                    }
                                } finally {
                                    if (_didIteratorError44) {
                                        throw _iteratorError44;
                                    }
                                }
                            }

                            if (!found) return false;
                        }
                        if (this._includeMissingKeys || this._includeMissingKeyTypes && !this._includedKeyTypeMap[key.keyType]) {
                            if (this.excluded.containsKey(key)) return false;
                            if (!this._includeMissingKeyTypes && this._excludedKeyTypeMap[key.keyType]) return false;
                            return true;
                        } else {
                            if (this.included.containsKey(key)) return true;
                            // if includeMissingKeyTypes and keyType is missing
                            if (this._includeMissingKeyTypes && !this._includedKeyTypeMap[key.keyType] && !this._excludedKeyTypeMap[key.keyType]) return true;
                            return false;
                        }
                    }
                    //----------------------------------------------------------
                    // backwards compatibility 0.9.6
                    /**
                     * @deprecated
                     */

                }, {
                    key: "handleDeprecatedSessionedProperty",
                    value: function handleDeprecatedSessionedProperty(propertyName, value) {
                        if (this._deprecatedState == null) {
                            this._deprecatedState = {};
                            WeaveAPI.Scheduler.callLater(this, this._applyDeprecatedSessionState);
                        }
                        this._deprecatedState[propertyName] = value;
                    }
                }, {
                    key: "_applyDeprecatedSessionState",
                    value: function _applyDeprecatedSessionState() {
                        this._deprecatedState.sessionedKeys = this._deprecatedState.includedKeys;
                        this.included.setSessionState(this._deprecatedState);
                        this._deprecatedState.sessionedKeys = this._deprecatedState.excludedKeys;
                        this.excluded.setSessionState(this._deprecatedState);
                    }
                }, {
                    key: "sessionedKeyType",
                    set: function set(value) {
                        this.handleDeprecatedSessionedProperty('sessionedKeyType', value);
                    }
                    /**
                     * @deprecated replacement="included"
                     */

                }, {
                    key: "includedKeys",
                    set: function set(value) {
                        this.handleDeprecatedSessionedProperty('includedKeys', value);
                    }
                    /**
                     * @deprecated replacement="excluded"
                     */

                }, {
                    key: "excludedKeys",
                    set: function set(value) {
                        this.handleDeprecatedSessionedProperty('excludedKeys', value);
                    }
                }]);

                return KeyFilter;
            }();
            KeyFilter.UNION = 'union';
            KeyFilter.INTERSECTION = 'intersection';
            KeyFilter = KeyFilter_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.KeyFilter", interfaces: [IKeyFilter] })], KeyFilter);
            key_2.KeyFilter = KeyFilter;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var geom;
    (function (geom_5) {
        var WeaveAPI = weavejs.WeaveAPI;
        var CallbackCollection = weavejs.core.CallbackCollection;
        var Bounds2D = weavejs.geom.Bounds2D;
        var GeneralizedGeometry = weavejs.geom.GeneralizedGeometry;
        var GeometryType = weavejs.geom.GeometryType;
        var KDTree = weavejs.geom.KDTree;
        var ArrayUtils = weavejs.util.ArrayUtils;
        var Dictionary2D = weavejs.util.Dictionary2D;
        var StandardLib = weavejs.util.StandardLib;
        /**
         * This class provides functions for parsing a binary geometry stream.
         * The callbacks for this object get called when all queued decoding completes.
         *
         * Throughout the code, an ID refers to an integer value, while a Key is a string value.
         * Binary format:
         *   tile descriptor format: [float minImportance, float maxImportance, double xMin, double yMin, double xMax, double yMax]
         *       stream tile format: [int negativeTileID, negative streamVersion or binary stream object beginning with positive int, ...]
         *   metadata stream object: [int geometryID, String geometryKey, '\0', double xMin, double yMin, double xMax, double yMax, int vertexID1, ..., int vertexID(n), int -1 if no shapeType follows or -2 if shapeType follows, int optionalShapeType]
         *   geometry stream object: [int geometryID1, int vertexID1, ..., int geometryID(n-1), int vertexID(n-1), int geometryID(n), int negativeVertexID(n), double x, double y, float importance]
         *   geometry stream marker: [int geometryID1, int vertexID1, ..., int geometryID(n), int vertexID(n), int -1]
         *   geometry stream marker: [int geometryID, int vertexID_begin, int -2, int vertexID_end]
         *
         * @author adufilie
         */
        var GeometryStreamDecoder_1 = void 0;
        var GeometryStreamDecoder = GeometryStreamDecoder_1 = function () {
            function GeometryStreamDecoder() {
                var _this98 = this;

                _classCallCheck(this, GeometryStreamDecoder);

                this.totalGeomTiles = 0;
                this.totalVertices = 0;
                this.streamVersion = 0;
                /**
                 * This is an Array of GeneralizedGeometry objects that have been decoded from a stream.
                 */
                this.geometries = [];
                /**
                 * This is the bounding box containing all tile boundaries.
                 */
                this.collectiveBounds = new Bounds2D();
                this._keyType = null;
                /**
                 * This is the set of geometry keys that have been decoded so far.
                 */
                this.keys = [];
                /**
                 * These callbacks get called when the keys or bounds change.
                 */
                this.metadataCallbacks = Weave.linkableChild(this, CallbackCollection);
                /**
                 * This object maps a key to an array of geometries.
                 */
                this.map_key_geoms = new Map();
                /**
                 * metadataTiles & geometryTiles
                 * These are 6-dimensional trees of tiles that are available and have not been downloaded yet.
                 * The dimensions are minImportance, maxImportance, xMin, yMin, xMax, yMax.
                 * The objects contained in the KDNodes are integers representing tile ID numbers.
                 */
                this.metadataTiles = Weave.disposableChild(this, new KDTree(GeometryStreamDecoder_1.KD_DIMENSIONALITY));
                this.geometryTiles = Weave.disposableChild(this, new KDTree(GeometryStreamDecoder_1.KD_DIMENSIONALITY));
                /**
                 * (KDTree, int) -> TileDescriptor
                 */
                this.tileLookup = new Dictionary2D();
                /**
                 * These KDKey arrays are created once and reused to avoid unnecessary creation of objects.
                 */
                this.minKDKey = [-Infinity, -Infinity, -Infinity, -Infinity, -Infinity];
                this.maxKDKey = [Infinity, Infinity, Infinity, Infinity, Infinity];
                this._projectionWKT = ""; // stores the well-known-text defining the projection
                /**
                 * This value specifies the type of the geometries currently being streamed
                 */
                this._currentGeometryType = GeometryType.POLYGON;
                if (GeometryStreamDecoder_1.debug) Weave.getCallbacks(this).addImmediateCallback(this, function () {
                    console.log(_this98.totalGeomTiles, 'geomTiles,', _this98.totalVertices, 'vertices');
                });
            }
            /**
             * This function sets the keyType of the keys that will be
             * added as a result of downloading the geometries.
             */


            _createClass(GeometryStreamDecoder, [{
                key: "getGeometriesFromKey",

                /**
                 * @param geometryKey A String identifier.
                 * @return An Array of GeneralizedGeometry objects with keys matching the specified key.
                 */
                value: function getGeometriesFromKey(geometryKey) {
                    return this.map_key_geoms.get(geometryKey);
                }
                /**
                 * These functions return an array of tiles that need to be downloaded in
                 * order for shapes to be displayed at the given importance (quality) level.
                 * Tiles that have already been decoded from a stream will not be returned.
                 * @return A list of tiles, sorted descending by maxImportance.
                 */

            }, {
                key: "getRequiredMetadataTileIDs",
                value: function getRequiredMetadataTileIDs(bounds, minImportance, removeTilesFromList) {
                    return this.getRequiredTileIDs(this.metadataTiles, bounds, minImportance, removeTilesFromList);
                }
            }, {
                key: "getRequiredGeometryTileIDs",
                value: function getRequiredGeometryTileIDs(bounds, minImportance, removeTilesFromList) {
                    return this.getRequiredTileIDs(this.geometryTiles, bounds, minImportance, removeTilesFromList);
                }
            }, {
                key: "_filterTiles",
                value: function _filterTiles(tile) {
                    return !tile.exclude;
                }
            }, {
                key: "_tileToId",
                value: function _tileToId(tile) {
                    return tile.tileID;
                }
            }, {
                key: "_getMaxImportance",
                value: function _getMaxImportance(tile) {
                    return tile.kdKey[GeometryStreamDecoder_1.IMAX_INDEX];
                }
            }, {
                key: "getRequiredTileIDs",
                value: function getRequiredTileIDs(tileTree, bounds, minImportance, removeTilesFromList) {
                    //JS.log("getRequiredTileIDs, minImportance="+minImportance);
                    // filter out tiles with maxImportance less than the specified minImportance
                    this.minKDKey[GeometryStreamDecoder_1.IMAX_INDEX] = minImportance;
                    // set the minimum query values for xMax, yMax
                    this.minKDKey[GeometryStreamDecoder_1.XMAX_INDEX] = bounds.getXNumericMin();
                    this.minKDKey[GeometryStreamDecoder_1.YMAX_INDEX] = bounds.getYNumericMin();
                    // set the maximum query values for xMin, yMin
                    this.maxKDKey[GeometryStreamDecoder_1.XMIN_INDEX] = bounds.getXNumericMax();
                    this.maxKDKey[GeometryStreamDecoder_1.YMIN_INDEX] = bounds.getYNumericMax();
                    var tiles = tileTree.queryRange(this.minKDKey, this.maxKDKey, true);
                    tiles = tiles.filter(this._filterTiles);
                    StandardLib.sortOn(tiles, this._getMaxImportance, -1);
                    if (removeTilesFromList) {
                        var _iteratorNormalCompletion45 = true;
                        var _didIteratorError45 = false;
                        var _iteratorError45 = undefined;

                        try {
                            for (var _iterator45 = (tiles || [])[Symbol.iterator](), _step45; !(_iteratorNormalCompletion45 = (_step45 = _iterator45.next()).done); _iteratorNormalCompletion45 = true) {
                                var tile = _step45.value;

                                tile.exclude = true;
                            }
                        } catch (err) {
                            _didIteratorError45 = true;
                            _iteratorError45 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion45 && _iterator45.return) {
                                    _iterator45.return();
                                }
                            } finally {
                                if (_didIteratorError45) {
                                    throw _iteratorError45;
                                }
                            }
                        }
                    }return tiles.map(this._tileToId);
                }
                /**
                 * This function will decode a tile list stream.
                 * @param stream A list of metadata tiles encoded in a ByteArray stream.
                 */

            }, {
                key: "decodeMetadataTileList",
                value: function decodeMetadataTileList(stream) {
                    this.decodeTileList(this.metadataTiles, stream);
                }
                /**
                 * This function will decode a tile list stream.
                 * @param stream A list of geometry tiles encoded in a ByteArray stream.
                 */

            }, {
                key: "decodeGeometryTileList",
                value: function decodeGeometryTileList(stream) {
                    this.decodeTileList(this.geometryTiles, stream);
                }
                /**
                 * @private
                 */

            }, {
                key: "decodeTileList",
                value: function decodeTileList(tileTree, stream) {
                    var tiles = []; // array of descriptor objects containing kdKey and tileID
                    // read tile descriptors from stream
                    var tileID = 0;
                    while (stream.position < stream.length) {
                        var kdKey = new Array(GeometryStreamDecoder_1.KD_DIMENSIONALITY);
                        kdKey[GeometryStreamDecoder_1.XMIN_INDEX] = stream.readDouble();
                        kdKey[GeometryStreamDecoder_1.YMIN_INDEX] = stream.readDouble();
                        kdKey[GeometryStreamDecoder_1.XMAX_INDEX] = stream.readDouble();
                        kdKey[GeometryStreamDecoder_1.YMAX_INDEX] = stream.readDouble();
                        kdKey[GeometryStreamDecoder_1.IMAX_INDEX] = stream.readFloat();
                        if (stream.position > stream.length) throw new Error("Unexpected EOF in stream");
                        if (GeometryStreamDecoder_1.debug) console.log((tileTree == this.metadataTiles ? "metadata tile" : "geometry tile") + " " + tileID + "[" + kdKey + "]");
                        tiles.push(new TileDescriptor(kdKey, tileID));
                        this.collectiveBounds.includeCoords(kdKey[GeometryStreamDecoder_1.XMIN_INDEX], kdKey[GeometryStreamDecoder_1.YMIN_INDEX]);
                        this.collectiveBounds.includeCoords(kdKey[GeometryStreamDecoder_1.XMAX_INDEX], kdKey[GeometryStreamDecoder_1.YMAX_INDEX]);
                        tileID++;
                    }
                    // randomize the order of tileDescriptors to avoid a possibly
                    // poorly-performing KDTree structure due to the given ordering.
                    ArrayUtils.randomSort(tiles);
                    // insert tileDescriptors into tree
                    var _iteratorNormalCompletion46 = true;
                    var _didIteratorError46 = false;
                    var _iteratorError46 = undefined;

                    try {
                        for (var _iterator46 = (tiles || [])[Symbol.iterator](), _step46; !(_iteratorNormalCompletion46 = (_step46 = _iterator46.next()).done); _iteratorNormalCompletion46 = true) {
                            var tile = _step46.value;

                            // insert a new node in the tree, mapping kdKey to tile
                            tileTree.insert(tile.kdKey, tile);
                            // save mapping from tile ID to TileDescriptor so it can be excluded later
                            this.tileLookup.set(tileTree, tile.tileID, tile);
                        }
                        // collective bounds changed
                        // Weave automatically triggers callbacks when all tasks complete
                    } catch (err) {
                        _didIteratorError46 = true;
                        _iteratorError46 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion46 && _iterator46.return) {
                                _iterator46.return();
                            }
                        } finally {
                            if (_didIteratorError46) {
                                throw _iteratorError46;
                            }
                        }
                    }

                    if (!Weave.isBusy(this.metadataCallbacks)) this.metadataCallbacks.triggerCallbacks();
                }
            }, {
                key: "setGeometryType",
                value: function setGeometryType(value) {
                    if (this._currentGeometryType == value) return;
                    this._currentGeometryType = value;
                    //TEMPORARY SOLUTION -- copy type to all existing geometries
                    var _iteratorNormalCompletion47 = true;
                    var _didIteratorError47 = false;
                    var _iteratorError47 = undefined;

                    try {
                        for (var _iterator47 = (this.geometries || [])[Symbol.iterator](), _step47; !(_iteratorNormalCompletion47 = (_step47 = _iterator47.next()).done); _iteratorNormalCompletion47 = true) {
                            var geom = _step47.value;

                            if (geom != null) geom.geomType = value;
                        }
                    } catch (err) {
                        _didIteratorError47 = true;
                        _iteratorError47 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion47 && _iterator47.return) {
                                _iterator47.return();
                            }
                        } finally {
                            if (_didIteratorError47) {
                                throw _iteratorError47;
                            }
                        }
                    }
                }
                /**
                 * This extracts metadata from a ByteArray.
                 * Callbacks are triggered when all active decoding tasks are completed.
                 */

            }, {
                key: "decodeMetadataStream",
                value: function decodeMetadataStream(stream) {
                    var _this99 = this;

                    var task = function task(stopTime) {
                        //JS.log("decodeMetadataStream",_queuedStreamDictionary[stream],hex(stream));
                        // declare temp variables
                        var flag;
                        var byte;
                        var vertexID;
                        var geometry;
                        var geometryID;
                        var key;
                        // read objects from stream
                        while (stream.position < stream.length) {
                            flag = stream.readInt();
                            if (flag < 0) {
                                var tileID = -1 - flag; // decode negativeTileID
                                var tile = _this99.tileLookup.get(_this99.metadataTiles, tileID);
                                if (tile) {
                                    tile.exclude = true;
                                    flag = stream.readInt();
                                    if (flag < 0) _this99.streamVersion = -flag;else stream.position -= 4; // version 0; rewind
                                    if (GeometryStreamDecoder_1.debug) console.log("got metadata tileID=" + tileID + "; " + stream.position + '/' + stream.length);
                                } else {
                                    // something went wrong
                                    // either the tileDescriptors were not requested yet,
                                    // or the service is returning incorrect data.
                                    console.error("ERROR! decodeMetadataStream(): tileID " + tileID + " is out of range");
                                    break;
                                }
                                // allow resuming later after finding a tileID.
                                if (Date.now() > stopTime) return stream.position / stream.length;
                            } else {
                                geometryID = flag;
                                // read geometry key (null-terminated string)
                                key = WeaveAPI.QKeyManager.getQKey(_this99._keyType, _this99.readString(stream));
                                // initialize geometry at geometryID
                                geometry = Weave.AS(_this99.geometries[geometryID], GeneralizedGeometry);
                                if (!geometry) _this99.geometries[geometryID] = geometry = new GeneralizedGeometry(_this99._currentGeometryType);
                                // save mapping from key to geom
                                var geomsForKey = _this99.map_key_geoms.get(key);
                                if (!geomsForKey) {
                                    _this99.keys.push(key); // keep track of unique keys
                                    _this99.map_key_geoms.set(key, geomsForKey = []);
                                }
                                geomsForKey.push(geometry);
                                // read bounds xMin, yMin, xMax, yMax
                                geometry.bounds.setBounds(stream.readDouble(), stream.readDouble(), stream.readDouble(), stream.readDouble());
                                //JS.log("got metadata: geometryID=" + flag + " key=" + key + " bounds=" + geometry.bounds);
                                // read part markers
                                var prev = 0;
                                while (stream.position < stream.length) {
                                    vertexID = stream.readInt(); // read next vertexID
                                    //JS.log("vID=",vertexID);
                                    if (vertexID < 0) break; // there are no more vertexIDs
                                    geometry.addPartMarker(prev, vertexID);
                                    prev = vertexID;
                                }
                                if (prev > 0) geometry.addPartMarker(prev, Number.MAX_VALUE);
                                // if flag is < -1, it means the shapeType follows
                                if (vertexID < -1) {
                                    _this99.readShapeType(stream);
                                    if (vertexID < -2) _this99._projectionWKT = _this99.readString(stream);
                                }
                            }
                        }
                        return 1; // done
                    };
                    // Weave automatically triggers callbacks when all tasks complete
                    // high priority because metadata affects keys and keys are a prerequisite for many things
                    WeaveAPI.Scheduler.startTask(this.metadataCallbacks, task, WeaveAPI.TASK_PRIORITY_HIGH);
                }
            }, {
                key: "readShapeType",
                value: function readShapeType(stream) {
                    /*
                    0 	Null Shape 	Empty ST_Geometry
                    
                    1 	Point 	ST_Point
                    21 	PointM 	ST_Point with measures
                    
                    8 	MultiPoint 	ST_MultiPoint
                    28 	MultiPointM 	ST_MultiPoint with measures
                    
                    3 	PolyLine 	ST_MultiLineString
                    23 	PolyLineM 	ST_MultiLineString with measures
                    
                    5 	Polygon 	ST_MultiPolygon
                    25 	PolygonM 	ST_MultiPolygon with measures
                    */
                    var type = stream.readInt();
                    //JS.log("shapeType",flag);
                    switch (type) {
                        //Point
                        case 1:
                        case 21:
                        //MultiPoint
                        case 8:
                        case 28:
                            this.setGeometryType(GeometryType.POINT);
                            break;
                        //PolyLine
                        case 3:
                        case 23:
                            this.setGeometryType(GeometryType.LINE);
                            break;
                        //Polygon
                        case 5:
                        case 25:
                            this.setGeometryType(GeometryType.POLYGON);
                            break;
                        default:
                    }
                }
            }, {
                key: "readString",
                value: function readString(stream) {
                    var start = stream.position;
                    while (stream.position < stream.length) {
                        var byte = stream.readByte();
                        if (byte == 0) break;
                    }
                    var end = stream.position - 1;
                    stream.position = start;
                    var str = stream.readUTFBytes(end - start);
                    stream.position = end + 1;
                    return str;
                }
                /**
                 * This extracts points from a ByteArray.
                 * Callbacks are triggered when all active decoding tasks are completed.
                 */

            }, {
                key: "decodeGeometryStream",
                value: function decodeGeometryStream(stream) {
                    var _this100 = this;

                    var task = function task(stopTime) {
                        //JS.log("decodeGeometryStream",_queuedStreamDictionary[stream],hex(stream));
                        // declare temp variables
                        var i;
                        var flag;
                        var geometryID;
                        var vertexID;
                        var x,
                            y,
                            importance = 0;
                        // read objects from stream
                        while (stream.position < stream.length) {
                            flag = stream.readInt();
                            //JS.log("flag",flag);
                            if (flag < 0) {
                                _this100.totalGeomTiles++;
                                var tileID = -1 - flag; // decode negativeTileID
                                var tile = _this100.tileLookup.get(_this100.geometryTiles, tileID);
                                if (tile) {
                                    tile.exclude = true;
                                    flag = stream.readInt();
                                    if (flag < 0) _this100.streamVersion = -flag;else stream.position -= 4; // version 0; rewind
                                    if (GeometryStreamDecoder_1.debug) console.log("got geometry tileID=" + tileID + "; " + stream.length);
                                } else {
                                    // something went wrong
                                    // either the tileDescriptors were not requested yet,
                                    // or the service is returning incorrect data.
                                    console.error("ERROR! decodeGeometryStream(): tileID " + tileID + " is out of range");
                                    break;
                                }
                                // allow resuming later after finding a tileID.
                                if (Date.now() > stopTime) return stream.position / stream.length;
                            } else {
                                _this100.totalVertices++;
                                geometryID = flag;
                                // reset lists of IDs
                                GeometryStreamDecoder_1.geometryIDArray.length = 0;
                                GeometryStreamDecoder_1.vertexIDArray.length = 0;
                                GeometryStreamDecoder_1.geometryIDArray.push(geometryID); // save first geometryID
                                while (stream.position < stream.length) {
                                    vertexID = stream.readInt(); // read vertexID for current geometryID
                                    if (vertexID < 0) {
                                        vertexID = -1 - vertexID; // decode negativeVertexID
                                        GeometryStreamDecoder_1.vertexIDArray.push(vertexID); // save vertexID for previous geometryID
                                        break; // this was the last vertexID
                                    }
                                    GeometryStreamDecoder_1.vertexIDArray.push(vertexID); // save vertexID for previous geometryID
                                    geometryID = stream.readInt(); // read next geometryID
                                    if (geometryID == -2) GeometryStreamDecoder_1.vertexIDArray.push(stream.readInt()); // read end-of-part vertexID
                                    if (geometryID < 0) break;
                                    GeometryStreamDecoder_1.geometryIDArray.push(geometryID); // save next geometryID
                                }
                                if (geometryID < 0) {
                                    importance = geometryID; // used as flag for polygon marker
                                    if (GeometryStreamDecoder_1.vertexIDArray.length == 1) GeometryStreamDecoder_1.vertexIDArray.unshift(0);
                                } else {
                                    //JS.log("geomIDs",geometryIDArray);
                                    //JS.log("vIDs",vertexIDArray);
                                    // read coordinates and importance value
                                    x = stream.readDouble();
                                    y = stream.readDouble();
                                    importance = stream.readFloat();
                                }
                                // save vertex in all corresponding geometries
                                for (i = GeometryStreamDecoder_1.geometryIDArray.length; i--;) {
                                    //JS.log("geom "+geometryIDArray[i]+" insert "+vertexIDArray[i]+" "+importance+" "+x+" "+y);
                                    geometryID = GeometryStreamDecoder_1.geometryIDArray[i];
                                    vertexID = GeometryStreamDecoder_1.vertexIDArray[i];
                                    var geometry = Weave.AS(_this100.geometries[geometryID], GeneralizedGeometry);
                                    if (!geometry) _this100.geometries[geometryID] = geometry = new GeneralizedGeometry(_this100._currentGeometryType);
                                    if (importance < 0) geometry.addPartMarker(vertexID, GeometryStreamDecoder_1.vertexIDArray[i + 1]);else geometry.addPoint(vertexID, importance, x, y);
                                }
                            }
                        }
                        return 1; // done
                    };
                    // Weave automatically triggers callbacks when all tasks complete
                    // low priority because the geometries can still be used even without all the detail.
                    WeaveAPI.Scheduler.startTask(this, task, WeaveAPI.TASK_PRIORITY_NORMAL);
                }
            }, {
                key: "keyType",
                set: function set(value) {
                    this._keyType = value;
                }
            }]);

            return GeometryStreamDecoder;
        }();
        GeometryStreamDecoder.debug = false;
        // TODO these should be static variables
        /**
         * These constants define indices in a KDKey corresponding to the different KDTree dimensions.
         */
        GeometryStreamDecoder.XMIN_INDEX = 0;
        GeometryStreamDecoder.YMIN_INDEX = 1;
        GeometryStreamDecoder.XMAX_INDEX = 2;
        GeometryStreamDecoder.YMAX_INDEX = 3;
        GeometryStreamDecoder.IMAX_INDEX = 4;
        GeometryStreamDecoder.KD_DIMENSIONALITY = 5;
        // reusable temporary objects to reduce GC activity
        GeometryStreamDecoder.geometryIDArray = []; // temporary list of geometryIDs
        GeometryStreamDecoder.vertexIDArray = []; // temporary list of vertexIDs
        GeometryStreamDecoder = GeometryStreamDecoder_1 = __decorate([Weave.classInfo({ id: "weavejs.geom.GeometryStreamDecoder" })], GeometryStreamDecoder);
        geom_5.GeometryStreamDecoder = GeometryStreamDecoder;

        var TileDescriptor = function TileDescriptor(kdKey, tileID) {
            _classCallCheck(this, TileDescriptor);

            this.exclude = false;
            this.kdKey = kdKey;
            this.tileID = tileID;
        };
    })(geom = weavejs.geom || (weavejs.geom = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key_3) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IDisposableObject = weavejs.api.core.IDisposableObject;
            var IKeySet = weavejs.api.data.IKeySet;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var DebugUtils = weavejs.util.DebugUtils;
            /**
             * This key set is the union of several other key sets.  It has no session state.
             *
             * @author adufilie
             */
            var KeySetUnion_1 = void 0;
            var KeySetUnion = KeySetUnion_1 = function () {
                /**
                 * @param keyInclusionLogic A function that accepts an IQualifiedKey and returns true or false.
                 */
                function KeySetUnion() {
                    var _this101 = this;

                    var keyInclusionLogic = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, KeySetUnion);

                    /**
                     * This will be used to determine whether or not to include a key.
                     */
                    this._keyInclusionLogic = null;
                    this._keySets = []; // Array of IKeySet
                    this._allKeys = []; // Array of IQualifiedKey
                    this.map_key = new WeakMap(); // IQualifiedKey -> Boolean
                    /**
                     * Use this to check asynchronous task busy status.  This is kept separate because if we report busy status we need to
                     * trigger callbacks when an asynchronous task completes, but we don't want to trigger KeySetUnion callbacks when nothing
                     * changes as a result of completing the asynchronous task.
                     */
                    this.busyStatus = Weave.disposableChild(this, CallbackCollection); // separate owner for the async task to avoid affecting our busy status
                    this.asyncIterate = function (stopTime) {
                        for (; _this101._asyncKeySetIndex < _this101._keySets.length; _this101._asyncKeySetIndex++) {
                            if (_this101._asyncKeys == null) {
                                _this101._asyncKeys = _this101._keySets[_this101._asyncKeySetIndex].keys;
                                _this101._asyncKeyIndex = 0;
                            }
                            for (; _this101._asyncKeys && _this101._asyncKeyIndex < _this101._asyncKeys.length; _this101._asyncKeyIndex++) {
                                if (Date.now() > stopTime) return (_this101._asyncKeySetIndex + _this101._asyncKeyIndex / _this101._asyncKeys.length) / _this101._keySets.length;
                                var key = _this101._asyncKeys[_this101._asyncKeyIndex];
                                if (!_this101._async_map_key.has(key)) {
                                    var includeKey = _this101._keyInclusionLogic == null ? true : _this101._keyInclusionLogic(key);
                                    _this101._async_map_key.set(key, includeKey);
                                    if (includeKey) {
                                        _this101._asyncAllKeys.push(key);
                                        // keep track of how many keys we saw both previously and currently
                                        if (_this101.map_key.get(key) === true) _this101._prevCompareCounter++;
                                    }
                                }
                            }
                            _this101._asyncKeys = null;
                        }
                        return 1; // avoids division by zero
                    };
                    this.asyncComplete = function () {
                        // detect change
                        if (_this101._allKeys.length != _this101._asyncAllKeys.length || _this101._allKeys.length != _this101._prevCompareCounter) {
                            _this101._allKeys = _this101._asyncAllKeys;
                            _this101.map_key = _this101._async_map_key;
                            Weave.getCallbacks(_this101).triggerCallbacks();
                        }
                        _this101.busyStatus.triggerCallbacks();
                    };
                    this._keyInclusionLogic = keyInclusionLogic;
                    if (KeySetUnion_1.debug) Weave.getCallbacks(this).addImmediateCallback(this, this._firstCallback);
                }

                _createClass(KeySetUnion, [{
                    key: "_firstCallback",
                    value: function _firstCallback() {
                        DebugUtils.debugTrace(this, 'trigger', this.keys.length, 'keys');
                    }
                    /**
                     * This will add an IKeySet as a dependency and include its keys in the union.
                     * @param keySet
                     */

                }, {
                    key: "addKeySetDependency",
                    value: function addKeySetDependency(keySet) {
                        if (this._keySets.indexOf(keySet) < 0) {
                            this._keySets.push(keySet);
                            Weave.getCallbacks(keySet).addDisposeCallback(this, this.asyncStart);
                            Weave.getCallbacks(keySet).addImmediateCallback(this, this.asyncStart, true);
                        }
                    }
                    /**
                     * This is a list of the IQualifiedKey objects that define the key set.
                     */

                }, {
                    key: "containsKey",

                    /**
                     * @param key A IQualifiedKey object to check.
                     * @return true if the given key is included in the set.
                     */
                    value: function containsKey(key) {
                        return this.map_key.get(key) === true;
                    }
                }, {
                    key: "asyncStart",
                    value: function asyncStart() {
                        // remove disposed key sets
                        for (var i = this._keySets.length; i--;) {
                            if (Weave.wasDisposed(this._keySets[i])) this._keySets.splice(i, 1);
                        } // restart async task
                        this._prevCompareCounter = 0;
                        this._asyncAllKeys = [];
                        this._async_map_key = new WeakMap();
                        this._asyncKeys = null;
                        this._asyncKeySetIndex = 0;
                        this._asyncKeyIndex = 0;
                        // high priority because all visualizations depend on key sets
                        WeaveAPI.Scheduler.startTask(this.busyStatus, this.asyncIterate, WeaveAPI.TASK_PRIORITY_HIGH, this.asyncComplete, Weave.lang("Computing the union of {0} key sets", this._keySets.length));
                    }
                }, {
                    key: "dispose",
                    value: function dispose() {
                        this._keySets = null;
                        this._allKeys = null;
                        this.map_key = null;
                        this._async_map_key = null;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this._allKeys;
                    }
                }]);

                return KeySetUnion;
            }();
            KeySetUnion.debug = false;
            KeySetUnion = KeySetUnion_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.KeySetUnion", interfaces: [IKeySet, IDisposableObject] })], KeySetUnion);
            key_3.KeySetUnion = KeySetUnion;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var StandardLib = weavejs.util.StandardLib;

            var DateFormat = function () {
                function DateFormat() {
                    _classCallCheck(this, DateFormat);
                }

                _createClass(DateFormat, null, [{
                    key: "getSuggestions",
                    value: function getSuggestions() {
                        return DateFormat.ADDITIONAL_SUGGESTIONS.concat(DateFormat.FOR_AUTO_DETECT);
                    }
                }, {
                    key: "convertDateFormat_c_to_moment",
                    value: function convertDateFormat_c_to_moment(format) {
                        if (format && format.indexOf('%') >= 0) return StandardLib.replace.apply(StandardLib, [format].concat(DateFormat.dateFormat_replacements_c_to_moment));
                        return format;
                    }
                }]);

                return DateFormat;
            }();

            DateFormat.ADDITIONAL_SUGGESTIONS = ["%Y"];
            DateFormat.FOR_AUTO_DETECT = ['%-d-%b-%y', '%b-%-d-%y', '%-d-%b-%Y', '%b-%-d-%Y', '%Y-%b-%-d', '%-d/%b/%y', '%b/%-d/%y', '%-d/%b/%Y', '%b/%-d/%Y', '%Y/%b/%-d', '%-d.%b.%y', '%b.%-d.%y', '%-d.%b.%Y', '%b.%-d.%Y', '%Y.%b.%-d', '%-d-%-m-%y', '%-m-%-d-%y', '%-d-%-m-%Y', '%-m-%-d-%Y', '%-d/%-m/%y', '%-m/%-d/%y', '%-d/%-m/%Y', '%-m/%-d/%Y', '%Y/%-m/%-d', '%-d.%-m.%y', '%-m.%-d.%y', '%-d.%-m.%Y', '%-m.%-d.%Y', '%Y.%-m.%-d', '%H:%M', '%H:%M:%S', '%H:%M:%S.%Q', '%a, %d %b %Y %H:%M:%S %z',
            // ISO_8601   http://www.thelinuxdaily.com/2014/03/c-function-to-validate-iso-8601-date-formats-using-strptime/
            "%Y-%m-%d", "%y-%m-%d", "%Y-%m-%d %T", "%y-%m-%d %T", "%Y-%m-%dT%T", "%y-%m-%dT%T", "%Y-%m-%dT%TZ", "%y-%m-%dT%TZ", "%Y-%m-%d %TZ", "%y-%m-%d %TZ", "%Y%m%dT%TZ", "%y%m%dT%TZ", "%Y%m%d %TZ", "%y%m%d %TZ", "%Y-%b-%d %T", "%Y-%b-%d %H:%M:%S", "%Y-%b-%d %H:%M:%S.%Q", "%d-%b-%Y %T", "%d-%b-%Y %H:%M:%S", "%d-%b-%Y %H:%M:%S.%Q"];
            DateFormat.dateFormat_replacements_c_to_moment = ['%Y', 'YYYY', '%y', 'YY', '%B', 'MMMM', '%b', 'MMM', '%m', 'MM', '%-m', 'M', '%d', 'DD', '%-d', 'D', '%u', 'E', '%p', 'A', '%H', 'HH', '%-H', 'H', '%I', 'hh', '%-I', 'h', '%A', 'dddd', '%a', 'ddd', '%M', 'mm', '%-M', 'm', '%S', 'ss', '%s', 'X', '%Q', 'SSS', '%z', 'zz', '%Z', 'z', '%%', '%'];
            data.DateFormat = DateFormat;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an interface for parsing and generating CSV data.
             *
             * @author adufilie
             */
            var ICSVParser = function ICSVParser() {
                _classCallCheck(this, ICSVParser);
            };
            ICSVParser = __decorate([Weave.classInfo({ id: "weavejs.api.data.ICSVParser" })], ICSVParser);
            data.ICSVParser = ICSVParser;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var RequestMethod = function RequestMethod() {
            _classCallCheck(this, RequestMethod);
        };

        RequestMethod.GET = 'get';
        RequestMethod.POST = 'post';
        net.RequestMethod = RequestMethod;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * A column reference contains all the information required to retrieve a column of data.
             * This interface requires a function to get a hash value for the column reference that can be used to tell if two references are equal.
             *
             * @author adufilie
             */
            var IColumnReference = function IColumnReference() {
                _classCallCheck(this, IColumnReference);
            };
            IColumnReference = __decorate([Weave.classInfo({ id: "weavejs.api.data.IColumnReference" })], IColumnReference);
            data.IColumnReference = IColumnReference;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            ; /* Added to work around bug in sourcemap generation */
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var ResponseType = function ResponseType() {
            _classCallCheck(this, ResponseType);
        };

        ResponseType.UINT8ARRAY = 'uint8array';
        ResponseType.ARRAYBUFFER = 'arraybuffer';
        ResponseType.BLOB = 'blob';
        ResponseType.DOCUMENT = 'document';
        ResponseType.JSON = 'json';
        ResponseType.TEXT = 'text';
        ResponseType.DATAURI = 'datauri';
        net.ResponseType = ResponseType;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var RequestMethod = weavejs.net.RequestMethod;
        var ResponseType = weavejs.net.ResponseType;

        var URLRequest = function URLRequest() {
            var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

            _classCallCheck(this, URLRequest);

            /**
             * Either "get" or "post"
             * @default "get"
             */
            this.method = RequestMethod.GET;
            /**
             * Can be one of the constants defined in the ResponseType class.
             * @see ResponseType
             */
            this.responseType = ResponseType.UINT8ARRAY;
            this.url = url;
        };

        net.URLRequest = URLRequest;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var core;
    (function (core) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ILocale = weavejs.api.core.ILocale;
        var ResponseType = weavejs.net.ResponseType;
        var URLRequest = weavejs.net.URLRequest;
        var Locale = function () {
            function Locale() {
                _classCallCheck(this, Locale);

                this._reverseLayout = false;
                this._data = {};
            }

            _createClass(Locale, [{
                key: "loadFromUrl",
                value: function loadFromUrl(jsonUrl) {
                    var request = new URLRequest(jsonUrl);
                    request.responseType = ResponseType.JSON;
                    var self = this;
                    return WeaveAPI.URLRequestUtils.request(this, request).then(function (data) {
                        self.data = data;
                    });
                }
            }, {
                key: "getText",
                value: function getText(text) {
                    if (!text) return '';
                    var result;
                    if (this._data.hasOwnProperty(text)) result = this._data[text];else this._data[text] = null;
                    return result || text;
                }
            }, {
                key: "reverseLayout",
                get: function get() {
                    return this._reverseLayout;
                },
                set: function set(value) {
                    this._reverseLayout = value;
                }
            }, {
                key: "data",
                get: function get() {
                    return this._data;
                },
                set: function set(value) {
                    this._data = value;
                }
            }]);

            return Locale;
        }();
        Locale = __decorate([Weave.classInfo({ id: "weavejs.core.Locale", interfaces: [ILocale] })], Locale);
        core.Locale = Locale;
    })(core = weavejs.core || (weavejs.core = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            var IURLRequestUtils = function IURLRequestUtils() {
                _classCallCheck(this, IURLRequestUtils);
            };

            net.IURLRequestUtils = IURLRequestUtils;
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ILinkableObject = weavejs.api.core.ILinkableObject;
        var IURLRequestUtils = weavejs.api.net.IURLRequestUtils;
        var Dictionary2D = weavejs.util.Dictionary2D;
        var StandardLib = weavejs.util.StandardLib;
        var WeavePromise = weavejs.util.WeavePromise;
        var URLRequestUtils_1 = void 0;
        var URLRequestUtils = URLRequestUtils_1 = function () {
            function URLRequestUtils() {
                _classCallCheck(this, URLRequestUtils);

                this.d2d_weaveRoot_fileName_promise = new Dictionary2D(true);
            }

            _createClass(URLRequestUtils, [{
                key: "byteArrayToDataUri",
                value: function byteArrayToDataUri(byteArray, mimeType) {
                    return "data:" + (mimeType || '') + ';base64,' + btoa(StandardLib.byteArrayToString(byteArray));
                }
            }, {
                key: "request",
                value: function request(relevantContext, urlRequest) {
                    var _this102 = this;

                    var responseType = urlRequest.responseType || net.ResponseType.UINT8ARRAY;
                    var promise; // TODO
                    if (String(urlRequest.url).indexOf(URLRequestUtils_1.LOCAL_FILE_URL_SCHEME) == 0) {
                        var fileName = String(urlRequest.url).substr(URLRequestUtils_1.LOCAL_FILE_URL_SCHEME.length);
                        var weaveRoot = Weave.getRoot(relevantContext);
                        var cachedPromise = this.get_d2d_weaveRoot_fileName_promise(weaveRoot, fileName);
                        if (cachedPromise.getResult() == null && cachedPromise.getError() == null) {
                            if (weaveRoot) this.removeLocalFile(weaveRoot, fileName);else cachedPromise.setError(new Error(Weave.lang("To request a " + URLRequestUtils_1.LOCAL_FILE_URL_SCHEME + " URL, the relevantContext must be an ILinkableObject registered under an instance of Weave.")));
                        }
                        promise = new WeavePromise(relevantContext).setResult(cachedPromise).then(function (byteArray) {
                            switch (responseType) {
                                default:
                                case net.ResponseType.TEXT:
                                    return StandardLib.byteArrayToString(byteArray);
                                case net.ResponseType.JSON:
                                    return JSON.parse(StandardLib.byteArrayToString(byteArray));
                                case net.ResponseType.BLOB:
                                    return new Blob([byteArray.buffer]);
                                case net.ResponseType.ARRAYBUFFER:
                                    return byteArray.buffer;
                                case net.ResponseType.DOCUMENT:
                                    throw new Error("responseType " + net.ResponseType.DOCUMENT + " not supported for local files");
                                case net.ResponseType.UINT8ARRAY:
                                    return byteArray;
                                case net.ResponseType.DATAURI:
                                    return _this102.byteArrayToDataUri(byteArray, urlRequest.mimeType);
                            }
                        });
                    } else {
                        //TODO WeavePromise needs a way to specify a dispose handler (new WeavePromise(context, resolver, cleanup))
                        // so we can cancel the request automatically when the promise is disposed
                        promise = new WeavePromise(relevantContext, function (resolve, reject) {
                            var done = false;
                            var ie9_XHR = window.XDomainRequest;
                            var XHR = ie9_XHR || XMLHttpRequest;
                            var xhr = new XHR();
                            xhr.open(urlRequest.method || net.RequestMethod.GET, urlRequest.url, true);
                            for (var name in urlRequest.requestHeaders) {
                                xhr.setRequestHeader(name, urlRequest.requestHeaders[name]);
                            }if (responseType === net.ResponseType.UINT8ARRAY || responseType === net.ResponseType.DATAURI) xhr.responseType = net.ResponseType.ARRAYBUFFER;else xhr.responseType = responseType;
                            xhr.onload = function () {
                                var result = ie9_XHR ? xhr.responseText : xhr.response;
                                if (responseType === net.ResponseType.UINT8ARRAY) result = new Uint8Array(result);
                                if (responseType === net.ResponseType.DATAURI) result = _this102.byteArrayToDataUri(new Uint8Array(result), urlRequest.mimeType);
                                if (xhr.status < 200 || xhr.status > 299) {
                                    reject(xhr);
                                    done = true;
                                } else {
                                    resolve(result);
                                    done = true;
                                }
                            };
                            xhr.onerror = function () {
                                if (!done) reject(xhr);
                                done = true;
                            };
                            xhr.onreadystatechange = function () {
                                if (xhr.readyState == 4 && xhr.status != 200) {
                                    setTimeout(function () {
                                        if (!done) reject(xhr);
                                        done = true;
                                    }, 1000);
                                }
                            };
                            xhr.send(urlRequest.data);
                        });
                    }
                    var ilo = Weave.AS(relevantContext, ILinkableObject);
                    if (ilo) WeaveAPI.ProgressIndicator.addTask(promise, ilo, urlRequest.url);
                    return promise;
                }
            }, {
                key: "get_d2d_weaveRoot_fileName_promise",
                value: function get_d2d_weaveRoot_fileName_promise(weaveRoot, fileName) {
                    var context = weaveRoot || this; // use (this) instead of (null) to avoid WeakMap invalid key error
                    var promise = this.d2d_weaveRoot_fileName_promise.get(context, fileName);
                    if (!promise) {
                        promise = new WeavePromise(context).setResult(null);
                        this.d2d_weaveRoot_fileName_promise.set(context, fileName, promise);
                    }
                    return promise;
                }
            }, {
                key: "saveLocalFile",
                value: function saveLocalFile(weaveRoot, fileName, byteArray) {
                    var promise = this.get_d2d_weaveRoot_fileName_promise(weaveRoot, fileName);
                    promise.setResult(byteArray);
                    return URLRequestUtils_1.LOCAL_FILE_URL_SCHEME + fileName;
                }
            }, {
                key: "getLocalFile",
                value: function getLocalFile(weaveRoot, fileName) {
                    var promise = this.get_d2d_weaveRoot_fileName_promise(weaveRoot, fileName);
                    var result = promise.getResult();
                    return result;
                }
            }, {
                key: "removeLocalFile",
                value: function removeLocalFile(weaveRoot, fileName) {
                    var promise = this.get_d2d_weaveRoot_fileName_promise(weaveRoot, fileName);
                    promise.setError(new Error(Weave.lang("Local file missing: {0}", fileName)));
                }
            }, {
                key: "getLocalFileNames",
                value: function getLocalFileNames(weaveRoot) {
                    return this.d2d_weaveRoot_fileName_promise.secondaryKeys(weaveRoot).sort();
                }
            }]);

            return URLRequestUtils;
        }();
        URLRequestUtils.LOCAL_FILE_URL_SCHEME = 'local://';
        URLRequestUtils = URLRequestUtils_1 = __decorate([Weave.classInfo({ id: "weavejs.net.URLRequestUtils", interfaces: [IURLRequestUtils] })], URLRequestUtils);
        net.URLRequestUtils = URLRequestUtils;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/*
    Weave (Web-based Analysis and Visualization Environment)
    Copyright (C) 2008-2011 University of Massachusetts Lowell
    
    This file is a part of Weave.
    
    Weave is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License, Version 3,
    as published by the Free Software Foundation.
    
    Weave is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    
    You should have received a copy of the GNU General Public License
    along with Weave.  If not, see <http://www.gnu.org/licenses/>.
*/
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ICSVParser = weavejs.api.data.ICSVParser;
        var AsyncSort = weavejs.util.AsyncSort;
        var StandardLib = weavejs.util.StandardLib;
        /**
         * This is an all-static class containing functions to parse and generate valid CSV files.
         * Ported from AutoIt Script to Flex. Original author: adufilie
         *
         * @author skolman
         * @author adufilie
         */
        var CSVParser_1 = void 0;
        var CSVParser = CSVParser_1 = function () {
            /**
             * @param delimiter
             * @param quote
             * @param asyncMode If this is set to true, parseCSV() will work asynchronously and trigger callbacks when it finishes.
             *                  Note that if asyncMode is enabled, you can only parse one CSV string at a time.
             */
            function CSVParser() {
                var asyncMode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                var _this103 = this;

                var delimiter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ',';
                var quote = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '"';

                _classCallCheck(this, CSVParser);

                this.delimiter = ',';
                this.quote = '"';
                this.parseTokens = true;
                this.parseDone = function () {
                    // if there is more than one row and last row is empty,
                    // remove last row assuming it is there because of a newline at the end of the file.
                    for (var iRow = _this103.csvDataArray.length; iRow--;) {
                        var dataLine = _this103.csvDataArray[iRow];
                        if (dataLine.length == 1 && dataLine[0] == '') _this103.csvDataArray.splice(iRow, 1);
                    }
                    if (_this103.asyncMode) Weave.getCallbacks(_this103).triggerCallbacks();
                };
                this.asyncMode = asyncMode;
                if (delimiter && delimiter.length == 1) this.delimiter = delimiter;
                if (quote && quote.length == 1) this.quote = quote;
            }
            /**
             * @return  The resulting two-dimensional Array from the last call to parseCSV().
             */


            _createClass(CSVParser, [{
                key: "parseCSV",
                value: function parseCSV(csvData) {
                    // initialization
                    this.csvData = csvData;
                    this.csvDataArray = [];
                    this.i = 0;
                    this.row = 0;
                    this.col = 0;
                    this.escaped = false;
                    if (this.asyncMode) {
                        // high priority because preparing data is often the first thing we need to do
                        WeaveAPI.Scheduler.startTask(this, this.parseIterate, WeaveAPI.TASK_PRIORITY_HIGH, this.parseDone);
                    } else {
                        this.parseIterate(Number.MAX_VALUE);
                        this.parseDone();
                    }
                    return this.csvDataArray;
                }
            }, {
                key: "parseIterate",
                value: function parseIterate(stopTime) {
                    // run initialization code on first iteration
                    if (this.i == 0) {
                        if (!this.csvData) return 1; // done
                        // start off first row with an empty string token
                        this.csvDataArray[this.row] = [''];
                    }
                    while (Date.now() < stopTime) {
                        if (this.i >= this.csvData.length) return 1; // done
                        var currentChar = this.csvData.charAt(this.i);
                        var twoChar = currentChar + this.csvData.charAt(this.i + 1);
                        if (this.escaped) {
                            if (twoChar == this.quote + this.quote) {
                                this.csvDataArray[this.row][this.col] += this.parseTokens ? currentChar : twoChar; //append quote(s) to current token
                                this.i += 1; //skip second quote mark
                            } else if (currentChar == this.quote) {
                                this.escaped = false;
                                if (!this.parseTokens) {
                                    this.csvDataArray[this.row][this.col] += currentChar; //append quote to current token
                                }
                            } else {
                                this.csvDataArray[this.row][this.col] += currentChar; //append quotes to current token
                            }
                        } else {
                            if (twoChar == this.delimiter + this.quote) {
                                this.escaped = true;
                                this.col += 1;
                                this.csvDataArray[this.row][this.col] = this.parseTokens ? '' : this.quote;
                                this.i += 1; //skip quote mark
                            } else if (currentChar == this.quote && this.csvDataArray[this.row][this.col] == '') {
                                this.escaped = true;
                                if (!this.parseTokens) this.csvDataArray[this.row][this.col] += currentChar;
                            } else if (currentChar == this.delimiter) {
                                this.col += 1;
                                this.csvDataArray[this.row][this.col] = '';
                            } else if (twoChar == CSVParser_1.CRLF) {
                                this.i += 1; //skip line feed
                                this.row += 1;
                                this.col = 0;
                                this.csvDataArray[this.row] = [''];
                            } else if (currentChar == CSVParser_1.CR) {
                                this.row += 1;
                                this.col = 0;
                                this.csvDataArray[this.row] = [''];
                            } else if (currentChar == CSVParser_1.LF) {
                                this.row += 1;
                                this.col = 0;
                                this.csvDataArray[this.row] = [''];
                            } else this.csvDataArray[this.row][this.col] += currentChar;
                        }
                        this.i++;
                    }
                    return this.i / this.csvData.length;
                }
            }, {
                key: "createCSV",
                value: function createCSV(rows) {
                    var lines = new Array(rows.length);
                    for (var i = rows.length; i--;) {
                        var tokens = new Array(rows[i].length);
                        for (var j = tokens.length; j--;) {
                            tokens[j] = this.createCSVToken(rows[i][j]);
                        }lines[i] = tokens.join(this.delimiter);
                    }
                    var csvData = lines.join(CSVParser_1.LF);
                    return csvData;
                }
            }, {
                key: "parseCSVRow",
                value: function parseCSVRow(csvData) {
                    if (csvData == null) return null;
                    var rows = this.parseCSV(csvData);
                    if (rows.length == 0) return rows;
                    if (rows.length == 1) return rows[0];
                    // flatten
                    return Array.prototype.concat.apply([], rows);
                }
            }, {
                key: "createCSVRow",
                value: function createCSVRow(row) {
                    return this.createCSV([row]);
                }
            }, {
                key: "parseCSVToken",
                value: function parseCSVToken(token) {
                    token = String(token);
                    var parsedToken = '';
                    var tokenLength = token.length;
                    if (token.charAt(0) == this.quote) {
                        var escaped = true;
                        for (var i = 1; i <= tokenLength; i++) {
                            var currentChar = token.charAt(i);
                            var twoChar = currentChar + token.charAt(i + 1);
                            if (twoChar == this.quote + this.quote) {
                                i += 1;
                                parsedToken += this.quote;
                            } else if (currentChar == this.quote && escaped) {
                                escaped = false;
                            } else {
                                parsedToken += currentChar;
                            }
                        }
                    } else {
                        parsedToken = token;
                    }
                    return parsedToken;
                }
            }, {
                key: "createCSVToken",
                value: function createCSVToken(str) {
                    str = String(str);
                    if (str == null) str = '';
                    // determine if quotes are necessary
                    if (str.length > 0 && str.indexOf(this.quote) < 0 && str.indexOf(this.delimiter) < 0 && str.indexOf(CSVParser_1.LF) < 0 && str.indexOf(CSVParser_1.CR) < 0 && str == StandardLib.trim(str)) {
                        return str;
                    }
                    var token = this.quote;
                    for (var i = 0; i <= str.length; i++) {
                        var currentChar = str.charAt(i);
                        if (currentChar == this.quote) token += this.quote + this.quote;else token += currentChar;
                    }
                    return token + this.quote;
                }
            }, {
                key: "convertRowsToRecords",
                value: function convertRowsToRecords(rows) {
                    var headerDepth = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;

                    if (rows.length < headerDepth) throw new Error("headerDepth is greater than the number of rows");
                    CSVParser_1.assertHeaderDepth(headerDepth);
                    var records = new Array(rows.length - headerDepth);
                    for (var r = headerDepth; r < rows.length; r++) {
                        var record = {};
                        var row = rows[r];
                        for (var c = 0; c < row.length; c++) {
                            var output = record;
                            var cell = row[c];
                            for (var h = 0; h < headerDepth; h++) {
                                var colName = rows[h][c];
                                if (h < headerDepth - 1) {
                                    if (!output[colName]) output[colName] = {};
                                    output = output[colName];
                                } else output[colName] = cell;
                            }
                        }
                        records[r - headerDepth] = record;
                    }
                    return records;
                }
            }, {
                key: "getRecordFieldNames",
                value: function getRecordFieldNames(records) {
                    var includeNullFields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
                    var headerDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;

                    CSVParser_1.assertHeaderDepth(headerDepth);
                    var nestedFieldNames = {};
                    var _iteratorNormalCompletion48 = true;
                    var _didIteratorError48 = false;
                    var _iteratorError48 = undefined;

                    try {
                        for (var _iterator48 = (records || [])[Symbol.iterator](), _step48; !(_iteratorNormalCompletion48 = (_step48 = _iterator48.next()).done); _iteratorNormalCompletion48 = true) {
                            var record = _step48.value;

                            this._outputNestedFieldNames(record, includeNullFields, nestedFieldNames, headerDepth);
                        }
                    } catch (err) {
                        _didIteratorError48 = true;
                        _iteratorError48 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion48 && _iterator48.return) {
                                _iterator48.return();
                            }
                        } finally {
                            if (_didIteratorError48) {
                                throw _iteratorError48;
                            }
                        }
                    }

                    var fields = [];
                    this._collapseNestedFieldNames(nestedFieldNames, fields);
                    return fields;
                }
            }, {
                key: "_outputNestedFieldNames",
                value: function _outputNestedFieldNames(record, includeNullFields, output, depth) {
                    for (var field in record) {
                        if (includeNullFields || record[field] != null) {
                            if (depth == 1) {
                                output[field] = false;
                            } else {
                                if (!output[field]) output[field] = {};
                                this._outputNestedFieldNames(record[field], includeNullFields, output[field], depth - 1);
                            }
                        }
                    }
                }
            }, {
                key: "_collapseNestedFieldNames",
                value: function _collapseNestedFieldNames(nestedFieldNames, output) {
                    var prefix = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    for (var field in nestedFieldNames) {
                        if (nestedFieldNames[field]) {
                            this._collapseNestedFieldNames(nestedFieldNames[field], output, prefix ? prefix.concat(field) : [field]);
                        } else {
                            if (prefix) output.push(prefix.concat(field)); // output the list of nested field names
                            else output.push(field); // no array when max depth is 1
                        }
                    }
                }
            }, {
                key: "convertRecordsToRows",
                value: function convertRecordsToRows(records) {
                    var columnOrder = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var allowBlankColumns = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
                    var headerDepth = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;

                    CSVParser_1.assertHeaderDepth(headerDepth);
                    var fields = columnOrder;
                    if (fields == null) {
                        fields = this.getRecordFieldNames(records, allowBlankColumns, headerDepth);
                        AsyncSort.sortImmediately(fields);
                    }
                    var r;
                    var c;
                    var cell;
                    var row;
                    var rows = new Array(records.length + headerDepth);
                    // construct multiple header rows from field name chains
                    for (r = 0; r < headerDepth; r++) {
                        row = new Array(fields.length);
                        for (c = 0; c < fields.length; c++) {
                            if (headerDepth > 1) row[c] = fields[c][r] || ''; // fields are Arrays
                            else row[c] = fields[c] || ''; // fields are Strings
                        }
                        rows[r] = row;
                    }
                    for (r = 0; r < records.length; r++) {
                        var record = records[r];
                        row = new Array(fields.length);
                        for (c = 0; c < fields.length; c++) {
                            if (headerDepth == 1) {
                                // fields is an Array of Strings
                                cell = record[fields[c]];
                            } else {
                                // fields is an Array of Arrays
                                cell = record;
                                var _iteratorNormalCompletion49 = true;
                                var _didIteratorError49 = false;
                                var _iteratorError49 = undefined;

                                try {
                                    for (var _iterator49 = (fields[c] || [])[Symbol.iterator](), _step49; !(_iteratorNormalCompletion49 = (_step49 = _iterator49.next()).done); _iteratorNormalCompletion49 = true) {
                                        var field = _step49.value;

                                        if (cell) cell = cell[field];
                                    }
                                } catch (err) {
                                    _didIteratorError49 = true;
                                    _iteratorError49 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion49 && _iterator49.return) {
                                            _iterator49.return();
                                        }
                                    } finally {
                                        if (_didIteratorError49) {
                                            throw _iteratorError49;
                                        }
                                    }
                                }
                            }
                            row[c] = cell != null ? String(cell) : '';
                        }
                        rows[headerDepth + r] = row;
                    }
                    return rows;
                }
            }, {
                key: "parseResult",
                get: function get() {
                    return this.csvDataArray;
                }
            }], [{
                key: "assertHeaderDepth",
                value: function assertHeaderDepth(headerDepth) {
                    if (headerDepth < 1) throw new Error("headerDepth must be > 0");
                }
            }, {
                key: "test",
                value: function test() {
                    if (CSVParser_1._tested) return;
                    CSVParser_1._tested = true;
                    var _ = {};
                    _.parser = WeaveAPI.CSVParser;
                    _.csv = ['internal,internal,public,public,public,private,private,test', 'id,type,title,keyType,dataType,connection,sqlQuery,empty', '2,1,state name,fips,string,resd,' + '"' + 'select fips,name from myschema.state_data' + '"' + ',', '3,1,population,fips,number,resd,' + '"' + 'select fips,pop from myschema.state_data' + '"' + ',', '1,0,state data table'].join('\n');
                    _.table = _.parser.parseCSV(_.csv);
                    _.records = _.parser.convertRowsToRecords(_.table, 2);
                    _.rows = _.parser.convertRecordsToRows(_.records, null, false, 2);
                    _.fields = _.parser.getRecordFieldNames(_.records, false, 2);
                    _.fieldOrder = _.parser.parseCSV('internal,id\ninternal,type\npublic,title\npublic,keyType\npublic,dataType\nprivate,connection\nprivate,sqlQuery');
                    _.rows2 = _.parser.convertRecordsToRows(_.records, _.fieldOrder, false, 2);
                    console.log(_);
                }
            }]);

            return CSVParser;
        }();
        CSVParser.CR = '\r';
        CSVParser.LF = '\n';
        CSVParser.CRLF = '\r\n';
        //test();
        CSVParser._tested = false;
        CSVParser = CSVParser_1 = __decorate([Weave.classInfo({ id: "weavejs.data.CSVParser", interfaces: [ICSVParser] })], CSVParser);
        data.CSVParser = CSVParser;
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key) {
            var WeaveAPI = weavejs.WeaveAPI;
            var DataTypes = weavejs.api.data.DataTypes;
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            var IQualifiedKeyManager = weavejs.api.data.IQualifiedKeyManager;
            var CSVParser = weavejs.data.CSVParser;
            var Dictionary2D = weavejs.util.Dictionary2D;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var WeavePromise = weavejs.util.WeavePromise;
            /**
             * This class manages a global list of IQualifiedKey objects.
             *
             * The getQKey() function must be used to get IQualifiedKey objects.  Each QKey returned by
             * getQKey() with the same parameters will be the same object, so IQualifiedKeys can be compared
             * with the == operator or used as keys in a Dictionary.
             *
             * @author adufilie
             */
            var QKeyManager_1 = void 0;
            var QKeyManager = QKeyManager_1 = function () {
                function QKeyManager() {
                    _classCallCheck(this, QKeyManager);

                    /**
                     * Maps IQualifiedKey to keyType - faster than reading the keyType property of a QKey
                     */
                    this.map_qkey_keyType = new WeakMap();
                    /**
                     * Maps IQualifiedKey to localName - faster than reading the localName property of a QKey
                     */
                    this.map_qkey_localName = new WeakMap();
                    /**
                     * keyType -> Object( localName -> IQualifiedKey )
                     */
                    this.d2d_keyType_localName_qkey = new Dictionary2D();
                    this.map_qkeyString_qkey = new Map();
                    this.map_context_qkeyGetter = new WeakMap();
                    this._keyBuffer = []; // holds one key
                    this.array_numberToQKey = [];
                }

                _createClass(QKeyManager, [{
                    key: "stringToQKey",
                    value: function stringToQKey(qkeyString) {
                        var qkey = this.map_qkeyString_qkey.get(qkeyString);
                        if (qkey) return qkey;
                        if (!this.csvParser) this.csvParser = new CSVParser(false, QKeyManager_1.DELIMITER);
                        var a = this.csvParser.parseCSVRow(qkeyString);
                        if (a.length != 2) throw new Error("qkeyString must be formatted like " + this.csvParser.createCSVRow(['keyType', 'localName']));
                        return this.getQKey(a[0], a[1]);
                    }
                }, {
                    key: "numberToQKey",
                    value: function numberToQKey(qkeyNumber) {
                        return this.array_numberToQKey[qkeyNumber];
                    }
                    /**
                     * Get the QKey object for a given key type and key.
                     *
                     * @return The QKey object for this type and key.
                     */

                }, {
                    key: "getQKey",
                    value: function getQKey(keyType, localName) {
                        this._keyBuffer[0] = localName;
                        this.getQKeys_range(keyType, this._keyBuffer, 0, 1, this._keyBuffer);
                        return Weave.AS(this._keyBuffer[0], IQualifiedKey);
                    }
                }, {
                    key: "init_map_localName_qkey",
                    value: function init_map_localName_qkey(keyType) {
                        // key type not seen before, so initialize it
                        var map_localName_qkey;
                        // use & prefer the same map associated with the trimmed keyType
                        var trimmedKeyType = StandardLib.trim(keyType);
                        if (trimmedKeyType != keyType) map_localName_qkey = this.d2d_keyType_localName_qkey.map.get(trimmedKeyType) || this.init_map_localName_qkey(trimmedKeyType);else map_localName_qkey = new Map();
                        this.d2d_keyType_localName_qkey.map.set(keyType, map_localName_qkey);
                        return map_localName_qkey;
                    }
                    /**
                     * @param output An output Array for IQualifiedKeys.
                     */

                }, {
                    key: "getQKeys_range",
                    value: function getQKeys_range(keyType, keyStrings, iStart, iEnd, output) {
                        if (!keyType) keyType = DataTypes.STRING;
                        var map_localName_qkey = this.d2d_keyType_localName_qkey.map.get(keyType);
                        if (!map_localName_qkey) map_localName_qkey = this.init_map_localName_qkey(keyType);
                        if (!this.csvParser) this.csvParser = new CSVParser(false, QKeyManager_1.DELIMITER);
                        var trimmedKeyType = null;
                        for (var i = iStart; i < iEnd; i++) {
                            var localName = String(keyStrings[i]);
                            var qkey = map_localName_qkey.get(localName);
                            if (!qkey) {
                                if (!trimmedKeyType) trimmedKeyType = StandardLib.trim(keyType);
                                var trimmedLocalName = StandardLib.trim(localName);
                                qkey = map_localName_qkey.get(trimmedLocalName);
                                if (!qkey) {
                                    var qkeyString = this.csvParser.createCSVRow([trimmedKeyType, trimmedLocalName]);
                                    qkey = new key.QKey(trimmedKeyType, trimmedLocalName, qkeyString);
                                    map_localName_qkey.set(trimmedLocalName, qkey);
                                    this.map_qkeyString_qkey.set(qkeyString, qkey);
                                    this.array_numberToQKey[qkey.toNumber()] = qkey;
                                    this.map_qkey_keyType.set(qkey, trimmedKeyType);
                                    this.map_qkey_localName.set(qkey, trimmedLocalName);
                                }
                                // make untrimmed localName point to QKey for trimmedLocalName to avoid calls to trim() next time
                                if (localName != trimmedLocalName) map_localName_qkey.set(localName, qkey);
                            }
                            output[i] = qkey;
                        }
                    }
                    /**
                     * Get a list of QKey objects, all with the same key type.
                     *
                     * @return An array of QKeys.
                     */

                }, {
                    key: "getQKeys",
                    value: function getQKeys(keyType, keyStrings) {
                        var keys = new Array(keyStrings.length);
                        this.getQKeys_range(keyType, keyStrings, 0, keyStrings.length, keys);
                        return keys;
                    }
                    /**
                     * This will replace untyped Objects in an Array with their IQualifiedKey counterparts.
                     * Each object in the Array should have two properties: <code>keyType</code> and <code>localName</code>
                     * @param objects An Array to modify.
                     * @return The same Array that was passed in, modified.
                     */

                }, {
                    key: "convertToQKeys",
                    value: function convertToQKeys(objects) {
                        var i = objects.length;
                        while (i--) {
                            var item = objects[i];
                            if (!Weave.IS(item, IQualifiedKey)) objects[i] = this.getQKey(item.keyType, item.localName);
                        }
                        return objects;
                    }
                    /**
                     * Get a list of QKey objects, all with the same key type.
                     *
                     * @return An array of QKeys that will be filled in asynchronously.
                     */

                }, {
                    key: "getQKeysAsync",
                    value: function getQKeysAsync(relevantContext, keyType, keyStrings, asyncCallback, outputKeys) {
                        var qkg = this.map_context_qkeyGetter.get(relevantContext);
                        if (!qkg) this.map_context_qkeyGetter.set(relevantContext, qkg = new QKeyGetter(this, relevantContext));
                        qkg.asyncStart(keyType, keyStrings, outputKeys, asyncCallback);
                    }
                    /**
                     * Get a list of QKey objects, all with the same key type.
                     * @param relevantContext The owner of the WeavePromise. Only one WeavePromise will be generated per owner.
                     * @param keyType The keyType.
                     * @param keyStrings An Array of localName values.
                     * @return A WeavePromise that produces an Array of IQualifiedKeys.
                     */

                }, {
                    key: "getQKeysPromise",
                    value: function getQKeysPromise(relevantContext, keyType, keyStrings) {
                        var qkg = this.map_context_qkeyGetter.get(relevantContext);
                        if (!qkg) this.map_context_qkeyGetter.set(relevantContext, qkg = new QKeyGetter(this, relevantContext));
                        qkg.asyncStart(keyType, keyStrings);
                        return qkg;
                    }
                    /**
                     * Get a list of all previoused key types.
                     *
                     * @return An array of QKeys.
                     */

                }, {
                    key: "getAllKeyTypes",
                    value: function getAllKeyTypes() {
                        return this.d2d_keyType_localName_qkey.primaryKeys();
                    }
                    /**
                     * Get a list of all referenced QKeys for a given key type
                     * @return An array of QKeys
                     */

                }, {
                    key: "getAllQKeys",
                    value: function getAllQKeys(keyType) {
                        return JS.mapValues(this.d2d_keyType_localName_qkey.map.get(keyType));
                    }
                    /**
                     * This makes a sorted copy of an Array of keys.
                     * @param An Array of IQualifiedKeys.
                     * @return A sorted copy of the keys.
                     */

                }], [{
                    key: "keySortCopy",
                    value: function keySortCopy(keys) {
                        var qkm = Weave.AS(WeaveAPI.QKeyManager, QKeyManager_1);
                        var params = [qkm.map_qkey_keyType, qkm.map_qkey_localName];
                        return StandardLib.sortOn(keys, params, null, false);
                    }
                }]);

                return QKeyManager;
            }();
            // The # sign is used in anticipation that a key type will be a URI.
            QKeyManager.DELIMITER = '#';
            QKeyManager = QKeyManager_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.QKeyManager", interfaces: [IQualifiedKeyManager] })], QKeyManager);
            key.QKeyManager = QKeyManager;

            var QKeyGetter = function (_WeavePromise) {
                _inherits(QKeyGetter, _WeavePromise);

                function QKeyGetter(manager, relevantContext) {
                    _classCallCheck(this, QKeyGetter);

                    var _this104 = _possibleConstructorReturn(this, (QKeyGetter.__proto__ || Object.getPrototypeOf(QKeyGetter)).call(this, relevantContext));

                    _this104.batch = 5000;
                    _this104.iterate = function (stopTime) {
                        for (; _this104.i < _this104.keyStrings.length; _this104.i += _this104.batch) {
                            if (Date.now() > stopTime) return _this104.i / _this104.keyStrings.length;
                            _this104.manager.getQKeys_range(_this104.keyType, _this104.keyStrings, _this104.i, Math.min(_this104.i + _this104.batch, _this104.keyStrings.length), _this104.outputKeys);
                        }
                        return 1;
                    };
                    _this104.asyncComplete = function () {
                        _this104.setResult(_this104.outputKeys);
                        if (_this104.asyncCallback) {
                            _this104.asyncCallback.call(_this104.relevantContext, _this104.outputKeys);
                            _this104.asyncCallback = null;
                        }
                    };
                    _this104.manager = manager;
                    return _this104;
                }

                _createClass(QKeyGetter, [{
                    key: "asyncStart",
                    value: function asyncStart(keyType, keyStrings) {
                        var outputKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
                        var asyncCallback = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                        if (!keyStrings) keyStrings = [];
                        // this.manager = this.manager; TODO check this
                        this.asyncCallback = asyncCallback;
                        this.keyType = keyType;
                        this.keyStrings = keyStrings;
                        this.i = 0;
                        this.outputKeys = outputKeys || new Array(keyStrings.length);
                        this.outputKeys.length = keyStrings.length;
                        // high priority because all visualizations depend on key sets
                        WeaveAPI.Scheduler.startTask(this.relevantContext, this.iterate, WeaveAPI.TASK_PRIORITY_HIGH, this.asyncComplete, Weave.lang("Initializing {0} record identifiers", keyStrings.length));
                        return this;
                    }
                }]);

                return QKeyGetter;
            }(WeavePromise);
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var core;
    (function (core) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ILinkableVariable = weavejs.api.core.ILinkableVariable;
        var URLRequest = weavejs.net.URLRequest;
        var URLRequestUtils = weavejs.net.URLRequestUtils;
        var ResponseType = weavejs.net.ResponseType;
        var LinkablePromise = weavejs.core.LinkablePromise;
        /**
         * A promise for file content, given a URL.
         */
        var LinkableFile = function () {
            function LinkableFile() {
                var defaultValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                var _this105 = this;

                var taskDescription = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                var responseType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ResponseType.UINT8ARRAY;

                _classCallCheck(this, LinkableFile);

                this.responseType = responseType;
                this.linkablePromise = Weave.linkableChild(this, new LinkablePromise(function () {
                    return _this105.requestContent();
                }, taskDescription));
                this.url = Weave.linkableChild(this.linkablePromise, new core.LinkableString(defaultValue));
            }

            _createClass(LinkableFile, [{
                key: "requestContent",
                value: function requestContent() {
                    if (!this.url.value) return null;
                    var request = new URLRequest(this.url.value);
                    request.responseType = this.responseType;
                    return WeaveAPI.URLRequestUtils.request(this.linkablePromise, request);
                }
            }, {
                key: "setSessionState",
                value: function setSessionState(value) {
                    this.url.setSessionState(value);
                }
            }, {
                key: "getSessionState",
                value: function getSessionState() {
                    return this.url.getSessionState();
                }
            }, {
                key: "isLocal",
                get: function get() {
                    return this.url.value && this.url.value.startsWith(URLRequestUtils.LOCAL_FILE_URL_SCHEME) || !this.url.value;
                }
            }, {
                key: "result",
                get: function get() {
                    return this.linkablePromise.result;
                }
            }, {
                key: "error",
                get: function get() {
                    return this.linkablePromise.error;
                }
            }, {
                key: "value",
                get: function get() {
                    return this.url.value;
                },
                set: function set(new_value) {
                    this.url.value = new_value;
                }
            }]);

            return LinkableFile;
        }();
        LinkableFile = __decorate([Weave.classInfo({ id: "weavejs.core.LinkableFile", interfaces: [ILinkableVariable] })], LinkableFile);
        core.LinkableFile = LinkableFile;
    })(core = weavejs.core || (weavejs.core = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * Interface for a node for use with WeaveTreeDataDescriptor and WeaveTree.
             * Implementations should have [RemoteClass] metadata in front of the class definition
             * and should make it possible for drag+drop to make a fully-functional copy of a node by
             * copying all public properties, which should have simple types.
             * When implementing this interface as a wrapper for remote objects, make sure to avoid
             * making excess RPC calls wherever possible.
             * @author adufilie
             */
            var IWeaveTreeNode = function IWeaveTreeNode() {
                _classCallCheck(this, IWeaveTreeNode);
            };
            IWeaveTreeNode = __decorate([Weave.classInfo({ id: "weavejs.api.data.IWeaveTreeNode" })], IWeaveTreeNode);
            data.IWeaveTreeNode = IWeaveTreeNode;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            /**
             * Extends IWeaveTreeNode by adding addChildAt() and removeChild().
             * @author adufilie
             */
            var IWeaveTreeNodeWithEditableChildren = function (_IWeaveTreeNode) {
                _inherits(IWeaveTreeNodeWithEditableChildren, _IWeaveTreeNode);

                function IWeaveTreeNodeWithEditableChildren() {
                    _classCallCheck(this, IWeaveTreeNodeWithEditableChildren);

                    return _possibleConstructorReturn(this, (IWeaveTreeNodeWithEditableChildren.__proto__ || Object.getPrototypeOf(IWeaveTreeNodeWithEditableChildren)).apply(this, arguments));
                }

                return IWeaveTreeNodeWithEditableChildren;
            }(IWeaveTreeNode);
            IWeaveTreeNodeWithEditableChildren = __decorate([Weave.classInfo({ id: "weavejs.api.data.IWeaveTreeNodeWithEditableChildren", interfaces: [IWeaveTreeNode] })], IWeaveTreeNodeWithEditableChildren);
            data.IWeaveTreeNodeWithEditableChildren = IWeaveTreeNodeWithEditableChildren;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            /**
             * Extends IWeaveTreeNode by adding findPathToNode().
             * @author adufilie
             */
            var IWeaveTreeNodeWithPathFinding = function (_IWeaveTreeNode2) {
                _inherits(IWeaveTreeNodeWithPathFinding, _IWeaveTreeNode2);

                function IWeaveTreeNodeWithPathFinding() {
                    _classCallCheck(this, IWeaveTreeNodeWithPathFinding);

                    return _possibleConstructorReturn(this, (IWeaveTreeNodeWithPathFinding.__proto__ || Object.getPrototypeOf(IWeaveTreeNodeWithPathFinding)).apply(this, arguments));
                }

                return IWeaveTreeNodeWithPathFinding;
            }(IWeaveTreeNode);
            IWeaveTreeNodeWithPathFinding = __decorate([Weave.classInfo({ id: "weavejs.api.data.IWeaveTreeNodeWithPathFinding" })], IWeaveTreeNodeWithPathFinding);
            data.IWeaveTreeNodeWithPathFinding = IWeaveTreeNodeWithPathFinding;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            /**
             * This is a simple and generic interface for getting columns of data from a source.
             *
             * @author adufilie
             */
            var IDataSource = function (_ILinkableObject5) {
                _inherits(IDataSource, _ILinkableObject5);

                function IDataSource() {
                    _classCallCheck(this, IDataSource);

                    return _possibleConstructorReturn(this, (IDataSource.__proto__ || Object.getPrototypeOf(IDataSource)).apply(this, arguments));
                }

                return IDataSource;
            }(ILinkableObject);
            IDataSource = __decorate([Weave.classInfo({ id: "weavejs.api.data.IDataSource" })], IDataSource);
            data.IDataSource = IDataSource;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var IDataSource = weavejs.api.data.IDataSource;
            var IDataSourceWithAuthentication = function (_IDataSource) {
                _inherits(IDataSourceWithAuthentication, _IDataSource);

                function IDataSourceWithAuthentication() {
                    _classCallCheck(this, IDataSourceWithAuthentication);

                    return _possibleConstructorReturn(this, (IDataSourceWithAuthentication.__proto__ || Object.getPrototypeOf(IDataSourceWithAuthentication)).apply(this, arguments));
                }

                return IDataSourceWithAuthentication;
            }(IDataSource);
            IDataSourceWithAuthentication = __decorate([Weave.classInfo({ id: "weavejs.api.data.IDataSourceWithAuthentication" })], IDataSourceWithAuthentication);
            data.IDataSourceWithAuthentication = IDataSourceWithAuthentication;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var hierarchy;
        (function (hierarchy) {
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var IColumnReference = weavejs.api.data.IColumnReference;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var WeaveTreeItem = weavejs.util.WeaveTreeItem;
            /**
             * A node in a tree whose leaves identify attribute columns.
             * The following properties are used for equality comparison, in addition to node class definitions:<br>
             * <code>dependency, data</code><br>
             * The following properties are used by WeaveTreeDescriptorNode but not for equality comparison:<br>
             * <code>label, children, hasChildBranches</code><br>
             */
            var WeaveTreeDescriptorNode_1 = void 0;
            var WeaveTreeDescriptorNode = WeaveTreeDescriptorNode_1 = function (_WeaveTreeItem) {
                _inherits(WeaveTreeDescriptorNode, _WeaveTreeItem);

                /**
                 * The following properties are used for equality comparison, in addition to node class definitions:
                 *     <code>dependency, data</code><br>
                 * The following properties are used by WeaveTreeDescriptorNode but not for equality comparison:
                 *     <code>label, children, hasChildBranches</code><br>
                 * @param params An values for the properties of this WeaveTreeDescriptorNode.
                 */
                function WeaveTreeDescriptorNode(params) {
                    _classCallCheck(this, WeaveTreeDescriptorNode);

                    var _this110 = _possibleConstructorReturn(this, (WeaveTreeDescriptorNode.__proto__ || Object.getPrototypeOf(WeaveTreeDescriptorNode)).call(this));

                    _this110.__hasChildBranches = null;
                    _this110.childItemClass = WeaveTreeDescriptorNode_1;
                    if ((typeof params === "undefined" ? "undefined" : _typeof(params)) === 'object') {
                        for (var key in params) {
                            if (Weave.IS(_this110[key], Function) && JS.hasProperty(_this110, '_' + key)) _this110['_' + key] = params[key];else _this110[key] = params[key];
                        }
                    }
                    return _this110;
                }
                /**
                 * Set this to true if this node is a branch, or false if it is not.
                 * Otherwise, hasChildBranches() will check isBranch() on each child returned by getChildren().
                 */


                _createClass(WeaveTreeDescriptorNode, [{
                    key: "equals",
                    value: function equals(other) {
                        var that = Weave.AS(other, WeaveTreeDescriptorNode_1);
                        if (!that) return false;
                        // compare constructor
                        if (Object(this).constructor != Object(that).constructor) return false; // constructor differs
                        // compare dependency
                        if (this.dependency != that.dependency) return false; // dependency differs
                        if (StandardLib.compare(this.data, that.data) != 0) return false; // data differs
                        return true;
                    }
                }, {
                    key: "getLabel",
                    value: function getLabel() {
                        return this.label;
                    }
                }, {
                    key: "isBranch",
                    value: function isBranch() {
                        // assume that if children property was defined that this is a branch
                        return this._children != null;
                    }
                }, {
                    key: "hasChildBranches",
                    value: function hasChildBranches() {
                        var id = 'hasChildBranches';
                        if (this.isCached(id)) return this.cache(id);
                        if (this.__hasChildBranches != null) return this.cache(id, this.getBoolean(this.__hasChildBranches, id));
                        var children = this.getChildren();
                        var _iteratorNormalCompletion50 = true;
                        var _didIteratorError50 = false;
                        var _iteratorError50 = undefined;

                        try {
                            for (var _iterator50 = (children || [])[Symbol.iterator](), _step50; !(_iteratorNormalCompletion50 = (_step50 = _iterator50.next()).done); _iteratorNormalCompletion50 = true) {
                                var child = _step50.value;

                                if (child.isBranch()) return this.cache(id, true);
                            }
                        } catch (err) {
                            _didIteratorError50 = true;
                            _iteratorError50 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion50 && _iterator50.return) {
                                    _iterator50.return();
                                }
                            } finally {
                                if (_didIteratorError50) {
                                    throw _iteratorError50;
                                }
                            }
                        }

                        return this.cache(id, false);
                    }
                }, {
                    key: "getChildren",
                    value: function getChildren() {
                        return this.children;
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        return null;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        return null;
                    }
                }, {
                    key: "_hasChildBranches",
                    set: function set(value) {
                        this._counter['hasChildBranches'] = undefined;
                        this.__hasChildBranches = value;
                    }
                }]);

                return WeaveTreeDescriptorNode;
            }(WeaveTreeItem);
            WeaveTreeDescriptorNode = WeaveTreeDescriptorNode_1 = __decorate([Weave.classInfo({ id: "weavejs.data.hierarchy.WeaveTreeDescriptorNode", interfaces: [IWeaveTreeNode, IColumnReference] })], WeaveTreeDescriptorNode);
            hierarchy.WeaveTreeDescriptorNode = WeaveTreeDescriptorNode;
        })(hierarchy = data.hierarchy || (data.hierarchy = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var hierarchy;
        (function (hierarchy) {
            var IColumnReference = weavejs.api.data.IColumnReference;
            var IDataSource = weavejs.api.data.IDataSource;
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var WeaveTreeDescriptorNode = weavejs.data.hierarchy.WeaveTreeDescriptorNode;
            var WeaveRootDataTreeNode = function (_WeaveTreeDescriptorN) {
                _inherits(WeaveRootDataTreeNode, _WeaveTreeDescriptorN);

                function WeaveRootDataTreeNode(root) {
                    _classCallCheck(this, WeaveRootDataTreeNode);

                    var _this111 = _possibleConstructorReturn(this, (WeaveRootDataTreeNode.__proto__ || Object.getPrototypeOf(WeaveRootDataTreeNode)).call(this, {
                        dependency: null,
                        label: Weave.lang('Data Sources'),
                        hasChildBranches: true,
                        children: function children() {
                            var sources = root.getObjects(IDataSource).concat(_this111.globalColumnDataSource);
                            var nodes = sources.map(function (ds) {
                                Weave.linkableChild(_this111, ds);
                                return ds.getHierarchyRoot();
                            });
                            // only show global columns node if it has at least one child
                            var globalColumnsNode = nodes[nodes.length - 1];
                            if (!globalColumnsNode.getChildren().length) nodes.pop();
                            return nodes;
                        }
                    }));
                    /* In Typescript we can't reference 'this' before calling super, but it allows fat-arrow binding. */


                    _this111.dependency = _this111;
                    Weave.linkableChild(_this111, root.childListCallbacks);
                    _this111.globalColumnDataSource = Weave.linkableChild(_this111, hierarchy.GlobalColumnDataSource.getInstance(root));
                    return _this111;
                }

                _createClass(WeaveRootDataTreeNode, [{
                    key: "getDataSource",
                    value: function getDataSource() {
                        return null;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        return null;
                    }
                }]);

                return WeaveRootDataTreeNode;
            }(WeaveTreeDescriptorNode);
            WeaveRootDataTreeNode = __decorate([Weave.classInfo({ id: "weavejs.data.hierarchy.WeaveRootDataTreeNode", interfaces: [IWeaveTreeNode, IColumnReference] })], WeaveRootDataTreeNode);
            hierarchy.WeaveRootDataTreeNode = WeaveRootDataTreeNode;
        })(hierarchy = data.hierarchy || (data.hierarchy = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var hierarchy;
        (function (hierarchy) {
            var IColumnReference = weavejs.api.data.IColumnReference;
            var IWeaveTreeNodeWithPathFinding = weavejs.api.data.IWeaveTreeNodeWithPathFinding;
            /**
             * An all-static class containing functions for dealing with data hierarchies.
             *
             * @author adufilie
             */

            var HierarchyUtils = function () {
                function HierarchyUtils() {
                    _classCallCheck(this, HierarchyUtils);
                }

                _createClass(HierarchyUtils, null, [{
                    key: "findParentNode",
                    value: function findParentNode(root, dataSource, metadata) {
                        var leaf = dataSource.findHierarchyNode(metadata);
                        var path = HierarchyUtils.findPathToNode(root, leaf);
                        if (path && path.length > 1) return path[path.length - 2];
                        return null;
                    }
                }, {
                    key: "findSiblingNodes",
                    value: function findSiblingNodes(dataSource, metadata) {
                        if (!dataSource || !metadata) return [];
                        var parent = HierarchyUtils.findParentNode(dataSource.getHierarchyRoot(), dataSource, metadata);
                        return parent ? parent.getChildren() : [];
                    }
                    /**
                     * Finds a series of IWeaveTreeNode objects which can be traversed as a path to a descendant node.
                     * @param root The root IWeaveTreeNode.
                     * @param descendant The descendant IWeaveTreeNode.
                     * @return An Array of IWeaveTreeNode objects which can be followed as a path from the root to the descendant, including the root and descendant nodes.
                     *         The last item in the path may be the equivalent node found in the hierarchy rather than the descendant node that was passed in.
                     *         Returns null if the descendant is unreachable from this node.
                     * @see weave.api.data.IWeaveTreeNode#equals()
                     */

                }, {
                    key: "findPathToNode",
                    value: function findPathToNode(root, descendant) {
                        if (!root || !descendant) return null;
                        if (Weave.IS(root, IWeaveTreeNodeWithPathFinding)) return Weave.AS(root, IWeaveTreeNodeWithPathFinding).findPathToNode(descendant);
                        if (root.equals(descendant)) return [root];
                        var childs = root.getChildren();
                        var _iteratorNormalCompletion51 = true;
                        var _didIteratorError51 = false;
                        var _iteratorError51 = undefined;

                        try {
                            for (var _iterator51 = childs[Symbol.iterator](), _step51; !(_iteratorNormalCompletion51 = (_step51 = _iterator51.next()).done); _iteratorNormalCompletion51 = true) {
                                var child = _step51.value;

                                var path = HierarchyUtils.findPathToNode(child, descendant);
                                if (path) {
                                    path.unshift(root);
                                    return path;
                                }
                            }
                        } catch (err) {
                            _didIteratorError51 = true;
                            _iteratorError51 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion51 && _iterator51.return) {
                                    _iterator51.return();
                                }
                            } finally {
                                if (_didIteratorError51) {
                                    throw _iteratorError51;
                                }
                            }
                        }

                        return null;
                    }
                    /**
                     * Traverses an entire hierarchy and returns all nodes that
                     * implement IColumnReference and have column metadata.
                     */

                }, {
                    key: "getAllColumnReferenceDescendants",
                    value: function getAllColumnReferenceDescendants(source) {
                        return HierarchyUtils.getAllColumnReferences(source.getHierarchyRoot(), []);
                    }
                }, {
                    key: "getAllColumnReferences",
                    value: function getAllColumnReferences(node, output) {
                        var ref = Weave.AS(node, IColumnReference);
                        if (ref && ref.getColumnMetadata()) output.push(ref);
                        if (node) {
                            var childs = node.getChildren();
                            var _iteratorNormalCompletion52 = true;
                            var _didIteratorError52 = false;
                            var _iteratorError52 = undefined;

                            try {
                                for (var _iterator52 = (childs || [])[Symbol.iterator](), _step52; !(_iteratorNormalCompletion52 = (_step52 = _iterator52.next()).done); _iteratorNormalCompletion52 = true) {
                                    var child = _step52.value;

                                    HierarchyUtils.getAllColumnReferences(child, output);
                                }
                            } catch (err) {
                                _didIteratorError52 = true;
                                _iteratorError52 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion52 && _iterator52.return) {
                                        _iterator52.return();
                                    }
                                } finally {
                                    if (_didIteratorError52) {
                                        throw _iteratorError52;
                                    }
                                }
                            }
                        }
                        return output;
                    }
                }]);

                return HierarchyUtils;
            }();

            hierarchy.HierarchyUtils = HierarchyUtils;
        })(hierarchy = data.hierarchy || (data.hierarchy = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an interface to a mapping of keys to data values.
             *
             * @author adufilie
             */
            var IAttributeColumn = function IAttributeColumn() {
                _classCallCheck(this, IAttributeColumn);
            };
            IAttributeColumn = __decorate([Weave.classInfo({ id: "weavejs.api.data.IAttributeColumn" })], IAttributeColumn);
            data.IAttributeColumn = IAttributeColumn;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var ui;
    (function (ui) {
        var IAttributeColumn = weavejs.api.data.IAttributeColumn;

        var ToolTip = function (_React$Component33) {
            _inherits(ToolTip, _React$Component33);

            function ToolTip(props) {
                _classCallCheck(this, ToolTip);

                var _this112 = _possibleConstructorReturn(this, (ToolTip.__proto__ || Object.getPrototypeOf(ToolTip)).call(this, props));

                _this112.toolTipOffset = 10;
                _this112.secondRender = false;
                _this112.nameFormat = _this112.props.nameFormat || _.identity;
                _this112.valueFormat = _this112.props.valueFormat || _.identity;
                _this112.titleFormat = _this112.props.titleFormat || _.identity;
                _this112.toolTipClass = _this112.props.toolTipClass || "c3-tooltip";
                _this112.toolTipContainerClass = _this112.props.toolTipContainerClass || "c3-tooltip-container";
                _this112.state = {
                    x: 0,
                    y: 0,
                    title: "",
                    columnNamesToValue: {},
                    columnNamesToColor: {},
                    showToolTip: false
                };
                _this112.containerStyle = {
                    position: "fixed",
                    pointerEvents: "none",
                    display: "block"
                };
                return _this112;
            }

            _createClass(ToolTip, [{
                key: "componentDidMount",
                value: function componentDidMount() {}
            }, {
                key: "componentDidUpdate",
                value: function componentDidUpdate() {
                    this.element = ReactDOM.findDOMNode(this);
                    if (this.secondRender) {
                        this.secondRender = false;
                    } else if (this.state.showToolTip) {
                        this.secondRender = true;
                        this.forceUpdate();
                    }
                }
            }, {
                key: "getToolTipHtml",
                value: function getToolTipHtml() {
                    return this.element && this.element.innerHTML;
                }
            }, {
                key: "render",
                value: function render() {
                    var _this113 = this;

                    if (!this.state.showToolTip) {
                        return React.createElement("div", { style: { width: 0, height: 0 } });
                    }
                    var style = _.clone(this.containerStyle);
                    style.display = "block";
                    style.visibility = this.secondRender ? "visible" : "hidden";
                    style.top = this.state.y + this.toolTipOffset;
                    style.left = this.state.x + this.toolTipOffset;
                    // only try to fit on screen during second render
                    if (this.secondRender) {
                        var mirrorLeft = this.state.x - this.element.clientWidth - this.toolTipOffset;
                        var mirrorTop = this.state.y - this.element.clientHeight - this.toolTipOffset;
                        var right = style.left + this.element.clientWidth;
                        var bottom = style.top + this.element.clientHeight;
                        if ((right > window.innerWidth || weavejs.WeaveAPI.Locale.reverseLayout) && mirrorLeft > 0) style.left = mirrorLeft;
                        if (bottom > window.innerHeight && mirrorTop > 0) style.top = mirrorTop;
                    }
                    var tableRows = [];
                    var columnNames = Object.keys(this.state.columnNamesToValue);
                    if (columnNames.length) {
                        tableRows = columnNames.map(function (columnName) {
                            var colorSpan = _this113.state.columnNamesToColor[columnName] ? React.createElement("span", { style: { backgroundColor: _this113.state.columnNamesToColor[columnName] } }) : null;
                            var returnElements = [];
                            if (weavejs.WeaveAPI.Locale.reverseLayout) {
                                returnElements.push(React.createElement(
                                    "td",
                                    { key: returnElements.length, className: "value" },
                                    _this113.valueFormat(Weave.lang(_this113.state.columnNamesToValue[columnName]))
                                ));
                                returnElements.push(React.createElement(
                                    "td",
                                    { key: returnElements.length, className: "name" },
                                    React.createElement(
                                        "div",
                                        { style: { display: "inline" } },
                                        _this113.nameFormat(Weave.lang(columnName))
                                    ),
                                    colorSpan
                                ));
                            } else {
                                returnElements.push(React.createElement(
                                    "td",
                                    { key: returnElements.length, className: "name" },
                                    colorSpan,
                                    React.createElement(
                                        "div",
                                        { style: { display: "inline" } },
                                        Weave.lang(_this113.nameFormat(columnName))
                                    )
                                ));
                                returnElements.push(React.createElement(
                                    "td",
                                    { key: returnElements.length, className: "value" },
                                    _this113.valueFormat(Weave.lang(_this113.state.columnNamesToValue[columnName]))
                                ));
                            }
                            return React.createElement(
                                "tr",
                                { key: columnName },
                                returnElements
                            );
                        });
                    }
                    return React.createElement(
                        "div",
                        { style: style, className: this.toolTipContainerClass },
                        React.createElement(
                            "table",
                            { className: this.toolTipClass },
                            React.createElement(
                                "tbody",
                                null,
                                React.createElement(
                                    "tr",
                                    null,
                                    React.createElement(
                                        "th",
                                        { colSpan: 2 },
                                        this.state.title ? this.titleFormat(Weave.lang(this.state.title)) : ""
                                    )
                                ),
                                tableRows
                            )
                        )
                    );
                }
            }, {
                key: "show",
                value: function show(context, event, keys, additionalColumns) {
                    if (keys.length == 0) return this.hide();
                    var title = ToolTip.getToolTipTitle(context, keys);
                    var columnNamesToValue = ToolTip.getToolTipData(context, keys, additionalColumns);
                    var showToolTip = !!(title || Object.keys(columnNamesToValue).length);
                    this.setState({
                        x: event.clientX,
                        y: event.clientY,
                        showToolTip: showToolTip,
                        title: title,
                        columnNamesToValue: columnNamesToValue,
                        columnNamesToColor: {}
                    });
                }
            }, {
                key: "hide",
                value: function hide() {
                    this.setState({ showToolTip: false });
                }
            }], [{
                key: "getToolTipTitle",
                value: function getToolTipTitle(context, keys) {
                    var titleHashMap = Weave.getRoot(context).getObject("Probe Header Columns");
                    var columns = titleHashMap ? titleHashMap.getObjects(IAttributeColumn) : [];
                    return _.map(columns, function (column) {
                        return column.getValueFromKey(keys[0], String);
                    }).filter(function (str) {
                        return !!str;
                    }).join(", ");
                }
            }, {
                key: "getToolTipData",
                value: function getToolTipData(context, keys) {
                    var additionalColumns = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];

                    var columnHashMap = Weave.getRoot(context).getObject("Probed Columns");
                    var columns = columnHashMap ? columnHashMap.getObjects(IAttributeColumn).concat(additionalColumns) : additionalColumns;
                    var result = {};
                    var _iteratorNormalCompletion53 = true;
                    var _didIteratorError53 = false;
                    var _iteratorError53 = undefined;

                    try {
                        for (var _iterator53 = columns[Symbol.iterator](), _step53; !(_iteratorNormalCompletion53 = (_step53 = _iterator53.next()).done); _iteratorNormalCompletion53 = true) {
                            var child = _step53.value;

                            var title = child.getMetadata("title");
                            var value = child.getValueFromKey(keys[0], String);
                            if (value) result[title] = value;
                        }
                        //handle remaining keys
                    } catch (err) {
                        _didIteratorError53 = true;
                        _iteratorError53 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion53 && _iterator53.return) {
                                _iterator53.return();
                            }
                        } finally {
                            if (_didIteratorError53) {
                                throw _iteratorError53;
                            }
                        }
                    }

                    if (keys.length > 1) {
                        var str = keys.length + " records total";
                        if (columns.length > 0) str += ", 1 shown";
                        result["(" + str + ")"] = null;
                    }
                    return result;
                }
            }]);

            return ToolTip;
        }(React.Component);

        ui.ToolTip = ToolTip;
    })(ui = weavejs.ui || (weavejs.ui = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column_1) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            var StandardLib = weavejs.util.StandardLib;
            /**
             * This provides a reverse lookup of String values in an IAttributeColumn.
             *
             * @author adufilie
             */
            var StringLookup = function () {
                function StringLookup(column) {
                    _classCallCheck(this, StringLookup);

                    /**
                     * This object maps a String value from the internal column to an Array of keys that map to that value.
                     */
                    this._stringToKeysMap = null;
                    /**
                     * This object maps a String value from the internal column to the Number value corresponding to that String values in the internal column.
                     */
                    this._stringToNumberMap = null;
                    /**
                     * This keeps track of a list of unique string values contained in the internal column.
                     */
                    this._uniqueStringValues = new Array();
                    this.internalColumn = column;
                    column.addImmediateCallback(this, this.handleInternalColumnChange);
                    if (Weave.IS(column, ILinkableObject)) Weave.linkableChild(this, Weave.AS(column, ILinkableObject));
                }
                /**
                 * This function gets called when the referenced column changes.
                 */


                _createClass(StringLookup, [{
                    key: "handleInternalColumnChange",
                    value: function handleInternalColumnChange() {
                        // invalidate lookup
                        this._stringToKeysMap = null;
                        this._stringToNumberMap = null;
                        this._uniqueStringValues.length = 0;
                    }
                    /**
                     * This is a list of the unique strings of the internal column.
                     */

                }, {
                    key: "createLookupTable",

                    /**
                     * This function will initialize the string lookup table and list of unique strings.
                     */
                    value: function createLookupTable() {
                        // reset
                        this._uniqueStringValues.length = 0;
                        this._stringToKeysMap = {};
                        this._stringToNumberMap = {};
                        // loop through all the keys in the internal column
                        var keys = this.internalColumn ? this.internalColumn.keys : [];
                        for (var i = 0; i < keys.length; i++) {
                            var key = keys[i];
                            var stringValue = Weave.AS(this.internalColumn.getValueFromKey(key, String), String);
                            if (stringValue == null) continue;
                            // save the mapping from the String value to the key
                            if (Weave.IS(this._stringToKeysMap[stringValue], Array)) {
                                // string value was found previously
                                (Weave.AS(this._stringToKeysMap[stringValue], Array) || []).push(key);
                            } else {
                                // found new string value
                                this._stringToKeysMap[stringValue] = [key];
                                this._uniqueStringValues.push(stringValue);
                            }
                            // save the mapping from the String value to the corresponding Number value
                            var numberValue = this.internalColumn.getValueFromKey(key, Number);
                            if (this._stringToNumberMap[stringValue] == undefined) {
                                this._stringToNumberMap[stringValue] = numberValue;
                            } else if (!isNaN(this._stringToNumberMap[stringValue]) && this._stringToNumberMap[stringValue] != numberValue) {
                                this._stringToNumberMap[stringValue] = NaN; // different numbers are mapped to the same String, so save NaN.
                            }
                        }
                        // sort the unique values because we want them to be in a predictable order
                        StandardLib.sortOn(this._uniqueStringValues, [this._stringToNumberMap, this._uniqueStringValues]);
                    }
                    /**
                     * @param stringValue A string value existing in the internal column.
                     * @return An Array of keys that map to the given string value in the internal column.
                     */

                }, {
                    key: "getKeysFromString",
                    value: function getKeysFromString(stringValue) {
                        // validate lookup table if necessary
                        if (this._stringToKeysMap == null) this.createLookupTable();
                        // get the list of internal keys from the given stringValue
                        return Weave.AS(this._stringToKeysMap[stringValue], Array) || (this._stringToKeysMap[stringValue] = []);
                    }
                    /**
                     * @param stringValue A string value existing in the internal column.
                     * @return The Number value associated with the String value from the internal column.
                     */

                }, {
                    key: "getNumberFromString",
                    value: function getNumberFromString(stringValue) {
                        if (this._stringToNumberMap == null) this.createLookupTable();
                        return this._stringToNumberMap[stringValue];
                    }
                }, {
                    key: "uniqueStrings",
                    get: function get() {
                        if (this._stringToKeysMap == null) this.createLookupTable();
                        return this._uniqueStringValues;
                    }
                }]);

                return StringLookup;
            }();
            StringLookup = __decorate([Weave.classInfo({ id: "weavejs.data.column.StringLookup" })], StringLookup);
            column_1.StringLookup = StringLookup;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key_4) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IKeySet = weavejs.api.data.IKeySet;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var StandardLib = weavejs.util.StandardLib;
            /**
             * This provides the keys from an existing IKeySet in a sorted order.
             * Callbacks will trigger when the sorted result changes.
             *
             * @author adufilie
             */
            var SortedKeySet_1 = void 0;
            var SortedKeySet = SortedKeySet_1 = function () {
                /**
                 * @param keySet An IKeySet to sort.
                 * @param sortCopyFunction A function that accepts an Array of IQualifiedKeys and returns a new, sorted copy.
                 * @param dependencies A list of ILinkableObjects that affect the result of the compare function.
                 *                     If any IAttributeColumns are provided, the corresponding IColumnStatistics will also
                 *                     be added as dependencies.
                 */
                function SortedKeySet(keySet) {
                    var sortCopyFunction = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var dependencies = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    _classCallCheck(this, SortedKeySet);

                    this._triggerCounter = 0;
                    this._dependencies = Weave.linkableChild(this, CallbackCollection);
                    this._sortCopyFunction = key_4.QKeyManager.keySortCopy;
                    this._sortedKeys = [];
                    this._keySet = keySet;
                    this._sortCopyFunction = Weave.AS(sortCopyFunction, Function) || key_4.QKeyManager.keySortCopy;
                    var _iteratorNormalCompletion54 = true;
                    var _didIteratorError54 = false;
                    var _iteratorError54 = undefined;

                    try {
                        for (var _iterator54 = (dependencies || [])[Symbol.iterator](), _step54; !(_iteratorNormalCompletion54 = (_step54 = _iterator54.next()).done); _iteratorNormalCompletion54 = true) {
                            var object = _step54.value;

                            Weave.linkableChild(this._dependencies, object);
                            if (Weave.IS(object, IAttributeColumn)) {
                                var stats = WeaveAPI.StatisticsCache.getColumnStatistics(Weave.AS(object, IAttributeColumn));
                                Weave.linkableChild(this._dependencies, stats);
                            }
                        }
                    } catch (err) {
                        _didIteratorError54 = true;
                        _iteratorError54 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion54 && _iterator54.return) {
                                _iterator54.return();
                            }
                        } finally {
                            if (_didIteratorError54) {
                                throw _iteratorError54;
                            }
                        }
                    }

                    Weave.linkableChild(this._dependencies, this._keySet);
                }

                _createClass(SortedKeySet, [{
                    key: "containsKey",
                    value: function containsKey(key) {
                        return this._keySet.containsKey(key);
                    }
                    /**
                     * This is the list of keys from the IKeySet, sorted.
                     */

                }, {
                    key: "_validate",
                    value: function _validate() {
                        this._triggerCounter = this._dependencies.triggerCounter;
                        if (Weave.isBusy(this)) return;
                        WeaveAPI.Scheduler.startTask(this, this._asyncTask, WeaveAPI.TASK_PRIORITY_NORMAL, this._asyncComplete);
                    }
                }, {
                    key: "_asyncTask",
                    value: function _asyncTask() {
                        // first try sorting an empty array to trigger any column statistics requests
                        this._sortCopyFunction(SortedKeySet_1.EMPTY_ARRAY);
                        // stop if any async tasks were started
                        if (Weave.isBusy(this._dependencies)) return 1;
                        // sort the keys
                        this._sortedKeys = this._sortCopyFunction(this._keySet.keys);
                        return 1;
                    }
                }, {
                    key: "_asyncComplete",
                    value: function _asyncComplete() {
                        if (Weave.isBusy(this._dependencies) || this._triggerCounter != this._dependencies.triggerCounter) return;
                        Weave.getCallbacks(this).triggerCallbacks();
                    }
                    /**
                     * Generates a function like <code>function(keys:Array):Array</code> that returns a sorted copy of an Array of keys.
                     * Note that the resulting sort function depends on WeaveAPI.StatisticsManager, so the sort function should be called
                     * again when statistics change for any of the columns you provide.
                     * @param columns An Array of IAttributeColumns or Functions mapping IQualifiedKeys to Numbers.
                     * @param sortDirections Sort directions (-1, 0, 1)
                     * @return A function that returns a sorted copy of an Array of keys.
                     */

                }, {
                    key: "keys",
                    get: function get() {
                        if (this._triggerCounter != this._dependencies.triggerCounter) this._validate();
                        return this._sortedKeys;
                    }
                }], [{
                    key: "generateSortCopyFunction",
                    value: function generateSortCopyFunction(columns) {
                        var sortDirections = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        return function (keys) {
                            var params = [];
                            var directions = [];
                            var lastDirection = 1;
                            for (var i = 0; i < columns.length; i++) {
                                var param = columns[i];
                                if (Weave.wasDisposed(param)) continue;
                                if (Weave.IS(param, IAttributeColumn)) {
                                    var stats = WeaveAPI.StatisticsCache.getColumnStatistics(Weave.AS(param, IAttributeColumn));
                                    param = stats.hack_getNumericData();
                                }
                                if (!param || Weave.IS(param, IKeySet)) continue;
                                if (sortDirections && !sortDirections[i]) continue;
                                lastDirection = sortDirections ? sortDirections[i] : 1;
                                params.push(param);
                                directions.push(lastDirection);
                            }
                            var qkm = WeaveAPI.QKeyManager;
                            params.push(qkm.map_qkey_keyType, qkm.map_qkey_localName);
                            directions.push(lastDirection, lastDirection);
                            //var t:int = getTimer();
                            var result = StandardLib.sortOn(keys, params, directions, false);
                            //trace('sorted',keys.length,'keys in',getTimer()-t,'ms',DebugUtils.getCompactStackTrace(new Error()));
                            return result;
                        };
                    }
                }]);

                return SortedKeySet;
            }();
            SortedKeySet.EMPTY_ARRAY = [];
            SortedKeySet = SortedKeySet_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.SortedKeySet", interfaces: [IKeySet] })], SortedKeySet);
            key_4.SortedKeySet = SortedKeySet;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key_5) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IFilteredKeySet = weavejs.api.data.IFilteredKeySet;
            var IKeySet = weavejs.api.data.IKeySet;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var DebugUtils = weavejs.util.DebugUtils;
            var StandardLib = weavejs.util.StandardLib;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IDisposableObject = weavejs.api.core.IDisposableObject;
            /**
             * A FilteredKeySet has a base set of keys and an optional filter.
             * The resulting set of keys becomes the intersection of the base set with the filter.
             *
             * @author adufilie
             */
            var FilteredKeySet_1 = void 0;
            var FilteredKeySet = FilteredKeySet_1 = function (_CallbackCollection2) {
                _inherits(FilteredKeySet, _CallbackCollection2);

                function FilteredKeySet() {
                    _classCallCheck(this, FilteredKeySet);

                    var _this114 = _possibleConstructorReturn(this, (FilteredKeySet.__proto__ || Object.getPrototypeOf(FilteredKeySet)).call(this));

                    _this114._baseKeySet = null; // stores the base IKeySet
                    // this stores the IKeyFilter
                    _this114._dynamicKeyFilter = Weave.linkableChild(_this114, key_5.DynamicKeyFilter);
                    _this114._filteredKeys = []; // stores the filtered list of keys
                    _this114.map_key = new WeakMap();
                    /**
                     * When this is set to true, the inverse of the filter will be used to filter the keys.
                     * This means any keys appearing in the filter will be excluded from this key set.
                     */
                    _this114.inverseFilter = Weave.linkableChild(_this114, LinkableBoolean);
                    if (FilteredKeySet_1.debug) _this114.addImmediateCallback(_this114, _this114._firstCallback);
                    return _this114;
                }

                _createClass(FilteredKeySet, [{
                    key: "_firstCallback",
                    value: function _firstCallback() {
                        DebugUtils.debugTrace(this, 'trigger', this.keys.length, 'keys');
                    }
                    /* override */
                }, {
                    key: "dispose",
                    value: function dispose() {
                        _get(FilteredKeySet.prototype.__proto__ || Object.getPrototypeOf(FilteredKeySet.prototype), "dispose", this).call(this);
                        this.setColumnKeySources(null);
                    }
                    /**
                     * This sets up the FilteredKeySet to get its base set of keys from a list of columns and provide them in sorted order.
                     * @param columns An Array of IAttributeColumns to use for comparing IQualifiedKeys.
                     * @param sortDirections Array of sort directions corresponding to the columns and given as integers (1=ascending, -1=descending, 0=none).
                     * @param keySortCopy A function that returns a sorted copy of an Array of keys. If specified, descendingFlags will be ignored and this function will be used instead.
                     * @param keyInclusionLogic Passed to KeySetUnion constructor.
                     * @see weave.data.KeySets.SortedKeySet#generateCompareFunction()
                     */

                }, {
                    key: "setColumnKeySources",
                    value: function setColumnKeySources(columns) {
                        var sortDirections = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                        var keySortCopy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
                        var keyInclusionLogic = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                        if (StandardLib.compare(this._setColumnKeySources_arguments, arguments) == 0) return;
                        // unlink from the old key set
                        if (this._generatedKeySets) {
                            var _iteratorNormalCompletion55 = true;
                            var _didIteratorError55 = false;
                            var _iteratorError55 = undefined;

                            try {
                                for (var _iterator55 = (this._generatedKeySets || [])[Symbol.iterator](), _step55; !(_iteratorNormalCompletion55 = (_step55 = _iterator55.next()).done); _iteratorNormalCompletion55 = true) {
                                    var keySet = _step55.value;

                                    Weave.dispose(keySet);
                                }
                            } catch (err) {
                                _didIteratorError55 = true;
                                _iteratorError55 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion55 && _iterator55.return) {
                                        _iterator55.return();
                                    }
                                } finally {
                                    if (_didIteratorError55) {
                                        throw _iteratorError55;
                                    }
                                }
                            }

                            this._generatedKeySets = null;
                        } else {
                            this.setSingleKeySource(null);
                        }
                        this._setColumnKeySources_arguments = arguments;
                        if (columns) {
                            // KeySetUnion should not trigger callbacks
                            var union = Weave.disposableChild(this, new key_5.KeySetUnion(keyInclusionLogic));
                            var _iteratorNormalCompletion56 = true;
                            var _didIteratorError56 = false;
                            var _iteratorError56 = undefined;

                            try {
                                for (var _iterator56 = columns[Symbol.iterator](), _step56; !(_iteratorNormalCompletion56 = (_step56 = _iterator56.next()).done); _iteratorNormalCompletion56 = true) {
                                    var keySet = _step56.value;

                                    union.addKeySetDependency(keySet);
                                    if (Weave.IS(keySet, IAttributeColumn)) {
                                        var stats = WeaveAPI.StatisticsCache.getColumnStatistics(Weave.AS(keySet, IAttributeColumn));
                                        Weave.linkableChild(union, stats);
                                    }
                                }
                            } catch (err) {
                                _didIteratorError56 = true;
                                _iteratorError56 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion56 && _iterator56.return) {
                                        _iterator56.return();
                                    }
                                } finally {
                                    if (_didIteratorError56) {
                                        throw _iteratorError56;
                                    }
                                }
                            }

                            if (FilteredKeySet_1.debug && keySortCopy == null) console.log(DebugUtils.debugId(this), 'sort by [', columns, ']');
                            var sortCopy = keySortCopy || key_5.SortedKeySet.generateSortCopyFunction(columns, sortDirections);
                            // SortedKeySet should trigger callbacks
                            var sorted = Weave.linkableChild(this, new key_5.SortedKeySet(union, sortCopy, columns));
                            this._generatedKeySets = [union, sorted];
                            this._baseKeySet = sorted;
                        } else {
                            this._baseKeySet = null;
                        }
                        this.triggerCallbacks();
                    }
                    /**
                     * This function sets the base IKeySet that is being filtered.
                     * @param newBaseKeySet A new IKeySet to use as the base for this FilteredKeySet.
                     */

                }, {
                    key: "setSingleKeySource",
                    value: function setSingleKeySource(keySet) {
                        if (this._generatedKeySets) this.setColumnKeySources(null);
                        if (this._baseKeySet == keySet) return;
                        // unlink from the old key set
                        if (this._baseKeySet != null) Weave.getCallbacks(this._baseKeySet).removeCallback(this, this.triggerCallbacks);
                        this._baseKeySet = keySet; // save pointer to new base key set
                        // link to new key set
                        if (this._baseKeySet != null) Weave.getCallbacks(this._baseKeySet).addImmediateCallback(this, this.triggerCallbacks, false, true);
                        this.triggerCallbacks();
                    }
                    /**
                     * @return The interface for setting a filter that is applied to the base key set.
                     */

                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    value: function containsKey(key) {
                        if (this._prevTriggerCounter != this.triggerCounter) this.validateFilteredKeys();
                        return this.map_key.has(key);
                    }
                    /**
                     * @return The keys in this IKeySet.
                     */

                }, {
                    key: "validateFilteredKeys",

                    /**
                     * @private
                     */
                    value: function validateFilteredKeys() {
                        this._prevTriggerCounter = this.triggerCounter; // this prevents the function from being called again before callbacks are triggered again.
                        this._asyncFilter = this._dynamicKeyFilter.getInternalKeyFilter();
                        if (this._baseKeySet == null) {
                            // no keys when base key set is undefined
                            this._filteredKeys = [];
                            this.map_key = new WeakMap();
                            return;
                        }
                        if (!this._asyncFilter) {
                            // use base key set
                            this._filteredKeys = this._baseKeySet.keys;
                            this.map_key = new WeakMap();
                            var _iteratorNormalCompletion57 = true;
                            var _didIteratorError57 = false;
                            var _iteratorError57 = undefined;

                            try {
                                for (var _iterator57 = (this._filteredKeys || [])[Symbol.iterator](), _step57; !(_iteratorNormalCompletion57 = (_step57 = _iterator57.next()).done); _iteratorNormalCompletion57 = true) {
                                    var key = _step57.value;

                                    this.map_key.set(key, true);
                                }
                            } catch (err) {
                                _didIteratorError57 = true;
                                _iteratorError57 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion57 && _iterator57.return) {
                                        _iterator57.return();
                                    }
                                } finally {
                                    if (_didIteratorError57) {
                                        throw _iteratorError57;
                                    }
                                }
                            }

                            return;
                        }
                        this._i = 0;
                        this._asyncInput = this._baseKeySet.keys;
                        this._asyncOutput = [];
                        this._async_map_key = new WeakMap();
                        this._asyncInverse = this.inverseFilter.value;
                        // high priority because all visualizations depend on key sets
                        WeaveAPI.Scheduler.startTask(this, this.iterate, WeaveAPI.TASK_PRIORITY_HIGH, this.asyncComplete, Weave.lang('Filtering {0} keys', this._asyncInput.length));
                    }
                }, {
                    key: "iterate",
                    value: function iterate(stopTime) {
                        if (this._prevTriggerCounter != this.triggerCounter) return 1;
                        for (; this._i < this._asyncInput.length; ++this._i) {
                            if (!this._asyncFilter) return 1;
                            if (Date.now() > stopTime) return this._i / this._asyncInput.length;
                            var key = this._asyncInput[this._i];
                            var contains = this._asyncFilter.containsKey(key);
                            if (contains != this._asyncInverse) {
                                this._asyncOutput.push(key);
                                this._async_map_key.set(key, true);
                            }
                        }
                        return 1;
                    }
                }, {
                    key: "asyncComplete",
                    value: function asyncComplete() {
                        if (this._prevTriggerCounter != this.triggerCounter) {
                            this.validateFilteredKeys();
                            return;
                        }
                        this._prevTriggerCounter++;
                        this._filteredKeys = this._asyncOutput;
                        this.map_key = this._async_map_key;
                        this.triggerCallbacks();
                    }
                }, {
                    key: "keyFilter",
                    get: function get() {
                        return this._dynamicKeyFilter;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        if (this._prevTriggerCounter != this.triggerCounter) this.validateFilteredKeys();
                        return this._filteredKeys;
                    }
                }]);

                return FilteredKeySet;
            }(CallbackCollection);
            FilteredKeySet.debug = false;
            FilteredKeySet = FilteredKeySet_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.FilteredKeySet", interfaces: [IFilteredKeySet, IKeySet, ICallbackCollection, IDisposableObject] })], FilteredKeySet);
            key_5.FilteredKeySet = FilteredKeySet;
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var StandardLib = weavejs.util.StandardLib;

            var ColumnDataTask = function () {
                function ColumnDataTask(parentColumn) {
                    var _this115 = this;

                    var dataFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var callback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    _classCallCheck(this, ColumnDataTask);

                    /**
                     * Asynchronous output.
                     * recordKey:IQualifiedKey -&gt; Array&lt;Number&gt;
                     */
                    this.uniqueKeys = [];
                    /**
                     * Asynchronous output.
                     */
                    this.map_key_arrayData = new Map();
                    this.iterate = function (stopTime) {
                        for (; _this115.i < _this115.n; _this115.i++) {
                            if (Date.now() > stopTime) return _this115.i / _this115.n;
                            var value = _this115.data[_this115.i];
                            if (_this115.dataFilter != null && !_this115.dataFilter(value)) continue;
                            var key = _this115.keys[_this115.i];
                            var array = _this115.map_key_arrayData.get(key);
                            if (!array) {
                                _this115.uniqueKeys.push(key);
                                _this115.map_key_arrayData.set(key, array = [value]);
                            } else {
                                array.push(value);
                            }
                        }
                        return 1;
                    };
                    if (callback == null) callback = parentColumn.triggerCallbacks;
                    this.parentColumn = parentColumn;
                    this.dataFilter = dataFilter;
                    this.callback = callback;
                }
                /**
                 * @param inputKeys An Array of IQualifiedKey objects.
                 * @param inputData An Array of data values corresponding to the inputKeys.
                 */


                _createClass(ColumnDataTask, [{
                    key: "begin",
                    value: function begin(inputKeys, inputData) {
                        if (inputKeys.length != inputData.length) throw new Error(StandardLib.substitute("Arrays are of different length ({0} != {1})", inputKeys.length, inputData.length));
                        // this.dataFilter = this.dataFilter;
                        this.keys = inputKeys;
                        this.data = inputData;
                        this.i = 0;
                        this.n = this.keys.length;
                        this.uniqueKeys = [];
                        this.map_key_arrayData = new Map();
                        // high priority because not much can be done without data
                        WeaveAPI.Scheduler.startTask(this.parentColumn, this.iterate, WeaveAPI.TASK_PRIORITY_HIGH, this.callback, Weave.lang("Processing {0} records", this.n));
                    }
                }]);

                return ColumnDataTask;
            }();

            column.ColumnDataTask = ColumnDataTask;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var IStatisticsCache = weavejs.api.data.IStatisticsCache;
        /**
         * This is an all-static class containing numerical statistics on columns and functions to access the statistics.
         *
         * @author adufilie
         */
        var StatisticsCache = function () {
            function StatisticsCache() {
                _classCallCheck(this, StatisticsCache);

                this.map_column_stats = new WeakMap();
            }
            /**
             * @param column A column to get statistics for.
             * @return A Map that maps a IQualifiedKey to a running total numeric value, based on the order of the keys in the column.
             */


            _createClass(StatisticsCache, [{
                key: "getRunningTotals",
                value: function getRunningTotals(column) {
                    return Weave.AS(this.getColumnStatistics(column), data.ColumnStatistics).getRunningTotals();
                }
            }, {
                key: "getColumnStatistics",
                value: function getColumnStatistics(column) {
                    if (column == null) throw new Error("getColumnStatistics(): Column parameter cannot be null.");
                    if (Weave.wasDisposed(column)) {
                        this.map_column_stats.delete(column);
                        throw new Error("Invalid attempt to retrieve statistics for a disposed column.");
                    }
                    var stats = this.map_column_stats.get(column);
                    if (!stats) {
                        stats = new data.ColumnStatistics(column);
                        // when the column is disposed, the stats should be disposed
                        this.map_column_stats.set(column, Weave.disposableChild(column, stats));
                    }
                    return stats;
                }
            }]);

            return StatisticsCache;
        }();
        StatisticsCache = __decorate([Weave.classInfo({ id: "weavejs.data.StatisticsCache", interfaces: [IStatisticsCache] })], StatisticsCache);
        data.StatisticsCache = StatisticsCache;
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var path;
    (function (path_1) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ILinkableHashMap = weavejs.api.core.ILinkableHashMap;
        var IAttributeColumn = weavejs.api.data.IAttributeColumn;
        var LinkableHashMap = weavejs.core.LinkableHashMap;
        var LinkableString = weavejs.core.LinkableString;
        var StandardLib = weavejs.util.StandardLib;
        var ExternalTool_1 = void 0;
        var ExternalTool = ExternalTool_1 = function (_LinkableHashMap) {
            _inherits(ExternalTool, _LinkableHashMap);

            function ExternalTool() {
                _classCallCheck(this, ExternalTool);

                /**
                 * The popup's window.name
                 */
                var _this116 = _possibleConstructorReturn(this, (ExternalTool.__proto__ || Object.getPrototypeOf(ExternalTool)).call(this));

                _this116.windowName = ExternalTool_1.generateWindowName();
                _this116.toolUrl = _this116.requestObject("toolUrl", LinkableString, true);
                _this116.toolUrl.addGroupedCallback(_this116, _this116.toolPropertiesChanged);
                return _this116;
            }

            _createClass(ExternalTool, [{
                key: "toolPropertiesChanged",
                value: function toolPropertiesChanged() {
                    if (this.toolUrl.value) {
                        this.launch();
                    }
                }
            }, {
                key: "launch",
                value: function launch() {
                    return ExternalTool_1.launch(this, this.toolUrl.value, this.windowName, "menubar=no,status=no,toolbar=no");
                }
            }, {
                key: "dispose",

                /* override */value: function dispose() {
                    _get(ExternalTool.prototype.__proto__ || Object.getPrototypeOf(ExternalTool.prototype), "dispose", this).call(this);
                    try {
                        window[ExternalTool_1.WEAVE_EXTERNAL_TOOLS][this.windowName].window.close();
                        delete window[ExternalTool_1.WEAVE_EXTERNAL_TOOLS][this.windowName];
                    } catch (e) {}
                }
                /**
                 * @inheritDoc
                 */

            }, {
                key: "getSelectableAttributeNames",
                value: function getSelectableAttributeNames() {
                    return this.getSelectableAttributes().map(this.getLabel);
                }
            }, {
                key: "getLabel",
                value: function getLabel(obj) {
                    var label = WeaveAPI.EditorManager.getLabel(obj);
                    if (!label) {
                        var path = Weave.findPath(this, obj);
                        if (path) label = path.join('/');
                    }
                    return label;
                }
                /**
                 * @inheritDoc
                 */

            }, {
                key: "getSelectableAttributes",
                value: function getSelectableAttributes() {
                    var _this117 = this;

                    var hashMaps = [this].concat(Weave.getDescendants(this, ILinkableHashMap));
                    var flatList = Array.prototype.concat.apply([], hashMaps.map(function (hm) {
                        return hm.getObjects(IAttributeColumn);
                    }));
                    return flatList.filter(function (item) {
                        return _this117.getLabel(item) && true;
                    });
                    //return getObjects(IAttributeColumn);
                }
            }], [{
                key: "generateWindowName",
                value: function generateWindowName() {
                    return StandardLib.replace(StandardLib.guid(), '-', '');
                }
            }, {
                key: "launch",
                value: function launch(owner, url) {
                    var windowName = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';
                    var features = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    var path = Weave.getPath(owner); // TODO fix this
                    if (!window[ExternalTool_1.WEAVE_EXTERNAL_TOOLS]) {
                        window[ExternalTool_1.WEAVE_EXTERNAL_TOOLS] = {};
                        // when we close this window, close all popups
                        if (window.addEventListener) window.addEventListener("unload", function () {
                            for (var key in window[ExternalTool_1.WEAVE_EXTERNAL_TOOLS]) {
                                try {
                                    window[ExternalTool_1.WEAVE_EXTERNAL_TOOLS][key].window.close();
                                } catch (e) {}
                            }
                        });
                    }
                    var popup = window.open(url, windowName, features);
                    window[ExternalTool_1.WEAVE_EXTERNAL_TOOLS][windowName] = { "path": path, "window": popup };
                    if (!popup) console.error("External tool popup was blocked by the web browser.");
                    return !!popup;
                }
            }]);

            return ExternalTool;
        }(LinkableHashMap);
        /**
         * The name of the global JavaScript variable which is a mapping from a popup's
         * window.name to an object containing "path" and "window" properties.
         */
        ExternalTool.WEAVE_EXTERNAL_TOOLS = 'WeaveExternalTools';
        ExternalTool = ExternalTool_1 = __decorate([Weave.classInfo({ id: 'weavejs.path.ExternalTool', interfaces: [ILinkableHashMap] })], ExternalTool);
        path_1.ExternalTool = ExternalTool;
    })(path = weavejs.path || (weavejs.path = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var util;
    (function (util) {
        var DynamicState = weavejs.api.core.DynamicState;
        var LinkableHashMap = weavejs.core.LinkableHashMap;
        var LinkableString = weavejs.core.LinkableString;
        var LinkableVariable = weavejs.core.LinkableVariable;
        var ExternalTool = weavejs.path.ExternalTool;

        var BackwardsCompatibility = function () {
            function BackwardsCompatibility() {
                _classCallCheck(this, BackwardsCompatibility);
            }

            _createClass(BackwardsCompatibility, null, [{
                key: "forceDeprecatedState",
                value: function forceDeprecatedState(classDef) {
                    BackwardsCompatibility.map_class_ignore.set(classDef, true);
                }
            }, {
                key: "updateSessionState",
                value: function updateSessionState(state) {
                    var key;
                    if (!DynamicState.isDynamicStateArray(state)) {
                        if ((typeof state === "undefined" ? "undefined" : _typeof(state)) === 'object') for (key in state) {
                            state[key] = BackwardsCompatibility.updateSessionState(state[key]);
                        }return state;
                    }
                    for (key in state) {
                        var typedState = state[key];
                        var className = typedState[DynamicState.CLASS_NAME];
                        if (!BackwardsCompatibility.classLookup.hasOwnProperty(className)) continue;
                        var classDef = Weave.getDefinition(className);
                        var externalToolClass = DynamicState.traverseState(typedState[DynamicState.SESSION_STATE], [BackwardsCompatibility.CLASS]);
                        if (classDef == ExternalTool && Weave.getDefinition(externalToolClass)) {
                            typedState[DynamicState.CLASS_NAME] = externalToolClass;
                            var newState = {};
                            for (var key in typedState[DynamicState.SESSION_STATE]) {
                                var item = typedState[DynamicState.SESSION_STATE][key];
                                var itemName = item[DynamicState.OBJECT_NAME];
                                if (itemName != BackwardsCompatibility.CLASS) newState[itemName] = item[DynamicState.SESSION_STATE];
                            }
                            typedState[DynamicState.SESSION_STATE] = newState;
                        }
                        if (classDef && !BackwardsCompatibility.map_class_ignore.get(classDef)) continue;
                        if (!BackwardsCompatibility.classLookup[className]) {
                            typedState[DynamicState.CLASS_NAME] = Weave.className(LinkableVariable);
                            continue;
                        }
                        typedState[DynamicState.CLASS_NAME] = Weave.className(LinkableHashMap);
                        var classNameState = DynamicState.create(BackwardsCompatibility.CLASS, Weave.className(LinkableString), className);
                        var childState = typedState[DynamicState.SESSION_STATE];
                        if (DynamicState.isDynamicStateArray(childState)) {
                            childState.unshift(classNameState);
                        } else {
                            var typedChildState = [classNameState];
                            var childStateKeys = Object.keys(childState).sort();
                            var _iteratorNormalCompletion58 = true;
                            var _didIteratorError58 = false;
                            var _iteratorError58 = undefined;

                            try {
                                for (var _iterator58 = (childStateKeys || [])[Symbol.iterator](), _step58; !(_iteratorNormalCompletion58 = (_step58 = _iterator58.next()).done); _iteratorNormalCompletion58 = true) {
                                    var key = _step58.value;

                                    var propType = BackwardsCompatibility.classLookup[className][key];
                                    if (propType) {
                                        // Hack - if the class name is an interface, remove the package and the "I" from the beginning to get the implementation.
                                        if (propType.indexOf('weave.api.') == 0) {
                                            var name = propType.split('::').pop();
                                            if (name.charAt(0) === 'I' && name.charAt(1) === name.charAt(1).toUpperCase()) {
                                                name = name.substr(1);
                                                classDef = Weave.getDefinition(name);
                                                if (classDef) propType = Weave.className(classDef);
                                            }
                                        }
                                        typedChildState.push(DynamicState.create(key, propType, BackwardsCompatibility.updateSessionState(childState[key])));
                                    }
                                }
                            } catch (err) {
                                _didIteratorError58 = true;
                                _iteratorError58 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion58 && _iterator58.return) {
                                        _iterator58.return();
                                    }
                                } finally {
                                    if (_didIteratorError58) {
                                        throw _iteratorError58;
                                    }
                                }
                            }

                            childState = typedChildState;
                        }
                        typedState[DynamicState.SESSION_STATE] = BackwardsCompatibility.updateSessionState(childState);
                    }
                    return state;
                }
            }]);

            return BackwardsCompatibility;
        }();

        BackwardsCompatibility.map_class_ignore = new Map();
        BackwardsCompatibility.CLASS = 'class';
        BackwardsCompatibility.classLookup = {
            "weave.core::CallbackCollection": null,
            "weave.core::ChildListCallbackInterface": {
                "lastObjectAdded": "weave.api.core::ILinkableObject",
                "lastObjectRemoved": "weave.api.core::ILinkableObject"
            },
            "weave.core::EditorManager": null,
            "weave.core::ErrorManager": null,
            "weave.core::GlobalObjectReference": null,
            "weave.core::LinkableBoolean": null,
            "weave.core::LinkableCallbackScript": {
                "delayWhileBusy": "weave.core::LinkableBoolean",
                "groupedCallback": "weave.core::LinkableBoolean",
                "script": "weave.core::LinkableString",
                "variables": "weave.core::LinkableHashMap"
            },
            "weave.core::LinkableDisplayObject": {
                "children": "weave.api.core::ILinkableHashMap",
                "className": "weave.core::LinkableString",
                "events": "weave.core::UntypedLinkableVariable",
                "parentLDO": "weave.core::LinkableDisplayObject",
                "properties": "weave.core::UntypedLinkableVariable"
            },
            "weave.core::LinkableDynamicDisplayObject": null,
            "weave.core::LinkableDynamicObject": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.core::LinkableFile": null,
            "weave.core::LinkableFunction": null,
            "weave.core::LinkableHashMap": {
                "childListCallbacks": "weave.api.core::IChildListCallbackInterface"
            },
            "weave.core::LinkableNumber": null,
            "weave.core::LinkablePromise": null,
            "weave.core::LinkableString": null,
            "weave.core::LinkableSynchronizer": {
                "primaryPath": "weave.core::LinkableVariable",
                "primaryTransform": "weave.core::LinkableFunction",
                "secondaryPath": "weave.core::LinkableVariable",
                "secondaryTransform": "weave.core::LinkableFunction"
            },
            "weave.core::LinkableVariable": null,
            "weave.core::LinkableWatcher": {
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.core::LinkableWrapper": {
                "objectType": "weave.core::LinkableString",
                "properties": "weave.core::UntypedLinkableVariable"
            },
            "weave.core::LinkableXML": null,
            "weave.core::ProgressIndicator": null,
            "weave.core::SessionStateLog": {
                "enableLogging": "weave.core::LinkableBoolean"
            },
            "weave.core::UntypedLinkableVariable": null,
            "weave.data.AttributeColumns::AbstractAttributeColumn": null,
            "weave.data.AttributeColumns::AlwaysDefinedColumn": {
                "defaultValue": "weave.core::UntypedLinkableVariable",
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.data.AttributeColumns::BinnedColumn": {
                "binningDefinition": "weave.data.BinningDefinitions::DynamicBinningDefinition",
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.data.AttributeColumns::CSVColumn": {
                "data": "weave.core::LinkableVariable",
                "keyType": "weave.core::LinkableString",
                "numericMode": "weave.core::LinkableBoolean",
                "title": "weave.core::LinkableString"
            },
            "weave.data.AttributeColumns::ColorColumn": {
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn",
                "ramp": "weave.primitives::ColorRamp",
                "rampCenterAtZero": "weave.core::LinkableBoolean",
                "recordColors": "weave.core::LinkableVariable"
            },
            "weave.data.AttributeColumns::CombinedColumn": {
                "columns": "weave.api.core::ILinkableHashMap",
                "useFirstColumnMetadata": "weave.core::LinkableBoolean"
            },
            "weave.data.AttributeColumns::DateColumn": null,
            "weave.data.AttributeColumns::DynamicColumn": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.data.AttributeColumns::EquationColumn": {
                "equation": "weave.core::LinkableString",
                "filterByKeyType": "weave.core::LinkableBoolean",
                "metadata": "weave.core::UntypedLinkableVariable",
                "variables": "weave.core::LinkableHashMap"
            },
            "weave.data.AttributeColumns::ExtendedDynamicColumn": {
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.data.AttributeColumns::FilteredColumn": {
                "filter": "weave.api.data::IDynamicKeyFilter",
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.data.AttributeColumns::GeometryColumn": null,
            "weave.data.AttributeColumns::ImageColumn": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.data.AttributeColumns::KeyColumn": {
                "keyType": "weave.core::LinkableString"
            },
            "weave.data.AttributeColumns::NormalizedColumn": {
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn",
                "max": "weave.core::LinkableNumber",
                "min": "weave.core::LinkableNumber"
            },
            "weave.data.AttributeColumns::NumberColumn": null,
            "weave.data.AttributeColumns::ProxyColumn": null,
            "weave.data.AttributeColumns::ReferencedColumn": {
                "dataSourceName": "weave.core::LinkableString",
                "metadata": "weave.core::LinkableVariable"
            },
            "weave.data.AttributeColumns::ReprojectedGeometryColumn": {
                "boundingBoxCallbacks": "weave.api.core::ICallbackCollection",
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn",
                "projectionSRS": "weave.core::LinkableString"
            },
            "weave.data.AttributeColumns::SecondaryKeyNumColumn": null,
            "weave.data.AttributeColumns::SortedColumn": {
                "ascending": "weave.core::LinkableBoolean",
                "internalDynamicColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.data.AttributeColumns::SortedIndexColumn": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.data.AttributeColumns::StreamedGeometryColumn": {
                "boundingBoxCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.data.AttributeColumns::StringColumn": null,
            "weave.data.AttributeColumns::StringLookup": null,
            "weave.data.AttributeColumns::StringLookupColumn": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.data.AttributeColumns::WordCountColumn": {
                "wordData": "weave.core::LinkableString"
            },
            "weave.data.BinClassifiers::NumberClassifier": {
                "max": "weave.core::LinkableNumber",
                "maxInclusive": "weave.core::LinkableBoolean",
                "min": "weave.core::LinkableNumber",
                "minInclusive": "weave.core::LinkableBoolean"
            },
            "weave.data.BinClassifiers::SingleValueClassifier": null,
            "weave.data.BinClassifiers::StringClassifier": null,
            "weave.data.BinningDefinitions::AbstractBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber"
            },
            "weave.data.BinningDefinitions::CategoryBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber"
            },
            "weave.data.BinningDefinitions::CustomSplitBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber",
                "splitValues": "weave.core::LinkableString"
            },
            "weave.data.BinningDefinitions::DynamicBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.data.BinningDefinitions::EqualIntervalBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "dataInterval": "weave.core::LinkableNumber",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber"
            },
            "weave.data.BinningDefinitions::ExplicitBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "childListCallbacks": "weave.api.core::IChildListCallbackInterface"
            },
            "weave.data.BinningDefinitions::NaturalJenksBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "numOfBins": "weave.core::LinkableNumber",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber"
            },
            "weave.data.BinningDefinitions::QuantileBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber",
                "refQuantile": "weave.core::LinkableNumber"
            },
            "weave.data.BinningDefinitions::SimpleBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "numberOfBins": "weave.core::LinkableNumber",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber"
            },
            "weave.data.BinningDefinitions::StandardDeviationBinningDefinition": {
                "asyncResultCallbacks": "weave.api.core::ICallbackCollection",
                "overrideBinNames": "weave.core::LinkableString",
                "overrideInputMax": "weave.core::LinkableNumber",
                "overrideInputMin": "weave.core::LinkableNumber"
            },
            "weave.data.DataSources::AbstractDataSource": {
                "hierarchyRefresh": "weave.api.core::ICallbackCollection"
            },
            "weave.data.DataSources::AbstractDataSource_old": {
                "attributeHierarchy": "weave.core::LinkableXML",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection"
            },
            "weave.data.DataSources::AnnotationDataSource": {
                "annotations": "weave.core::LinkableVariable",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection"
            },
            "weave.data.DataSources::CKANDataSource": {
                "apiVersion": "weave.core::LinkableNumber",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "showGroups": "weave.core::LinkableBoolean",
                "showPackages": "weave.core::LinkableBoolean",
                "showTags": "weave.core::LinkableBoolean",
                "url": "weave.core::LinkableString",
                "useDataStore": "weave.core::LinkableBoolean",
                "useHttpPost": "weave.core::LinkableBoolean"
            },
            "weave.data.DataSources::CSVDataSource": {
                "csvData": "weave.core::LinkableVariable",
                "delimiter": "weave.core::LinkableString",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "keyColName": "weave.core::LinkableString",
                "keyType": "weave.core::LinkableString",
                "metadata": "weave.core::LinkableVariable",
                "url": "weave.core::LinkableFile"
            },
            "weave.data.DataSources::CachedDataSource": {
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "state": "weave.core::LinkableVariable",
                "type": "weave.core::LinkableString"
            },
            "weave.data.DataSources::CensusApi": null,
            "weave.data.DataSources::CensusDataSource": {
                "apiKey": "weave.core::LinkableString",
                "dataSet": "weave.core::LinkableString",
                "geographicFilters": "weave.core::LinkableVariable",
                "geographicScope": "weave.core::LinkableString",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "keyType": "weave.core::LinkableString"
            },
            "weave.data.DataSources::DBFDataSource": {
                "dbfUrl": "weave.core::LinkableString",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "keyColName": "weave.core::LinkableString",
                "keyType": "weave.core::LinkableString",
                "projection": "weave.core::LinkableString",
                "shpUrl": "weave.core::LinkableString"
            },
            "weave.data.DataSources::FREDDataSource": {
                "apiKey": "weave.core::LinkableString",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection"
            },
            "weave.data.DataSources::GeoJSONDataSource": {
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "keyProperty": "weave.core::LinkableString",
                "keyType": "weave.core::LinkableString",
                "projection": "weave.core::LinkableString",
                "url": "weave.core::LinkableFile"
            },
            "weave.data.DataSources::GraphMLDataSource": {
                "edgeKeyPropertyName": "weave.core::LinkableString",
                "edgeKeyType": "weave.core::LinkableString",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "nodeKeyPropertyName": "weave.core::LinkableString",
                "nodeKeyType": "weave.core::LinkableString",
                "sourceUrl": "weave.core::LinkableString"
            },
            "weave.data.DataSources::HealthIndicatorsDataSource": {
                "apiKey": "weave.core::LinkableString",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection"
            },
            "weave.data.DataSources::IDataSource_old": {
                "attributeHierarchy": "weave.core::LinkableXML"
            },
            "weave.data.DataSources::SocrataDataSource": {
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "jsonCache": "weave.services::JsonCache",
                "showCategories": "weave.core::LinkableBoolean",
                "showTags": "weave.core::LinkableBoolean",
                "showViewTypes": "weave.core::LinkableBoolean",
                "url": "weave.core::LinkableString"
            },
            "weave.data.DataSources::TransposedDataSource": {
                "attributeHierarchy": "weave.core::LinkableXML",
                "columns": "weave.api.core::ILinkableHashMap",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "metadata": "weave.api.core::ILinkableHashMap"
            },
            "weave.data.DataSources::WFSDataSource": {
                "attributeHierarchy": "weave.core::LinkableXML",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "swapXY": "weave.core::LinkableBoolean",
                "url": "weave.core::LinkableString",
                "useURLsInGetCapabilities": "weave.core::LinkableBoolean"
            },
            "weave.data.DataSources::WeaveAnalystDataSource": {
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "inputKeyFilter": "weave.core::LinkableDynamicObject",
                "inputs": "weave.core::LinkableHashMap",
                "outputKeyColumn": "weave.core::LinkableString",
                "outputKeyType": "weave.core::LinkableString",
                "scriptName": "weave.core::LinkableString",
                "url": "weave.core::LinkableString"
            },
            "weave.data.DataSources::WeaveDataSource": {
                "attributeHierarchy": "weave.core::LinkableXML",
                "entityCache": "weave.services::EntityCache",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "hierarchyURL": "weave.core::LinkableString",
                "rootId": "weave.core::LinkableVariable",
                "url": "weave.core::LinkableString"
            },
            "weave.data.DataSources::XLSDataSource": {
                "attributeHierarchy": "weave.core::LinkableXML",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "keyColName": "weave.core::LinkableString",
                "keyType": "weave.core::LinkableString",
                "url": "weave.core::LinkableString"
            },
            "weave.data.KeySets::ColumnDataFilter": {
                "column": "weave.data.AttributeColumns::DynamicColumn",
                "enabled": "weave.core::LinkableBoolean",
                "includeMissingKeyTypes": "weave.core::LinkableBoolean",
                "values": "weave.core::LinkableVariable"
            },
            "weave.data.KeySets::DynamicKeyFilter": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.data.KeySets::DynamicKeySet": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.data.KeySets::FilteredKeySet": {
                "keyFilter": "weave.api.data::IDynamicKeyFilter"
            },
            "weave.data.KeySets::KeyFilter": {
                "excluded": "weave.data.KeySets::KeySet",
                "filters": "weave.api.core::ILinkableHashMap",
                "includeMissingKeyTypes": "weave.core::LinkableBoolean",
                "includeMissingKeys": "weave.core::LinkableBoolean",
                "included": "weave.data.KeySets::KeySet"
            },
            "weave.data.KeySets::KeySet": {
                "keyCallbacks": "weave.api.data::IKeySetCallbackInterface"
            },
            "weave.data.KeySets::KeySetCallbackInterface": null,
            "weave.data.KeySets::KeySetUnion": {
                "busyStatus": "weave.api.core::ICallbackCollection"
            },
            "weave.data.KeySets::SortedKeySet": null,
            "weave.data.Transforms::ForeignDataMappingTransform": {
                "dataColumns": "weave.api.core::ILinkableHashMap",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "keyColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.data.Transforms::GroupedDataTransform": {
                "aggregationModes": "weave.api.core::ILinkableVariable",
                "dataColumns": "weave.api.core::ILinkableHashMap",
                "groupByColumn": "weave.data.AttributeColumns::DynamicColumn",
                "groupKeyType": "weave.core::LinkableString",
                "hierarchyRefresh": "weave.api.core::ICallbackCollection"
            },
            "weave.data.Transforms::PartitionDataTransform": {
                "hierarchyRefresh": "weave.api.core::ICallbackCollection",
                "inputColumns": "weave.api.core::ILinkableHashMap",
                "partitionColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.data.hierarchy::EntityNodeSearch": null,
            "weave.data.hierarchy::GlobalColumnDataSource": {
                "hierarchyRefresh": "weave.api.core::ICallbackCollection"
            },
            "weave.data.hierarchy::WeaveRootDataTreeNode": {
                "dependency": "weave.api.core::ILinkableObject"
            },
            "weave.data::CSVParser": null,
            "weave.editors.managers::AddDataSourcePanel": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.editors.managers::DataSourceManager": {
                "browser": "weave.editors::DynamicColumnEditor",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.editors.managers::EditDataGridPanel": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.editors::DiscreteValuesDataFilterEditor": {
                "filter": "weave.data.KeySets::ColumnDataFilter",
                "labelFunction": "weave.core::LinkableFunction",
                "layoutMode": "weave.core::LinkableString",
                "showPlayButton": "weave.core::LinkableBoolean",
                "showToggle": "weave.core::LinkableBoolean",
                "showToggleLabel": "weave.core::LinkableBoolean",
                "thumbColor": "weave.core::LinkableNumber"
            },
            "weave.editors::DynamicColumnEditor": {
                "explorer": "weave.ui::HierarchyExplorer",
                "referencedColumn": "weave.data.AttributeColumns::ReferencedColumn",
                "target": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.editors::ForeignDataMappingTransformEditor": {
                "dataColumnsEditor": "weave.ui::ColumnListComponent",
                "keyColumnEditor": "weave.ui::DynamicColumnComponent"
            },
            "weave.editors::GroupedDataTransformEditor": {
                "dataColumnsEditor": "weave.ui::ColumnListComponent",
                "groupByColumnEditor": "weave.ui::DynamicColumnComponent"
            },
            "weave.editors::NumericRangeDataFilterEditor": {
                "discreteValueLabelInterval": "weave.core::LinkableNumber",
                "filter": "weave.data.KeySets::ColumnDataFilter",
                "forceDiscreteValues": "weave.core::LinkableBoolean",
                "labelFunction": "weave.core::LinkableFunction",
                "playStep": "weave.core::LinkableNumber",
                "showMaxThumb": "weave.core::LinkableBoolean",
                "showMinThumb": "weave.core::LinkableBoolean",
                "showPlayButton": "weave.core::LinkableBoolean",
                "showToggle": "weave.core::LinkableBoolean",
                "showToggleLabel": "weave.core::LinkableBoolean",
                "thumbColor": "weave.core::LinkableNumber"
            },
            "weave.editors::PartitionDataTransformEditor": {
                "inputColumnsEditor": "weave.ui::ColumnListComponent",
                "partitionColumnEditor": "weave.ui::DynamicColumnComponent"
            },
            "weave.editors::PrincipalComponentEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "columnList": "weave.ui::ColumnListComponent",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.editors::SessionHistorySlider": {
                "squashActive": "weave.core::LinkableBoolean"
            },
            "weave.editors::TransposedDataSourceEditor": {
                "columns": "weave.api.core::ILinkableHashMap",
                "columnsEditor": "weave.ui::ColumnListComponent",
                "metadata": "weave.api.core::ILinkableHashMap",
                "metadataEditor": "weave.ui::ColumnListComponent",
                "titleColumnEditor": "weave.ui::DynamicColumnComponent"
            },
            "weave.editors::WeavePropertiesEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.graphs::AbstractGraphAlgorithm": null,
            "weave.graphs::DynamicGraphAlgorithm": {
                "internalObject": "weave.api.graphs::IGraphAlgorithm"
            },
            "weave.graphs::ForceDirectedLayout": null,
            "weave.graphs::GridForceDirectedLayout": null,
            "weave.graphs::KamadaKawaiLayout": null,
            "weave.graphs::LargeGraphLayout": null,
            "weave.primitives::ColorRamp": null,
            "weave.primitives::LinkableBounds2D": null,
            "weave.primitives::LinkableNumberFormatter": {
                "decimalSeparatorFrom": "weave.core::LinkableString",
                "decimalSeparatorTo": "weave.core::LinkableString",
                "precision": "weave.core::LinkableNumber",
                "rounding": "weave.core::LinkableString",
                "thousandsSeparatorFrom": "weave.core::LinkableString",
                "thousandsSeparatorTo": "weave.core::LinkableString",
                "useNegativeSign": "weave.core::LinkableBoolean",
                "useThousandsSeparator": "weave.core::LinkableBoolean"
            },
            "weave.primitives::ZoomBounds": null,
            "weave.radviz::AbstractLayoutAlgorithm": null,
            "weave.radviz::BruteForceLayoutAlgorithm": null,
            "weave.radviz::ClassDiscriminationLayoutAlgorithm": null,
            "weave.radviz::GreedyLayoutAlgorithm": null,
            "weave.radviz::IncrementalLayoutAlgorithm": null,
            "weave.radviz::NearestNeighborLayoutAlgorithm": null,
            "weave.radviz::RandomLayoutAlgorithm": {
                "iterations": "weave.core::LinkableNumber"
            },
            "weave.services.wms::AbstractWMS": null,
            "weave.services.wms::CustomWMS": {
                "creditInfo": "weave.core::LinkableString",
                "maxZoom": "weave.core::LinkableNumber",
                "tileBounds": "weave.core::LinkableVariable",
                "tileProjectionSRS": "weave.core::LinkableString",
                "wmsURL": "weave.core::LinkableString"
            },
            "weave.services.wms::ModestMapsWMS": {
                "providerName": "weave.core::LinkableString"
            },
            "weave.services.wms::OnEarthProvider": null,
            "weave.services.wms::WMSTile": null,
            "weave.services::AMF3Servlet": null,
            "weave.services::AsyncInvocationQueue": null,
            "weave.services::EntityCache": null,
            "weave.services::JsonCache": null,
            "weave.services::LocalAsyncService": null,
            "weave.services::Servlet": null,
            "weave.services::WFSServlet": null,
            "weave.services::WeaveDataServlet": null,
            "weave.services::WeaveRServlet": null,
            "weave.services::WebServiceWrapper": null,
            "weave.ui.CustomDataGrid::IFilterComponent": null,
            "weave.ui.CustomDataGrid::SearchFilterComponent": {
                "strToSearch": "weave.core::LinkableString"
            },
            "weave.ui.CustomDataGrid::SliderFilterComponent": {
                "maximum": "weave.core::LinkableNumber",
                "minimum": "weave.core::LinkableNumber"
            },
            "weave.ui.DataMiningEditors::ClusteringCollection": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputColumns": "weave.core::LinkableHashMap",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui.DataMiningEditors::DataMiningPlatter": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "columns": "weave.ui::ColumnListComponent",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputVariables": "weave.api.core::ILinkableHashMap",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui.DataMiningEditors::FuzzyKMeansClustering": {
                "inputColumns": "weave.core::LinkableHashMap"
            },
            "weave.ui.DataMiningEditors::FuzzyKMeansClusteringEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "fkMeansColumns": "weave.ui::ColumnListComponent",
                "fuzzyKMeans": "weave.ui.DataMiningEditors::FuzzyKMeansClustering",
                "inputColumns": "weave.core::LinkableHashMap",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui.DataMiningEditors::KMeansClusteringEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputColumns": "weave.core::LinkableHashMap",
                "kMeansColumns": "weave.ui::ColumnListComponent",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui.DataMiningEditors::PamClusteringEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputColumns": "weave.core::LinkableHashMap",
                "kMeansColumns": "weave.ui::ColumnListComponent",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui.DataMiningEditors::PartitionAroundMedoidsClustering": {
                "inputColumns": "weave.core::LinkableHashMap"
            },
            "weave.ui.collaboration::CollaborationEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui.collaboration::CollaborationTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui.controlBars::VisTaskbar": {
                "taskbarLargeIconSize": "weave.core::LinkableNumber",
                "taskbarShrinkGrow": "weave.core::LinkableBoolean",
                "taskbarSmallIconSize": "weave.core::LinkableNumber"
            },
            "weave.ui::AttributeMenuTool": {
                "alwaysShowPrompt": "weave.core::LinkableBoolean",
                "autoPlayRepeat": "weave.core::LinkableBoolean",
                "buttonRadius": "weave.core::LinkableNumber",
                "choices": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "labelFunction": "weave.core::LinkableFunction",
                "layoutMode": "weave.core::LinkableString",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "prompt": "weave.core::LinkableString",
                "selectedAttribute": "weave.core::LinkableString",
                "showPlayButton": "weave.core::LinkableBoolean",
                "targetAttribute": "weave.core::LinkableVariable",
                "targetToolPath": "weave.core::LinkableVariable",
                "useChoiceIndex": "weave.core::LinkableBoolean",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::AttributeSelectorPanel": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "columnList": "weave.ui::ColumnListComponent",
                "controlPanel": "weave.ui::ControlPanel",
                "editor": "weave.editors::DynamicColumnEditor",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::BasicLinkableLayoutManager": null,
            "weave.ui::BinningDefinitionEditor": {
                "_simple": "weave.data.BinningDefinitions::SimpleBinningDefinition"
            },
            "weave.ui::CirclePlotterSettings": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "plotter": "weave.visualization.plotters::CirclePlotter",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::ColorController": {
                "binEditor": "weave.ui::BinningDefinitionEditor",
                "buttonRadius": "weave.core::LinkableNumber",
                "cRampEditor": "weave.ui::ColorRampEditor",
                "closeable": "weave.core::LinkableBoolean",
                "colorOverrideEditor": "weave.ui::ColorOverrideEditor",
                "controlPanel": "weave.ui::ControlPanel",
                "dataColumnComponent": "weave.ui::DynamicColumnComponent",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::ColorOverrideEditor": {
                "recordColors": "weave.core::LinkableVariable"
            },
            "weave.ui::ColorRampEditor": {
                "colorRamp": "weave.primitives::ColorRamp",
                "colorRampList": "weave.ui::ColorRampList"
            },
            "weave.ui::ColorRampList": {
                "colorRamp": "weave.primitives::ColorRamp"
            },
            "weave.ui::ColumnListComponent": {
                "hashMap": "weave.api.core::ILinkableHashMap"
            },
            "weave.ui::ControlPanel": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::DataFilterTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "editor": "weave.core::LinkableDynamicObject",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "filter": "weave.core::LinkableDynamicObject",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::DimensionDropList": {
                "hashMap": "weave.core::LinkableHashMap"
            },
            "weave.ui::DraggablePanel": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::DynamicColumnComponent": null,
            "weave.ui::EquationEditor": {
                "_EquationEditor_ColumnListComponent1": "weave.ui::ColumnListComponent",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "dynamicColumn": "weave.data.AttributeColumns::DynamicColumn",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::ErrorLogPanel": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::FlexibleLayout": null,
            "weave.ui::HierarchyExplorer": {
                "fileView": "weave.ui::WeaveTree",
                "folderView": "weave.ui::WeaveTree"
            },
            "weave.ui::JRITextEditor": {
                "assignTALinkable": "weave.core::LinkableString",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputColumnList": "weave.ui::ColumnListComponent",
                "inputTALinkable": "weave.core::LinkableString",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "outputTALinkable": "weave.core::LinkableString",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "plotTALinkable": "weave.core::LinkableString",
                "variables": "weave.core::LinkableHashMap",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::JavaScriptCanvas": {
                "elementId": "weave.core::LinkableString"
            },
            "weave.ui::NumberClassifierEditor": {
                "binClassifiers": "weave.data.BinningDefinitions::ExplicitBinningDefinition"
            },
            "weave.ui::ObjectViewer": {
                "treeView": "weave.ui::WeaveTree"
            },
            "weave.ui::PenTool": {
                "coords": "weave.core::LinkableString",
                "drawingMode": "weave.core::LinkableString",
                "lineAlpha": "weave.core::LinkableNumber",
                "lineColor": "weave.core::LinkableNumber",
                "lineWidth": "weave.core::LinkableNumber",
                "polygonFillAlpha": "weave.core::LinkableNumber",
                "polygonFillColor": "weave.core::LinkableNumber"
            },
            "weave.ui::ProbeToolTipEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "columnList": "weave.ui::ColumnListComponent",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "headerList": "weave.ui::ColumnListComponent",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::ProbeToolTipWindow": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "dynamicKeySet": "weave.core::LinkableDynamicObject",
                "editor": "weave.ui::ProbeToolTipEditor",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "htmlFormatter": "weave.core::LinkableFunction",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "useHtmlText": "weave.core::LinkableBoolean",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::RTextEditor": {
                "assignTALinkable": "weave.core::LinkableString",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputColumnList": "weave.ui::ColumnListComponent",
                "inputTALinkable": "weave.core::LinkableString",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "outputTALinkable": "weave.core::LinkableString",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "plotTALinkable": "weave.core::LinkableString",
                "variables": "weave.core::LinkableHashMap",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::RecordDataTable": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::SchafersMissingDataTool": {
                "assignTALinkable": "weave.core::LinkableString",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputColumnList": "weave.ui::ColumnListComponent",
                "inputTALinkable": "weave.core::LinkableString",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "outputTALinkable": "weave.core::LinkableString",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "variables": "weave.core::LinkableHashMap",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::SelectionManager": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::SelectionSelector": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "includeAllRecordsOption": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "prompt": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::SessionNavigator": {
                "rootObject": "weave.api.core::ILinkableObject"
            },
            "weave.ui::SessionStateEditor": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "sessionNav": "weave.ui::SessionNavigator",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::SessionStateMenuTool": {
                "alwaysShowPrompt": "weave.core::LinkableBoolean",
                "autoRecord": "weave.core::LinkableBoolean",
                "buttonRadius": "weave.core::LinkableNumber",
                "choices": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "layoutMode": "weave.core::LinkableString",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "promptText": "weave.core::LinkableString",
                "selectedChoice": "weave.core::LinkableString",
                "showPlayButton": "weave.core::LinkableBoolean",
                "targets": "weave.core::LinkableHashMap",
                "thumbColor": "weave.core::LinkableNumber",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::SubsetManager": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::SubsetSelector": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "displayRecordInfo": "weave.core::LinkableBoolean",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "includeAllRecordsOption": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "prompt": "weave.core::LinkableString",
                "sliderMode": "weave.core::LinkableBoolean",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::TextTool": {
                "backgroundAlpha": "weave.core::LinkableNumber",
                "borderColor": "weave.core::LinkableNumber",
                "borderThickness": "weave.core::LinkableNumber",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "cornerRadius": "weave.core::LinkableNumber",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "htmlText": "weave.core::LinkableString",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "padding": "weave.core::LinkableNumber",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::TranslationPanel": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::UITest": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::UITestBitmapText": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.ui::VariableListController": {
                "dynamicObject": "weave.api.core::ILinkableDynamicObject",
                "hashMap": "weave.api.core::ILinkableHashMap"
            },
            "weave.ui::WeavePodLayoutManager": {
                "scale": "weave.core::LinkableNumber"
            },
            "weave.ui::WeaveTree": null,
            "weave.utils::AsyncSort": null,
            "weave.utils::GeometryStreamDecoder": {
                "metadataCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.utils::LinkableTextFormat": {
                "bold": "weave.core::LinkableBoolean",
                "color": "weave.core::LinkableNumber",
                "font": "weave.core::LinkableString",
                "italic": "weave.core::LinkableBoolean",
                "size": "weave.core::LinkableNumber",
                "underline": "weave.core::LinkableBoolean"
            },
            "weave.utils::ShpFileReader": null,
            "weave.utils::SpatialIndex": null,
            "weave.utils::VisToolGroup": {
                "colorColumn": "weave.api.data::IColumnWrapper",
                "probeKeySet": "weave.api.data::IDynamicKeySet",
                "selectionKeySet": "weave.api.data::IDynamicKeySet",
                "subsetKeyFilter": "weave.api.data::IDynamicKeyFilter"
            },
            "weave.visualization.layers.filters::LinkableDropShadowFilter": {
                "alpha": "weave.core::LinkableNumber",
                "angle": "weave.core::LinkableNumber",
                "blurX": "weave.core::LinkableNumber",
                "blurY": "weave.core::LinkableNumber",
                "color": "weave.core::LinkableNumber",
                "distance": "weave.core::LinkableNumber",
                "strength": "weave.core::LinkableNumber"
            },
            "weave.visualization.layers.filters::LinkableGlowFilter": {
                "alpha": "weave.core::LinkableNumber",
                "blurX": "weave.core::LinkableNumber",
                "blurY": "weave.core::LinkableNumber",
                "color": "weave.core::LinkableNumber",
                "strength": "weave.core::LinkableNumber"
            },
            "weave.visualization.layers::InteractionController": {
                "defaultDragMode": "weave.core::LinkableString",
                "pan": "weave.core::LinkableString",
                "probe": "weave.core::LinkableString",
                "select": "weave.core::LinkableString",
                "selectAdd": "weave.core::LinkableString",
                "selectAll": "weave.core::LinkableString",
                "selectRemove": "weave.core::LinkableString",
                "zoom": "weave.core::LinkableString",
                "zoomIn": "weave.core::LinkableString",
                "zoomOut": "weave.core::LinkableString",
                "zoomToExtent": "weave.core::LinkableString"
            },
            "weave.visualization.layers::InteractiveVisualization": {
                "enableProbe": "weave.core::LinkableBoolean",
                "enableSelection": "weave.core::LinkableBoolean",
                "enableZoomAndPan": "weave.core::LinkableBoolean",
                "plotManager": "weave.visualization.layers::PlotManager",
                "zoomFactor": "weave.core::LinkableNumber"
            },
            "weave.visualization.layers::LayerSettings": {
                "alpha": "weave.core::LinkableNumber",
                "alwaysRenderSelection": "weave.core::LinkableBoolean",
                "maxVisibleScale": "weave.core::LinkableNumber",
                "minVisibleScale": "weave.core::LinkableNumber",
                "probeFilter": "weave.api.data::IDynamicKeyFilter",
                "selectable": "weave.core::LinkableBoolean",
                "selectionFilter": "weave.api.data::IDynamicKeyFilter",
                "visible": "weave.core::LinkableBoolean"
            },
            "weave.visualization.layers::LinkableEventListener": {
                "event": "weave.core::LinkableString",
                "script": "weave.core::LinkableFunction",
                "target": "weave.core::LinkableDynamicObject"
            },
            "weave.visualization.layers::PlotManager": {
                "enableAutoZoomToExtent": "weave.core::LinkableBoolean",
                "enableAutoZoomToSelection": "weave.core::LinkableBoolean",
                "enableFixedAspectRatio": "weave.core::LinkableBoolean",
                "includeNonSelectableLayersInAutoZoom": "weave.core::LinkableBoolean",
                "layerSettings": "weave.core::LinkableHashMap",
                "marginBottom": "weave.core::LinkableString",
                "marginBottomNumber": "weave.core::LinkableNumber",
                "marginLeft": "weave.core::LinkableString",
                "marginLeftNumber": "weave.core::LinkableNumber",
                "marginRight": "weave.core::LinkableString",
                "marginRightNumber": "weave.core::LinkableNumber",
                "marginTop": "weave.core::LinkableString",
                "marginTopNumber": "weave.core::LinkableNumber",
                "maxZoomLevel": "weave.core::LinkableNumber",
                "minScreenSize": "weave.core::LinkableNumber",
                "minZoomLevel": "weave.core::LinkableNumber",
                "overrideXMax": "weave.core::LinkableNumber",
                "overrideXMin": "weave.core::LinkableNumber",
                "overrideYMax": "weave.core::LinkableNumber",
                "overrideYMin": "weave.core::LinkableNumber",
                "plotters": "weave.core::LinkableHashMap",
                "zoomBounds": "weave.primitives::ZoomBounds"
            },
            "weave.visualization.layers::PlotTask": null,
            "weave.visualization.layers::SimpleInteractiveVisualization": {
                "axesAlpha": "weave.core::LinkableNumber",
                "axesColor": "weave.core::LinkableNumber",
                "axesThickness": "weave.core::LinkableNumber",
                "bottomMarginClickCallbacks": "weave.api.core::ICallbackCollection",
                "bottomMarginColumn": "weave.api.data::IAttributeColumn",
                "enableAutoZoomXToNiceNumbers": "weave.core::LinkableBoolean",
                "enableAutoZoomYToNiceNumbers": "weave.core::LinkableBoolean",
                "enableProbe": "weave.core::LinkableBoolean",
                "enableSelection": "weave.core::LinkableBoolean",
                "enableZoomAndPan": "weave.core::LinkableBoolean",
                "gridLineAlpha": "weave.core::LinkableNumber",
                "gridLineColor": "weave.core::LinkableNumber",
                "gridLineThickness": "weave.core::LinkableNumber",
                "leftMarginClickCallbacks": "weave.api.core::ICallbackCollection",
                "leftMarginColumn": "weave.api.data::IAttributeColumn",
                "plotManager": "weave.visualization.layers::PlotManager",
                "rightMarginClickCallbacks": "weave.api.core::ICallbackCollection",
                "rightMarginColumn": "weave.api.data::IAttributeColumn",
                "topMarginClickCallbacks": "weave.api.core::ICallbackCollection",
                "topMarginColumn": "weave.api.data::IAttributeColumn",
                "zoomFactor": "weave.core::LinkableNumber"
            },
            "weave.visualization.layers::Visualization": {
                "plotManager": "weave.visualization.layers::PlotManager"
            },
            "weave.visualization.plotters.styles::DynamicFillStyle": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.visualization.plotters.styles::DynamicLineStyle": {
                "internalObject": "weave.api.core::ILinkableObject",
                "target": "weave.api.core::ILinkableObject"
            },
            "weave.visualization.plotters.styles::ExtendedFillStyle": {
                "alpha": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "color": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "enable": "weave.core::LinkableBoolean",
                "enableMissingDataGradient": "weave.core::LinkableBoolean",
                "imageURL": "weave.data.AttributeColumns::AlwaysDefinedColumn"
            },
            "weave.visualization.plotters.styles::ExtendedLineStyle": {
                "alpha": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "caps": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "color": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "enable": "weave.core::LinkableBoolean",
                "joints": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "miterLimit": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "normalizedWeightColumn": "weave.data.AttributeColumns::NormalizedColumn",
                "pixelHinting": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "scaleMode": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "weight": "weave.data.AttributeColumns::AlwaysDefinedColumn"
            },
            "weave.visualization.plotters.styles::SolidFillStyle": {
                "alpha": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "color": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "enable": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters.styles::SolidLineStyle": {
                "alpha": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "caps": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "color": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "enable": "weave.core::LinkableBoolean",
                "joints": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "miterLimit": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "normalizedWeightColumn": "weave.data.AttributeColumns::NormalizedColumn",
                "pixelHinting": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "scaleMode": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "weight": "weave.data.AttributeColumns::AlwaysDefinedColumn"
            },
            "weave.visualization.plotters::AbstractGlyphPlotter": {
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "destinationProjection": "weave.core::LinkableString",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::AbstractPlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::AnchorPlotter": {
                "anchorFillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "anchorLineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "anchorRadius": "weave.core::LinkableNumber",
                "barycenterFillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "barycenterLineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "barycenterRadius": "weave.core::LinkableNumber",
                "circleLineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "colorMap": "weave.primitives::ColorRamp",
                "enableWedgeColoring": "weave.core::LinkableBoolean",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "labelAngleRatio": "weave.core::LinkableNumber",
                "showBarycenter": "weave.core::LinkableBoolean",
                "showConvexHull": "weave.core::LinkableBoolean",
                "showVoronoi": "weave.core::LinkableBoolean",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "unrestrictAnchors": "weave.core::LinkableBoolean",
                "wordWrap": "weave.core::LinkableNumber"
            },
            "weave.visualization.plotters::AnchorPoint": {
                "classDiscriminationMetric": "weave.core::LinkableNumber",
                "classType": "weave.core::LinkableString",
                "polarRadians": "weave.core::LinkableNumber",
                "radius": "weave.core::LinkableNumber",
                "title": "weave.core::LinkableString",
                "x": "weave.core::LinkableNumber",
                "y": "weave.core::LinkableNumber"
            },
            "weave.visualization.plotters::AxisLabelPlotter": {
                "alignToDataMax": "weave.core::LinkableBoolean",
                "alongXAxis": "weave.core::LinkableBoolean",
                "angle": "weave.core::LinkableNumber",
                "begin": "weave.core::LinkableNumber",
                "color": "weave.core::LinkableNumber",
                "end": "weave.core::LinkableNumber",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "hAlign": "weave.core::LinkableString",
                "hideOverlappingText": "weave.core::LinkableBoolean",
                "interval": "weave.core::LinkableNumber",
                "labelFunction": "weave.core::LinkableFunction",
                "maxWidth": "weave.core::LinkableNumber",
                "offset": "weave.core::LinkableNumber",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "text": "weave.data.AttributeColumns::DynamicColumn",
                "textFormatAlign": "weave.core::LinkableString",
                "vAlign": "weave.core::LinkableString",
                "xScreenOffset": "weave.core::LinkableNumber",
                "yScreenOffset": "weave.core::LinkableNumber"
            },
            "weave.visualization.plotters::AxisPlotter": {
                "axisGridLineAlpha": "weave.core::LinkableNumber",
                "axisGridLineColor": "weave.core::LinkableNumber",
                "axisGridLineThickness": "weave.core::LinkableNumber",
                "axisLabelDistance": "weave.core::LinkableNumber",
                "axisLabelRelativeAngle": "weave.core::LinkableNumber",
                "axisLineAlpha": "weave.core::LinkableNumber",
                "axisLineColor": "weave.core::LinkableNumber",
                "axisLineDataBounds": "weave.primitives::LinkableBounds2D",
                "axisLineMaxValue": "weave.core::LinkableNumber",
                "axisLineMinValue": "weave.core::LinkableNumber",
                "axisLineThickness": "weave.core::LinkableNumber",
                "axisTickAlpha": "weave.core::LinkableNumber",
                "axisTickColor": "weave.core::LinkableNumber",
                "axisTickLength": "weave.core::LinkableNumber",
                "axisTickThickness": "weave.core::LinkableNumber",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "forceTickCount": "weave.core::LinkableBoolean",
                "labelDistanceIsVertical": "weave.core::LinkableBoolean",
                "labelHorizontalAlign": "weave.core::LinkableString",
                "labelNumberFormatter": "weave.primitives::LinkableNumberFormatter",
                "labelTextAlignment": "weave.core::LinkableString",
                "labelVerticalAlign": "weave.core::LinkableString",
                "showAxisName": "weave.core::LinkableBoolean",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "tickCountRequested": "weave.core::LinkableNumber",
                "tickMaxValue": "weave.core::LinkableNumber",
                "tickMinValue": "weave.core::LinkableNumber"
            },
            "weave.visualization.plotters::BackgroundTextPlotter": {
                "dependency": "weave.core::LinkableDynamicObject",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "textFormat": "weave.utils::LinkableTextFormat",
                "textFunction": "weave.core::LinkableFunction"
            },
            "weave.visualization.plotters::BarChartLegendPlotter": {
                "chartColors": "weave.primitives::ColorRamp",
                "colorIndicatesDirection": "weave.core::LinkableBoolean",
                "columns": "weave.api.core::ILinkableHashMap",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "itemLabelFunction": "weave.core::LinkableFunction",
                "legendTitleFunction": "weave.core::LinkableFunction",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "maxColumns": "weave.core::LinkableNumber",
                "reverseOrder": "weave.core::LinkableBoolean",
                "shapeSize": "weave.core::LinkableNumber",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::BoundsPlotter": {
                "fill": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "xMaxData": "weave.data.AttributeColumns::DynamicColumn",
                "xMaxScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "xMinData": "weave.data.AttributeColumns::DynamicColumn",
                "xMinScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "yMaxData": "weave.data.AttributeColumns::DynamicColumn",
                "yMaxScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "yMinData": "weave.data.AttributeColumns::DynamicColumn",
                "yMinScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn"
            },
            "weave.visualization.plotters::CircleGlyphPlotter": {
                "absoluteValueColorEnabled": "weave.core::LinkableBoolean",
                "absoluteValueColorMax": "weave.core::LinkableNumber",
                "absoluteValueColorMin": "weave.core::LinkableNumber",
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "defaultScreenRadius": "weave.core::LinkableNumber",
                "destinationProjection": "weave.core::LinkableString",
                "enabledSizeBy": "weave.core::LinkableBoolean",
                "fill": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "maxScreenRadius": "weave.core::LinkableNumber",
                "minScreenRadius": "weave.core::LinkableNumber",
                "screenRadius": "weave.data.AttributeColumns::DynamicColumn",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::CirclePlotter": {
                "dataX": "weave.core::LinkableNumber",
                "dataY": "weave.core::LinkableNumber",
                "fillAlpha": "weave.core::LinkableNumber",
                "fillColor": "weave.core::LinkableNumber",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineAlpha": "weave.core::LinkableNumber",
                "lineColor": "weave.core::LinkableNumber",
                "polygonVertexCount": "weave.core::LinkableNumber",
                "radius": "weave.core::LinkableNumber",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "thickness": "weave.core::LinkableNumber"
            },
            "weave.visualization.plotters::ColorBinLegendPlotter": {
                "dynamicColorColumn": "weave.data.AttributeColumns::DynamicColumn",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "itemLabelFunction": "weave.core::LinkableFunction",
                "legendTitleFunction": "weave.core::LinkableFunction",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "maxColumns": "weave.core::LinkableNumber",
                "reverseOrder": "weave.core::LinkableBoolean",
                "shapeSize": "weave.core::LinkableNumber",
                "shapeType": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::CompoundBarChartPlotter": {
                "barSpacing": "weave.core::LinkableNumber",
                "chartColors": "weave.primitives::ColorRamp",
                "colorColumn": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "colorIndicatesDirection": "weave.core::LinkableBoolean",
                "errorIsRelative": "weave.core::LinkableBoolean",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "groupBySortColumn": "weave.core::LinkableBoolean",
                "groupingMode": "weave.core::LinkableString",
                "heightColumns": "weave.core::LinkableHashMap",
                "horizontalMode": "weave.core::LinkableBoolean",
                "labelColor": "weave.core::LinkableNumber",
                "labelColumn": "weave.data.AttributeColumns::DynamicColumn",
                "labelDataCoordinate": "weave.core::LinkableNumber",
                "labelFormatter": "weave.core::LinkableFunction",
                "labelHorizontalAlign": "weave.core::LinkableString",
                "labelMaxWidth": "weave.core::LinkableNumber",
                "labelRelativeAngle": "weave.core::LinkableNumber",
                "labelVerticalAlign": "weave.core::LinkableString",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "negativeErrorColumns": "weave.core::LinkableHashMap",
                "positiveErrorColumns": "weave.core::LinkableHashMap",
                "recordLabelColoring": "weave.core::LinkableBoolean",
                "recordValueLabelColoring": "weave.core::LinkableBoolean",
                "showLabels": "weave.core::LinkableBoolean",
                "showValueLabels": "weave.core::LinkableBoolean",
                "sortColumn": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "stackedMissingDataGap": "weave.core::LinkableBoolean",
                "valueLabelColor": "weave.core::LinkableNumber",
                "valueLabelDataCoordinate": "weave.core::LinkableNumber",
                "valueLabelHorizontalAlign": "weave.core::LinkableString",
                "valueLabelMaxWidth": "weave.core::LinkableNumber",
                "valueLabelRelativeAngle": "weave.core::LinkableNumber",
                "valueLabelVerticalAlign": "weave.core::LinkableString",
                "zoomToSubset": "weave.core::LinkableBoolean",
                "zoomToSubsetBars": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::CompoundRadVizPlotter": {
                "alphaColumn": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "anchors": "weave.core::LinkableHashMap",
                "colorMap": "weave.primitives::ColorRamp",
                "columns": "weave.core::LinkableHashMap",
                "currentAlgorithm": "weave.core::LinkableString",
                "enableJitter": "weave.core::LinkableBoolean",
                "enableWedgeColoring": "weave.core::LinkableBoolean",
                "fillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "iterations": "weave.core::LinkableNumber",
                "jitterLevel": "weave.core::LinkableNumber",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "localNormalization": "weave.core::LinkableBoolean",
                "radiusColumn": "weave.data.AttributeColumns::DynamicColumn",
                "radiusConstant": "weave.core::LinkableNumber",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::CustomGlyphPlotter": {
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "destinationProjection": "weave.core::LinkableString",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "function_drawBackground": "weave.core::LinkableFunction",
                "function_drawPlot": "weave.core::LinkableFunction",
                "function_getBackgroundDataBounds": "weave.core::LinkableFunction",
                "function_getDataBoundsFromRecordKey": "weave.core::LinkableFunction",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "vars": "weave.api.core::ILinkableHashMap",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::EquationPlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "tBegin": "weave.core::LinkableNumber",
                "tEnd": "weave.core::LinkableNumber",
                "tStep": "weave.core::LinkableNumber",
                "xEquation": "weave.core::LinkableFunction",
                "yEquation": "weave.core::LinkableFunction"
            },
            "weave.visualization.plotters::GaugePlotter": {
                "binningDefinition": "weave.data.BinningDefinitions::DynamicBinningDefinition",
                "colorRamp": "weave.primitives::ColorRamp",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "meterColumn": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::GeometryLabelPlotter": {
                "angle": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "bold": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "color": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "destinationProjection": "weave.core::LinkableString",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "font": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "geometryColumn": "weave.data.AttributeColumns::ReprojectedGeometryColumn",
                "hAlign": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "hideOverlappingText": "weave.core::LinkableBoolean",
                "italic": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "maxWidth": "weave.core::LinkableNumber",
                "size": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "sortColumn": "weave.data.AttributeColumns::DynamicColumn",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "text": "weave.data.AttributeColumns::DynamicColumn",
                "underline": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "vAlign": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "xScreenOffset": "weave.core::LinkableNumber",
                "yScreenOffset": "weave.core::LinkableNumber",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::GeometryPlotter": {
                "fill": "weave.visualization.plotters.styles::ExtendedFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "geometryColumn": "weave.data.AttributeColumns::ReprojectedGeometryColumn",
                "iconSize": "weave.core::LinkableNumber",
                "line": "weave.visualization.plotters.styles::ExtendedLineStyle",
                "pixellation": "weave.core::LinkableNumber",
                "pointDataImageColumn": "weave.data.AttributeColumns::ImageColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "symbolPlotters": "weave.api.core::ILinkableHashMap",
                "useFixedImageSize": "weave.core::LinkableBoolean",
                "zOrderAscending": "weave.core::LinkableBoolean",
                "zOrderColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.visualization.plotters::GeometryRelationPlotter": {
                "destinationKeyColumn": "weave.data.AttributeColumns::DynamicColumn",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "fontColor": "weave.core::LinkableNumber",
                "fontSize": "weave.core::LinkableNumber",
                "geometryColumn": "weave.data.AttributeColumns::ReprojectedGeometryColumn",
                "lineWidth": "weave.core::LinkableNumber",
                "negLineColor": "weave.core::LinkableNumber",
                "posLineColor": "weave.core::LinkableNumber",
                "showValue": "weave.core::LinkableBoolean",
                "sourceKeyColumn": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "valueColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.visualization.plotters::GraphLabelPlotter": {
                "currentAlgorithm": "weave.core::LinkableString",
                "edgeSourceColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeTargetColumn": "weave.data.AttributeColumns::DynamicColumn",
                "fillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "labelColumn": "weave.data.AttributeColumns::DynamicColumn",
                "layoutAlgorithm": "weave.api.graphs::IGraphAlgorithm",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "nodesColumn": "weave.data.AttributeColumns::DynamicColumn",
                "radius": "weave.core::LinkableNumber",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::GraphPlotter": {
                "algorithmRunning": "weave.core::LinkableBoolean",
                "alphaColumn": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "colorColumn": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "currentAlgorithm": "weave.core::LinkableString",
                "drawCurvedLines": "weave.core::LinkableBoolean",
                "edgeColorColumn": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "edgeSourceColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeStyle": "weave.core::LinkableString",
                "edgeTargetColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeThicknessColumn": "weave.data.AttributeColumns::DynamicColumn",
                "fillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "labelColumn": "weave.data.AttributeColumns::DynamicColumn",
                "layoutAlgorithm": "weave.core::LinkableDynamicObject",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "nodeRadiusColumn": "weave.data.AttributeColumns::DynamicColumn",
                "nodesColumn": "weave.data.AttributeColumns::DynamicColumn",
                "radius": "weave.core::LinkableNumber",
                "shouldStop": "weave.core::LinkableBoolean",
                "sizeColumn": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::GridLinePlotter": {
                "bounds": "weave.primitives::LinkableBounds2D",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "xInterval": "weave.core::LinkableNumber",
                "xOffset": "weave.core::LinkableNumber",
                "yInterval": "weave.core::LinkableNumber",
                "yOffset": "weave.core::LinkableNumber"
            },
            "weave.visualization.plotters::Histogram2DPlotter": {
                "binColors": "weave.primitives::ColorRamp",
                "colorColumn": "weave.data.AttributeColumns::DynamicColumn",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "showAverageColorData": "weave.core::LinkableBoolean",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "xBinnedColumn": "weave.data.AttributeColumns::BinnedColumn",
                "xColumn": "weave.data.AttributeColumns::DynamicColumn",
                "yBinnedColumn": "weave.data.AttributeColumns::BinnedColumn",
                "yColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.visualization.plotters::HistogramPlotter": {
                "aggregationMethod": "weave.core::LinkableString",
                "binnedColumn": "weave.data.AttributeColumns::BinnedColumn",
                "columnToAggregate": "weave.data.AttributeColumns::DynamicColumn",
                "drawPartialBins": "weave.core::LinkableBoolean",
                "fillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "horizontalMode": "weave.core::LinkableBoolean",
                "internalColorColumn": "weave.data.AttributeColumns::ColorColumn",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "showValueLabels": "weave.core::LinkableBoolean",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "valueLabelColor": "weave.core::LinkableNumber",
                "valueLabelHorizontalAlign": "weave.core::LinkableString",
                "valueLabelMaxWidth": "weave.core::LinkableNumber",
                "valueLabelRelativeAngle": "weave.core::LinkableNumber",
                "valueLabelVerticalAlign": "weave.core::LinkableString"
            },
            "weave.visualization.plotters::ImageGlyphPlotter": {
                "alpha": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "color": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "dataInDegrees": "weave.core::LinkableBoolean",
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "destinationProjection": "weave.core::LinkableString",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "imageSize": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "imageURL": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "reverseRotation": "weave.core::LinkableBoolean",
                "rotation": "weave.data.AttributeColumns::DynamicColumn",
                "rotationOffset": "weave.core::LinkableNumber",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::LineChartPlotter": {
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "group": "weave.data.AttributeColumns::DynamicColumn",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "order": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "useFilteredDataGaps": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::LinePlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "x1Data": "weave.data.AttributeColumns::DynamicColumn",
                "x1ScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "x2Data": "weave.data.AttributeColumns::DynamicColumn",
                "x2ScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "y1Data": "weave.data.AttributeColumns::DynamicColumn",
                "y1ScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "y2Data": "weave.data.AttributeColumns::DynamicColumn",
                "y2ScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn"
            },
            "weave.visualization.plotters::MeterPlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "meterColumn": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::OldParallelCoordinatesPlotter": {
                "columns": "weave.core::LinkableHashMap",
                "curveType": "weave.core::LinkableString",
                "enableGroupBy": "weave.core::LinkableBoolean",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "groupBy": "weave.data.AttributeColumns::DynamicColumn",
                "groupKeyType": "weave.core::LinkableString",
                "lineStyle": "weave.visualization.plotters.styles::ExtendedLineStyle",
                "normalize": "weave.core::LinkableBoolean",
                "shapeBorderAlpha": "weave.core::LinkableNumber",
                "shapeBorderColor": "weave.core::LinkableNumber",
                "shapeBorderThickness": "weave.core::LinkableNumber",
                "shapeSize": "weave.core::LinkableNumber",
                "shapeToDraw": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "xColumns": "weave.core::LinkableHashMap",
                "xData": "weave.data.AttributeColumns::DynamicColumn",
                "xValues": "weave.core::LinkableString",
                "yData": "weave.data.AttributeColumns::DynamicColumn",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::PieChartHistogramPlotter": {
                "_beginRadians": "weave.data.AttributeColumns::EquationColumn",
                "_binLookup": "weave.data.AttributeColumns::StringLookupColumn",
                "_binLookupStats": "weave.api.data::IColumnStatistics",
                "_binnedData": "weave.data.AttributeColumns::BinnedColumn",
                "_filteredData": "weave.data.AttributeColumns::FilteredColumn",
                "_spanRadians": "weave.data.AttributeColumns::EquationColumn",
                "binnedData": "weave.data.AttributeColumns::BinnedColumn",
                "chartColors": "weave.primitives::ColorRamp",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "innerRadius": "weave.core::LinkableNumber",
                "labelAngleRatio": "weave.core::LinkableNumber",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "unfilteredData": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.visualization.plotters::PieChartPlotter": {
                "data": "weave.data.AttributeColumns::DynamicColumn",
                "fill": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "innerRadius": "weave.core::LinkableNumber",
                "label": "weave.data.AttributeColumns::DynamicColumn",
                "labelAngleRatio": "weave.core::LinkableNumber",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::ProbeLinePlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::RadVizPlotter": {
                "RSampling": "weave.core::LinkableBoolean",
                "absNorm": "weave.core::LinkableBoolean",
                "alphaColumn": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "anchorLabelFunction": "weave.core::LinkableFunction",
                "anchors": "weave.core::LinkableHashMap",
                "colorMap": "weave.primitives::ColorRamp",
                "columns": "weave.core::LinkableHashMap",
                "currentAlgorithm": "weave.core::LinkableString",
                "dataSetName": "weave.core::LinkableString",
                "enableJitter": "weave.core::LinkableBoolean",
                "fillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "iterations": "weave.core::LinkableNumber",
                "jitterLevel": "weave.core::LinkableNumber",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "localNormalization": "weave.core::LinkableBoolean",
                "normMax": "weave.core::LinkableNumber",
                "normMin": "weave.core::LinkableNumber",
                "pointSensitivitySelection": "weave.core::LinkableVariable",
                "probeLineNormalizedThreshold": "weave.core::LinkableNumber",
                "radiusColumn": "weave.data.AttributeColumns::DynamicColumn",
                "radiusConstant": "weave.core::LinkableNumber",
                "regularSampling": "weave.core::LinkableBoolean",
                "sampleSizeColumns": "weave.core::LinkableNumber",
                "sampleSizeRows": "weave.core::LinkableNumber",
                "sampleTitle": "weave.core::LinkableString",
                "showAnchorProbeLines": "weave.core::LinkableBoolean",
                "showAnnulusCenter": "weave.core::LinkableBoolean",
                "showValuesForAnchorProbeLines": "weave.core::LinkableBoolean",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::RamachandranBackgroundPlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::RectanglePlotter": {
                "centerX": "weave.core::LinkableBoolean",
                "centerY": "weave.core::LinkableBoolean",
                "drawEllipse": "weave.core::LinkableBoolean",
                "fill": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "heightData": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "widthData": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "xData": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "xMaxScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "xMinScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "yData": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "yMaxScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "yMinScreenOffset": "weave.data.AttributeColumns::AlwaysDefinedColumn"
            },
            "weave.visualization.plotters::RegressionLinePlotter": {
                "currentTrendline": "weave.core::LinkableString",
                "drawLine": "weave.core::LinkableBoolean",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "polynomialDegree": "weave.core::LinkableNumber",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "xColumn": "weave.data.AttributeColumns::DynamicColumn",
                "yColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.visualization.plotters::ScatterPlotPlotter": {
                "colorBySize": "weave.core::LinkableBoolean",
                "colorNegative": "weave.core::LinkableNumber",
                "colorPositive": "weave.core::LinkableNumber",
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "defaultScreenRadius": "weave.core::LinkableNumber",
                "destinationProjection": "weave.core::LinkableString",
                "fill": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "maxScreenRadius": "weave.core::LinkableNumber",
                "minScreenRadius": "weave.core::LinkableNumber",
                "showSquaresForMissingSize": "weave.core::LinkableBoolean",
                "sizeBy": "weave.data.AttributeColumns::DynamicColumn",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::SimpleAxisPlotter": {
                "axesAlpha": "weave.core::LinkableNumber",
                "axesColor": "weave.core::LinkableNumber",
                "axesThickness": "weave.core::LinkableNumber",
                "axisGridLineAlpha": "weave.core::LinkableNumber",
                "axisGridLineColor": "weave.core::LinkableNumber",
                "axisGridLineThickness": "weave.core::LinkableNumber",
                "axisLabelHorizontalDistance": "weave.core::LinkableNumber",
                "axisLabelRelativeAngle": "weave.core::LinkableNumber",
                "axisLabelVerticalDistance": "weave.core::LinkableNumber",
                "axisLineDataBounds": "weave.primitives::LinkableBounds2D",
                "axisLineMaxValue": "weave.core::LinkableNumber",
                "axisLineMinValue": "weave.core::LinkableNumber",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "forceTickCount": "weave.core::LinkableBoolean",
                "labelFunction": "weave.core::LinkableFunction",
                "labelHorizontalAlign": "weave.core::LinkableString",
                "labelNumberFormatter": "weave.primitives::LinkableNumberFormatter",
                "labelTextAlignment": "weave.core::LinkableString",
                "labelVerticalAlign": "weave.core::LinkableString",
                "labelWordWrapSize": "weave.core::LinkableNumber",
                "overrideAxisName": "weave.core::LinkableString",
                "showAxisName": "weave.core::LinkableBoolean",
                "showLabels": "weave.core::LinkableBoolean",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "tickCountRequested": "weave.core::LinkableNumber",
                "tickMaxValue": "weave.core::LinkableNumber",
                "tickMinValue": "weave.core::LinkableNumber"
            },
            "weave.visualization.plotters::SimpleGlyphPlotter": {
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "destinationProjection": "weave.core::LinkableString",
                "drawEllipse": "weave.core::LinkableBoolean",
                "fillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "horizontalPosition": "weave.core::LinkableString",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "screenSize": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "verticalPosition": "weave.core::LinkableString",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::SimpleParallelCoordinatesAxesPlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "mainPlotter": "weave.core::LinkableDynamicObject",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::SimpleParallelCoordinatesPlotter": {
                "columns": "weave.core::LinkableHashMap",
                "curvedLines": "weave.core::LinkableBoolean",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "normalize": "weave.core::LinkableBoolean",
                "selectableLines": "weave.core::LinkableBoolean",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::SingleImagePlotter": {
                "dataHeight": "weave.core::LinkableNumber",
                "dataWidth": "weave.core::LinkableNumber",
                "dataX": "weave.core::LinkableNumber",
                "dataY": "weave.core::LinkableNumber",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "horizontalAlign": "weave.core::LinkableString",
                "imageURL": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "useImageSize": "weave.core::LinkableBoolean",
                "verticalAlign": "weave.core::LinkableString"
            },
            "weave.visualization.plotters::SizeBinLegendPlotter": {
                "colorBySize": "weave.core::LinkableBoolean",
                "colorNegative": "weave.core::LinkableNumber",
                "colorPositive": "weave.core::LinkableNumber",
                "customCircleRadiuses": "weave.core::LinkableString",
                "defaultScreenRadius": "weave.core::LinkableNumber",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "maxScreenRadius": "weave.core::LinkableNumber",
                "minScreenRadius": "weave.core::LinkableNumber",
                "numberOfCircles": "weave.core::LinkableNumber",
                "radiusColumn": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "typeRadio": "weave.core::LinkableString"
            },
            "weave.visualization.plotters::StickFigureGlyphPlotter": {
                "curvature": "weave.core::LinkableNumber",
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "destinationProjection": "weave.core::LinkableString",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "limbLength": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "theta1": "weave.data.AttributeColumns::DynamicColumn",
                "theta2": "weave.data.AttributeColumns::DynamicColumn",
                "theta3": "weave.data.AttributeColumns::DynamicColumn",
                "theta4": "weave.data.AttributeColumns::DynamicColumn",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::TextGlyphPlotter": {
                "angle": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "bold": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "color": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "dataX": "weave.data.AttributeColumns::DynamicColumn",
                "dataY": "weave.data.AttributeColumns::DynamicColumn",
                "destinationProjection": "weave.core::LinkableString",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "font": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "hAlign": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "hideOverlappingText": "weave.core::LinkableBoolean",
                "italic": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "maxWidth": "weave.core::LinkableNumber",
                "size": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "sortColumn": "weave.data.AttributeColumns::DynamicColumn",
                "sourceProjection": "weave.core::LinkableString",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "text": "weave.data.AttributeColumns::DynamicColumn",
                "underline": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "vAlign": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "xScreenOffset": "weave.core::LinkableNumber",
                "yScreenOffset": "weave.core::LinkableNumber",
                "zoomToSubset": "weave.core::LinkableBoolean"
            },
            "weave.visualization.plotters::ThermometerPlotter": {
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "meterColumn": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.plotters::WMSPlotter": {
                "creditInfoAlpha": "weave.core::LinkableNumber",
                "creditInfoBackgroundColor": "weave.core::LinkableNumber",
                "creditInfoTextColor": "weave.core::LinkableNumber",
                "displayMissingImage": "weave.core::LinkableBoolean",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "gridSpacing": "weave.core::LinkableNumber",
                "preferLowerQuality": "weave.core::LinkableBoolean",
                "service": "weave.core::LinkableDynamicObject",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "srs": "weave.core::LinkableString",
                "styles": "weave.core::LinkableString"
            },
            "weave.visualization.plotters::WeaveWordlePlotter": {
                "fillStyle": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "lineStyle": "weave.visualization.plotters.styles::SolidLineStyle",
                "spatialCallbacks": "weave.api.core::ICallbackCollection",
                "wordColumn": "weave.data.AttributeColumns::DynamicColumn"
            },
            "weave.visualization.plotters::WedgePlotter": {
                "beginRadians": "weave.data.AttributeColumns::DynamicColumn",
                "fill": "weave.visualization.plotters.styles::SolidFillStyle",
                "filteredKeySet": "weave.api.data::IFilteredKeySet",
                "line": "weave.visualization.plotters.styles::SolidLineStyle",
                "spanRadians": "weave.data.AttributeColumns::DynamicColumn",
                "spatialCallbacks": "weave.api.core::ICallbackCollection"
            },
            "weave.visualization.tools::AdvancedTableTool": {
                "backgroundColor1": "weave.core::LinkableNumber",
                "backgroundColor2": "weave.core::LinkableNumber",
                "buttonRadius": "weave.core::LinkableNumber",
                "cellColorFunction": "weave.core::LinkableFunction",
                "closeable": "weave.core::LinkableBoolean",
                "colorRamp": "weave.primitives::ColorRamp",
                "columnWidths": "weave.core::LinkableHashMap",
                "columns": "weave.core::LinkableHashMap",
                "controlPanel": "weave.ui::ControlPanel",
                "dataGridHorizontalScrollPosition": "weave.core::LinkableNumber",
                "dataGridVerticalScrollPosition": "weave.core::LinkableNumber",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableProbing": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "filterComponents": "weave.core::LinkableHashMap",
                "filteredKeySet": "weave.data.KeySets::FilteredKeySet",
                "lockedColumns": "weave.core::LinkableNumber",
                "maxHeaderHeight": "weave.core::LinkableNumber",
                "maxRows": "weave.core::LinkableNumber",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "showColors": "weave.core::LinkableBoolean",
                "showControls": "weave.core::LinkableBoolean",
                "showFilters": "weave.core::LinkableBoolean",
                "show_clearSelection": "weave.core::LinkableBoolean",
                "show_editColumns": "weave.core::LinkableBoolean",
                "show_exportData": "weave.core::LinkableBoolean",
                "show_moveSelectedToTop": "weave.core::LinkableBoolean",
                "sortFieldIndex": "weave.core::LinkableNumber",
                "sortInDescendingOrder": "weave.core::LinkableBoolean",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::BarChartLegendTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "dynamicBarChartTool": "weave.core::LinkableDynamicObject",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::ColorBinLegendTool": {
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::ColormapHistogramTool": {
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "heightAxisTickCountRequested": "weave.core::LinkableNumber",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::CompoundBarChartTool": {
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "chartColors": "weave.primitives::ColorRamp",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "colorIndicatesDirection": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "heightAxisForceTickCount": "weave.core::LinkableBoolean",
                "heightAxisTickCountRequested": "weave.core::LinkableNumber",
                "heightColumns": "weave.api.core::ILinkableHashMap",
                "linkHeightAndColorColumns": "weave.core::LinkableBoolean",
                "linkHeightAndSortColumns": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "plotter": "weave.visualization.plotters::CompoundBarChartPlotter",
                "showAllLabels": "weave.core::LinkableBoolean",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::CompoundRadVizTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "colorComponent": "weave.ui::DynamicColumnComponent",
                "colormapGrid": "weave.ui::ColorRampList",
                "columnList": "weave.ui::ColumnListComponent",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "size": "weave.ui::DynamicColumnComponent",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::CustomGraphicsTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "drawScript": "weave.core::LinkableFunction",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "vars": "weave.core::LinkableHashMap",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::CustomTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::CytoscapeWebTool": {
                "_cytoscapeReady": "weave.core::LinkableBoolean",
                "_edgeFilteredKeys": "weave.data.KeySets::FilteredKeySet",
                "_nodeFilteredKeys": "weave.data.KeySets::FilteredKeySet",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "edgeColorColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeLabelColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeLabelComponent": "weave.ui::DynamicColumnComponent",
                "edgeSourceColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeSourceComponent": "weave.ui::DynamicColumnComponent",
                "edgeTargetColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeTargetComponent": "weave.ui::DynamicColumnComponent",
                "edgeThicknessColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeThicknessComponent": "weave.ui::DynamicColumnComponent",
                "edgeWeightColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeWeightComponent": "weave.ui::DynamicColumnComponent",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "layoutSeed": "weave.core::LinkableNumber",
                "layoutType": "weave.core::LinkableString",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "nodeColorColumn": "weave.data.AttributeColumns::DynamicColumn",
                "nodeColorComponent": "weave.ui::DynamicColumnComponent",
                "nodeLabelColumn": "weave.data.AttributeColumns::DynamicColumn",
                "nodeLabelComponent": "weave.ui::DynamicColumnComponent",
                "nodeParentColumn": "weave.data.AttributeColumns::DynamicColumn",
                "nodeParentComponent": "weave.ui::DynamicColumnComponent",
                "nodeRadiusColumn": "weave.data.AttributeColumns::DynamicColumn",
                "nodeRadiusComponent": "weave.ui::DynamicColumnComponent",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::DataStatisticsTool": {
                "_variables": "weave.api.core::ILinkableHashMap",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "inputVariables": "weave.api.core::ILinkableHashMap",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::DatagridDisplay": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::DimensionSliderTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "currentSliderPosition": "weave.core::LinkableNumber",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "filterValues": "weave.core::LinkableVariable",
                "layoutMode": "weave.core::LinkableString",
                "linkGlobalColumns": "weave.core::LinkableBoolean",
                "linkLineCharts": "weave.core::LinkableBoolean",
                "maxLabelCount": "weave.core::LinkableNumber",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "showPlayButton": "weave.core::LinkableBoolean",
                "timerDelay": "weave.core::LinkableNumber",
                "unlinkedTools": "weave.core::LinkableVariable",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::ExternalTool": {
                "childListCallbacks": "weave.api.core::IChildListCallbackInterface"
            },
            "weave.visualization.tools::GaugeTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::GraphTool": {
                "_labelPlotter": "weave.visualization.plotters::GraphLabelPlotter",
                "_plotter": "weave.visualization.plotters::GraphPlotter",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "colorColumn": "weave.data.AttributeColumns::DynamicColumn",
                "colorComponent": "weave.ui::DynamicColumnComponent",
                "controlPanel": "weave.ui::ControlPanel",
                "edgeColorColumn": "weave.data.AttributeColumns::AlwaysDefinedColumn",
                "edgeColorComponent": "weave.ui::DynamicColumnComponent",
                "edgeSourceColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeSourceComponent": "weave.ui::DynamicColumnComponent",
                "edgeTargetColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeTargetComponent": "weave.ui::DynamicColumnComponent",
                "edgeThicknessColumn": "weave.data.AttributeColumns::DynamicColumn",
                "edgeThicknessComponent": "weave.ui::DynamicColumnComponent",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "includeToolAttributesInProbe": "weave.core::LinkableBoolean",
                "labelColumn": "weave.data.AttributeColumns::DynamicColumn",
                "labelComponent": "weave.ui::DynamicColumnComponent",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "nodeComponent": "weave.ui::DynamicColumnComponent",
                "nodeRadiusColumn": "weave.data.AttributeColumns::DynamicColumn",
                "nodeRadiusComponent": "weave.ui::DynamicColumnComponent",
                "nodesColumn": "weave.data.AttributeColumns::DynamicColumn",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::Histogram2DTool": {
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "customTickCounts": "weave.core::LinkableBoolean",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::HistogramTool": {
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "heightAxisTickCountRequested": "weave.core::LinkableNumber",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::KeyMappingTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableProbing": "weave.core::LinkableBoolean",
                "enableSelection": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "isBidirectional": "weave.core::LinkableBoolean",
                "limitRecursion": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "sourceKeyType": "weave.core::LinkableString",
                "sourceLocalNameColumn": "weave.data.AttributeColumns::DynamicColumn",
                "sourceLocalNameColumnComponent": "weave.ui::DynamicColumnComponent",
                "targetKeyType": "weave.core::LinkableString",
                "targetLocalNameColumn": "weave.data.AttributeColumns::DynamicColumn",
                "targetLocalNameColumnComponent": "weave.ui::DynamicColumnComponent",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::LayerSettingsTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "listForegroundFirst": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "showAlphaSlider": "weave.core::LinkableBoolean",
                "showSelectableCheck": "weave.core::LinkableBoolean",
                "showVisibleCheck": "weave.core::LinkableBoolean",
                "shownLayers": "weave.core::LinkableVariable",
                "targetPath": "weave.core::LinkableVariable",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::LineChartTool": {
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::MapOverviewWindow": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "parentZoomBounds": "weave.primitives::ZoomBounds",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::MapTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBackground": "weave.core::LinkableBoolean",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableOverview": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "includeToolAttributesInProbe": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "overviewPanel": "weave.visualization.tools::MapOverviewWindow",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "projectionSRS": "weave.core::LinkableString",
                "showMouseModeControls": "weave.core::LinkableBoolean",
                "showZoomControls": "weave.core::LinkableBoolean",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber",
                "zoomControlsLocation": "weave.core::LinkableString",
                "zoomSliderHeight": "weave.core::LinkableNumber",
                "zoomToBaseMap": "weave.core::LinkableBoolean"
            },
            "weave.visualization.tools::ParallelCoordinatesTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "includeAllAttributesInProbe": "weave.core::LinkableBoolean",
                "includeColorAttributeInProbe": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::PieChartHistogramTool": {
                "_plotter": "weave.visualization.plotters::PieChartHistogramPlotter",
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::PieChartTool": {
                "_plotter": "weave.visualization.plotters::PieChartPlotter",
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::RInterfaceTool": {
                "RPlotscriptTALinkabletext": "weave.core::LinkableString",
                "RScriptTAtext": "weave.core::LinkableString",
                "Rservice": "weave.services::WeaveRServlet",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "queryObjectDisplayString": "weave.core::LinkableString",
                "variables": "weave.core::LinkableHashMap",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::RScriptTool": {
                "_RScriptTool_DynamicColumnComponent1": "weave.ui::DynamicColumnComponent",
                "_RScriptTool_DynamicColumnComponent2": "weave.ui::DynamicColumnComponent",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "xRcolumn": "weave.data.AttributeColumns::DynamicColumn",
                "yRcolumn": "weave.data.AttributeColumns::DynamicColumn",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::RadVizTool": {
                "_anchorPlotter": "weave.visualization.plotters::AnchorPlotter",
                "_plotter": "weave.visualization.plotters::RadVizPlotter",
                "buttonRadius": "weave.core::LinkableNumber",
                "cdLayout": "weave.radviz::ClassDiscriminationLayoutAlgorithm",
                "children": "weave.core::LinkableHashMap",
                "classDiscriminatorColumn": "weave.data.AttributeColumns::DynamicColumn",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enabelAnnuliCircles": "weave.core::LinkableBoolean",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableProbeLines": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::RamachandranPlotTool": {
                "_RamachandranPlotTool_DynamicColumnComponent1": "weave.ui::DynamicColumnComponent",
                "_plotter": "weave.visualization.plotters::ScatterPlotPlotter",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "colorColumn": "weave.data.AttributeColumns::DynamicColumn",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "histogramColumn": "weave.data.AttributeColumns::DynamicColumn",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::ScatterPlotTool": {
                "attributesToIncludeInProbe": "weave.core::LinkableVariable",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "isVisibleEquationTextBoolean": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "plotter": "weave.visualization.plotters::ScatterPlotPlotter",
                "regressionPlotter": "weave.visualization.plotters::RegressionLinePlotter",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::SimpleVisTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::SizeBinLegendTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "dynamicScatterPlotTool": "weave.core::LinkableDynamicObject",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::SliderTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "currentSliderPosition": "weave.core::LinkableNumber",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "filterValues": "weave.core::LinkableVariable",
                "layoutMode": "weave.core::LinkableString",
                "linkGlobalColumns": "weave.core::LinkableBoolean",
                "linkLineCharts": "weave.core::LinkableBoolean",
                "maxLabelCount": "weave.core::LinkableNumber",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "showPlayButton": "weave.core::LinkableBoolean",
                "timerDelay": "weave.core::LinkableNumber",
                "unlinkedTools": "weave.core::LinkableVariable",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::StickFigureGlyphTool": {
                "_plotter": "weave.visualization.plotters::StickFigureGlyphPlotter",
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "includeToolAttributesInProbe": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::TableTool": {
                "backgroundColor1": "weave.core::LinkableNumber",
                "backgroundColor2": "weave.core::LinkableNumber",
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "colorRamp": "weave.primitives::ColorRamp",
                "columnWidths": "weave.core::LinkableHashMap",
                "columns": "weave.core::LinkableHashMap",
                "controlPanel": "weave.ui::ControlPanel",
                "dataGridHorizontalScrollPosition": "weave.core::LinkableNumber",
                "dataGridVerticalScrollPosition": "weave.core::LinkableNumber",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableProbing": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "filteredKeySet": "weave.data.KeySets::FilteredKeySet",
                "lockedColumns": "weave.core::LinkableNumber",
                "maxHeaderHeight": "weave.core::LinkableNumber",
                "maxRows": "weave.core::LinkableNumber",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "mouseoverKeySet": "weave.data.KeySets::DynamicKeySet",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "selectionKeySet": "weave.data.KeySets::DynamicKeySet",
                "sortFieldIndex": "weave.core::LinkableNumber",
                "sortInDescendingOrder": "weave.core::LinkableBoolean",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::ThermometerTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::TimeSliderTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "currentSliderPosition": "weave.core::LinkableNumber",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "filterValues": "weave.core::LinkableVariable",
                "layoutMode": "weave.core::LinkableString",
                "linkGlobalColumns": "weave.core::LinkableBoolean",
                "linkLineCharts": "weave.core::LinkableBoolean",
                "maxLabelCount": "weave.core::LinkableNumber",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "showPlayButton": "weave.core::LinkableBoolean",
                "timerDelay": "weave.core::LinkableNumber",
                "unlinkedTools": "weave.core::LinkableVariable",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::TransposedTableTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "columns": "weave.core::LinkableHashMap",
                "controlPanel": "weave.ui::ControlPanel",
                "dataColumnWidth": "weave.core::LinkableString",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "headerAttributeColumn": "weave.data.AttributeColumns::DynamicColumn",
                "headerColumnWidth": "weave.core::LinkableString",
                "headerText": "weave.core::LinkableString",
                "keySet": "weave.data.KeySets::FilteredKeySet",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::TreeTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableProbing": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "expandToShowSelected": "weave.core::LinkableBoolean",
                "expandedItems": "weave.data.KeySets::KeySet",
                "iconColumn": "weave.data.AttributeColumns::DynamicColumn",
                "iconColumnComponent": "weave.ui::DynamicColumnComponent",
                "labelColumn": "weave.data.AttributeColumns::DynamicColumn",
                "labelColumnComponent": "weave.ui::DynamicColumnComponent",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "parentColumn": "weave.data.AttributeColumns::DynamicColumn",
                "parentColumnComponent": "weave.ui::DynamicColumnComponent",
                "probeIncludesChildren": "weave.core::LinkableBoolean",
                "selectIncludesChildren": "weave.core::LinkableBoolean",
                "sortColumn": "weave.data.AttributeColumns::DynamicColumn",
                "sortColumnComponent": "weave.ui::DynamicColumnComponent",
                "valueToIconMapping": "weave.core::LinkableHashMap",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::WeaveAnalyst": {
                "analystMap": "weave.core::LinkableHashMap",
                "inputColumnList": "weave.ui::ColumnListComponent",
                "inputColumns": "weave.core::LinkableHashMap",
                "results": "weave.core::LinkableHashMap",
                "statModule": "weave.visualization.tools::WeaveAnalystStatisticsModule"
            },
            "weave.visualization.tools::WeaveAnalystStatisticsModule": {
                "buttonRadius": "weave.core::LinkableNumber",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "variables": "weave.core::LinkableHashMap",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave.visualization.tools::WeaveWordleTool": {
                "buttonRadius": "weave.core::LinkableNumber",
                "children": "weave.core::LinkableHashMap",
                "closeable": "weave.core::LinkableBoolean",
                "controlPanel": "weave.ui::ControlPanel",
                "enableBorders": "weave.core::LinkableBoolean",
                "enableMoveResize": "weave.core::LinkableBoolean",
                "enableSubMenu": "weave.core::LinkableBoolean",
                "enableTitle": "weave.core::LinkableBoolean",
                "enableZOrder": "weave.core::LinkableBoolean",
                "maximizable": "weave.core::LinkableBoolean",
                "maximized": "weave.core::LinkableBoolean",
                "minimizable": "weave.core::LinkableBoolean",
                "minimized": "weave.core::LinkableBoolean",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelBorderColor": "weave.core::LinkableNumber",
                "panelHeight": "weave.core::LinkableString",
                "panelStyleList": "weave.core::LinkableString",
                "panelTitle": "weave.core::LinkableString",
                "panelWidth": "weave.core::LinkableString",
                "panelX": "weave.core::LinkableString",
                "panelY": "weave.core::LinkableString",
                "visualization": "weave.visualization.layers::SimpleInteractiveVisualization",
                "zOrder": "weave.core::LinkableNumber"
            },
            "weave::WeaveProperties": {
                "SecondaryKeyNumColumn_useGlobalMinMaxValues": "weave.core::LinkableBoolean",
                "axisTitleTextFormat": "weave.utils::LinkableTextFormat",
                "backgroundColor": "weave.core::LinkableNumber",
                "collabServerIP": "weave.core::LinkableString",
                "collabServerName": "weave.core::LinkableString",
                "collabServerPort": "weave.core::LinkableString",
                "collabServerRoom": "weave.core::LinkableString",
                "collabSpectating": "weave.core::LinkableBoolean",
                "cssStyleSheetName": "weave.core::LinkableString",
                "dashboardMode": "weave.core::LinkableBoolean",
                "dashedLengths": "weave.core::LinkableVariable",
                "dashedSelectionColor": "weave.core::LinkableNumber",
                "dashedZoomColor": "weave.core::LinkableNumber",
                "dataInfoURL": "weave.core::LinkableString",
                "debugScreenBounds": "weave.core::LinkableBoolean",
                "enableAnnuliCircles": "weave.core::LinkableBoolean",
                "enableAxisToolTips": "weave.core::LinkableBoolean",
                "enableBitmapFilters": "weave.core::LinkableBoolean",
                "enableBrowseData": "weave.core::LinkableBoolean",
                "enableCascadeAllWindows": "weave.core::LinkableBoolean",
                "enableClearCurrentSelection": "weave.core::LinkableBoolean",
                "enableCloseAllWindows": "weave.core::LinkableBoolean",
                "enableCollaborationBar": "weave.core::LinkableBoolean",
                "enableCreateSubsets": "weave.core::LinkableBoolean",
                "enableDataMenu": "weave.core::LinkableBoolean",
                "enableDrawCircle": "weave.core::LinkableBoolean",
                "enableDynamicTools": "weave.core::LinkableBoolean",
                "enableExportApplicationScreenshot": "weave.core::LinkableBoolean",
                "enableExportCSV": "weave.core::LinkableBoolean",
                "enableExportToolImage": "weave.core::LinkableBoolean",
                "enableFullScreen": "weave.core::LinkableBoolean",
                "enableGeometryProbing": "weave.core::LinkableBoolean",
                "enableManageDataSources": "weave.core::LinkableBoolean",
                "enableManagePlugins": "weave.core::LinkableBoolean",
                "enableManageSavedSelections": "weave.core::LinkableBoolean",
                "enableManageSavedSubsets": "weave.core::LinkableBoolean",
                "enableMarker": "weave.core::LinkableBoolean",
                "enableMenuBar": "weave.core::LinkableBoolean",
                "enableMinimizeAllWindows": "weave.core::LinkableBoolean",
                "enableMouseWheel": "weave.core::LinkableBoolean",
                "enablePenTool": "weave.core::LinkableBoolean",
                "enableProbeLines": "weave.core::LinkableBoolean",
                "enableProbeToolTip": "weave.core::LinkableBoolean",
                "enableRefreshHierarchies": "weave.core::LinkableBoolean",
                "enableRemoveSubsets": "weave.core::LinkableBoolean",
                "enableRestoreAllMinimizedWindows": "weave.core::LinkableBoolean",
                "enableRightClick": "weave.core::LinkableBoolean",
                "enableSaveCurrentSelection": "weave.core::LinkableBoolean",
                "enableSaveCurrentSubset": "weave.core::LinkableBoolean",
                "enableSearchForRecord": "weave.core::LinkableBoolean",
                "enableSelectionSelectorBox": "weave.core::LinkableBoolean",
                "enableSelectionsMenu": "weave.core::LinkableBoolean",
                "enableSessionHistoryControls": "weave.core::LinkableBoolean",
                "enableSessionMenu": "weave.core::LinkableBoolean",
                "enableShowAllRecords": "weave.core::LinkableBoolean",
                "enableSubsetControls": "weave.core::LinkableBoolean",
                "enableSubsetSelectionBox": "weave.core::LinkableBoolean",
                "enableSubsetsMenu": "weave.core::LinkableBoolean",
                "enableTileAllWindows": "weave.core::LinkableBoolean",
                "enableToolAttributeEditing": "weave.core::LinkableBoolean",
                "enableToolControls": "weave.core::LinkableBoolean",
                "enableToolProbe": "weave.core::LinkableBoolean",
                "enableToolSelection": "weave.core::LinkableBoolean",
                "enableUserPreferences": "weave.core::LinkableBoolean",
                "enableWeaveAnalystMode": "weave.core::LinkableBoolean",
                "enableWindowMenu": "weave.core::LinkableBoolean",
                "eventListeners": "weave.core::LinkableHashMap",
                "externalTools": "weave.core::LinkableHashMap",
                "filter_callbacks": "weave.api.core::ICallbackCollection",
                "geometryMetadataRequestMode": "weave.core::LinkableString",
                "geometryMinimumScreenArea": "weave.core::LinkableNumber",
                "isTemplate": "weave.core::LinkableBoolean",
                "macroLibraries": "weave.core::LinkableVariable",
                "macros": "weave.api.core::ILinkableHashMap",
                "maxComputationTimePerFrame": "weave.core::LinkableNumber",
                "maxTooltipRecordsShown": "weave.core::LinkableNumber",
                "menuToggles": "weave.api.core::ILinkableHashMap",
                "mouseoverTextFormat": "weave.utils::LinkableTextFormat",
                "panelBackgroundColor": "weave.core::LinkableNumber",
                "panelTitleTextFormat": "weave.utils::LinkableTextFormat",
                "pdbServiceURL": "weave.core::LinkableString",
                "probeBufferSize": "weave.core::LinkableNumber",
                "probeHeaderSeparator": "weave.core::LinkableString",
                "probeInnerGlow": "weave.visualization.layers.filters::LinkableGlowFilter",
                "probeLineFormatter": "weave.core::LinkableFunction",
                "probeOuterGlow": "weave.visualization.layers.filters::LinkableGlowFilter",
                "probeToolTipBackgroundAlpha": "weave.core::LinkableNumber",
                "probeToolTipBackgroundColor": "weave.core::LinkableNumber",
                "probeToolTipFontColor": "weave.core::LinkableNumber",
                "probeToolTipMaxWidth": "weave.core::LinkableNumber",
                "rServiceURL": "weave.core::LinkableString",
                "recordsTooltipLocation": "weave.core::LinkableString",
                "searchServiceURLs": "weave.core::LinkableString",
                "selectionAlphaAmount": "weave.core::LinkableNumber",
                "selectionDropShadow": "weave.visualization.layers.filters::LinkableDropShadowFilter",
                "selectionMode": "weave.core::LinkableString",
                "showAddExternalTools": "weave.core::LinkableBoolean",
                "showBackgroundImage": "weave.core::LinkableBoolean",
                "showCollaborationEditor": "weave.core::LinkableBoolean",
                "showCollaborationMenuItem": "weave.core::LinkableBoolean",
                "showColorController": "weave.core::LinkableBoolean",
                "showCreateTemplateMenuItem": "weave.core::LinkableBoolean",
                "showEmptyProbeRecordIdentifiers": "weave.core::LinkableBoolean",
                "showEquationEditor": "weave.core::LinkableBoolean",
                "showErrors": "weave.core::LinkableBoolean",
                "showKMeansClustering": "weave.core::LinkableBoolean",
                "showKeyTypeInColumnTitle": "weave.core::LinkableBoolean",
                "showProbeToolTipEditor": "weave.core::LinkableBoolean",
                "showProbeWindow": "weave.core::LinkableBoolean",
                "showSelectedRecordsText": "weave.core::LinkableBoolean",
                "showVisToolCloseDialog": "weave.core::LinkableBoolean",
                "startupJavaScript": "weave.core::LinkableString",
                "toolInteractions": "weave.visualization.layers::InteractionController",
                "version": "weave.core::LinkableString",
                "visTextFormat": "weave.utils::LinkableTextFormat",
                "visTitleTextFormat": "weave.utils::LinkableTextFormat",
                "windowSnapGridSize": "weave.core::LinkableString",
                "workspaceHeight": "weave.core::LinkableNumber",
                "workspaceMultiplier": "weave.core::LinkableNumber",
                "workspaceWidth": "weave.core::LinkableNumber"
            }
        };
        util.BackwardsCompatibility = BackwardsCompatibility;
    })(util = weavejs.util || (weavejs.util = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            /**
             * @author adufilie
             */
            var IBinningDefinition = function (_ILinkableObject6) {
                _inherits(IBinningDefinition, _ILinkableObject6);

                function IBinningDefinition() {
                    _classCallCheck(this, IBinningDefinition);

                    return _possibleConstructorReturn(this, (IBinningDefinition.__proto__ || Object.getPrototypeOf(IBinningDefinition)).apply(this, arguments));
                }

                return IBinningDefinition;
            }(ILinkableObject);
            IBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.api.data.IBinningDefinition" })], IBinningDefinition);
            data.IBinningDefinition = IBinningDefinition;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var IBinClassifier = weavejs.api.data.IBinClassifier;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            /**
             * Defines bins explicitly and is not affected by what column is passed to generateBinClassifiersForColumn().
             *
             * @author adufilie
             */
            var ExplicitBinningDefinition = function (_LinkableHashMap2) {
                _inherits(ExplicitBinningDefinition, _LinkableHashMap2);

                function ExplicitBinningDefinition() {
                    _classCallCheck(this, ExplicitBinningDefinition);

                    return _possibleConstructorReturn(this, (ExplicitBinningDefinition.__proto__ || Object.getPrototypeOf(ExplicitBinningDefinition)).call(this, IBinClassifier));
                }

                _createClass(ExplicitBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        // do nothing because our bins don't depend on any column.
                    }
                }, {
                    key: "getBinClassifiers",
                    value: function getBinClassifiers() {
                        return this.getObjects();
                    }
                }, {
                    key: "getBinNames",
                    value: function getBinNames() {
                        return this.getNames();
                    }
                }, {
                    key: "asyncResultCallbacks",
                    get: function get() {
                        return this; // when our callbacks trigger, the results are immediately available
                    }
                }]);

                return ExplicitBinningDefinition;
            }(LinkableHashMap);
            ExplicitBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.data.bin.ExplicitBinningDefinition", interfaces: [IBinningDefinition] })], ExplicitBinningDefinition);
            bin.ExplicitBinningDefinition = ExplicitBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IBinClassifier = weavejs.api.data.IBinClassifier;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var LinkableString = weavejs.core.LinkableString;
            /**
             * Extend this class and implement <code>generateBinClassifiersForColumn()</code>, which should store its results in the
             * protected <code>output</code> variable and trigger <code>asyncResultCallbacks</code> when the task completes.
             *
             * @author adufilie
             */
            var AbstractBinningDefinition = function () {
                function AbstractBinningDefinition(allowOverrideBinNames, allowOverrideInputRange) {
                    _classCallCheck(this, AbstractBinningDefinition);

                    /**
                     * Implementations that extend this class should use this as an output buffer.
                     */
                    this.output = Weave.disposableChild(this, new LinkableHashMap(IBinClassifier));
                    this._asyncResultCallbacks = Weave.disposableChild(this, CallbackCollection);
                    this._overrideBinNamesArray = [];
                    this.getOverrideNamesObserver = {};
                    if (allowOverrideBinNames) this._overrideBinNames = Weave.linkableChild(this, new LinkableString(''));
                    if (allowOverrideInputRange) {
                        this._overrideInputMin = Weave.linkableChild(this, LinkableNumber);
                        this._overrideInputMax = Weave.linkableChild(this, LinkableNumber);
                    }
                }

                _createClass(AbstractBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        throw new Error("Not implemented");
                    }
                }, {
                    key: "getBinNames",
                    value: function getBinNames() {
                        if (Weave.isBusy(this)) return null;
                        return this.output.getNames();
                    }
                }, {
                    key: "getBinClassifiers",
                    value: function getBinClassifiers() {
                        if (Weave.isBusy(this)) return null;
                        return this.output.getObjects();
                    }
                }, {
                    key: "getOverrideNames",
                    value: function getOverrideNames() {
                        if (this.overrideBinNames && Weave.detectChange(this.getOverrideNamesObserver, this.overrideBinNames)) this._overrideBinNamesArray = WeaveAPI.CSVParser.parseCSVRow(this.overrideBinNames.value) || [];
                        return this._overrideBinNamesArray;
                    }
                }, {
                    key: "asyncResultCallbacks",
                    get: function get() {
                        return this._asyncResultCallbacks;
                    }
                }, {
                    key: "overrideBinNames",
                    get: function get() {
                        return this._overrideBinNames;
                    }
                }, {
                    key: "overrideInputMin",
                    get: function get() {
                        return this._overrideInputMin;
                    }
                }, {
                    key: "overrideInputMax",
                    get: function get() {
                        return this._overrideInputMax;
                    }
                }]);

                return AbstractBinningDefinition;
            }();
            AbstractBinningDefinition = __decorate([Weave.classInfo({ id: 'weavejs.data.bin.AbstractBinningDefinition', interfaces: [IBinningDefinition] })], AbstractBinningDefinition);
            bin.AbstractBinningDefinition = AbstractBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var AsyncSort = weavejs.util.AsyncSort;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            /**
             * QuantileBinningDefinition
             *
             * @author adufilie
             * @author abaumann
             * @author sanbalagan
             */
            var QuantileBinningDefinition = function (_bin$AbstractBinningD) {
                _inherits(QuantileBinningDefinition, _bin$AbstractBinningD);

                function QuantileBinningDefinition() {
                    _classCallCheck(this, QuantileBinningDefinition);

                    var _this120 = _possibleConstructorReturn(this, (QuantileBinningDefinition.__proto__ || Object.getPrototypeOf(QuantileBinningDefinition)).call(this, true, false));

                    _this120.refQuantile = Weave.linkableChild(_this120, new LinkableNumber(.3));
                    // reusable temporary object
                    _this120.tempNumberClassifier = Weave.disposableChild(_this120, bin.NumberClassifier);
                    return _this120;
                }
                /**
                 * getBinClassifiersForColumn - implements IBinningDefinition Interface
                 * @param column
                 * @param output
                 */
                /* override */

                _createClass(QuantileBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        var name;
                        // clear any existing bin classifiers
                        this.output.removeAllObjects();
                        var stats = WeaveAPI.StatisticsCache.getColumnStatistics(column);
                        var sortedColumn = this.getSortedColumn(column);
                        var binMin;
                        var binMax = sortedColumn[0];
                        var maxInclusive;
                        var recordCount = stats.getCount();
                        var refBinSize = Math.ceil(recordCount * this.refQuantile.value); //how many records in a bin
                        if (!refBinSize) refBinSize = recordCount;
                        var numberOfBins = Math.ceil(recordCount / refBinSize);
                        var binRecordCount = refBinSize;
                        for (var iBin = 0; iBin < numberOfBins; iBin++) {
                            binRecordCount = (iBin + 1) * refBinSize;
                            binMin = binMax;
                            if (iBin == numberOfBins - 1) {
                                binMax = sortedColumn[sortedColumn.length - 1];
                                maxInclusive = true;
                            } else {
                                binMax = sortedColumn[binRecordCount - 1];
                                maxInclusive = binMax == binMin;
                            }
                            this.tempNumberClassifier.min.value = binMin;
                            this.tempNumberClassifier.max.value = binMax;
                            this.tempNumberClassifier.minInclusive.value = true;
                            this.tempNumberClassifier.maxInclusive.value = maxInclusive;
                            //first get name from overrideBinNames
                            name = this.getOverrideNames()[iBin];
                            //if it is empty string set it from generateBinLabel
                            if (!name) name = this.tempNumberClassifier.generateBinLabel(column);
                            this.output.requestObjectCopy(name, this.tempNumberClassifier);
                        }
                        // trigger callbacks now because we're done updating the output
                        this.asyncResultCallbacks.triggerCallbacks();
                    }
                    //variables for getSortedColumn method
                    /**
                     * getSortedColumn
                     * @param column
                     * @return _sortedColumn array
                     */

                }, {
                    key: "getSortedColumn",
                    value: function getSortedColumn(column) {
                        var keys = column ? column.keys : [];
                        var _sortedColumn = new Array(keys.length);
                        var i = 0;
                        var _iteratorNormalCompletion59 = true;
                        var _didIteratorError59 = false;
                        var _iteratorError59 = undefined;

                        try {
                            for (var _iterator59 = keys[Symbol.iterator](), _step59; !(_iteratorNormalCompletion59 = (_step59 = _iterator59.next()).done); _iteratorNormalCompletion59 = true) {
                                var key = _step59.value;

                                var n = column.getValueFromKey(key, Number);
                                if (isFinite(n)) _sortedColumn[i++] = n;
                            }
                        } catch (err) {
                            _didIteratorError59 = true;
                            _iteratorError59 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion59 && _iterator59.return) {
                                    _iterator59.return();
                                }
                            } finally {
                                if (_didIteratorError59) {
                                    throw _iteratorError59;
                                }
                            }
                        }

                        _sortedColumn.length = i;
                        AsyncSort.sortImmediately(_sortedColumn);
                        return _sortedColumn;
                    }
                }]);

                return QuantileBinningDefinition;
            }(bin.AbstractBinningDefinition);
            QuantileBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.data.bin.QuantileBinningDefinition", interfaces: [IBinningDefinition] })], QuantileBinningDefinition);
            bin.QuantileBinningDefinition = QuantileBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var StandardLib = weavejs.util.StandardLib;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            /**
             * EqualIntervalBinningDefinition
             *
             * @author adufilie
             * @author abaumann
             * @author sanbalagan
             */
            var EqualIntervalBinningDefinition = function (_bin$AbstractBinningD2) {
                _inherits(EqualIntervalBinningDefinition, _bin$AbstractBinningD2);

                function EqualIntervalBinningDefinition() {
                    _classCallCheck(this, EqualIntervalBinningDefinition);

                    var _this121 = _possibleConstructorReturn(this, (EqualIntervalBinningDefinition.__proto__ || Object.getPrototypeOf(EqualIntervalBinningDefinition)).call(this, true, true));

                    _this121.dataInterval = Weave.linkableChild(_this121, new LinkableNumber());
                    // reusable temporary object
                    _this121.tempNumberClassifier = Weave.disposableChild(_this121, bin.NumberClassifier);
                    return _this121;
                }
                /* override */

                _createClass(EqualIntervalBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        var name;
                        // clear any existing bin classifiers
                        this.output.removeAllObjects();
                        //var integerValuesOnly:Boolean = column is StringColumn;
                        var stats = WeaveAPI.StatisticsCache.getColumnStatistics(column);
                        var dataMin = isFinite(this.overrideInputMin.value) ? this.overrideInputMin.value : stats.getMin();
                        var dataMax = isFinite(this.overrideInputMax.value) ? this.overrideInputMax.value : stats.getMax();
                        var binMin;
                        var binMax = dataMin;
                        var maxInclusive;
                        //var valuesPerBin:int = Math.ceil((dataMax - dataMin + 1) / dataInterval.value);
                        var numberOfBins = Math.ceil((dataMax - dataMin) / this.dataInterval.value);
                        if (!isFinite(numberOfBins)) numberOfBins = 1;
                        for (var iBin = 0; iBin < numberOfBins; iBin++) {
                            // classifiers use min <= value < max,
                            // except for the final one, which uses min <= value <= max
                            binMin = binMax;
                            if (iBin == numberOfBins - 1) {
                                binMax = dataMax;
                                maxInclusive = true;
                            } else {
                                maxInclusive = false;
                                //****binMax = dataMin + (iBin + 1) * (dataMax - dataMin) / numberOfBins.value;
                                binMax = binMin + this.dataInterval.value;
                                // TEMPORARY SOLUTION -- round bin boundaries
                                binMax = StandardLib.roundSignificant(binMax, 4);
                            }
                            // TEMPORARY SOLUTION -- round bin boundaries
                            if (iBin > 0) binMin = StandardLib.roundSignificant(binMin, 4);
                            // skip bins with no values
                            if (binMin == binMax && !maxInclusive) continue;
                            this.tempNumberClassifier.min.value = binMin;
                            this.tempNumberClassifier.max.value = binMax;
                            this.tempNumberClassifier.minInclusive.value = true;
                            this.tempNumberClassifier.maxInclusive.value = maxInclusive;
                            //first get name from overrideBinNames
                            name = this.getOverrideNames()[iBin];
                            //if it is empty string set it from generateBinLabel
                            if (!name) name = this.tempNumberClassifier.generateBinLabel(column);
                            this.output.requestObjectCopy(name, this.tempNumberClassifier);
                        }
                        // trigger callbacks now because we're done updating the output
                        this.asyncResultCallbacks.triggerCallbacks();
                    }
                }]);

                return EqualIntervalBinningDefinition;
            }(bin.AbstractBinningDefinition);
            EqualIntervalBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.data.bin.EqualIntervalBinningDefinition", interfaces: [IBinningDefinition] })], EqualIntervalBinningDefinition);
            bin.EqualIntervalBinningDefinition = EqualIntervalBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var Scheduler = weavejs.core.Scheduler;
            var AsyncSort = weavejs.util.AsyncSort;
            var StandardLib = weavejs.util.StandardLib;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            var AbstractBinningDefinition = weavejs.data.bin.AbstractBinningDefinition;
            /**
             * Creates a separate bin for every string value in a column.
             *
             * @author adufilie
             */
            var CategoryBinningDefinition = function (_AbstractBinningDefin) {
                _inherits(CategoryBinningDefinition, _AbstractBinningDefin);

                function CategoryBinningDefinition() {
                    _classCallCheck(this, CategoryBinningDefinition);

                    var _this122 = _possibleConstructorReturn(this, (CategoryBinningDefinition.__proto__ || Object.getPrototypeOf(CategoryBinningDefinition)).call(this, false, false));

                    _this122._iterateAll = Scheduler.generateCompoundIterativeTask(function (stopTime) {
                        return _this122._iterate1(stopTime);
                    }, function (stopTime) {
                        return _this122._iterate2(stopTime);
                    });
                    _this122.asyncSort = Weave.disposableChild(_this122, AsyncSort);
                    return _this122;
                }
                /* override */

                _createClass(CategoryBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        var _this123 = this;

                        // clear any existing bin classifiers
                        this.output.removeAllObjects();
                        // get all string values in the a column
                        this._sortMap = {};
                        this.strArray = new Array(column.keys.length); // alloc max length
                        this.column = column;
                        this.i = this.iout = 0;
                        this.keys = column.keys;
                        this._iterateAll(-1); // restart from first task
                        // high priority because not much can be done without data
                        WeaveAPI.Scheduler.startTask(this.asyncResultCallbacks, this._iterateAll, WeaveAPI.TASK_PRIORITY_HIGH, function () {
                            return _this123._done;
                        });
                    }
                }, {
                    key: "_iterate1",
                    value: function _iterate1(stopTime) {
                        for (; this.i < this.keys.length; this.i++) {
                            if (Date.now() > stopTime) return this.i / this.keys.length;
                            this.str = this.column.getValueFromKey(this.keys[this.i], String);
                            if (this.str && !this._sortMap.hasOwnProperty(this.str)) {
                                this.strArray[int(this.iout++)] = this.str;
                                this._sortMap[this.str] = this.column.getValueFromKey(this.keys[this.i], Number);
                            }
                        }
                        this.strArray.length = this.iout; // truncate
                        this.asyncSort.beginSort(this.strArray, this._sortFunc.bind(this)); // sort strings by corresponding numeric values
                        this.i = 0;
                        return 1;
                    }
                }, {
                    key: "_iterate2",
                    value: function _iterate2(stopTime) {
                        if (Weave.isBusy(this.asyncSort)) return 0;
                        for (; this.i < this.strArray.length; this.i++) {
                            if (Date.now() > stopTime) return this.i / this.strArray.length;
                            this.str = Weave.AS(this.strArray[this.i], String);
                            var svc = this.output.requestObject(this.str, bin.SingleValueClassifier, false);
                            svc.state = this.strArray[this.i];
                        }
                        return 1;
                    }
                }, {
                    key: "_done",
                    value: function _done() {
                        this.asyncResultCallbacks.triggerCallbacks();
                    }
                    /**
                     * This function sorts string values by their corresponding numeric values stored in _sortMap.
                     */

                }, {
                    key: "_sortFunc",
                    value: function _sortFunc(str1, str2) {
                        return StandardLib.numericCompare(this._sortMap[str1], this._sortMap[str2]) || StandardLib.stringCompare(str1, str2);
                    }
                }]);

                return CategoryBinningDefinition;
            }(AbstractBinningDefinition);
            CategoryBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.data.bin.CategoryBinningDefinition", interfaces: [IBinningDefinition] })], CategoryBinningDefinition);
            bin.CategoryBinningDefinition = CategoryBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is a cache used to avoid making duplicate column requests.
             *
             * @author adufilie
             */
            var IAttributeColumnCache = function IAttributeColumnCache() {
                _classCallCheck(this, IAttributeColumnCache);
            };
            IAttributeColumnCache = __decorate([Weave.classInfo({ id: "weavejs.api.data.IAttributeColumnCache" })], IAttributeColumnCache);
            data.IAttributeColumnCache = IAttributeColumnCache;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * This is an interface for a column that is a wrapper for another column.
             * The data should always be retrieved from the wrapper class because the getValueFromKey() function may modify the data before returning it.
             * The purpose of this interface is to allow you to check the type of the internal column.
             * One example usage of this is to check if the internal column is a StreamedGeometryColumn
             * so that you can request more detail from the tile service.
             *
             * @author adufilie
             */
            var IColumnWrapper = function (_data$IAttributeColum) {
                _inherits(IColumnWrapper, _data$IAttributeColum);

                function IColumnWrapper() {
                    _classCallCheck(this, IColumnWrapper);

                    return _possibleConstructorReturn(this, (IColumnWrapper.__proto__ || Object.getPrototypeOf(IColumnWrapper)).apply(this, arguments));
                }

                return IColumnWrapper;
            }(data.IAttributeColumn);
            IColumnWrapper = __decorate([Weave.classInfo({ id: "weavejs.api.data.IColumnWrapper" })], IColumnWrapper);
            data.IColumnWrapper = IColumnWrapper;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * This provides a wrapper for a dynamic column, and allows new properties to be added.
             * The purpose of this class is to provide a base for extending DynamicColumn.
             *
             * @author adufilie
             */
            var ExtendedDynamicColumn = function (_CallbackCollection3) {
                _inherits(ExtendedDynamicColumn, _CallbackCollection3);

                function ExtendedDynamicColumn() {
                    _classCallCheck(this, ExtendedDynamicColumn);

                    var _this125 = _possibleConstructorReturn(this, (ExtendedDynamicColumn.__proto__ || Object.getPrototypeOf(ExtendedDynamicColumn)).call(this));

                    _this125._internalDynamicColumn = Weave.linkableChild(_this125, column.DynamicColumn);
                    Weave.linkableChild(_this125, WeaveAPI.StatisticsCache.getColumnStatistics(_this125.internalDynamicColumn));
                    return _this125;
                }
                /**
                 * This is for the IColumnWrapper interface.
                 */


                _createClass(ExtendedDynamicColumn, [{
                    key: "getInternalColumn",
                    value: function getInternalColumn() {
                        return this.internalDynamicColumn.getInternalColumn();
                    }
                    /**
                     * This is the internal DynamicColumn object that is being extended.
                     */

                }, {
                    key: "getMetadata",

                    /************************************
                     * Begin IAttributeColumn interface
                     ************************************/
                    value: function getMetadata(propertyName) {
                        return this.internalDynamicColumn.getMetadata(propertyName);
                    }
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        return this.internalDynamicColumn.getMetadataPropertyNames();
                    }
                    /**
                     * @return the keys associated with this column.
                     */

                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    value: function containsKey(key) {
                        return this.internalDynamicColumn.containsKey(key);
                    }
                    /**
                     * getValueFromKey
                     * @param key A key of the type specified by keyType.
                     * @return The value associated with the given key.
                     */

                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        return this.internalDynamicColumn.getValueFromKey(key, dataType);
                    }
                }, {
                    key: "internalDynamicColumn",
                    get: function get() {
                        return this._internalDynamicColumn;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this.internalDynamicColumn.keys;
                    }
                }]);

                return ExtendedDynamicColumn;
            }(CallbackCollection);
            ExtendedDynamicColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.ExtendedDynamicColumn", interfaces: [IColumnWrapper, ICallbackCollection, IAttributeColumn] })], ExtendedDynamicColumn);
            column.ExtendedDynamicColumn = ExtendedDynamicColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var SortedKeySet = weavejs.data.key.SortedKeySet;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * This is a wrapper for another column that provides sorted keys.
             *
             * @author adufilie
             */
            var SortedColumn = function (_column$ExtendedDynam) {
                _inherits(SortedColumn, _column$ExtendedDynam);

                function SortedColumn() {
                    _classCallCheck(this, SortedColumn);

                    /**
                     * This is an option to sort the column in ascending or descending order.
                     */
                    var _this126 = _possibleConstructorReturn(this, (SortedColumn.__proto__ || Object.getPrototypeOf(SortedColumn)).call(this));

                    _this126.ascending = Weave.linkableChild(_this126, new LinkableBoolean(true));
                    _this126._keys = [];
                    _this126._prevTriggerCounter = 0;
                    Weave.linkableChild(_this126, WeaveAPI.StatisticsCache.getColumnStatistics(_this126.internalDynamicColumn));
                    _this126.sortCopyAscending = SortedKeySet.generateSortCopyFunction([_this126.internalDynamicColumn], [1]);
                    _this126.sortCopyDescending = SortedKeySet.generateSortCopyFunction([_this126.internalDynamicColumn], [-1]);
                    return _this126;
                }
                /**
                 * This function returns the unique strings of the internal column.
                 * @return The keys this column defines values for.
                 */
                /* override */

                _createClass(SortedColumn, [{
                    key: "keys",
                    get: function get() {
                        if (this._prevTriggerCounter != this.triggerCounter) {
                            if (this.ascending.value) this._keys = this.sortCopyAscending(_get(SortedColumn.prototype.__proto__ || Object.getPrototypeOf(SortedColumn.prototype), "keys", this));else this._keys = this.sortCopyDescending(_get(SortedColumn.prototype.__proto__ || Object.getPrototypeOf(SortedColumn.prototype), "keys", this));
                            this._prevTriggerCounter = this.triggerCounter;
                        }
                        return this._keys;
                    }
                }]);

                return SortedColumn;
            }(column.ExtendedDynamicColumn);
            SortedColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.SortedColumn", interfaces: [IAttributeColumn, IColumnWrapper, ICallbackCollection] })], SortedColumn);
            column.SortedColumn = SortedColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * @author adufilie
             */
            var NormalizedColumn = function (_column$ExtendedDynam2) {
                _inherits(NormalizedColumn, _column$ExtendedDynam2);

                function NormalizedColumn() {
                    var min = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                    var max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;

                    _classCallCheck(this, NormalizedColumn);

                    var _this127 = _possibleConstructorReturn(this, (NormalizedColumn.__proto__ || Object.getPrototypeOf(NormalizedColumn)).call(this));

                    _this127.min = Weave.linkableChild(_this127, LinkableNumber);
                    _this127.max = Weave.linkableChild(_this127, LinkableNumber);
                    _this127._stats = WeaveAPI.StatisticsCache.getColumnStatistics(_this127.internalDynamicColumn);
                    // when stats update, we need to trigger our callbacks because the values returned by getValueFromKey() will be different.
                    Weave.getCallbacks(_this127._stats).addImmediateCallback(_this127, _this127.triggerCallbacks);
                    _this127.min.value = min;
                    _this127.max.value = max;
                    return _this127;
                }
                /**
                 * getValueFromKey
                 * @param key A key of the type specified by keyType.
                 * @return The value associated with the given key.
                 */
                /* override */

                _createClass(NormalizedColumn, [{
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (dataType == null) dataType = Number;
                        if (dataType == Number) {
                            // get norm value between 0 and 1
                            var norm = this._stats.getNorm(key);
                            // return number between min and max
                            return this.min.value + norm * (this.max.value - this.min.value);
                        }
                        return _get(NormalizedColumn.prototype.__proto__ || Object.getPrototypeOf(NormalizedColumn.prototype), "getValueFromKey", this).call(this, key, dataType);
                    }
                }]);

                return NormalizedColumn;
            }(column.ExtendedDynamicColumn);
            NormalizedColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.NormalizedColumn", interfaces: [IColumnWrapper, IAttributeColumn, ICallbackCollection] })], NormalizedColumn);
            column.NormalizedColumn = NormalizedColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;

            var ISelectableAttributes = function (_ILinkableObject7) {
                _inherits(ISelectableAttributes, _ILinkableObject7);

                function ISelectableAttributes() {
                    _classCallCheck(this, ISelectableAttributes);

                    return _possibleConstructorReturn(this, (ISelectableAttributes.__proto__ || Object.getPrototypeOf(ISelectableAttributes)).apply(this, arguments));
                }

                return ISelectableAttributes;
            }(ILinkableObject);
            // TODO fix setClassInfo argument so that it accepts abstract classes


            ISelectableAttributes.WEAVE_INFO = Weave.setClassInfo(ISelectableAttributes, {
                id: "weavejs.api.data.ISelectableAttributes"
            });
            data.ISelectableAttributes = ISelectableAttributes;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var LinkableDynamicObject = weavejs.core.LinkableDynamicObject;
            var ILinkableDynamicObject = weavejs.api.core.ILinkableDynamicObject;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var Dictionary2D = weavejs.util.Dictionary2D;
            /**
             * This provides a wrapper for a dynamically created column.
             *
             * @author adufilie
             */
            var DynamicColumn_1 = void 0;
            var DynamicColumn = DynamicColumn_1 = function (_LinkableDynamicObjec3) {
                _inherits(DynamicColumn, _LinkableDynamicObjec3);

                function DynamicColumn() {
                    var columnTypeRestriction = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, DynamicColumn);

                    var _this129 = _possibleConstructorReturn(this, (DynamicColumn.__proto__ || Object.getPrototypeOf(DynamicColumn)).call(this, function () {
                        if (columnTypeRestriction == null) {
                            columnTypeRestriction = IAttributeColumn;
                        } else {
                            // make sure the columnTypeRestriction implements IAttributeColumn
                            if (!Weave.IS(columnTypeRestriction.prototype, IAttributeColumn)) {
                                console.error("DynamicColumn(): columnTypeRestriction does not implement IAttributeColumn:", columnTypeRestriction);
                                columnTypeRestriction = IAttributeColumn;
                            }
                        }
                        return columnTypeRestriction;
                    }()));

                    _this129.d2d_type_key = new Dictionary2D(true, true);
                    _this129._cacheCounter = 0;
                    return _this129;
                }
                /**
                 * This function lets you skip the step of casting internalObject as an IAttributeColumn.
                 */


                _createClass(DynamicColumn, [{
                    key: "getInternalColumn",
                    value: function getInternalColumn() {
                        return Weave.AS(this.internalObject, IAttributeColumn);
                    }
                    /************************************
                     * Begin IAttributeColumn interface
                     ************************************/

                }, {
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (this.internalObject) return Weave.AS(this.internalObject, IAttributeColumn).getMetadata(propertyName);
                        return null;
                    }
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        if (this.internalObject) return Weave.AS(this.internalObject, IAttributeColumn).getMetadataPropertyNames();
                        return [];
                    }
                    /**
                     * @return the keys associated with this column.
                     */

                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    value: function containsKey(key) {
                        var col = Weave.AS(this.internalObject, IAttributeColumn);
                        return col ? col.containsKey(key) : false;
                    }
                    /**
                     * @param key A key of the type specified by keyType.
                     * @return The value associated with the given key.
                     */

                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (!dataType) dataType = Array;
                        if (!DynamicColumn_1.cache) {
                            var col = Weave.AS(this.internalObject, IAttributeColumn);
                            return col ? col.getValueFromKey(key, dataType) : undefined;
                        }
                        if (this.triggerCounter != this._cacheCounter) {
                            this._cacheCounter = this.triggerCounter;
                            this.d2d_type_key = new Dictionary2D(true, true);
                        }
                        var value = this.d2d_type_key.get(dataType, key);
                        if (value === undefined) {
                            col = Weave.AS(this.internalObject, IAttributeColumn);
                            if (col) value = col.getValueFromKey(key, dataType);
                            this.d2d_type_key.set(dataType, key, value === undefined ? DynamicColumn_1.UNDEFINED : value);
                        }
                        return value === DynamicColumn_1.UNDEFINED ? undefined : value;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this.getInternalColumn() ? this.getInternalColumn().keys : [];
                    }
                }]);

                return DynamicColumn;
            }(LinkableDynamicObject);
            // TEMPORARY PERFORMANCE IMPROVEMENT SOLUTION
            DynamicColumn.cache = true;
            DynamicColumn.UNDEFINED = {};
            DynamicColumn = DynamicColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.DynamicColumn", interfaces: [IColumnWrapper, IAttributeColumn, ILinkableDynamicObject, ICallbackCollection] })], DynamicColumn);
            column.DynamicColumn = DynamicColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * A primitive attribute column is one defined by primitive data and has both numeric and string
             * representations of its data values.
             */
            var IPrimitiveColumn = function (_data$IAttributeColum2) {
                _inherits(IPrimitiveColumn, _data$IAttributeColum2);

                function IPrimitiveColumn() {
                    _classCallCheck(this, IPrimitiveColumn);

                    return _possibleConstructorReturn(this, (IPrimitiveColumn.__proto__ || Object.getPrototypeOf(IPrimitiveColumn)).apply(this, arguments));
                }

                return IPrimitiveColumn;
            }(data.IAttributeColumn);
            IPrimitiveColumn = __decorate([Weave.classInfo({ id: "weavejs.api.data.IPrimitiveColumn" })], IPrimitiveColumn);
            data.IPrimitiveColumn = IPrimitiveColumn;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IColumnStatistics = weavejs.api.data.IColumnStatistics;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
            var LinkableWatcher = weavejs.core.LinkableWatcher;
            var StandardLib = weavejs.util.StandardLib;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            /**
             * This column maps a record key to the index in the list of records sorted by numeric value.
             *
             * @author adufilie
             */
            var SortedIndexColumn = function (_column$DynamicColumn) {
                _inherits(SortedIndexColumn, _column$DynamicColumn);

                function SortedIndexColumn() {
                    _classCallCheck(this, SortedIndexColumn);

                    var _this131 = _possibleConstructorReturn(this, (SortedIndexColumn.__proto__ || Object.getPrototypeOf(SortedIndexColumn)).call(this));

                    _this131.map_key_sortIndex = new Map();
                    _this131._triggerCount = 0;
                    _this131._statsWatcher = Weave.linkableChild(_this131, LinkableWatcher);
                    _this131.addImmediateCallback(_this131, _this131._updateStats);
                    return _this131;
                }

                _createClass(SortedIndexColumn, [{
                    key: "_updateStats",
                    value: function _updateStats() {
                        this._column = this.getInternalColumn();
                        this._statsWatcher.target = this._column && WeaveAPI.StatisticsCache.getColumnStatistics(this._column);
                    }
                }, {
                    key: "validate",
                    value: function validate() {
                        if (this._column) {
                            this.map_key_sortIndex = this._stats.getSortIndex();
                            if (this.map_key_sortIndex) this._sortedKeys = StandardLib.sortOn(this._column.keys, this.map_key_sortIndex, null, false);else this._sortedKeys = this._column.keys;
                        } else {
                            this.map_key_sortIndex = null;
                            this._sortedKeys = [];
                        }
                        this._triggerCount = this.triggerCounter;
                    }
                    /* override */
                }, {
                    key: "getValueFromKey",

                    /**
                     * @param key A key existing in the internal column.
                     * @param dataType A requested return type.
                     * @return If dataType is not specified, returns the index of the key in the sorted list of keys.
                     */
                    /* override */value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (this._triggerCount != this.triggerCounter) this.validate();
                        if (!this._column) return dataType == String ? '' : undefined;
                        if (dataType == Number) return this.map_key_sortIndex ? Number(this.map_key_sortIndex.get(key)) : NaN;
                        return this._column.getValueFromKey(key, dataType);
                    }
                    /**
                     * @param index The index in the sorted keys vector.
                     * @return The key at the given index value.
                     */

                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(index) {
                        if (this._triggerCount != this.triggerCounter) this.validate();
                        if (!this._column || index < 0 || index >= this._sortedKeys.length || int(index) != index) return '';
                        return this._column.getValueFromKey(this._sortedKeys[index], String);
                    }
                }, {
                    key: "_stats",
                    get: function get() {
                        return Weave.AS(this._statsWatcher.target, IColumnStatistics);
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        if (this._triggerCount != this.triggerCounter) this.validate();
                        return this._sortedKeys;
                    }
                }]);

                return SortedIndexColumn;
            }(column.DynamicColumn);
            SortedIndexColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.SortedIndexColumn", interfaces: [IAttributeColumn, IPrimitiveColumn, IColumnWrapper] })], SortedIndexColumn);
            column.SortedIndexColumn = SortedIndexColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data_2) {
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * A column which implements setRecords()
             */
            var IBaseColumn = function (_data_2$IAttributeCol) {
                _inherits(IBaseColumn, _data_2$IAttributeCol);

                function IBaseColumn() {
                    _classCallCheck(this, IBaseColumn);

                    return _possibleConstructorReturn(this, (IBaseColumn.__proto__ || Object.getPrototypeOf(IBaseColumn)).apply(this, arguments));
                }

                return IBaseColumn;
            }(data_2.IAttributeColumn);
            IBaseColumn = __decorate([Weave.classInfo({ id: "weavejs.api.data.IBaseColumn", interfaces: [data_2.IAttributeColumn, ICallbackCollection, data_2.IKeySet] })], IBaseColumn);
            data_2.IBaseColumn = IBaseColumn;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var data;
        (function (data) {
            /**
             * Constants that refer to standard metadata property names used by the IAttributeColumn.getMetadata() function.
             *
             * @author adufilie
             */
            var ColumnMetadata = function () {
                function ColumnMetadata() {
                    _classCallCheck(this, ColumnMetadata);
                }

                _createClass(ColumnMetadata, null, [{
                    key: "getAllMetadata",
                    value: function getAllMetadata(column) {
                        var meta = {};
                        var names = column.getMetadataPropertyNames();
                        var _iteratorNormalCompletion60 = true;
                        var _didIteratorError60 = false;
                        var _iteratorError60 = undefined;

                        try {
                            for (var _iterator60 = (names || [])[Symbol.iterator](), _step60; !(_iteratorNormalCompletion60 = (_step60 = _iterator60.next()).done); _iteratorNormalCompletion60 = true) {
                                var name = _step60.value;

                                meta[name] = column.getMetadata(name);
                            }
                        } catch (err) {
                            _didIteratorError60 = true;
                            _iteratorError60 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion60 && _iterator60.return) {
                                    _iterator60.return();
                                }
                            } finally {
                                if (_didIteratorError60) {
                                    throw _iteratorError60;
                                }
                            }
                        }

                        return meta;
                    }
                    /**
                     * @param propertyName The name of a metadata property.
                     * @return An Array of suggested String values for the specified metadata property.
                     */

                }, {
                    key: "getSuggestedPropertyValues",
                    value: function getSuggestedPropertyValues(propertyName) {
                        switch (propertyName) {
                            case ColumnMetadata.ENTITY_TYPE:
                                return data.EntityType.ALL_TYPES;
                            case ColumnMetadata.DATA_TYPE:
                                return data.DataTypes.ALL_TYPES;
                            case ColumnMetadata.DATE_DISPLAY_FORMAT:
                            case ColumnMetadata.DATE_FORMAT:
                                return data.DateFormat.getSuggestions();
                            case ColumnMetadata.AGGREGATION:
                                return data.Aggregation.ALL_TYPES;
                            default:
                                return [];
                        }
                    }
                }]);

                return ColumnMetadata;
            }();

            ColumnMetadata.ENTITY_TYPE = 'entityType';
            ColumnMetadata.TITLE = "title";
            ColumnMetadata.NUMBER = "number";
            ColumnMetadata.STRING = "string";
            ColumnMetadata.KEY_TYPE = "keyType";
            ColumnMetadata.DATA_TYPE = "dataType";
            ColumnMetadata.PROJECTION = "projection";
            ColumnMetadata.AGGREGATION = "aggregation";
            ColumnMetadata.DATE_FORMAT = "dateFormat";
            ColumnMetadata.DATE_DISPLAY_FORMAT = "dateDisplayFormat";
            ColumnMetadata.OVERRIDE_BINS = "overrideBins";
            ColumnMetadata.MIN = "min";
            ColumnMetadata.MAX = "max";
            data.ColumnMetadata = ColumnMetadata;
        })(data = api.data || (api.data = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source_1) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IColumnReference = weavejs.api.data.IColumnReference;
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var StandardLib = weavejs.util.StandardLib;
            var GeoJSONDataSourceNode_1 = void 0;
            var GeoJSONDataSourceNode = GeoJSONDataSourceNode_1 = function () {
                function GeoJSONDataSourceNode(source, metadata) {
                    var children = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
                    var idFields = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    _classCallCheck(this, GeoJSONDataSourceNode);

                    this.source = source;
                    this.metadata = metadata || {};
                    this.children = children;
                    this.idFields = idFields;
                }

                _createClass(GeoJSONDataSourceNode, [{
                    key: "equals",
                    value: function equals(other) {
                        var that = Weave.AS(other, GeoJSONDataSourceNode_1);
                        if (that && this.source == that.source && StandardLib.compare(this.idFields, that.idFields) == 0) {
                            if (this.idFields && this.idFields.length) {
                                // check only specified fields
                                var _iteratorNormalCompletion61 = true;
                                var _didIteratorError61 = false;
                                var _iteratorError61 = undefined;

                                try {
                                    for (var _iterator61 = this.idFields[Symbol.iterator](), _step61; !(_iteratorNormalCompletion61 = (_step61 = _iterator61.next()).done); _iteratorNormalCompletion61 = true) {
                                        var field = _step61.value;

                                        if (this.metadata[field] != that.metadata[field]) return false;
                                    }
                                } catch (err) {
                                    _didIteratorError61 = true;
                                    _iteratorError61 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion61 && _iterator61.return) {
                                            _iterator61.return();
                                        }
                                    } finally {
                                        if (_didIteratorError61) {
                                            throw _iteratorError61;
                                        }
                                    }
                                }

                                return true;
                            }
                            // check all fields
                            return StandardLib.compare(this.metadata, that.metadata) == 0;
                        }
                        return false;
                    }
                }, {
                    key: "getLabel",
                    value: function getLabel() {
                        return this.metadata[ColumnMetadata.TITLE];
                    }
                }, {
                    key: "isBranch",
                    value: function isBranch() {
                        return this.children != null;
                    }
                }, {
                    key: "hasChildBranches",
                    value: function hasChildBranches() {
                        return false;
                    }
                }, {
                    key: "getChildren",
                    value: function getChildren() {
                        return this.children;
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        return this.source;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        return this.children ? null : this.metadata;
                    }
                }]);

                return GeoJSONDataSourceNode;
            }();
            GeoJSONDataSourceNode = GeoJSONDataSourceNode_1 = __decorate([Weave.classInfo({ id: "weavejs.data.source.GeoJSONDataSourceNode", interfaces: [IWeaveTreeNode, IColumnReference] })], GeoJSONDataSourceNode);
            source_1.GeoJSONDataSourceNode = GeoJSONDataSourceNode;
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
*
* This file is part of Weave.
*
* The Initial Developer of Weave is the Institute for Visualization
* and Perception Research at the University of Massachusetts Lowell.
* Portions created by the Initial Developer are Copyright (C) 2008-2015
* the Initial Developer. All Rights Reserved.
*
* This Source Code Form is subject to the terms of the Mozilla Public
* You can obtain one at http://mozilla.org/MPL/2.0/.
*
* ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source) {
            var JsonCache = weavejs.net.JsonCache;
            var StandardLib = weavejs.util.StandardLib;

            var CensusApi = function () {
                function CensusApi() {
                    _classCallCheck(this, CensusApi);

                    this.jsonCache = Weave.linkableChild(this, JsonCache);
                }

                _createClass(CensusApi, [{
                    key: "getUrl",
                    value: function getUrl(serviceUrl, params) {
                        var paramsStr = '';
                        for (var key in params) {
                            paramsStr += (paramsStr ? '&' : '?') + key + '=' + params[key];
                        }return serviceUrl + paramsStr;
                    }
                }, {
                    key: "getJsonCachePromise",
                    value: function getJsonCachePromise(accessUrl, params) {
                        return this.jsonCache.getJsonPromise(this.getUrl(accessUrl, params));
                    }
                }, {
                    key: "getDatasets",
                    value: function getDatasets() {
                        return this.jsonCache.getJsonPromise(CensusApi.BASE_URL + "data.json");
                    }
                    /* TODO: Add memoized promises for preprocessing steps */

                }, {
                    key: "getDatasetPromise",
                    value: function getDatasetPromise(dataSetIdentifier) {
                        return this.getDatasets().then(function (result) {
                            if (!result || !result.dataset) {
                                throw new Error("Malformed response from Census API.");
                            }
                            var _iteratorNormalCompletion62 = true;
                            var _didIteratorError62 = false;
                            var _iteratorError62 = undefined;

                            try {
                                for (var _iterator62 = result.dataset[Symbol.iterator](), _step62; !(_iteratorNormalCompletion62 = (_step62 = _iterator62.next()).done); _iteratorNormalCompletion62 = true) {
                                    var tmp_dataset = _step62.value;

                                    if (tmp_dataset.identifier == dataSetIdentifier) {
                                        return tmp_dataset;
                                    }
                                }
                            } catch (err) {
                                _didIteratorError62 = true;
                                _iteratorError62 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion62 && _iterator62.return) {
                                        _iterator62.return();
                                    }
                                } finally {
                                    if (_didIteratorError62) {
                                        throw _iteratorError62;
                                    }
                                }
                            }

                            throw new Error("No such dataset: " + dataSetIdentifier);
                        });
                    }
                }, {
                    key: "getVariablesPromise",
                    value: function getVariablesPromise(dataSetIdentifier) {
                        var _this133 = this;

                        return this.getDatasetPromise(dataSetIdentifier).then(function (dataset) {
                            return _this133.jsonCache.getJsonPromise(dataset.c_variablesLink);
                        });
                    }
                }, {
                    key: "getGeographiesPromise",
                    value: function getGeographiesPromise(dataSetIdentifier) {
                        var _this134 = this;

                        return this.getDatasetPromise(dataSetIdentifier).then(function (dataset) {
                            return _this134.jsonCache.getJsonPromise(dataset.c_geographyLink);
                        });
                    }
                }, {
                    key: "getVariables",
                    value: function getVariables(dataSetIdentifier) {
                        var _this135 = this;

                        return this.getVariablesPromise(dataSetIdentifier).then(function (result) {
                            if (result.variables === _this135._variablesInfoCached) return _this135._variablesInfoProcessed;
                            var variablesInfo = _.clone(result.variables);
                            delete variablesInfo["for"];
                            delete variablesInfo["in"];
                            for (var key in variablesInfo) {
                                var label = variablesInfo[key].label;
                                var title = StandardLib.substitute('{0} ({1})', StandardLib.replace(label, '!!', "\u2014"), key);
                                variablesInfo[key].title = title;
                            }
                            _this135._variablesInfoProcessed = variablesInfo;
                            _this135._variablesInfoCached = result.variables;
                            return _this135._variablesInfoProcessed;
                        });
                    }
                }, {
                    key: "getGeographies",
                    value: function getGeographies(dataSetIdentifier) {
                        return this.getGeographiesPromise(dataSetIdentifier).then(function (result) {
                            var geo = {};
                            var _iteratorNormalCompletion63 = true;
                            var _didIteratorError63 = false;
                            var _iteratorError63 = undefined;

                            try {
                                for (var _iterator63 = result.fips[Symbol.iterator](), _step63; !(_iteratorNormalCompletion63 = (_step63 = _iterator63.next()).done); _iteratorNormalCompletion63 = true) {
                                    var geo_description = _step63.value;

                                    geo[geo_description.geoLevelId] = {
                                        geoLevelId: geo_description.geoLevelId,
                                        name: geo_description.name,
                                        requires: geo_description.requires,
                                        optionalWithWCFor: geo_description.optionalWithWCFor
                                    };
                                }
                            } catch (err) {
                                _didIteratorError63 = true;
                                _iteratorError63 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion63 && _iterator63.return) {
                                        _iterator63.return();
                                    }
                                } finally {
                                    if (_didIteratorError63) {
                                        throw _iteratorError63;
                                    }
                                }
                            }

                            return geo;
                        });
                    }
                }]);

                return CensusApi;
            }();

            CensusApi.WEAVE_INFO = Weave.setClassInfo(CensusApi, { id: "weavejs.data.source.CensusApi" });
            CensusApi.BASE_URL = "http://api.census.gov/";
            // TODO replace with json file
            CensusApi.state_fips = {
                "01": "AL",
                "02": "AK",
                "04": "AZ",
                "05": "AR",
                "06": "CA",
                "08": "CO",
                "09": "CT",
                "10": "DE",
                "11": "DC",
                "12": "FL",
                "13": "GA",
                "15": "HI",
                "16": "ID",
                "17": "IL",
                "18": "IN",
                "19": "IA",
                "20": "KS",
                "21": "KY",
                "22": "LA",
                "23": "ME",
                "24": "MD",
                "25": "MA",
                "26": "MI",
                "27": "MN",
                "28": "MS",
                "29": "MO",
                "30": "MT",
                "31": "NE",
                "32": "NV",
                "33": "NH",
                "34": "NJ",
                "35": "NM",
                "36": "NY",
                "37": "NC",
                "38": "ND",
                "39": "OH",
                "40": "OK",
                "41": "OR",
                "42": "PA",
                "44": "RI",
                "45": "SC",
                "46": "SD",
                "47": "TN",
                "48": "TX",
                "49": "UT",
                "50": "VT",
                "51": "VA",
                "53": "WA",
                "54": "WV",
                "55": "WI",
                "56": "WY",
                "72": "PR"
            };
            CensusApi.county_fips = {
                "01": {
                    "001": "Autauga County",
                    "003": "Baldwin County",
                    "005": "Barbour County",
                    "007": "Bibb County",
                    "009": "Blount County",
                    "011": "Bullock County",
                    "013": "Butler County",
                    "015": "Calhoun County",
                    "017": "Chambers County",
                    "019": "Cherokee County",
                    "021": "Chilton County",
                    "023": "Choctaw County",
                    "025": "Clarke County",
                    "027": "Clay County",
                    "029": "Cleburne County",
                    "031": "Coffee County",
                    "033": "Colbert County",
                    "035": "Conecuh County",
                    "037": "Coosa County",
                    "039": "Covington County",
                    "041": "Crenshaw County",
                    "043": "Cullman County",
                    "045": "Dale County",
                    "047": "Dallas County",
                    "049": "DeKalb County",
                    "051": "Elmore County",
                    "053": "Escambia County",
                    "055": "Etowah County",
                    "057": "Fayette County",
                    "059": "Franklin County",
                    "061": "Geneva County",
                    "063": "Greene County",
                    "065": "Hale County",
                    "067": "Henry County",
                    "069": "Houston County",
                    "071": "Jackson County",
                    "073": "Jefferson County",
                    "075": "Lamar County",
                    "077": "Lauderdale County",
                    "079": "Lawrence County",
                    "081": "Lee County",
                    "083": "Limestone County",
                    "085": "Lowndes County",
                    "087": "Macon County",
                    "089": "Madison County",
                    "091": "Marengo County",
                    "093": "Marion County",
                    "095": "Marshall County",
                    "097": "Mobile County",
                    "099": "Monroe County",
                    "101": "Montgomery County",
                    "103": "Morgan County",
                    "105": "Perry County",
                    "107": "Pickens County",
                    "109": "Pike County",
                    "111": "Randolph County",
                    "113": "Russell County",
                    "115": "St. Clair County",
                    "117": "Shelby County",
                    "119": "Sumter County",
                    "121": "Talladega County",
                    "123": "Tallapoosa County",
                    "125": "Tuscaloosa County",
                    "127": "Walker County",
                    "129": "Washington County",
                    "131": "Wilcox County",
                    "133": "Winston County"
                },
                "02": {
                    "013": "Aleutians East Borough",
                    "016": "Aleutians West Census Area",
                    "020": "Anchorage Municipality",
                    "050": "Bethel Census Area",
                    "060": "Bristol Bay Borough",
                    "068": "Denali Borough",
                    "070": "Dillingham Census Area",
                    "090": "Fairbanks North Star Borough",
                    "100": "Haines Borough",
                    "105": "Hoonah-Angoon Census Area",
                    "110": "Juneau City and Borough",
                    "122": "Kenai Peninsula Borough",
                    "130": "Ketchikan Gateway Borough",
                    "150": "Kodiak Island Borough",
                    "164": "Lake and Peninsula Borough",
                    "170": "Matanuska-Susitna Borough",
                    "180": "Nome Census Area",
                    "185": "North Slope Borough",
                    "188": "Northwest Arctic Borough",
                    "195": "Petersburg Census Area",
                    "198": "Prince of Wales-Hyder Census Area",
                    "220": "Sitka City and Borough",
                    "230": "Skagway Municipality",
                    "240": "Southeast Fairbanks Census Area",
                    "261": "Valdez-Cordova Census Area",
                    "270": "Wade Hampton Census Area",
                    "275": "Wrangell City and Borough",
                    "282": "Yakutat City and Borough",
                    "290": "Yukon-Koyukuk Census Area"
                },
                "04": {
                    "001": "Apache County",
                    "003": "Cochise County",
                    "005": "Coconino County",
                    "007": "Gila County",
                    "009": "Graham County",
                    "011": "Greenlee County",
                    "012": "La Paz County",
                    "013": "Maricopa County",
                    "015": "Mohave County",
                    "017": "Navajo County",
                    "019": "Pima County",
                    "021": "Pinal County",
                    "023": "Santa Cruz County",
                    "025": "Yavapai County",
                    "027": "Yuma County"
                },
                "05": {
                    "001": "Arkansas County",
                    "003": "Ashley County",
                    "005": "Baxter County",
                    "007": "Benton County",
                    "009": "Boone County",
                    "011": "Bradley County",
                    "013": "Calhoun County",
                    "015": "Carroll County",
                    "017": "Chicot County",
                    "019": "Clark County",
                    "021": "Clay County",
                    "023": "Cleburne County",
                    "025": "Cleveland County",
                    "027": "Columbia County",
                    "029": "Conway County",
                    "031": "Craighead County",
                    "033": "Crawford County",
                    "035": "Crittenden County",
                    "037": "Cross County",
                    "039": "Dallas County",
                    "041": "Desha County",
                    "043": "Drew County",
                    "045": "Faulkner County",
                    "047": "Franklin County",
                    "049": "Fulton County",
                    "051": "Garland County",
                    "053": "Grant County",
                    "055": "Greene County",
                    "057": "Hempstead County",
                    "059": "Hot Spring County",
                    "061": "Howard County",
                    "063": "Independence County",
                    "065": "Izard County",
                    "067": "Jackson County",
                    "069": "Jefferson County",
                    "071": "Johnson County",
                    "073": "Lafayette County",
                    "075": "Lawrence County",
                    "077": "Lee County",
                    "079": "Lincoln County",
                    "081": "Little River County",
                    "083": "Logan County",
                    "085": "Lonoke County",
                    "087": "Madison County",
                    "089": "Marion County",
                    "091": "Miller County",
                    "093": "Mississippi County",
                    "095": "Monroe County",
                    "097": "Montgomery County",
                    "099": "Nevada County",
                    "101": "Newton County",
                    "103": "Ouachita County",
                    "105": "Perry County",
                    "107": "Phillips County",
                    "109": "Pike County",
                    "111": "Poinsett County",
                    "113": "Polk County",
                    "115": "Pope County",
                    "117": "Prairie County",
                    "119": "Pulaski County",
                    "121": "Randolph County",
                    "123": "St. Francis County",
                    "125": "Saline County",
                    "127": "Scott County",
                    "129": "Searcy County",
                    "131": "Sebastian County",
                    "133": "Sevier County",
                    "135": "Sharp County",
                    "137": "Stone County",
                    "139": "Union County",
                    "141": "Van Buren County",
                    "143": "Washington County",
                    "145": "White County",
                    "147": "Woodruff County",
                    "149": "Yell County"
                },
                "06": {
                    "001": "Alameda County",
                    "003": "Alpine County",
                    "005": "Amador County",
                    "007": "Butte County",
                    "009": "Calaveras County",
                    "011": "Colusa County",
                    "013": "Contra Costa County",
                    "015": "Del Norte County",
                    "017": "El Dorado County",
                    "019": "Fresno County",
                    "021": "Glenn County",
                    "023": "Humboldt County",
                    "025": "Imperial County",
                    "027": "Inyo County",
                    "029": "Kern County",
                    "031": "Kings County",
                    "033": "Lake County",
                    "035": "Lassen County",
                    "037": "Los Angeles County",
                    "039": "Madera County",
                    "041": "Marin County",
                    "043": "Mariposa County",
                    "045": "Mendocino County",
                    "047": "Merced County",
                    "049": "Modoc County",
                    "051": "Mono County",
                    "053": "Monterey County",
                    "055": "Napa County",
                    "057": "Nevada County",
                    "059": "Orange County",
                    "061": "Placer County",
                    "063": "Plumas County",
                    "065": "Riverside County",
                    "067": "Sacramento County",
                    "069": "San Benito County",
                    "071": "San Bernardino County",
                    "073": "San Diego County",
                    "075": "San Francisco County",
                    "077": "San Joaquin County",
                    "079": "San Luis Obispo County",
                    "081": "San Mateo County",
                    "083": "Santa Barbara County",
                    "085": "Santa Clara County",
                    "087": "Santa Cruz County",
                    "089": "Shasta County",
                    "091": "Sierra County",
                    "093": "Siskiyou County",
                    "095": "Solano County",
                    "097": "Sonoma County",
                    "099": "Stanislaus County",
                    "101": "Sutter County",
                    "103": "Tehama County",
                    "105": "Trinity County",
                    "107": "Tulare County",
                    "109": "Tuolumne County",
                    "111": "Ventura County",
                    "113": "Yolo County",
                    "115": "Yuba County"
                },
                "08": {
                    "001": "Adams County",
                    "003": "Alamosa County",
                    "005": "Arapahoe County",
                    "007": "Archuleta County",
                    "009": "Baca County",
                    "011": "Bent County",
                    "013": "Boulder County",
                    "014": "Broomfield County",
                    "015": "Chaffee County",
                    "017": "Cheyenne County",
                    "019": "Clear Creek County",
                    "021": "Conejos County",
                    "023": "Costilla County",
                    "025": "Crowley County",
                    "027": "Custer County",
                    "029": "Delta County",
                    "031": "Denver County",
                    "033": "Dolores County",
                    "035": "Douglas County",
                    "037": "Eagle County",
                    "039": "Elbert County",
                    "041": "El Paso County",
                    "043": "Fremont County",
                    "045": "Garfield County",
                    "047": "Gilpin County",
                    "049": "Grand County",
                    "051": "Gunnison County",
                    "053": "Hinsdale County",
                    "055": "Huerfano County",
                    "057": "Jackson County",
                    "059": "Jefferson County",
                    "061": "Kiowa County",
                    "063": "Kit Carson County",
                    "065": "Lake County",
                    "067": "La Plata County",
                    "069": "Larimer County",
                    "071": "Las Animas County",
                    "073": "Lincoln County",
                    "075": "Logan County",
                    "077": "Mesa County",
                    "079": "Mineral County",
                    "081": "Moffat County",
                    "083": "Montezuma County",
                    "085": "Montrose County",
                    "087": "Morgan County",
                    "089": "Otero County",
                    "091": "Ouray County",
                    "093": "Park County",
                    "095": "Phillips County",
                    "097": "Pitkin County",
                    "099": "Prowers County",
                    "101": "Pueblo County",
                    "103": "Rio Blanco County",
                    "105": "Rio Grande County",
                    "107": "Routt County",
                    "109": "Saguache County",
                    "111": "San Juan County",
                    "113": "San Miguel County",
                    "115": "Sedgwick County",
                    "117": "Summit County",
                    "119": "Teller County",
                    "121": "Washington County",
                    "123": "Weld County",
                    "125": "Yuma County"
                },
                "09": {
                    "001": "Fairfield County",
                    "003": "Hartford County",
                    "005": "Litchfield County",
                    "007": "Middlesex County",
                    "009": "New Haven County",
                    "011": "New London County",
                    "013": "Tolland County",
                    "015": "Windham County"
                },
                "10": {
                    "001": "Kent County",
                    "003": "New Castle County",
                    "005": "Sussex County"
                },
                "11": {
                    "001": "District of Columbia"
                },
                "12": {
                    "001": "Alachua County",
                    "003": "Baker County",
                    "005": "Bay County",
                    "007": "Bradford County",
                    "009": "Brevard County",
                    "011": "Broward County",
                    "013": "Calhoun County",
                    "015": "Charlotte County",
                    "017": "Citrus County",
                    "019": "Clay County",
                    "021": "Collier County",
                    "023": "Columbia County",
                    "027": "DeSoto County",
                    "029": "Dixie County",
                    "031": "Duval County",
                    "033": "Escambia County",
                    "035": "Flagler County",
                    "037": "Franklin County",
                    "039": "Gadsden County",
                    "041": "Gilchrist County",
                    "043": "Glades County",
                    "045": "Gulf County",
                    "047": "Hamilton County",
                    "049": "Hardee County",
                    "051": "Hendry County",
                    "053": "Hernando County",
                    "055": "Highlands County",
                    "057": "Hillsborough County",
                    "059": "Holmes County",
                    "061": "Indian River County",
                    "063": "Jackson County",
                    "065": "Jefferson County",
                    "067": "Lafayette County",
                    "069": "Lake County",
                    "071": "Lee County",
                    "073": "Leon County",
                    "075": "Levy County",
                    "077": "Liberty County",
                    "079": "Madison County",
                    "081": "Manatee County",
                    "083": "Marion County",
                    "085": "Martin County",
                    "086": "Miami-Dade County",
                    "087": "Monroe County",
                    "089": "Nassau County",
                    "091": "Okaloosa County",
                    "093": "Okeechobee County",
                    "095": "Orange County",
                    "097": "Osceola County",
                    "099": "Palm Beach County",
                    "101": "Pasco County",
                    "103": "Pinellas County",
                    "105": "Polk County",
                    "107": "Putnam County",
                    "109": "St. Johns County",
                    "111": "St. Lucie County",
                    "113": "Santa Rosa County",
                    "115": "Sarasota County",
                    "117": "Seminole County",
                    "119": "Sumter County",
                    "121": "Suwannee County",
                    "123": "Taylor County",
                    "125": "Union County",
                    "127": "Volusia County",
                    "129": "Wakulla County",
                    "131": "Walton County",
                    "133": "Washington County"
                },
                "13": {
                    "001": "Appling County",
                    "003": "Atkinson County",
                    "005": "Bacon County",
                    "007": "Baker County",
                    "009": "Baldwin County",
                    "011": "Banks County",
                    "013": "Barrow County",
                    "015": "Bartow County",
                    "017": "Ben Hill County",
                    "019": "Berrien County",
                    "021": "Bibb County",
                    "023": "Bleckley County",
                    "025": "Brantley County",
                    "027": "Brooks County",
                    "029": "Bryan County",
                    "031": "Bulloch County",
                    "033": "Burke County",
                    "035": "Butts County",
                    "037": "Calhoun County",
                    "039": "Camden County",
                    "043": "Candler County",
                    "045": "Carroll County",
                    "047": "Catoosa County",
                    "049": "Charlton County",
                    "051": "Chatham County",
                    "053": "Chattahoochee County",
                    "055": "Chattooga County",
                    "057": "Cherokee County",
                    "059": "Clarke County",
                    "061": "Clay County",
                    "063": "Clayton County",
                    "065": "Clinch County",
                    "067": "Cobb County",
                    "069": "Coffee County",
                    "071": "Colquitt County",
                    "073": "Columbia County",
                    "075": "Cook County",
                    "077": "Coweta County",
                    "079": "Crawford County",
                    "081": "Crisp County",
                    "083": "Dade County",
                    "085": "Dawson County",
                    "087": "Decatur County",
                    "089": "DeKalb County",
                    "091": "Dodge County",
                    "093": "Dooly County",
                    "095": "Dougherty County",
                    "097": "Douglas County",
                    "099": "Early County",
                    "101": "Echols County",
                    "103": "Effingham County",
                    "105": "Elbert County",
                    "107": "Emanuel County",
                    "109": "Evans County",
                    "111": "Fannin County",
                    "113": "Fayette County",
                    "115": "Floyd County",
                    "117": "Forsyth County",
                    "119": "Franklin County",
                    "121": "Fulton County",
                    "123": "Gilmer County",
                    "125": "Glascock County",
                    "127": "Glynn County",
                    "129": "Gordon County",
                    "131": "Grady County",
                    "133": "Greene County",
                    "135": "Gwinnett County",
                    "137": "Habersham County",
                    "139": "Hall County",
                    "141": "Hancock County",
                    "143": "Haralson County",
                    "145": "Harris County",
                    "147": "Hart County",
                    "149": "Heard County",
                    "151": "Henry County",
                    "153": "Houston County",
                    "155": "Irwin County",
                    "157": "Jackson County",
                    "159": "Jasper County",
                    "161": "Jeff Davis County",
                    "163": "Jefferson County",
                    "165": "Jenkins County",
                    "167": "Johnson County",
                    "169": "Jones County",
                    "171": "Lamar County",
                    "173": "Lanier County",
                    "175": "Laurens County",
                    "177": "Lee County",
                    "179": "Liberty County",
                    "181": "Lincoln County",
                    "183": "Long County",
                    "185": "Lowndes County",
                    "187": "Lumpkin County",
                    "189": "McDuffie County",
                    "191": "McIntosh County",
                    "193": "Macon County",
                    "195": "Madison County",
                    "197": "Marion County",
                    "199": "Meriwether County",
                    "201": "Miller County",
                    "205": "Mitchell County",
                    "207": "Monroe County",
                    "209": "Montgomery County",
                    "211": "Morgan County",
                    "213": "Murray County",
                    "215": "Muscogee County",
                    "217": "Newton County",
                    "219": "Oconee County",
                    "221": "Oglethorpe County",
                    "223": "Paulding County",
                    "225": "Peach County",
                    "227": "Pickens County",
                    "229": "Pierce County",
                    "231": "Pike County",
                    "233": "Polk County",
                    "235": "Pulaski County",
                    "237": "Putnam County",
                    "239": "Quitman County",
                    "241": "Rabun County",
                    "243": "Randolph County",
                    "245": "Richmond County",
                    "247": "Rockdale County",
                    "249": "Schley County",
                    "251": "Screven County",
                    "253": "Seminole County",
                    "255": "Spalding County",
                    "257": "Stephens County",
                    "259": "Stewart County",
                    "261": "Sumter County",
                    "263": "Talbot County",
                    "265": "Taliaferro County",
                    "267": "Tattnall County",
                    "269": "Taylor County",
                    "271": "Telfair County",
                    "273": "Terrell County",
                    "275": "Thomas County",
                    "277": "Tift County",
                    "279": "Toombs County",
                    "281": "Towns County",
                    "283": "Treutlen County",
                    "285": "Troup County",
                    "287": "Turner County",
                    "289": "Twiggs County",
                    "291": "Union County",
                    "293": "Upson County",
                    "295": "Walker County",
                    "297": "Walton County",
                    "299": "Ware County",
                    "301": "Warren County",
                    "303": "Washington County",
                    "305": "Wayne County",
                    "307": "Webster County",
                    "309": "Wheeler County",
                    "311": "White County",
                    "313": "Whitfield County",
                    "315": "Wilcox County",
                    "317": "Wilkes County",
                    "319": "Wilkinson County",
                    "321": "Worth County"
                },
                "15": {
                    "001": "Hawaii County",
                    "003": "Honolulu County",
                    "005": "Kalawao County",
                    "007": "Kauai County",
                    "009": "Maui County"
                },
                "16": {
                    "001": "Ada County",
                    "003": "Adams County",
                    "005": "Bannock County",
                    "007": "Bear Lake County",
                    "009": "Benewah County",
                    "011": "Bingham County",
                    "013": "Blaine County",
                    "015": "Boise County",
                    "017": "Bonner County",
                    "019": "Bonneville County",
                    "021": "Boundary County",
                    "023": "Butte County",
                    "025": "Camas County",
                    "027": "Canyon County",
                    "029": "Caribou County",
                    "031": "Cassia County",
                    "033": "Clark County",
                    "035": "Clearwater County",
                    "037": "Custer County",
                    "039": "Elmore County",
                    "041": "Franklin County",
                    "043": "Fremont County",
                    "045": "Gem County",
                    "047": "Gooding County",
                    "049": "Idaho County",
                    "051": "Jefferson County",
                    "053": "Jerome County",
                    "055": "Kootenai County",
                    "057": "Latah County",
                    "059": "Lemhi County",
                    "061": "Lewis County",
                    "063": "Lincoln County",
                    "065": "Madison County",
                    "067": "Minidoka County",
                    "069": "Nez Perce County",
                    "071": "Oneida County",
                    "073": "Owyhee County",
                    "075": "Payette County",
                    "077": "Power County",
                    "079": "Shoshone County",
                    "081": "Teton County",
                    "083": "Twin Falls County",
                    "085": "Valley County",
                    "087": "Washington County"
                },
                "17": {
                    "001": "Adams County",
                    "003": "Alexander County",
                    "005": "Bond County",
                    "007": "Boone County",
                    "009": "Brown County",
                    "011": "Bureau County",
                    "013": "Calhoun County",
                    "015": "Carroll County",
                    "017": "Cass County",
                    "019": "Champaign County",
                    "021": "Christian County",
                    "023": "Clark County",
                    "025": "Clay County",
                    "027": "Clinton County",
                    "029": "Coles County",
                    "031": "Cook County",
                    "033": "Crawford County",
                    "035": "Cumberland County",
                    "037": "DeKalb County",
                    "039": "De Witt County",
                    "041": "Douglas County",
                    "043": "DuPage County",
                    "045": "Edgar County",
                    "047": "Edwards County",
                    "049": "Effingham County",
                    "051": "Fayette County",
                    "053": "Ford County",
                    "055": "Franklin County",
                    "057": "Fulton County",
                    "059": "Gallatin County",
                    "061": "Greene County",
                    "063": "Grundy County",
                    "065": "Hamilton County",
                    "067": "Hancock County",
                    "069": "Hardin County",
                    "071": "Henderson County",
                    "073": "Henry County",
                    "075": "Iroquois County",
                    "077": "Jackson County",
                    "079": "Jasper County",
                    "081": "Jefferson County",
                    "083": "Jersey County",
                    "085": "Jo Daviess County",
                    "087": "Johnson County",
                    "089": "Kane County",
                    "091": "Kankakee County",
                    "093": "Kendall County",
                    "095": "Knox County",
                    "097": "Lake County",
                    "099": "LaSalle County",
                    "101": "Lawrence County",
                    "103": "Lee County",
                    "105": "Livingston County",
                    "107": "Logan County",
                    "109": "McDonough County",
                    "111": "McHenry County",
                    "113": "McLean County",
                    "115": "Macon County",
                    "117": "Macoupin County",
                    "119": "Madison County",
                    "121": "Marion County",
                    "123": "Marshall County",
                    "125": "Mason County",
                    "127": "Massac County",
                    "129": "Menard County",
                    "131": "Mercer County",
                    "133": "Monroe County",
                    "135": "Montgomery County",
                    "137": "Morgan County",
                    "139": "Moultrie County",
                    "141": "Ogle County",
                    "143": "Peoria County",
                    "145": "Perry County",
                    "147": "Piatt County",
                    "149": "Pike County",
                    "151": "Pope County",
                    "153": "Pulaski County",
                    "155": "Putnam County",
                    "157": "Randolph County",
                    "159": "Richland County",
                    "161": "Rock Island County",
                    "163": "St. Clair County",
                    "165": "Saline County",
                    "167": "Sangamon County",
                    "169": "Schuyler County",
                    "171": "Scott County",
                    "173": "Shelby County",
                    "175": "Stark County",
                    "177": "Stephenson County",
                    "179": "Tazewell County",
                    "181": "Union County",
                    "183": "Vermilion County",
                    "185": "Wabash County",
                    "187": "Warren County",
                    "189": "Washington County",
                    "191": "Wayne County",
                    "193": "White County",
                    "195": "Whiteside County",
                    "197": "Will County",
                    "199": "Williamson County",
                    "201": "Winnebago County",
                    "203": "Woodford County"
                },
                "18": {
                    "001": "Adams County",
                    "003": "Allen County",
                    "005": "Bartholomew County",
                    "007": "Benton County",
                    "009": "Blackford County",
                    "011": "Boone County",
                    "013": "Brown County",
                    "015": "Carroll County",
                    "017": "Cass County",
                    "019": "Clark County",
                    "021": "Clay County",
                    "023": "Clinton County",
                    "025": "Crawford County",
                    "027": "Daviess County",
                    "029": "Dearborn County",
                    "031": "Decatur County",
                    "033": "DeKalb County",
                    "035": "Delaware County",
                    "037": "Dubois County",
                    "039": "Elkhart County",
                    "041": "Fayette County",
                    "043": "Floyd County",
                    "045": "Fountain County",
                    "047": "Franklin County",
                    "049": "Fulton County",
                    "051": "Gibson County",
                    "053": "Grant County",
                    "055": "Greene County",
                    "057": "Hamilton County",
                    "059": "Hancock County",
                    "061": "Harrison County",
                    "063": "Hendricks County",
                    "065": "Henry County",
                    "067": "Howard County",
                    "069": "Huntington County",
                    "071": "Jackson County",
                    "073": "Jasper County",
                    "075": "Jay County",
                    "077": "Jefferson County",
                    "079": "Jennings County",
                    "081": "Johnson County",
                    "083": "Knox County",
                    "085": "Kosciusko County",
                    "087": "LaGrange County",
                    "089": "Lake County",
                    "091": "LaPorte County",
                    "093": "Lawrence County",
                    "095": "Madison County",
                    "097": "Marion County",
                    "099": "Marshall County",
                    "101": "Martin County",
                    "103": "Miami County",
                    "105": "Monroe County",
                    "107": "Montgomery County",
                    "109": "Morgan County",
                    "111": "Newton County",
                    "113": "Noble County",
                    "115": "Ohio County",
                    "117": "Orange County",
                    "119": "Owen County",
                    "121": "Parke County",
                    "123": "Perry County",
                    "125": "Pike County",
                    "127": "Porter County",
                    "129": "Posey County",
                    "131": "Pulaski County",
                    "133": "Putnam County",
                    "135": "Randolph County",
                    "137": "Ripley County",
                    "139": "Rush County",
                    "141": "St. Joseph County",
                    "143": "Scott County",
                    "145": "Shelby County",
                    "147": "Spencer County",
                    "149": "Starke County",
                    "151": "Steuben County",
                    "153": "Sullivan County",
                    "155": "Switzerland County",
                    "157": "Tippecanoe County",
                    "159": "Tipton County",
                    "161": "Union County",
                    "163": "Vanderburgh County",
                    "165": "Vermillion County",
                    "167": "Vigo County",
                    "169": "Wabash County",
                    "171": "Warren County",
                    "173": "Warrick County",
                    "175": "Washington County",
                    "177": "Wayne County",
                    "179": "Wells County",
                    "181": "White County",
                    "183": "Whitley County"
                },
                "19": {
                    "001": "Adair County",
                    "003": "Adams County",
                    "005": "Allamakee County",
                    "007": "Appanoose County",
                    "009": "Audubon County",
                    "011": "Benton County",
                    "013": "Black Hawk County",
                    "015": "Boone County",
                    "017": "Bremer County",
                    "019": "Buchanan County",
                    "021": "Buena Vista County",
                    "023": "Butler County",
                    "025": "Calhoun County",
                    "027": "Carroll County",
                    "029": "Cass County",
                    "031": "Cedar County",
                    "033": "Cerro Gordo County",
                    "035": "Cherokee County",
                    "037": "Chickasaw County",
                    "039": "Clarke County",
                    "041": "Clay County",
                    "043": "Clayton County",
                    "045": "Clinton County",
                    "047": "Crawford County",
                    "049": "Dallas County",
                    "051": "Davis County",
                    "053": "Decatur County",
                    "055": "Delaware County",
                    "057": "Des Moines County",
                    "059": "Dickinson County",
                    "061": "Dubuque County",
                    "063": "Emmet County",
                    "065": "Fayette County",
                    "067": "Floyd County",
                    "069": "Franklin County",
                    "071": "Fremont County",
                    "073": "Greene County",
                    "075": "Grundy County",
                    "077": "Guthrie County",
                    "079": "Hamilton County",
                    "081": "Hancock County",
                    "083": "Hardin County",
                    "085": "Harrison County",
                    "087": "Henry County",
                    "089": "Howard County",
                    "091": "Humboldt County",
                    "093": "Ida County",
                    "095": "Iowa County",
                    "097": "Jackson County",
                    "099": "Jasper County",
                    "101": "Jefferson County",
                    "103": "Johnson County",
                    "105": "Jones County",
                    "107": "Keokuk County",
                    "109": "Kossuth County",
                    "111": "Lee County",
                    "113": "Linn County",
                    "115": "Louisa County",
                    "117": "Lucas County",
                    "119": "Lyon County",
                    "121": "Madison County",
                    "123": "Mahaska County",
                    "125": "Marion County",
                    "127": "Marshall County",
                    "129": "Mills County",
                    "131": "Mitchell County",
                    "133": "Monona County",
                    "135": "Monroe County",
                    "137": "Montgomery County",
                    "139": "Muscatine County",
                    "141": "O'Brien County",
                    "143": "Osceola County",
                    "145": "Page County",
                    "147": "Palo Alto County",
                    "149": "Plymouth County",
                    "151": "Pocahontas County",
                    "153": "Polk County",
                    "155": "Pottawattamie County",
                    "157": "Poweshiek County",
                    "159": "Ringgold County",
                    "161": "Sac County",
                    "163": "Scott County",
                    "165": "Shelby County",
                    "167": "Sioux County",
                    "169": "Story County",
                    "171": "Tama County",
                    "173": "Taylor County",
                    "175": "Union County",
                    "177": "Van Buren County",
                    "179": "Wapello County",
                    "181": "Warren County",
                    "183": "Washington County",
                    "185": "Wayne County",
                    "187": "Webster County",
                    "189": "Winnebago County",
                    "191": "Winneshiek County",
                    "193": "Woodbury County",
                    "195": "Worth County",
                    "197": "Wright County"
                },
                "20": {
                    "001": "Allen County",
                    "003": "Anderson County",
                    "005": "Atchison County",
                    "007": "Barber County",
                    "009": "Barton County",
                    "011": "Bourbon County",
                    "013": "Brown County",
                    "015": "Butler County",
                    "017": "Chase County",
                    "019": "Chautauqua County",
                    "021": "Cherokee County",
                    "023": "Cheyenne County",
                    "025": "Clark County",
                    "027": "Clay County",
                    "029": "Cloud County",
                    "031": "Coffey County",
                    "033": "Comanche County",
                    "035": "Cowley County",
                    "037": "Crawford County",
                    "039": "Decatur County",
                    "041": "Dickinson County",
                    "043": "Doniphan County",
                    "045": "Douglas County",
                    "047": "Edwards County",
                    "049": "Elk County",
                    "051": "Ellis County",
                    "053": "Ellsworth County",
                    "055": "Finney County",
                    "057": "Ford County",
                    "059": "Franklin County",
                    "061": "Geary County",
                    "063": "Gove County",
                    "065": "Graham County",
                    "067": "Grant County",
                    "069": "Gray County",
                    "071": "Greeley County",
                    "073": "Greenwood County",
                    "075": "Hamilton County",
                    "077": "Harper County",
                    "079": "Harvey County",
                    "081": "Haskell County",
                    "083": "Hodgeman County",
                    "085": "Jackson County",
                    "087": "Jefferson County",
                    "089": "Jewell County",
                    "091": "Johnson County",
                    "093": "Kearny County",
                    "095": "Kingman County",
                    "097": "Kiowa County",
                    "099": "Labette County",
                    "101": "Lane County",
                    "103": "Leavenworth County",
                    "105": "Lincoln County",
                    "107": "Linn County",
                    "109": "Logan County",
                    "111": "Lyon County",
                    "113": "McPherson County",
                    "115": "Marion County",
                    "117": "Marshall County",
                    "119": "Meade County",
                    "121": "Miami County",
                    "123": "Mitchell County",
                    "125": "Montgomery County",
                    "127": "Morris County",
                    "129": "Morton County",
                    "131": "Nemaha County",
                    "133": "Neosho County",
                    "135": "Ness County",
                    "137": "Norton County",
                    "139": "Osage County",
                    "141": "Osborne County",
                    "143": "Ottawa County",
                    "145": "Pawnee County",
                    "147": "Phillips County",
                    "149": "Pottawatomie County",
                    "151": "Pratt County",
                    "153": "Rawlins County",
                    "155": "Reno County",
                    "157": "Republic County",
                    "159": "Rice County",
                    "161": "Riley County",
                    "163": "Rooks County",
                    "165": "Rush County",
                    "167": "Russell County",
                    "169": "Saline County",
                    "171": "Scott County",
                    "173": "Sedgwick County",
                    "175": "Seward County",
                    "177": "Shawnee County",
                    "179": "Sheridan County",
                    "181": "Sherman County",
                    "183": "Smith County",
                    "185": "Stafford County",
                    "187": "Stanton County",
                    "189": "Stevens County",
                    "191": "Sumner County",
                    "193": "Thomas County",
                    "195": "Trego County",
                    "197": "Wabaunsee County",
                    "199": "Wallace County",
                    "201": "Washington County",
                    "203": "Wichita County",
                    "205": "Wilson County",
                    "207": "Woodson County",
                    "209": "Wyandotte County"
                },
                "21": {
                    "001": "Adair County",
                    "003": "Allen County",
                    "005": "Anderson County",
                    "007": "Ballard County",
                    "009": "Barren County",
                    "011": "Bath County",
                    "013": "Bell County",
                    "015": "Boone County",
                    "017": "Bourbon County",
                    "019": "Boyd County",
                    "021": "Boyle County",
                    "023": "Bracken County",
                    "025": "Breathitt County",
                    "027": "Breckinridge County",
                    "029": "Bullitt County",
                    "031": "Butler County",
                    "033": "Caldwell County",
                    "035": "Calloway County",
                    "037": "Campbell County",
                    "039": "Carlisle County",
                    "041": "Carroll County",
                    "043": "Carter County",
                    "045": "Casey County",
                    "047": "Christian County",
                    "049": "Clark County",
                    "051": "Clay County",
                    "053": "Clinton County",
                    "055": "Crittenden County",
                    "057": "Cumberland County",
                    "059": "Daviess County",
                    "061": "Edmonson County",
                    "063": "Elliott County",
                    "065": "Estill County",
                    "067": "Fayette County",
                    "069": "Fleming County",
                    "071": "Floyd County",
                    "073": "Franklin County",
                    "075": "Fulton County",
                    "077": "Gallatin County",
                    "079": "Garrard County",
                    "081": "Grant County",
                    "083": "Graves County",
                    "085": "Grayson County",
                    "087": "Green County",
                    "089": "Greenup County",
                    "091": "Hancock County",
                    "093": "Hardin County",
                    "095": "Harlan County",
                    "097": "Harrison County",
                    "099": "Hart County",
                    "101": "Henderson County",
                    "103": "Henry County",
                    "105": "Hickman County",
                    "107": "Hopkins County",
                    "109": "Jackson County",
                    "111": "Jefferson County",
                    "113": "Jessamine County",
                    "115": "Johnson County",
                    "117": "Kenton County",
                    "119": "Knott County",
                    "121": "Knox County",
                    "123": "Larue County",
                    "125": "Laurel County",
                    "127": "Lawrence County",
                    "129": "Lee County",
                    "131": "Leslie County",
                    "133": "Letcher County",
                    "135": "Lewis County",
                    "137": "Lincoln County",
                    "139": "Livingston County",
                    "141": "Logan County",
                    "143": "Lyon County",
                    "145": "McCracken County",
                    "147": "McCreary County",
                    "149": "McLean County",
                    "151": "Madison County",
                    "153": "Magoffin County",
                    "155": "Marion County",
                    "157": "Marshall County",
                    "159": "Martin County",
                    "161": "Mason County",
                    "163": "Meade County",
                    "165": "Menifee County",
                    "167": "Mercer County",
                    "169": "Metcalfe County",
                    "171": "Monroe County",
                    "173": "Montgomery County",
                    "175": "Morgan County",
                    "177": "Muhlenberg County",
                    "179": "Nelson County",
                    "181": "Nicholas County",
                    "183": "Ohio County",
                    "185": "Oldham County",
                    "187": "Owen County",
                    "189": "Owsley County",
                    "191": "Pendleton County",
                    "193": "Perry County",
                    "195": "Pike County",
                    "197": "Powell County",
                    "199": "Pulaski County",
                    "201": "Robertson County",
                    "203": "Rockcastle County",
                    "205": "Rowan County",
                    "207": "Russell County",
                    "209": "Scott County",
                    "211": "Shelby County",
                    "213": "Simpson County",
                    "215": "Spencer County",
                    "217": "Taylor County",
                    "219": "Todd County",
                    "221": "Trigg County",
                    "223": "Trimble County",
                    "225": "Union County",
                    "227": "Warren County",
                    "229": "Washington County",
                    "231": "Wayne County",
                    "233": "Webster County",
                    "235": "Whitley County",
                    "237": "Wolfe County",
                    "239": "Woodford County"
                },
                "22": {
                    "001": "Acadia Parish",
                    "003": "Allen Parish",
                    "005": "Ascension Parish",
                    "007": "Assumption Parish",
                    "009": "Avoyelles Parish",
                    "011": "Beauregard Parish",
                    "013": "Bienville Parish",
                    "015": "Bossier Parish",
                    "017": "Caddo Parish",
                    "019": "Calcasieu Parish",
                    "021": "Caldwell Parish",
                    "023": "Cameron Parish",
                    "025": "Catahoula Parish",
                    "027": "Claiborne Parish",
                    "029": "Concordia Parish",
                    "031": "De Soto Parish",
                    "033": "East Baton Rouge Parish",
                    "035": "East Carroll Parish",
                    "037": "East Feliciana Parish",
                    "039": "Evangeline Parish",
                    "041": "Franklin Parish",
                    "043": "Grant Parish",
                    "045": "Iberia Parish",
                    "047": "Iberville Parish",
                    "049": "Jackson Parish",
                    "051": "Jefferson Parish",
                    "053": "Jefferson Davis Parish",
                    "055": "Lafayette Parish",
                    "057": "Lafourche Parish",
                    "059": "La Salle Parish",
                    "061": "Lincoln Parish",
                    "063": "Livingston Parish",
                    "065": "Madison Parish",
                    "067": "Morehouse Parish",
                    "069": "Natchitoches Parish",
                    "071": "Orleans Parish",
                    "073": "Ouachita Parish",
                    "075": "Plaquemines Parish",
                    "077": "Pointe Coupee Parish",
                    "079": "Rapides Parish",
                    "081": "Red River Parish",
                    "083": "Richland Parish",
                    "085": "Sabine Parish",
                    "087": "St. Bernard Parish",
                    "089": "St. Charles Parish",
                    "091": "St. Helena Parish",
                    "093": "St. James Parish",
                    "095": "St. John the Baptist Parish",
                    "097": "St. Landry Parish",
                    "099": "St. Martin Parish",
                    "101": "St. Mary Parish",
                    "103": "St. Tammany Parish",
                    "105": "Tangipahoa Parish",
                    "107": "Tensas Parish",
                    "109": "Terrebonne Parish",
                    "111": "Union Parish",
                    "113": "Vermilion Parish",
                    "115": "Vernon Parish",
                    "117": "Washington Parish",
                    "119": "Webster Parish",
                    "121": "West Baton Rouge Parish",
                    "123": "West Carroll Parish",
                    "125": "West Feliciana Parish",
                    "127": "Winn Parish"
                },
                "23": {
                    "001": "Androscoggin County",
                    "003": "Aroostook County",
                    "005": "Cumberland County",
                    "007": "Franklin County",
                    "009": "Hancock County",
                    "011": "Kennebec County",
                    "013": "Knox County",
                    "015": "Lincoln County",
                    "017": "Oxford County",
                    "019": "Penobscot County",
                    "021": "Piscataquis County",
                    "023": "Sagadahoc County",
                    "025": "Somerset County",
                    "027": "Waldo County",
                    "029": "Washington County",
                    "031": "York County"
                },
                "24": {
                    "001": "Allegany County",
                    "003": "Anne Arundel County",
                    "005": "Baltimore County",
                    "009": "Calvert County",
                    "011": "Caroline County",
                    "013": "Carroll County",
                    "015": "Cecil County",
                    "017": "Charles County",
                    "019": "Dorchester County",
                    "021": "Frederick County",
                    "023": "Garrett County",
                    "025": "Harford County",
                    "027": "Howard County",
                    "029": "Kent County",
                    "031": "Montgomery County",
                    "033": "Prince George's County",
                    "035": "Queen Anne's County",
                    "037": "St. Mary's County",
                    "039": "Somerset County",
                    "041": "Talbot County",
                    "043": "Washington County",
                    "045": "Wicomico County",
                    "047": "Worcester County",
                    "510": "Baltimore city"
                },
                "25": {
                    "001": "Barnstable County",
                    "003": "Berkshire County",
                    "005": "Bristol County",
                    "007": "Dukes County",
                    "009": "Essex County",
                    "011": "Franklin County",
                    "013": "Hampden County",
                    "015": "Hampshire County",
                    "017": "Middlesex County",
                    "019": "Nantucket County",
                    "021": "Norfolk County",
                    "023": "Plymouth County",
                    "025": "Suffolk County",
                    "027": "Worcester County"
                },
                "26": {
                    "001": "Alcona County",
                    "003": "Alger County",
                    "005": "Allegan County",
                    "007": "Alpena County",
                    "009": "Antrim County",
                    "011": "Arenac County",
                    "013": "Baraga County",
                    "015": "Barry County",
                    "017": "Bay County",
                    "019": "Benzie County",
                    "021": "Berrien County",
                    "023": "Branch County",
                    "025": "Calhoun County",
                    "027": "Cass County",
                    "029": "Charlevoix County",
                    "031": "Cheboygan County",
                    "033": "Chippewa County",
                    "035": "Clare County",
                    "037": "Clinton County",
                    "039": "Crawford County",
                    "041": "Delta County",
                    "043": "Dickinson County",
                    "045": "Eaton County",
                    "047": "Emmet County",
                    "049": "Genesee County",
                    "051": "Gladwin County",
                    "053": "Gogebic County",
                    "055": "Grand Traverse County",
                    "057": "Gratiot County",
                    "059": "Hillsdale County",
                    "061": "Houghton County",
                    "063": "Huron County",
                    "065": "Ingham County",
                    "067": "Ionia County",
                    "069": "Iosco County",
                    "071": "Iron County",
                    "073": "Isabella County",
                    "075": "Jackson County",
                    "077": "Kalamazoo County",
                    "079": "Kalkaska County",
                    "081": "Kent County",
                    "083": "Keweenaw County",
                    "085": "Lake County",
                    "087": "Lapeer County",
                    "089": "Leelanau County",
                    "091": "Lenawee County",
                    "093": "Livingston County",
                    "095": "Luce County",
                    "097": "Mackinac County",
                    "099": "Macomb County",
                    "101": "Manistee County",
                    "103": "Marquette County",
                    "105": "Mason County",
                    "107": "Mecosta County",
                    "109": "Menominee County",
                    "111": "Midland County",
                    "113": "Missaukee County",
                    "115": "Monroe County",
                    "117": "Montcalm County",
                    "119": "Montmorency County",
                    "121": "Muskegon County",
                    "123": "Newaygo County",
                    "125": "Oakland County",
                    "127": "Oceana County",
                    "129": "Ogemaw County",
                    "131": "Ontonagon County",
                    "133": "Osceola County",
                    "135": "Oscoda County",
                    "137": "Otsego County",
                    "139": "Ottawa County",
                    "141": "Presque Isle County",
                    "143": "Roscommon County",
                    "145": "Saginaw County",
                    "147": "St. Clair County",
                    "149": "St. Joseph County",
                    "151": "Sanilac County",
                    "153": "Schoolcraft County",
                    "155": "Shiawassee County",
                    "157": "Tuscola County",
                    "159": "Van Buren County",
                    "161": "Washtenaw County",
                    "163": "Wayne County",
                    "165": "Wexford County"
                },
                "27": {
                    "001": "Aitkin County",
                    "003": "Anoka County",
                    "005": "Becker County",
                    "007": "Beltrami County",
                    "009": "Benton County",
                    "011": "Big Stone County",
                    "013": "Blue Earth County",
                    "015": "Brown County",
                    "017": "Carlton County",
                    "019": "Carver County",
                    "021": "Cass County",
                    "023": "Chippewa County",
                    "025": "Chisago County",
                    "027": "Clay County",
                    "029": "Clearwater County",
                    "031": "Cook County",
                    "033": "Cottonwood County",
                    "035": "Crow Wing County",
                    "037": "Dakota County",
                    "039": "Dodge County",
                    "041": "Douglas County",
                    "043": "Faribault County",
                    "045": "Fillmore County",
                    "047": "Freeborn County",
                    "049": "Goodhue County",
                    "051": "Grant County",
                    "053": "Hennepin County",
                    "055": "Houston County",
                    "057": "Hubbard County",
                    "059": "Isanti County",
                    "061": "Itasca County",
                    "063": "Jackson County",
                    "065": "Kanabec County",
                    "067": "Kandiyohi County",
                    "069": "Kittson County",
                    "071": "Koochiching County",
                    "073": "Lac qui Parle County",
                    "075": "Lake County",
                    "077": "Lake of the Woods County",
                    "079": "Le Sueur County",
                    "081": "Lincoln County",
                    "083": "Lyon County",
                    "085": "McLeod County",
                    "087": "Mahnomen County",
                    "089": "Marshall County",
                    "091": "Martin County",
                    "093": "Meeker County",
                    "095": "Mille Lacs County",
                    "097": "Morrison County",
                    "099": "Mower County",
                    "101": "Murray County",
                    "103": "Nicollet County",
                    "105": "Nobles County",
                    "107": "Norman County",
                    "109": "Olmsted County",
                    "111": "Otter Tail County",
                    "113": "Pennington County",
                    "115": "Pine County",
                    "117": "Pipestone County",
                    "119": "Polk County",
                    "121": "Pope County",
                    "123": "Ramsey County",
                    "125": "Red Lake County",
                    "127": "Redwood County",
                    "129": "Renville County",
                    "131": "Rice County",
                    "133": "Rock County",
                    "135": "Roseau County",
                    "137": "St. Louis County",
                    "139": "Scott County",
                    "141": "Sherburne County",
                    "143": "Sibley County",
                    "145": "Stearns County",
                    "147": "Steele County",
                    "149": "Stevens County",
                    "151": "Swift County",
                    "153": "Todd County",
                    "155": "Traverse County",
                    "157": "Wabasha County",
                    "159": "Wadena County",
                    "161": "Waseca County",
                    "163": "Washington County",
                    "165": "Watonwan County",
                    "167": "Wilkin County",
                    "169": "Winona County",
                    "171": "Wright County",
                    "173": "Yellow Medicine County"
                },
                "28": {
                    "001": "Adams County",
                    "003": "Alcorn County",
                    "005": "Amite County",
                    "007": "Attala County",
                    "009": "Benton County",
                    "011": "Bolivar County",
                    "013": "Calhoun County",
                    "015": "Carroll County",
                    "017": "Chickasaw County",
                    "019": "Choctaw County",
                    "021": "Claiborne County",
                    "023": "Clarke County",
                    "025": "Clay County",
                    "027": "Coahoma County",
                    "029": "Copiah County",
                    "031": "Covington County",
                    "033": "DeSoto County",
                    "035": "Forrest County",
                    "037": "Franklin County",
                    "039": "George County",
                    "041": "Greene County",
                    "043": "Grenada County",
                    "045": "Hancock County",
                    "047": "Harrison County",
                    "049": "Hinds County",
                    "051": "Holmes County",
                    "053": "Humphreys County",
                    "055": "Issaquena County",
                    "057": "Itawamba County",
                    "059": "Jackson County",
                    "061": "Jasper County",
                    "063": "Jefferson County",
                    "065": "Jefferson Davis County",
                    "067": "Jones County",
                    "069": "Kemper County",
                    "071": "Lafayette County",
                    "073": "Lamar County",
                    "075": "Lauderdale County",
                    "077": "Lawrence County",
                    "079": "Leake County",
                    "081": "Lee County",
                    "083": "Leflore County",
                    "085": "Lincoln County",
                    "087": "Lowndes County",
                    "089": "Madison County",
                    "091": "Marion County",
                    "093": "Marshall County",
                    "095": "Monroe County",
                    "097": "Montgomery County",
                    "099": "Neshoba County",
                    "101": "Newton County",
                    "103": "Noxubee County",
                    "105": "Oktibbeha County",
                    "107": "Panola County",
                    "109": "Pearl River County",
                    "111": "Perry County",
                    "113": "Pike County",
                    "115": "Pontotoc County",
                    "117": "Prentiss County",
                    "119": "Quitman County",
                    "121": "Rankin County",
                    "123": "Scott County",
                    "125": "Sharkey County",
                    "127": "Simpson County",
                    "129": "Smith County",
                    "131": "Stone County",
                    "133": "Sunflower County",
                    "135": "Tallahatchie County",
                    "137": "Tate County",
                    "139": "Tippah County",
                    "141": "Tishomingo County",
                    "143": "Tunica County",
                    "145": "Union County",
                    "147": "Walthall County",
                    "149": "Warren County",
                    "151": "Washington County",
                    "153": "Wayne County",
                    "155": "Webster County",
                    "157": "Wilkinson County",
                    "159": "Winston County",
                    "161": "Yalobusha County",
                    "163": "Yazoo County"
                },
                "29": {
                    "001": "Adair County",
                    "003": "Andrew County",
                    "005": "Atchison County",
                    "007": "Audrain County",
                    "009": "Barry County",
                    "011": "Barton County",
                    "013": "Bates County",
                    "015": "Benton County",
                    "017": "Bollinger County",
                    "019": "Boone County",
                    "021": "Buchanan County",
                    "023": "Butler County",
                    "025": "Caldwell County",
                    "027": "Callaway County",
                    "029": "Camden County",
                    "031": "Cape Girardeau County",
                    "033": "Carroll County",
                    "035": "Carter County",
                    "037": "Cass County",
                    "039": "Cedar County",
                    "041": "Chariton County",
                    "043": "Christian County",
                    "045": "Clark County",
                    "047": "Clay County",
                    "049": "Clinton County",
                    "051": "Cole County",
                    "053": "Cooper County",
                    "055": "Crawford County",
                    "057": "Dade County",
                    "059": "Dallas County",
                    "061": "Daviess County",
                    "063": "DeKalb County",
                    "065": "Dent County",
                    "067": "Douglas County",
                    "069": "Dunklin County",
                    "071": "Franklin County",
                    "073": "Gasconade County",
                    "075": "Gentry County",
                    "077": "Greene County",
                    "079": "Grundy County",
                    "081": "Harrison County",
                    "083": "Henry County",
                    "085": "Hickory County",
                    "087": "Holt County",
                    "089": "Howard County",
                    "091": "Howell County",
                    "093": "Iron County",
                    "095": "Jackson County",
                    "097": "Jasper County",
                    "099": "Jefferson County",
                    "101": "Johnson County",
                    "103": "Knox County",
                    "105": "Laclede County",
                    "107": "Lafayette County",
                    "109": "Lawrence County",
                    "111": "Lewis County",
                    "113": "Lincoln County",
                    "115": "Linn County",
                    "117": "Livingston County",
                    "119": "McDonald County",
                    "121": "Macon County",
                    "123": "Madison County",
                    "125": "Maries County",
                    "127": "Marion County",
                    "129": "Mercer County",
                    "131": "Miller County",
                    "133": "Mississippi County",
                    "135": "Moniteau County",
                    "137": "Monroe County",
                    "139": "Montgomery County",
                    "141": "Morgan County",
                    "143": "New Madrid County",
                    "145": "Newton County",
                    "147": "Nodaway County",
                    "149": "Oregon County",
                    "151": "Osage County",
                    "153": "Ozark County",
                    "155": "Pemiscot County",
                    "157": "Perry County",
                    "159": "Pettis County",
                    "161": "Phelps County",
                    "163": "Pike County",
                    "165": "Platte County",
                    "167": "Polk County",
                    "169": "Pulaski County",
                    "171": "Putnam County",
                    "173": "Ralls County",
                    "175": "Randolph County",
                    "177": "Ray County",
                    "179": "Reynolds County",
                    "181": "Ripley County",
                    "183": "St. Charles County",
                    "185": "St. Clair County",
                    "186": "Ste. Genevieve County",
                    "187": "St. Francois County",
                    "189": "St. Louis County",
                    "195": "Saline County",
                    "197": "Schuyler County",
                    "199": "Scotland County",
                    "201": "Scott County",
                    "203": "Shannon County",
                    "205": "Shelby County",
                    "207": "Stoddard County",
                    "209": "Stone County",
                    "211": "Sullivan County",
                    "213": "Taney County",
                    "215": "Texas County",
                    "217": "Vernon County",
                    "219": "Warren County",
                    "221": "Washington County",
                    "223": "Wayne County",
                    "225": "Webster County",
                    "227": "Worth County",
                    "229": "Wright County",
                    "510": "St. Louis city"
                },
                "30": {
                    "001": "Beaverhead County",
                    "003": "Big Horn County",
                    "005": "Blaine County",
                    "007": "Broadwater County",
                    "009": "Carbon County",
                    "011": "Carter County",
                    "013": "Cascade County",
                    "015": "Chouteau County",
                    "017": "Custer County",
                    "019": "Daniels County",
                    "021": "Dawson County",
                    "023": "Deer Lodge County",
                    "025": "Fallon County",
                    "027": "Fergus County",
                    "029": "Flathead County",
                    "031": "Gallatin County",
                    "033": "Garfield County",
                    "035": "Glacier County",
                    "037": "Golden Valley County",
                    "039": "Granite County",
                    "041": "Hill County",
                    "043": "Jefferson County",
                    "045": "Judith Basin County",
                    "047": "Lake County",
                    "049": "Lewis and Clark County",
                    "051": "Liberty County",
                    "053": "Lincoln County",
                    "055": "McCone County",
                    "057": "Madison County",
                    "059": "Meagher County",
                    "061": "Mineral County",
                    "063": "Missoula County",
                    "065": "Musselshell County",
                    "067": "Park County",
                    "069": "Petroleum County",
                    "071": "Phillips County",
                    "073": "Pondera County",
                    "075": "Powder River County",
                    "077": "Powell County",
                    "079": "Prairie County",
                    "081": "Ravalli County",
                    "083": "Richland County",
                    "085": "Roosevelt County",
                    "087": "Rosebud County",
                    "089": "Sanders County",
                    "091": "Sheridan County",
                    "093": "Silver Bow County",
                    "095": "Stillwater County",
                    "097": "Sweet Grass County",
                    "099": "Teton County",
                    "101": "Toole County",
                    "103": "Treasure County",
                    "105": "Valley County",
                    "107": "Wheatland County",
                    "109": "Wibaux County",
                    "111": "Yellowstone County"
                },
                "31": {
                    "001": "Adams County",
                    "003": "Antelope County",
                    "005": "Arthur County",
                    "007": "Banner County",
                    "009": "Blaine County",
                    "011": "Boone County",
                    "013": "Box Butte County",
                    "015": "Boyd County",
                    "017": "Brown County",
                    "019": "Buffalo County",
                    "021": "Burt County",
                    "023": "Butler County",
                    "025": "Cass County",
                    "027": "Cedar County",
                    "029": "Chase County",
                    "031": "Cherry County",
                    "033": "Cheyenne County",
                    "035": "Clay County",
                    "037": "Colfax County",
                    "039": "Cuming County",
                    "041": "Custer County",
                    "043": "Dakota County",
                    "045": "Dawes County",
                    "047": "Dawson County",
                    "049": "Deuel County",
                    "051": "Dixon County",
                    "053": "Dodge County",
                    "055": "Douglas County",
                    "057": "Dundy County",
                    "059": "Fillmore County",
                    "061": "Franklin County",
                    "063": "Frontier County",
                    "065": "Furnas County",
                    "067": "Gage County",
                    "069": "Garden County",
                    "071": "Garfield County",
                    "073": "Gosper County",
                    "075": "Grant County",
                    "077": "Greeley County",
                    "079": "Hall County",
                    "081": "Hamilton County",
                    "083": "Harlan County",
                    "085": "Hayes County",
                    "087": "Hitchcock County",
                    "089": "Holt County",
                    "091": "Hooker County",
                    "093": "Howard County",
                    "095": "Jefferson County",
                    "097": "Johnson County",
                    "099": "Kearney County",
                    "101": "Keith County",
                    "103": "Keya Paha County",
                    "105": "Kimball County",
                    "107": "Knox County",
                    "109": "Lancaster County",
                    "111": "Lincoln County",
                    "113": "Logan County",
                    "115": "Loup County",
                    "117": "McPherson County",
                    "119": "Madison County",
                    "121": "Merrick County",
                    "123": "Morrill County",
                    "125": "Nance County",
                    "127": "Nemaha County",
                    "129": "Nuckolls County",
                    "131": "Otoe County",
                    "133": "Pawnee County",
                    "135": "Perkins County",
                    "137": "Phelps County",
                    "139": "Pierce County",
                    "141": "Platte County",
                    "143": "Polk County",
                    "145": "Red Willow County",
                    "147": "Richardson County",
                    "149": "Rock County",
                    "151": "Saline County",
                    "153": "Sarpy County",
                    "155": "Saunders County",
                    "157": "Scotts Bluff County",
                    "159": "Seward County",
                    "161": "Sheridan County",
                    "163": "Sherman County",
                    "165": "Sioux County",
                    "167": "Stanton County",
                    "169": "Thayer County",
                    "171": "Thomas County",
                    "173": "Thurston County",
                    "175": "Valley County",
                    "177": "Washington County",
                    "179": "Wayne County",
                    "181": "Webster County",
                    "183": "Wheeler County",
                    "185": "York County"
                },
                "32": {
                    "001": "Churchill County",
                    "003": "Clark County",
                    "005": "Douglas County",
                    "007": "Elko County",
                    "009": "Esmeralda County",
                    "011": "Eureka County",
                    "013": "Humboldt County",
                    "015": "Lander County",
                    "017": "Lincoln County",
                    "019": "Lyon County",
                    "021": "Mineral County",
                    "023": "Nye County",
                    "027": "Pershing County",
                    "029": "Storey County",
                    "031": "Washoe County",
                    "033": "White Pine County",
                    "510": "Carson City"
                },
                "33": {
                    "001": "Belknap County",
                    "003": "Carroll County",
                    "005": "Cheshire County",
                    "007": "Coos County",
                    "009": "Grafton County",
                    "011": "Hillsborough County",
                    "013": "Merrimack County",
                    "015": "Rockingham County",
                    "017": "Strafford County",
                    "019": "Sullivan County"
                },
                "34": {
                    "001": "Atlantic County",
                    "003": "Bergen County",
                    "005": "Burlington County",
                    "007": "Camden County",
                    "009": "Cape May County",
                    "011": "Cumberland County",
                    "013": "Essex County",
                    "015": "Gloucester County",
                    "017": "Hudson County",
                    "019": "Hunterdon County",
                    "021": "Mercer County",
                    "023": "Middlesex County",
                    "025": "Monmouth County",
                    "027": "Morris County",
                    "029": "Ocean County",
                    "031": "Passaic County",
                    "033": "Salem County",
                    "035": "Somerset County",
                    "037": "Sussex County",
                    "039": "Union County",
                    "041": "Warren County"
                },
                "35": {
                    "001": "Bernalillo County",
                    "003": "Catron County",
                    "005": "Chaves County",
                    "006": "Cibola County",
                    "007": "Colfax County",
                    "009": "Curry County",
                    "011": "De Baca County",
                    "013": "Dona Ana County",
                    "015": "Eddy County",
                    "017": "Grant County",
                    "019": "Guadalupe County",
                    "021": "Harding County",
                    "023": "Hidalgo County",
                    "025": "Lea County",
                    "027": "Lincoln County",
                    "028": "Los Alamos County",
                    "029": "Luna County",
                    "031": "McKinley County",
                    "033": "Mora County",
                    "035": "Otero County",
                    "037": "Quay County",
                    "039": "Rio Arriba County",
                    "041": "Roosevelt County",
                    "043": "Sandoval County",
                    "045": "San Juan County",
                    "047": "San Miguel County",
                    "049": "Santa Fe County",
                    "051": "Sierra County",
                    "053": "Socorro County",
                    "055": "Taos County",
                    "057": "Torrance County",
                    "059": "Union County",
                    "061": "Valencia County"
                },
                "36": {
                    "001": "Albany County",
                    "003": "Allegany County",
                    "005": "Bronx County",
                    "007": "Broome County",
                    "009": "Cattaraugus County",
                    "011": "Cayuga County",
                    "013": "Chautauqua County",
                    "015": "Chemung County",
                    "017": "Chenango County",
                    "019": "Clinton County",
                    "021": "Columbia County",
                    "023": "Cortland County",
                    "025": "Delaware County",
                    "027": "Dutchess County",
                    "029": "Erie County",
                    "031": "Essex County",
                    "033": "Franklin County",
                    "035": "Fulton County",
                    "037": "Genesee County",
                    "039": "Greene County",
                    "041": "Hamilton County",
                    "043": "Herkimer County",
                    "045": "Jefferson County",
                    "047": "Kings County",
                    "049": "Lewis County",
                    "051": "Livingston County",
                    "053": "Madison County",
                    "055": "Monroe County",
                    "057": "Montgomery County",
                    "059": "Nassau County",
                    "061": "New York County",
                    "063": "Niagara County",
                    "065": "Oneida County",
                    "067": "Onondaga County",
                    "069": "Ontario County",
                    "071": "Orange County",
                    "073": "Orleans County",
                    "075": "Oswego County",
                    "077": "Otsego County",
                    "079": "Putnam County",
                    "081": "Queens County",
                    "083": "Rensselaer County",
                    "085": "Richmond County",
                    "087": "Rockland County",
                    "089": "St. Lawrence County",
                    "091": "Saratoga County",
                    "093": "Schenectady County",
                    "095": "Schoharie County",
                    "097": "Schuyler County",
                    "099": "Seneca County",
                    "101": "Steuben County",
                    "103": "Suffolk County",
                    "105": "Sullivan County",
                    "107": "Tioga County",
                    "109": "Tompkins County",
                    "111": "Ulster County",
                    "113": "Warren County",
                    "115": "Washington County",
                    "117": "Wayne County",
                    "119": "Westchester County",
                    "121": "Wyoming County",
                    "123": "Yates County"
                },
                "37": {
                    "001": "Alamance County",
                    "003": "Alexander County",
                    "005": "Alleghany County",
                    "007": "Anson County",
                    "009": "Ashe County",
                    "011": "Avery County",
                    "013": "Beaufort County",
                    "015": "Bertie County",
                    "017": "Bladen County",
                    "019": "Brunswick County",
                    "021": "Buncombe County",
                    "023": "Burke County",
                    "025": "Cabarrus County",
                    "027": "Caldwell County",
                    "029": "Camden County",
                    "031": "Carteret County",
                    "033": "Caswell County",
                    "035": "Catawba County",
                    "037": "Chatham County",
                    "039": "Cherokee County",
                    "041": "Chowan County",
                    "043": "Clay County",
                    "045": "Cleveland County",
                    "047": "Columbus County",
                    "049": "Craven County",
                    "051": "Cumberland County",
                    "053": "Currituck County",
                    "055": "Dare County",
                    "057": "Davidson County",
                    "059": "Davie County",
                    "061": "Duplin County",
                    "063": "Durham County",
                    "065": "Edgecombe County",
                    "067": "Forsyth County",
                    "069": "Franklin County",
                    "071": "Gaston County",
                    "073": "Gates County",
                    "075": "Graham County",
                    "077": "Granville County",
                    "079": "Greene County",
                    "081": "Guilford County",
                    "083": "Halifax County",
                    "085": "Harnett County",
                    "087": "Haywood County",
                    "089": "Henderson County",
                    "091": "Hertford County",
                    "093": "Hoke County",
                    "095": "Hyde County",
                    "097": "Iredell County",
                    "099": "Jackson County",
                    "101": "Johnston County",
                    "103": "Jones County",
                    "105": "Lee County",
                    "107": "Lenoir County",
                    "109": "Lincoln County",
                    "111": "McDowell County",
                    "113": "Macon County",
                    "115": "Madison County",
                    "117": "Martin County",
                    "119": "Mecklenburg County",
                    "121": "Mitchell County",
                    "123": "Montgomery County",
                    "125": "Moore County",
                    "127": "Nash County",
                    "129": "New Hanover County",
                    "131": "Northampton County",
                    "133": "Onslow County",
                    "135": "Orange County",
                    "137": "Pamlico County",
                    "139": "Pasquotank County",
                    "141": "Pender County",
                    "143": "Perquimans County",
                    "145": "Person County",
                    "147": "Pitt County",
                    "149": "Polk County",
                    "151": "Randolph County",
                    "153": "Richmond County",
                    "155": "Robeson County",
                    "157": "Rockingham County",
                    "159": "Rowan County",
                    "161": "Rutherford County",
                    "163": "Sampson County",
                    "165": "Scotland County",
                    "167": "Stanly County",
                    "169": "Stokes County",
                    "171": "Surry County",
                    "173": "Swain County",
                    "175": "Transylvania County",
                    "177": "Tyrrell County",
                    "179": "Union County",
                    "181": "Vance County",
                    "183": "Wake County",
                    "185": "Warren County",
                    "187": "Washington County",
                    "189": "Watauga County",
                    "191": "Wayne County",
                    "193": "Wilkes County",
                    "195": "Wilson County",
                    "197": "Yadkin County",
                    "199": "Yancey County"
                },
                "38": {
                    "001": "Adams County",
                    "003": "Barnes County",
                    "005": "Benson County",
                    "007": "Billings County",
                    "009": "Bottineau County",
                    "011": "Bowman County",
                    "013": "Burke County",
                    "015": "Burleigh County",
                    "017": "Cass County",
                    "019": "Cavalier County",
                    "021": "Dickey County",
                    "023": "Divide County",
                    "025": "Dunn County",
                    "027": "Eddy County",
                    "029": "Emmons County",
                    "031": "Foster County",
                    "033": "Golden Valley County",
                    "035": "Grand Forks County",
                    "037": "Grant County",
                    "039": "Griggs County",
                    "041": "Hettinger County",
                    "043": "Kidder County",
                    "045": "LaMoure County",
                    "047": "Logan County",
                    "049": "McHenry County",
                    "051": "McIntosh County",
                    "053": "McKenzie County",
                    "055": "McLean County",
                    "057": "Mercer County",
                    "059": "Morton County",
                    "061": "Mountrail County",
                    "063": "Nelson County",
                    "065": "Oliver County",
                    "067": "Pembina County",
                    "069": "Pierce County",
                    "071": "Ramsey County",
                    "073": "Ransom County",
                    "075": "Renville County",
                    "077": "Richland County",
                    "079": "Rolette County",
                    "081": "Sargent County",
                    "083": "Sheridan County",
                    "085": "Sioux County",
                    "087": "Slope County",
                    "089": "Stark County",
                    "091": "Steele County",
                    "093": "Stutsman County",
                    "095": "Towner County",
                    "097": "Traill County",
                    "099": "Walsh County",
                    "101": "Ward County",
                    "103": "Wells County",
                    "105": "Williams County"
                },
                "39": {
                    "001": "Adams County",
                    "003": "Allen County",
                    "005": "Ashland County",
                    "007": "Ashtabula County",
                    "009": "Athens County",
                    "011": "Auglaize County",
                    "013": "Belmont County",
                    "015": "Brown County",
                    "017": "Butler County",
                    "019": "Carroll County",
                    "021": "Champaign County",
                    "023": "Clark County",
                    "025": "Clermont County",
                    "027": "Clinton County",
                    "029": "Columbiana County",
                    "031": "Coshocton County",
                    "033": "Crawford County",
                    "035": "Cuyahoga County",
                    "037": "Darke County",
                    "039": "Defiance County",
                    "041": "Delaware County",
                    "043": "Erie County",
                    "045": "Fairfield County",
                    "047": "Fayette County",
                    "049": "Franklin County",
                    "051": "Fulton County",
                    "053": "Gallia County",
                    "055": "Geauga County",
                    "057": "Greene County",
                    "059": "Guernsey County",
                    "061": "Hamilton County",
                    "063": "Hancock County",
                    "065": "Hardin County",
                    "067": "Harrison County",
                    "069": "Henry County",
                    "071": "Highland County",
                    "073": "Hocking County",
                    "075": "Holmes County",
                    "077": "Huron County",
                    "079": "Jackson County",
                    "081": "Jefferson County",
                    "083": "Knox County",
                    "085": "Lake County",
                    "087": "Lawrence County",
                    "089": "Licking County",
                    "091": "Logan County",
                    "093": "Lorain County",
                    "095": "Lucas County",
                    "097": "Madison County",
                    "099": "Mahoning County",
                    "101": "Marion County",
                    "103": "Medina County",
                    "105": "Meigs County",
                    "107": "Mercer County",
                    "109": "Miami County",
                    "111": "Monroe County",
                    "113": "Montgomery County",
                    "115": "Morgan County",
                    "117": "Morrow County",
                    "119": "Muskingum County",
                    "121": "Noble County",
                    "123": "Ottawa County",
                    "125": "Paulding County",
                    "127": "Perry County",
                    "129": "Pickaway County",
                    "131": "Pike County",
                    "133": "Portage County",
                    "135": "Preble County",
                    "137": "Putnam County",
                    "139": "Richland County",
                    "141": "Ross County",
                    "143": "Sandusky County",
                    "145": "Scioto County",
                    "147": "Seneca County",
                    "149": "Shelby County",
                    "151": "Stark County",
                    "153": "Summit County",
                    "155": "Trumbull County",
                    "157": "Tuscarawas County",
                    "159": "Union County",
                    "161": "Van Wert County",
                    "163": "Vinton County",
                    "165": "Warren County",
                    "167": "Washington County",
                    "169": "Wayne County",
                    "171": "Williams County",
                    "173": "Wood County",
                    "175": "Wyandot County"
                },
                "40": {
                    "001": "Adair County",
                    "003": "Alfalfa County",
                    "005": "Atoka County",
                    "007": "Beaver County",
                    "009": "Beckham County",
                    "011": "Blaine County",
                    "013": "Bryan County",
                    "015": "Caddo County",
                    "017": "Canadian County",
                    "019": "Carter County",
                    "021": "Cherokee County",
                    "023": "Choctaw County",
                    "025": "Cimarron County",
                    "027": "Cleveland County",
                    "029": "Coal County",
                    "031": "Comanche County",
                    "033": "Cotton County",
                    "035": "Craig County",
                    "037": "Creek County",
                    "039": "Custer County",
                    "041": "Delaware County",
                    "043": "Dewey County",
                    "045": "Ellis County",
                    "047": "Garfield County",
                    "049": "Garvin County",
                    "051": "Grady County",
                    "053": "Grant County",
                    "055": "Greer County",
                    "057": "Harmon County",
                    "059": "Harper County",
                    "061": "Haskell County",
                    "063": "Hughes County",
                    "065": "Jackson County",
                    "067": "Jefferson County",
                    "069": "Johnston County",
                    "071": "Kay County",
                    "073": "Kingfisher County",
                    "075": "Kiowa County",
                    "077": "Latimer County",
                    "079": "Le Flore County",
                    "081": "Lincoln County",
                    "083": "Logan County",
                    "085": "Love County",
                    "087": "McClain County",
                    "089": "McCurtain County",
                    "091": "McIntosh County",
                    "093": "Major County",
                    "095": "Marshall County",
                    "097": "Mayes County",
                    "099": "Murray County",
                    "101": "Muskogee County",
                    "103": "Noble County",
                    "105": "Nowata County",
                    "107": "Okfuskee County",
                    "109": "Oklahoma County",
                    "111": "Okmulgee County",
                    "113": "Osage County",
                    "115": "Ottawa County",
                    "117": "Pawnee County",
                    "119": "Payne County",
                    "121": "Pittsburg County",
                    "123": "Pontotoc County",
                    "125": "Pottawatomie County",
                    "127": "Pushmataha County",
                    "129": "Roger Mills County",
                    "131": "Rogers County",
                    "133": "Seminole County",
                    "135": "Sequoyah County",
                    "137": "Stephens County",
                    "139": "Texas County",
                    "141": "Tillman County",
                    "143": "Tulsa County",
                    "145": "Wagoner County",
                    "147": "Washington County",
                    "149": "Washita County",
                    "151": "Woods County",
                    "153": "Woodward County"
                },
                "41": {
                    "001": "Baker County",
                    "003": "Benton County",
                    "005": "Clackamas County",
                    "007": "Clatsop County",
                    "009": "Columbia County",
                    "011": "Coos County",
                    "013": "Crook County",
                    "015": "Curry County",
                    "017": "Deschutes County",
                    "019": "Douglas County",
                    "021": "Gilliam County",
                    "023": "Grant County",
                    "025": "Harney County",
                    "027": "Hood River County",
                    "029": "Jackson County",
                    "031": "Jefferson County",
                    "033": "Josephine County",
                    "035": "Klamath County",
                    "037": "Lake County",
                    "039": "Lane County",
                    "041": "Lincoln County",
                    "043": "Linn County",
                    "045": "Malheur County",
                    "047": "Marion County",
                    "049": "Morrow County",
                    "051": "Multnomah County",
                    "053": "Polk County",
                    "055": "Sherman County",
                    "057": "Tillamook County",
                    "059": "Umatilla County",
                    "061": "Union County",
                    "063": "Wallowa County",
                    "065": "Wasco County",
                    "067": "Washington County",
                    "069": "Wheeler County",
                    "071": "Yamhill County"
                },
                "42": {
                    "001": "Adams County",
                    "003": "Allegheny County",
                    "005": "Armstrong County",
                    "007": "Beaver County",
                    "009": "Bedford County",
                    "011": "Berks County",
                    "013": "Blair County",
                    "015": "Bradford County",
                    "017": "Bucks County",
                    "019": "Butler County",
                    "021": "Cambria County",
                    "023": "Cameron County",
                    "025": "Carbon County",
                    "027": "Centre County",
                    "029": "Chester County",
                    "031": "Clarion County",
                    "033": "Clearfield County",
                    "035": "Clinton County",
                    "037": "Columbia County",
                    "039": "Crawford County",
                    "041": "Cumberland County",
                    "043": "Dauphin County",
                    "045": "Delaware County",
                    "047": "Elk County",
                    "049": "Erie County",
                    "051": "Fayette County",
                    "053": "Forest County",
                    "055": "Franklin County",
                    "057": "Fulton County",
                    "059": "Greene County",
                    "061": "Huntingdon County",
                    "063": "Indiana County",
                    "065": "Jefferson County",
                    "067": "Juniata County",
                    "069": "Lackawanna County",
                    "071": "Lancaster County",
                    "073": "Lawrence County",
                    "075": "Lebanon County",
                    "077": "Lehigh County",
                    "079": "Luzerne County",
                    "081": "Lycoming County",
                    "083": "McKean County",
                    "085": "Mercer County",
                    "087": "Mifflin County",
                    "089": "Monroe County",
                    "091": "Montgomery County",
                    "093": "Montour County",
                    "095": "Northampton County",
                    "097": "Northumberland County",
                    "099": "Perry County",
                    "101": "Philadelphia County",
                    "103": "Pike County",
                    "105": "Potter County",
                    "107": "Schuylkill County",
                    "109": "Snyder County",
                    "111": "Somerset County",
                    "113": "Sullivan County",
                    "115": "Susquehanna County",
                    "117": "Tioga County",
                    "119": "Union County",
                    "121": "Venango County",
                    "123": "Warren County",
                    "125": "Washington County",
                    "127": "Wayne County",
                    "129": "Westmoreland County",
                    "131": "Wyoming County",
                    "133": "York County"
                },
                "44": {
                    "001": "Bristol County",
                    "003": "Kent County",
                    "005": "Newport County",
                    "007": "Providence County",
                    "009": "Washington County"
                },
                "45": {
                    "001": "Abbeville County",
                    "003": "Aiken County",
                    "005": "Allendale County",
                    "007": "Anderson County",
                    "009": "Bamberg County",
                    "011": "Barnwell County",
                    "013": "Beaufort County",
                    "015": "Berkeley County",
                    "017": "Calhoun County",
                    "019": "Charleston County",
                    "021": "Cherokee County",
                    "023": "Chester County",
                    "025": "Chesterfield County",
                    "027": "Clarendon County",
                    "029": "Colleton County",
                    "031": "Darlington County",
                    "033": "Dillon County",
                    "035": "Dorchester County",
                    "037": "Edgefield County",
                    "039": "Fairfield County",
                    "041": "Florence County",
                    "043": "Georgetown County",
                    "045": "Greenville County",
                    "047": "Greenwood County",
                    "049": "Hampton County",
                    "051": "Horry County",
                    "053": "Jasper County",
                    "055": "Kershaw County",
                    "057": "Lancaster County",
                    "059": "Laurens County",
                    "061": "Lee County",
                    "063": "Lexington County",
                    "065": "McCormick County",
                    "067": "Marion County",
                    "069": "Marlboro County",
                    "071": "Newberry County",
                    "073": "Oconee County",
                    "075": "Orangeburg County",
                    "077": "Pickens County",
                    "079": "Richland County",
                    "081": "Saluda County",
                    "083": "Spartanburg County",
                    "085": "Sumter County",
                    "087": "Union County",
                    "089": "Williamsburg County",
                    "091": "York County"
                },
                "46": {
                    "003": "Aurora County",
                    "005": "Beadle County",
                    "007": "Bennett County",
                    "009": "Bon Homme County",
                    "011": "Brookings County",
                    "013": "Brown County",
                    "015": "Brule County",
                    "017": "Buffalo County",
                    "019": "Butte County",
                    "021": "Campbell County",
                    "023": "Charles Mix County",
                    "025": "Clark County",
                    "027": "Clay County",
                    "029": "Codington County",
                    "031": "Corson County",
                    "033": "Custer County",
                    "035": "Davison County",
                    "037": "Day County",
                    "039": "Deuel County",
                    "041": "Dewey County",
                    "043": "Douglas County",
                    "045": "Edmunds County",
                    "047": "Fall River County",
                    "049": "Faulk County",
                    "051": "Grant County",
                    "053": "Gregory County",
                    "055": "Haakon County",
                    "057": "Hamlin County",
                    "059": "Hand County",
                    "061": "Hanson County",
                    "063": "Harding County",
                    "065": "Hughes County",
                    "067": "Hutchinson County",
                    "069": "Hyde County",
                    "071": "Jackson County",
                    "073": "Jerauld County",
                    "075": "Jones County",
                    "077": "Kingsbury County",
                    "079": "Lake County",
                    "081": "Lawrence County",
                    "083": "Lincoln County",
                    "085": "Lyman County",
                    "087": "McCook County",
                    "089": "McPherson County",
                    "091": "Marshall County",
                    "093": "Meade County",
                    "095": "Mellette County",
                    "097": "Miner County",
                    "099": "Minnehaha County",
                    "101": "Moody County",
                    "103": "Pennington County",
                    "105": "Perkins County",
                    "107": "Potter County",
                    "109": "Roberts County",
                    "111": "Sanborn County",
                    "113": "Shannon County",
                    "115": "Spink County",
                    "117": "Stanley County",
                    "119": "Sully County",
                    "121": "Todd County",
                    "123": "Tripp County",
                    "125": "Turner County",
                    "127": "Union County",
                    "129": "Walworth County",
                    "135": "Yankton County",
                    "137": "Ziebach County"
                },
                "47": {
                    "001": "Anderson County",
                    "003": "Bedford County",
                    "005": "Benton County",
                    "007": "Bledsoe County",
                    "009": "Blount County",
                    "011": "Bradley County",
                    "013": "Campbell County",
                    "015": "Cannon County",
                    "017": "Carroll County",
                    "019": "Carter County",
                    "021": "Cheatham County",
                    "023": "Chester County",
                    "025": "Claiborne County",
                    "027": "Clay County",
                    "029": "Cocke County",
                    "031": "Coffee County",
                    "033": "Crockett County",
                    "035": "Cumberland County",
                    "037": "Davidson County",
                    "039": "Decatur County",
                    "041": "DeKalb County",
                    "043": "Dickson County",
                    "045": "Dyer County",
                    "047": "Fayette County",
                    "049": "Fentress County",
                    "051": "Franklin County",
                    "053": "Gibson County",
                    "055": "Giles County",
                    "057": "Grainger County",
                    "059": "Greene County",
                    "061": "Grundy County",
                    "063": "Hamblen County",
                    "065": "Hamilton County",
                    "067": "Hancock County",
                    "069": "Hardeman County",
                    "071": "Hardin County",
                    "073": "Hawkins County",
                    "075": "Haywood County",
                    "077": "Henderson County",
                    "079": "Henry County",
                    "081": "Hickman County",
                    "083": "Houston County",
                    "085": "Humphreys County",
                    "087": "Jackson County",
                    "089": "Jefferson County",
                    "091": "Johnson County",
                    "093": "Knox County",
                    "095": "Lake County",
                    "097": "Lauderdale County",
                    "099": "Lawrence County",
                    "101": "Lewis County",
                    "103": "Lincoln County",
                    "105": "Loudon County",
                    "107": "McMinn County",
                    "109": "McNairy County",
                    "111": "Macon County",
                    "113": "Madison County",
                    "115": "Marion County",
                    "117": "Marshall County",
                    "119": "Maury County",
                    "121": "Meigs County",
                    "123": "Monroe County",
                    "125": "Montgomery County",
                    "127": "Moore County",
                    "129": "Morgan County",
                    "131": "Obion County",
                    "133": "Overton County",
                    "135": "Perry County",
                    "137": "Pickett County",
                    "139": "Polk County",
                    "141": "Putnam County",
                    "143": "Rhea County",
                    "145": "Roane County",
                    "147": "Robertson County",
                    "149": "Rutherford County",
                    "151": "Scott County",
                    "153": "Sequatchie County",
                    "155": "Sevier County",
                    "157": "Shelby County",
                    "159": "Smith County",
                    "161": "Stewart County",
                    "163": "Sullivan County",
                    "165": "Sumner County",
                    "167": "Tipton County",
                    "169": "Trousdale County",
                    "171": "Unicoi County",
                    "173": "Union County",
                    "175": "Van Buren County",
                    "177": "Warren County",
                    "179": "Washington County",
                    "181": "Wayne County",
                    "183": "Weakley County",
                    "185": "White County",
                    "187": "Williamson County",
                    "189": "Wilson County"
                },
                "48": {
                    "001": "Anderson County",
                    "003": "Andrews County",
                    "005": "Angelina County",
                    "007": "Aransas County",
                    "009": "Archer County",
                    "011": "Armstrong County",
                    "013": "Atascosa County",
                    "015": "Austin County",
                    "017": "Bailey County",
                    "019": "Bandera County",
                    "021": "Bastrop County",
                    "023": "Baylor County",
                    "025": "Bee County",
                    "027": "Bell County",
                    "029": "Bexar County",
                    "031": "Blanco County",
                    "033": "Borden County",
                    "035": "Bosque County",
                    "037": "Bowie County",
                    "039": "Brazoria County",
                    "041": "Brazos County",
                    "043": "Brewster County",
                    "045": "Briscoe County",
                    "047": "Brooks County",
                    "049": "Brown County",
                    "051": "Burleson County",
                    "053": "Burnet County",
                    "055": "Caldwell County",
                    "057": "Calhoun County",
                    "059": "Callahan County",
                    "061": "Cameron County",
                    "063": "Camp County",
                    "065": "Carson County",
                    "067": "Cass County",
                    "069": "Castro County",
                    "071": "Chambers County",
                    "073": "Cherokee County",
                    "075": "Childress County",
                    "077": "Clay County",
                    "079": "Cochran County",
                    "081": "Coke County",
                    "083": "Coleman County",
                    "085": "Collin County",
                    "087": "Collingsworth County",
                    "089": "Colorado County",
                    "091": "Comal County",
                    "093": "Comanche County",
                    "095": "Concho County",
                    "097": "Cooke County",
                    "099": "Coryell County",
                    "101": "Cottle County",
                    "103": "Crane County",
                    "105": "Crockett County",
                    "107": "Crosby County",
                    "109": "Culberson County",
                    "111": "Dallam County",
                    "113": "Dallas County",
                    "115": "Dawson County",
                    "117": "Deaf Smith County",
                    "119": "Delta County",
                    "121": "Denton County",
                    "123": "DeWitt County",
                    "125": "Dickens County",
                    "127": "Dimmit County",
                    "129": "Donley County",
                    "131": "Duval County",
                    "133": "Eastland County",
                    "135": "Ector County",
                    "137": "Edwards County",
                    "139": "Ellis County",
                    "141": "El Paso County",
                    "143": "Erath County",
                    "145": "Falls County",
                    "147": "Fannin County",
                    "149": "Fayette County",
                    "151": "Fisher County",
                    "153": "Floyd County",
                    "155": "Foard County",
                    "157": "Fort Bend County",
                    "159": "Franklin County",
                    "161": "Freestone County",
                    "163": "Frio County",
                    "165": "Gaines County",
                    "167": "Galveston County",
                    "169": "Garza County",
                    "171": "Gillespie County",
                    "173": "Glasscock County",
                    "175": "Goliad County",
                    "177": "Gonzales County",
                    "179": "Gray County",
                    "181": "Grayson County",
                    "183": "Gregg County",
                    "185": "Grimes County",
                    "187": "Guadalupe County",
                    "189": "Hale County",
                    "191": "Hall County",
                    "193": "Hamilton County",
                    "195": "Hansford County",
                    "197": "Hardeman County",
                    "199": "Hardin County",
                    "201": "Harris County",
                    "203": "Harrison County",
                    "205": "Hartley County",
                    "207": "Haskell County",
                    "209": "Hays County",
                    "211": "Hemphill County",
                    "213": "Henderson County",
                    "215": "Hidalgo County",
                    "217": "Hill County",
                    "219": "Hockley County",
                    "221": "Hood County",
                    "223": "Hopkins County",
                    "225": "Houston County",
                    "227": "Howard County",
                    "229": "Hudspeth County",
                    "231": "Hunt County",
                    "233": "Hutchinson County",
                    "235": "Irion County",
                    "237": "Jack County",
                    "239": "Jackson County",
                    "241": "Jasper County",
                    "243": "Jeff Davis County",
                    "245": "Jefferson County",
                    "247": "Jim Hogg County",
                    "249": "Jim Wells County",
                    "251": "Johnson County",
                    "253": "Jones County",
                    "255": "Karnes County",
                    "257": "Kaufman County",
                    "259": "Kendall County",
                    "261": "Kenedy County",
                    "263": "Kent County",
                    "265": "Kerr County",
                    "267": "Kimble County",
                    "269": "King County",
                    "271": "Kinney County",
                    "273": "Kleberg County",
                    "275": "Knox County",
                    "277": "Lamar County",
                    "279": "Lamb County",
                    "281": "Lampasas County",
                    "283": "La Salle County",
                    "285": "Lavaca County",
                    "287": "Lee County",
                    "289": "Leon County",
                    "291": "Liberty County",
                    "293": "Limestone County",
                    "295": "Lipscomb County",
                    "297": "Live Oak County",
                    "299": "Llano County",
                    "301": "Loving County",
                    "303": "Lubbock County",
                    "305": "Lynn County",
                    "307": "McCulloch County",
                    "309": "McLennan County",
                    "311": "McMullen County",
                    "313": "Madison County",
                    "315": "Marion County",
                    "317": "Martin County",
                    "319": "Mason County",
                    "321": "Matagorda County",
                    "323": "Maverick County",
                    "325": "Medina County",
                    "327": "Menard County",
                    "329": "Midland County",
                    "331": "Milam County",
                    "333": "Mills County",
                    "335": "Mitchell County",
                    "337": "Montague County",
                    "339": "Montgomery County",
                    "341": "Moore County",
                    "343": "Morris County",
                    "345": "Motley County",
                    "347": "Nacogdoches County",
                    "349": "Navarro County",
                    "351": "Newton County",
                    "353": "Nolan County",
                    "355": "Nueces County",
                    "357": "Ochiltree County",
                    "359": "Oldham County",
                    "361": "Orange County",
                    "363": "Palo Pinto County",
                    "365": "Panola County",
                    "367": "Parker County",
                    "369": "Parmer County",
                    "371": "Pecos County",
                    "373": "Polk County",
                    "375": "Potter County",
                    "377": "Presidio County",
                    "379": "Rains County",
                    "381": "Randall County",
                    "383": "Reagan County",
                    "385": "Real County",
                    "387": "Red River County",
                    "389": "Reeves County",
                    "391": "Refugio County",
                    "393": "Roberts County",
                    "395": "Robertson County",
                    "397": "Rockwall County",
                    "399": "Runnels County",
                    "401": "Rusk County",
                    "403": "Sabine County",
                    "405": "San Augustine County",
                    "407": "San Jacinto County",
                    "409": "San Patricio County",
                    "411": "San Saba County",
                    "413": "Schleicher County",
                    "415": "Scurry County",
                    "417": "Shackelford County",
                    "419": "Shelby County",
                    "421": "Sherman County",
                    "423": "Smith County",
                    "425": "Somervell County",
                    "427": "Starr County",
                    "429": "Stephens County",
                    "431": "Sterling County",
                    "433": "Stonewall County",
                    "435": "Sutton County",
                    "437": "Swisher County",
                    "439": "Tarrant County",
                    "441": "Taylor County",
                    "443": "Terrell County",
                    "445": "Terry County",
                    "447": "Throckmorton County",
                    "449": "Titus County",
                    "451": "Tom Green County",
                    "453": "Travis County",
                    "455": "Trinity County",
                    "457": "Tyler County",
                    "459": "Upshur County",
                    "461": "Upton County",
                    "463": "Uvalde County",
                    "465": "Val Verde County",
                    "467": "Van Zandt County",
                    "469": "Victoria County",
                    "471": "Walker County",
                    "473": "Waller County",
                    "475": "Ward County",
                    "477": "Washington County",
                    "479": "Webb County",
                    "481": "Wharton County",
                    "483": "Wheeler County",
                    "485": "Wichita County",
                    "487": "Wilbarger County",
                    "489": "Willacy County",
                    "491": "Williamson County",
                    "493": "Wilson County",
                    "495": "Winkler County",
                    "497": "Wise County",
                    "499": "Wood County",
                    "501": "Yoakum County",
                    "503": "Young County",
                    "505": "Zapata County",
                    "507": "Zavala County"
                },
                "49": {
                    "001": "Beaver County",
                    "003": "Box Elder County",
                    "005": "Cache County",
                    "007": "Carbon County",
                    "009": "Daggett County",
                    "011": "Davis County",
                    "013": "Duchesne County",
                    "015": "Emery County",
                    "017": "Garfield County",
                    "019": "Grand County",
                    "021": "Iron County",
                    "023": "Juab County",
                    "025": "Kane County",
                    "027": "Millard County",
                    "029": "Morgan County",
                    "031": "Piute County",
                    "033": "Rich County",
                    "035": "Salt Lake County",
                    "037": "San Juan County",
                    "039": "Sanpete County",
                    "041": "Sevier County",
                    "043": "Summit County",
                    "045": "Tooele County",
                    "047": "Uintah County",
                    "049": "Utah County",
                    "051": "Wasatch County",
                    "053": "Washington County",
                    "055": "Wayne County",
                    "057": "Weber County"
                },
                "50": {
                    "001": "Addison County",
                    "003": "Bennington County",
                    "005": "Caledonia County",
                    "007": "Chittenden County",
                    "009": "Essex County",
                    "011": "Franklin County",
                    "013": "Grand Isle County",
                    "015": "Lamoille County",
                    "017": "Orange County",
                    "019": "Orleans County",
                    "021": "Rutland County",
                    "023": "Washington County",
                    "025": "Windham County",
                    "027": "Windsor County"
                },
                "51": {
                    "001": "Accomack County",
                    "003": "Albemarle County",
                    "005": "Alleghany County",
                    "007": "Amelia County",
                    "009": "Amherst County",
                    "011": "Appomattox County",
                    "013": "Arlington County",
                    "015": "Augusta County",
                    "017": "Bath County",
                    "019": "Bedford County",
                    "021": "Bland County",
                    "023": "Botetourt County",
                    "025": "Brunswick County",
                    "027": "Buchanan County",
                    "029": "Buckingham County",
                    "031": "Campbell County",
                    "033": "Caroline County",
                    "035": "Carroll County",
                    "036": "Charles City County",
                    "037": "Charlotte County",
                    "041": "Chesterfield County",
                    "043": "Clarke County",
                    "045": "Craig County",
                    "047": "Culpeper County",
                    "049": "Cumberland County",
                    "051": "Dickenson County",
                    "053": "Dinwiddie County",
                    "057": "Essex County",
                    "059": "Fairfax County",
                    "061": "Fauquier County",
                    "063": "Floyd County",
                    "065": "Fluvanna County",
                    "067": "Franklin County",
                    "069": "Frederick County",
                    "071": "Giles County",
                    "073": "Gloucester County",
                    "075": "Goochland County",
                    "077": "Grayson County",
                    "079": "Greene County",
                    "081": "Greensville County",
                    "083": "Halifax County",
                    "085": "Hanover County",
                    "087": "Henrico County",
                    "089": "Henry County",
                    "091": "Highland County",
                    "093": "Isle of Wight County",
                    "095": "James City County",
                    "097": "King and Queen County",
                    "099": "King George County",
                    "101": "King William County",
                    "103": "Lancaster County",
                    "105": "Lee County",
                    "107": "Loudoun County",
                    "109": "Louisa County",
                    "111": "Lunenburg County",
                    "113": "Madison County",
                    "115": "Mathews County",
                    "117": "Mecklenburg County",
                    "119": "Middlesex County",
                    "121": "Montgomery County",
                    "125": "Nelson County",
                    "127": "New Kent County",
                    "131": "Northampton County",
                    "133": "Northumberland County",
                    "135": "Nottoway County",
                    "137": "Orange County",
                    "139": "Page County",
                    "141": "Patrick County",
                    "143": "Pittsylvania County",
                    "145": "Powhatan County",
                    "147": "Prince Edward County",
                    "149": "Prince George County",
                    "153": "Prince William County",
                    "155": "Pulaski County",
                    "157": "Rappahannock County",
                    "159": "Richmond County",
                    "161": "Roanoke County",
                    "163": "Rockbridge County",
                    "165": "Rockingham County",
                    "167": "Russell County",
                    "169": "Scott County",
                    "171": "Shenandoah County",
                    "173": "Smyth County",
                    "175": "Southampton County",
                    "177": "Spotsylvania County",
                    "179": "Stafford County",
                    "181": "Surry County",
                    "183": "Sussex County",
                    "185": "Tazewell County",
                    "187": "Warren County",
                    "191": "Washington County",
                    "193": "Westmoreland County",
                    "195": "Wise County",
                    "197": "Wythe County",
                    "199": "York County",
                    "510": "Alexandria city",
                    "515": "Bedford city",
                    "520": "Bristol city",
                    "530": "Buena Vista city",
                    "540": "Charlottesville city",
                    "550": "Chesapeake city",
                    "570": "Colonial Heights city",
                    "580": "Covington city",
                    "590": "Danville city",
                    "595": "Emporia city",
                    "600": "Fairfax city",
                    "610": "Falls Church city",
                    "620": "Franklin city",
                    "630": "Fredericksburg city",
                    "640": "Galax city",
                    "650": "Hampton city",
                    "660": "Harrisonburg city",
                    "670": "Hopewell city",
                    "678": "Lexington city",
                    "680": "Lynchburg city",
                    "683": "Manassas city",
                    "685": "Manassas Park city",
                    "690": "Martinsville city",
                    "700": "Newport News city",
                    "710": "Norfolk city",
                    "720": "Norton city",
                    "730": "Petersburg city",
                    "735": "Poquoson city",
                    "740": "Portsmouth city",
                    "750": "Radford city",
                    "760": "Richmond city",
                    "770": "Roanoke city",
                    "775": "Salem city",
                    "790": "Staunton city",
                    "800": "Suffolk city",
                    "810": "Virginia Beach city",
                    "820": "Waynesboro city",
                    "830": "Williamsburg city",
                    "840": "Winchester city"
                },
                "53": {
                    "001": "Adams County",
                    "003": "Asotin County",
                    "005": "Benton County",
                    "007": "Chelan County",
                    "009": "Clallam County",
                    "011": "Clark County",
                    "013": "Columbia County",
                    "015": "Cowlitz County",
                    "017": "Douglas County",
                    "019": "Ferry County",
                    "021": "Franklin County",
                    "023": "Garfield County",
                    "025": "Grant County",
                    "027": "Grays Harbor County",
                    "029": "Island County",
                    "031": "Jefferson County",
                    "033": "King County",
                    "035": "Kitsap County",
                    "037": "Kittitas County",
                    "039": "Klickitat County",
                    "041": "Lewis County",
                    "043": "Lincoln County",
                    "045": "Mason County",
                    "047": "Okanogan County",
                    "049": "Pacific County",
                    "051": "Pend Oreille County",
                    "053": "Pierce County",
                    "055": "San Juan County",
                    "057": "Skagit County",
                    "059": "Skamania County",
                    "061": "Snohomish County",
                    "063": "Spokane County",
                    "065": "Stevens County",
                    "067": "Thurston County",
                    "069": "Wahkiakum County",
                    "071": "Walla Walla County",
                    "073": "Whatcom County",
                    "075": "Whitman County",
                    "077": "Yakima County"
                },
                "54": {
                    "001": "Barbour County",
                    "003": "Berkeley County",
                    "005": "Boone County",
                    "007": "Braxton County",
                    "009": "Brooke County",
                    "011": "Cabell County",
                    "013": "Calhoun County",
                    "015": "Clay County",
                    "017": "Doddridge County",
                    "019": "Fayette County",
                    "021": "Gilmer County",
                    "023": "Grant County",
                    "025": "Greenbrier County",
                    "027": "Hampshire County",
                    "029": "Hancock County",
                    "031": "Hardy County",
                    "033": "Harrison County",
                    "035": "Jackson County",
                    "037": "Jefferson County",
                    "039": "Kanawha County",
                    "041": "Lewis County",
                    "043": "Lincoln County",
                    "045": "Logan County",
                    "047": "McDowell County",
                    "049": "Marion County",
                    "051": "Marshall County",
                    "053": "Mason County",
                    "055": "Mercer County",
                    "057": "Mineral County",
                    "059": "Mingo County",
                    "061": "Monongalia County",
                    "063": "Monroe County",
                    "065": "Morgan County",
                    "067": "Nicholas County",
                    "069": "Ohio County",
                    "071": "Pendleton County",
                    "073": "Pleasants County",
                    "075": "Pocahontas County",
                    "077": "Preston County",
                    "079": "Putnam County",
                    "081": "Raleigh County",
                    "083": "Randolph County",
                    "085": "Ritchie County",
                    "087": "Roane County",
                    "089": "Summers County",
                    "091": "Taylor County",
                    "093": "Tucker County",
                    "095": "Tyler County",
                    "097": "Upshur County",
                    "099": "Wayne County",
                    "101": "Webster County",
                    "103": "Wetzel County",
                    "105": "Wirt County",
                    "107": "Wood County",
                    "109": "Wyoming County"
                },
                "55": {
                    "001": "Adams County",
                    "003": "Ashland County",
                    "005": "Barron County",
                    "007": "Bayfield County",
                    "009": "Brown County",
                    "011": "Buffalo County",
                    "013": "Burnett County",
                    "015": "Calumet County",
                    "017": "Chippewa County",
                    "019": "Clark County",
                    "021": "Columbia County",
                    "023": "Crawford County",
                    "025": "Dane County",
                    "027": "Dodge County",
                    "029": "Door County",
                    "031": "Douglas County",
                    "033": "Dunn County",
                    "035": "Eau Claire County",
                    "037": "Florence County",
                    "039": "Fond du Lac County",
                    "041": "Forest County",
                    "043": "Grant County",
                    "045": "Green County",
                    "047": "Green Lake County",
                    "049": "Iowa County",
                    "051": "Iron County",
                    "053": "Jackson County",
                    "055": "Jefferson County",
                    "057": "Juneau County",
                    "059": "Kenosha County",
                    "061": "Kewaunee County",
                    "063": "La Crosse County",
                    "065": "Lafayette County",
                    "067": "Langlade County",
                    "069": "Lincoln County",
                    "071": "Manitowoc County",
                    "073": "Marathon County",
                    "075": "Marinette County",
                    "077": "Marquette County",
                    "078": "Menominee County",
                    "079": "Milwaukee County",
                    "081": "Monroe County",
                    "083": "Oconto County",
                    "085": "Oneida County",
                    "087": "Outagamie County",
                    "089": "Ozaukee County",
                    "091": "Pepin County",
                    "093": "Pierce County",
                    "095": "Polk County",
                    "097": "Portage County",
                    "099": "Price County",
                    "101": "Racine County",
                    "103": "Richland County",
                    "105": "Rock County",
                    "107": "Rusk County",
                    "109": "St. Croix County",
                    "111": "Sauk County",
                    "113": "Sawyer County",
                    "115": "Shawano County",
                    "117": "Sheboygan County",
                    "119": "Taylor County",
                    "121": "Trempealeau County",
                    "123": "Vernon County",
                    "125": "Vilas County",
                    "127": "Walworth County",
                    "129": "Washburn County",
                    "131": "Washington County",
                    "133": "Waukesha County",
                    "135": "Waupaca County",
                    "137": "Waushara County",
                    "139": "Winnebago County",
                    "141": "Wood County"
                },
                "56": {
                    "001": "Albany County",
                    "003": "Big Horn County",
                    "005": "Campbell County",
                    "007": "Carbon County",
                    "009": "Converse County",
                    "011": "Crook County",
                    "013": "Fremont County",
                    "015": "Goshen County",
                    "017": "Hot Springs County",
                    "019": "Johnson County",
                    "021": "Laramie County",
                    "023": "Lincoln County",
                    "025": "Natrona County",
                    "027": "Niobrara County",
                    "029": "Park County",
                    "031": "Platte County",
                    "033": "Sheridan County",
                    "035": "Sublette County",
                    "037": "Sweetwater County",
                    "039": "Teton County",
                    "041": "Uinta County",
                    "043": "Washakie County",
                    "045": "Weston County"
                },
                "60": {
                    "010": "Eastern District",
                    "020": "Manu'a District",
                    "030": "Rose Island",
                    "040": "Swains Island",
                    "050": "Western District"
                },
                "66": {
                    "010": "Guam"
                },
                "69": {
                    "085": "Northern Islands Municipality",
                    "100": "Rota Municipality",
                    "110": "Saipan Municipality",
                    "120": "Tinian Municipality"
                },
                "72": {
                    "001": "Adjuntas Municipio",
                    "003": "Aguada Municipio",
                    "005": "Aguadilla Municipio",
                    "007": "Aguas Buenas Municipio",
                    "009": "Aibonito Municipio",
                    "011": "Anasco Municipio",
                    "013": "Arecibo Municipio",
                    "015": "Arroyo Municipio",
                    "017": "Barceloneta Municipio",
                    "019": "Barranquitas Municipio",
                    "021": "Bayamon Municipio",
                    "023": "Cabo Rojo Municipio",
                    "025": "Caguas Municipio",
                    "027": "Camuy Municipio",
                    "029": "Canovanas Municipio",
                    "031": "Carolina Municipio",
                    "033": "Catano Municipio",
                    "035": "Cayey Municipio",
                    "037": "Ceiba Municipio",
                    "039": "Ciales Municipio",
                    "041": "Cidra Municipio",
                    "043": "Coamo Municipio",
                    "045": "Comerio Municipio",
                    "047": "Corozal Municipio",
                    "049": "Culebra Municipio",
                    "051": "Dorado Municipio",
                    "053": "Fajardo Municipio",
                    "054": "Florida Municipio",
                    "055": "Guanica Municipio",
                    "057": "Guayama Municipio",
                    "059": "Guayanilla Municipio",
                    "061": "Guaynabo Municipio",
                    "063": "Gurabo Municipio",
                    "065": "Hatillo Municipio",
                    "067": "Hormigueros Municipio",
                    "069": "Humacao Municipio",
                    "071": "Isabela Municipio",
                    "073": "Jayuya Municipio",
                    "075": "Juana Diaz Municipio",
                    "077": "Juncos Municipio",
                    "079": "Lajas Municipio",
                    "081": "Lares Municipio",
                    "083": "Las Marias Municipio",
                    "085": "Las Piedras Municipio",
                    "087": "Loiza Municipio",
                    "089": "Luquillo Municipio",
                    "091": "Manati Municipio",
                    "093": "Maricao Municipio",
                    "095": "Maunabo Municipio",
                    "097": "Mayaguez Municipio",
                    "099": "Moca Municipio",
                    "101": "Morovis Municipio",
                    "103": "Naguabo Municipio",
                    "105": "Naranjito Municipio",
                    "107": "Orocovis Municipio",
                    "109": "Patillas Municipio",
                    "111": "Penuelas Municipio",
                    "113": "Ponce Municipio",
                    "115": "Quebradillas Municipio",
                    "117": "Rincon Municipio",
                    "119": "Rio Grande Municipio",
                    "121": "Sabana Grande Municipio",
                    "123": "Salinas Municipio",
                    "125": "San German Municipio",
                    "127": "San Juan Municipio",
                    "129": "San Lorenzo Municipio",
                    "131": "San Sebastian Municipio",
                    "133": "Santa Isabel Municipio",
                    "135": "Toa Alta Municipio",
                    "137": "Toa Baja Municipio",
                    "139": "Trujillo Alto Municipio",
                    "141": "Utuado Municipio",
                    "143": "Vega Alta Municipio",
                    "145": "Vega Baja Municipio",
                    "147": "Vieques Municipio",
                    "149": "Villalba Municipio",
                    "151": "Yabucoa Municipio",
                    "153": "Yauco Municipio"
                },
                "74": {
                    "300": "Midway Islands"
                },
                "78": {
                    "010": "St. Croix Island",
                    "020": "St. John Island",
                    "030": "St. Thomas Island"
                }
            };
            source.CensusApi = CensusApi;
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var ColorRamp = weavejs.util.ColorRamp;
            var StandardLib = weavejs.util.StandardLib;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * ColorColumn
             *
             * @author adufilie
             */
            var ColorColumn = function (_column$ExtendedDynam3) {
                _inherits(ColorColumn, _column$ExtendedDynam3);

                function ColorColumn() {
                    _classCallCheck(this, ColorColumn);

                    var _this136 = _possibleConstructorReturn(this, (ColorColumn.__proto__ || Object.getPrototypeOf(ColorColumn)).call(this));

                    _this136.ramp = Weave.linkableChild(_this136, ColorRamp);
                    _this136.rampCenterAtZero = Weave.linkableChild(_this136, new LinkableBoolean(false), _this136.cacheState);
                    /**
                     * This is a CSV containing specific colors associated with record keys.
                     * The format for each row in the CSV is:  keyType,localName,color
                     */
                    _this136.recordColors = Weave.linkableChild(_this136, new LinkableVariable(null, function (value) {
                        return _this136.verifyRecordColors(value);
                    }));
                    _this136._recordColorsTriggerCounter = 0;
                    _this136._internalColumnStats = Weave.linkableChild(_this136, WeaveAPI.StatisticsCache.getColumnStatistics(_this136.internalDynamicColumn));
                    return _this136;
                }
                /* override */

                _createClass(ColorColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (propertyName == ColumnMetadata.DATA_TYPE) return DataTypes.STRING;
                        return _get(ColorColumn.prototype.__proto__ || Object.getPrototypeOf(ColorColumn.prototype), "getMetadata", this).call(this, propertyName);
                    }
                }, {
                    key: "cacheState",
                    value: function cacheState() {
                        this._rampCenterAtZero = this.rampCenterAtZero.value;
                    }
                }, {
                    key: "getDataMin",
                    value: function getDataMin() {
                        if (this._rampCenterAtZero) {
                            var dataMin = this._internalColumnStats.getMin();
                            var dataMax = this._internalColumnStats.getMax();
                            return -Math.max(Math.abs(dataMin), Math.abs(dataMax));
                        }
                        return this._internalColumnStats.getMin();
                    }
                }, {
                    key: "getDataMax",
                    value: function getDataMax() {
                        if (this._rampCenterAtZero) {
                            var dataMin = this._internalColumnStats.getMin();
                            var dataMax = this._internalColumnStats.getMax();
                            return Math.max(Math.abs(dataMin), Math.abs(dataMax));
                        }
                        return this._internalColumnStats.getMax();
                    }
                }, {
                    key: "getColorFromDataValue",
                    value: function getColorFromDataValue(value) {
                        var dataMin = this._internalColumnStats.getMin();
                        var dataMax = this._internalColumnStats.getMax();
                        var norm;
                        if (dataMin == dataMax) {
                            norm = isFinite(value) ? 0.5 : NaN;
                        } else if (this._rampCenterAtZero) {
                            var absMax = Math.max(Math.abs(dataMin), Math.abs(dataMax));
                            norm = (value + absMax) / (2 * absMax);
                        } else {
                            norm = (value - dataMin) / (dataMax - dataMin);
                        }
                        return this.ramp.getColorFromNorm(norm);
                    }
                }, {
                    key: "verifyRecordColors",
                    value: function verifyRecordColors(value) {
                        if (Weave.IS(value, String)) {
                            value = WeaveAPI.CSVParser.parseCSV(Weave.AS(value, String));
                            this.recordColors.setSessionState(value);
                            return false;
                        }
                        if (value == null) return true;
                        return Weave.IS(value, Array) && StandardLib.arrayIsType(Weave.AS(value, Array), Array);
                    }
                }, {
                    key: "handleRecordColors",
                    value: function handleRecordColors() {
                        var rows = Weave.AS(this.recordColors.getSessionState(), Array) || [];
                        this.map_key_recordColor = new Map();
                        var _iteratorNormalCompletion64 = true;
                        var _didIteratorError64 = false;
                        var _iteratorError64 = undefined;

                        try {
                            for (var _iterator64 = rows[Symbol.iterator](), _step64; !(_iteratorNormalCompletion64 = (_step64 = _iterator64.next()).done); _iteratorNormalCompletion64 = true) {
                                var row = _step64.value;

                                if (row.length != 3) continue;
                                try {
                                    var key = WeaveAPI.QKeyManager.getQKey(row[0], row[1]);
                                    var color = StandardLib.asNumber(row[2]);
                                    this.map_key_recordColor.set(key, color);
                                } catch (e) {
                                    console.error(e);
                                }
                            }
                        } catch (err) {
                            _didIteratorError64 = true;
                            _iteratorError64 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion64 && _iterator64.return) {
                                    _iterator64.return();
                                }
                            } finally {
                                if (_didIteratorError64) {
                                    throw _iteratorError64;
                                }
                            }
                        }
                    }
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (this._recordColorsTriggerCounter != this.recordColors.triggerCounter) {
                            this._recordColorsTriggerCounter = this.recordColors.triggerCounter;
                            this.handleRecordColors();
                        }
                        var color;
                        var recordColor = this.map_key_recordColor.get(key);
                        if (recordColor !== undefined) {
                            color = recordColor;
                        } else {
                            var value = this.internalDynamicColumn.getValueFromKey(key, Number);
                            color = this.getColorFromDataValue(value);
                        }
                        if (dataType == Number) return color;
                        // return a 6-digit hex value for a String version of the color
                        if (isFinite(color)) return '#' + StandardLib.numberToBase(color, 16, 6);
                        return '';
                    }
                }]);

                return ColorColumn;
            }(column.ExtendedDynamicColumn);
            ColorColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.ColorColumn", interfaces: [IColumnWrapper, IAttributeColumn, ICallbackCollection] })], ColorColumn);
            column.ColorColumn = ColorColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IBinClassifier = weavejs.api.data.IBinClassifier;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            var LinkableDynamicObject = weavejs.core.LinkableDynamicObject;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            var LinkableWatcher = weavejs.core.LinkableWatcher;
            var StandardLib = weavejs.util.StandardLib;
            var ILinkableDynamicObject = weavejs.api.core.ILinkableDynamicObject;
            /**
             * This provides a wrapper for a dynamically created IBinningDefinition.
             * When <code>generateBinClassifiersForColumn(column)</code> is called, the column
             * will be monitored for changes and results will be computed automatically.
             */
            var DynamicBinningDefinition_1 = void 0;
            var DynamicBinningDefinition = DynamicBinningDefinition_1 = function (_LinkableDynamicObjec4) {
                _inherits(DynamicBinningDefinition, _LinkableDynamicObjec4);

                /**
                 * @param lockFirstColumn If set to true, the first column passed to <code>generateBinClassifiersForColumn()</code> will be the only column accepted.
                 */
                function DynamicBinningDefinition() {
                    var lockFirstColumn = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                    _classCallCheck(this, DynamicBinningDefinition);

                    var _this137 = _possibleConstructorReturn(this, (DynamicBinningDefinition.__proto__ || Object.getPrototypeOf(DynamicBinningDefinition)).call(this, IBinningDefinition));

                    _this137._columnLocked = false;
                    _this137.internalResultWatcher = Weave.disposableChild(_this137, LinkableWatcher);
                    _this137.internalObjectWatcher = Weave.linkableChild(_this137, LinkableWatcher, _this137.handleInternalObjectChange);
                    _this137.columnWatcher = Weave.linkableChild(_this137, LinkableWatcher, _this137.generateBins);
                    _this137.statsWatcher = Weave.linkableChild(_this137, LinkableWatcher, _this137.generateBins);
                    _this137._updatingTargets = false;
                    _this137.overrideBinsOutput = Weave.disposableChild(_this137, new LinkableHashMap(IBinClassifier));
                    _this137.addImmediateCallback(_this137, _this137.watchInternalObject);
                    _this137._columnLocked = lockFirstColumn;
                    return _this137;
                }

                _createClass(DynamicBinningDefinition, [{
                    key: "watchInternalObject",
                    value: function watchInternalObject() {
                        this.internalObjectWatcher.target = this.internalObject;
                    }
                }, {
                    key: "handleInternalObjectChange",
                    value: function handleInternalObjectChange() {
                        if (this.internalObject) this.internalResultWatcher.target = Weave.AS(this.internalObject, IBinningDefinition).asyncResultCallbacks;
                        this.generateBins();
                    }
                }, {
                    key: "generateBins",
                    value: function generateBins() {
                        // prevent recursion if this function is called as a result of updating targets
                        if (this._updatingTargets) return;
                        this._updatingTargets = true;
                        var column = Weave.AS(this.columnWatcher.target, IAttributeColumn);
                        this.statsWatcher.target = column ? WeaveAPI.StatisticsCache.getColumnStatistics(column) : null;
                        this._updatingTargets = false; // done preventing recursion
                        var overrideBins = column ? column.getMetadata(ColumnMetadata.OVERRIDE_BINS) : null;
                        if (overrideBins && DynamicBinningDefinition_1.getBinsFromJson(overrideBins, this.overrideBinsOutput, column)) this.asyncResultCallbacks.triggerCallbacks();else this.overrideBinsOutput.removeAllObjects();
                        if (this.internalObject && column) Weave.AS(this.internalObject, IBinningDefinition).generateBinClassifiersForColumn(column);else this.asyncResultCallbacks.triggerCallbacks(); // bins are empty
                    }
                    /**
                     * @param json Any one of the following formats:
                     *     [1,2,3]<br>
                     *     [[0,5],[5,10]]<br>
                     *     [{"min": 0, "max": 33, "label": "low"}, {"min": 34, "max": 66, "label": "midrange"}, {"min": 67, "max": 100, "label": "high"}]
                     * @return true on success
                     */

                }, {
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        if (this._columnLocked && this.columnWatcher.target) throw new Error("generateBinClassifiersForColumn(): Column was locked upon creation of this DynamicBinningDefinition.");
                        this.columnWatcher.target = column;
                    }
                }, {
                    key: "getBinClassifiers",
                    value: function getBinClassifiers() {
                        var override = this.overrideBinsOutput.getObjects();
                        if (override.length) return override;
                        if (this.internalObject && this.columnWatcher.target) return Weave.AS(this.internalObject, IBinningDefinition).getBinClassifiers();
                        return [];
                    }
                }, {
                    key: "getBinNames",
                    value: function getBinNames() {
                        var override = this.overrideBinsOutput.getNames();
                        if (override.length) return override;
                        if (this.internalObject && this.columnWatcher.target) return Weave.AS(this.internalObject, IBinningDefinition).getBinNames();
                        return [];
                    }
                }, {
                    key: "asyncResultCallbacks",
                    get: function get() {
                        return Weave.getCallbacks(this.internalResultWatcher);
                    }
                }, {
                    key: "binsOverridden",
                    get: function get() {
                        return this.overrideBinsOutput.getNames().length > 0;
                    }
                }], [{
                    key: "getBinsFromJson",
                    value: function getBinsFromJson(json, output) {
                        var toStringColumn = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                        if (!DynamicBinningDefinition_1.tempNumberClassifier) DynamicBinningDefinition_1.tempNumberClassifier = new bin.NumberClassifier();
                        Weave.getCallbacks(output).delayCallbacks();
                        output.removeAllObjects();
                        var array;
                        try {
                            array = Weave.AS(JSON.parse(json), Array);
                            var _iteratorNormalCompletion65 = true;
                            var _didIteratorError65 = false;
                            var _iteratorError65 = undefined;

                            try {
                                for (var _iterator65 = (array || [])[Symbol.iterator](), _step65; !(_iteratorNormalCompletion65 = (_step65 = _iterator65.next()).done); _iteratorNormalCompletion65 = true) {
                                    var item = _step65.value;

                                    var label;
                                    if (Weave.IS(item, String) || StandardLib.getArrayType(Weave.AS(item, Array)) == String) {
                                        label = (Weave.AS(item, Array) || [item]).join(', ');
                                        var sc = output.requestObject(label, bin.StringClassifier, false);
                                        sc.setSessionState(Weave.AS(item, Array) || [item]);
                                    } else {
                                        DynamicBinningDefinition_1.tempNumberClassifier.min.value = -Infinity;
                                        DynamicBinningDefinition_1.tempNumberClassifier.max.value = Infinity;
                                        DynamicBinningDefinition_1.tempNumberClassifier.minInclusive.value = true;
                                        DynamicBinningDefinition_1.tempNumberClassifier.maxInclusive.value = true;
                                        if (Weave.IS(item, Array)) {
                                            DynamicBinningDefinition_1.tempNumberClassifier.min.value = item[0];
                                            DynamicBinningDefinition_1.tempNumberClassifier.max.value = item[1];
                                        } else if (Weave.IS(item, Number)) {
                                            DynamicBinningDefinition_1.tempNumberClassifier.min.value = Weave.AS(item, Number);
                                            DynamicBinningDefinition_1.tempNumberClassifier.max.value = Weave.AS(item, Number);
                                        } else {
                                            WeaveAPI.SessionManager.setSessionState(DynamicBinningDefinition_1.tempNumberClassifier, item);
                                        }
                                        if (item && (typeof item === "undefined" ? "undefined" : _typeof(item)) == 'object' && item['label']) label = item['label'];else label = DynamicBinningDefinition_1.tempNumberClassifier.generateBinLabel(toStringColumn);
                                        output.requestObjectCopy(label, DynamicBinningDefinition_1.tempNumberClassifier);
                                    }
                                }
                            } catch (err) {
                                _didIteratorError65 = true;
                                _iteratorError65 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion65 && _iterator65.return) {
                                        _iterator65.return();
                                    }
                                } finally {
                                    if (_didIteratorError65) {
                                        throw _iteratorError65;
                                    }
                                }
                            }
                        } catch (e) {
                            console.error("Invalid JSON bin specification: " + json, null, e);
                            Weave.getCallbacks(output).resumeCallbacks();
                            return false;
                        }
                        Weave.getCallbacks(output).resumeCallbacks();
                        return true;
                    }
                }]);

                return DynamicBinningDefinition;
            }(LinkableDynamicObject);
            DynamicBinningDefinition = DynamicBinningDefinition_1 = __decorate([Weave.classInfo({ id: "weavejs.data.bin.DynamicBinningDefinition", interfaces: [IBinningDefinition, ILinkableDynamicObject, ICallbackCollection] })], DynamicBinningDefinition);
            bin.DynamicBinningDefinition = DynamicBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ColumnMetadata = weavejs.api.data.ColumnMetadata;
        var IColumnStatistics = weavejs.api.data.IColumnStatistics;
        var StandardLib = weavejs.util.StandardLib;
        var ColumnStatistics = function () {
            function ColumnStatistics(column) {
                var _this138 = this;

                _classCallCheck(this, ColumnStatistics);

                /**********************************************************************/
                /**
                 * This maps a stats function of this object to a cached value for the function.
                 * Example: map_method_result.get(getMin) is a cached value for the getMin function.
                 */
                this.map_method_result = new WeakMap();
                this.prevTriggerCounter = 0;
                this.busy = false;
                this.asyncComplete = function () {
                    if (_this138.busy) {
                        Weave.getCallbacks(_this138).triggerCallbacks();
                        return;
                    }
                    if (_this138.count == 0) _this138.min = _this138.max = NaN;
                    _this138.mean = _this138.sum / _this138.count;
                    _this138.variance = _this138.squareSum / _this138.count - _this138.mean * _this138.mean;
                    _this138.standardDeviation = Math.sqrt(_this138.variance);
                    _this138.outKeys.length = _this138.count;
                    _this138.outNumbers.length = _this138.count;
                    var qkm = WeaveAPI.QKeyManager;
                    var outIndices = StandardLib.sortOn(_this138.outKeys, [_this138.outNumbers, qkm.map_qkey_keyType, qkm.map_qkey_localName], null, false, true);
                    _this138.median = _this138.outNumbers[outIndices[int(_this138.count / 2)]];
                    _this138.i = _this138.count;
                    while (--_this138.i >= 0) {
                        _this138.map_key_sortIndex.set(_this138.outKeys[outIndices[_this138.i]], _this138.i);
                    } // BEGIN code to get custom min,max
                    var tempNumber;
                    try {
                        tempNumber = StandardLib.asNumber(_this138.column.getMetadata(ColumnMetadata.MIN));
                        if (isFinite(tempNumber)) _this138.min = tempNumber;
                    } catch (e) {}
                    try {
                        tempNumber = StandardLib.asNumber(_this138.column.getMetadata(ColumnMetadata.MAX));
                        if (isFinite(tempNumber)) _this138.max = tempNumber;
                    } catch (e) {}
                    // END code to get custom min,max
                    // save the statistics for this column in the cache
                    _this138.map_method_result.set(_this138.getMin, _this138.min);
                    _this138.map_method_result.set(_this138.getMax, _this138.max);
                    _this138.map_method_result.set(_this138.getCount, _this138.count);
                    _this138.map_method_result.set(_this138.getSum, _this138.sum);
                    _this138.map_method_result.set(_this138.getSquareSum, _this138.squareSum);
                    _this138.map_method_result.set(_this138.getMean, _this138.mean);
                    _this138.map_method_result.set(_this138.getVariance, _this138.variance);
                    _this138.map_method_result.set(_this138.getStandardDeviation, _this138.standardDeviation);
                    _this138.map_method_result.set(_this138.getMedian, _this138.median);
                    _this138.map_method_result.set(_this138.getSortIndex, _this138.map_key_sortIndex);
                    _this138.map_method_result.set(_this138.hack_getNumericData, _this138.hack_map_key_number);
                    _this138.map_method_result.set(_this138.getRunningTotals, _this138.map_key_runningTotal);
                    // trigger callbacks when we are done
                    Weave.getCallbacks(_this138).triggerCallbacks();
                };
                this.column = column;
                column.addImmediateCallback(this, function () {
                    return Weave.getCallbacks(_this138).triggerCallbacks();
                }, false, true);
            }

            _createClass(ColumnStatistics, [{
                key: "getNorm",
                value: function getNorm(key) {
                    var min = this.validateCache(this.getMin, NaN);
                    var max = this.validateCache(this.getMax, NaN);
                    var map_numericData = this.validateCache(this.hack_getNumericData, null);
                    var value = map_numericData ? map_numericData.get(key) : NaN;
                    return (value - min) / (max - min);
                }
            }, {
                key: "getMin",
                value: function getMin() {
                    return this.validateCache(this.getMin, NaN);
                }
            }, {
                key: "getMax",
                value: function getMax() {
                    return this.validateCache(this.getMax, NaN);
                }
            }, {
                key: "getCount",
                value: function getCount() {
                    return this.validateCache(this.getCount, 0);
                }
            }, {
                key: "getSum",
                value: function getSum() {
                    return this.validateCache(this.getSum, 0);
                }
            }, {
                key: "getSquareSum",
                value: function getSquareSum() {
                    return this.validateCache(this.getSquareSum, 0);
                }
            }, {
                key: "getMean",
                value: function getMean() {
                    return this.validateCache(this.getMean, NaN);
                }
            }, {
                key: "getVariance",
                value: function getVariance() {
                    return this.validateCache(this.getVariance, NaN);
                }
            }, {
                key: "getStandardDeviation",
                value: function getStandardDeviation() {
                    return this.validateCache(this.getStandardDeviation, NaN);
                }
            }, {
                key: "getMedian",
                value: function getMedian() {
                    return this.validateCache(this.getMedian, NaN);
                }
            }, {
                key: "getSortIndex",
                value: function getSortIndex() {
                    return this.validateCache(this.getSortIndex, null);
                }
            }, {
                key: "hack_getNumericData",
                value: function hack_getNumericData() {
                    return this.validateCache(this.hack_getNumericData, null);
                }
                /**
                 * Gets a Dictionary that maps a IQualifiedKey to a running total numeric value, based on the order of the keys in the column.
                 */

            }, {
                key: "getRunningTotals",
                value: function getRunningTotals() {
                    return this.validateCache(this.getRunningTotals, null);
                }
                /**
                 * This function will validate the cached statistical values for the given column.
                 * @param statsFunction The function we are interested in calling.
                 * @return The cached result for the statsFunction.
                 */

            }, {
                key: "validateCache",
                value: function validateCache(statsFunction, defaultValue) {
                    // the cache becomes invalid when the trigger counter has changed
                    if (this.prevTriggerCounter != this.column.triggerCounter) {
                        // statistics are undefined while column is busy
                        this.busy = WeaveAPI.SessionManager.linkableObjectIsBusy(data.column);
                        // once we have determined the column is not busy, begin the async task to calculate stats
                        if (!this.busy) this.asyncStart();
                    }
                    var result = this.map_method_result.get(statsFunction);
                    return result === undefined ? defaultValue : result;
                }
            }, {
                key: "asyncStart",
                value: function asyncStart() {
                    // remember the trigger counter from when we begin calculating
                    this.prevTriggerCounter = this.column.triggerCounter;
                    this.i = 0;
                    this.keys = this.column.keys;
                    this.min = Infinity; // so first value < min
                    this.max = -Infinity; // so first value > max
                    this.count = 0;
                    this.sum = 0;
                    this.squareSum = 0;
                    this.mean = NaN;
                    this.variance = NaN;
                    this.standardDeviation = NaN;
                    this.outKeys = new Array(this.keys.length);
                    this.outNumbers = new Array(this.keys.length);
                    this.map_key_sortIndex = new WeakMap();
                    this.hack_map_key_number = new WeakMap();
                    this.median = NaN;
                    this.map_key_runningTotal = new WeakMap();
                    // high priority because preparing data is often a prerequisite for other things
                    WeaveAPI.Scheduler.startTask(this, this.iterate, WeaveAPI.TASK_PRIORITY_HIGH, this.asyncComplete, Weave.lang("Calculating statistics for {0} values", this.keys.length));
                }
            }, {
                key: "iterate",
                value: function iterate(stopTime) {
                    // when the column is found to be busy or modified since last time, stop immediately
                    if (this.busy || this.prevTriggerCounter != this.column.triggerCounter) {
                        // make sure trigger counter is reset because cache is now invalid
                        this.prevTriggerCounter = 0;
                        return 1;
                    }
                    for (; this.i < this.keys.length; ++this.i) {
                        if (Date.now() > stopTime) return this.i / this.keys.length;
                        // iterate on this key
                        var key = this.keys[this.i];
                        var value = this.column.getValueFromKey(key, Number);
                        // skip keys that do not have an associated numeric value in the column.
                        if (isFinite(value)) {
                            this.sum += value;
                            this.squareSum += value * value;
                            if (value < this.min) this.min = value;
                            if (value > this.max) this.max = value;
                            //TODO - make runningTotals use sorted order instead of original key order
                            this.map_key_runningTotal.set(key, this.sum);
                            this.hack_map_key_number.set(key, value);
                            this.outKeys[this.count] = key;
                            this.outNumbers[this.count] = value;
                            ++this.count;
                        }
                    }
                    return 1;
                }
            }]);

            return ColumnStatistics;
        }();
        ColumnStatistics = __decorate([Weave.classInfo({ id: "weavejs.data.ColumnStatistics", interfaces: [IColumnStatistics] })], ColumnStatistics);
        data.ColumnStatistics = ColumnStatistics;
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            var beans;
            (function (beans) {
                var ColumnMetadata = weavejs.api.data.ColumnMetadata;

                var EntityMetadata = function () {
                    function EntityMetadata() {
                        _classCallCheck(this, EntityMetadata);

                        this.privateMetadata = {};
                        this.publicMetadata = {};
                    }

                    _createClass(EntityMetadata, [{
                        key: "objToStr",
                        value: function objToStr(obj) {
                            var str = '';
                            for (var name in obj) {
                                if (str) str += '; ';
                                str += name + ': ' + obj[name];
                            }
                            return '{' + str + '}';
                        }
                    }, {
                        key: "toString",
                        value: function toString() {
                            return this.objToStr({ 'publicMetadata': this.objToStr(this.publicMetadata), 'privateMetadata': this.objToStr(this.privateMetadata) });
                        }
                    }], [{
                        key: "getSuggestedPublicPropertyNames",
                        value: function getSuggestedPublicPropertyNames() {
                            return [ColumnMetadata.TITLE, ColumnMetadata.NUMBER, ColumnMetadata.STRING, ColumnMetadata.KEY_TYPE, ColumnMetadata.DATA_TYPE, ColumnMetadata.PROJECTION, ColumnMetadata.AGGREGATION, ColumnMetadata.DATE_FORMAT, ColumnMetadata.DATE_DISPLAY_FORMAT, ColumnMetadata.OVERRIDE_BINS, ColumnMetadata.MIN, ColumnMetadata.MAX, 'year'];
                        }
                    }, {
                        key: "getSuggestedPrivatePropertyNames",
                        value: function getSuggestedPrivatePropertyNames() {
                            return ["connection", "sqlQuery", "sqlParams", "sqlTablePrefix", "importMethod", "fileName", "keyColumn", "sqlSchema", "sqlTable", "sqlKeyColumn", "sqlColumn"];
                        }
                    }]);

                    return EntityMetadata;
                }();

                beans.EntityMetadata = EntityMetadata;
            })(beans = net.beans || (net.beans = {}));
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            var beans;
            (function (beans) {
                /**
                 * @author adufilie
                 */
                var Entity = function (_beans$EntityMetadata) {
                    _inherits(Entity, _beans$EntityMetadata);

                    function Entity() {
                        var info = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                        _classCallCheck(this, Entity);

                        var _this139 = _possibleConstructorReturn(this, (Entity.__proto__ || Object.getPrototypeOf(Entity)).call(this));

                        _this139.id = -1;
                        if (info) {
                            _this139.id = info.id;
                            _this139.publicMetadata.title = info.title;
                            _this139.publicMetadata.entityType = info.entityType;
                        }
                        return _this139;
                    }
                    /**
                     * Resets this object so it does not contain any information.
                     */


                    _createClass(Entity, [{
                        key: "reset",
                        value: function reset() {
                            this.id = -1;
                            this.parentIds = null;
                            this.childIds = null;
                            this._hasParent = null;
                            this._hasChild = null;
                            this.publicMetadata = {};
                            this.privateMetadata = {};
                        }
                        /**
                         * Tests if this object has been initialized.
                         */

                    }, {
                        key: "getEntityType",
                        value: function getEntityType() {
                            return this.publicMetadata.entityType;
                        }
                    }, {
                        key: "hasParent",
                        value: function hasParent(parentId) {
                            if (!this.parentIds) return false;
                            if (!this._hasParent) {
                                this._hasParent = {};
                                var _iteratorNormalCompletion66 = true;
                                var _didIteratorError66 = false;
                                var _iteratorError66 = undefined;

                                try {
                                    for (var _iterator66 = this.parentIds[Symbol.iterator](), _step66; !(_iteratorNormalCompletion66 = (_step66 = _iterator66.next()).done); _iteratorNormalCompletion66 = true) {
                                        var pid = _step66.value;

                                        this._hasParent[pid] = true;
                                    }
                                } catch (err) {
                                    _didIteratorError66 = true;
                                    _iteratorError66 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion66 && _iterator66.return) {
                                            _iterator66.return();
                                        }
                                    } finally {
                                        if (_didIteratorError66) {
                                            throw _iteratorError66;
                                        }
                                    }
                                }
                            }
                            return this._hasParent[parentId];
                        }
                    }, {
                        key: "hasChild",
                        value: function hasChild(childId) {
                            if (!this.childIds) return false;
                            if (!this._hasChild) {
                                this._hasChild = {};
                                var _iteratorNormalCompletion67 = true;
                                var _didIteratorError67 = false;
                                var _iteratorError67 = undefined;

                                try {
                                    for (var _iterator67 = this.childIds[Symbol.iterator](), _step67; !(_iteratorNormalCompletion67 = (_step67 = _iterator67.next()).done); _iteratorNormalCompletion67 = true) {
                                        var cid = _step67.value;

                                        this._hasChild[cid] = true;
                                    }
                                } catch (err) {
                                    _didIteratorError67 = true;
                                    _iteratorError67 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion67 && _iterator67.return) {
                                            _iterator67.return();
                                        }
                                    } finally {
                                        if (_didIteratorError67) {
                                            throw _iteratorError67;
                                        }
                                    }
                                }
                            }
                            return this._hasChild[childId];
                        }
                    }, {
                        key: "initialized",
                        get: function get() {
                            return Boolean(this.id != -1 && this.parentIds && this.childIds);
                        }
                    }]);

                    return Entity;
                }(beans.EntityMetadata);
                Entity = __decorate([Weave.classInfo({ id: "weavejs.api.net.beans" })], Entity);
                beans.Entity = Entity;
            })(beans = net.beans || (net.beans = {}));
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var ColumnMetadata = weavejs.api.data.ColumnMetadata;
        var DatabaseConfigInfo = weavejs.net.beans.DatabaseConfigInfo;
        var Admin_1 = void 0;
        var Admin = Admin_1 = function () {
            /* private */function Admin() {
                var _this140 = this;

                _classCallCheck(this, Admin);

                this._service = null;
                this.focusEntityId = -1;
                this._entityCache = null;
                /*Bindable*/this.databaseConfigExists = true;
                /*Bindable*/this.currentUserIsSuperuser = false;
                this._userHasAuthenticated = false;
                // values returned by the server
                /*Bindable*/this.connectionNames = [];
                /*Bindable*/this.weaveFileNames = [];
                /*Bindable*/this.privateWeaveFileNames = [];
                /*Bindable*/this.keyTypes = [];
                /*Bindable*/this.databaseConfigInfo = new DatabaseConfigInfo();
                /**
                 * An Array of WeaveFileInfo objects.
                 * @see weave.services.beans.WeaveFileInfo
                 */
                /*Bindable*/this.uploadedCSVFiles = [];
                /**
                 * An Array of WeaveFileInfo objects.
                 * @see weave.services.beans.WeaveFileInfo
                 */
                /*Bindable*/this.uploadedShapeFiles = [];
                ///////////////////
                // Initialization
                this.service.addHook(this.service.checkDatabaseConfigExists, null, function (result) {
                    // save info
                    _this140.databaseConfigExists = Weave.AS(result, Boolean);
                    if (!_this140.databaseConfigExists) _this140.service.getConnectionNames();
                });
                this.service.addHook(this.service.authenticate, function (connectionName, password) {
                    // not logged in until result comes back
                    if (_this140.userHasAuthenticated) _this140.userHasAuthenticated = false;
                    _this140.activeConnectionName = connectionName;
                    _this140.activePassword = password;
                }, function (result) {
                    // save info
                    _this140.userHasAuthenticated = true;
                    _this140.currentUserIsSuperuser = Weave.AS(result, Boolean);
                    // refresh lists
                    _this140.service.getWeaveFileNames(false);
                    _this140.service.getWeaveFileNames(true);
                    _this140.service.getConnectionNames();
                    _this140.service.getDatabaseConfigInfo();
                    _this140.service.getKeyTypes();
                });
                //////////////////////////////
                // Weave client config files
                this.service.addHook(this.service.saveWeaveFileByteArray, null, function (result) {
                    net.WeaveAdminService.messageDisplay(null, Weave.AS(result, String), false);
                    // refresh lists
                    _this140.service.getWeaveFileNames(false);
                    _this140.service.getWeaveFileNames(true);
                });
                this.service.addHook(this.service.removeWeaveFile, null, function () {
                    // refresh lists
                    _this140.service.getWeaveFileNames(false);
                    _this140.service.getWeaveFileNames(true);
                });
                this.service.addHook(this.service.getWeaveFileNames, null, function (result, args) {
                    var showAllFiles = args[0];
                    if (showAllFiles) _this140.weaveFileNames = Weave.AS(result, Array) || [];else _this140.privateWeaveFileNames = Weave.AS(result, Array) || [];
                });
                //////////////////////////////
                // ConnectionInfo management
                this.service.addHook(this.service.getConnectionNames, null, function (result) {
                    // save list
                    _this140.connectionNames = Weave.AS(result, Array) || [];
                });
                this.service.addHook(this.service.saveConnectionInfo, null, function (result, args) {
                    // when connection save succeeds and we just changed our password, change our login credentials
                    // 0=user, 1=pass, 2=folderName, 3=is_superuser, 4=connectString, 5=overwrite
                    var saveName = args[0];
                    var savePass = args[1];
                    if (!_this140.userHasAuthenticated) {
                        _this140.activeConnectionName = saveName;
                        _this140.activePassword = savePass;
                    } else if (_this140.activeConnectionName == saveName) {
                        _this140.activePassword = savePass;
                    }
                    // refresh lists that may have changed
                    _this140.service.getConnectionNames();
                    _this140.service.getDatabaseConfigInfo();
                    _this140.service.getWeaveFileNames(false);
                });
                this.service.addHook(this.service.removeConnectionInfo, null, function (result, args) {
                    var removedUser = args[0];
                    // if user removed self, log out
                    if (this.activeConnectionName == removedUser) {
                        this.activeConnectionName = '';
                        this.activePassword = '';
                    } else {
                        // refresh list
                        this.service.getConnectionNames();
                        this.service.getDatabaseConfigInfo();
                    }
                });
                //////////////////////////////////
                // DatabaseConfigInfo management
                this.service.addHook(this.service.getDatabaseConfigInfo, null, function (result) {
                    // save info
                    _this140.databaseConfigInfo = result || new DatabaseConfigInfo();
                });
                this.service.addHook(this.service.setDatabaseConfigInfo, null, function (result) {
                    // save info
                    _this140.databaseConfigExists = Boolean(result);
                    if (_this140.activeConnectionName && _this140.activePassword) {
                        if (!_this140.userHasAuthenticated) _this140.service.authenticate(_this140.activeConnectionName, _this140.activePassword);
                        // refresh
                        _this140.service.getDatabaseConfigInfo();
                    }
                    // purge cache
                    _this140.entityCache.invalidateAll(true);
                });
                /////////////////
                // File uploads
                this.service.addHook(this.service.getUploadedCSVFiles, null, function (result) {
                    // save info
                    _this140.uploadedCSVFiles = Weave.AS(result, Array) || [];
                });
                this.service.addHook(this.service.getUploadedSHPFiles, null, function (result) {
                    // save info
                    _this140.uploadedShapeFiles = Weave.AS(result, Array) || [];
                });
                ////////////////
                // Data import
                this.service.addHook(this.service.importSQL, null, this.handleTableImportResult.bind(this));
                this.service.addHook(this.service.importCSV, null, this.handleTableImportResult.bind(this));
                this.service.addHook(this.service.importSHP, null, this.handleTableImportResult.bind(this));
                //////////////////
                // Miscellaneous
                this.service.addHook(this.service.getKeyTypes, null, function (result) {
                    // save list
                    if (_this140.userHasAuthenticated) _this140.keyTypes = Weave.AS(result, Array) || [];
                });
                this.service.addHook(this.service.newEntity, null, function (result, meta0_parent1_index2) {
                    var id = Number(result);
                    this.focusEntityId = id;
                    this.entityCache.invalidate(id);
                    var parentId = meta0_parent1_index2[1];
                    this.entityCache.invalidate(parentId);
                });
                this.service.addHook(this.service.getAuthenticatedUser, null, function (result) {
                    _this140.activeConnectionName = Weave.AS(result, String);
                    _this140.userHasAuthenticated = !!_this140.activeConnectionName;
                });
                this.service.checkDatabaseConfigExists();
            }

            _createClass(Admin, [{
                key: "getFocusEntityId",

                /**
                 * This is an entity id on which editors should focus, or -1 if none.
                 * It will be set to the newest entity that was created by the administrator.
                 * After an editor has focused on the entity, clearFocusEntityId() should be called.
                 */
                value: function getFocusEntityId() {
                    // if the entity does not exist on the server, don't attempt to focus on it
                    if (!Weave.isBusy(this.entityCache) && !this.entityCache.entityIsCached(this.focusEntityId)) this.focusEntityId = -1;
                    return this.focusEntityId;
                }
            }, {
                key: "setFocusEntityId",
                value: function setFocusEntityId(id) {
                    // Request the entity now so that we can later detect if it
                    // exists on the server by checking entityCache.entityIsCached().
                    this.entityCache.getEntity(id);
                    this.focusEntityId = id;
                }
            }, {
                key: "clearFocusEntityId",
                value: function clearFocusEntityId() {
                    this.focusEntityId = -1;
                }
            }, {
                key: "handleTableImportResult",
                value: function handleTableImportResult(result) {
                    var tableId = int(result); // TODO check if this is the correct way to cast to int
                    var exists = false;
                    var title;
                    var info = this.entityCache.getBranchInfo(tableId);
                    if (info) {
                        exists = true;
                        title = info.title;
                    } else if (this.entityCache.entityIsCached(tableId)) {
                        exists = true;
                        var entity = this.entityCache.getEntity(tableId);
                        title = entity.publicMetadata.title;
                    }
                    if (exists) console.error(Weave.lang('Existing data table "{0}" was updated successfully.', title));else console.error(Weave.lang("New data table created successfully."));
                    this.focusEntityId = tableId;
                    // request children
                    this.entityCache.invalidate(tableId, true);
                    var _iteratorNormalCompletion68 = true;
                    var _didIteratorError68 = false;
                    var _iteratorError68 = undefined;

                    try {
                        for (var _iterator68 = this.entityCache.getEntity(tableId).childIds[Symbol.iterator](), _step68; !(_iteratorNormalCompletion68 = (_step68 = _iterator68.next()).done); _iteratorNormalCompletion68 = true) {
                            var id = _step68.value;

                            this.entityCache.invalidate(id);
                        } // refresh list
                    } catch (err) {
                        _didIteratorError68 = true;
                        _iteratorError68 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion68 && _iterator68.return) {
                                _iterator68.return();
                            }
                        } finally {
                            if (_didIteratorError68) {
                                throw _iteratorError68;
                            }
                        }
                    }

                    this.service.getKeyTypes();
                }
                /*Bindable*/
            }, {
                key: "getSuggestedPropertyValues",
                value: function getSuggestedPropertyValues(propertyName) {
                    var suggestions = ColumnMetadata.getSuggestedPropertyValues(propertyName);
                    switch (propertyName) {
                        case 'connection':
                            return this.connectionNames;
                        case ColumnMetadata.KEY_TYPE:
                            return this.keyTypes;
                        case ColumnMetadata.DATA_TYPE:
                            return suggestions.concat(this.keyTypes);
                        default:
                            return suggestions;
                    }
                }
            }, {
                key: "service",
                get: function get() {
                    if (!this._service) {
                        this._service = net.WeaveAdminService.getInstance("/WeaveServices");
                    }
                    return this._service;
                }
            }, {
                key: "entityCache",
                get: function get() {
                    if (!this._entityCache) this._entityCache = new net.EntityCache(this.service, true);
                    return this._entityCache;
                }
                /*Bindable*/
            }, {
                key: "userHasAuthenticated",
                get: function get() {
                    return this._userHasAuthenticated;
                },
                set: function set(value) {
                    this._userHasAuthenticated = value;
                    if (!this._userHasAuthenticated) {
                        // prevent the user from seeing anything while logged out.
                        this.entityCache.invalidateAll(true);
                        this.currentUserIsSuperuser = false;
                        this.connectionNames = [];
                        this.weaveFileNames = [];
                        this.privateWeaveFileNames = [];
                        this.keyTypes = [];
                        this.databaseConfigInfo = new DatabaseConfigInfo();
                    }
                }
            }, {
                key: "activeConnectionName",
                get: function get() {
                    return this.service.user;
                },
                set: function set(value) {
                    if (this.service.user == value) return;
                    this.service.user = value;
                    // log out
                    this.userHasAuthenticated = false;
                }
                /*Bindable*/
            }, {
                key: "activePassword",
                get: function get() {
                    return this.service.pass;
                },
                set: function set(value) {
                    this.service.pass = value;
                }
            }], [{
                key: "instance",
                get: function get() {
                    if (this._thisInstance == null) this._thisInstance = new Admin_1();
                    return this._thisInstance;
                }
            }, {
                key: "service",
                get: function get() {
                    return this.instance.service;
                }
            }, {
                key: "entityCache",
                get: function get() {
                    return this.instance.entityCache;
                }
            }]);

            return Admin;
        }();
        Admin._thisInstance = null;
        Admin = Admin_1 = __decorate([Weave.classInfo({ id: "weavejs.net.Admin" })], Admin);
        net.Admin = Admin;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            var ILinkableObject = weavejs.api.core.ILinkableObject;
            /**
             * Interface for a service which provides RPC functions for retrieving Weave Entity information.
             * @author adufilie
             */
            var IWeaveEntityService = function (_ILinkableObject8) {
                _inherits(IWeaveEntityService, _ILinkableObject8);

                function IWeaveEntityService() {
                    _classCallCheck(this, IWeaveEntityService);

                    return _possibleConstructorReturn(this, (IWeaveEntityService.__proto__ || Object.getPrototypeOf(IWeaveEntityService)).apply(this, arguments));
                }

                return IWeaveEntityService;
            }(ILinkableObject);
            IWeaveEntityService = __decorate([Weave.classInfo({ id: "weavejs.api.net.IWeaveEntityService" })], IWeaveEntityService);
            net.IWeaveEntityService = IWeaveEntityService;
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var IQualifiedKey = weavejs.api.data.IQualifiedKey;
        var IWeaveEntityService = weavejs.api.net.IWeaveEntityService;
        var Entity = weavejs.api.net.beans.Entity;
        var EntityHierarchyInfo = weavejs.api.net.beans.EntityHierarchyInfo;
        var AttributeColumnData = weavejs.net.beans.AttributeColumnData;
        var GeometryStreamMetadata = weavejs.net.beans.GeometryStreamMetadata;
        var TableData = weavejs.net.beans.TableData;
        var JS = weavejs.util.JS;
        var WeavePromise = weavejs.util.WeavePromise;
        var WeaveAPI = weavejs.WeaveAPI;
        /**
         * This is a wrapper class for making asynchronous calls to a Weave data servlet.
         *
         * @author adufilie
         */
        var WeaveDataServlet_1 = void 0;
        var WeaveDataServlet = WeaveDataServlet_1 = function () {
            function WeaveDataServlet() {
                var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                _classCallCheck(this, WeaveDataServlet);

                this.map_method_name = new Map(); // Function -> String
                this._serverInfo = null;
                //////////////////
                // Authentication
                this._authenticationRequired = false;
                this._user = null;
                this._pass = null;
                this._promisesPendingAuthentication = [];
                this.servlet = Weave.linkableChild(this, new net.AMF3Servlet(url || WeaveDataServlet_1.DEFAULT_URL, false));
            }
            ////////////////////
            // Helper functions


            _createClass(WeaveDataServlet, [{
                key: "getMethodName",
                value: function getMethodName(method) {
                    if (Weave.IS(method, String)) return Weave.AS(method, String);
                    if (!this.map_method_name.has(method)) {
                        var _iteratorNormalCompletion69 = true;
                        var _didIteratorError69 = false;
                        var _iteratorError69 = undefined;

                        try {
                            for (var _iterator69 = (JS.getPropertyNames(this, true) || [])[Symbol.iterator](), _step69; !(_iteratorNormalCompletion69 = (_step69 = _iterator69.next()).done); _iteratorNormalCompletion69 = true) {
                                var name = _step69.value;

                                if (this[name] === method) {
                                    this.map_method_name.set(method, name);
                                    return name;
                                }
                            }
                        } catch (err) {
                            _didIteratorError69 = true;
                            _iteratorError69 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion69 && _iterator69.return) {
                                    _iterator69.return();
                                }
                            } finally {
                                if (_didIteratorError69) {
                                    throw _iteratorError69;
                                }
                            }
                        }
                    }
                    return this.map_method_name.get(method);
                }
                /**
                 * This function will generate a AsyncToken representing a servlet method invocation.
                 * @param method A WeaveAdminService class member function or a String.
                 * @param parameters Parameters for the servlet method.
                 * @param returnType_or_castFunction
                 *     Either the type of object (Class) returned by the service or a Function that converts an Object to the appropriate type.
                 *     If the service returns an Array of objects, each object in the Array will be cast to this type.
                 *     The object(s) returned by the service will be cast to this type by copying the public properties of the objects.
                 *     It is unnecessary to specify this parameter if the return type is a primitive value.
                 * @return The AsyncToken object representing the servlet method invocation.
                 */

            }, {
                key: "invoke",
                value: function invoke(method, parameters) {
                    var _this142 = this;

                    var returnType_or_castFunction = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    parameters = JS.toArray(parameters) || parameters;
                    var methodName = this.getMethodName(method);
                    if (!methodName) throw new Error("method must be a member of " + Weave.className(this));
                    var promise = this.servlet.invokeAsyncMethod(methodName, parameters);
                    var promiseThen = promise;
                    if (!this._authenticationRequired) this.servlet.invokeDeferred(promise);
                    if (returnType_or_castFunction) {
                        if (!(Weave.IS(returnType_or_castFunction, Function) || JS.isClass(returnType_or_castFunction))) throw new Error("returnType_or_castFunction parameter must either be a Class or a Function");
                        if ([Array, String, Number].indexOf(returnType_or_castFunction) < 0) promiseThen = promise.then(WeaveDataServlet_1.castResult.bind(this, returnType_or_castFunction), function (error) {
                            if (error.code == WeaveDataServlet_1.WEAVE_AUTHENTICATION_EXCEPTION) {
                                _this142._authenticationRequired = true;
                                _this142._promisesPendingAuthentication.push(promise);
                            } else JS.error(error);
                        });
                    }
                    return promiseThen;
                }
            }, {
                key: "authenticate",

                /**
                 * Authenticates with the server.
                 * @param user
                 * @param pass
                 */
                value: function authenticate(user, pass) {
                    if (user && pass) {
                        this._user = user;
                        this._pass = pass;
                        var promise = this.invoke(this.authenticate, arguments);
                        promise.then(this.handleAuthenticateResult.bind(this), this.handleAuthenticateFault.bind(this));
                        // check if we have to invoke manually
                        if (this._authenticationRequired) this.servlet.invokeDeferred(promise);
                    } else {
                        this._user = null;
                        this._pass = null;
                    }
                }
            }, {
                key: "handleAuthenticateResult",
                value: function handleAuthenticateResult() {
                    while (this._promisesPendingAuthentication.length) {
                        this.servlet.invokeDeferred(Weave.AS(this._promisesPendingAuthentication.shift(), WeavePromise));
                    }this.getServerInfo()[WeaveDataServlet_1.AUTHENTICATED_USER] = this._user;
                }
            }, {
                key: "handleAuthenticateFault",
                value: function handleAuthenticateFault() {
                    this._user = null;
                    this._pass = null;
                }
                ////////////////
                // Server info

            }, {
                key: "getServerInfo",
                value: function getServerInfo() {
                    var _this143 = this;

                    if (!this._serverInfo) {
                        // setting _serverInfo to non-object until promise is resolved
                        this._serverInfo = true;
                        this.invoke(this.getServerInfo, arguments).then(function (result) {
                            _this143._serverInfo = result || {};
                        }, function (error) {
                            _this143._serverInfo = { "error": error };
                        });
                    }
                    // return null until promise is resolved
                    return _typeof(this._serverInfo) === 'object' ? this._serverInfo : null;
                }
                ////////////////////
                // DataEntity info

            }, {
                key: "getHierarchyInfo",
                value: function getHierarchyInfo(publicMetadata) {
                    return this.invoke(this.getHierarchyInfo, arguments, EntityHierarchyInfo);
                }
            }, {
                key: "getEntities",
                value: function getEntities(ids) {
                    return this.invoke(this.getEntities, arguments, Entity);
                }
            }, {
                key: "findEntityIds",
                value: function findEntityIds(publicMetadata, wildcardFields) {
                    return this.invoke(this.findEntityIds, arguments);
                }
            }, {
                key: "findPublicFieldValues",
                value: function findPublicFieldValues(fieldName, valueSearch) {
                    return this.invoke(this.findPublicFieldValues, arguments);
                }
                ////////////////////////////////////
                // string and numeric data columns

            }, {
                key: "getColumn",
                value: function getColumn(columnId, minParam, maxParam, sqlParams) {
                    return this.invoke(this.getColumn, arguments, AttributeColumnData);
                }
            }, {
                key: "getTable",
                value: function getTable(id, sqlParams) {
                    return this.invoke(this.getTable, arguments, TableData);
                }
                /////////////////////
                // Geometry columns

            }, {
                key: "getGeometryStreamTileDescriptors",
                value: function getGeometryStreamTileDescriptors(columnId) {
                    return this.invoke(this.getGeometryStreamTileDescriptors, arguments, GeometryStreamMetadata);
                }
            }, {
                key: "getGeometryStreamMetadataTiles",
                value: function getGeometryStreamMetadataTiles(columnId, tileIDs) {
                    return this.invoke(this.getGeometryStreamMetadataTiles, arguments);
                }
            }, {
                key: "getGeometryStreamGeometryTiles",
                value: function getGeometryStreamGeometryTiles(columnId, tileIDs) {
                    return this.invoke(this.getGeometryStreamGeometryTiles, arguments);
                }
            }, {
                key: "createTileService",
                value: function createTileService(columnId) {
                    var tileService = new WeaveGeometryTileServlet(this, columnId);
                    // when we dispose this servlet, we also want to dispose the spawned tile servlet
                    Weave.disposableChild(this, tileService);
                    return tileService;
                }
                //////////////
                // Row query

            }, {
                key: "getRows",
                value: function getRows(keys) {
                    var keysArray = [];
                    var _iteratorNormalCompletion70 = true;
                    var _didIteratorError70 = false;
                    var _iteratorError70 = undefined;

                    try {
                        for (var _iterator70 = keys[Symbol.iterator](), _step70; !(_iteratorNormalCompletion70 = (_step70 = _iterator70.next()).done); _iteratorNormalCompletion70 = true) {
                            var key = _step70.value;

                            keysArray.push(key.localName);
                        }
                    } catch (err) {
                        _didIteratorError70 = true;
                        _iteratorError70 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion70 && _iterator70.return) {
                                _iterator70.return();
                            }
                        } finally {
                            if (_didIteratorError70) {
                                throw _iteratorError70;
                            }
                        }
                    }

                    var keytype = Weave.AS(keys[0], IQualifiedKey).keyType;
                    return this.invoke(this.getRows, [keytype, keysArray]);
                }
                ////////////////////////////
                // backwards compatibility
                /**
                 * Deprecated. Use getColumn() instead.
                 */

            }, {
                key: "getColumnFromMetadata",
                value: function getColumnFromMetadata(metadata) {
                    return this.invoke(this.getColumnFromMetadata, arguments, AttributeColumnData);
                }
            }, {
                key: "authenticationSupported",

                /**
                 * Check this to determine if authenticate() may be necessary.
                 * @return true if authenticate() may be necessary.
                 */
                get: function get() {
                    var info = this.getServerInfo();
                    return info && info['hasDirectoryService'];
                }
                /**
                 * Check this to determine if authenticate() must be called.
                 * @return true if authenticate() should be called.
                 */

            }, {
                key: "authenticationRequired",
                get: function get() {
                    return this._authenticationRequired && !this._user && !this._pass;
                }
            }, {
                key: "authenticatedUser",
                get: function get() {
                    var info = this.getServerInfo();
                    return info ? info[WeaveDataServlet_1.AUTHENTICATED_USER] : null;
                }
            }, {
                key: "entityServiceInitialized",
                get: function get() {
                    return this.getServerInfo() != null;
                }
            }], [{
                key: "castResult",
                value: function castResult(cast, originalResult) {
                    var results = Weave.AS(originalResult, Array) || [originalResult];
                    for (var i = 0; i < results.length; i++) {
                        if (JS.isClass(cast)) {
                            var resultItem = results[i];
                            if (resultItem === null || Weave.IS(resultItem, JS.asClass(cast))) continue;
                            var newResult = new cast();
                            for (var key in resultItem) {
                                newResult[key] = resultItem[key];
                            }results[i] = newResult;
                        } else {
                            results[i] = cast(results[i]);
                        }
                    }
                    return originalResult === results ? results : results[0];
                }
            }]);

            return WeaveDataServlet;
        }();
        WeaveDataServlet.DEFAULT_URL = '/WeaveServices/DataService';
        WeaveDataServlet.WEAVE_AUTHENTICATION_EXCEPTION = 'WeaveAuthenticationException';
        WeaveDataServlet.AUTHENTICATED_USER = 'authenticatedUser';
        WeaveDataServlet = WeaveDataServlet_1 = __decorate([Weave.classInfo({ id: "weavejs.net.WeaveDataServlet", interfaces: [IWeaveEntityService] })], WeaveDataServlet);
        net.WeaveDataServlet = WeaveDataServlet;
        /**
         * This is an implementation of IWeaveGeometryTileService that uses a WeaveDataServlet as the tile source.
         *
         * @author adufilie
         */
        var WeaveGeometryTileServlet = function () {
            function WeaveGeometryTileServlet(service, columnId) {
                _classCallCheck(this, WeaveGeometryTileServlet);

                this._service = service;
                this._columnId = columnId;
            }

            _createClass(WeaveGeometryTileServlet, [{
                key: "getMetadataTiles",
                value: function getMetadataTiles(tileIDs) {
                    var token = this._service.getGeometryStreamMetadataTiles(this._columnId, tileIDs);
                    WeaveAPI.ProgressIndicator.addTask(token, this);
                    return token;
                }
            }, {
                key: "getGeometryTiles",
                value: function getGeometryTiles(tileIDs) {
                    var token = this._service.getGeometryStreamGeometryTiles(this._columnId, tileIDs);
                    WeaveAPI.ProgressIndicator.addTask(token, this);
                    return token;
                }
            }]);

            return WeaveGeometryTileServlet;
        }();
        WeaveGeometryTileServlet = __decorate([Weave.classInfo({ id: "weavejs.net.WeaveGeometryTileServlet", linkable: true })], WeaveGeometryTileServlet);
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var api;
    (function (api) {
        var net;
        (function (net) {
            var IWeaveEntityService = weavejs.api.net.IWeaveEntityService;
            /**
             * Interface for a service which provides RPC functions for retrieving and manipulating Weave Entity information.
             * @author adufilie
             */
            var IWeaveEntityManagementService = function (_IWeaveEntityService) {
                _inherits(IWeaveEntityManagementService, _IWeaveEntityService);

                function IWeaveEntityManagementService() {
                    _classCallCheck(this, IWeaveEntityManagementService);

                    return _possibleConstructorReturn(this, (IWeaveEntityManagementService.__proto__ || Object.getPrototypeOf(IWeaveEntityManagementService)).apply(this, arguments));
                }

                return IWeaveEntityManagementService;
            }(IWeaveEntityService);
            IWeaveEntityManagementService = __decorate([Weave.classInfo({ id: "weavejs.api.net.IWeaveEntityManagementService" })], IWeaveEntityManagementService);
            net.IWeaveEntityManagementService = IWeaveEntityManagementService;
        })(net = api.net || (api.net = {}));
    })(api = weavejs.api || (weavejs.api = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var IWeaveEntityManagementService = weavejs.api.net.IWeaveEntityManagementService;
        var Entity = weavejs.api.net.beans.Entity;
        var EntityHierarchyInfo = weavejs.api.net.beans.EntityHierarchyInfo;
        var CallbackCollection = weavejs.core.CallbackCollection;
        var LinkableBoolean = weavejs.core.LinkableBoolean;
        var ConnectionInfo = weavejs.net.beans.ConnectionInfo;
        var DatabaseConfigInfo = weavejs.net.beans.DatabaseConfigInfo;
        var WeaveFileInfo = weavejs.net.beans.WeaveFileInfo;
        var JS = weavejs.util.JS;
        var StandardLib = weavejs.util.StandardLib;
        /**
         * The functions in this class correspond directly to Weave servlet functions written in Java.
         * This object uses a queue to guarantee that asynchronous servlet calls will execute in the order they are requested.
         * @author adufilie
         * @see WeaveServices/src/weave/servlets/AdminService.java
         * @see WeaveServices/src/weave/servlets/DataService.java
         */
        var WeaveAdminService_1 = void 0;
        var WeaveAdminService = WeaveAdminService_1 = function () {
            /**
             * @param url The URL pointing to where a WeaveServices.war has been deployed.  Example: http://example.com/WeaveServices
             */
            /*private*/function WeaveAdminService(url) {
                _classCallCheck(this, WeaveAdminService);

                this.map_method_name = new Map(); // method->string
                this.methodHooks = {}; // methodName -> Array (of MethodHook)
                /*Bindable*/this.initialized = false;
                /*Bindable*/this.migrationProgress = '';
                //TODO - move hooks from Admin.as to here, and automatically set these user/pass/authenticated settings
                this.authenticated = Weave.linkableChild(this, new LinkableBoolean(false));
                /*Bindable*/this.user = '';
                /*Bindable*/this.pass = '';
                this.adminService = Weave.linkableChild(this, new net.AMF3Servlet(url + "/AdminService", false));
                this.dataService = Weave.linkableChild(this, new net.AMF3Servlet(url + "/DataService", false));
                this.resetQueue();
                this.initializeAdminService();
            }

            _createClass(WeaveAdminService, [{
                key: "getMethodName",
                value: function getMethodName(method) {
                    if (Weave.IS(method, String)) return method;
                    if (!this.map_method_name.has(method)) {
                        var _iteratorNormalCompletion71 = true;
                        var _didIteratorError71 = false;
                        var _iteratorError71 = undefined;

                        try {
                            for (var _iterator71 = JS.getPropertyNames(this, true)[Symbol.iterator](), _step71; !(_iteratorNormalCompletion71 = (_step71 = _iterator71.next()).done); _iteratorNormalCompletion71 = true) {
                                var name = _step71.value;

                                if (this[name] === method) {
                                    this.map_method_name.set(method, name);
                                    return name;
                                }
                            }
                        } catch (err) {
                            _didIteratorError71 = true;
                            _iteratorError71 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion71 && _iterator71.return) {
                                    _iterator71.return();
                                }
                            } finally {
                                if (_didIteratorError71) {
                                    throw _iteratorError71;
                                }
                            }
                        }
                    }
                    return this.map_method_name.get(method);
                }
            }, {
                key: "resetQueue",
                value: function resetQueue() {
                    if (this.queue) Weave.dispose(this.queue);
                    this.queue = Weave.linkableChild(this, new net.AsyncInvocationQueue(!this.initialized)); // paused if not initialized
                }
            }, {
                key: "initializeAdminService",

                //////////////////////////////
                // Initialization
                value: function initializeAdminService() {
                    var _this145 = this;

                    var req = new net.URLRequest(this.adminService.servletURL);
                    return this.invokeAdmin(this.initializeAdminService, arguments, false).then(function () {
                        return _this145.initializeAdminServiceComplete();
                    }, function (error) {
                        return _this145.initializeAdminServiceError(error);
                    });
                }
            }, {
                key: "initializeAdminServiceComplete",
                value: function initializeAdminServiceComplete() {
                    this.initialized = true;
                    this.queue.begin();
                }
            }, {
                key: "initializeAdminServiceError",
                value: function initializeAdminServiceError(error) {
                    //fixErrorMessage(error);
                    WeaveAdminService_1.messageDisplay(null, error, false);
                }
                /**
                 * @param method A pointer to a function of this WeaveAdminService.
                 * @param captureHandler Receives the parameters of the RPC call with the 'this' pointer set to the WeavePromise object.
                 * @param resultHandler A ResultEvent handler:  function(event:ResultEvent, parameters:Array = null):void
                 * @param faultHandler A FaultEvent handler:  function(event:FaultEvent, parameters:Array = null):void
                 */

            }, {
                key: "addHook",
                value: function addHook(method, captureHandler, resultHandler) {
                    var faultHandler = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    var methodName = this.getMethodName(method);
                    if (!methodName) throw new Error("method must be a member of WeaveAdminService");
                    var hooks = this.methodHooks[methodName];
                    if (!hooks) this.methodHooks[methodName] = hooks = [];
                    var hook = new MethodHook();
                    hook.captureHandler = captureHandler;
                    hook.resultHandler = resultHandler;
                    hook.faultHandler = faultHandler;
                    hooks.push(hook);
                }
            }, {
                key: "hookCaptureHandler",
                value: function hookCaptureHandler(methodName, methodParams, query) {
                    var _iteratorNormalCompletion72 = true;
                    var _didIteratorError72 = false;
                    var _iteratorError72 = undefined;

                    try {
                        for (var _iterator72 = (this.methodHooks[methodName] || [])[Symbol.iterator](), _step72; !(_iteratorNormalCompletion72 = (_step72 = _iterator72.next()).done); _iteratorNormalCompletion72 = true) {
                            var hook = _step72.value;

                            if (hook.captureHandler == null) continue;
                            var args = methodParams ? methodParams.concat() : [];
                            args.length = hook.captureHandler.length;
                            hook.captureHandler.apply(query, args);
                        }
                    } catch (err) {
                        _didIteratorError72 = true;
                        _iteratorError72 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion72 && _iterator72.return) {
                                _iterator72.return();
                            }
                        } finally {
                            if (_didIteratorError72) {
                                throw _iteratorError72;
                            }
                        }
                    }
                }
                /**
                 * This gets called automatically for each ResultEvent from an RPC.
                 * @param method The WeaveAdminService function which corresponds to the RPC.
                 */

            }, {
                key: "hookHandler",
                value: function hookHandler(methodName, methodParams, result) {
                    var handler;
                    var _iteratorNormalCompletion73 = true;
                    var _didIteratorError73 = false;
                    var _iteratorError73 = undefined;

                    try {
                        for (var _iterator73 = (this.methodHooks[methodName] || [])[Symbol.iterator](), _step73; !(_iteratorNormalCompletion73 = (_step73 = _iterator73.next()).done); _iteratorNormalCompletion73 = true) {
                            var hook = _step73.value;

                            if (!Weave.IS(result, Error)) handler = hook.resultHandler;else handler = hook.faultHandler;
                            if (handler == null) continue;
                            var args = [result, methodParams];
                            args.length = handler.length;
                            handler.apply(null, args);
                        }
                    } catch (err) {
                        _didIteratorError73 = true;
                        _iteratorError73 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion73 && _iterator73.return) {
                                _iterator73.return();
                            }
                        } finally {
                            if (_didIteratorError73) {
                                throw _iteratorError73;
                            }
                        }
                    }
                }
                /**
                 * This function will generate a DelayedAsyncInvocation representing a servlet method invocation and add it to the queue.
                 * @param method A WeaveAdminService class member function.
                 * @param parameters Parameters for the servlet method.
                 * @param queued If true, the request will be put into the queue so only one request is made at a time.
                 * @return The DelayedAsyncInvocation object representing the servlet method invocation.
                 */

            }, {
                key: "invokeAdmin",
                value: function invokeAdmin(method, parameters) {
                    var queued = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
                    var returnType = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    var methodName = this.getMethodName(method);
                    if (!methodName) throw new Error("method must be a member of WeaveAdminService");
                    return this.generateQuery(this.adminService, methodName, Array.from(parameters), queued, returnType);
                }
                /**
                 * This function will generate a DelayedAsyncInvocation representing a servlet method invocation and add it to the queue.
                 * @param methodName The name of a Weave DataService servlet method.
                 * @param parameters Parameters for the servlet method.
                 * @param queued If true, the request will be put into the queue so only one request is made at a time.
                 * @return The DelayedAsyncInvocation object representing the servlet method invocation.
                 */

            }, {
                key: "invokeDataService",
                value: function invokeDataService(method, parameters) {
                    var queued = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
                    var returnType = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    var methodName = this.getMethodName(method);
                    if (!methodName) throw new Error("method must be a member of WeaveAdminService");
                    return this.generateQuery(this.dataService, methodName, Array.from(parameters), queued, returnType);
                }
                /**
                 * This function will generate a DelayedAsyncInvocation representing a servlet method invocation and add it to the queue.
                 * @param service The servlet.
                 * @param methodName The name of a servlet method.
                 * @param parameters Parameters for the servlet method.
                 * @param returnType The type of object which the result should be cast to.
                 * @return The WeavePromise<any> object representing the servlet method invocation.
                 */

            }, {
                key: "generateQuery",
                value: function generateQuery(service, methodName, parameters, queued, returnType) {
                    var query = service.invokeAsyncMethod(methodName, parameters);
                    var castedQuery;
                    if (queued) this.queue.addToQueue(query, service);
                    this.hookCaptureHandler(methodName, parameters, query);
                    if ([null, Array, String, Number].indexOf(returnType) < 0) {
                        castedQuery = query.then(net.WeaveDataServlet.castResult.bind(this, returnType));
                    } else {
                        castedQuery = query;
                    }
                    castedQuery.then(this.hookHandler.bind(this, methodName, parameters), this.interceptFault);
                    if (!queued) service.invokeDeferred(query);
                    return castedQuery;
                }
                // this function displays a String response from a server in an Alert box.

            }, {
                key: "alertResult",
                value: function alertResult(result) {
                    var token = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    WeaveAdminService_1.messageDisplay(null, result, false);
                }
                /**
                 * Prevents the default error display if a fault occurs.
                 * @param query A WeavePromise<any> that was generated by this service.
                 */

            }, {
                key: "hideFaultMessage",
                value: function hideFaultMessage(query) {
                    WeaveAdminService_1.PREVENT_FAULT_ALERT.set(query, true);
                }
            }, {
                key: "interceptFault",
                value: function interceptFault(error) {
                    // if user has been signed out, clear the queue immediately
                    //JS.error(error);
                    if (error == WeaveAdminService_1.WEAVE_AUTHENTICATION_EXCEPTION && this.authenticated.value) {
                        this.resetQueue();
                        this.authenticated.value = false;
                        this.user = '';
                        this.pass = '';
                    }
                }
                // this function displays an error message from a FaultEvent in an Alert box.

            }, {
                key: "alertFault",
                value: function alertFault(methodName, methodParams, query, error) {
                    //fixErrorMessage(event.fault);
                    if (WeaveAdminService_1.PREVENT_FAULT_ALERT.has(query)) {
                        WeaveAdminService_1.PREVENT_FAULT_ALERT['delete'](query);
                        return;
                    }
                    var paramDebugStr = '';
                    if (Weave.IS(methodParams, Array) && methodParams.length > 0) paramDebugStr = methodParams.map(function (p) {
                        return Weave.stringify(p);
                    }).join(', ');else paramDebugStr += Weave.stringify(methodParams);
                    JS.error(StandardLib.substitute("Received error on {0}({1}):\n\t{2}", methodName, paramDebugStr, error));
                    //Alert.show(event.fault.faultString, event.fault.name);
                    var msg = error.toString();
                    if (msg == "ioError") msg = "Received no response from the servlet.\n" + "Has the WAR file been deployed correctly?\n" + "Expected servlet URL: " + this.adminService.servletURL;
                    WeaveAdminService_1.messageDisplay(error, msg, false);
                }
            }, {
                key: "getVersion",
                value: function getVersion() {
                    return this.invokeAdmin(this.getVersion, arguments);
                }
            }, {
                key: "checkDatabaseConfigExists",
                value: function checkDatabaseConfigExists() {
                    return this.invokeAdmin(this.checkDatabaseConfigExists, arguments);
                }
            }, {
                key: "getAuthenticatedUser",
                value: function getAuthenticatedUser() {
                    return this.invokeAdmin(this.getAuthenticatedUser, arguments);
                }
            }, {
                key: "authenticate",
                value: function authenticate(user, pass) {
                    return this.invokeAdmin(this.authenticate, arguments);
                }
            }, {
                key: "keepAlive",
                value: function keepAlive() {
                    return this.invokeAdmin(this.keepAlive, arguments);
                }
                //////////////////////////////
                // Weave client config files

            }, {
                key: "getWeaveFileNames",
                value: function getWeaveFileNames(showAllFiles) {
                    return this.invokeAdmin(this.getWeaveFileNames, arguments);
                }
            }, {
                key: "saveWeaveFileByteArray",
                value: function saveWeaveFileByteArray(fileContent, fileName, overwriteFile) {
                    var base64 = btoa(StandardLib.byteArrayToString(fileContent));
                    return this.invokeAdmin(this.saveWeaveFileByteArray, [base64, fileName, overwriteFile]);
                }
            }, {
                key: "removeWeaveFile",
                value: function removeWeaveFile(fileName) {
                    return this.invokeAdmin(this.removeWeaveFile, arguments);
                }
            }, {
                key: "getWeaveFileInfo",
                value: function getWeaveFileInfo(fileName) {
                    return this.invokeAdmin(this.getWeaveFileInfo, arguments, false, WeaveFileInfo); // bypass queue
                }
                //////////////////////////////
                // ConnectionInfo management

            }, {
                key: "getConnectionNames",
                value: function getConnectionNames() {
                    return this.invokeAdmin(this.getConnectionNames, arguments);
                }
            }, {
                key: "getConnectionInfo",
                value: function getConnectionInfo(userToGet) {
                    return this.invokeAdmin(this.getConnectionInfo, arguments, true, ConnectionInfo);
                }
            }, {
                key: "saveConnectionInfo",
                value: function saveConnectionInfo(info, configOverwrite) {
                    return this.invokeAdmin(this.saveConnectionInfo, [info.name, info.pass, info.folderName, info.is_superuser, info.connectString, configOverwrite]);
                }
            }, {
                key: "removeConnectionInfo",
                value: function removeConnectionInfo(connectionNameToRemove) {
                    return this.invokeAdmin(this.removeConnectionInfo, arguments);
                }
                //////////////////////////////////
                // DatabaseConfigInfo management

            }, {
                key: "getDatabaseConfigInfo",
                value: function getDatabaseConfigInfo() {
                    return this.invokeAdmin(this.getDatabaseConfigInfo, arguments, true, DatabaseConfigInfo);
                }
            }, {
                key: "setDatabaseConfigInfo",
                value: function setDatabaseConfigInfo(connectionName, password, schema, idFields) {
                    return this.invokeAdmin(this.setDatabaseConfigInfo, arguments);
                }
                //////////////////////////
                // DataEntity management

            }, {
                key: "newEntity",
                value: function newEntity(metadata, parentId, insertAtIndex) {
                    return this.invokeAdmin(this.newEntity, arguments);
                }
            }, {
                key: "updateEntity",
                value: function updateEntity(entityId, diff) {
                    return this.invokeAdmin(this.updateEntity, arguments);
                }
            }, {
                key: "removeEntities",
                value: function removeEntities(entityIds) {
                    return this.invokeAdmin(this.removeEntities, arguments);
                }
            }, {
                key: "addChild",
                value: function addChild(parentId, childId, insertAtIndex) {
                    return this.invokeAdmin(this.addChild, arguments);
                }
            }, {
                key: "removeChild",
                value: function removeChild(parentId, childId) {
                    return this.invokeAdmin(this.removeChild, arguments);
                }
            }, {
                key: "getHierarchyInfo",
                value: function getHierarchyInfo(publicMetadata) {
                    return this.invokeAdmin(this.getHierarchyInfo, arguments, true, EntityHierarchyInfo);
                }
            }, {
                key: "getEntities",
                value: function getEntities(entityIds) {
                    return this.invokeAdmin(this.getEntities, arguments, true, Entity);
                }
            }, {
                key: "findEntityIds",
                value: function findEntityIds(publicMetadata, wildcardFields) {
                    return this.invokeAdmin(this.findEntityIds, arguments);
                }
            }, {
                key: "findPublicFieldValues",
                value: function findPublicFieldValues(fieldName, valueSearch) {
                    return this.invokeAdmin(this.findPublicFieldValues, arguments);
                }
                ///////////////////////
                // SQL info retrieval

            }, {
                key: "getSQLSchemaNames",
                value: function getSQLSchemaNames() {
                    return this.invokeAdmin(this.getSQLSchemaNames, arguments, false);
                }
            }, {
                key: "getSQLTableNames",
                value: function getSQLTableNames(schemaName) {
                    return this.invokeAdmin(this.getSQLTableNames, arguments, false);
                }
            }, {
                key: "getSQLColumnNames",
                value: function getSQLColumnNames(schemaName, tableName) {
                    return this.invokeAdmin(this.getSQLColumnNames, arguments, false);
                }
                /////////////////
                // File uploads

            }, {
                key: "uploadFileByteArray",
                value: function uploadFileByteArray(fileName, bytes) {
                    // queue up requests for uploading chunks at a time, then return the token of the last chunk
                    var MB = 1024 * 1024;
                    var maxChunkSize = 20 * MB;
                    var chunkSize = bytes.length > 5 * MB ? Math.min(bytes.length / 10, maxChunkSize) : MB;
                    var offset = 0;
                    var promise;
                    do {
                        var chunkLength = Math.min(chunkSize, bytes.length - offset);
                        var chunk = bytes.subarray(offset, offset + chunkLength);
                        offset += chunkLength;
                        var base64 = btoa(StandardLib.byteArrayToString(chunk));
                        promise = this.invokeAdmin(this.uploadFileByteArray, [fileName, base64, offset > 0], true); // queued -- important!
                    } while (offset < bytes.length);
                    return promise;
                }
            }, {
                key: "getUploadedCSVFiles",
                value: function getUploadedCSVFiles() {
                    return this.invokeAdmin(this.getUploadedCSVFiles, arguments, false, WeaveFileInfo);
                }
            }, {
                key: "getUploadedSHPFiles",
                value: function getUploadedSHPFiles() {
                    return this.invokeAdmin(this.getUploadedSHPFiles, arguments, false, WeaveFileInfo);
                }
            }, {
                key: "getCSVColumnNames",
                value: function getCSVColumnNames(csvFiles) {
                    return this.invokeAdmin(this.getCSVColumnNames, arguments);
                }
            }, {
                key: "getDBFColumnNames",
                value: function getDBFColumnNames(dbfFileNames) {
                    return this.invokeAdmin(this.getDBFColumnNames, arguments);
                }
                /////////////////////////////////
                // Key column uniqueness checks

            }, {
                key: "checkKeyColumnsForSQLImport",
                value: function checkKeyColumnsForSQLImport(schemaName, tableName, keyColumns) {
                    return this.invokeAdmin(this.checkKeyColumnsForSQLImport, arguments);
                }
            }, {
                key: "checkKeyColumnsForCSVImport",
                value: function checkKeyColumnsForCSVImport(csvFileName, keyColumns) {
                    return this.invokeAdmin(this.checkKeyColumnsForCSVImport, arguments);
                }
            }, {
                key: "checkKeyColumnsForDBFImport",
                value: function checkKeyColumnsForDBFImport(dbfFileNames, keyColumns) {
                    return this.invokeAdmin(this.checkKeyColumnsForDBFImport, arguments);
                }
                ////////////////
                // Data import

            }, {
                key: "importCSV",
                value: function importCSV(csvFile, csvKeyColumn, csvSecondaryKeyColumn, sqlSchema, sqlTable, sqlOverwrite, configDataTableName, configKeyType, nullValues, filterColumnNames, configAppend) {
                    return this.invokeAdmin(this.importCSV, arguments);
                }
            }, {
                key: "importSQL",
                value: function importSQL(schemaName, tableName, keyColumnName, secondaryKeyColumnName, configDataTableName, keyType, filterColumns, configAppend) {
                    return this.invokeAdmin(this.importSQL, arguments);
                }
            }, {
                key: "importSHP",
                value: function importSHP(configfileNameWithoutExtension, keyColumns, sqlSchema, sqlTablePrefix, sqlOverwrite, configTitle, configKeyType, configProjection, nullValues, importDBFAsDataTable, configAppend) {
                    return this.invokeAdmin(this.importSHP, arguments);
                }
            }, {
                key: "importDBF",
                value: function importDBF(fileNameWithoutExtension, sqlSchema, sqlTableName, sqlOverwrite, nullValues) {
                    return this.invokeAdmin(this.importDBF, arguments);
                }
                //////////////////////
                // SQL query testing

            }, {
                key: "testAllQueries",
                value: function testAllQueries(tableId) {
                    return this.invokeAdmin(this.testAllQueries, arguments, false);
                }
                //////////////////
                // Miscellaneous

            }, {
                key: "getKeyTypes",
                value: function getKeyTypes() {
                    return this.invokeAdmin(this.getKeyTypes, arguments);
                }
                // this function is for verifying the local connection between Weave and the AdminConsole.

            }, {
                key: "ping",
                value: function ping() {
                    return "pong";
                }
                //////////////////////////
                // DataService functions

            }, {
                key: "getAttributeColumn",
                value: function getAttributeColumn(metadata) {
                    return this.invokeDataService(this.getAttributeColumn, arguments, false);
                }
            }, {
                key: "entityServiceInitialized",
                get: function get() {
                    return this.authenticated.value;
                }
            }], [{
                key: "getInstance",
                value: function getInstance(url) {
                    if (this._map_url_instance.has(url)) {
                        return this._map_url_instance.get(url);
                    }
                    var serviceInstance = new WeaveAdminService_1(url);
                    this._map_url_instance.set(url, serviceInstance);
                    return serviceInstance;
                }
            }, {
                key: "messageDisplay",
                value: function messageDisplay(messageTitle, message, showPopup) {
                    // for errors, both a popupbox and addition in the Log takes place
                    // for successes, only addition in Log takes place
                    if (showPopup) alert(message); //, messageTitle);
                    // always add the message to the log
                    if (messageTitle == null) this.messageLog.push(message);else this.messageLog.push(messageTitle + ": " + message);
                    this.messageLogCallbacks.triggerCallbacks();
                }
            }, {
                key: "clearMessageLog",
                value: function clearMessageLog() {
                    this.messageLog.length = 0;
                    this.messageLogCallbacks.triggerCallbacks();
                }
            }]);

            return WeaveAdminService;
        }();
        WeaveAdminService.WEAVE_AUTHENTICATION_EXCEPTION = 'WeaveAuthenticationException';
        WeaveAdminService._map_url_instance = new Map();
        WeaveAdminService.messageLog = new Array();
        WeaveAdminService.messageLogCallbacks = new CallbackCollection();
        WeaveAdminService.PREVENT_FAULT_ALERT = new WeakMap();
        WeaveAdminService = WeaveAdminService_1 = __decorate([Weave.classInfo({ id: "weavejs.net.WeaveAdminService", interfaces: [IWeaveEntityManagementService] })], WeaveAdminService);
        net.WeaveAdminService = WeaveAdminService;

        var MethodHook = function MethodHook() {
            _classCallCheck(this, MethodHook);
        };
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var net;
    (function (net) {
        var WeaveAPI = weavejs.WeaveAPI;
        var IDisposableObject = weavejs.api.core.IDisposableObject;
        var ColumnMetadata = weavejs.api.data.ColumnMetadata;
        var EntityType = weavejs.api.data.EntityType;
        var Entity = weavejs.api.net.beans.Entity;
        var EntityHierarchyInfo = weavejs.api.net.beans.EntityHierarchyInfo;
        var EntityMetadata = weavejs.api.net.beans.EntityMetadata;
        var CallbackUtils = weavejs.util.CallbackUtils;
        var JS = weavejs.util.JS;
        /**
         * Provides an interface to a set of cached Entity objects.
         */
        var EntityCache_1 = void 0;
        var EntityCache = EntityCache_1 = function () {
            /**
             * Creates an EntityCache.
             * @param service The entity service, which may or may not implement IWeaveEntityManagementService.
             * @param purgeMissingEntities Set this to true when entities may be deleted or created and ids previously deleted may be reused.
             */
            function EntityCache(service) {
                var purgeMissingEntities = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                _classCallCheck(this, EntityCache);

                this.service = null;
                this.adminService = null; // service as IWeaveEntityManagementService
                this.idsToFetch = {}; // id -> Boolean
                this.entityCache = {}; // id -> Array <Entity>
                this.idsToDelete = {}; // id -> Boolean
                this._idsByType = {}; // entityType -> Array of id
                this._infoLookup = {}; // id -> EntityHierarchyInfo
                this.idsDirty = {}; // id -> Boolean; used to remember which ids to invalidate the next time the entity is requested
                this.purgeMissingEntities = false;
                this.purgeMissingEntities = purgeMissingEntities;
                this.service = service;
                this.adminService = service;
                Weave.linkableChild(this, service);
                // Generate a delayed callback so other grouped callbacks would not cause it to trigger immediately.
                // This is important for grouping entity requests.
                this.callbacks.addImmediateCallback(this, CallbackUtils.generateDelayedCallback(this, this.delayedCallback, 0));
            }

            _createClass(EntityCache, [{
                key: "getService",

                /**
                 * Gets the IWeaveEntityService that was passed to the constructor.
                 */
                value: function getService() {
                    return this.service;
                }
                /**
                 * Checks if a specific parent-child relationship has been cached.
                 * @param parentId The ID of the parent entity.
                 * @param childId The ID of the child entity.
                 * @return true if the relationship has been cached.
                 */

            }, {
                key: "hasCachedRelationship",
                value: function hasCachedRelationship(parentId, childId) {
                    if (this.entityCache[parentId] && (!this.idsToFetch[parentId] || !this.entityCache[childId])) return Weave.AS(this.entityCache[parentId], Entity).hasChild(childId);
                    if (this.entityCache[childId]) return Weave.AS(this.entityCache[childId], Entity).hasParent(parentId);
                    return false;
                }
                /**
                 * Invalidates a cached Entity object and optionally invalidates any related Entity objects.
                 * @param id The entity ID.
                 * @param alsoInvalidateRelatives Set this to true if any hierarchy relationships may have been altered.
                 */

            }, {
                key: "invalidate",
                value: function invalidate(id) {
                    var alsoInvalidateRelatives = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                    if (Weave.wasDisposed(this)) return;
                    //trace('invalidate',id, alsoInvalidateRelatives, entityCache[id]);
                    this.callbacks.delayCallbacks();
                    WeaveAPI.SessionManager.assignBusyTask(this.delayedCallback, this);
                    // trigger callbacks if we haven't previously decided to fetch this id
                    if (!this.idsToFetch[id]) this.callbacks.triggerCallbacks();
                    this.idsDirty[id] = false;
                    this.idsToFetch[id] = true;
                    if (!this.entityCache[id]) this.entityCache[id] = new Entity(this._infoLookup[id]);
                    if (alsoInvalidateRelatives) {
                        var children = Weave.AS(this.entityCache[id], Entity).childIds;
                        if (children && children.length) {
                            var _iteratorNormalCompletion74 = true;
                            var _didIteratorError74 = false;
                            var _iteratorError74 = undefined;

                            try {
                                for (var _iterator74 = children[Symbol.iterator](), _step74; !(_iteratorNormalCompletion74 = (_step74 = _iterator74.next()).done); _iteratorNormalCompletion74 = true) {
                                    var childId = _step74.value;

                                    this.invalidate(childId);
                                }
                            } catch (err) {
                                _didIteratorError74 = true;
                                _iteratorError74 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion74 && _iterator74.return) {
                                        _iterator74.return();
                                    }
                                } finally {
                                    if (_didIteratorError74) {
                                        throw _iteratorError74;
                                    }
                                }
                            }
                        }
                        var parents = Weave.AS(this.entityCache[id], Entity).parentIds;
                        if (parents && parents.length) {
                            var _iteratorNormalCompletion75 = true;
                            var _didIteratorError75 = false;
                            var _iteratorError75 = undefined;

                            try {
                                for (var _iterator75 = parents[Symbol.iterator](), _step75; !(_iteratorNormalCompletion75 = (_step75 = _iterator75.next()).done); _iteratorNormalCompletion75 = true) {
                                    var parentId = _step75.value;

                                    this.invalidate(parentId);
                                }
                            } catch (err) {
                                _didIteratorError75 = true;
                                _iteratorError75 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion75 && _iterator75.return) {
                                        _iterator75.return();
                                    }
                                } finally {
                                    if (_didIteratorError75) {
                                        throw _iteratorError75;
                                    }
                                }
                            }
                        } else {
                            // invalidate root when child has no parents
                            this.invalidate(EntityCache_1.ROOT_ID);
                        }
                    }
                    this.callbacks.resumeCallbacks();
                }
                /**
                 * Retrieves an Entity object given its ID.
                 * @param id The entity ID.
                 * @return The Entity object.
                 */

            }, {
                key: "getEntity",
                value: function getEntity(id) {
                    // if there is no cached value, call invalidate() to create a placeholder.
                    if (!this.entityCache[id] || this.idsDirty[id]) this.invalidate(id);
                    return Weave.AS(this.entityCache[id], Entity);
                }
                /**
                 * Checks if a particular Entity object is cached.
                 * @param The entity ID.
                 * @return true if the corresponding Entity object exists in the cache.
                 */

            }, {
                key: "entityIsCached",
                value: function entityIsCached(id) {
                    var entity = Weave.AS(this.entityCache[id], Entity);
                    return entity && entity.initialized;
                }
            }, {
                key: "delayedCallback",
                value: function delayedCallback() {
                    if (!this.service.entityServiceInitialized) return;
                    // delete marked entities
                    var deleted = false;
                    var idsToRemove = [];
                    for (var id in this.idsToDelete) {
                        idsToRemove.push(Number(id));
                    }if (this.adminService && idsToRemove.length) {
                        this.adminService.removeEntities(idsToRemove).then(this.handleIdsToInvalidate.bind(this, true));
                        this.idsToDelete = {};
                    }
                    // request invalidated entities
                    var ids = [];
                    for (var id in this.idsToFetch) {
                        // when requesting root, also request data table list
                        if (Number(id) == EntityCache_1.ROOT_ID) {
                            var tableMetadata = {};
                            tableMetadata.entityType = EntityType.TABLE;
                            this.service.getHierarchyInfo(tableMetadata).then(this.handleEntityHierarchyInfo.bind(this, tableMetadata));
                            var hierarchyMetadata = {};
                            hierarchyMetadata.entityType = EntityType.HIERARCHY;
                            this.service.getHierarchyInfo(hierarchyMetadata).then(this.handleEntityHierarchyInfo.bind(this, hierarchyMetadata));
                        } else ids.push(int(id));
                    }
                    delete this.idsToFetch[EntityCache_1.ROOT_ID];
                    if (ids.length > 0) this.idsToFetch = {};
                    while (ids.length > 0) {
                        var splicedIds = ids.splice(0, EntityCache_1.MAX_ENTITY_REQUEST_COUNT);
                        this.service.getEntities(splicedIds).then(this.getEntityHandler.bind(this, splicedIds));
                    }
                    WeaveAPI.SessionManager.unassignBusyTask(this.delayedCallback);
                }
            }, {
                key: "handleIdsToInvalidate",
                value: function handleIdsToInvalidate(alsoInvalidateRelatives, result) {
                    this.callbacks.delayCallbacks();
                    var _iteratorNormalCompletion76 = true;
                    var _didIteratorError76 = false;
                    var _iteratorError76 = undefined;

                    try {
                        for (var _iterator76 = (result || [])[Symbol.iterator](), _step76; !(_iteratorNormalCompletion76 = (_step76 = _iterator76.next()).done); _iteratorNormalCompletion76 = true) {
                            var id = _step76.value;

                            this.invalidate(id, alsoInvalidateRelatives);
                        }
                    } catch (err) {
                        _didIteratorError76 = true;
                        _iteratorError76 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion76 && _iterator76.return) {
                                _iterator76.return();
                            }
                        } finally {
                            if (_didIteratorError76) {
                                throw _iteratorError76;
                            }
                        }
                    }

                    this.callbacks.resumeCallbacks();
                }
            }, {
                key: "getEntityHandler",
                value: function getEntityHandler(requestedIds, result) {
                    var info;
                    // reset all requested entities in case they do not appear in the results
                    var _iteratorNormalCompletion77 = true;
                    var _didIteratorError77 = false;
                    var _iteratorError77 = undefined;

                    try {
                        for (var _iterator77 = (requestedIds || [])[Symbol.iterator](), _step77; !(_iteratorNormalCompletion77 = (_step77 = _iterator77.next()).done); _iteratorNormalCompletion77 = true) {
                            var id = _step77.value;

                            // make sure cached object is empty
                            entity = this.entityCache[id] || new Entity();
                            entity.reset();
                            this.entityCache[id] = entity;
                            this.idsDirty[id] = true;
                        }
                    } catch (err) {
                        _didIteratorError77 = true;
                        _iteratorError77 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion77 && _iterator77.return) {
                                _iterator77.return();
                            }
                        } finally {
                            if (_didIteratorError77) {
                                throw _iteratorError77;
                            }
                        }
                    }

                    var _iteratorNormalCompletion78 = true;
                    var _didIteratorError78 = false;
                    var _iteratorError78 = undefined;

                    try {
                        for (var _iterator78 = (result || [])[Symbol.iterator](), _step78; !(_iteratorNormalCompletion78 = (_step78 = _iterator78.next()).done); _iteratorNormalCompletion78 = true) {
                            var entity = _step78.value;

                            if (!entity.parentIds) entity.parentIds = [];
                            if (!entity.childIds) entity.childIds = [];
                            id = entity.id;
                            this.entityCache[id] = entity;
                            this.idsDirty[id] = false;
                            info = this._infoLookup[id];
                            if (info) {
                                info.entityType = entity.publicMetadata.entityType;
                                info.title = entity.publicMetadata.title;
                                info.numChildren = entity.childIds.length;
                            }
                        }
                        // for each id not appearing in result, delete _infoLookup[id]
                    } catch (err) {
                        _didIteratorError78 = true;
                        _iteratorError78 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion78 && _iterator78.return) {
                                _iterator78.return();
                            }
                        } finally {
                            if (_didIteratorError78) {
                                throw _iteratorError78;
                            }
                        }
                    }

                    var _iteratorNormalCompletion79 = true;
                    var _didIteratorError79 = false;
                    var _iteratorError79 = undefined;

                    try {
                        for (var _iterator79 = (requestedIds || [])[Symbol.iterator](), _step79; !(_iteratorNormalCompletion79 = (_step79 = _iterator79.next()).done); _iteratorNormalCompletion79 = true) {
                            var id = _step79.value;

                            if (this.idsDirty[id]) {
                                if (this.purgeMissingEntities) {
                                    delete this._infoLookup[id];
                                } else {
                                    // display an error and stop requesting the missing entity
                                    info = this._infoLookup[id] || new EntityHierarchyInfo();
                                    info.id = id;
                                    info.numChildren = 0;
                                    info.title = Weave.lang("[Error: Entity #{0} does not exist]", id);
                                    this._infoLookup[id] = info;
                                    this.idsDirty[id] = false;
                                }
                            }
                        }
                    } catch (err) {
                        _didIteratorError79 = true;
                        _iteratorError79 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion79 && _iterator79.return) {
                                _iterator79.return();
                            }
                        } finally {
                            if (_didIteratorError79) {
                                throw _iteratorError79;
                            }
                        }
                    }

                    this.callbacks.triggerCallbacks();
                }
                /**
                 * Calls getHierarchyInfo() in the IWeaveEntityService that was passed to the constructor and caches
                 * the results when they come back.
                 * @param publicMetadata Public metadata search criteria.
                 * @return RPC token for an Array of EntityHierarchyInfo objects.
                 * @see weavejs.api.net.IWeaveEntityService#getHierarchyInfo()
                 */

            }, {
                key: "getHierarchyInfo",
                value: function getHierarchyInfo(publicMetadata) {
                    var _this146 = this;

                    return this.service.getHierarchyInfo(publicMetadata).then(function (result) {
                        return _this146.handleEntityHierarchyInfo(publicMetadata, result);
                    });
                }
            }, {
                key: "handleEntityHierarchyInfo",
                value: function handleEntityHierarchyInfo(publicMetadata, result) {
                    var entityType = publicMetadata.entityType;
                    var infoArray = result || [];
                    var ids = new Array(infoArray.length);
                    for (var i = 0; i < infoArray.length; i++) {
                        var info = infoArray[i];
                        info.entityType = entityType; // entityType is not provided by the server
                        this._infoLookup[info.id] = info;
                        ids[i] = info.id;
                    }
                    // if there is only one metadata property and it's entityType, save the list of ids
                    var keys = JS.objectKeys(publicMetadata);
                    if (keys.length == 1 && keys[0] == ColumnMetadata.ENTITY_TYPE) this._idsByType[entityType] = ids;
                    this.callbacks.triggerCallbacks();
                    return result;
                }
                /**
                 * Gets an Array of Entity objects which have previously been cached via getHierarchyInfo().
                 * Entities of type 'table' and 'hierarchy' get cached automatically.
                 * @param entityType Either 'table' or 'hierarchy'
                 * @return An Array of Entity objects with the given type
                 */

            }, {
                key: "getIdsByType",
                value: function getIdsByType(entityType) {
                    this.getEntity(EntityCache_1.ROOT_ID);
                    return this._idsByType[entityType] = this._idsByType[entityType] || [];
                }
                /**
                 * Gets an EntityHierarchyInfo object corresponding to an entity ID, to be used for displaying a hierarchy.
                 * @param The entity ID.
                 * @return The hierarchy info, or null if there is none.
                 */

            }, {
                key: "getBranchInfo",
                value: function getBranchInfo(id) {
                    this.getEntity(EntityCache_1.ROOT_ID);
                    var info = this._infoLookup[id];
                    //			if (!info && entityIsCached(id))
                    //			{
                    //				var entity:Entity = entityCache[id];
                    //				info = new EntityHierarchyInfo(null);
                    //				info.id = id;
                    //				info.entityType = entity.publicMetadata[ColumnMetadata.ENTITY_TYPE];
                    //				info.title = entity.publicMetadata[ColumnMetadata.TITLE];
                    //				info.numChildren = entity.childIds.length;
                    //				_infoLookup[id] = info;
                    //			}
                    return info;
                }
                /**
                 * Invalidates all cached information.
                 * @param purge If set to true, clears cache instead of just invalidating it.
                 */

            }, {
                key: "invalidateAll",
                value: function invalidateAll() {
                    var purge = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                    if (Weave.wasDisposed(this)) return;
                    if (purge) {
                        this.idsToFetch = {};
                        this.entityCache = {};
                        this.idsToDelete = {};
                        this._idsByType = {};
                        this._infoLookup = {};
                        this.idsDirty = {};
                    } else {
                        // we don't want to delete the cache because we can still use the cached values for display in the meantime.
                        for (var id in this.entityCache) {
                            this.idsDirty[id] = true;
                        }
                    }
                    this.callbacks.triggerCallbacks();
                }
            }, {
                key: "update_metadata",
                value: function update_metadata(id, diff) {
                    if (!this.adminService) {
                        console.error("Unable to update metadata (Not an admin service)");
                        return;
                    }
                    this.adminService.updateEntity(id, diff);
                    this.invalidate(id);
                }
            }, {
                key: "add_category",
                value: function add_category(title, parentId, index) {
                    if (!this.adminService) {
                        console.error("Unable to create entities (Not an admin service)");
                        return;
                    }
                    var entityType = parentId == EntityCache_1.ROOT_ID ? EntityType.HIERARCHY : EntityType.CATEGORY;
                    var em = new EntityMetadata();
                    em.publicMetadata.title = title;
                    em.publicMetadata.entityType = entityType;
                    this.adminService.newEntity(em, parentId, index);
                    this.invalidate(parentId);
                }
            }, {
                key: "delete_entity",
                value: function delete_entity(id) {
                    this.idsToDelete[id] = true;
                    this.invalidate(id, true);
                }
            }, {
                key: "add_child",
                value: function add_child(parent_id, child_id, index) {
                    if (!this.adminService) {
                        console.error("Unable to modify hierarchy (Not an admin service)");
                        return;
                    }
                    if (this.idsToDelete[child_id]) {
                        // prevent move-from-root from deleting the child
                        delete this.idsToDelete[child_id];
                        if (parent_id == EntityCache_1.ROOT_ID) return; // nothing to do
                        // change hierarchy to category
                        var diff = new EntityMetadata();
                        diff.publicMetadata.entityType = EntityType.CATEGORY;
                        this.adminService.updateEntity(child_id, diff);
                    }
                    this.adminService.addChild(parent_id, child_id, index).then(this.handleIdsToInvalidate.bind(this, false));
                    this.invalidate(parent_id);
                }
            }, {
                key: "remove_child",
                value: function remove_child(parent_id, child_id) {
                    if (!this.adminService) {
                        console.error("Unable to remove entities (Not an admin service)");
                        return;
                    }
                    // remove from root means delete
                    if (parent_id == EntityCache_1.ROOT_ID) {
                        // delete_entity() does not take effect immediately.
                        // this allows add_child() to move it to a new parent instead of deleting.
                        this.delete_entity(child_id);
                    } else {
                        this.adminService.removeChild(parent_id, child_id);
                    }
                    this.invalidate(child_id, true);
                }
                /**
                 * Finds a series of Entity objects which can be traversed as a path from a root Entity to a descendant Entity.
                 * @param root The root Entity.
                 * @param descendant The descendant Entity.
                 * @return An Array of Entity objects which can be followed as a path from the root to the descendant, including the root and the descendant.
                 *         Returns null if the descendant is unreachable from the root.
                 */

            }, {
                key: "getEntityPath",
                value: function getEntityPath(root, descendant) {
                    if (!(root.id == EntityCache_1.ROOT_ID)) {
                        //TODO - when searching for a column under root(-1), a table should always be returned instead of a hierarchy
                        var type = descendant.getEntityType();
                        if (type == EntityType.TABLE || type == EntityType.HIERARCHY) return [root, descendant];
                    }
                    if (root.id == descendant.id) return [root];
                    var _iteratorNormalCompletion80 = true;
                    var _didIteratorError80 = false;
                    var _iteratorError80 = undefined;

                    try {
                        for (var _iterator80 = (descendant.parentIds || [])[Symbol.iterator](), _step80; !(_iteratorNormalCompletion80 = (_step80 = _iterator80.next()).done); _iteratorNormalCompletion80 = true) {
                            var parentId = _step80.value;

                            var parent = this.getEntity(parentId);
                            if (!parent.initialized) continue;
                            var path = this.getEntityPath(root, parent);
                            if (path) {
                                path.push(descendant);
                                return path;
                            }
                        }
                    } catch (err) {
                        _didIteratorError80 = true;
                        _iteratorError80 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion80 && _iterator80.return) {
                                _iterator80.return();
                            }
                        } finally {
                            if (_didIteratorError80) {
                                throw _iteratorError80;
                            }
                        }
                    }

                    return null;
                }
            }, {
                key: "dispose",
                value: function dispose() {
                    WeaveAPI.SessionManager.unassignBusyTask(this.delayedCallback);
                }
            }, {
                key: "callbacks",
                get: function get() {
                    return Weave.getCallbacks(this);
                }
            }]);

            return EntityCache;
        }();
        /**
         * A special flag value to represent a root node, which doesn't actually exist.
         */
        EntityCache.ROOT_ID = -1;
        /**
         * This is the maximum number of entities the server allows a user to request at a time.
         */
        EntityCache.MAX_ENTITY_REQUEST_COUNT = 1000;
        EntityCache = EntityCache_1 = __decorate([Weave.classInfo({ id: "weavejs.net.EntityCache", interfaces: [IDisposableObject] })], EntityCache);
        net.EntityCache = EntityCache;
    })(net = weavejs.net || (weavejs.net = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var hierarchy;
        (function (hierarchy) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var EntityCache = weavejs.net.EntityCache;
            var StandardLib = weavejs.util.StandardLib;
            var EntityNodeSearch_1 = void 0;
            var EntityNodeSearch = EntityNodeSearch_1 = function () {
                function EntityNodeSearch() {
                    _classCallCheck(this, EntityNodeSearch);

                    this._includeAllDescendants = true;
                    this._searchField = ColumnMetadata.TITLE; // the field to search
                    this._searchString = ''; // the search string containing ?* wildcards
                    this._searchRegExp = null; // used for local comparisons
                    this._entityCacheSearchResults = new WeakMap(); // EntityCache -> SearchResults
                }
                /**
                 * Set this to true to include all descendants of matching nodes
                 * whether or not the descendants also matched the search.
                 */


                _createClass(EntityNodeSearch, [{
                    key: "nodeFilter",

                    /**
                     * Use this as the nodeFilter in a WeaveTree.
                     * @param node The node to test.
                     * @see weave.ui.WeaveTree#nodeFilter
                     */
                    value: function nodeFilter(node) {
                        if (!this._searchField || !this._searchString) return true;
                        var lookup;
                        var en = Weave.AS(node, hierarchy.EntityNode);
                        if (en) {
                            var cache = en.getEntityCache();
                            var results = this._entityCacheSearchResults.get(cache);
                            if (!results) this._entityCacheSearchResults.set(cache, results = new SearchResults());
                            // invoke remote search if params changed
                            if (results.searchField != this._searchField || results.searchString != this._searchString) results.remoteSearch(this, cache);
                            // if cache updated, rebuild idLookup
                            if (Weave.detectChange(results, cache)) results.rebuildLookup(cache);
                            // The idLookup determines whether or not we want to include this EntityNode.
                            lookup = results.idLookup[en.id];
                            return !!(lookup & SearchResults.LOOKUP_MATCH_OR_ANCESTOR) || !!(this._includeAllDescendants && lookup & SearchResults.LOOKUP_DESCENDANT);
                        }
                        // see if the title matches
                        if (this._searchField == ColumnMetadata.TITLE && this._searchRegExp.test(node.getLabel())) return true;
                        // see if there are any matching descendants
                        if (!node.isBranch()) return false;
                        var children = node.getChildren();
                        if (children && children.filter(this.arrayFilter).length) return true;
                        return false;
                    }
                }, {
                    key: "arrayFilter",
                    value: function arrayFilter(node, i, a) {
                        return this.nodeFilter(node);
                    }
                    /**
                     * Surrounds a string with '*' and replaces ' ' with '*'
                     */

                }, {
                    key: "includeAllDescendants",
                    get: function get() {
                        return this._includeAllDescendants;
                    },
                    set: function set(value) {
                        if (this._includeAllDescendants != value) {
                            this._includeAllDescendants = value;
                            Weave.getCallbacks(this).triggerCallbacks();
                        }
                    }
                    /**
                     * The public metadata field used for searching.
                     * @default "title"
                     */

                }, {
                    key: "searchField",
                    get: function get() {
                        return this._searchField;
                    },
                    set: function set(value) {
                        value = value || '';
                        if (this._searchField != value) {
                            this._searchField = value;
                            Weave.getCallbacks(this).triggerCallbacks();
                        }
                    }
                    /**
                     * The search string, which may contain '*' and '?' wildcards.
                     */

                }, {
                    key: "searchString",
                    get: function get() {
                        return this._searchString;
                    },
                    set: function set(value) {
                        if (!value || StandardLib.replace(value, '?', '', '*', '') == '') value = '';
                        if (this._searchString != value) {
                            this._searchString = value;
                            this._searchRegExp = EntityNodeSearch_1.strToRegExp(value);
                            Weave.getCallbacks(this).triggerCallbacks();
                        }
                    }
                }], [{
                    key: "replaceSpacesWithWildcards",
                    value: function replaceSpacesWithWildcards(searchString) {
                        return StandardLib.replace('*' + searchString + '*', ' ', '*');
                    }
                    /**
                     * Generates a RegExp that matches a search string using '?' and '*' wildcards.
                     */

                }, {
                    key: "strToRegExp",
                    value: function strToRegExp(searchString) {
                        var flags = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "i";

                        var resultStr;
                        //excape metacharacters other than "*" and "?"
                        resultStr = searchString.replace(/[\^\$\\\.\+\(\)\[\]\{\}\|]/g, "\\$&");
                        //replace strToSrch "?" with reg exp equivalent "."
                        resultStr = resultStr.replace(/[\?]/g, ".");
                        //replace strToSrch "*" with reg exp equivalent ".*?"
                        resultStr = resultStr.replace(/[\*]/g, ".*?");
                        return new RegExp("^" + resultStr + "$", flags);
                    }
                }]);

                return EntityNodeSearch;
            }();
            EntityNodeSearch = EntityNodeSearch_1 = __decorate([Weave.classInfo({ id: 'weavejs.data.hierarchy.EntityNodeSearch' })], EntityNodeSearch);
            hierarchy.EntityNodeSearch = EntityNodeSearch;
            var SearchResults_1 = void 0;
            var SearchResults = SearchResults_1 = function () {
                function SearchResults() {
                    _classCallCheck(this, SearchResults);

                    /**
                     * Entity IDs which matched the search.
                     */
                    this.ids = [];
                    /**
                     * entity id -> nonzero if it should be included in the tree
                     */
                    this.idLookup = {};
                }
                /**
                 * Invokes RPC for search.
                 */


                _createClass(SearchResults, [{
                    key: "remoteSearch",
                    value: function remoteSearch(ens, cache) {
                        this.searchField = ens.searchField;
                        this.searchString = ens.searchString;
                        this.ids = [];
                        this.idLookup = {};
                        var query = {};
                        query[this.searchField] = this.searchString;
                        cache.getService().findEntityIds(query, [this.searchField]).then(this.handleSearchResults.bind(this, ens, cache));
                    }
                }, {
                    key: "handleSearchResults",
                    value: function handleSearchResults(ens, cache, newIds) {
                        // ignore outdated results
                        if (this.searchField != ens.searchField || this.searchString != ens.searchString) return;
                        if (Weave.wasDisposed(ens) || Weave.wasDisposed(cache)) return;
                        if (StandardLib.compare(this.ids, newIds)) {
                            this.ids = newIds;
                            this.rebuildLookup(cache);
                            Weave.getCallbacks(ens).triggerCallbacks();
                        }
                    }
                    /**
                     * Rebuilds the idLookup object.
                     */

                }, {
                    key: "rebuildLookup",
                    value: function rebuildLookup(cache) {
                        this.idLookup = {};
                        this._tempCache = cache;
                        this.ids.forEach(this.includeAncestors.bind(this));
                        this.ids.forEach(this.includeDescendants.bind(this));
                        this._tempCache = null;
                        // as long as there is at least one id in the lookup, include the root node.
                        for (var id in this.idLookup) {
                            this.idLookup[EntityCache.ROOT_ID] = SearchResults_1.LOOKUP_MATCH_OR_ANCESTOR;
                            break;
                        }
                    }
                }, {
                    key: "includeAncestors",
                    value: function includeAncestors(id) {
                        if (this.idLookup[id] & SearchResults_1.LOOKUP_MATCH_OR_ANCESTOR) return;
                        this.idLookup[id] |= SearchResults_1.LOOKUP_MATCH_OR_ANCESTOR;
                        var entity = this._tempCache.getEntity(id);
                        if (entity.parentIds) entity.parentIds.forEach(this.includeAncestors);
                    }
                }, {
                    key: "includeDescendants",
                    value: function includeDescendants(id) {
                        if (this.idLookup[id] & SearchResults_1.LOOKUP_DESCENDANT) return;
                        this.idLookup[id] |= SearchResults_1.LOOKUP_DESCENDANT;
                        var entity = this._tempCache.getEntity(id);
                        if (entity.childIds) entity.childIds.forEach(this.includeDescendants);
                    }
                }]);

                return SearchResults;
            }();
            /**
             * Usage: if (idLookup[id] & LOOKUP_MATCH_OR_ANCESTOR) ...
             */
            SearchResults.LOOKUP_MATCH_OR_ANCESTOR = 1;
            /**
             * Usage: if (idLookup[id] & LOOKUP_DESCENDANT) ...
             */
            SearchResults.LOOKUP_DESCENDANT = 2;
            /**
             * Usage: if (idLookup[id] & LOOKUP_VISITED) ...
             */
            SearchResults.LOOKUP_VISITED = 4;
            SearchResults = SearchResults_1 = __decorate([Weave.classInfo({ id: 'weavejs.data.hierarchy.SearchResults' })], SearchResults);
        })(hierarchy = data.hierarchy || (data.hierarchy = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var hierarchy;
        (function (hierarchy) {
            var EntityType = weavejs.api.data.EntityType;
            var IColumnReference = weavejs.api.data.IColumnReference;
            var IDataSource = weavejs.api.data.IDataSource;
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var IWeaveTreeNodeWithEditableChildren = weavejs.api.data.IWeaveTreeNodeWithEditableChildren;
            var IWeaveTreeNodeWithPathFinding = weavejs.api.data.IWeaveTreeNodeWithPathFinding;
            var Entity = weavejs.api.net.beans.Entity;
            var DebugUtils = weavejs.util.DebugUtils;
            var JS = weavejs.util.JS;
            var EntityNode_1 = void 0;
            var EntityNode = EntityNode_1 = function () {
                /**
                 * @param entityCache The entityCache which the Entity belongs to.
                 * @param rootFilterEntityType To be used by root node only.
                 * @param nodeFilterFunction Used for filtering children.
                 */
                function EntityNode() {
                    var entityCache = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                    var rootFilterEntityType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var overrideLabel = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    _classCallCheck(this, EntityNode);

                    this._rootFilterEntityType = null;
                    /**
                     * @private
                     */
                    this._overrideLabel = null;
                    /**
                     * This primitive value is used in place of a pointer to an EntityCache object
                     * so that this object may be serialized & copied by the Flex framework without losing this information.
                     * @private
                     */
                    this._cacheId = 0;
                    /**
                     * The entity ID.
                     */
                    this.id = -1;
                    // the node can re-use the same children array
                    this._childNodes = [];
                    // We cache child nodes to avoid creating unnecessary objects.
                    // Each node must have its own child cache (not static) because we can't have the same node in two places in a Tree.
                    this._childNodeCache = []; // id -> EntityNode
                    this.setEntityCache(entityCache);
                    this._rootFilterEntityType = rootFilterEntityType;
                    this._overrideLabel = overrideLabel;
                }
                /**
                 * Sets the EntityCache associated with this node.
                 */


                _createClass(EntityNode, [{
                    key: "setEntityCache",
                    value: function setEntityCache(entityCache) {
                        if (!EntityNode_1.$map_cacheLookup) EntityNode_1.$map_cacheLookup = new Map();
                        var cid = EntityNode_1.$map_cacheLookup.get(entityCache);
                        if (entityCache && !cid) {
                            cid = ++EntityNode_1.$cacheSerial;
                            EntityNode_1.$map_cacheLookup.set(cid, entityCache);
                            EntityNode_1.$map_cacheLookup.set(entityCache, cid);
                        }
                        if (cid != this._cacheId) {
                            this._cacheId = cid;
                            var _iteratorNormalCompletion81 = true;
                            var _didIteratorError81 = false;
                            var _iteratorError81 = undefined;

                            try {
                                for (var _iterator81 = (this._childNodeCache || [])[Symbol.iterator](), _step81; !(_iteratorNormalCompletion81 = (_step81 = _iterator81.next()).done); _iteratorNormalCompletion81 = true) {
                                    var child = _step81.value;

                                    child.setEntityCache(entityCache);
                                }
                            } catch (err) {
                                _didIteratorError81 = true;
                                _iteratorError81 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion81 && _iterator81.return) {
                                        _iterator81.return();
                                    }
                                } finally {
                                    if (_didIteratorError81) {
                                        throw _iteratorError81;
                                    }
                                }
                            }
                        }
                    }
                    /**
                     * Gets the EntityCache associated with this node.
                     */

                }, {
                    key: "getEntityCache",
                    value: function getEntityCache() {
                        return EntityNode_1.$map_cacheLookup ? EntityNode_1.$map_cacheLookup.get(this._cacheId) : null;
                    }
                    /**
                     * Gets the Entity associated with this node.
                     */

                }, {
                    key: "getEntity",
                    value: function getEntity() {
                        return this.getEntityCache().getEntity(this.id);
                    }
                }, {
                    key: "equals",
                    value: function equals(other) {
                        if (other == this) return true;
                        var node = other;
                        return !!node && this._cacheId == node._cacheId && this.id == node.id;
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        var cache = this.getEntityCache();
                        var owner = cache;
                        while (owner) {
                            owner = Weave.getOwner(owner);
                            if (Weave.IS(owner, IDataSource)) return owner;
                        }
                        return null;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        var meta = {};
                        var entity = this.getEntity();
                        if (entity.getEntityType() != EntityType.COLUMN) return null; // not a column
                        for (var key in entity.publicMetadata) {
                            meta[key] = entity.publicMetadata[key];
                        }meta.weaveEntityId = this.id;
                        return meta;
                    }
                }, {
                    key: "getLabel",
                    value: function getLabel() {
                        if (this._overrideLabel) return this._overrideLabel;
                        var title;
                        var entity;
                        var entityType;
                        var cache = this.getEntityCache();
                        var branchInfo = cache.getBranchInfo(this.id);
                        if (branchInfo) {
                            // avoid calling getEntity()
                            entityType = branchInfo.entityType || 'entity';
                            title = branchInfo.title || Weave.lang("Untitled {0}#{1}", entityType, branchInfo.id);
                            if (entityType == EntityType.TABLE) title = Weave.lang("{0} ({1})", title, branchInfo.numChildren);
                        } else {
                            entity = this.getEntity();
                            title = entity.publicMetadata.title;
                            if (!title) {
                                var name = entity.publicMetadata['name'];
                                if (name) title = '[name: ' + name + ']';
                            }
                            if (!title || EntityNode_1.debug) entityType = entity.getEntityType() || 'entity';
                            if (!title && !entity.initialized) {
                                if (this._rootFilterEntityType) {
                                    var ds = this.getDataSource();
                                    if (ds) title = Weave.getRoot(ds).getName(ds) || title;
                                } else title = '...';
                            }
                        }
                        if (cache.entityIsCached(this.id)) {
                            if (!entity) entity = cache.getEntity(this.id);
                            if (entity.getEntityType() != EntityType.COLUMN && entity.parentIds.length > 1) title += Weave.lang(" ; Warning: Multiple parents ({0})", entity.parentIds);
                        }
                        var idStr;
                        if (!title || EntityNode_1.debug) idStr = Weave.lang("{0}#{1}", entityType, this.id);
                        if (!title) title = idStr;
                        if (EntityNode_1.debug) {
                            var children = this.getChildren();
                            if (entityType != EntityType.COLUMN && children) idStr += '; ' + children.length + ' children';
                            title = Weave.lang('({0}) {1} {2}', idStr, DebugUtils.debugId(this), title);
                        }
                        return title;
                    }
                }, {
                    key: "isBranch",
                    value: function isBranch() {
                        // root is a branch
                        if (this._rootFilterEntityType) return true;
                        var cache = this.getEntityCache();
                        var info = cache.getBranchInfo(this.id);
                        if (info) return info.entityType != EntityType.COLUMN;
                        var entity = cache.getEntity(this.id);
                        // treat entities that haven't downloaded yet as leaf nodes
                        // columns are leaf nodes
                        return entity.initialized && entity.getEntityType() != EntityType.COLUMN;
                    }
                }, {
                    key: "hasChildBranches",
                    value: function hasChildBranches() {
                        if (this._rootFilterEntityType) return true;
                        var cache = this.getEntityCache();
                        var info = cache.getBranchInfo(this.id);
                        // tables and columns do not have child branches
                        if (info && (info.entityType == EntityType.TABLE || info.entityType == EntityType.COLUMN)) return false;
                        return cache.getEntity(this.id).hasChildBranches;
                    }
                }, {
                    key: "getCachedChildNode",
                    value: function getCachedChildNode(childId) {
                        var child = Weave.AS(this._childNodeCache[childId], EntityNode_1);
                        if (!child) {
                            child = new EntityNode_1(this.getEntityCache());
                            child.id = childId;
                            this._childNodeCache[childId] = child;
                        }
                        if (child.id != childId) {
                            JS.error("BUG: EntityNode id has changed since it was first cached");
                            child.id = childId;
                        }
                        return child;
                    }
                }, {
                    key: "getChildren",
                    value: function getChildren() {
                        var cache = this.getEntityCache();
                        var childIds;
                        if (this._rootFilterEntityType) {
                            childIds = cache.getIdsByType(this._rootFilterEntityType);
                        } else {
                            var entity = cache.getEntity(this.id);
                            if (entity.getEntityType() == EntityType.COLUMN) return null; // leaf node
                            childIds = entity.childIds;
                        }
                        if (!childIds) {
                            this._childNodes.length = 0;
                            return this.isBranch() ? this._childNodes : null;
                        }
                        this._childNodes.length = childIds.length;
                        for (var i = 0; i < childIds.length; i++) {
                            this._childNodes[i] = this.getCachedChildNode(childIds[i]);
                        }return this._childNodes;
                    }
                }, {
                    key: "addChildAt",
                    value: function addChildAt(child, index) {
                        var childNode = Weave.AS(child, EntityNode_1);
                        if (childNode) {
                            // does not support adding children from a different EntityCache
                            if (this.getEntityCache() != childNode.getEntityCache()) return false;
                            this.getEntityCache().add_child(this.id, childNode.id, index);
                            return true;
                        }
                        return false;
                    }
                }, {
                    key: "removeChild",
                    value: function removeChild(child) {
                        var childNode = Weave.AS(child, EntityNode_1);
                        if (childNode) {
                            // does not support removing children from a different EntityCache
                            if (this.getEntityCache() != childNode.getEntityCache()) return false;
                            childNode.getEntityCache().remove_child(this.id, childNode.id);
                            return true;
                        }
                        return false;
                    }
                }, {
                    key: "findPathToNode",
                    value: function findPathToNode(descendant) {
                        var node = Weave.AS(descendant, EntityNode_1);
                        if (!node || this._cacheId != node._cacheId) return null;
                        var cache = this.getEntityCache();
                        if (this._rootFilterEntityType == EntityType.TABLE) {
                            // root table node only has two levels - table, column
                            // return path of EntityNode objects
                            var _iteratorNormalCompletion82 = true;
                            var _didIteratorError82 = false;
                            var _iteratorError82 = undefined;

                            try {
                                for (var _iterator82 = (node.getEntity().parentIds || [])[Symbol.iterator](), _step82; !(_iteratorNormalCompletion82 = (_step82 = _iterator82.next()).done); _iteratorNormalCompletion82 = true) {
                                    var id = _step82.value;

                                    if (cache.getEntity(id).getEntityType() == EntityType.TABLE) {
                                        var tableNode = this.getCachedChildNode(id);
                                        return [this, tableNode, tableNode.getCachedChildNode(node.id)];
                                    }
                                }
                            } catch (err) {
                                _didIteratorError82 = true;
                                _iteratorError82 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion82 && _iterator82.return) {
                                        _iterator82.return();
                                    }
                                } finally {
                                    if (_didIteratorError82) {
                                        throw _iteratorError82;
                                    }
                                }
                            }

                            return null;
                        }
                        // get path of Entity objects
                        var path = cache.getEntityPath(this.getEntity(), node.getEntity());
                        // get path of EntityNode objects
                        if (path) {
                            for (var i = 0; i < path.length; i++) {
                                if (i == 0) node = this;else node = node.getCachedChildNode(Weave.AS(path[i], Entity).id);
                                path[i] = node;
                            }
                        }
                        return path;
                    }
                }]);

                return EntityNode;
            }();
            EntityNode.$cacheSerial = 0;
            EntityNode.debug = false;
            EntityNode = EntityNode_1 = __decorate([Weave.classInfo({
                id: "weavejs.data.hierarchy.EntityNode",
                interfaces: [IWeaveTreeNode, IWeaveTreeNodeWithEditableChildren, IWeaveTreeNodeWithPathFinding, IColumnReference]
            })], EntityNode);
            hierarchy.EntityNode = EntityNode;
        })(hierarchy = data.hierarchy || (data.hierarchy = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var hierarchy;
        (function (hierarchy) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IColumnReference = weavejs.api.data.IColumnReference;
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var IWeaveTreeNodeWithPathFinding = weavejs.api.data.IWeaveTreeNodeWithPathFinding;
            var HierarchyUtils = weavejs.data.hierarchy.HierarchyUtils;
            var StandardLib = weavejs.util.StandardLib;
            /**
             * A node in a tree whose leaves identify attribute columns.
             * The <code>data</code> property is used for column metadata on leaf nodes.
             * The following properties are used for equality comparison, in addition to node class definitions:<br>
             * <code>dataSource, data, idFields</code><br>
             * The following properties are used by ColumnTreeNode but not for equality comparison:<br>
             * <code>label, children, hasChildBranches</code><br>
             */
            var ColumnTreeNode_1 = void 0;
            var ColumnTreeNode = ColumnTreeNode_1 = function (_hierarchy$WeaveTreeD) {
                _inherits(ColumnTreeNode, _hierarchy$WeaveTreeD);

                /**
                 * The <code>data</code> parameter is used for column metadata on leaf nodes.
                 * The following properties are used for equality comparison, in addition to node class definitions:
                 *     <code>dependency, data, dataSource, idFields</code><br>
                 * The following properties are used by ColumnTreeNode but not for equality comparison:
                 *     <code>label, children, hasChildBranches</code><br>
                 * @param params An values for the properties of this ColumnTreeNode.
                 *               The <code>dataSource</code> property is required.
                 *               If no <code>dependency</code> property is given, <code>dataSource.hierarchyRefresh</code> will be used as the dependency.
                 */
                function ColumnTreeNode(params) {
                    _classCallCheck(this, ColumnTreeNode);

                    var _this147 = _possibleConstructorReturn(this, (ColumnTreeNode.__proto__ || Object.getPrototypeOf(ColumnTreeNode)).call(this, params));

                    _this147.childItemClass = ColumnTreeNode_1;
                    if (!params || !params.hasOwnProperty('dataSource')) throw new Error('ColumnTreeNode constructor: "dataSource" parameter is required');
                    if (!_this147.dependency && _this147.dataSource) _this147.dependency = _this147.dataSource.hierarchyRefresh;
                    return _this147;
                }
                /**
                 * If there is no label, this will use data['title'] if defined.
                 */
                /* override */

                _createClass(ColumnTreeNode, [{
                    key: "equals",

                    /**
                     * Compares constructor, dataSource, dependency, data, idFields.
                     */
                    /* override */value: function equals(other) {
                        var that = Weave.AS(other, ColumnTreeNode_1);
                        if (!that) return false;
                        // compare constructor
                        if (Object(this).constructor != Object(that).constructor) return false; // constructor differs
                        // compare dependency
                        if (this.dependency != that.dependency) return false; // dependency differs
                        // compare dataSource
                        if (this.dataSource != that.dataSource) return false; // dataSource differs
                        // compare idFields
                        if (StandardLib.compare(this.idFields, that.idFields) != 0) return false; // idFields differs
                        // compare data
                        if (this.idFields) {
                            var _iteratorNormalCompletion83 = true;
                            var _didIteratorError83 = false;
                            var _iteratorError83 = undefined;

                            try {
                                for (var _iterator83 = this.idFields[Symbol.iterator](), _step83; !(_iteratorNormalCompletion83 = (_step83 = _iterator83.next()).done); _iteratorNormalCompletion83 = true) {
                                    var field = _step83.value;

                                    if (StandardLib.compare(this.data[field], that.data[field]) != 0) return false;
                                } // data differs
                            } catch (err) {
                                _didIteratorError83 = true;
                                _iteratorError83 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion83 && _iterator83.return) {
                                        _iterator83.return();
                                    }
                                } finally {
                                    if (_didIteratorError83) {
                                        throw _iteratorError83;
                                    }
                                }
                            }
                        } else if (StandardLib.compare(this.data, that.data) != 0) return false; // data differs
                        return true;
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        return this.dataSource;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        if (this.isBranch()) return null;
                        return this.data;
                    }
                }, {
                    key: "findPathToNode",
                    value: function findPathToNode(descendant) {
                        // base case - if nodes are equal
                        if (this.equals(descendant)) return [this];
                        // stopping condition - if ColumnTreeNode descendant dataSource or idFields values differ
                        var _descendant = Weave.AS(descendant, ColumnTreeNode_1);
                        if (_descendant) {
                            // don't look for a descendant with different a dataSource
                            if (StandardLib.compare(this.dataSource, _descendant.dataSource) != 0) return null;
                            // if this node has idFields, make sure the id values match those of the descendant
                            if (this.idFields && this.data && _descendant.data) {
                                var _iteratorNormalCompletion84 = true;
                                var _didIteratorError84 = false;
                                var _iteratorError84 = undefined;

                                try {
                                    for (var _iterator84 = (this.idFields || [])[Symbol.iterator](), _step84; !(_iteratorNormalCompletion84 = (_step84 = _iterator84.next()).done); _iteratorNormalCompletion84 = true) {
                                        var field = _step84.value;

                                        if (this.data[field] != _descendant.data[field]) return null;
                                    }
                                } catch (err) {
                                    _didIteratorError84 = true;
                                    _iteratorError84 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion84 && _iterator84.return) {
                                            _iterator84.return();
                                        }
                                    } finally {
                                        if (_didIteratorError84) {
                                            throw _iteratorError84;
                                        }
                                    }
                                }
                            }
                        }
                        // finally, check each child
                        var childs = this.getChildren();
                        var _iteratorNormalCompletion85 = true;
                        var _didIteratorError85 = false;
                        var _iteratorError85 = undefined;

                        try {
                            for (var _iterator85 = (childs || [])[Symbol.iterator](), _step85; !(_iteratorNormalCompletion85 = (_step85 = _iterator85.next()).done); _iteratorNormalCompletion85 = true) {
                                var child = _step85.value;

                                var path = HierarchyUtils.findPathToNode(child, descendant);
                                if (path) {
                                    path.unshift(this);
                                    return path;
                                }
                            }
                        } catch (err) {
                            _didIteratorError85 = true;
                            _iteratorError85 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion85 && _iterator85.return) {
                                    _iterator85.return();
                                }
                            } finally {
                                if (_didIteratorError85) {
                                    throw _iteratorError85;
                                }
                            }
                        }

                        return null;
                    }
                }, {
                    key: "label",
                    get: function get() {
                        var str = _get(ColumnTreeNode.prototype.__proto__ || Object.getPrototypeOf(ColumnTreeNode.prototype), "label", this);
                        if (!str && this.data) {
                            if (_typeof(this.data) == 'object') str = this.data.hasOwnProperty(ColumnMetadata.TITLE) ? this.data.title : Weave.lang('(Untitled)');else str = String(data);
                        }
                        return str || '';
                    }
                }]);

                return ColumnTreeNode;
            }(hierarchy.WeaveTreeDescriptorNode);
            ColumnTreeNode = ColumnTreeNode_1 = __decorate([Weave.classInfo({ id: "weavejs.data.hierarchy", interfaces: [IWeaveTreeNode, IWeaveTreeNodeWithPathFinding, IColumnReference] })], ColumnTreeNode);
            hierarchy.ColumnTreeNode = ColumnTreeNode;
        })(hierarchy = data.hierarchy || (data.hierarchy = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_3) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ILinkableVariable = weavejs.api.core.ILinkableVariable;
        var ColumnMetadata = weavejs.api.data.ColumnMetadata;
        var DataTypes = weavejs.api.data.DataTypes;
        var IAttributeColumn = weavejs.api.data.IAttributeColumn;
        var IKeySet = weavejs.api.data.IKeySet;
        var IQualifiedKey = weavejs.api.data.IQualifiedKey;
        var JS = weavejs.util.JS;
        var StandardLib = weavejs.util.StandardLib;
        /**
         * This class contains static functions that access values from IAttributeColumn objects.
         * Many of the functions in this library use the static variable 'currentRecordKey'.
         * This value should be set before calling a function that uses it.
         *
         * @author adufilie
         */
        var EquationColumnLib_1 = void 0;
        var EquationColumnLib = EquationColumnLib_1 = function () {
            function EquationColumnLib() {
                _classCallCheck(this, EquationColumnLib);
            }

            _createClass(EquationColumnLib, null, [{
                key: "getKey",

                /**
                 * This function calls column.getValueFromKey(currentRecordKey, IQualifiedKey)
                 * @param column A column, or null if you want the currentRecordKey to be returned.
                 * @return The value at the current record in the column cast as an IQualifiedKey.
                 */
                value: function getKey() {
                    var column = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    if (column) return column.getValueFromKey(EquationColumnLib_1.currentRecordKey, IQualifiedKey);
                    return EquationColumnLib_1.currentRecordKey;
                }
                /**
                 * This function uses currentRecordKey when retrieving a value from a column.
                 * @param object An IAttributeColumn or an ILinkableVariable to get a value from.
                 * @param dataType Either a Class object or a String containing the qualified class name of the desired value type.
                 * @return The value of the object, optionally cast to the requested dataType.
                 */

            }, {
                key: "getValue",
                value: function getValue(object) {
                    var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // remember current key
                    var key = EquationColumnLib_1.currentRecordKey;
                    try {
                        if (Weave.IS(dataType, String)) dataType = Weave.getDefinition(dataType);
                        var value = null; // the value that will be returned
                        // get the value from the object
                        var column = Weave.AS(object, IAttributeColumn);
                        if (column != null) {
                            if (dataType == null) {
                                var dataTypeMetadata = column.getMetadata(ColumnMetadata.DATA_TYPE);
                                dataType = DataTypes.getClass(dataTypeMetadata);
                                if (dataType == String && dataTypeMetadata != DataTypes.STRING) dataType = IQualifiedKey;
                            }
                            value = column.getValueFromKey(key, JS.asClass(dataType));
                        } else if (Weave.IS(object, ILinkableVariable)) {
                            value = object.getSessionState();
                            // cast the value to the requested type
                            if (dataType != null) value = EquationColumnLib_1.cast(value, dataType);
                        } else if (dataType != null) {
                            value = EquationColumnLib_1.cast(value, dataType);
                        }
                        if (EquationColumnLib_1.debug) console.log('getValue', object, key.localName, String(value));
                        return value;
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = key;
                    }
                }
                /**
                 * This function calls IAttributeColumn.getValueFromKey(key, dataType).
                 * @param column An IAttributeColumn to get a value from.
                 * @param key A key to get the value for.
                 * @return The result of calling column.getValueFromKey(key, dataType).
                 */

            }, {
                key: "getValueFromKey",
                value: function getValueFromKey(column, key) {
                    var dataType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    // remember current key
                    var previousKey = EquationColumnLib_1.currentRecordKey;
                    try {
                        EquationColumnLib_1.currentRecordKey = key;
                        var value = EquationColumnLib_1.getValue(column, dataType);
                        if (EquationColumnLib_1.debug) console.log('getValueFromKey', column, key.localName, String(value));
                        return value;
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = previousKey;
                    }
                }
                /**
                 * This function gets a value from a data column, using a filter column and a key column to filter the data
                 * @param keyColumn An IAttributeColumn to get keys from
                 * @param filter column to use to filter data (ex: year)
                 * @param data An IAttributeColumn to get a value from
                 * @param filterValue value in filtercolumn to use to filter data
                 * @param filterDataType Class object of the desired filter value type
                 * @param dataType Class object of the desired value type. If IQualifiedKey, this acts as a reverse lookup for the filter column, returning the key given a filterValue String.
                 * @return the correct filtered value from the data column
                 * @author kmanohar
                 */

            }, {
                key: "getValueFromFilterColumn",
                value: function getValueFromFilterColumn(keyColumn, filter, data, filterValue) {
                    var dataType = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;

                    var key = EquationColumnLib_1.getKey();
                    var foreignKeyType = keyColumn.getMetadata(ColumnMetadata.DATA_TYPE);
                    var ignoreKeyType = !foreignKeyType || foreignKeyType == DataTypes.STRING;
                    var cubekeys = EquationColumnLib_1.getAssociatedKeys(keyColumn, key, ignoreKeyType);
                    if (cubekeys && cubekeys.length == 1) {
                        var _iteratorNormalCompletion86 = true;
                        var _didIteratorError86 = false;
                        var _iteratorError86 = undefined;

                        try {
                            for (var _iterator86 = (cubekeys || [])[Symbol.iterator](), _step86; !(_iteratorNormalCompletion86 = (_step86 = _iterator86.next()).done); _iteratorNormalCompletion86 = true) {
                                var cubekey = _step86.value;

                                if (filter.getValueFromKey(cubekey, String) == filterValue) {
                                    if (dataType === IQualifiedKey) return cubekey;
                                    var val = EquationColumnLib_1.getValueFromKey(data, cubekey, dataType);
                                    return val;
                                }
                            }
                        } catch (err) {
                            _didIteratorError86 = true;
                            _iteratorError86 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion86 && _iterator86.return) {
                                    _iterator86.return();
                                }
                            } finally {
                                if (_didIteratorError86) {
                                    throw _iteratorError86;
                                }
                            }
                        }
                    }
                    return EquationColumnLib_1.cast(undefined, dataType);
                }
                /**
                 * This function returns a list of IQualifiedKey objects using a reverse lookup of value-key pairs
                 * @param column An attribute column
                 * @param keyValue The value to look up
                 * @param ignoreKeyType If true, ignores the dataType of the column (the column's foreign keyType) and the keyType of the keyValue
                 * @return An array of record keys with the given value under the given column
                 */

            }, {
                key: "getAssociatedKeys",
                value: function getAssociatedKeys(column, keyValue) {
                    var ignoreKeyType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

                    var map_lookup = EquationColumnLib_1.map_reverseKeyLookupCache.get(column);
                    if (map_lookup == null || column.triggerCounter != EquationColumnLib_1.map_reverseKeyLookupTriggerCounter.get(column)) {
                        EquationColumnLib_1.map_reverseKeyLookupTriggerCounter.set(column, column.triggerCounter);
                        EquationColumnLib_1.map_reverseKeyLookupCache.set(column, map_lookup = new Map());
                        var _iteratorNormalCompletion87 = true;
                        var _didIteratorError87 = false;
                        var _iteratorError87 = undefined;

                        try {
                            for (var _iterator87 = (column.keys || [])[Symbol.iterator](), _step87; !(_iteratorNormalCompletion87 = (_step87 = _iterator87.next()).done); _iteratorNormalCompletion87 = true) {
                                var recordKey = _step87.value;

                                var value = column.getValueFromKey(recordKey, IQualifiedKey);
                                if (value == null) continue;
                                if (!map_lookup.has(value)) map_lookup.set(value, []);
                                map_lookup.get(value).push(recordKey);
                                if (!map_lookup.has(value.localName)) map_lookup.set(value.localName, []);
                                map_lookup.get(value.localName).push(recordKey);
                            }
                        } catch (err) {
                            _didIteratorError87 = true;
                            _iteratorError87 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion87 && _iterator87.return) {
                                    _iterator87.return();
                                }
                            } finally {
                                if (_didIteratorError87) {
                                    throw _iteratorError87;
                                }
                            }
                        }
                    }
                    return map_lookup.get(ignoreKeyType ? keyValue.localName : keyValue);
                }
                /**
                 * This function uses currentRecordKey when retrieving a value from a column if no key is specified.
                 * @param object An IAttributeColumn or an ILinkableVariable to get a value from.
                 * @param key A key to get the Number for.
                 * @return The value of the object, cast to a Number.
                 */

            }, {
                key: "getNumber",
                value: function getNumber(object) {
                    var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // remember current key
                    var previousKey = EquationColumnLib_1.currentRecordKey;
                    try {
                        if (key == null) key = EquationColumnLib_1.currentRecordKey;
                        var result;
                        var column = Weave.AS(object, IAttributeColumn);
                        if (column != null) {
                            result = object.getValueFromKey(key, Number);
                        } else if (Weave.IS(object, ILinkableVariable)) {
                            result = StandardLib.asNumber(object.getSessionState());
                        } else throw new Error('first parameter must be either an IAttributeColumn or an ILinkableVariable');
                        if (EquationColumnLib_1.debug) console.log('getNumber', column, key.localName, String(result));
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = previousKey;
                    }
                    return result;
                }
                /**
                 * This function uses currentRecordKey when retrieving a value from a column if no key is specified.
                 * @param object An IAttributeColumn or an ILinkableVariable to get a value from.
                 * @param key A key to get the Number for.
                 * @return The value of the object, cast to a String.
                 */

            }, {
                key: "getString",
                value: function getString(object) {
                    var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // remember current key
                    var previousKey = EquationColumnLib_1.currentRecordKey;
                    try {
                        if (key == null) key = EquationColumnLib_1.currentRecordKey;
                        var result = '';
                        var column = Weave.AS(object, IAttributeColumn);
                        if (column != null) {
                            result = object.getValueFromKey(key, String);
                        } else if (Weave.IS(object, ILinkableVariable)) {
                            result = StandardLib.asString(object.getSessionState());
                        } else throw new Error('first parameter must be either an IAttributeColumn or an ILinkableVariable');
                        if (EquationColumnLib_1.debug) console.log('getString', column, key.localName, String(result));
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = previousKey;
                    }
                    return result;
                }
                /**
                 * This function uses currentRecordKey when retrieving a value from a column if no key is specified.
                 * @param object An IAttributeColumn or an ILinkableVariable to get a value from.
                 * @param key A key to get the Number for.
                 * @return The value of the object, cast to a Boolean.
                 */

            }, {
                key: "getBoolean",
                value: function getBoolean(object) {
                    var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // remember current key
                    var previousKey = EquationColumnLib_1.currentRecordKey;
                    try {
                        if (key == null) key = EquationColumnLib_1.currentRecordKey;
                        var result = false;
                        var column = Weave.AS(object, IAttributeColumn);
                        if (column != null) {
                            result = StandardLib.asBoolean(column.getValueFromKey(key, Number));
                        } else if (Weave.IS(object, ILinkableVariable)) {
                            result = StandardLib.asBoolean(object.getSessionState());
                        } else throw new Error('first parameter must be either an IAttributeColumn or an ILinkableVariable');
                        if (EquationColumnLib_1.debug) console.log('getBoolean', column, key.localName, String(result));
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = previousKey;
                    }
                    return result;
                }
                /**
                 * This function uses currentRecordKey when retrieving a value from a column if no key is specified.
                 * @param column A column to get a value from.
                 * @param key A key to get the Number for.
                 * @return The Number corresponding to the given key, normalized to be between 0 and 1.
                 *
                 * @deprecated replacement="WeaveAPI.StatisticsCache.getColumnStatistics(column).getNorm(key)")
                 */

            }, {
                key: "getNorm",
                value: function getNorm(column) {
                    var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // remember current key
                    var previousKey = EquationColumnLib_1.currentRecordKey;
                    try {
                        if (key == null) key = EquationColumnLib_1.currentRecordKey;
                        var result = NaN;
                        if (column != null) result = WeaveAPI.StatisticsCache.getColumnStatistics(column).getNorm(key);else throw new Error('first parameter must be an IAttributeColumn');
                        if (EquationColumnLib_1.debug) console.log('getNorm', column, key.localName, String(result));
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = previousKey;
                    }
                    return result;
                }
                /**
                 * This will check a list of IKeySets for an IQualifiedKey.
                 * @param keySets A list of IKeySets (can be IAttributeColumns).
                 * @param key A key to search for.
                 * @return The first IKeySet that contains the key.
                 */

            }, {
                key: "findKeySet",
                value: function findKeySet(keySets) {
                    var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // remember current key
                    var previousKey = EquationColumnLib_1.currentRecordKey;
                    try {
                        if (key == null) key = EquationColumnLib_1.currentRecordKey;
                        var keySet = null;
                        for (var i = 0; i < keySets.length; i++) {
                            keySet = Weave.AS(keySets[i], IKeySet);
                            if (keySet && keySet.containsKey(key)) break;else keySet = null;
                        }
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = previousKey;
                    }
                    return keySet;
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getSum",
                value: function getSum(column) {
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getSum();
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getMean",
                value: function getMean(column) {
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getMean();
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getVariance",
                value: function getVariance(column) {
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getVariance();
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getStandardDeviation",
                value: function getStandardDeviation(column) {
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getStandardDeviation();
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getMin",
                value: function getMin(column) {
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getMin();
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getMax",
                value: function getMax(column) {
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getMax();
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getCount",
                value: function getCount(column) {
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getCount();
                }
                /**
                 * @deprecated
                 */

            }, {
                key: "getRunningTotal",
                value: function getRunningTotal(column) {
                    var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    // remember current key
                    var previousKey = EquationColumnLib_1.currentRecordKey;
                    try {
                        if (key == null) key = EquationColumnLib_1.currentRecordKey;
                        var result = NaN;
                        if (column != null) {
                            var runningTotals = WeaveAPI.StatisticsCache.getRunningTotals(column);
                            if (runningTotals != null) result = runningTotals.get(key);
                        }
                    } finally {
                        // revert to key that was set when entering the function (in case nested calls modified the static variables)
                        EquationColumnLib_1.currentRecordKey = previousKey;
                    }
                    return result;
                }
                /**
                 * @param value A value to cast.
                 * @param newType Either a qualifiedClassName or a Class object referring to the type to cast the value as.
                 */

            }, {
                key: "cast",
                value: function cast(value, newType) {
                    if (newType == null) return value;
                    // if newType is a qualified class name, get the Class definition
                    if (Weave.IS(newType, String)) newType = Weave.getDefinition(newType);
                    // cast the value as the desired type
                    if (newType == Number) {
                        value = StandardLib.asNumber(value);
                    } else if (newType == String) {
                        value = StandardLib.asString(value);
                    } else if (newType == Boolean) {
                        value = StandardLib.asBoolean(value);
                    } else if (newType == Array) {
                        if (value != null && !Weave.IS(value, Array)) value = [value];
                    }
                    return Weave.AS(value, newType);
                }
            }]);

            return EquationColumnLib;
        }();
        EquationColumnLib.debug = false;
        /**
         * This value should be set before calling any of the functions below that get values from IAttributeColumns.
         */
        EquationColumnLib.currentRecordKey = null;
        EquationColumnLib.map_reverseKeyLookupTriggerCounter = new WeakMap();
        EquationColumnLib.map_reverseKeyLookupCache = new WeakMap();
        /**
         * This is a macro for IQualifiedKey that can be used in equations.
         */
        EquationColumnLib.QKey = IQualifiedKey;
        EquationColumnLib = EquationColumnLib_1 = __decorate([Weave.classInfo({ id: "weavejs.data.EquationColumnLib" })], EquationColumnLib);
        data_3.EquationColumnLib = EquationColumnLib;
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column_2) {
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var EquationColumnLib = weavejs.data.EquationColumnLib;
            var FilteredKeySet = weavejs.data.key.FilteredKeySet;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            /**
             * FilteredColumn
             *
             * @author adufilie
             */
            var FilteredColumn = function (_column_2$ExtendedDyn) {
                _inherits(FilteredColumn, _column_2$ExtendedDyn);

                function FilteredColumn() {
                    _classCallCheck(this, FilteredColumn);

                    /**
                     * This is private because it doesn't need to appear in the session state -- keys are returned by the "get keys()" accessor function
                     */
                    var _this148 = _possibleConstructorReturn(this, (FilteredColumn.__proto__ || Object.getPrototypeOf(FilteredColumn)).call(this));

                    _this148._filteredKeySet = Weave.linkableChild(_this148, FilteredKeySet);
                    /**
                     * This is the dynamically created filter that filters the keys in the column.
                     */
                    _this148.filter = Weave.linkableChild(_this148, _this148._filteredKeySet.keyFilter);
                    _this148._filteredKeySet.setSingleKeySource(_this148.internalDynamicColumn);
                    return _this148;
                }
                /* override */

                _createClass(FilteredColumn, [{
                    key: "containsKey",

                    /**
                     * The filter removes certain records from the column.  This function will return false if the key is not contained in the filter.
                     */
                    /* override */value: function containsKey(key) {
                        // also make internal column request because it may trigger callbacks
                        this.internalDynamicColumn.containsKey(key);
                        return this._filteredKeySet.containsKey(key);
                    }
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        var column = this.internalDynamicColumn.getInternalColumn();
                        var keyFilter = this.filter.getInternalKeyFilter();
                        if (column) {
                            // always make internal column request because it may trigger callbacks
                            var value = column.getValueFromKey(key, dataType);
                            if (!keyFilter || keyFilter.containsKey(key)) return value;
                        }
                        if (dataType) return EquationColumnLib.cast(undefined, dataType);
                        return undefined;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        // also make internal column request because it may trigger callbacks
                        if (this.internalDynamicColumn.keys) return this._filteredKeySet.keys;
                        return [];
                    }
                }]);

                return FilteredColumn;
            }(column_2.ExtendedDynamicColumn);
            FilteredColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.FilteredColumn", interfaces: [IColumnWrapper, IAttributeColumn, ICallbackCollection] })], FilteredColumn);
            column_2.FilteredColumn = FilteredColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var LinkableVariable = weavejs.core.LinkableVariable;
            var EquationColumnLib = weavejs.data.EquationColumnLib;
            var Dictionary2D = weavejs.util.Dictionary2D;
            var StandardLib = weavejs.util.StandardLib;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            /**
             * AlwaysDefinedColumn
             *
             * @author adufilie
             */
            var AlwaysDefinedColumn_1 = void 0;
            var AlwaysDefinedColumn = AlwaysDefinedColumn_1 = function (_column$ExtendedDynam4) {
                _inherits(AlwaysDefinedColumn, _column$ExtendedDynam4);

                function AlwaysDefinedColumn() {
                    var defaultValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;
                    var defaultValueVerifier = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    _classCallCheck(this, AlwaysDefinedColumn);

                    var _this149 = _possibleConstructorReturn(this, (AlwaysDefinedColumn.__proto__ || Object.getPrototypeOf(AlwaysDefinedColumn)).call(this));

                    _this149.d2d_type_key = new Dictionary2D(true, true);
                    _this149._cacheCounter = 0;
                    _this149._defaultValue = new LinkableVariable(null, defaultValueVerifier, defaultValue);
                    Weave.linkableChild(_this149, _this149._defaultValue, _this149.handleDefaultValueChange);
                    return _this149;
                }
                /**
                 * @param key A key to test.
                 * @return true if the key exists in this IKeySet.
                 */
                /* override */

                _createClass(AlwaysDefinedColumn, [{
                    key: "containsKey",
                    value: function containsKey(key) {
                        return true;
                    }
                }, {
                    key: "handleDefaultValueChange",
                    value: function handleDefaultValueChange() {
                        this._cachedDefaultValue = this.defaultValue.state;
                    }
                    /**
                     * @param key A key of the type specified by keyType.
                     * @return The value associated with the given key.
                     */
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (!dataType) dataType = Array;
                        if (!column.DynamicColumn.cache) {
                            var value = this.internalDynamicColumn.getValueFromKey(key, dataType);
                            if (StandardLib.isUndefined(value, true)) value = EquationColumnLib.cast(this._cachedDefaultValue, dataType);
                            return value;
                        }
                        if (this.triggerCounter != this._cacheCounter) {
                            this._cacheCounter = this.triggerCounter;
                            this.d2d_type_key = new Dictionary2D(true, true);
                        }
                        value = this.d2d_type_key.get(dataType, key);
                        if (value === undefined) {
                            value = this.internalDynamicColumn.getValueFromKey(key, dataType);
                            if (StandardLib.isUndefined(value, true)) value = EquationColumnLib.cast(this._cachedDefaultValue, dataType);
                            this.d2d_type_key.set(dataType, key, value === undefined ? AlwaysDefinedColumn_1.UNDEFINED : value);
                        }
                        return value === AlwaysDefinedColumn_1.UNDEFINED ? undefined : value;
                    }
                }, {
                    key: "defaultValue",
                    get: function get() {
                        return this._defaultValue;
                    }
                }]);

                return AlwaysDefinedColumn;
            }(column.ExtendedDynamicColumn);
            AlwaysDefinedColumn.UNDEFINED = {};
            AlwaysDefinedColumn = AlwaysDefinedColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column", interfaces: [IAttributeColumn, IColumnWrapper, ICallbackCollection] })], AlwaysDefinedColumn);
            column.AlwaysDefinedColumn = AlwaysDefinedColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var JS = weavejs.util.JS;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * This object contains a mapping from keys to data values.
             *
             * @author adufilie
             */
            var AbstractAttributeColumn_1 = void 0;
            var AbstractAttributeColumn = AbstractAttributeColumn_1 = function (_CallbackCollection4) {
                _inherits(AbstractAttributeColumn, _CallbackCollection4);

                function AbstractAttributeColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, AbstractAttributeColumn);

                    var _this150 = _possibleConstructorReturn(this, (AbstractAttributeColumn.__proto__ || Object.getPrototypeOf(AbstractAttributeColumn)).call(this));

                    _this150._metadata = null;
                    if (metadata) _this150.setMetadata(metadata);
                    return _this150;
                }
                /**
                 * This function should only be called once, before setting the record data.
                 * @param metadata Metadata for this column.
                 */


                _createClass(AbstractAttributeColumn, [{
                    key: "setMetadata",
                    value: function setMetadata(metadata) {
                        if (this._metadata !== null) throw new Error("Cannot call setMetadata() if already set");
                        // make a copy because we don't want any surprises (metadata being set afterwards)
                        this._metadata = AbstractAttributeColumn_1.copyValues(metadata);
                        // make sure dataType will be included in getMetadataPropertyNames() result
                        this._metadata.dataType = this.getMetadata(ColumnMetadata.DATA_TYPE); // TODO
                    }
                    /**
                     * Copies key/value pairs from an Object.
                     * Converts Array values to Strings using WeaveAPI.CSVParser.createCSVRow().
                     */

                }, {
                    key: "getMetadata",

                    // metadata for this attributeColumn (statistics, description, unit, etc)
                    value: function getMetadata(propertyName) {
                        var value = null;
                        if (this._metadata) value = this._metadata[propertyName] || null;
                        return value;
                    }
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        return JS.objectKeys(this._metadata);
                    }
                }, {
                    key: "containsKey",
                    value: function containsKey(key) {
                        return this.dataTask.map_key_arrayData.has(key);
                    }
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        var array = this.dataTask.map_key_arrayData.get(key);
                        if (!array) return dataType === String ? '' : undefined;
                        if (!dataType || dataType === Array) return array;
                        var value = this.dataCache.get(dataType, key);
                        if (value === undefined) {
                            value = this.generateValue(key, dataType);
                            if (!Weave.IS(value, dataType)) throw new Error("generateValue() did not produce a value of the requested type. Expected " + Weave.className(dataType) + ", got " + Weave.className(value));
                            this.dataCache.set(dataType, key, value);
                        }
                        return value;
                    }
                    /**
                     * Used by default getValueFromKey() implementation to cache values.
                     */

                }, {
                    key: "generateValue",
                    value: function generateValue(key, dataType) {
                        return null;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this.dataTask.uniqueKeys;
                    }
                }], [{
                    key: "copyValues",
                    value: function copyValues(object) {
                        var copy = {};
                        for (var key in object) {
                            var value = object[key];
                            if (Weave.IS(value, Array)) copy[key] = JSON.stringify(value);else copy[key] = value;
                        }
                        return copy;
                    }
                }]);

                return AbstractAttributeColumn;
            }(CallbackCollection);
            AbstractAttributeColumn = AbstractAttributeColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.AbstractAttributeColumn", interfaces: [ICallbackCollection, IAttributeColumn] })], AbstractAttributeColumn);
            column.AbstractAttributeColumn = AbstractAttributeColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var Bounds2D = weavejs.geom.Bounds2D;
            var GeometryStreamDecoder = weavejs.geom.GeometryStreamDecoder;
            var KDTree = weavejs.geom.KDTree;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var DebugUtils = weavejs.util.DebugUtils;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            /**
             * StreamedGeometryColumn
             *
             * @author adufilie
             */
            var StreamedGeometryColumn_1 = void 0;
            var StreamedGeometryColumn = StreamedGeometryColumn_1 = function (_column$AbstractAttri) {
                _inherits(StreamedGeometryColumn, _column$AbstractAttri);

                function StreamedGeometryColumn(metadataTileDescriptors, geometryTileDescriptors, tileService) {
                    var metadata = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    _classCallCheck(this, StreamedGeometryColumn);

                    var _this151 = _possibleConstructorReturn(this, (StreamedGeometryColumn.__proto__ || Object.getPrototypeOf(StreamedGeometryColumn)).call(this, metadata));

                    _this151._geometryStreamDecoder = Weave.linkableChild(_this151, GeometryStreamDecoder);
                    _this151._geometryStreamDownloadCounter = 0;
                    _this151._metadataStreamDownloadCounter = 0;
                    _this151.metadataTilesPerQuery = 200; //10;
                    _this151.geometryTilesPerQuery = 200; //30;
                    _this151._totalDownloadedSize = 0;
                    _this151._tileService = Weave.linkableChild(_this151, tileService);
                    Weave.getCallbacks(_this151._tileService).addDisposeCallback(_this151, _this151.handleTileServiceDispose);
                    _this151._geometryStreamDecoder.keyType = metadata.keyType;
                    // handle tile descriptors
                    WeaveAPI.Scheduler.callLater(_this151._geometryStreamDecoder, _this151._geometryStreamDecoder.decodeMetadataTileList, [metadataTileDescriptors]);
                    WeaveAPI.Scheduler.callLater(_this151._geometryStreamDecoder, _this151._geometryStreamDecoder.decodeGeometryTileList, [geometryTileDescriptors]);
                    _this151.boundingBoxCallbacks.addImmediateCallback(_this151, function () {
                        if (StreamedGeometryColumn_1.debug) DebugUtils.debugTrace(_this151, 'boundingBoxCallbacks', _this151.boundingBoxCallbacks, _this151.keys.length, 'keys');
                    });
                    _this151.addImmediateCallback(_this151, function () {
                        if (StreamedGeometryColumn_1.debug) DebugUtils.debugTrace(_this151, _this151.keys.length, 'keys');
                    });
                    return _this151;
                }

                _createClass(StreamedGeometryColumn, [{
                    key: "handleTileServiceDispose",
                    value: function handleTileServiceDispose() {
                        if (StreamedGeometryColumn_1.debug) DebugUtils.debugTrace(this, 'tile service disposed');
                        Weave.dispose(this);
                    }
                }, {
                    key: "getMetadata",

                    /* override */value: function getMetadata(propertyName) {
                        return _get(StreamedGeometryColumn.prototype.__proto__ || Object.getPrototypeOf(StreamedGeometryColumn.prototype), "getMetadata", this).call(this, propertyName);
                    }
                    /**
                     * This is a list of unique keys this column defines values for.
                     */
                    /* override */
                }, {
                    key: "containsKey",

                    /* override */value: function containsKey(key) {
                        return this._geometryStreamDecoder.getGeometriesFromKey(key) != null;
                    }
                    /**
                     * @return The Array of geometries associated with the given key (if dataType not specified).
                     */
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        var value = this._geometryStreamDecoder.getGeometriesFromKey(key);
                        // cast to different types
                        if (dataType == Boolean) value = Weave.IS(value, Array);else if (dataType == Number) {
                            var sum = Weave.IS(value, Array) ? 0 : NaN;
                            var _iteratorNormalCompletion88 = true;
                            var _didIteratorError88 = false;
                            var _iteratorError88 = undefined;

                            try {
                                for (var _iterator88 = (value || [])[Symbol.iterator](), _step88; !(_iteratorNormalCompletion88 = (_step88 = _iterator88.next()).done); _iteratorNormalCompletion88 = true) {
                                    var geom = _step88.value;

                                    sum += geom.bounds.getArea();
                                }
                            } catch (err) {
                                _didIteratorError88 = true;
                                _iteratorError88 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion88 && _iterator88.return) {
                                        _iterator88.return();
                                    }
                                } finally {
                                    if (_didIteratorError88) {
                                        throw _iteratorError88;
                                    }
                                }
                            }

                            value = sum;
                        } else if (dataType == String) value = value ? 'Geometry(' + key.keyType + '#' + key.localName + ')' : undefined;
                        return value;
                    }
                }, {
                    key: "isStillDownloading",

                    /**
                     * This function returns true if the column is still downloading tiles.
                     * @return True if there are tiles still downloading.
                     */
                    value: function isStillDownloading() {
                        return this._metadataStreamDownloadCounter > 0 || this._geometryStreamDownloadCounter > 0;
                    }
                }, {
                    key: "requestAllMetadata",
                    value: function requestAllMetadata() {
                        var mode = StreamedGeometryColumn_1.metadataRequestMode;
                        StreamedGeometryColumn_1.metadataRequestMode = StreamedGeometryColumn_1.METADATA_REQUEST_MODE_ALL;
                        this.requestGeometryDetail(this.collectiveBounds, Infinity);
                        StreamedGeometryColumn_1.metadataRequestMode = mode;
                    }
                }, {
                    key: "requestGeometryDetail",
                    value: function requestGeometryDetail(dataBounds, lowestImportance) {
                        var _this152 = this;

                        //JS.log("requestGeometryDetail",dataBounds,lowestImportance);
                        if (dataBounds == null || isNaN(lowestImportance)) return;
                        // don't bother downloading if we know the result will be empty
                        if (dataBounds.isEmpty()) return;
                        var metaRequestBounds;
                        var metaRequestImportance;
                        switch (StreamedGeometryColumn_1.metadataRequestMode) {
                            case StreamedGeometryColumn_1.METADATA_REQUEST_MODE_ALL:
                                metaRequestBounds = this._geometryStreamDecoder.collectiveBounds;
                                metaRequestImportance = 0;
                                break;
                            case StreamedGeometryColumn_1.METADATA_REQUEST_MODE_XY:
                                metaRequestBounds = dataBounds;
                                metaRequestImportance = 0;
                                break;
                            case StreamedGeometryColumn_1.METADATA_REQUEST_MODE_XYZ:
                                metaRequestBounds = dataBounds;
                                metaRequestImportance = lowestImportance;
                                break;
                        }
                        // request metadata tiles
                        var metadataTileIDs = this._geometryStreamDecoder.getRequiredMetadataTileIDs(metaRequestBounds, metaRequestImportance, true); // TODO
                        // request geometry tiles needed for desired dataBounds and zoom level (filter by XYZ)
                        var geometryTileIDs = this._geometryStreamDecoder.getRequiredGeometryTileIDs(dataBounds, lowestImportance, true); // TODO
                        if (StreamedGeometryColumn_1.debug) {
                            if (metadataTileIDs.length > 0) console.log(this, "requesting metadata tiles: " + metadataTileIDs);
                            if (geometryTileIDs.length > 0) console.log(this, "requesting geometry tiles: " + geometryTileIDs);
                        }
                        var query;
                        // make requests for groups of tiles
                        while (metadataTileIDs.length > 0) {
                            query = this._tileService.getMetadataTiles(metadataTileIDs.splice(0, this.metadataTilesPerQuery));
                            query.then(function (result) {
                                return _this152.handleMetadataStreamDownload(result);
                            }, function (error) {
                                return _this152.handleMetadataDownloadFault(error);
                            });
                            this._metadataStreamDownloadCounter++;
                        }
                        // make requests for groups of tiles
                        while (geometryTileIDs.length > 0) {
                            query = this._tileService.getGeometryTiles(geometryTileIDs.splice(0, this.geometryTilesPerQuery));
                            query.then(function (result) {
                                return _this152.handleGeometryStreamDownload(result);
                            }, function (error) {
                                return _this152.handleGeometryDownloadFault(error);
                            });
                            this._geometryStreamDownloadCounter++;
                        }
                    }
                }, {
                    key: "handleMetadataDownloadFault",
                    value: function handleMetadataDownloadFault(error) {
                        if (!this.wasDisposed) console.error(error);
                        //JS.log("handleDownloadFault",token,ObjectUtil.toString(event));
                        this._metadataStreamDownloadCounter--;
                    }
                }, {
                    key: "handleGeometryDownloadFault",
                    value: function handleGeometryDownloadFault(error) {
                        if (!this.wasDisposed) JS.error(error);
                        //JS.log("handleDownloadFault",token,ObjectUtil.toString(event));
                        this._geometryStreamDownloadCounter--;
                    }
                }, {
                    key: "requestGeometryDetailForZoomBounds",
                    value: function requestGeometryDetailForZoomBounds(zoomBounds) {
                        if (!StreamedGeometryColumn_1._tempDataBounds) StreamedGeometryColumn_1._tempDataBounds = new Bounds2D();
                        if (!StreamedGeometryColumn_1._tempScreenBounds) StreamedGeometryColumn_1._tempScreenBounds = new Bounds2D();
                        zoomBounds.getDataBounds(StreamedGeometryColumn_1._tempDataBounds);
                        zoomBounds.getScreenBounds(StreamedGeometryColumn_1._tempScreenBounds);
                        var minImportance = StreamedGeometryColumn_1._tempDataBounds.getArea() / StreamedGeometryColumn_1._tempScreenBounds.getArea();
                        var requestedDataBounds = StreamedGeometryColumn_1._tempDataBounds;
                        var requestedMinImportance = minImportance;
                        if (requestedDataBounds.isUndefined()) {
                            // use the collective bounds from the geometry column and re-calculate the min importance
                            requestedDataBounds = this.collectiveBounds;
                            requestedMinImportance = requestedDataBounds.getArea() / StreamedGeometryColumn_1._tempScreenBounds.getArea();
                        }
                        // only request more detail if requestedDataBounds is defined
                        if (!requestedDataBounds.isUndefined()) this.requestGeometryDetail(requestedDataBounds, requestedMinImportance);
                    }
                }, {
                    key: "reportNullResult",
                    value: function reportNullResult(token) {
                        console.error("Did not receive any data from service for geometry column.", token);
                    }
                }, {
                    key: "handleMetadataStreamDownload",
                    value: function handleMetadataStreamDownload(result) {
                        this._metadataStreamDownloadCounter--;
                        if (result == null) {
                            this.reportNullResult(this);
                            return;
                        }
                        this._totalDownloadedSize += result.length;
                        //JS.log("handleMetadataStreamDownload "+result.length,"total bytes "+_totalDownloadedSize);
                        // when decoding finishes, run callbacks
                        this._geometryStreamDecoder.decodeMetadataStream(result);
                    }
                }, {
                    key: "handleGeometryStreamDownload",
                    value: function handleGeometryStreamDownload(result) {
                        this._geometryStreamDownloadCounter--;
                        if (result == null) {
                            this.reportNullResult(this);
                            return;
                        }
                        this._totalDownloadedSize += result.length;
                        //JS.log("handleGeometryStreamDownload "+result.length,"total bytes "+_totalDownloadedSize);
                        // when decoding finishes, run callbacks
                        this._geometryStreamDecoder.decodeGeometryStream(result);
                    }
                }, {
                    key: "test_kdtree",
                    value: function test_kdtree() {
                        var iterations = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;

                        var todo = []; // TODO
                        var _iteratorNormalCompletion89 = true;
                        var _didIteratorError89 = false;
                        var _iteratorError89 = undefined;

                        try {
                            for (var _iterator89 = this._geometryStreamDecoder.geometries[Symbol.iterator](), _step89; !(_iteratorNormalCompletion89 = (_step89 = _iterator89.next()).done); _iteratorNormalCompletion89 = true) {
                                var geom = _step89.value;

                                var bounds = geom.bounds;
                                var key = [bounds.getXNumericMin(), bounds.getYNumericMin(), bounds.getXNumericMax(), bounds.getYNumericMax(), bounds.getArea()];
                                todo.push([key, geom]);
                            }
                            // ------
                        } catch (err) {
                            _didIteratorError89 = true;
                            _iteratorError89 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion89 && _iterator89.return) {
                                    _iterator89.return();
                                }
                            } finally {
                                if (_didIteratorError89) {
                                    throw _iteratorError89;
                                }
                            }
                        }

                        var results = [];
                        for (var i = 0; i < iterations; i++) {
                            ArrayUtils.randomSort(todo);
                            var t = Date.now();
                            var kdtree = new KDTree(5);
                            var _iteratorNormalCompletion90 = true;
                            var _didIteratorError90 = false;
                            var _iteratorError90 = undefined;

                            try {
                                for (var _iterator90 = todo[Symbol.iterator](), _step90; !(_iteratorNormalCompletion90 = (_step90 = _iterator90.next()).done); _iteratorNormalCompletion90 = true) {
                                    var _step90$value = _slicedToArray(_step90.value, 2);

                                    key = _step90$value[0];
                                    geom = _step90$value[1];

                                    kdtree.insert(key, geom);
                                }
                            } catch (err) {
                                _didIteratorError90 = true;
                                _iteratorError90 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion90 && _iterator90.return) {
                                        _iterator90.return();
                                    }
                                } finally {
                                    if (_didIteratorError90) {
                                        throw _iteratorError90;
                                    }
                                }
                            }

                            t = Date.now() - t;
                            Weave.dispose(kdtree);
                            results.push(t);
                        }
                        return {
                            node_count: todo.length,
                            times_in_ms: results.join(', '),
                            time_mean_ms: StandardLib.mean(results),
                            time_min_ms: Math.min.apply(null, results),
                            time_max_ms: Math.max.apply(null, results)
                        };
                    }
                }, {
                    key: "boundingBoxCallbacks",
                    get: function get() {
                        return this._geometryStreamDecoder.metadataCallbacks;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this._geometryStreamDecoder.keys;
                    }
                }, {
                    key: "collectiveBounds",
                    get: function get() {
                        return this._geometryStreamDecoder.collectiveBounds;
                    }
                }], [{
                    key: "test_kdtree",
                    value: function test_kdtree(weave) {
                        var iterations = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;

                        var cols = WeaveAPI.SessionManager.getLinkableDescendants(weave.root, StreamedGeometryColumn_1);
                        var _iteratorNormalCompletion91 = true;
                        var _didIteratorError91 = false;
                        var _iteratorError91 = undefined;

                        try {
                            for (var _iterator91 = cols[Symbol.iterator](), _step91; !(_iteratorNormalCompletion91 = (_step91 = _iterator91.next()).done); _iteratorNormalCompletion91 = true) {
                                var sgc = _step91.value;

                                return sgc.test_kdtree(iterations);
                            }
                        } catch (err) {
                            _didIteratorError91 = true;
                            _iteratorError91 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion91 && _iterator91.return) {
                                    _iterator91.return();
                                }
                            } finally {
                                if (_didIteratorError91) {
                                    throw _iteratorError91;
                                }
                            }
                        }

                        return "No StreamedGeometryColumn to test";
                    }
                }, {
                    key: "metadataRequestModeEnum",
                    get: function get() {
                        return [StreamedGeometryColumn_1.METADATA_REQUEST_MODE_ALL, StreamedGeometryColumn_1.METADATA_REQUEST_MODE_XY, StreamedGeometryColumn_1.METADATA_REQUEST_MODE_XYZ];
                    }
                }]);

                return StreamedGeometryColumn;
            }(column.AbstractAttributeColumn);
            StreamedGeometryColumn.debug = false;
            StreamedGeometryColumn.METADATA_REQUEST_MODE_ALL = 'all';
            StreamedGeometryColumn.METADATA_REQUEST_MODE_XY = 'xy';
            StreamedGeometryColumn.METADATA_REQUEST_MODE_XYZ = 'xyz';
            /**
             * This mode determines which metadata tiles will be requested based on what geometry data is requested.
             * Possible request modes are:<br>
             *    all -> All metadata tiles, regardless of requested X-Y-Z range <br>
             *    xy -> Metadata tiles contained in the requested X-Y range, regardless of Z range <br>
             *    xyz -> Metadata tiles contained in the requested X-Y-Z range only <br>
             */
            StreamedGeometryColumn.metadataRequestMode = StreamedGeometryColumn.METADATA_REQUEST_MODE_XYZ;
            /**
             * This is the minimum bounding box screen area in pixels required for a geometry to be considered relevant.
             * Should be >= 1.
             */
            StreamedGeometryColumn.geometryMinimumScreenArea = 1;
            StreamedGeometryColumn = StreamedGeometryColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.StreamedGeometryColumn", interfaces: [IAttributeColumn] })], StreamedGeometryColumn);
            column.StreamedGeometryColumn = StreamedGeometryColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            var LinkableString = weavejs.core.LinkableString;
            var EquationColumnLib = weavejs.data.EquationColumnLib;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var KeyColumn = function (_column$AbstractAttri2) {
                _inherits(KeyColumn, _column$AbstractAttri2);

                function KeyColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, KeyColumn);

                    var _this153 = _possibleConstructorReturn(this, (KeyColumn.__proto__ || Object.getPrototypeOf(KeyColumn)).call(this, metadata || {}));

                    _this153.keyType = Weave.linkableChild(_this153, LinkableString);
                    return _this153;
                }
                /* override */

                _createClass(KeyColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (propertyName == ColumnMetadata.TITLE) {
                            var kt = this.keyType.value;
                            if (kt) return Weave.lang("Key ({0})", kt);
                            return Weave.lang("Key");
                        }
                        if (propertyName == ColumnMetadata.KEY_TYPE) return this.keyType.value;
                        return _get(KeyColumn.prototype.__proto__ || Object.getPrototypeOf(KeyColumn.prototype), "getMetadata", this).call(this, propertyName);
                    }
                    /* override */
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        return ArrayUtils.union(_get(KeyColumn.prototype.__proto__ || Object.getPrototypeOf(KeyColumn.prototype), "getMetadataPropertyNames", this).call(this), [ColumnMetadata.TITLE, ColumnMetadata.KEY_TYPE]);
                    }
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        var kt = this.keyType.value;
                        if (kt && key.keyType != kt) return EquationColumnLib.cast(undefined, dataType);
                        if (dataType == String) return key.toString();
                        if (dataType == Number) return key.toNumber();
                        if (dataType == IQualifiedKey) return key;
                        return EquationColumnLib.cast(key, dataType);
                    }
                    /* override */
                }, {
                    key: "keys",
                    get: function get() {
                        return [];
                    }
                }]);

                return KeyColumn;
            }(column.AbstractAttributeColumn);
            KeyColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.KeyColumn", interfaces: [IAttributeColumn, ICallbackCollection] })], KeyColumn);
            column.KeyColumn = KeyColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_4) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableString = weavejs.core.LinkableString;
            var EquationColumnLib = weavejs.data.EquationColumnLib;
            var AsyncSort = weavejs.util.AsyncSort;
            var Dictionary2D = weavejs.util.Dictionary2D;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var SecondaryKeyNumColumn_1 = void 0;
            var SecondaryKeyNumColumn = SecondaryKeyNumColumn_1 = function (_column$AbstractAttri3) {
                _inherits(SecondaryKeyNumColumn, _column$AbstractAttri3);

                function SecondaryKeyNumColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, SecondaryKeyNumColumn);

                    var _this154 = _possibleConstructorReturn(this, (SecondaryKeyNumColumn.__proto__ || Object.getPrototypeOf(SecondaryKeyNumColumn)).call(this, metadata));

                    _this154.TYPE_SUFFIX = ',Year';
                    _this154._minNumber = NaN; // returned by getMetadata
                    _this154._maxNumber = NaN; // returned by getMetadata
                    /**
                     * This object maps keys to data values.
                     */
                    _this154.d2d_qkeyA_keyB_number = new Dictionary2D();
                    _this154.map_qkeyAB_number = new Map();
                    /**
                     * Derived from the record data, this is a list of all existing values in the dimension, each appearing once, sorted alphabetically.
                     */
                    _this154._uniqueStrings = [];
                    _this154._uniqueSecondaryKeys = [];
                    /**
                     * This is a list of unique keys this column defines values for.
                     */
                    _this154._uniqueKeysA = [];
                    _this154._uniqueKeysAB = [];
                    /**
                     * maximum number of significant digits to return when calling deriveStringFromNorm()
                     */
                    _this154.maxDerivedSignificantDigits = 10;
                    _this154.map_qkeyAB_qkeyData = new WeakMap();
                    SecondaryKeyNumColumn_1.secondaryKeyFilter.addImmediateCallback(_this154, _this154.triggerCallbacks);
                    SecondaryKeyNumColumn_1.useGlobalMinMaxValues.addImmediateCallback(_this154, _this154.triggerCallbacks);
                    return _this154;
                }
                /**
                 * This function overrides the min,max values.
                 */
                /* override */

                _createClass(SecondaryKeyNumColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (SecondaryKeyNumColumn_1.useGlobalMinMaxValues.value) {
                            if (propertyName == ColumnMetadata.MIN) return String(this._minNumber);
                            if (propertyName == ColumnMetadata.MAX) return String(this._maxNumber);
                        }
                        var value = _get(SecondaryKeyNumColumn.prototype.__proto__ || Object.getPrototypeOf(SecondaryKeyNumColumn.prototype), "getMetadata", this).call(this, propertyName);
                        switch (propertyName) {
                            case ColumnMetadata.TITLE:
                                value = this.baseTitle || value;
                                if (value != null && SecondaryKeyNumColumn_1.secondaryKeyFilter.value && !SecondaryKeyNumColumn_1.allKeysHack) return value + ' (' + SecondaryKeyNumColumn_1.secondaryKeyFilter.value + ')';
                                break;
                            case ColumnMetadata.KEY_TYPE:
                                if (SecondaryKeyNumColumn_1.secondaryKeyFilter.value == null) return value + this.TYPE_SUFFIX;
                                break;
                            case ColumnMetadata.DATA_TYPE:
                                return value || (this._dataType == Number ? DataTypes.NUMBER : DataTypes.STRING);
                        }
                        return value;
                    }
                    /**
                     * This is the value used to filter the data.
                     */

                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    /* override */value: function containsKey(key) {
                        var skfv = SecondaryKeyNumColumn_1.secondaryKeyFilter.value;
                        if (skfv == null || SecondaryKeyNumColumn_1.allKeysHack) return this.map_qkeyAB_number.get(key) !== undefined;
                        return this.d2d_qkeyA_keyB_number.get(key, skfv) !== undefined;
                    }
                    /**
                     * @param qkeysA Array of IQualifiedKey
                     * @param keysB Array of String
                     * @param data
                     */

                }, {
                    key: "updateRecords",
                    value: function updateRecords(qkeysA, keysB, data) {
                        if (this._uniqueStrings.length > 0) {
                            console.error("Replacing existing records is not supported");
                        }
                        var index, qkeyA, keyB, qkeyAB;
                        var _key;
                        var dataObject = null;
                        if (qkeysA.length != data.length || keysB.length != data.length) {
                            console.error("Array lengths differ");
                            return;
                        }
                        // clear previous data mapping
                        this.d2d_qkeyA_keyB_number = new Dictionary2D();
                        //if it's string data - create list of unique strings
                        var dataType = _get(SecondaryKeyNumColumn.prototype.__proto__ || Object.getPrototypeOf(SecondaryKeyNumColumn.prototype), "getMetadata", this).call(this, ColumnMetadata.DATA_TYPE);
                        if (Weave.IS(data[0], String) || dataType && dataType != DataTypes.NUMBER) {
                            if (!dataType) dataType = DataTypes.STRING;
                            for (var i = 0; i < data.length; i++) {
                                if (this._uniqueStrings.indexOf(data[i]) < 0) this._uniqueStrings.push(data[i]);
                            }
                            AsyncSort.sortImmediately(this._uniqueStrings);
                            // min,max numbers are the min,max indices in the unique strings array
                            this._minNumber = 0;
                            this._maxNumber = this._uniqueStrings.length - 1;
                        } else {
                            dataType = DataTypes.NUMBER;
                            // reset min,max before looping over records
                            this._minNumber = NaN;
                            this._maxNumber = NaN;
                        }
                        this._metadata.dataType = dataType;
                        this._dataType = dataType == DataTypes.NUMBER ? Number : String;
                        // save a mapping from keys to data
                        for (index = 0; index < qkeysA.length; index++) {
                            qkeyA = qkeysA[index];
                            keyB = String(keysB[index]);
                            dataObject = data[index];
                            qkeyAB = WeaveAPI.QKeyManager.getQKey(qkeyA.keyType + this.TYPE_SUFFIX, qkeyA.localName + ',' + keyB);
                            //if we don't already have keyB - add it to _uniqueKeysB
                            //  @todo - optimize this - searching every time is not the optimal method
                            if (this._uniqueSecondaryKeys.indexOf(keyB) < 0) this._uniqueSecondaryKeys.push(keyB);
                            if (Weave.IS(dataObject, String)) {
                                var iString = this._uniqueStrings.indexOf(dataObject);
                                if (iString < 0) {
                                    //iString = _uniqueStrings.push(dataObject) - 1;
                                    iString = this._uniqueStrings.length;
                                    this._uniqueStrings[iString] = dataObject;
                                }
                                this.d2d_qkeyA_keyB_number.set(qkeyA, keyB, iString);
                                this.map_qkeyAB_number.set(qkeyAB, iString);
                            } else {
                                this.d2d_qkeyA_keyB_number.set(qkeyA, keyB, dataObject); //Number(dataObject));
                                this.map_qkeyAB_number.set(qkeyAB, dataObject); //Number(dataObject));
                                this._minNumber = isNaN(this._minNumber) ? dataObject : Math.min(this._minNumber, dataObject);
                                this._maxNumber = isNaN(this._maxNumber) ? dataObject : Math.max(this._maxNumber, dataObject);
                            }
                        }
                        AsyncSort.sortImmediately(this._uniqueSecondaryKeys);
                        // save lists of unique keys
                        this._uniqueKeysA = this.d2d_qkeyA_keyB_number.primaryKeys();
                        this._uniqueKeysAB = JS.mapKeys(this.map_qkeyAB_number);
                        this.triggerCallbacks();
                    }
                    // get a string value for a given numeric value

                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(number) {
                        if (int(number) == number && this._uniqueStrings.length > 0 && number < this._uniqueStrings.length) return this._uniqueStrings[number];
                        return StandardLib.formatNumber(StandardLib.roundSignificant(number, this.maxDerivedSignificantDigits));
                    }
                    /**
                     * get data from key value
                     */
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(qkey) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (!dataType) dataType = this._dataType;
                        var value = NaN;
                        if (this.map_qkeyAB_number.has(qkey)) value = this.map_qkeyAB_number.get(qkey);else value = this.d2d_qkeyA_keyB_number.get(qkey, SecondaryKeyNumColumn_1.secondaryKeyFilter.value);
                        if (isNaN(value)) return EquationColumnLib.cast(undefined, dataType);
                        if (dataType == IQualifiedKey) {
                            if (!this.map_qkeyAB_qkeyData.has(qkey)) {
                                var type = this.getMetadata(ColumnMetadata.DATA_TYPE);
                                if (type == DataTypes.NUMBER) return null;
                                if (type == '') type = DataTypes.STRING;
                                this.map_qkeyAB_qkeyData.set(qkey, WeaveAPI.QKeyManager.getQKey(type, this.deriveStringFromNumber(value)));
                            }
                            return this.map_qkeyAB_qkeyData.get(qkey);
                        }
                        if (dataType == String) return this.deriveStringFromNumber(value);
                        return value;
                    }
                }, {
                    key: "secondaryKeys",
                    get: function get() {
                        return this._uniqueSecondaryKeys;
                    }
                    /* override */
                }, {
                    key: "keys",
                    get: function get() {
                        if (SecondaryKeyNumColumn_1.secondaryKeyFilter.value == null || SecondaryKeyNumColumn_1.allKeysHack) return this._uniqueKeysAB;
                        return this._uniqueKeysA;
                    }
                }], [{
                    key: "secondaryKeyFilter",
                    get: function get() {
                        if (!SecondaryKeyNumColumn_1._secondaryKeyFilter) SecondaryKeyNumColumn_1._secondaryKeyFilter = new LinkableString();
                        return SecondaryKeyNumColumn_1._secondaryKeyFilter;
                    }
                }, {
                    key: "useGlobalMinMaxValues",
                    get: function get() {
                        if (!SecondaryKeyNumColumn_1._useGlobalMinMaxValues) SecondaryKeyNumColumn_1._useGlobalMinMaxValues = new LinkableBoolean(true);
                        return SecondaryKeyNumColumn_1._useGlobalMinMaxValues;
                    }
                }]);

                return SecondaryKeyNumColumn;
            }(column.AbstractAttributeColumn);
            SecondaryKeyNumColumn.allKeysHack = false; // used by DataTableTool
            SecondaryKeyNumColumn = SecondaryKeyNumColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.SecondaryKeyNumColumn", interfaces: [IAttributeColumn, ICallbackCollection, IPrimitiveColumn] })], SecondaryKeyNumColumn);
            column.SecondaryKeyNumColumn = SecondaryKeyNumColumn;
        })(column = data_4.column || (data_4.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var IBaseColumn = weavejs.api.data.IBaseColumn;
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            var GeneralizedGeometry = weavejs.geom.GeneralizedGeometry;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            /**
             * The values in this column are Arrays of GeneralizedGeometry objects.
             *
             * @author adufilie
             */
            var GeometryColumn = function (_column$AbstractAttri4) {
                _inherits(GeometryColumn, _column$AbstractAttri4);

                function GeometryColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, GeometryColumn);

                    /**
                     * This object maps a key to an array of geometry objects that have that key.
                     */
                    var _this155 = _possibleConstructorReturn(this, (GeometryColumn.__proto__ || Object.getPrototypeOf(GeometryColumn)).call(this, metadata));

                    _this155.map_key_geomArray = new WeakMap();
                    /**
                     * This vector maps an index value to a GeneralizedGeometry object.
                     */
                    _this155._geometryVector = [];
                    /**
                     * This maps a GeneralizedGeometry object to its index in _geometryVector.
                     */
                    _this155._geometryToIndexMapping = new WeakMap();
                    _this155._uniqueKeys = [];
                    return _this155;
                }
                /**
                 * This is a list of unique keys this column defines values for.
                 */
                /* override */

                _createClass(GeometryColumn, [{
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    /* override */value: function containsKey(key) {
                        return this.map_key_geomArray.has(key);
                    }
                }, {
                    key: "setRecords",
                    value: function setRecords(keys, geometries) {
                        if (this._geometryVector.length > 0) {
                            // clear existing mappings
                            this.map_key_geomArray = new WeakMap();
                            this._geometryToIndexMapping = new WeakMap();
                        }
                        if (keys.length != geometries.length) {
                            console.error("number of keys does not match number of geometires in GeometryColumn.setGeometries()");
                            return;
                        }
                        // make a copy of the geometry vector and 
                        // create key->geom and geom->index mappings
                        var geom;
                        var key;
                        var uniqueKeyIndex = 0;
                        for (var geomIndex = 0; geomIndex < geometries.length; geomIndex++) {
                            geom = Weave.AS(geometries[geomIndex], GeneralizedGeometry);
                            key = Weave.AS(keys[geomIndex], IQualifiedKey);
                            this._geometryVector[geomIndex] = geom;
                            if (!this.map_key_geomArray.has(key)) {
                                this.map_key_geomArray.set(key, [geom]);
                                this._uniqueKeys[uniqueKeyIndex] = key; // remember unique keys
                                uniqueKeyIndex++;
                            } else Weave.AS(this.map_key_geomArray.get(key), Array).push(geom);
                            this._geometryToIndexMapping.set(geom, geomIndex);
                        }
                        // trim vectors to new sizes
                        this._geometryVector.length = geometries.length;
                        this._uniqueKeys.length = uniqueKeyIndex;
                        this.triggerCallbacks();
                    }
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        var value = this.map_key_geomArray.get(key);
                        // cast to different types
                        if (dataType == Boolean) value = Weave.IS(value, Array);else if (dataType == Number) {
                            var sum = Weave.IS(value, Array) ? 0 : NaN;
                            var _iteratorNormalCompletion92 = true;
                            var _didIteratorError92 = false;
                            var _iteratorError92 = undefined;

                            try {
                                for (var _iterator92 = (value || [])[Symbol.iterator](), _step92; !(_iteratorNormalCompletion92 = (_step92 = _iterator92.next()).done); _iteratorNormalCompletion92 = true) {
                                    var geom = _step92.value;

                                    sum += geom.bounds.getArea();
                                }
                            } catch (err) {
                                _didIteratorError92 = true;
                                _iteratorError92 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion92 && _iterator92.return) {
                                        _iterator92.return();
                                    }
                                } finally {
                                    if (_didIteratorError92) {
                                        throw _iteratorError92;
                                    }
                                }
                            }

                            value = sum;
                        } else if (dataType == String) value = value ? 'Geometry(' + key.keyType + '#' + key.localName + ')' : undefined;
                        return value;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this._uniqueKeys;
                    }
                }]);

                return GeometryColumn;
            }(column.AbstractAttributeColumn);
            GeometryColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.GeometryColumn", interfaces: [IAttributeColumn, ICallbackCollection, IBaseColumn] })], GeometryColumn);
            column.GeometryColumn = GeometryColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var Aggregation = weavejs.api.data.Aggregation;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IBaseColumn = weavejs.api.data.IBaseColumn;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            var AsyncSort = weavejs.util.AsyncSort;
            var Dictionary2D = weavejs.util.Dictionary2D;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            /**
             * @author adufilie
             */
            var StringColumn_1 = void 0;
            var StringColumn = StringColumn_1 = function (_column$AbstractAttri5) {
                _inherits(StringColumn, _column$AbstractAttri5);

                function StringColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, StringColumn);

                    /**
                     * Sorted list of unique string values.
                     */
                    var _this156 = _possibleConstructorReturn(this, (StringColumn.__proto__ || Object.getPrototypeOf(StringColumn)).call(this, metadata));

                    _this156._uniqueStrings = [];
                    /**
                     * String -> index in sorted _uniqueStrings
                     */
                    _this156._uniqueStringLookup = new Map();
                    // variables that do not get reset after async task
                    _this156._stringToNumberFunction = null;
                    _this156._numberToStringFunction = null;
                    _this156._asyncSort = Weave.disposableChild(_this156, AsyncSort);
                    _this156._numberToString = new Map();
                    _this156._stringToNumber = new Map();
                    _this156.dataTask = new column.ColumnDataTask(_this156, function (value) {
                        return _this156.filterStringValue(value);
                    }, function () {
                        return _this156.handleDataTaskComplete();
                    });
                    _this156.dataCache = new Dictionary2D();
                    Weave.getCallbacks(_this156._asyncSort).addImmediateCallback(_this156, _this156.handleSortComplete);
                    return _this156;
                }
                /* override */

                _createClass(StringColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        var value = _get(StringColumn.prototype.__proto__ || Object.getPrototypeOf(StringColumn.prototype), "getMetadata", this).call(this, propertyName);
                        if (!value && propertyName == ColumnMetadata.DATA_TYPE) return DataTypes.STRING;
                        return value;
                    }
                }, {
                    key: "setRecords",
                    value: function setRecords(keys, stringData) {
                        var _this157 = this;

                        this.dataTask.begin(keys, stringData);
                        this._asyncSort.abort();
                        this._uniqueStrings.length = 0;
                        this._uniqueStringLookup.clear();
                        this._stringToNumberFunction = null;
                        this._numberToStringFunction = null;
                        // compile the number format function from the metadata
                        var numberFormat = this.getMetadata(ColumnMetadata.NUMBER);
                        if (numberFormat) {
                            try {
                                this._stringToNumberFunction = JS.compile(numberFormat, [ColumnMetadata.STRING, 'array'], function (e) {
                                    return _this157.errorHandler(e);
                                });
                            } catch (e) {
                                console.error(e);
                            }
                        }
                        // compile the string format function from the metadata
                        var stringFormat = this.getMetadata(ColumnMetadata.STRING);
                        if (stringFormat) {
                            try {
                                this._numberToStringFunction = JS.compile(stringFormat, [ColumnMetadata.NUMBER], function (e) {
                                    return _this157.errorHandler(e);
                                });
                            } catch (e) {
                                console.error(e);
                            }
                        }
                    }
                }, {
                    key: "errorHandler",
                    value: function errorHandler(e) {
                        var str = Weave.IS(e, Error) ? e.message : String(e);
                        str = StandardLib.substitute("Error in script for AttributeColumn {0}:\n{1}", Weave.stringify(this._metadata), str);
                        if (this._lastError != str) {
                            this._lastError = str;
                            console.error(e);
                        }
                    }
                }, {
                    key: "filterStringValue",
                    value: function filterStringValue(value) {
                        if (!value) return false;
                        // keep track of unique strings
                        if (!this._uniqueStringLookup.has(value)) {
                            this._uniqueStrings.push(value);
                            // initialize mapping
                            this._uniqueStringLookup.set(value, -1);
                        }
                        return true;
                    }
                }, {
                    key: "handleDataTaskComplete",
                    value: function handleDataTaskComplete() {
                        // begin sorting unique strings previously listed
                        this._asyncSort.beginSort(this._uniqueStrings, AsyncSort.compareCaseInsensitive);
                    }
                }, {
                    key: "handleSortComplete",
                    value: function handleSortComplete() {
                        if (!this._asyncSort.result) return;
                        this._i = 0;
                        this._numberToString.clear();
                        this._stringToNumber.clear();
                        // high priority because not much can be done without data
                        WeaveAPI.Scheduler.startTask(this, this._iterate, WeaveAPI.TASK_PRIORITY_HIGH, this.asyncComplete);
                    }
                }, {
                    key: "_iterate",
                    value: function _iterate(stopTime) {
                        for (; this._i < this._uniqueStrings.length; this._i++) {
                            if (Date.now() > stopTime) return this._i / this._uniqueStrings.length;
                            var string = this._uniqueStrings[this._i];
                            this._uniqueStringLookup.set(string, this._i);
                            if (this._stringToNumberFunction != null) {
                                var number = StandardLib.asNumber(this._stringToNumberFunction(string));
                                this._stringToNumber.set(string, number);
                                this._numberToString.set(number, string);
                            }
                        }
                        return 1;
                    }
                }, {
                    key: "asyncComplete",
                    value: function asyncComplete() {
                        // cache needs to be cleared after async task completes because some values may have been cached while the task was busy
                        this.dataCache.map.clear();
                        this.triggerCallbacks();
                    }
                    // find the closest string value at a given normalized value

                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(number) {
                        if (this._metadata && this._metadata[ColumnMetadata.NUMBER]) {
                            if (this._numberToString.has(number)) return this._numberToString.get(number);
                            if (this._numberToStringFunction != null) {
                                var string = StandardLib.asString(this._numberToStringFunction(number));
                                this._numberToString.set(number, string);
                                return string;
                            }
                        } else if (number == int(number) && 0 <= number && number < this._uniqueStrings.length) {
                            return this._uniqueStrings[int(number)];
                        }
                        return '';
                    }
                    /* override */
                }, {
                    key: "generateValue",
                    value: function generateValue(key, dataType) {
                        var array = this.dataTask.map_key_arrayData.get(key);
                        if (dataType === String) return StringColumn_1.aggregate(array, this._metadata ? this._metadata[ColumnMetadata.AGGREGATION] : null) || '';
                        var string = this.getValueFromKey(key, String);
                        if (dataType === Number) {
                            if (this._stringToNumberFunction != null) return Number(this._stringToNumber.get(string));
                            return Number(this._uniqueStringLookup.get(string));
                        }
                        if (dataType === IQualifiedKey) {
                            var type = this._metadata ? this._metadata[ColumnMetadata.DATA_TYPE] : null;
                            if (!type) type = DataTypes.STRING;
                            return WeaveAPI.QKeyManager.getQKey(type, string);
                        }
                        return null;
                    }
                    /**
                     * Aggregates an Array of Strings into a single String.
                     * @param strings An Array of Strings.
                     * @param aggregation One of the constants in weave.api.data.Aggregation.
                     * @return An aggregated String.
                     * @see weave.api.data.Aggregation
                     */

                }], [{
                    key: "aggregate",
                    value: function aggregate(strings, aggregation) {
                        if (!strings) return undefined;
                        if (!aggregation) aggregation = Aggregation.DEFAULT;
                        switch (aggregation) {
                            default:
                            case Aggregation.SAME:
                                var first = strings[0];
                                var _iteratorNormalCompletion93 = true;
                                var _didIteratorError93 = false;
                                var _iteratorError93 = undefined;

                                try {
                                    for (var _iterator93 = (strings || [])[Symbol.iterator](), _step93; !(_iteratorNormalCompletion93 = (_step93 = _iterator93.next()).done); _iteratorNormalCompletion93 = true) {
                                        var value = _step93.value;

                                        if (value != first) return Weave.lang(Aggregation.AMBIGUOUS_DATA);
                                    }
                                } catch (err) {
                                    _didIteratorError93 = true;
                                    _iteratorError93 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion93 && _iterator93.return) {
                                            _iterator93.return();
                                        }
                                    } finally {
                                        if (_didIteratorError93) {
                                            throw _iteratorError93;
                                        }
                                    }
                                }

                                return first;
                            case Aggregation.FIRST:
                                return strings[0];
                            case Aggregation.LAST:
                                return strings[strings.length - 1];
                        }
                    }
                }, {
                    key: "getSupportedAggregationModes",
                    value: function getSupportedAggregationModes() {
                        return [Aggregation.SAME, Aggregation.FIRST, Aggregation.LAST];
                    }
                }]);

                return StringColumn;
            }(column.AbstractAttributeColumn);
            StringColumn = StringColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.StringColumn", interfaces: [IPrimitiveColumn, IBaseColumn, IAttributeColumn, ICallbackCollection] })], StringColumn);
            column.StringColumn = StringColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IKeySet = weavejs.api.data.IKeySet;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var EquationColumnLib = weavejs.data.EquationColumnLib;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var Dictionary2D = weavejs.util.Dictionary2D;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * This is a column of data derived from an equation with variables.
             *
             * @author adufilie
             */
            var EquationColumn_1 = void 0;
            var EquationColumn = EquationColumn_1 = function (_column$AbstractAttri6) {
                _inherits(EquationColumn, _column$AbstractAttri6);

                function EquationColumn() {
                    _classCallCheck(this, EquationColumn);

                    /**
                     * This is all the keys in all the variables columns
                     */
                    var _this158 = _possibleConstructorReturn(this, (EquationColumn.__proto__ || Object.getPrototypeOf(EquationColumn)).call(this));

                    _this158._allKeys = null;
                    _this158._allKeysTriggerCount = 0;
                    /**
                     * This is a cache of metadata values derived from the metadata session state.
                     */
                    _this158._cachedMetadata = {};
                    _this158._cachedMetadataTriggerCount = 0;
                    /**
                     * This is the Class corresponding to dataType.value.
                     */
                    _this158._defaultDataType = null;
                    /**
                     * This is the function compiled from the equation.
                     */
                    _this158.compiledEquation = null;
                    /**
                     * This is a mapping from keys to cached data values.
                     */
                    _this158.d2d_key_dataType_value = new Dictionary2D();
                    /**
                     * This is used to determine when to clear the cache.
                     */
                    _this158._cacheTriggerCount = 0;
                    /**
                     * This is the equation that will be used in getValueFromKey().
                     */
                    _this158.equation = Weave.linkableChild(_this158, LinkableString);
                    /**
                     * This is a list of named variables made available to the compiled equation.
                     */
                    _this158.variables = Weave.linkableChild(_this158, LinkableHashMap);
                    /**
                     * This holds the metadata for the column.
                     */
                    _this158.metadata = Weave.linkableChild(_this158, new LinkableVariable(null, _this158.verifyMetadata));
                    /**
                     * Specify whether or not we should filter the keys by the column's keyType.
                     */
                    _this158.filterByKeyType = Weave.linkableChild(_this158, new LinkableBoolean(false));
                    _this158._numberToStringFunction = null;
                    _this158.deriveStringFromNumberObserver = {};
                    _this158.setMetadataProperty(ColumnMetadata.TITLE, "Untitled Equation");
                    //setMetadataProperty(AttributeColumnMetadata.DATA_TYPE, DataTypes.NUMBER);
                    _this158.variables.childListCallbacks.addImmediateCallback(_this158, _this158.handleVariableListChange);
                    return _this158;
                }

                _createClass(EquationColumn, [{
                    key: "handleVariableListChange",
                    value: function handleVariableListChange() {
                        // make callbacks trigger when statistics change for listed variables
                        var newColumn = Weave.AS(this.variables.childListCallbacks.lastObjectAdded, IAttributeColumn);
                        if (newColumn) Weave.getCallbacks(WeaveAPI.StatisticsCache.getColumnStatistics(newColumn)).addImmediateCallback(this, this.triggerCallbacks);
                    }
                }, {
                    key: "verifyMetadata",
                    value: function verifyMetadata(value) {
                        return (typeof value === "undefined" ? "undefined" : _typeof(value)) == 'object';
                    }
                    /**
                     * This function intercepts requests for dataType and title metadata and uses the corresponding linkable variables.
                     * @param propertyName A metadata property name.
                     * @return The requested metadata value.
                     */
                    /* override */
                }, {
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (this._cachedMetadataTriggerCount != this.triggerCounter) {
                            this._cachedMetadata = {};
                            this._cachedMetadataTriggerCount = this.triggerCounter;
                        }
                        if (this._cachedMetadata.hasOwnProperty(propertyName)) return Weave.AS(this._cachedMetadata[propertyName], String);
                        this._cachedMetadata[propertyName] = undefined; // prevent infinite recursion
                        var value = this.metadata.state ? Weave.AS(this.metadata.state[propertyName], String) : null;
                        if (value != null) {
                            if (value.charAt(0) == '{' && value.charAt(value.length - 1) == '}') {
                                try {
                                    var func = JS.compile(value);
                                    value = func.apply(this, arguments);
                                } catch (e) {
                                    this.errorHandler(e);
                                }
                            }
                        } else if (propertyName == ColumnMetadata.KEY_TYPE) {
                            var cols = this.variables.getObjects(IAttributeColumn);
                            if (cols.length) value = Weave.AS(cols[0], IAttributeColumn).getMetadata(propertyName);
                        }
                        this._cachedMetadata[propertyName] = value;
                        return value;
                    }
                }, {
                    key: "errorHandler",
                    value: function errorHandler(e) {
                        var str = Weave.IS(e, Error) ? e.message : String(e);
                        if (this._lastError != str) {
                            this._lastError = str;
                            console.error(e);
                        }
                    }
                    /* override */
                }, {
                    key: "setMetadata",
                    value: function setMetadata(value) {
                        this.metadata.setSessionState(value);
                    }
                    /* override */
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        return Object.keys(this.metadata.getSessionState());
                    }
                    /**
                     * This function will store an individual metadata value in the metadata linkable variable.
                     * @param propertyName
                     * @param value
                     */

                }, {
                    key: "setMetadataProperty",
                    value: function setMetadataProperty(propertyName, value) {
                        value = StandardLib.trim(value);
                        var _metadata = this.metadata.state || {};
                        _metadata[propertyName] = value;
                        this.metadata.state = _metadata; // this triggers callbacks
                    }
                    /**
                     * This function creates an object in the variables LinkableHashMap if it doesn't already exist.
                     * If there is an existing object associated with the specified name, it will be kept if it
                     * is the specified type, or replaced with a new instance of the specified type if it is not.
                     * @param name The identifying name of a new or existing object.
                     * @param classDef The Class of the desired object type.
                     * @return The object associated with the requested name of the requested type, or null if an error occurred.
                     */

                }, {
                    key: "requestVariable",
                    value: function requestVariable(name, classDef) {
                        var lockObject = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

                        return this.variables.requestObject(name, classDef, lockObject);
                    }
                    /**
                     * @return The keys associated with this EquationColumn.
                     */
                    /* override */
                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    /* override */value: function containsKey(key) {
                        return this.keys && this.map_allKeys.has(key);
                    }
                    /**
                     * Compiles the equation if it has changed, and returns any compile error message that was thrown.
                     */

                }, {
                    key: "validateEquation",
                    value: function validateEquation() {
                        if (this._cacheTriggerCount == this.triggerCounter) return this._compileError;
                        this._cacheTriggerCount = this.triggerCounter;
                        this._compileError = null;
                        try {
                            this.compiledEquation = JS.compile(this.equation.value, ['key', 'dataType'].concat(this.variables.getNames()));
                            this.d2d_key_dataType_value = new Dictionary2D(); // create a new cache
                        } catch (e) {
                            // if compiling fails
                            this.compiledEquation = function () {
                                return undefined;
                            };
                            this._compileError = e.message;
                        }
                        return this._compileError;
                    }
                    /**
                     * @return The result of the compiled equation evaluated at the given record key.
                     * @see weave.api.data.IAttributeColumn
                     */
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        // reset cached values if necessary
                        if (this._cacheTriggerCount != this.triggerCounter) this.validateEquation();
                        // if dataType not specified, use default type specified in metadata
                        if (dataType == null) dataType = Array;
                        // check the cache
                        var value = this.d2d_key_dataType_value.get(key, dataType);
                        // define cached value if missing
                        if (value === undefined) {
                            // prevent recursion caused by compiledEquation
                            this.d2d_key_dataType_value.set(key, dataType, EquationColumn_1.UNDEFINED);
                            // prepare EquationColumnLib static parameter before calling the compiled equation
                            var prevKey = EquationColumnLib.currentRecordKey;
                            EquationColumnLib.currentRecordKey = key;
                            try {
                                var args = this.variables.getObjects();
                                args.unshift(key, dataType);
                                value = this.compiledEquation.apply(this, args);
                                if (EquationColumn_1.debug) console.log(this, this.getMetadata(ColumnMetadata.TITLE), key.keyType, key.localName, dataType, value);
                            } catch (e) {
                                if (this._lastError != e.message) {
                                    this._lastError = e.message;
                                    console.error(e);
                                }
                            } finally {
                                EquationColumnLib.currentRecordKey = prevKey;
                            }
                            // save value in cache
                            if (value !== undefined) this.d2d_key_dataType_value.set(key, dataType, value);
                        } else if (value === EquationColumn_1.UNDEFINED) {
                            value = undefined;
                        } else if (EquationColumn_1.debug) console.log('>', this, this.getMetadata(ColumnMetadata.TITLE), key.keyType, key.localName, dataType, value);
                        if (dataType == IQualifiedKey) {
                            if (!Weave.IS(value, IQualifiedKey)) {
                                if (!Weave.IS(value, String)) value = StandardLib.asString(value);
                                value = WeaveAPI.QKeyManager.getQKey(this.getMetadata(ColumnMetadata.DATA_TYPE), value);
                            }
                        } else if (dataType != null) {
                            value = EquationColumnLib.cast(value, dataType);
                        }
                        return value;
                    }
                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(number) {
                        if (Weave.detectChange(this.deriveStringFromNumberObserver, this.metadata)) {
                            try {
                                this._numberToStringFunction = StandardLib.formatNumber;
                                var n2s = this.getMetadata(ColumnMetadata.STRING);
                                if (n2s) this._numberToStringFunction = JS.compile(n2s, ['number']);
                            } catch (e) {
                                this.errorHandler(e);
                            }
                        }
                        if (this._numberToStringFunction != null) {
                            try {
                                var string = this._numberToStringFunction.apply(this, arguments);
                                if (EquationColumn_1.debug) console.log(this, this.getMetadata(ColumnMetadata.TITLE), 'deriveStringFromNumber', number, string);
                                return string;
                            } catch (e) {
                                this.errorHandler(e);
                            }
                        }
                        return '';
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        // return all the keys of all columns in the variables list
                        if (this._allKeysTriggerCount != this.variables.triggerCounter) {
                            this._allKeys = null;
                            this.map_allKeys = new WeakMap();
                            this._allKeysTriggerCount = this.variables.triggerCounter; // prevent infinite recursion
                            var variableColumns = this.variables.getObjects(IKeySet);
                            this._allKeys = ArrayUtils.union.apply(ArrayUtils, ArrayUtils.pluck(variableColumns, 'keys'));
                            if (this.filterByKeyType.value && this._allKeys.length > 0) {
                                var keyType = this.getMetadata(ColumnMetadata.KEY_TYPE);
                                this._allKeys = this._allKeys.filter(function (key) {
                                    return key.keyType == keyType;
                                });
                            }
                            var _iteratorNormalCompletion94 = true;
                            var _didIteratorError94 = false;
                            var _iteratorError94 = undefined;

                            try {
                                for (var _iterator94 = (this._allKeys || [])[Symbol.iterator](), _step94; !(_iteratorNormalCompletion94 = (_step94 = _iterator94.next()).done); _iteratorNormalCompletion94 = true) {
                                    var key = _step94.value;

                                    this.map_allKeys.set(key, true);
                                }
                            } catch (err) {
                                _didIteratorError94 = true;
                                _iteratorError94 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion94 && _iterator94.return) {
                                        _iterator94.return();
                                    }
                                } finally {
                                    if (_didIteratorError94) {
                                        throw _iteratorError94;
                                    }
                                }
                            }
                        }
                        return this._allKeys || [];
                    }
                }]);

                return EquationColumn;
            }(column.AbstractAttributeColumn);
            EquationColumn.debug = false;
            /**
             * This is used as a placeholder in d2d_key_dataType_value.
             */
            EquationColumn.UNDEFINED = {};
            EquationColumn = EquationColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.EquationColumn", interfaces: [IAttributeColumn, IPrimitiveColumn, ICallbackCollection] })], EquationColumn);
            column.EquationColumn = EquationColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var AbstractAttributeColumn = weavejs.data.column.AbstractAttributeColumn;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * This column is defined by two columns of CSV data: keys and values.
             *
             * @author adufilie
             */
            var CSVColumn = function (_AbstractAttributeCol) {
                _inherits(CSVColumn, _AbstractAttributeCol);

                function CSVColumn() {
                    _classCallCheck(this, CSVColumn);

                    var _this159 = _possibleConstructorReturn(this, (CSVColumn.__proto__ || Object.getPrototypeOf(CSVColumn)).call(this));

                    _this159.title = Weave.linkableChild(_this159, LinkableString);
                    /**
                     * This should contain a two-column CSV with the first column containing the keys and the second column containing the values.
                     */
                    _this159.data = Weave.linkableChild(_this159, LinkableVariable, _this159.invalidate);
                    /**
                     * This is the key type of the first column in the csvData.
                     */
                    _this159.keyType = Weave.linkableChild(_this159, LinkableString, _this159.invalidate);
                    /**
                     * If this is set to true, the data will be parsed as numbers to produce the numeric data.
                     */
                    _this159.numericMode = Weave.linkableChild(_this159, LinkableBoolean, _this159.invalidate);
                    _this159.map_key_index = null; // This maps a key to a row index.
                    _this159._keys = []; // list of keys from the first CSV column
                    _this159._stringValues = []; // list of Strings from the first CSV column
                    _this159._numberValues = []; // list of Numbers from the first CSV column
                    /**
                     * This value is true when the data changed and the lookup tables need to be recreated.
                     */
                    _this159.dirty = true;
                    _this159.numericMode.value = false;
                    return _this159;
                }
                /* override */

                _createClass(CSVColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        switch (propertyName) {
                            case ColumnMetadata.TITLE:
                                return this.title.value;
                            case ColumnMetadata.KEY_TYPE:
                                return this.keyType.value;
                            case ColumnMetadata.DATA_TYPE:
                                return this.numericMode.value ? DataTypes.NUMBER : DataTypes.STRING;
                        }
                        return _get(CSVColumn.prototype.__proto__ || Object.getPrototypeOf(CSVColumn.prototype), "getMetadata", this).call(this, propertyName);
                    }
                    /**
                     * Use this function to set the keys and data of the column.
                     * @param table An Array of rows where each row is an Array containing a key and a data value.
                     */

                }, {
                    key: "setDataTable",
                    value: function setDataTable(table) {
                        var stringTable = [];
                        for (var r = 0; r < table.length; r++) {
                            var row = table[r].concat(); // make a copy of the row
                            // convert each value to a string
                            for (var c = 0; c < row.length; c++) {
                                row[c] = String(row[c]);
                            }stringTable[r] = row; // save the copied row
                        }
                        this.data.setSessionState(stringTable);
                    }
                    /**
                     * @deprecated
                     */

                }, {
                    key: "invalidate",

                    /**
                     * This function gets called when csvData changes.
                     */
                    value: function invalidate() {
                        this.dirty = true;
                    }
                    /**
                     * This function generates three Vectors from the CSV data: _keys, _stringValues, _numberValues
                     */

                }, {
                    key: "validate",
                    value: function validate() {
                        // replace the previous _keyToIndexMap with a new empty one
                        this.map_key_index = new Map();
                        this._keys.length = 0;
                        this._stringValues.length = 0;
                        this._numberValues.length = 0;
                        var key;
                        var value;
                        var table = Weave.AS(this.data.getSessionState(), Array) || [];
                        for (var i = 0; i < table.length; i++) {
                            var row = Weave.AS(table[i], Array);
                            if (row == null || row.length == 0) continue; // skip blank lines
                            // get the key from the first column and the value from the second.
                            key = WeaveAPI.QKeyManager.getQKey(this.keyType.value, String(row[0]));
                            value = String(row.length > 1 ? row[1] : '');
                            // save the results of parsing the CSV row
                            this.map_key_index.set(key, this._keys.length);
                            this._keys.push(key);
                            this._stringValues.push(value);
                            try {
                                this._numberValues.push(Number(value));
                            } catch (e) {
                                this._numberValues.push(NaN);
                            }
                        }
                        this.dirty = false;
                    }
                    /**
                     * This function returns the list of String values from the first column in the CSV data.
                     */
                    /* override */
                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    /* override */value: function containsKey(key) {
                        // refresh the data if necessary
                        if (this.dirty) this.validate();
                        return this.map_key_index.has(key);
                    }
                    /**
                     * This function returns the corresponding numeric or string value depending on the dataType parameter and the numericMode setting.
                     */
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        // refresh the data if necessary
                        if (this.dirty) this.validate();
                        // get the index from the key
                        var keyIndex = this.map_key_index.get(key);
                        // cast to different data types
                        if (dataType == Boolean) {
                            return !isNaN(keyIndex);
                        }
                        if (dataType == Number) {
                            if (isNaN(keyIndex)) return NaN;
                            return this._numberValues[keyIndex];
                        }
                        if (dataType == String) {
                            if (isNaN(keyIndex)) return '';
                            return this._stringValues[keyIndex];
                        }
                        // return default data type
                        if (isNaN(keyIndex)) return this.numericMode.value ? NaN : '';
                        if (this.numericMode.value) return this._numberValues[keyIndex];
                        return this._stringValues[keyIndex];
                    }
                }, {
                    key: "csvData",
                    set: function set(value) {
                        this.data.setSessionState(WeaveAPI.CSVParser.parseCSV(value));
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        // refresh the data if necessary
                        if (this.dirty) this.validate();
                        return this._keys;
                    }
                }]);

                return CSVColumn;
            }(AbstractAttributeColumn);
            CSVColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.CSVColumn", interfaces: [ICallbackCollection, IAttributeColumn] })], CSVColumn);
            column.CSVColumn = CSVColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var hierarchy;
        (function (hierarchy) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IDataSource = weavejs.api.data.IDataSource;
            var CSVColumn = weavejs.data.column.CSVColumn;
            var EquationColumn = weavejs.data.column.EquationColumn;
            var GlobalColumnDataSource_1 = void 0;
            var GlobalColumnDataSource = GlobalColumnDataSource_1 = function () {
                function GlobalColumnDataSource(root) {
                    var _this160 = this;

                    _classCallCheck(this, GlobalColumnDataSource);

                    this._root = root;
                    Weave.linkableChild(this, root.childListCallbacks);
                    var source = this;
                    this._rootNode = new hierarchy.ColumnTreeNode({
                        dataSource: source,
                        label: function label() {
                            return _this160.getLabel();
                        },
                        hasChildBranches: false,
                        children: function children() {
                            return _this160.getGlobalColumns().map(function (column) {
                                Weave.linkableChild(source, column);
                                return _this160.createColumnNode(root.getName(column));
                            });
                        }
                    });
                }

                _createClass(GlobalColumnDataSource, [{
                    key: "getLabel",
                    value: function getLabel() {
                        return this._root.getObjects(CSVColumn).length ? Weave.lang('Generated columns') : Weave.lang('Equations');
                    }
                }, {
                    key: "getGlobalColumns",
                    value: function getGlobalColumns() {
                        var csvColumns = this._root.getObjects(CSVColumn);
                        var equationColumns = this._root.getObjects(EquationColumn);
                        return equationColumns.concat(csvColumns);
                    }
                }, {
                    key: "createColumnNode",
                    value: function createColumnNode(name) {
                        var column = this.generateNewAttributeColumn(name);
                        if (!column) return null;
                        var meta = {};
                        meta.name = name;
                        return new hierarchy.ColumnTreeNode({
                            dataSource: this,
                            dependency: column,
                            label: function label() {
                                return column.getMetadata(ColumnMetadata.TITLE);
                            },
                            data: meta,
                            idFields: [GlobalColumnDataSource_1.NAME]
                        });
                    }
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        return this._rootNode;
                    }
                }, {
                    key: "findHierarchyNode",
                    value: function findHierarchyNode(metadata) {
                        var column = this.generateNewAttributeColumn(metadata);
                        if (!column) return null;
                        var name = this._root.getName(column);
                        var node = this.createColumnNode(name);
                        var path = this._rootNode.findPathToNode(node);
                        if (path) return path[path.length - 1];
                        return null;
                    }
                }, {
                    key: "generateNewAttributeColumn",
                    value: function generateNewAttributeColumn(metadata) {
                        if (!metadata) return null;
                        var name;
                        if ((typeof metadata === "undefined" ? "undefined" : _typeof(metadata)) == 'object') name = metadata.name;else name = Weave.AS(metadata, String);
                        return Weave.AS(this._root.getObject(name), IAttributeColumn);
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return true;
                    }
                }, {
                    key: "hierarchyRefresh",
                    get: function get() {
                        return Weave.getCallbacks(this);
                    }
                }], [{
                    key: "getInstance",
                    value: function getInstance(root) {
                        var instance = GlobalColumnDataSource_1.map_root_instance.get(root);
                        if (!instance) GlobalColumnDataSource_1.map_root_instance.set(root, instance = new GlobalColumnDataSource_1(root));
                        return instance;
                    }
                }]);

                return GlobalColumnDataSource;
            }();
            GlobalColumnDataSource.map_root_instance = new Map();
            /**
             * The metadata property name used to identify a column appearing in root.
             */
            GlobalColumnDataSource.NAME = 'name';
            GlobalColumnDataSource = GlobalColumnDataSource_1 = __decorate([Weave.classInfo({ id: "weavejs.data.hierarchy", interfaces: [IDataSource] })], GlobalColumnDataSource);
            hierarchy.GlobalColumnDataSource = GlobalColumnDataSource;
        })(hierarchy = data.hierarchy || (data.hierarchy = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var IDataSource = weavejs.api.data.IDataSource;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var LinkableWatcher = weavejs.core.LinkableWatcher;
            var GlobalColumnDataSource = weavejs.data.hierarchy.GlobalColumnDataSource;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * This provides a wrapper for a referenced column.
             *
             * @author adufilie
             */
            var ReferencedColumn = function (_CallbackCollection5) {
                _inherits(ReferencedColumn, _CallbackCollection5);

                function ReferencedColumn() {
                    _classCallCheck(this, ReferencedColumn);

                    var _this161 = _possibleConstructorReturn(this, (ReferencedColumn.__proto__ || Object.getPrototypeOf(ReferencedColumn)).call(this));

                    _this161._initialized = false;
                    /**
                     * This is the name of an IDataSource in the top level session state.
                     */
                    _this161.dataSourceName = Weave.linkableChild(_this161, LinkableString, _this161.updateDataSource);
                    /**
                     * This holds the metadata used to identify a column.
                     */
                    _this161.metadata = Weave.linkableChild(_this161, LinkableVariable);
                    /**
                     * The trigger counter value at the last time the internal column was retrieved.
                     */
                    _this161._prevTriggerCounter = 0;
                    /**
                     * the internal referenced column
                     */
                    _this161._internalColumn = null;
                    _this161._columnWatcher = Weave.linkableChild(_this161, LinkableWatcher);
                    return _this161;
                }

                _createClass(ReferencedColumn, [{
                    key: "updateDataSource",
                    value: function updateDataSource() {
                        var root = Weave.getRoot(this);
                        if (!root) return;
                        if (!this._initialized) {
                            root.childListCallbacks.addImmediateCallback(this, this.updateDataSource);
                            this._initialized = true;
                        }
                        var ds = Weave.AS(root.getObject(this.dataSourceName.value), IDataSource);
                        if (!ds) ds = GlobalColumnDataSource.getInstance(root);
                        if (this._dataSource != ds) {
                            this._dataSource = ds;
                            this.triggerCallbacks();
                        }
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        return this._dataSource;
                    }
                }, {
                    key: "getHierarchyNode",
                    value: function getHierarchyNode() {
                        if (!this._dataSource) return null;
                        var meta = this.metadata.getSessionState();
                        return this._dataSource.findHierarchyNode(meta);
                    }
                    /**
                     * Updates the session state to refer to a new column.
                     */

                }, {
                    key: "setColumnReference",
                    value: function setColumnReference(dataSource, metadata) {
                        this.delayCallbacks();
                        var root = Weave.getRoot(this);
                        if (!root) throw new Error("ReferencedColumn is not registered with an instance of Weave");
                        this.dataSourceName.value = root.getName(dataSource);
                        this.metadata.setSessionState(metadata);
                        this.resumeCallbacks();
                    }
                }, {
                    key: "getInternalColumn",
                    value: function getInternalColumn() {
                        if (this._prevTriggerCounter != this.triggerCounter) {
                            if (Weave.wasDisposed(this._dataSource)) this._dataSource = null;
                            this._columnWatcher.target = this._internalColumn = WeaveAPI.AttributeColumnCache.getColumn(this._dataSource, this.metadata.state);
                            this._prevTriggerCounter = this.triggerCounter;
                        }
                        return this._internalColumn;
                    }
                    /************************************
                     * Begin IAttributeColumn interface
                     ************************************/

                }, {
                    key: "getMetadata",
                    value: function getMetadata(attributeName) {
                        if (this._prevTriggerCounter != this.triggerCounter) this.getInternalColumn();
                        return this._internalColumn ? this._internalColumn.getMetadata(attributeName) : null;
                    }
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        if (this._prevTriggerCounter != this.triggerCounter) this.getInternalColumn();
                        return this._internalColumn ? this._internalColumn.getMetadataPropertyNames() : [];
                    }
                    /**
                     * @return the keys associated with this column.
                     */

                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    value: function containsKey(key) {
                        if (this._prevTriggerCounter != this.triggerCounter) this.getInternalColumn();
                        return this._internalColumn && this._internalColumn.containsKey(key);
                    }
                    /**
                     * getValueFromKey
                     * @param key A key of the type specified by keyType.
                     * @return The value associated with the given key.
                     */

                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (this._prevTriggerCounter != this.triggerCounter) this.getInternalColumn();
                        return this._internalColumn ? this._internalColumn.getValueFromKey(key, dataType) : undefined;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        if (this._prevTriggerCounter != this.triggerCounter) this.getInternalColumn();
                        return this._internalColumn ? this._internalColumn.keys : [];
                    }
                }], [{
                    key: "generateReferencedColumnStateFromColumnReference",
                    value: function generateReferencedColumnStateFromColumnReference(ref) {
                        var dataSource = ref.getDataSource();
                        var root = Weave.getRoot(dataSource);
                        var name = root ? root.getName(dataSource) : null;
                        return {
                            dataSourceName: name,
                            metadata: ref.getColumnMetadata()
                        };
                    }
                }]);

                return ReferencedColumn;
            }(CallbackCollection);
            ReferencedColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.ReferencedColumn", interfaces: [IColumnWrapper, IAttributeColumn, ICallbackCollection] })], ReferencedColumn);
            column.ReferencedColumn = ReferencedColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var WeaveAPI = weavejs.WeaveAPI;
        var DynamicState = weavejs.api.core.DynamicState;
        var ILinkableHashMap = weavejs.api.core.ILinkableHashMap;
        var ColumnMetadata = weavejs.api.data.ColumnMetadata;
        var DataTypes = weavejs.api.data.DataTypes;
        var IAttributeColumn = weavejs.api.data.IAttributeColumn;
        var IColumnReference = weavejs.api.data.IColumnReference;
        var IColumnWrapper = weavejs.api.data.IColumnWrapper;
        var IDataSource = weavejs.api.data.IDataSource;
        var IKeyFilter = weavejs.api.data.IKeyFilter;
        var IKeySet = weavejs.api.data.IKeySet;
        var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
        var IQualifiedKey = weavejs.api.data.IQualifiedKey;
        var DynamicColumn = weavejs.data.column.DynamicColumn;
        var ExtendedDynamicColumn = weavejs.data.column.ExtendedDynamicColumn;
        var ReferencedColumn = weavejs.data.column.ReferencedColumn;
        var SecondaryKeyNumColumn = weavejs.data.column.SecondaryKeyNumColumn;
        var ColumnTreeNode = weavejs.data.hierarchy.ColumnTreeNode;
        var HierarchyUtils = weavejs.data.hierarchy.HierarchyUtils;
        var GeoJSON = weavejs.geom.GeoJSON;
        var Point = weavejs.geom.Point;
        var ArrayUtils = weavejs.util.ArrayUtils;
        var JS = weavejs.util.JS;
        var StandardLib = weavejs.util.StandardLib;
        /**
         * This class contains static functions that access values from IAttributeColumn objects.
         *
         * @author adufilie
         */

        var ColumnUtils = function () {
            function ColumnUtils() {
                _classCallCheck(this, ColumnUtils);
            }

            _createClass(ColumnUtils, null, [{
                key: "getTitle",

                /**
                 * This is a shortcut for column.getMetadata(ColumnMetadata.TITLE).
                 * @param column A column to get the title of.
                 * @return The title of the column.
                 */
                value: function getTitle(column) {
                    var title = column.getMetadata(ColumnMetadata.TITLE) || Weave.lang("(Data unavailable)");
                    if (ColumnUtils.debugKeyTypes) {
                        var keyType = column.getMetadata(ColumnMetadata.KEY_TYPE);
                        if (keyType) title += " (Key type: " + keyType + ")";else title += " (No key type)";
                    }
                    return title;
                }
                /**
                 * Generates a label to use when displaying the column in a list.
                 * @param column
                 * @return The column title followed by its dataType and/or keyType metadata.
                 */

            }, {
                key: "getColumnListLabel",
                value: function getColumnListLabel(column) {
                    var title = ColumnUtils.getTitle(column);
                    var keyType = ColumnUtils.getKeyType(column);
                    var dataType = ColumnUtils.getDataType(column);
                    var projection = column.getMetadata(ColumnMetadata.PROJECTION);
                    var dateFormat = column.getMetadata(ColumnMetadata.DATE_FORMAT);
                    if (dataType == DataTypes.DATE && dateFormat) dataType = dataType + '; ' + dateFormat;
                    if (dataType == DataTypes.GEOMETRY && projection) dataType = dataType + '; ' + projection;
                    if (dataType && keyType) return StandardLib.substitute("{0} ({1} -> {2})", title, keyType, dataType);
                    if (keyType) return StandardLib.substitute("{0} (Key Type: {1})", title, keyType);
                    if (dataType) return StandardLib.substitute("{0} (Data Type: {1})", title, dataType);
                    return title;
                }
                /**
                 * Temporary solution
                 * @param column
                 * @return
                 */

            }, {
                key: "getDataSources",
                value: function getDataSources(column) {
                    var sources = [];
                    var name;
                    var nameMap = {};
                    var cols;
                    if (Weave.IS(column, ReferencedColumn)) cols = [column];else cols = Weave.getDescendants(column, ReferencedColumn);
                    for (var i = 0; i < cols.length; i++) {
                        sources.push(Weave.AS(cols[i], ReferencedColumn).getDataSource());
                    }return ArrayUtils.union(sources);
                }
                /**
                 * This function gets the keyType of a column, either from the metadata or from the actual keys.
                 * @param column A column to get the keyType of.
                 * @return The keyType of the column.
                 */

            }, {
                key: "getKeyType",
                value: function getKeyType(column) {
                    // first try getting the keyType from the metadata.
                    var keyType = column.getMetadata(ColumnMetadata.KEY_TYPE);
                    if (keyType == null) {
                        // if metadata does not specify keyType, get it from the first key in the list of keys.
                        var keys = column.keys;
                        if (keys.length > 0) keyType = Weave.AS(keys[0], IQualifiedKey).keyType;
                    }
                    return keyType;
                }
                /**
                 * This function gets the dataType of a column from its metadata.
                 * @param column A column to get the dataType of.
                 * @return The dataType of the column.
                 */

            }, {
                key: "getDataType",
                value: function getDataType(column) {
                    return column.getMetadata(ColumnMetadata.DATA_TYPE);
                }
                /**
                 * This function will use an attribute column to convert a number to a string.
                 * @param column A column that may have a way to convert numeric values to string values.
                 * @param number A Number to convert to a String.
                 * @return A String representation of the number, or null if no specific string representation exists.
                 */

            }, {
                key: "deriveStringFromNumber",
                value: function deriveStringFromNumber(column, number) {
                    var pc = Weave.AS(ColumnUtils.hack_findNonWrapperColumn(column), IPrimitiveColumn);
                    if (pc) return pc.deriveStringFromNumber(number);
                    return null; // no specific string representation
                }
            }, {
                key: "hack_findNonWrapperColumn",
                value: function hack_findNonWrapperColumn(column) {
                    // try to find an internal IPrimitiveColumn
                    while (Weave.IS(column, IColumnWrapper)) {
                        column = Weave.AS(column, IColumnWrapper).getInternalColumn();
                    }return column;
                }
            }, {
                key: "hack_findInternalDynamicColumn",
                value: function hack_findInternalDynamicColumn(columnWrapper) {
                    columnWrapper = Weave.AS(columnWrapper, IColumnWrapper);
                    if (columnWrapper) {
                        // temporary solution - find internal dynamic column
                        while (true) {
                            if (Weave.IS(columnWrapper.getInternalColumn(), DynamicColumn)) columnWrapper = Weave.AS(columnWrapper.getInternalColumn(), IColumnWrapper);else if (Weave.IS(columnWrapper.getInternalColumn(), ExtendedDynamicColumn)) columnWrapper = Weave.AS(columnWrapper.getInternalColumn(), ExtendedDynamicColumn).internalDynamicColumn;else break;
                        }
                        if (Weave.IS(columnWrapper, ExtendedDynamicColumn)) columnWrapper = Weave.AS(columnWrapper, ExtendedDynamicColumn).internalDynamicColumn;
                    }
                    return Weave.AS(columnWrapper, DynamicColumn);
                }
            }, {
                key: "hack_findHierarchyNode",
                value: function hack_findHierarchyNode(column) {
                    var createFakeNodeIfNotFound = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                    var rc = Weave.AS(column, ReferencedColumn);
                    var dc = null;
                    if (!rc) {
                        dc = ColumnUtils.hack_findInternalDynamicColumn(Weave.AS(column, IColumnWrapper));
                        rc = dc ? Weave.AS(dc.target, ReferencedColumn) : null;
                    }
                    var node = rc ? rc.getHierarchyNode() : null;
                    if (!node && createFakeNodeIfNotFound) {
                        if (rc) node = new ColumnTreeNode({
                            dataSource: rc.getDataSource(),
                            data: rc.metadata.state
                        });else if (column && (!dc || dc.getInternalColumn())) node = new ColumnTreeNode({
                            dataSource: null,
                            data: ColumnMetadata.getAllMetadata(column)
                        });
                    }
                    return node;
                }
                /**
                 * Gets an array of QKey objects from <code>column</code> which meet the criteria
                 * <code>min &lt;= getNumber(column, key) &lt;= max</code>, where key is a <code>QKey</code>
                 * in <code>column</code>.
                 * @param min The minimum value for the keys
                 * @param max The maximum value for the keys
                 * @param inclusiveRange A boolean specifying whether the range includes the min and max values.
                 * Default value is <code>true</code>.
                 * @return An array QKey objects.
                 */

            }, {
                key: "getQKeysInNumericRange",
                value: function getQKeysInNumericRange(column, min, max) {
                    var inclusiveRange = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;

                    var result = [];
                    var keys = column.keys;
                    var _iteratorNormalCompletion95 = true;
                    var _didIteratorError95 = false;
                    var _iteratorError95 = undefined;

                    try {
                        for (var _iterator95 = (keys || [])[Symbol.iterator](), _step95; !(_iteratorNormalCompletion95 = (_step95 = _iterator95.next()).done); _iteratorNormalCompletion95 = true) {
                            var qkey = _step95.value;

                            var number = column.getValueFromKey(qkey, Number);
                            var isInRange = false;
                            if (inclusiveRange) isInRange = min <= number && number <= max;else isInRange = min < number && number < max;
                            if (isInRange) result.push(qkey);
                        }
                    } catch (err) {
                        _didIteratorError95 = true;
                        _iteratorError95 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion95 && _iterator95.return) {
                                _iterator95.return();
                            }
                        } finally {
                            if (_didIteratorError95) {
                                throw _iteratorError95;
                            }
                        }
                    }

                    return result;
                }
                /**
                 * @deprecated replacement=WeaveAPI.QKeyManager.convertToQKeys()
                 */

            }, {
                key: "getQKeys",
                value: function getQKeys(genericObjects) {
                    return WeaveAPI.QKeyManager.convertToQKeys(genericObjects);
                }
                /**
                 * Get the QKey corresponding to <code>object.keyType</code>
                 * and <code>object.localName</code>.
                 *
                 * @param object An object with properties <code>keyType</code>
                 * and <code>localName</code>.
                 * @return An IQualifiedKey object.
                 */

            }, {
                key: "getQKey",
                value: function getQKey(object) {
                    if (Weave.IS(object, IQualifiedKey)) return Weave.AS(object, IQualifiedKey);
                    return WeaveAPI.QKeyManager.getQKey(object.keyType, object.localName);
                }
                /**
                 * @param column A column to get a value from.
                 * @param key A key in the given column to get the value for.
                 * @return The Number corresponding to the given key.
                 */

            }, {
                key: "getNumber",
                value: function getNumber(column, key) {
                    var qkey = ColumnUtils.getQKey(key);
                    if (column != null) return column.getValueFromKey(qkey, Number);
                    return NaN;
                }
                /**
                 * @param column A column to get a value from.
                 * @param key A key in the given column to get the value for.
                 * @return The String corresponding to the given key.
                 */

            }, {
                key: "getString",
                value: function getString(column, key) {
                    var qkey = ColumnUtils.getQKey(key);
                    if (column != null) return column.getValueFromKey(qkey, String);
                    return '';
                }
                /**
                 * @param column A column to get a value from.
                 * @param key A key in the given column to get the value for.
                 * @return The Boolean corresponding to the given key.
                 */

            }, {
                key: "getBoolean",
                value: function getBoolean(column, key) {
                    var qkey = ColumnUtils.getQKey(key);
                    if (column != null) return StandardLib.asBoolean(column.getValueFromKey(qkey, Number));
                    return false;
                }
                /**
                 * @param column A column to get a value from.
                 * @param key A key in the given column to get the value for.
                 * @return The Number corresponding to the given key, normalized to be between 0 and 1.
                 *
                 * @deprecated replacement="WeaveAPI.StatisticsCache.getColumnStatistics(column).getNorm(key)")
                 */

            }, {
                key: "getNorm",
                value: function getNorm(column, key) {
                    var qkey = ColumnUtils.getQKey(key);
                    return WeaveAPI.StatisticsCache.getColumnStatistics(column).getNorm(qkey);
                }
                /**
                 * @param geometryColumn A GeometryColumn which contains the geometry objects for the key.
                 * @param key An object with <code>keyType</code> and <code>localName</code> properties.
                 * @return An array of arrays of arrays of Points.
                 * For example,
                 * <code>result[0]</code> is type <code>Array of Array of Point</code>. <br>
                 * <code>result[0][0]</code> is type <code>Array of Point</code> <br>
                 * <code>result[0][0][0]</code> is a <code>Point</code>
                 */

            }, {
                key: "getGeometry",
                value: function getGeometry(geometryColumn, key) {
                    var qkey = ColumnUtils.getQKey(key);
                    var genGeoms = Weave.AS(geometryColumn.getValueFromKey(qkey, Array), Array);
                    if (genGeoms == null) return null;
                    var result = [];
                    for (var iGenGeom; iGenGeom < genGeoms.length; ++iGenGeom) {
                        var genGeom = genGeoms[iGenGeom];
                        var simplifiedGeom = genGeom.getSimplifiedGeometry();
                        var newSimplifiedGeom = [];
                        for (var iSimplifiedGeom; iSimplifiedGeom < simplifiedGeom.length; ++iSimplifiedGeom) {
                            var nodeVector = simplifiedGeom[iSimplifiedGeom];
                            var newNodeVector = [];
                            for (var iNode = 0; iNode < nodeVector.length; ++iNode) {
                                var node = nodeVector[iNode];
                                var point = new Point(node.x, node.y);
                                newNodeVector.push(point);
                            }
                            newSimplifiedGeom.push(newNodeVector);
                        }
                        result.push(newSimplifiedGeom);
                    }
                    return result;
                }
                /**
                 * @param geometryColumn A column with metadata dataType="geometry"
                 * @param keys An Array of IQualifiedKeys
                 * @param minImportance No points with importance less than this value will be returned.
                 * @param visibleBounds If not null, this bounds will be used to remove unnecessary offscreen points.
                 * @return An Array of GeoJson Geometry objects corresponding to the keys.  The Array may be sparse if there are no coordinates for some of the keys.
                 */

            }, {
                key: "getGeoJsonGeometries",
                value: function getGeoJsonGeometries(geometryColumn, keys) {
                    var minImportance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
                    var visibleBounds = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    var map_inputGeomArray_outputMultiGeom = new WeakMap();
                    var output = new Array(keys.length);
                    var multiGeom;
                    for (var i = 0; i < keys.length; i++) {
                        var key = keys[i];
                        var inputGeomArray = Weave.AS(geometryColumn.getValueFromKey(key, Array), Array);
                        if (inputGeomArray) {
                            if (map_inputGeomArray_outputMultiGeom.has(inputGeomArray)) {
                                multiGeom = map_inputGeomArray_outputMultiGeom.get(inputGeomArray);
                            } else {
                                var outputGeomArray = [];
                                var _iteratorNormalCompletion96 = true;
                                var _didIteratorError96 = false;
                                var _iteratorError96 = undefined;

                                try {
                                    for (var _iterator96 = (inputGeomArray || [])[Symbol.iterator](), _step96; !(_iteratorNormalCompletion96 = (_step96 = _iterator96.next()).done); _iteratorNormalCompletion96 = true) {
                                        var inputGeom = _step96.value;

                                        var outputGeom = inputGeom.toGeoJson(minImportance, visibleBounds);
                                        if (outputGeom) outputGeomArray.push(outputGeom);
                                    }
                                } catch (err) {
                                    _didIteratorError96 = true;
                                    _iteratorError96 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion96 && _iterator96.return) {
                                            _iterator96.return();
                                        }
                                    } finally {
                                        if (_didIteratorError96) {
                                            throw _iteratorError96;
                                        }
                                    }
                                }

                                multiGeom = outputGeomArray.length ? GeoJSON.getMultiGeomObject(outputGeomArray) : null;
                                map_inputGeomArray_outputMultiGeom.set(inputGeomArray, multiGeom);
                            }
                            if (multiGeom) output[i] = multiGeom;
                        }
                    }
                    return output;
                }
            }, {
                key: "test_getAllValues",
                value: function test_getAllValues(column, dataType) {
                    var t = Date.now();
                    var keys = column.keys;
                    var values = new Array(keys.length);
                    for (var i in keys) {
                        values[i] = column.getValueFromKey(keys[i], dataType);
                    }console.log(Date.now() - t);
                    return values;
                }
                /**
                 * This function takes the common keys from a list of columns and generates a table of data values for each key from each specified column.
                 * @param columns A list of IAttributeColumns to compute a join table from.
                 * @param dataType The dataType parameter to pass to IAttributeColumn.getValueFromKey().
                 * @param allowMissingData If this is set to true, then all keys will be included in the join result.  Otherwise, only the keys that have associated values will be included.
                 * @param keyFilter Either an IKeyFilter or an Array of IQualifiedKey objects used to filter the results.
                 * @return An Array of Arrays, the first being IQualifiedKeys and the rest being Arrays data values from the given columns that correspond to the IQualifiedKeys.
                 */

            }, {
                key: "joinColumns",
                value: function joinColumns(columns) {
                    var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var allowMissingData = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
                    var keyFilter = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                    var keys;
                    var key;
                    var column;
                    // if no keys are specified, get the keys from the columns
                    if (Weave.IS(keyFilter, Array)) {
                        keys = Weave.AS(keyFilter, Array).concat(); // make a copy so we don't modify the original
                    } else if (Weave.IS(keyFilter, IKeySet)) {
                        keys = Weave.AS(keyFilter, IKeySet).keys.concat(); // make a copy so we don't modify the original
                    } else {
                        // count the number of appearances of each key in each column
                        var map_key_count = new Map();
                        var _iteratorNormalCompletion97 = true;
                        var _didIteratorError97 = false;
                        var _iteratorError97 = undefined;

                        try {
                            for (var _iterator97 = (columns || [])[Symbol.iterator](), _step97; !(_iteratorNormalCompletion97 = (_step97 = _iterator97.next()).done); _iteratorNormalCompletion97 = true) {
                                column = _step97.value;

                                var columnKeys = column ? column.keys : null;
                                var _iteratorNormalCompletion99 = true;
                                var _didIteratorError99 = false;
                                var _iteratorError99 = undefined;

                                try {
                                    for (var _iterator99 = (columnKeys || [])[Symbol.iterator](), _step99; !(_iteratorNormalCompletion99 = (_step99 = _iterator99.next()).done); _iteratorNormalCompletion99 = true) {
                                        key = _step99.value;

                                        map_key_count.set(key, (map_key_count.get(key) | 0) + 1);
                                    }
                                } catch (err) {
                                    _didIteratorError99 = true;
                                    _iteratorError99 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion99 && _iterator99.return) {
                                            _iterator99.return();
                                        }
                                    } finally {
                                        if (_didIteratorError99) {
                                            throw _iteratorError99;
                                        }
                                    }
                                }
                            }
                            // get a list of keys
                        } catch (err) {
                            _didIteratorError97 = true;
                            _iteratorError97 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion97 && _iterator97.return) {
                                    _iterator97.return();
                                }
                            } finally {
                                if (_didIteratorError97) {
                                    throw _iteratorError97;
                                }
                            }
                        }

                        keys = [];
                        var filter = Weave.AS(keyFilter, IKeyFilter);
                        var _iteratorNormalCompletion98 = true;
                        var _didIteratorError98 = false;
                        var _iteratorError98 = undefined;

                        try {
                            for (var _iterator98 = map_key_count[Symbol.iterator](), _step98; !(_iteratorNormalCompletion98 = (_step98 = _iterator98.next()).done); _iteratorNormalCompletion98 = true) {
                                var _step98$value = _slicedToArray(_step98.value, 2),
                                    qkey = _step98$value[0],
                                    count = _step98$value[1];

                                if (allowMissingData || count == columns.length) if (!filter || filter.containsKey(qkey)) keys.push(qkey);
                            }
                        } catch (err) {
                            _didIteratorError98 = true;
                            _iteratorError98 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion98 && _iterator98.return) {
                                    _iterator98.return();
                                }
                            } finally {
                                if (_didIteratorError98) {
                                    throw _iteratorError98;
                                }
                            }
                        }
                    }
                    if (Weave.IS(dataType, String)) dataType = DataTypes.getClass(Weave.AS(dataType, String));
                    // put the keys in the result
                    var result = [keys];
                    // get all the data values in the same order as the common keys
                    for (var cIndex = 0; cIndex < columns.length; cIndex++) {
                        column = columns[cIndex];
                        var dt = JS.asClass(dataType);
                        if (!dt && column) dt = DataTypes.getClass(column.getMetadata(ColumnMetadata.DATA_TYPE));
                        var values = [];
                        for (var kIndex = 0; kIndex < keys.length; kIndex++) {
                            var value = column ? column.getValueFromKey(keys[kIndex], dt) : undefined;
                            var isUndef = StandardLib.isUndefined(value);
                            if (!allowMissingData && isUndef) {
                                // value is undefined, so remove this key and all associated data from the list
                                var _iteratorNormalCompletion100 = true;
                                var _didIteratorError100 = false;
                                var _iteratorError100 = undefined;

                                try {
                                    for (var _iterator100 = result[Symbol.iterator](), _step100; !(_iteratorNormalCompletion100 = (_step100 = _iterator100.next()).done); _iteratorNormalCompletion100 = true) {
                                        var array = _step100.value;

                                        array.splice(kIndex, 1);
                                    }
                                } catch (err) {
                                    _didIteratorError100 = true;
                                    _iteratorError100 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion100 && _iterator100.return) {
                                            _iterator100.return();
                                        }
                                    } finally {
                                        if (_didIteratorError100) {
                                            throw _iteratorError100;
                                        }
                                    }
                                }

                                kIndex--; // avoid skipping the next key
                            } else if (isUndef) values.push(undefined);else values.push(value);
                        }
                        result.push(values);
                    }
                    return result;
                }
                /**
                 * Generates records using a custom format.
                 * @param format An object mapping names to IAttributeColumn objects or constant values to be included in every record.
                 *               You can nest Objects or Arrays.
                 *               If you want each record to include its corresponding key, include a property with a value equal to weavejs.api.data.IQualifiedKey.
                 * @param keys An Array of IQualifiedKeys
                 * @param dataType A Class specifying the dataType to retrieve from columns: String/Number/Date/Array (default is Array)
                 *                 You can also specify different data types in a structure matching that of the format object.
                 * @param keyProperty The property name which should be used to store the IQualifiedKey for a record.
                 * @return An array of record objects matching the structure of the format object.
                 */

            }, {
                key: "getRecords",
                value: function getRecords(format) {
                    var keys = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var dataType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    if (!keys) keys = ColumnUtils.getAllKeys(ColumnUtils.getColumnsFromFormat(format, []));
                    var records = new Array(keys.length);
                    for (var i in keys) {
                        records[i] = ColumnUtils.getRecord(format, keys[i], dataType);
                    }return records;
                }
            }, {
                key: "getColumnsFromFormat",
                value: function getColumnsFromFormat(format, output) {
                    if (Weave.IS(format, IAttributeColumn)) output.push(format);else if (!JS.isPrimitive(format)) for (var key in format) {
                        ColumnUtils.getColumnsFromFormat(format[key], output);
                    }return output;
                }
                /**
                 * Generates a record using a custom format.
                 * @param format An object mapping names to IAttributeColumn objects or constant values to be included in every record.
                 *               You can nest Objects or Arrays.
                 *               If you want the record to include its corresponding key, include include a property with a value equal to weavejs.api.data.IQualifiedKey.
                 * @param key An IQualifiedKey
                 * @param dataType A Class specifying the dataType to retrieve from columns: String/Number/Date/Array (default is Array)
                 *                 You can also specify different data types in a structure matching that of the format object.
                 * @return A record object matching the structure of the format object.
                 */

            }, {
                key: "getRecord",
                value: function getRecord(format, key, dataType) {
                    if (format === IQualifiedKey) return key;
                    // check for primitive values
                    if (format === null || (typeof format === "undefined" ? "undefined" : _typeof(format)) !== 'object') return format;
                    var dataTypeClass = JS.asClass(dataType || Array);
                    var column = Weave.AS(format, IAttributeColumn);
                    if (column) {
                        var value = column.getValueFromKey(key, dataTypeClass);
                        if (value === undefined) value = null;
                        return value;
                    }
                    var record = Weave.IS(format, Array) ? [] : {};
                    for (var prop in format) {
                        record[prop] = ColumnUtils.getRecord(format[prop], key, dataTypeClass || dataType[prop]);
                    }return record;
                }
                /**
                 * @param attrCols An array of IAttributeColumns or ILinkableHashMaps containing IAttributeColumns.
                 * @return An Array of non-wrapper columns with duplicates removed.
                 */

            }, {
                key: "getNonWrapperColumnsFromSelectableAttributes",
                value: function getNonWrapperColumnsFromSelectableAttributes(attrCols) {
                    var map_column = new WeakMap();
                    attrCols = attrCols.map(function (item) {
                        return Weave.IS(item, ILinkableHashMap) ? item.getObjects(IAttributeColumn) : Weave.AS(item, IAttributeColumn);
                    });
                    attrCols = ArrayUtils.flatten(attrCols);
                    attrCols = attrCols.map(function (column) {
                        return ColumnUtils.hack_findNonWrapperColumn(column);
                    }).filter(function (column) {
                        if (!column || map_column.get(column)) return false;
                        map_column.set(column, true);
                        return true;
                    });
                    return attrCols;
                }
                /**
                 * This function takes an array of attribute columns, a set of keys, and the type of the columns
                 * @param attrCols An array of IAttributeColumns or ILinkableHashMaps containing IAttributeColumns.
                 * @param subset An IKeyFilter or IKeySet specifying which keys to include in the CSV output, or null to indicate all keys available in the Attributes.
                 * @param dataType
                 * @return A string containing a CSV-formatted table containing the attributes of the requested keys.
                 */

            }, {
                key: "generateTableCSV",
                value: function generateTableCSV(attrCols) {
                    var subset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                    var dataType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                    SecondaryKeyNumColumn.allKeysHack = true; // dimension slider hack
                    var records = [];
                    attrCols = ColumnUtils.getNonWrapperColumnsFromSelectableAttributes(attrCols);
                    var columnTitles = attrCols.map(function (column) {
                        return ColumnUtils.getTitle(column);
                    });
                    var keys;
                    if (!subset) keys = ColumnUtils.getAllKeys(attrCols);else keys = ColumnUtils.getAllKeys(attrCols).filter(function (key) {
                        return subset.containsKey(key);
                    });
                    var keyTypeMap = {};
                    // create the data for each column in each selected row
                    var _iteratorNormalCompletion101 = true;
                    var _didIteratorError101 = false;
                    var _iteratorError101 = undefined;

                    try {
                        for (var _iterator101 = (keys || [])[Symbol.iterator](), _step101; !(_iteratorNormalCompletion101 = (_step101 = _iterator101.next()).done); _iteratorNormalCompletion101 = true) {
                            var key = _step101.value;

                            var record = {};
                            // each record has a property named after the keyType equal to the key value				
                            record[key.keyType] = key.localName;
                            keyTypeMap[key.keyType] = true;
                            for (var i = 0; i < attrCols.length; i++) {
                                var col = attrCols[i];
                                var dt = dataType || DataTypes.getClass(col.getMetadata(ColumnMetadata.DATA_TYPE));
                                var value = col.getValueFromKey(key, dt);
                                if (StandardLib.isDefined(value)) record[columnTitles[i]] = value;
                            }
                            records.push(record);
                        }
                        // update the list of headers before generating the table
                    } catch (err) {
                        _didIteratorError101 = true;
                        _iteratorError101 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion101 && _iterator101.return) {
                                _iterator101.return();
                            }
                        } finally {
                            if (_didIteratorError101) {
                                throw _iteratorError101;
                            }
                        }
                    }

                    for (var keyType in keyTypeMap) {
                        columnTitles.unshift(keyType);
                    }SecondaryKeyNumColumn.allKeysHack = false; // dimension slider hack
                    var rows = WeaveAPI.CSVParser.convertRecordsToRows(records, columnTitles);
                    return WeaveAPI.CSVParser.createCSV(rows);
                }
                /**
                 * This function will compute the union of a list of IKeySets.
                 * @param inputKeySets An Array of IKeySets (can be IAttributeColumns).
                 * @return The list of unique keys contained in all the inputKeySets.
                 */

            }, {
                key: "getAllKeys",
                value: function getAllKeys(inputKeySets) {
                    var map_key = new WeakMap();
                    var result = [];
                    for (var i = 0; i < inputKeySets.length; i++) {
                        var keys = Weave.AS(inputKeySets[i], IKeySet).keys;
                        for (var j = 0; j < keys.length; j++) {
                            var key = keys[j];
                            if (!map_key.has(key)) {
                                map_key.set(key, true);
                                result.push(key);
                            }
                        }
                    }
                    return result;
                }
                /**
                 * This function will make sure the first IAttributeColumn in a linkable hash map is a DynamicColumn.
                 */

            }, {
                key: "forceFirstColumnDynamic",
                value: function forceFirstColumnDynamic(columnHashMap) {
                    var cols = columnHashMap.getObjects(IAttributeColumn);
                    if (cols.length == 0) {
                        // just create a new dynamic column
                        columnHashMap.requestObject(null, DynamicColumn, false);
                    } else if (!Weave.IS(cols[0], DynamicColumn)) {
                        // don't run callbacks while we edit session state
                        Weave.getCallbacks(columnHashMap).delayCallbacks();
                        // remember the name order
                        var names = columnHashMap.getNames();
                        // remember the session state of the first column
                        var state = columnHashMap.getSessionState();
                        state.length = 1; // only keep first column
                        // overwrite existing column, reusing the same name
                        var newCol = columnHashMap.requestObject(names[0], DynamicColumn, false);
                        // copy the old col inside the new col
                        newCol.setSessionState(state, true);
                        // restore name order
                        columnHashMap.setNameOrder(names);
                        // done editing session state
                        Weave.getCallbacks(columnHashMap).resumeCallbacks();
                    }
                }
                /**
                 * Retrieves a metadata value from a list of columns if they all share the same value.
                 * @param columns The columns.
                 * @param propertyName The metadata property name.
                 * @return The metadata value if it is the same across all columns, or null if not.
                 */

            }, {
                key: "getCommonMetadata",
                value: function getCommonMetadata(columns, propertyName) {
                    var value;
                    for (var i = 0; i < columns.length; i++) {
                        var column = Weave.AS(columns[i], IAttributeColumn);
                        if (i == 0) value = column.getMetadata(propertyName);else if (value != column.getMetadata(propertyName)) return null;
                    }
                    return value;
                }
            }, {
                key: "getAllCommonMetadata",
                value: function getAllCommonMetadata(columns) {
                    var output = {};
                    if (!columns.length) return output;
                    // We only need to get property names from the first column
                    // because we only care about metadata common to all columns.
                    var _iteratorNormalCompletion102 = true;
                    var _didIteratorError102 = false;
                    var _iteratorError102 = undefined;

                    try {
                        for (var _iterator102 = columns[0].getMetadataPropertyNames()[Symbol.iterator](), _step102; !(_iteratorNormalCompletion102 = (_step102 = _iterator102.next()).done); _iteratorNormalCompletion102 = true) {
                            var key = _step102.value;

                            var value = ColumnUtils.getCommonMetadata(columns, key);
                            if (value) output[key] = value;
                        }
                    } catch (err) {
                        _didIteratorError102 = true;
                        _iteratorError102 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion102 && _iterator102.return) {
                                _iterator102.return();
                            }
                        } finally {
                            if (_didIteratorError102) {
                                throw _iteratorError102;
                            }
                        }
                    }

                    return output;
                }
            }, {
                key: "sortMetadataPropertyNames",
                value: function sortMetadataPropertyNames(names) {
                    StandardLib.sortOn(names, [ColumnUtils._preferredMetadataPropertyOrder.indexOf, names]);
                }
                /**
                 * Finds a set of columns from available data sources, preferring ones that are already in use.
                 */

            }, {
                key: "findFirstDataSet",
                value: function findFirstDataSet(root) {
                    var firstDataSet = ColumnUtils.map_root_firstDataSet.get(root);
                    if (firstDataSet && firstDataSet.length) return firstDataSet;
                    var ref;
                    var _iteratorNormalCompletion103 = true;
                    var _didIteratorError103 = false;
                    var _iteratorError103 = undefined;

                    try {
                        for (var _iterator103 = (Weave.getDescendants(root, ReferencedColumn) || [])[Symbol.iterator](), _step103; !(_iteratorNormalCompletion103 = (_step103 = _iterator103.next()).done); _iteratorNormalCompletion103 = true) {
                            var column = _step103.value;

                            ref = Weave.AS(column.getHierarchyNode(), IColumnReference);
                            if (ref) break;
                        }
                    } catch (err) {
                        _didIteratorError103 = true;
                        _iteratorError103 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion103 && _iterator103.return) {
                                _iterator103.return();
                            }
                        } finally {
                            if (_didIteratorError103) {
                                throw _iteratorError103;
                            }
                        }
                    }

                    if (!ref) {
                        var _iteratorNormalCompletion104 = true;
                        var _didIteratorError104 = false;
                        var _iteratorError104 = undefined;

                        try {
                            for (var _iterator104 = (Weave.getDescendants(root, IDataSource) || [])[Symbol.iterator](), _step104; !(_iteratorNormalCompletion104 = (_step104 = _iterator104.next()).done); _iteratorNormalCompletion104 = true) {
                                var source = _step104.value;

                                ref = ColumnUtils.findFirstColumnReference(source.getHierarchyRoot());
                                if (ref) break;
                            }
                        } catch (err) {
                            _didIteratorError104 = true;
                            _iteratorError104 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion104 && _iterator104.return) {
                                    _iterator104.return();
                                }
                            } finally {
                                if (_didIteratorError104) {
                                    throw _iteratorError104;
                                }
                            }
                        }
                    }
                    return ref ? HierarchyUtils.findSiblingNodes(ref.getDataSource(), ref.getColumnMetadata()) : [];
                }
            }, {
                key: "findFirstColumnReference",
                value: function findFirstColumnReference(node) {
                    if (!node) return null;
                    var ref = Weave.AS(node, IColumnReference);
                    if (ref && ref.getColumnMetadata()) return ref;
                    if (!node.isBranch()) return null;
                    var _iteratorNormalCompletion105 = true;
                    var _didIteratorError105 = false;
                    var _iteratorError105 = undefined;

                    try {
                        for (var _iterator105 = (node.getChildren() || [])[Symbol.iterator](), _step105; !(_iteratorNormalCompletion105 = (_step105 = _iterator105.next()).done); _iteratorNormalCompletion105 = true) {
                            var child = _step105.value;

                            ref = ColumnUtils.findFirstColumnReference(child);
                            if (ref) return ref;
                        }
                    } catch (err) {
                        _didIteratorError105 = true;
                        _iteratorError105 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion105 && _iterator105.return) {
                                _iterator105.return();
                            }
                        } finally {
                            if (_didIteratorError105) {
                                throw _iteratorError105;
                            }
                        }
                    }

                    return null;
                }
                /**
                 * This will initialize selectable attributes using a list of columns and/or column references.
                 * @param selectableAttributes An Array of IColumnWrapper and/or ILinkableHashMaps to initialize.
                 * @param input An Array of IAttributeColumn and/or IColumnReference objects. If not specified, getColumnsWithCommonKeyType() will be used.
                 * @see #getColumnsWithCommonKeyType()
                 */

            }, {
                key: "initSelectableAttributes",
                value: function initSelectableAttributes(selectableAttributes) {
                    var input = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    if (!input) input = ColumnUtils.getColumnsWithCommonKeyType(Weave.getRoot(selectableAttributes[0]));
                    for (var i = 0; i < selectableAttributes.length; i++) {
                        ColumnUtils.initSelectableAttribute(selectableAttributes[i], input[i % input.length]);
                    }
                }
                /**
                 * Gets a list of columns with a common keyType.
                 */

            }, {
                key: "getColumnsWithCommonKeyType",
                value: function getColumnsWithCommonKeyType(root) {
                    var keyType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    var columns = Weave.getDescendants(root, ReferencedColumn);
                    // if keyType not specified, find the most common keyType
                    if (!keyType) {
                        var keyTypeCounts = {};
                        var _iteratorNormalCompletion106 = true;
                        var _didIteratorError106 = false;
                        var _iteratorError106 = undefined;

                        try {
                            for (var _iterator106 = (columns || [])[Symbol.iterator](), _step106; !(_iteratorNormalCompletion106 = (_step106 = _iterator106.next()).done); _iteratorNormalCompletion106 = true) {
                                var column = _step106.value;

                                keyTypeCounts[ColumnUtils.getKeyType(column)] = int(keyTypeCounts[ColumnUtils.getKeyType(column)]) + 1;
                            }
                        } catch (err) {
                            _didIteratorError106 = true;
                            _iteratorError106 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion106 && _iterator106.return) {
                                    _iterator106.return();
                                }
                            } finally {
                                if (_didIteratorError106) {
                                    throw _iteratorError106;
                                }
                            }
                        }

                        var count = 0;
                        for (var kt in keyTypeCounts) {
                            if (keyTypeCounts[kt] > count) count = keyTypeCounts[keyType = kt];
                        }
                    }
                    // remove columns not of the selected key type
                    var n = 0;
                    for (var i = 0; i < columns.length; i++) {
                        if (ColumnUtils.getKeyType(columns[i]) == keyType) columns[n++] = columns[i];
                    }columns.length = n;
                    return columns;
                }
            }, {
                key: "replaceColumnsInHashMap",
                value: function replaceColumnsInHashMap(destination, columnReferences) {
                    var className = WeaveAPI.ClassRegistry.getClassName(ReferencedColumn);
                    var baseName = className.split('.').pop();
                    var names = destination.getNames();
                    var newState = [];
                    for (var iRef = 0; iRef < columnReferences.length; iRef++) {
                        var ref = Weave.AS(columnReferences[iRef], IColumnReference);
                        if (ref) {
                            var objectName = names[newState.length] || destination.generateUniqueName(baseName);
                            var sessionState = ReferencedColumn.generateReferencedColumnStateFromColumnReference(ref);
                            newState.push(DynamicState.create(objectName, className, sessionState));
                        }
                    }
                    destination.setSessionState(newState, true);
                }
                /**
                 * This will initialize one selectable attribute using a column or column reference.
                 * @param selectableAttribute A selectable attribute (IColumnWrapper/ILinkableHashMap/ReferencedColumn)
                 * @param column_or_columnReference Either an IAttributeColumn or an IColumnReference
                 * @param clearHashMap If the selectableAttribute is an ILinkableHashMap, all objects will be removed from it prior to adding a column.
                 */

            }, {
                key: "initSelectableAttribute",
                value: function initSelectableAttribute(selectableAttribute, column_or_columnReference) {
                    var clearHashMap = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

                    var inputCol = Weave.AS(column_or_columnReference, IAttributeColumn);
                    var inputRef = Weave.AS(column_or_columnReference, IColumnReference);
                    var outputRC = Weave.AS(selectableAttribute, ReferencedColumn);
                    if (outputRC) {
                        var inputRC;
                        if (inputCol) inputRC = Weave.AS(inputCol, ReferencedColumn) || Weave.AS(Weave.getDescendants(inputCol, ReferencedColumn)[0], ReferencedColumn);
                        if (inputRC) Weave.copyState(inputRC, outputRC);else if (inputRef) outputRC.setColumnReference(inputRef.getDataSource(), inputRef.getColumnMetadata());else outputRC.setColumnReference(null, null);
                    }
                    var foundGlobalColumn = false;
                    if (Weave.IS(selectableAttribute, DynamicColumn)) foundGlobalColumn = Weave.AS(selectableAttribute, DynamicColumn).targetPath != null;
                    if (Weave.IS(selectableAttribute, ExtendedDynamicColumn)) foundGlobalColumn = Weave.AS(selectableAttribute, ExtendedDynamicColumn).internalDynamicColumn.targetPath != null;
                    var outputDC = ColumnUtils.hack_findInternalDynamicColumn(Weave.AS(selectableAttribute, IColumnWrapper));
                    if (outputDC && (outputDC.getInternalColumn() == null || !foundGlobalColumn)) {
                        if (inputCol) {
                            if (Weave.IS(inputCol, DynamicColumn)) Weave.copyState(inputCol, outputDC);else outputDC.requestLocalObjectCopy(inputCol);
                        } else if (inputRef) outputDC.requestLocalObject(ReferencedColumn, false).setColumnReference(inputRef.getDataSource(), inputRef.getColumnMetadata());else outputDC.removeObject();
                    }
                    var outputHash = Weave.AS(selectableAttribute, ILinkableHashMap);
                    if (outputHash) {
                        if (clearHashMap) outputHash.removeAllObjects();
                        if (inputCol) outputHash.requestObjectCopy(null, inputCol);else if (inputRef) outputHash.requestObject(null, ReferencedColumn, false).setColumnReference(inputRef.getDataSource(), inputRef.getColumnMetadata());
                    }
                }
                //todo: (cached) get sorted index from a key and a column
                //todo: (cached) get bins from a column with a filter applied

            }, {
                key: "unlinkNestedColumns",
                value: function unlinkNestedColumns(columnWrapper) {
                    var col = columnWrapper;
                    while (col) {
                        var dc = Weave.AS(col, DynamicColumn);
                        var edc = Weave.AS(col, ExtendedDynamicColumn);
                        if (dc && dc.globalName) {
                            // unlink
                            dc.globalName = null;
                            // prevent infinite loop
                            if (dc.globalName) break;
                            // restart from selected
                            col = columnWrapper;
                        } else if (edc && edc.internalDynamicColumn.globalName) {
                            // unlink
                            edc.internalDynamicColumn.globalName = null;
                            // prevent infinite loop
                            if (edc.internalDynamicColumn.globalName) break;
                            // restart from selected
                            col = columnWrapper;
                        } else {
                            // get nested column
                            col = col.getInternalColumn();
                        }
                    }
                }
            }]);

            return ColumnUtils;
        }();

        ColumnUtils.debugKeyTypes = false;
        ColumnUtils._preferredMetadataPropertyOrder = 'title,keyType,dataType,number,string,min,max,year'.split(',');
        ColumnUtils.map_root_firstDataSet = new WeakMap();
        data.ColumnUtils = ColumnUtils;
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var key;
        (function (key_6) {
            var ILinkableObjectWithNewProperties = weavejs.api.core.ILinkableObjectWithNewProperties;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IKeyFilter = weavejs.api.data.IKeyFilter;
            var IObjectWithDescription = weavejs.api.ui.IObjectWithDescription;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var ColumnUtils = weavejs.data.ColumnUtils;
            var DynamicColumn = weavejs.data.column.DynamicColumn;
            var ColumnDataFilter_1 = void 0;
            var ColumnDataFilter = ColumnDataFilter_1 = function () {
                function ColumnDataFilter() {
                    _classCallCheck(this, ColumnDataFilter);

                    this.enabled = Weave.linkableChild(this, new LinkableBoolean(true), this._cacheVars);
                    this.includeMissingKeyTypes = Weave.linkableChild(this, new LinkableBoolean(true), this._cacheVars);
                    this.column = Weave.linkableChild(this, DynamicColumn, this._resetKeyLookup);
                    /**
                     * An Array of Numbers, Strings and/or Range objects specifying numeric ranges.
                     * A Range object contains two properties: "min" and "max".
                     * Alternatively, you can specify "minInclusive" or "minExclusive" in place of "min"
                     * and "minInclusive" or "maxExclusive" in place of "max".
                     */
                    this.values = Weave.linkableChild(this, new LinkableVariable(Array), this._resetKeyLookup);
                    this._stringLookup = new Map();
                    this._numberLookup = new Map();
                    this.map_key = new WeakMap();
                }

                _createClass(ColumnDataFilter, [{
                    key: "getDescription",
                    value: function getDescription() {
                        return Weave.lang("Filter for {0}", ColumnUtils.getTitle(this.column));
                    }
                    /* ??? */

                }, {
                    key: "_cacheVars",
                    value: function _cacheVars() {
                        this._enabled = this.enabled.value;
                        this._includeMissingKeyTypes = this.includeMissingKeyTypes.value;
                    }
                }, {
                    key: "_resetKeyLookup",
                    value: function _resetKeyLookup() {
                        var state = this.values.getSessionState() || [];
                        var range;
                        var regexp;
                        this._keyType = this.column.getMetadata(ColumnMetadata.KEY_TYPE);
                        this.map_key = new WeakMap();
                        this._numberLookup.clear();
                        this._stringLookup.clear();
                        this._ranges = null;
                        this._regexps = null;
                        var _iteratorNormalCompletion107 = true;
                        var _didIteratorError107 = false;
                        var _iteratorError107 = undefined;

                        try {
                            for (var _iterator107 = state[Symbol.iterator](), _step107; !(_iteratorNormalCompletion107 = (_step107 = _iterator107.next()).done); _iteratorNormalCompletion107 = true) {
                                var value = _step107.value;

                                if ((typeof value === "undefined" ? "undefined" : _typeof(value)) === _typeof(0)) {
                                    this._numberLookup.set(value, true);
                                } else if ((typeof value === "undefined" ? "undefined" : _typeof(value)) === _typeof("")) {
                                    this._stringLookup.set(value, true);
                                } else if (ColumnDataFilterRange.isRange(value)) {
                                    try {
                                        range = new ColumnDataFilterRange(value);
                                        if (!this._ranges) this._ranges = [];
                                        this._ranges.push(range);
                                    } catch (e) {}
                                } else if (ColumnDataFilter_1.isRegExp(value)) {
                                    if (!this._regexps) this._regexps = [];
                                    regexp = ColumnDataFilter_1.toRegExp(value);
                                    this._regexps.push(regexp);
                                }
                            }
                            // last step - canonicalize session states containing ranges
                        } catch (err) {
                            _didIteratorError107 = true;
                            _iteratorError107 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion107 && _iterator107.return) {
                                    _iterator107.return();
                                }
                            } finally {
                                if (_didIteratorError107) {
                                    throw _iteratorError107;
                                }
                            }
                        }

                        if (this._ranges || this._regexps) {
                            var newState = [];
                            var _iteratorNormalCompletion108 = true;
                            var _didIteratorError108 = false;
                            var _iteratorError108 = undefined;

                            try {
                                for (var _iterator108 = state[Symbol.iterator](), _step108; !(_iteratorNormalCompletion108 = (_step108 = _iterator108.next()).done); _iteratorNormalCompletion108 = true) {
                                    value = _step108.value;

                                    if ((typeof value === "undefined" ? "undefined" : _typeof(value)) === _typeof(0) || (typeof value === "undefined" ? "undefined" : _typeof(value)) === _typeof("")) newState.push(value);
                                }
                            } catch (err) {
                                _didIteratorError108 = true;
                                _iteratorError108 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion108 && _iterator108.return) {
                                        _iterator108.return();
                                    }
                                } finally {
                                    if (_didIteratorError108) {
                                        throw _iteratorError108;
                                    }
                                }
                            }

                            var _iteratorNormalCompletion109 = true;
                            var _didIteratorError109 = false;
                            var _iteratorError109 = undefined;

                            try {
                                for (var _iterator109 = (this._ranges || [])[Symbol.iterator](), _step109; !(_iteratorNormalCompletion109 = (_step109 = _iterator109.next()).done); _iteratorNormalCompletion109 = true) {
                                    range = _step109.value;

                                    newState.push(range.getState());
                                }
                            } catch (err) {
                                _didIteratorError109 = true;
                                _iteratorError109 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion109 && _iterator109.return) {
                                        _iterator109.return();
                                    }
                                } finally {
                                    if (_didIteratorError109) {
                                        throw _iteratorError109;
                                    }
                                }
                            }

                            var _iteratorNormalCompletion110 = true;
                            var _didIteratorError110 = false;
                            var _iteratorError110 = undefined;

                            try {
                                for (var _iterator110 = (this._regexps || [])[Symbol.iterator](), _step110; !(_iteratorNormalCompletion110 = (_step110 = _iterator110.next()).done); _iteratorNormalCompletion110 = true) {
                                    regexp = _step110.value;

                                    value = {
                                        regexp: regexp.source
                                    };
                                    newState.push(value);
                                }
                            } catch (err) {
                                _didIteratorError110 = true;
                                _iteratorError110 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion110 && _iterator110.return) {
                                        _iterator110.return();
                                    }
                                } finally {
                                    if (_didIteratorError110) {
                                        throw _iteratorError110;
                                    }
                                }
                            }

                            this.values.setSessionState(newState);
                        }
                    }
                }, {
                    key: "containsKey",
                    value: function containsKey(key) {
                        if (!this._enabled) return true;
                        var numberValue;
                        var stringValue;
                        var result = this.map_key.get(key);
                        if (result === undefined) {
                            result = false;
                            if (this._numberLookup.size || this._ranges) numberValue = this.column.getValueFromKey(key, Number);
                            if (this._stringLookup.size || this._regexps) stringValue = this.column.getValueFromKey(key, String);
                            result = this._numberLookup.get(numberValue) || this._stringLookup.get(stringValue) || this._includeMissingKeyTypes && key.keyType != this._keyType;
                            if (!result && this._ranges) {
                                var _iteratorNormalCompletion111 = true;
                                var _didIteratorError111 = false;
                                var _iteratorError111 = undefined;

                                try {
                                    for (var _iterator111 = this._ranges[Symbol.iterator](), _step111; !(_iteratorNormalCompletion111 = (_step111 = _iterator111.next()).done); _iteratorNormalCompletion111 = true) {
                                        var range = _step111.value;

                                        if (range.minInclusive ? numberValue < range.min : numberValue <= range.min) continue;
                                        if (range.maxInclusive ? numberValue > range.max : numberValue >= range.max) continue;
                                        result = true;
                                        break;
                                    }
                                } catch (err) {
                                    _didIteratorError111 = true;
                                    _iteratorError111 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion111 && _iterator111.return) {
                                            _iterator111.return();
                                        }
                                    } finally {
                                        if (_didIteratorError111) {
                                            throw _iteratorError111;
                                        }
                                    }
                                }
                            }
                            if (!result && this._regexps) {
                                var _iteratorNormalCompletion112 = true;
                                var _didIteratorError112 = false;
                                var _iteratorError112 = undefined;

                                try {
                                    for (var _iterator112 = this._regexps[Symbol.iterator](), _step112; !(_iteratorNormalCompletion112 = (_step112 = _iterator112.next()).done); _iteratorNormalCompletion112 = true) {
                                        var regexp = _step112.value;

                                        if (regexp.test(stringValue)) {
                                            result = true;
                                            break;
                                        }
                                    }
                                } catch (err) {
                                    _didIteratorError112 = true;
                                    _iteratorError112 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion112 && _iterator112.return) {
                                            _iterator112.return();
                                        }
                                    } finally {
                                        if (_didIteratorError112) {
                                            throw _iteratorError112;
                                        }
                                    }
                                }
                            }
                            this.map_key.set(key, result);
                        }
                        return result;
                    }
                }, {
                    key: "stringifyValues",
                    value: function stringifyValues() {
                        var result = this.values.getSessionState() || [];
                        return result.map(this.stringifyValue, this);
                    }
                }, {
                    key: "stringifyValue",
                    value: function stringifyValue(value) {
                        if ((typeof value === "undefined" ? "undefined" : _typeof(value)) === _typeof("")) {
                            return value;
                        } else if ((typeof value === "undefined" ? "undefined" : _typeof(value)) === _typeof(0)) {
                            return ColumnUtils.deriveStringFromNumber(this.column, value);
                        } else if (ColumnDataFilterRange.isRange(value)) {
                            var range = new ColumnDataFilterRange(value);
                            var leftBracket = range.minInclusive ? "[" : "(";
                            var rightBracket = range.maxInclusive ? "]" : ")";
                            return leftBracket + this.stringifyValue(range.min) + ", " + this.stringifyValue(range.max) + rightBracket;
                        } else if (ColumnDataFilter_1.isRegExp(value)) {
                            return ColumnDataFilter_1.toRegExp(value).toString();
                        }
                        return null;
                    }
                }, {
                    key: "handleMissingSessionStateProperties",
                    value: function handleMissingSessionStateProperties(newState) {
                        // handle deprecated StringDataFilter single-string value
                        var STRING_VALUE = 'stringValue';
                        if (newState.hasOwnProperty(STRING_VALUE)) this.values.setSessionState([newState[STRING_VALUE]]);
                        // handle deprecated StringDataFilter array of strings
                        var STRING_VALUES = 'stringValues';
                        if (newState.hasOwnProperty(STRING_VALUES)) this.values.setSessionState(newState[STRING_VALUES]);
                        // handle deprecated NumberDataFilter state
                        var _arr2 = ['min', 'max'];
                        for (var _i2 = 0; _i2 < _arr2.length; _i2++) {
                            var property = _arr2[_i2];
                            if (newState.hasOwnProperty(property)) {
                                if (!this._deprecatedRangeState) this._deprecatedRangeState = {};
                                this._deprecatedRangeState[property] = newState[property];
                                this.values.setSessionState([this._deprecatedRangeState]);
                            }
                        }
                    }
                }, {
                    key: "deprecatedStateMapping",
                    get: function get() {
                        return this.handleMissingSessionStateProperties;
                    }
                }], [{
                    key: "isRegExp",
                    value: function isRegExp(obj) {
                        return obj != null && (typeof obj === "undefined" ? "undefined" : _typeof(obj)) == 'object' && (obj.hasOwnProperty(ColumnDataFilter_1.REGEXP) || obj.hasOwnProperty(ColumnDataFilter_1.ALTERNATE_REGEX_PROPERTY));
                    }
                }, {
                    key: "toRegExp",
                    value: function toRegExp(value) {
                        return new RegExp(value.regexp || value.regex);
                    }
                }]);

                return ColumnDataFilter;
            }();
            ColumnDataFilter.REGEXP = 'regexp';
            ColumnDataFilter.ALTERNATE_REGEX_PROPERTY = 'regex';
            ColumnDataFilter = ColumnDataFilter_1 = __decorate([Weave.classInfo({ id: "weavejs.data.key.ColumnDataFilter", interfaces: [IKeyFilter, ILinkableObjectWithNewProperties, IObjectWithDescription] })], ColumnDataFilter);
            key_6.ColumnDataFilter = ColumnDataFilter;

            var ColumnDataFilterRange = function () {
                function ColumnDataFilterRange(obj) {
                    _classCallCheck(this, ColumnDataFilterRange);

                    this.min = -Infinity;
                    this.max = Infinity;
                    this.minInclusive = true;
                    this.maxInclusive = true;
                    this.min = Math.max(obj.min === undefined ? -Infinity : obj.min, obj.minInclusive === undefined ? -Infinity : obj.minInclusive, obj.minExclusive === undefined ? -Infinity : obj.minExclusive);
                    this.max = Math.min(obj.max === undefined ? Infinity : obj.max, obj.maxInclusive === undefined ? Infinity : obj.maxInclusive, obj.maxExclusive === undefined ? Infinity : obj.maxExclusive);
                    if (obj.minExclusive !== undefined) this.minInclusive = false;
                    if (obj.maxExclusive !== undefined) this.maxInclusive = false;
                }

                _createClass(ColumnDataFilterRange, [{
                    key: "getState",
                    value: function getState() {
                        var state = {};
                        if (this.minInclusive) state.min = this.min;else state.minExclusive = this.min;
                        if (this.maxInclusive) state.max = this.max;else state.maxExclusive = this.max;
                        return state;
                    }
                }], [{
                    key: "isRange",
                    value: function isRange(obj) {
                        if (!obj) return false;
                        var count = 0;
                        var prop;
                        var _arr3 = [ColumnDataFilterRange.MIN, ColumnDataFilterRange.MIN_INCLUSIVE, ColumnDataFilterRange.MIN_EXCLUSIVE];
                        for (var _i3 = 0; _i3 < _arr3.length; _i3++) {
                            prop = _arr3[_i3];

                            if (obj.hasOwnProperty(prop)) count++;
                        }if (!count) return false;
                        count = 0;
                        var _arr4 = [ColumnDataFilterRange.MAX, ColumnDataFilterRange.MAX_INCLUSIVE, ColumnDataFilterRange.MAX_EXCLUSIVE];
                        for (var _i4 = 0; _i4 < _arr4.length; _i4++) {
                            prop = _arr4[_i4];

                            if (obj.hasOwnProperty(prop)) count++;
                        }return count > 0;
                    }
                }]);

                return ColumnDataFilterRange;
            }();

            ColumnDataFilterRange.MIN = 'min';
            ColumnDataFilterRange.MIN_INCLUSIVE = 'minInclusive';
            ColumnDataFilterRange.MIN_EXCLUSIVE = 'minExclusive';
            ColumnDataFilterRange.MAX = 'max';
            ColumnDataFilterRange.MAX_INCLUSIVE = 'maxInclusive';
            ColumnDataFilterRange.MAX_EXCLUSIVE = 'maxExclusive';
        })(key = data.key || (data.key = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column_3) {
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IKeySet = weavejs.api.data.IKeySet;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            var ColumnUtils = weavejs.data.ColumnUtils;
            var KeySetUnion = weavejs.data.key.KeySetUnion;
            /**
             * This provides a wrapper for a dynamic column, and allows new properties to be added.
             * The purpose of this class is to provide a base for extending DynamicColumn.
             *
             * @author adufilie
             */
            var CombinedColumn = function (_CallbackCollection6) {
                _inherits(CombinedColumn, _CallbackCollection6);

                function CombinedColumn() {
                    _classCallCheck(this, CombinedColumn);

                    var _this162 = _possibleConstructorReturn(this, (CombinedColumn.__proto__ || Object.getPrototypeOf(CombinedColumn)).call(this));

                    _this162.useFirstColumnMetadata = Weave.linkableChild(_this162, new LinkableBoolean(true));
                    _this162.columns = Weave.linkableChild(_this162, new LinkableHashMap(IAttributeColumn));
                    _this162.keySetUnion = Weave.linkableChild(_this162, KeySetUnion);
                    _this162._columnsArray = [];
                    Weave.linkableChild(_this162, _this162.keySetUnion.busyStatus);
                    _this162.columns.childListCallbacks.addImmediateCallback(_this162, _this162.handleColumnsList);
                    return _this162;
                }

                _createClass(CombinedColumn, [{
                    key: "handleColumnsList",
                    value: function handleColumnsList() {
                        this._columnsArray = this.columns.getObjects();
                        if (this.columns.childListCallbacks.lastObjectAdded) this.keySetUnion.addKeySetDependency(Weave.AS(this.columns.childListCallbacks.lastObjectAdded, IKeySet));
                    }
                    /************************************
                     * Begin IAttributeColumn interface
                     ************************************/

                }, {
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (this.useFirstColumnMetadata.value) {
                            var firstColumn = Weave.AS(this._columnsArray[0], IAttributeColumn);
                            return firstColumn ? firstColumn.getMetadata(propertyName) : null;
                        }
                        return ColumnUtils.getCommonMetadata(this._columnsArray, propertyName);
                    }
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        // TEMPORARY SOLUTION
                        var firstColumn = Weave.AS(this._columnsArray[0], IAttributeColumn);
                        return firstColumn ? firstColumn.getMetadataPropertyNames() : null;
                    }
                    /**
                     * @return the keys associated with this column.
                     */

                }, {
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    value: function containsKey(key) {
                        return this.keySetUnion.containsKey(key);
                    }
                    /**
                     * getValueFromKey
                     * @param key A key of the type specified by keyType.
                     * @return The value associated with the given key.
                     */

                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                        var _iteratorNormalCompletion113 = true;
                        var _didIteratorError113 = false;
                        var _iteratorError113 = undefined;

                        try {
                            for (var _iterator113 = (this._columnsArray || [])[Symbol.iterator](), _step113; !(_iteratorNormalCompletion113 = (_step113 = _iterator113.next()).done); _iteratorNormalCompletion113 = true) {
                                var column = _step113.value;

                                if (column.containsKey(key)) return column.getValueFromKey(key, dataType);
                            }
                        } catch (err) {
                            _didIteratorError113 = true;
                            _iteratorError113 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion113 && _iterator113.return) {
                                    _iterator113.return();
                                }
                            } finally {
                                if (_didIteratorError113) {
                                    throw _iteratorError113;
                                }
                            }
                        }

                        return dataType == String ? '' : undefined;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this.keySetUnion.keys;
                    }
                }]);

                return CombinedColumn;
            }(CallbackCollection);
            CombinedColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.CombinedColumn", interfaces: [IAttributeColumn] })], CombinedColumn);
            column_3.CombinedColumn = CombinedColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var ColumnUtils = weavejs.data.ColumnUtils;
            var StandardLib = weavejs.util.StandardLib;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            /**
             * Divides a data range into a number of equally spaced bins.
             *
             * @author adufilie
             * @author abaumann
             */
            var SimpleBinningDefinition = function (_bin$AbstractBinningD3) {
                _inherits(SimpleBinningDefinition, _bin$AbstractBinningD3);

                function SimpleBinningDefinition() {
                    _classCallCheck(this, SimpleBinningDefinition);

                    /**
                     * The number of bins to generate when calling deriveExplicitBinningDefinition().
                     */
                    var _this163 = _possibleConstructorReturn(this, (SimpleBinningDefinition.__proto__ || Object.getPrototypeOf(SimpleBinningDefinition)).call(this, true, true));

                    _this163.numberOfBins = Weave.linkableChild(_this163, new LinkableNumber(5));
                    // reusable temporary object
                    _this163.tempNumberClassifier = Weave.disposableChild(_this163, bin.NumberClassifier);
                    return _this163;
                }
                /**
                 * From this simple definition, derive an explicit definition.
                 */
                /* override */

                _createClass(SimpleBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        var name;
                        // clear any existing bin classifiers
                        this.output.removeAllObjects();
                        var integerValuesOnly = false;
                        var nonWrapperColumn = ColumnUtils.hack_findNonWrapperColumn(column);
                        if (nonWrapperColumn) {
                            var dataType = nonWrapperColumn.getMetadata(ColumnMetadata.DATA_TYPE);
                            if (dataType && dataType != DataTypes.NUMBER) integerValuesOnly = true;
                        }
                        var stats = WeaveAPI.StatisticsCache.getColumnStatistics(column);
                        var dataMin = isFinite(this.overrideInputMin.value) ? this.overrideInputMin.value : stats.getMin();
                        var dataMax = isFinite(this.overrideInputMax.value) ? this.overrideInputMax.value : stats.getMax();
                        // stop if there is no data
                        if (isNaN(dataMin)) {
                            this.asyncResultCallbacks.triggerCallbacks();
                            return;
                        }
                        var binMin;
                        var binMax = dataMin;
                        var maxInclusive;
                        for (var iBin = 0; iBin < this.numberOfBins.value; iBin++) {
                            if (integerValuesOnly) {
                                maxInclusive = true;
                                if (iBin == 0) binMin = dataMin;else binMin = binMax + 1;
                                if (iBin == this.numberOfBins.value - 1) binMax = dataMax;else binMax = Math.floor(dataMin + (iBin + 1) * (dataMax - dataMin) / this.numberOfBins.value);
                                // skip empty bins
                                if (binMin > binMax) continue;
                            } else {
                                // classifiers use min <= value < max,
                                // except for the final one, which uses min <= value <= max
                                binMin = binMax;
                                if (iBin == this.numberOfBins.value - 1) {
                                    binMax = dataMax;
                                    maxInclusive = true;
                                } else {
                                    maxInclusive = false;
                                    binMax = dataMin + (iBin + 1) * (dataMax - dataMin) / this.numberOfBins.value;
                                    // TEMPORARY SOLUTION -- round bin boundaries
                                    binMax = StandardLib.roundSignificant(binMax, 4);
                                }
                                // TEMPORARY SOLUTION -- round bin boundaries
                                if (iBin > 0) binMin = StandardLib.roundSignificant(binMin, 4);
                                // skip bins with no values
                                if (binMin == binMax && !maxInclusive) continue;
                            }
                            this.tempNumberClassifier.min.value = binMin;
                            this.tempNumberClassifier.max.value = binMax;
                            this.tempNumberClassifier.minInclusive.value = true;
                            this.tempNumberClassifier.maxInclusive.value = maxInclusive;
                            //first get name from overrideBinNames
                            name = this.getOverrideNames()[iBin];
                            //if it is empty string set it from generateBinLabel
                            if (!name) name = this.tempNumberClassifier.generateBinLabel(column);
                            this.output.requestObjectCopy(name, this.tempNumberClassifier);
                        }
                        // trigger callbacks now because we're done updating the output
                        this.asyncResultCallbacks.triggerCallbacks();
                    }
                }]);

                return SimpleBinningDefinition;
            }(bin.AbstractBinningDefinition);
            SimpleBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.data.bin.SimpleBinningDefinition", interfaces: [IBinningDefinition] })], SimpleBinningDefinition);
            bin.SimpleBinningDefinition = SimpleBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_5) {
        var bin;
        (function (bin) {
            var WeaveAPI = weavejs.WeaveAPI;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var Scheduler = weavejs.core.Scheduler;
            var ColumnUtils = weavejs.data.ColumnUtils;
            var SecondaryKeyNumColumn = weavejs.data.column.SecondaryKeyNumColumn;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var AsyncSort = weavejs.util.AsyncSort;
            var StandardLib = weavejs.util.StandardLib;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            /**
             * Implemented from https://gist.github.com/tmcw/4977508
             * Also, read : http://macwright.org/2013/02/18/literate-jenks.html
             * Other implementations from Doug Curl (javascript) and Daniel J Lewis (python implementation) and  Simon Georget (Geostats)
             * http://www.arcgis.com/home/item.html?id=0b633ff2f40d412995b8be377211c47b
             * http://danieljlewis.org/2010/06/07/jenks-natural-breaks-algorithm-in-python/
             * https://github.com/simogeo/geostats/blob/master/lib/geostats.js
             * http://danieljlewis.org/files/2010/06/Jenks.pdf
             */
            var NaturalJenksBinningDefinition = function (_bin$AbstractBinningD4) {
                _inherits(NaturalJenksBinningDefinition, _bin$AbstractBinningD4);

                function NaturalJenksBinningDefinition() {
                    _classCallCheck(this, NaturalJenksBinningDefinition);

                    var _this164 = _possibleConstructorReturn(this, (NaturalJenksBinningDefinition.__proto__ || Object.getPrototypeOf(NaturalJenksBinningDefinition)).call(this, true, false));

                    _this164.numOfBins = Weave.linkableChild(_this164, new LinkableNumber(5));
                    // reusable temporary object
                    _this164._tempNumberClassifier = Weave.disposableChild(_this164, bin.NumberClassifier);
                    _this164._column = null;
                    _this164.asyncSort = Weave.disposableChild(_this164, AsyncSort);
                    _this164._compoundIterateAll = Scheduler.generateCompoundIterativeTask(_this164._getValueFromKeys.bind(_this164), _this164._iterateSortedKeys.bind(_this164), _this164._iterateJenksBreaks.bind(_this164));
                    _this164._keyCount = 0;
                    _this164._keys = [];
                    // in the original implementation, these matrices are referred to
                    // as `LC` and `OP`
                    //
                    // * lower_class_limits (LC): optimal lower class limits
                    // * variance_combinations (OP): optimal variance combinations for all classes
                    _this164._lower_class_limits = [];
                    _this164._variance_combinations = [];
                    _this164._previousSortedValues = [];
                    _this164._sortedValues = [];
                    _this164._count = 2;
                    _this164._m = 0;
                    _this164._p = 2;
                    // the variance, as computed at each step in the calculation
                    _this164._variance = 0;
                    // `SZ` originally. this is the sum of the values seen thus
                    // far when calculating variance.
                    _this164._sum = 0;
                    // `ZSQ` originally. the sum of squares of values seen
                    // thus far
                    _this164._sum_squares = 0;
                    // `WT` originally
                    _this164._w = 0;
                    return _this164;
                }
                /* override */

                _createClass(NaturalJenksBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        this._column = column;
                        if (column) {
                            // BEGIN DIMENSION SLIDER HACK
                            var nonWrapperColumn = ColumnUtils.hack_findNonWrapperColumn(column);
                            if (Weave.IS(nonWrapperColumn, SecondaryKeyNumColumn)) {
                                SecondaryKeyNumColumn.allKeysHack = true;
                                var noChange = this._keys === nonWrapperColumn.keys;
                                this._keys = nonWrapperColumn.keys;
                                SecondaryKeyNumColumn.allKeysHack = false;
                                // stop if we already did this
                                if (noChange) {
                                    this.asyncResultCallbacks.triggerCallbacks();
                                    return;
                                }
                            } else
                                // END DIMENSION SLIDER HACK
                                {
                                    this._keys = column.keys.concat(); // make a copy so we know length won't change during async task
                                }
                        } else {
                            this._keys = [];
                        }
                        this._sortedValues = new Array();
                        this._numOfBins = this.numOfBins.value;
                        this._keyCount = 0;
                        this._previousSortedValues.length = 0;
                        // clear any existing bin classifiers
                        this.output.removeAllObjects();
                        // stop any previous sort task by sorting an empty array
                        this.asyncSort.beginSort(this._previousSortedValues);
                        this._compoundIterateAll(-1); // reset compound task
                        // high priority because not much can be done without data
                        WeaveAPI.Scheduler.startTask(this.asyncResultCallbacks, this._compoundIterateAll, WeaveAPI.TASK_PRIORITY_HIGH, this._handleJenksBreaks.bind(this), Weave.lang("Computing Natural Breaks binning for {0} values", this._keys.length));
                    }
                }, {
                    key: "_getValueFromKeys",
                    value: function _getValueFromKeys(stopTime) {
                        var currValue;
                        for (; this._keyCount < this._keys.length; this._keyCount++) {
                            if (Date.now() > stopTime) return this._keyCount / this._keys.length;
                            /*ignore NaN */
                            currValue = this._column.getValueFromKey(this._keys[this._keyCount], Number);
                            if (isFinite(currValue)) this._sortedValues.push(currValue);
                        }
                        // begin sorting now
                        this.asyncSort.beginSort(this._sortedValues, StandardLib.numericCompare);
                        return 1;
                    }
                }, {
                    key: "_iterateSortedKeys",
                    value: function _iterateSortedKeys(returnTime) {
                        // wait for sort to complete
                        if (this.asyncSort.result == null) return 0;
                        // the code below runs only once - this function is not a proper iterative task
                        ArrayUtils.copy(this._sortedValues, this._previousSortedValues);
                        if (this._sortedValues.length == 0) return 1;
                        this._lower_class_limits = [];
                        this._variance_combinations = [];
                        // Initialize and fill each matrix with zeroes
                        for (var i = 0; i < this._sortedValues.length + 1; i++) {
                            var temp1 = [];
                            var temp2 = [];
                            // despite these arrays having the same values, we need
                            // to keep them separate so that changing one does not change
                            // the other
                            for (var j = 0; j < this._numOfBins + 1; j++) {
                                temp1.push(0);
                                temp2.push(0);
                            }
                            this._lower_class_limits.push(temp1);
                            this._variance_combinations.push(temp2);
                        }
                        for (var k = 1; k < this._numOfBins + 1; k++) {
                            this._lower_class_limits[1][k] = 1;
                            this._variance_combinations[1][k] = 0;
                            for (var t = 2; t < this._sortedValues.length + 1; t++) {
                                this._variance_combinations[t][k] = Number.POSITIVE_INFINITY;
                            }
                        }
                        this._variance = 0;
                        this._count = 2;
                        this._m = 0;
                        return 1;
                    }
                }, {
                    key: "_iterateJenksBreaks",
                    value: function _iterateJenksBreaks(returnTime) {
                        // Compute the matrices required for Jenks breaks.
                        for (; this._count < this._sortedValues.length + 1; this._count++) {
                            if (this._m == 0) {
                                this._sum = 0;
                                this._sum_squares = 0;
                                this._w = 0;
                                this._m = 1;
                            }
                            for (; this._m < this._count + 1; this._m++) {
                                if (Date.now() > returnTime) {
                                    return this._count / (this._sortedValues.length + 1);
                                }
                                // `III` originally
                                var lower_class_limit = this._count - this._m + 1;
                                var val = this._sortedValues[lower_class_limit - 1];
                                this._sum_squares += val * val;
                                this._sum += val;
                                // here we're estimating variance for each potential classing
                                // of the data, for each potential number of classes. `w`
                                // is the number of data points considered so far.
                                this._w += 1;
                                // the variance at this point in the sequence is the difference
                                // between the sum of squares and the total x 2, over the number
                                // of samples.					
                                this._variance = this._sum_squares - this._sum * this._sum / this._w;
                                var i4 = lower_class_limit - 1;
                                if (i4 != 0) {
                                    this._p = 2;
                                    for (; this._p < this._numOfBins + 1; this._p++) {
                                        // if adding this element to an existing class
                                        // will increase its variance beyond the limit, break
                                        // the class at this point, setting the lower_class_limit
                                        // at this point.
                                        if (this._variance_combinations[this._count][this._p] >= this._variance + this._variance_combinations[i4][this._p - 1]) {
                                            this._lower_class_limits[this._count][this._p] = lower_class_limit;
                                            this._variance_combinations[this._count][this._p] = this._variance + this._variance_combinations[i4][this._p - 1];
                                        }
                                    }
                                }
                            }
                            this._m = 0;
                            this._lower_class_limits[this._count][1] = 1;
                            this._variance_combinations[this._count][1] = this._variance;
                        }
                        return 1;
                    }
                }, {
                    key: "_handleJenksBreaks",
                    value: function _handleJenksBreaks() {
                        var k,
                            value,
                            data = this._sortedValues,
                            kclass = [],
                            countNum = 1;
                        // don't attempt to generate more bins than there are distinct values
                        value = data[0];
                        for (k = 1; k < data.length; k++) {
                            if (value != data[k]) {
                                value = data[k];
                                countNum++;
                                if (countNum >= this._numOfBins) break;
                            }
                        }
                        // the calculation of classes will never include the upper and
                        // lower bounds, so we need to explicitly set them
                        kclass[countNum] = data[data.length - 1];
                        kclass[0] = data[0];
                        // the lower_class_limits matrix is used as indexes into itself
                        // here: the `k` variable is reused in each iteration.
                        k = data.length - 1;
                        while (countNum > 1) {
                            kclass[countNum - 1] = data[this._lower_class_limits[k][countNum] - 2];
                            k = this._lower_class_limits[k][countNum] - 1;
                            countNum--;
                        }
                        for (var iBin = 0; iBin < kclass.length - 1; iBin++) {
                            var minIndex;
                            if (iBin == 0) {
                                minIndex = 0;
                            } else {
                                minIndex = this._previousSortedValues.lastIndexOf(kclass[iBin]);
                                minIndex = minIndex + 1;
                            }
                            this._tempNumberClassifier.min.value = this._previousSortedValues[minIndex];
                            var maxIndex;
                            if (iBin == this._numOfBins - 1) {
                                maxIndex = this._previousSortedValues.length - 1;
                            } else {
                                /* Get the index of the next break */
                                maxIndex = this._previousSortedValues.lastIndexOf(kclass[iBin + 1]);
                            }
                            if (maxIndex == -1) {
                                this._tempNumberClassifier.max.value = this._tempNumberClassifier.min.value;
                            } else {
                                this._tempNumberClassifier.max.value = this._previousSortedValues[maxIndex];
                            }
                            this._tempNumberClassifier.minInclusive.value = true;
                            this._tempNumberClassifier.maxInclusive.value = true;
                            if (this._tempNumberClassifier.min.value > this._tempNumberClassifier.max.value) continue;
                            //first get name from overrideBinNames
                            var name = this.getOverrideNames()[iBin];
                            //if it is empty string set it from generateBinLabel
                            if (!name) name = this._tempNumberClassifier.generateBinLabel(this._column);
                            this.output.requestObjectCopy(name, this._tempNumberClassifier);
                        }
                        // trigger callbacks now because we're done updating the output
                        this.asyncResultCallbacks.triggerCallbacks();
                    }
                }, {
                    key: "fixMinMaxInclusive",
                    value: function fixMinMaxInclusive() {
                        var a = this.output.getObjects(bin.NumberClassifier);
                        for (var i = 0; i < a.length; i++) {
                            var nc1 = a[i];
                            var nc2 = a[i + 1];
                            if (nc1 && nc2 && nc1.max.value == nc2.min.value) nc2.minInclusive.value = !(nc1.maxInclusive.value = nc1.min.value == nc1.max.value || !nc1.minInclusive.value);
                            var newName1 = this.getOverrideNames()[i] || nc1.generateBinLabel(this._column);
                            this.output.renameObject(this.output.getName(nc1), newName1);
                        }
                    }
                }, {
                    key: "getSumOfNumbers",
                    value: function getSumOfNumbers(list) {
                        var result = 0;
                        try {
                            var _iteratorNormalCompletion114 = true;
                            var _didIteratorError114 = false;
                            var _iteratorError114 = undefined;

                            try {
                                for (var _iterator114 = (list || [])[Symbol.iterator](), _step114; !(_iteratorNormalCompletion114 = (_step114 = _iterator114.next()).done); _iteratorNormalCompletion114 = true) {
                                    var num = _step114.value;

                                    result += num;
                                }
                            } catch (err) {
                                _didIteratorError114 = true;
                                _iteratorError114 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion114 && _iterator114.return) {
                                        _iterator114.return();
                                    }
                                } finally {
                                    if (_didIteratorError114) {
                                        throw _iteratorError114;
                                    }
                                }
                            }
                        } catch (e) {
                            console.error(e, "Error adding numbers in array");
                            return 0;
                        }
                        return result;
                    }
                    /**
                     * Returns all the values from the column sorted in ascedning order.
                     * @param column An IattributeColumn with numeric values
                     * */

                }, {
                    key: "getSortedNumbersFromColumn",
                    value: function getSortedNumbersFromColumn(column) {
                        var keys = column ? column.keys : [];
                        var sortedColumn = new Array(keys.length);
                        for (var i = 0; i < keys.length; i++) {
                            sortedColumn[i] = column.getValueFromKey(keys[i], Number);
                        }AsyncSort.sortImmediately(sortedColumn);
                        return sortedColumn;
                    }
                }]);

                return NaturalJenksBinningDefinition;
            }(bin.AbstractBinningDefinition);
            NaturalJenksBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.data.bin.NaturalJenksBinningDefinition", interfaces: [IBinningDefinition] })], NaturalJenksBinningDefinition);
            bin.NaturalJenksBinningDefinition = NaturalJenksBinningDefinition;
        })(bin = data_5.bin || (data_5.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IBinClassifier = weavejs.api.data.IBinClassifier;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var ColumnUtils = weavejs.data.ColumnUtils;
            var StandardLib = weavejs.util.StandardLib;
            /**
             * A classifier that uses min,max values for containment tests.
             *
             * @author adufilie
             */
            var NumberClassifier = function () {
                function NumberClassifier() {
                    var min = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NaN;
                    var max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : NaN;
                    var minInclusive = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
                    var maxInclusive = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;

                    _classCallCheck(this, NumberClassifier);

                    /**
                     * These values define the bounds of the continuous range contained in this classifier.
                     */
                    this.min = Weave.linkableChild(this, LinkableNumber);
                    this.max = Weave.linkableChild(this, LinkableNumber);
                    /**
                     * This value is the result of contains(value) when value == min.
                     */
                    this.minInclusive = Weave.linkableChild(this, LinkableBoolean);
                    /**
                     * This value is the result of contains(value) when value == max.
                     */
                    this.maxInclusive = Weave.linkableChild(this, LinkableBoolean);
                    this._triggerCount = 0;
                    this._callbacks = Weave.getCallbacks(this);
                    this.min.value = min;
                    this.max.value = max;
                    this.minInclusive.value = minInclusive;
                    this.maxInclusive.value = maxInclusive;
                }
                /**
                 * contains
                 * @param value A value to test.
                 * @return true If this IBinClassifier contains the given value.
                 */


                _createClass(NumberClassifier, [{
                    key: "contains",
                    value: function contains(value) {
                        // validate private variables before trying to use them
                        if (this._triggerCount != this._callbacks.triggerCounter) {
                            this._min = this.min.value;
                            this._max = this.max.value;
                            this._minInclusive = this.minInclusive.value;
                            this._maxInclusive = this.maxInclusive.value;
                            this._triggerCount = this._callbacks.triggerCounter;
                        }
                        // use private variables for speed
                        if (this._minInclusive ? value >= this._min : value > this._min) if (this._maxInclusive ? value <= this._max : value < this._max) return true;
                        return false;
                    }
                    /**
                     * @param toStringColumn The primitive column to use that provides a number-to-string conversion function.
                     * @return A generated label for this NumberClassifier.
                     */

                }, {
                    key: "generateBinLabel",
                    value: function generateBinLabel() {
                        var toStringColumn = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                        var minStr = null;
                        var maxStr = null;
                        // get labels from column
                        minStr = ColumnUtils.deriveStringFromNumber(toStringColumn, this.min.value) || '';
                        maxStr = ColumnUtils.deriveStringFromNumber(toStringColumn, this.max.value) || '';
                        // if the column produced no labels, use default number formatting
                        if (!minStr && !maxStr) {
                            minStr = StandardLib.formatNumber(this.min.value);
                            maxStr = StandardLib.formatNumber(this.max.value);
                        }
                        // if both labels are the same, return the label
                        if (minStr && maxStr && minStr == maxStr) return minStr;
                        // if the column dataType is string, put quotes around the labels
                        if (toStringColumn && toStringColumn.getMetadata(ColumnMetadata.DATA_TYPE) == DataTypes.STRING) {
                            minStr = Weave.lang('"{0}"', minStr);
                            maxStr = Weave.lang('"{0}"', maxStr);
                        } else {
                            if (!this.minInclusive.value) minStr = Weave.lang("> {0}", minStr);
                            if (!this.maxInclusive.value) maxStr = Weave.lang("< {0}", maxStr);
                        }
                        if (minStr == '') minStr = Weave.lang('Undefined');
                        if (maxStr == '') maxStr = Weave.lang('Undefined');
                        return Weave.lang("{0} to {1}", minStr, maxStr);
                    }
                }, {
                    key: "toString",
                    value: function toString() {
                        return (this.minInclusive.value ? '[' : '(') + this.min.value + ', ' + this.max.value + (this.maxInclusive.value ? ']' : ')');
                    }
                }]);

                return NumberClassifier;
            }();
            NumberClassifier = __decorate([Weave.classInfo({ id: "weavejs.data.bin.NumberClassifier", interfaces: [IBinClassifier] })], NumberClassifier);
            bin.NumberClassifier = NumberClassifier;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IBinClassifier = weavejs.api.data.IBinClassifier;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
            var ColumnUtils = weavejs.data.ColumnUtils;
            var DynamicBinningDefinition = weavejs.data.bin.DynamicBinningDefinition;
            var NumberClassifier = weavejs.data.bin.NumberClassifier;
            var SimpleBinningDefinition = weavejs.data.bin.SimpleBinningDefinition;
            var StandardLib = weavejs.util.StandardLib;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * A binned column maps a record key to a bin key.
             *
             * @author adufilie
             */
            var BinnedColumn = function (_column$ExtendedDynam5) {
                _inherits(BinnedColumn, _column$ExtendedDynam5);

                function BinnedColumn() {
                    _classCallCheck(this, BinnedColumn);

                    /**
                     * This defines how to generate the bins for this BinnedColumn.
                     * This is used to generate the derivedBins.
                     */
                    var _this165 = _possibleConstructorReturn(this, (BinnedColumn.__proto__ || Object.getPrototypeOf(BinnedColumn)).call(this));

                    _this165.binningDefinition = Weave.linkableChild(_this165, new DynamicBinningDefinition(true));
                    _this165._binNames = []; // maps a bin index to a bin name
                    _this165._binClassifiers = []; // maps a bin index to an IBinClassifier
                    _this165.map_key_binIndex = new Map(); // maps a record key to a bin index
                    _this165._binnedKeysArray = []; // maps a bin index to a list of keys in that bin
                    _this165._binnedKeysMap = {}; // maps a bin name to a list of keys in that bin
                    _this165._largestBinSize = 0;
                    _this165._resultTriggerCount = 0;
                    _this165.binningDefinition.requestLocalObject(SimpleBinningDefinition, false);
                    _this165.binningDefinition.generateBinClassifiersForColumn(_this165.internalDynamicColumn);
                    Weave.linkableChild(_this165, _this165.binningDefinition.asyncResultCallbacks);
                    return _this165;
                }
                /**
                 * This number overrides the min,max metadata values.
                 * @param propertyName The name of a metadata property.
                 * @return The value of the specified metadata property.
                 */
                /* override */

                _createClass(BinnedColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        this.validateBins();
                        if (this._binClassifiers && this._binClassifiers.length) {
                            switch (propertyName) {
                                case ColumnMetadata.MIN:
                                    return this.numberOfBins > 0 ? "0" : null;
                                case ColumnMetadata.MAX:
                                    var binCount = this.numberOfBins;
                                    return binCount > 0 ? String(binCount - 1) : null;
                            }
                        }
                        return _get(BinnedColumn.prototype.__proto__ || Object.getPrototypeOf(BinnedColumn.prototype), "getMetadata", this).call(this, propertyName);
                    }
                    /**
                     * This function generates bins using the binning definition and the internal column,
                     * and also saves lookups for mapping between bins and keys.
                     */

                }, {
                    key: "validateBins",
                    value: function validateBins() {
                        if (this._resultTriggerCount != this.binningDefinition.asyncResultCallbacks.triggerCounter) {
                            if (WeaveAPI.SessionManager.linkableObjectIsBusy(this)) return;
                            this._resultTriggerCount = this.binningDefinition.asyncResultCallbacks.triggerCounter;
                            // reset cached values
                            this._column = this.internalDynamicColumn.getInternalColumn();
                            this.map_key_binIndex = new Map();
                            this._binnedKeysArray = [];
                            this._binnedKeysMap = {};
                            this._largestBinSize = 0;
                            // save bin names for faster lookup
                            this._binNames = this.binningDefinition.getBinNames();
                            this._binClassifiers = this.binningDefinition.getBinClassifiers();
                            // create empty key arrays
                            if (this._binNames) for (var i = 0; i < this._binNames.length; i++) {
                                this._binnedKeysMap[this._binNames[i]] = this._binnedKeysArray[i] = [];
                            } // same Array pointer
                            this._keys = this.internalDynamicColumn.keys;
                            this._i = 0;
                            if (StandardLib.getArrayType(this._binClassifiers) == NumberClassifier) this._dataType = Number;else this._dataType = String;
                            // fill all mappings
                            if (this._column && this._binClassifiers) {
                                // high priority because not much can be done without data
                                WeaveAPI.Scheduler.startTask(this, this._asyncIterate, WeaveAPI.TASK_PRIORITY_HIGH, this.triggerCallbacks, Weave.lang("Binning {0} records", this._keys.length));
                            }
                        }
                    }
                }, {
                    key: "_asyncIterate",
                    value: function _asyncIterate(stopTime) {
                        // stop immediately if result callbacks were triggered
                        if (this._resultTriggerCount != this.binningDefinition.asyncResultCallbacks.triggerCounter) return 1;
                        for (; this._i < this._keys.length; this._i++) {
                            if (Date.now() > stopTime) return this._i / this._keys.length;
                            var key = this._keys[this._i];
                            var value = this._column.getValueFromKey(key, this._dataType);
                            var binIndex = 0;
                            for (; binIndex < this._binClassifiers.length; binIndex++) {
                                if (Weave.AS(this._binClassifiers[binIndex], IBinClassifier).contains(value)) {
                                    this.map_key_binIndex.set(key, binIndex);
                                    var array = Weave.AS(this._binnedKeysArray[binIndex], Array);
                                    if (array.push(key) > this._largestBinSize) this._largestBinSize = array.length;
                                    break;
                                }
                            }
                        }
                        return 1;
                    }
                    /**
                     * This is the number of bins that have been generated by
                     * the binning definition using with the internal column.
                     */

                }, {
                    key: "getKeysFromBinIndex",

                    /**
                     * This function gets a list of keys in a bin.
                     * @param binIndex The index of the bin to get the keys from.
                     * @return An Array of keys in the specified bin.
                     */
                    value: function getKeysFromBinIndex(binIndex) {
                        this.validateBins();
                        if (binIndex < this._binnedKeysArray.length) return this._binnedKeysArray[binIndex];
                        return null;
                    }
                    /**
                     * This function gets a list of keys in a bin.
                     * @param binIndex The name of the bin to get the keys from.
                     * @return An Array of keys in the specified bin.
                     */

                }, {
                    key: "getKeysFromBinName",
                    value: function getKeysFromBinName(binName) {
                        this.validateBins();
                        return Weave.AS(this._binnedKeysMap[binName], Array);
                    }
                }, {
                    key: "getBinIndexFromDataValue",
                    value: function getBinIndexFromDataValue(value) {
                        this.validateBins();
                        if (this._binClassifiers) for (var i = 0; i < this._binClassifiers.length; i++) {
                            if (Weave.AS(this._binClassifiers[i], IBinClassifier).contains(value)) return i;
                        }return NaN;
                    }
                    /**
                     * This function returns different results depending on the dataType.
                     * Supported types:
                     *     default -> IBinClassifier that matches the given record key
                     *     Number -> bin index for the given record key
                     *     String -> bin name for the given record key
                     *     Array -> list of keys in the same bin as the given record key
                     * @param key A record identifier.
                     * @param dataType The requested return type.
                     * @return If the specified dataType is supported, a value of that type.  Otherwise, the default return value for the given record key.
                     */
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        this.validateBins();
                        if (!this._binClassifiers || !this._binClassifiers.length) return _get(BinnedColumn.prototype.__proto__ || Object.getPrototypeOf(BinnedColumn.prototype), "getValueFromKey", this).call(this, key, dataType);
                        var binIndex = Number(this.map_key_binIndex.get(key)); // undefined -> NaN
                        // Number: return bin index
                        if (dataType == Number) return binIndex;
                        // String: return bin name
                        if (dataType == String) return isNaN(binIndex) ? '' : this._binNames[binIndex];
                        if (isNaN(binIndex)) return undefined;
                        // Array: return list of keys in the same bin
                        if (dataType == Array) return Weave.AS(this._binnedKeysArray[binIndex], Array);
                        // default: return IBinClassifier
                        return this._binClassifiers && this._binClassifiers[binIndex];
                    }
                    /**
                     * From a bin index, this function returns the name of the bin.
                     * @param value A bin index
                     * @return The name of the bin
                     */

                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(value) {
                        this.validateBins();
                        if (!this._binClassifiers || !this._binClassifiers.length) return ColumnUtils.deriveStringFromNumber(this.internalDynamicColumn, value);
                        try {
                            return this._binNames[value];
                        } catch (e) {} // ok to ignore Array[index] error
                        return '';
                    }
                }, {
                    key: "numberOfBins",
                    get: function get() {
                        this.validateBins();
                        return this._binNames.length;
                    }
                    /**
                     * This is the largest number of records in any of the bins.
                     */

                }, {
                    key: "largestBinSize",
                    get: function get() {
                        this.validateBins();
                        return this._largestBinSize;
                    }
                }]);

                return BinnedColumn;
            }(column.ExtendedDynamicColumn);
            BinnedColumn = __decorate([Weave.classInfo({ id: "weavejs.data.column.BinnedColumn", interfaces: [IPrimitiveColumn, IColumnWrapper, IAttributeColumn, ICallbackCollection] })], BinnedColumn);
            column.BinnedColumn = BinnedColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin_1) {
            var WeaveAPI = weavejs.WeaveAPI;
            var NumberClassifier = weavejs.data.bin.NumberClassifier;
            var StandardLib = weavejs.util.StandardLib;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            /**
             * StandardDeviationBinningDefinition
             *
             * @author adufilie
             */
            var StandardDeviationBinningDefinition_1 = void 0;
            var StandardDeviationBinningDefinition = StandardDeviationBinningDefinition_1 = function (_bin_1$AbstractBinnin) {
                _inherits(StandardDeviationBinningDefinition, _bin_1$AbstractBinnin);

                function StandardDeviationBinningDefinition() {
                    _classCallCheck(this, StandardDeviationBinningDefinition);

                    return _possibleConstructorReturn(this, (StandardDeviationBinningDefinition.__proto__ || Object.getPrototypeOf(StandardDeviationBinningDefinition)).call(this, true, false));
                }
                /* override */

                _createClass(StandardDeviationBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        // clear any existing bin classifiers
                        this.output.removeAllObjects();
                        var stats = WeaveAPI.StatisticsCache.getColumnStatistics(column);
                        var mean = stats.getMean();
                        var stdDev = stats.getStandardDeviation();
                        var binNumber = 0;
                        for (var i = -StandardDeviationBinningDefinition_1.MAX_SD; i <= StandardDeviationBinningDefinition_1.MAX_SD; i++) {
                            if (i != 0) this.addBin(this.output, Math.abs(i), i < 0, stdDev, mean, this.getOverrideNames()[binNumber++]);
                        } // trigger callbacks now because we're done updating the output
                        this.asyncResultCallbacks.triggerCallbacks();
                    }
                }, {
                    key: "addBin",
                    value: function addBin(output, absSDNumber, belowMean, stdDev, mean, overrideName) {
                        var name = overrideName;
                        if (!name) {
                            var nameFormat = absSDNumber < StandardDeviationBinningDefinition_1.MAX_SD ? "{0} - {1} SD {2} mean" : "> {0} SD {2} mean";
                            name = StandardLib.substitute(nameFormat, absSDNumber - 1, absSDNumber, belowMean ? "below" : "above");
                        }
                        var bin = output.requestObject(name, NumberClassifier, false);
                        if (belowMean) {
                            if (absSDNumber == StandardDeviationBinningDefinition_1.MAX_SD) bin.min.value = -Infinity;else bin.min.value = mean - absSDNumber * stdDev;
                            bin.max.value = mean - (absSDNumber - 1) * stdDev;
                        } else {
                            bin.min.value = mean + (absSDNumber - 1) * stdDev;
                            if (absSDNumber == StandardDeviationBinningDefinition_1.MAX_SD) bin.max.value = Infinity;else bin.max.value = mean + absSDNumber * stdDev;
                        }
                        bin.minInclusive.value = true;
                        bin.maxInclusive.value = true;
                    }
                }]);

                return StandardDeviationBinningDefinition;
            }(bin_1.AbstractBinningDefinition);
            StandardDeviationBinningDefinition.MAX_SD = 3;
            StandardDeviationBinningDefinition = StandardDeviationBinningDefinition_1 = __decorate([Weave.classInfo({ id: "weavejs.data.bin.StandardDeviationBinningDefinition", interfaces: [IBinningDefinition] })], StandardDeviationBinningDefinition);
            bin_1.StandardDeviationBinningDefinition = StandardDeviationBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var bin;
        (function (bin) {
            var LinkableString = weavejs.core.LinkableString;
            var AsyncSort = weavejs.util.AsyncSort;
            var StandardLib = weavejs.util.StandardLib;
            var IBinningDefinition = weavejs.api.data.IBinningDefinition;
            var NumberClassifier = weavejs.data.bin.NumberClassifier;
            /**
             * Divides a data range into a number of bins based on range entered by user.
             *
             * @author adufilie
             * @author abaumann
             * @author skolman
             */
            var CustomSplitBinningDefinition = function (_bin$AbstractBinningD5) {
                _inherits(CustomSplitBinningDefinition, _bin$AbstractBinningD5);

                function CustomSplitBinningDefinition() {
                    _classCallCheck(this, CustomSplitBinningDefinition);

                    /**
                     * A list of numeric values separated by commas that mark the beginning and end of bin ranges.
                     */
                    var _this167 = _possibleConstructorReturn(this, (CustomSplitBinningDefinition.__proto__ || Object.getPrototypeOf(CustomSplitBinningDefinition)).call(this, true, false));

                    _this167.splitValues = Weave.linkableChild(_this167, LinkableString);
                    // reusable temporary object
                    _this167.tempNumberClassifier = Weave.disposableChild(_this167, NumberClassifier);
                    return _this167;
                }
                /* override */

                _createClass(CustomSplitBinningDefinition, [{
                    key: "generateBinClassifiersForColumn",
                    value: function generateBinClassifiersForColumn(column) {
                        // make sure callbacks only run once.
                        Weave.getCallbacks(this.output).delayCallbacks();
                        var name;
                        // clear any existing bin classifiers
                        this.output.removeAllObjects();
                        var i;
                        var values = String(this.splitValues.value || '').split(','); // TODO
                        // remove bad values
                        for (i = values.length; i--;) {
                            var number = StandardLib.asNumber(values[i]);
                            if (!isFinite(number)) values.splice(i, 1);else values[i] = number;
                        }
                        // sort numerically
                        AsyncSort.sortImmediately(values);
                        for (i = 0; i < values.length - 1; i++) {
                            this.tempNumberClassifier.min.value = values[i];
                            this.tempNumberClassifier.max.value = values[i + 1];
                            this.tempNumberClassifier.minInclusive.value = true;
                            this.tempNumberClassifier.maxInclusive.value = i == values.length - 2;
                            //first get name from overrideBinNames
                            name = this.getOverrideNames()[i];
                            //if it is empty string set it from generateBinLabel
                            if (!name) name = this.tempNumberClassifier.generateBinLabel(column);
                            this.output.requestObjectCopy(name, this.tempNumberClassifier);
                        }
                        // allow callbacks to run now.
                        Weave.getCallbacks(this.output).resumeCallbacks();
                        // trigger callbacks now because we're done updating the output
                        this.asyncResultCallbacks.triggerCallbacks();
                    }
                    // backwards compatibility
                    /**
                     * @deprecated replacement="splitValues")
                     */

                }, {
                    key: "binRange",
                    set: function set(value) {
                        this.splitValues.value = value;
                    }
                    // backwards compatibility
                    /**
                     * @deprecated replacement="splitValues")
                     */

                }, {
                    key: "dataMin",
                    set: function set(value) {
                        this.splitValues.value = value + ',' + this.splitValues.value;
                    }
                    // backwards compatibility
                    /**
                     * @deprecated replacement="splitValues")
                     */

                }, {
                    key: "dataMax",
                    set: function set(value) {
                        this.splitValues.value += ',' + value;
                    }
                }]);

                return CustomSplitBinningDefinition;
            }(bin.AbstractBinningDefinition);
            CustomSplitBinningDefinition = __decorate([Weave.classInfo({ id: "weavejs.data.bin.CustomSplitBinningDefinition", interfaces: [IBinningDefinition] })], CustomSplitBinningDefinition);
            bin.CustomSplitBinningDefinition = CustomSplitBinningDefinition;
        })(bin = data.bin || (data.bin = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column_4) {
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IColumnWrapper = weavejs.api.data.IColumnWrapper;
            var LinkableWatcher = weavejs.core.LinkableWatcher;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * This class is a proxy (a wrapper) for another attribute column.
             *
             * @author adufilie
             */
            var ProxyColumn_1 = void 0;
            var ProxyColumn = ProxyColumn_1 = function (_column_4$AbstractAtt) {
                _inherits(ProxyColumn, _column_4$AbstractAtt);

                function ProxyColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, ProxyColumn);

                    var _this168 = _possibleConstructorReturn(this, (ProxyColumn.__proto__ || Object.getPrototypeOf(ProxyColumn)).call(this, metadata));

                    _this168.watcher = Weave.linkableChild(_this168, new LinkableWatcher(IAttributeColumn));
                    return _this168;
                }
                /**
                 * @return the keys associated with this column.
                 */
                /* override */

                _createClass(ProxyColumn, [{
                    key: "containsKey",

                    /**
                     * @param key A key to test.
                     * @return true if the key exists in this IKeySet.
                     */
                    /* override */value: function containsKey(key) {
                        var column = Weave.AS(this.watcher.target, IAttributeColumn);
                        return column ? column.containsKey(key) : false;
                    }
                    /**
                     * This function updates the proxy metadata.
                     * @param metadata New metadata for the proxy.
                     */
                    /* override */
                }, {
                    key: "setMetadata",
                    value: function setMetadata(metadata) {
                        this._metadata = column_4.AbstractAttributeColumn.copyValues(metadata);
                        this.triggerCallbacks();
                    }
                    /**
                     * The metadata specified by ProxyColumn will override the metadata of the internal column.
                     * First, this function checks thet ProxyColumn metadata.
                     * If the value is null, it checks the metadata of the internal column.
                     * @param propertyName The name of a metadata property to get.
                     * @return The metadata value of the ProxyColumn or the internal column, ProxyColumn metadata takes precendence.
                     */
                    /* override */
                }, {
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (propertyName === ColumnMetadata.TITLE && this._overrideTitle) return this._overrideTitle;
                        var column = Weave.AS(this.watcher.target, IAttributeColumn);
                        var overrideValue = _get(ProxyColumn.prototype.__proto__ || Object.getPrototypeOf(ProxyColumn.prototype), "getMetadata", this).call(this, propertyName);
                        if (overrideValue == null && column != null) return column.getMetadata(propertyName);
                        return overrideValue;
                    }
                }, {
                    key: "getProxyMetadata",
                    value: function getProxyMetadata() {
                        return column_4.AbstractAttributeColumn.copyValues(this._metadata);
                    }
                    /* override */
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        var column = Weave.AS(this.watcher.target, IAttributeColumn);
                        if (column) return ArrayUtils.union(_get(ProxyColumn.prototype.__proto__ || Object.getPrototypeOf(ProxyColumn.prototype), "getMetadataPropertyNames", this).call(this), column.getMetadataPropertyNames());
                        return _get(ProxyColumn.prototype.__proto__ || Object.getPrototypeOf(ProxyColumn.prototype), "getMetadataPropertyNames", this).call(this);
                    }
                    /**
                     * internalAttributeColumn
                     * This is the IAttributeColumn object contained in this ProxyColumn.
                     */

                }, {
                    key: "getInternalColumn",
                    value: function getInternalColumn() {
                        return Weave.AS(this.watcher.target, IAttributeColumn);
                    }
                }, {
                    key: "setInternalColumn",
                    value: function setInternalColumn(newColumn) {
                        this._overrideTitle = null;
                        this.watcher.target = newColumn;
                    }
                    /**
                     * The functions below serve as wrappers for matching function calls on the internalAttributeColumn.
                     */
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        var column = Weave.AS(this.watcher.target, IAttributeColumn);
                        if (column) return column.getValueFromKey(key, dataType);
                        return undefined;
                    }
                    /* override */
                }, {
                    key: "dispose",
                    value: function dispose() {
                        _get(ProxyColumn.prototype.__proto__ || Object.getPrototypeOf(ProxyColumn.prototype), "dispose", this).call(this);
                        this._metadata = null;
                    }
                    /**
                     * Call this function when the ProxyColumn should indicate that the requested data is unavailable.
                     * @param message The message to display in the title of the ProxyColumn.
                     */

                }, {
                    key: "dataUnavailable",
                    value: function dataUnavailable() {
                        var message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                        this.delayCallbacks();
                        this.setInternalColumn(null);
                        if (message) {
                            this._overrideTitle = message;
                        } else {
                            var title = this.getMetadata(ColumnMetadata.TITLE);
                            if (title) this._overrideTitle = Weave.lang('(Data unavailable: {0})', title);else this._overrideTitle = Weave.lang(ProxyColumn_1.DATA_UNAVAILABLE);
                        }
                        this.triggerCallbacks();
                        this.resumeCallbacks();
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        var column = Weave.AS(this.watcher.target, IAttributeColumn);
                        return column ? column.keys : [];
                    }
                }]);

                return ProxyColumn;
            }(column_4.AbstractAttributeColumn);
            ProxyColumn.DATA_UNAVAILABLE = '(Data unavailable)';
            ProxyColumn = ProxyColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.ProxyColumn", interfaces: [IAttributeColumn, IColumnWrapper, ICallbackCollection] })], ProxyColumn);
            column_4.ProxyColumn = ProxyColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source) {
            var WeaveAPI = weavejs.WeaveAPI;
            var IDisposableObject = weavejs.api.core.IDisposableObject;
            var IDataSource = weavejs.api.data.IDataSource;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var LinkableString = weavejs.core.LinkableString;
            var ProxyColumn = weavejs.data.column.ProxyColumn;
            var HierarchyUtils = weavejs.data.hierarchy.HierarchyUtils;
            var JS = weavejs.util.JS;
            /**
             * This is a base class to make it easier to develope a new class that implements IDataSource.
             * Classes that extend AbstractDataSource should implement the following methods:
             * getHierarchyRoot, generateHierarchyNode, requestColumnFromSource
             *
             * @author adufilie
             */
            var AbstractDataSource = function () {
                function AbstractDataSource() {
                    _classCallCheck(this, AbstractDataSource);

                    /**
                     * Overrides root hierarchy label.
                     */
                    this.label = Weave.linkableChild(this, LinkableString);
                    /**
                     * This variable is set to false when the session state changes and true when initialize() is called.
                     */
                    this._initializeCalled = false;
                    /**
                     * ProxyColumn -> (true if pending, false if not pending)
                     */
                    this.map_proxyColumn_pending = new Map();
                    this._hierarchyRefresh = Weave.linkableChild(this, CallbackCollection, this.refreshHierarchy);
                    var cc = Weave.getCallbacks(this);
                    cc.addImmediateCallback(this, this.uninitialize);
                    cc.addGroupedCallback(this, this.initialize, true, false);
                }

                _createClass(AbstractDataSource, [{
                    key: "getLabel",
                    value: function getLabel() {
                        if (this.label.value) return this.label.value;
                        var root = Weave.getRoot(this);
                        if (root) return root.getName(this);
                        return null;
                    }
                }, {
                    key: "refreshHierarchy",

                    /**
                     * Sets _rootNode to null and triggers callbacks.
                     * @inheritDoc
                     */
                    value: function refreshHierarchy() {
                        this._rootNode = null;
                    }
                    /**
                     * This function must be implemented by classes that extend AbstractDataSource.
                     * This function should set _rootNode if it is null, which may happen from calling refreshHierarchy().
                     * @inheritDoc
                     */
                    /* abstract */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        return this._rootNode;
                    }
                    /**
                     * This function must be implemented by classes that extend AbstractDataSource.
                     * This function should make a request to the source to fill in the proxy column.
                     * @param proxyColumn Contains metadata for the column request and will be used to store column data when it is ready.
                     */
                    /* abstract */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {}
                    /**
                     * This function must be implemented by classes that extend AbstractDataSource.
                     * @param metadata A set of metadata that may identify a column in this IDataSource.
                     * @return A node that contains the metadata.
                     */
                    /* abstract */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        return null;
                    }
                    /**
                     * Classes that extend AbstractDataSource can define their own replacement for this function.
                     * All column requests will be delayed as long as this accessor function returns false.
                     * The default behavior is to return false during the time between a change in the session state and when initialize() is called.
                     */

                }, {
                    key: "uninitialize",

                    /**
                     * This function is called as an immediate callback and sets initialized to false.
                     */
                    value: function uninitialize() {
                        this._initializeCalled = false;
                    }
                    /**
                     * This function will be called as a grouped callback the frame after the session state for the data source changes.
                     * When overriding this function, super.initialize() should be called.
                     */

                }, {
                    key: "initialize",
                    value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        // set initialized to true so other parts of the code know if this function has been called.
                        this._initializeCalled = true;
                        if (forceRefresh) this.refreshAllProxyColumns(this.initializationComplete);else this.handleAllPendingColumnRequests(this.initializationComplete);
                    }
                    /**
                     * The default implementation of this function calls generateHierarchyNode(metadata) and
                     * then traverses the _rootNode to find a matching node.
                     * This function should be overridden if the hierachy is not known completely, since this
                     * may result in traversing the entire hierarchy, causing many remote procedure calls if
                     * the hierarchy is stored remotely.
                     */

                }, {
                    key: "findHierarchyNode",
                    value: function findHierarchyNode(metadata) {
                        var path = HierarchyUtils.findPathToNode(this.getHierarchyRoot(), this.generateHierarchyNode(metadata));
                        if (path) return path[path.length - 1];
                        return null;
                    }
                    /**
                     * This function creates a new ProxyColumn object corresponding to the metadata and queues up the request for the column.
                     * @param metadata An object that contains all the information required to request the column from this IDataSource.
                     * @return A ProxyColumn object that will be updated when the column data is ready.
                     */

                }, {
                    key: "generateNewAttributeColumn",
                    value: function generateNewAttributeColumn(metadata) {
                        var proxyColumn = Weave.disposableChild(this, ProxyColumn);
                        proxyColumn.setMetadata(metadata);
                        var name = this.getLabel() || Weave.className(this).split('.').pop();
                        var description = name + " pending column request";
                        WeaveAPI.ProgressIndicator.addTask(proxyColumn, this, description);
                        WeaveAPI.ProgressIndicator.addTask(proxyColumn, proxyColumn, description);
                        this.handlePendingColumnRequest(proxyColumn);
                        return proxyColumn;
                    }
                    /**
                     * This function will call requestColumnFromSource() if initializationComplete==true.
                     * Otherwise, it will delay the column request again.
                     * This function may be overridden by classes that extend AbstractDataSource.
                     * However, if the extending class decides it wants to call requestColumnFromSource()
                     * for the pending column, it is recommended to call super.handlePendingColumnRequest() instead.
                     * @param request The request that needs to be handled.
                     */

                }, {
                    key: "handlePendingColumnRequest",
                    value: function handlePendingColumnRequest(column) {
                        var forced = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                        // If data source is already initialized (session state is stable, not currently changing), we can request the column now.
                        // Otherwise, we have to wait.
                        if (this.initializationComplete || forced) {
                            this.map_proxyColumn_pending.set(column, false); // no longer pending
                            WeaveAPI.ProgressIndicator.removeTask(column);
                            this.requestColumnFromSource(column);
                        } else {
                            this.map_proxyColumn_pending.set(column, true); // pending
                        }
                    }
                    /**
                     * This function will call handlePendingColumnRequest() on each pending column request.
                     */

                }, {
                    key: "handleAllPendingColumnRequests",
                    value: function handleAllPendingColumnRequests() {
                        var forced = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        var cols = JS.mapKeys(this.map_proxyColumn_pending);
                        var _iteratorNormalCompletion115 = true;
                        var _didIteratorError115 = false;
                        var _iteratorError115 = undefined;

                        try {
                            for (var _iterator115 = cols[Symbol.iterator](), _step115; !(_iteratorNormalCompletion115 = (_step115 = _iterator115.next()).done); _iteratorNormalCompletion115 = true) {
                                var proxyColumn = _step115.value;

                                if (this.map_proxyColumn_pending.get(proxyColumn)) this.handlePendingColumnRequest(proxyColumn, forced);
                            }
                        } catch (err) {
                            _didIteratorError115 = true;
                            _iteratorError115 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion115 && _iterator115.return) {
                                    _iterator115.return();
                                }
                            } finally {
                                if (_didIteratorError115) {
                                    throw _iteratorError115;
                                }
                            }
                        }
                    }
                    /**
                     * Calls requestColumnFromSource() on all ProxyColumn objects created previously via generateNewAttributeColumn().
                     */

                }, {
                    key: "refreshAllProxyColumns",
                    value: function refreshAllProxyColumns() {
                        var forced = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        var cols = JS.mapKeys(this.map_proxyColumn_pending);
                        var _iteratorNormalCompletion116 = true;
                        var _didIteratorError116 = false;
                        var _iteratorError116 = undefined;

                        try {
                            for (var _iterator116 = cols[Symbol.iterator](), _step116; !(_iteratorNormalCompletion116 = (_step116 = _iterator116.next()).done); _iteratorNormalCompletion116 = true) {
                                var proxyColumn = _step116.value;

                                this.handlePendingColumnRequest(proxyColumn, forced);
                            }
                        } catch (err) {
                            _didIteratorError116 = true;
                            _iteratorError116 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion116 && _iterator116.return) {
                                    _iterator116.return();
                                }
                            } finally {
                                if (_didIteratorError116) {
                                    throw _iteratorError116;
                                }
                            }
                        }
                    }
                    /**
                     * This function should be called when the IDataSource is no longer in use.
                     * All existing pointers to objects should be set to null so they can be garbage collected.
                     */

                }, {
                    key: "dispose",
                    value: function dispose() {
                        var cols = JS.mapKeys(this.map_proxyColumn_pending);
                        var _iteratorNormalCompletion117 = true;
                        var _didIteratorError117 = false;
                        var _iteratorError117 = undefined;

                        try {
                            for (var _iterator117 = cols[Symbol.iterator](), _step117; !(_iteratorNormalCompletion117 = (_step117 = _iterator117.next()).done); _iteratorNormalCompletion117 = true) {
                                var column = _step117.value;

                                WeaveAPI.ProgressIndicator.removeTask(column);
                            }
                        } catch (err) {
                            _didIteratorError117 = true;
                            _iteratorError117 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion117 && _iterator117.return) {
                                    _iterator117.return();
                                }
                            } finally {
                                if (_didIteratorError117) {
                                    throw _iteratorError117;
                                }
                            }
                        }

                        this._initializeCalled = false;
                        this.map_proxyColumn_pending = null;
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return false;
                    }
                }, {
                    key: "hierarchyRefresh",
                    get: function get() {
                        return this._hierarchyRefresh;
                    }
                }, {
                    key: "initializationComplete",
                    get: function get() {
                        return this._initializeCalled;
                    }
                }]);

                return AbstractDataSource;
            }();
            AbstractDataSource = __decorate([Weave.classInfo({ id: "weavejs.data.source.AbstractDataSource", interfaces: [IDataSource, IDisposableObject] })], AbstractDataSource);
            source.AbstractDataSource = AbstractDataSource;
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source_2) {
            var WeaveAPI = weavejs.WeaveAPI;
            var DataTypes = weavejs.api.data.DataTypes;
            var IDataSource = weavejs.api.data.IDataSource;
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var LinkableBoolean = weavejs.core.LinkableBoolean;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var LinkableString = weavejs.core.LinkableString;

            var CKANDataSource = function (_source_2$AbstractDat) {
                _inherits(CKANDataSource, _source_2$AbstractDat);

                function CKANDataSource() {
                    var _ref13;

                    _classCallCheck(this, CKANDataSource);

                    for (var _len9 = arguments.length, args = Array(_len9), _key10 = 0; _key10 < _len9; _key10++) {
                        args[_key10] = arguments[_key10];
                    }

                    var _this169 = _possibleConstructorReturn(this, (_ref13 = CKANDataSource.__proto__ || Object.getPrototypeOf(CKANDataSource)).call.apply(_ref13, [this].concat(args)));

                    _this169.url = Weave.linkableChild(_this169, new LinkableString());
                    _this169.apiVersion = Weave.linkableChild(_this169, new LinkableNumber(3, _this169.validateApiVersion));
                    _this169.useHttpPost = Weave.linkableChild(_this169, new LinkableBoolean(false));
                    _this169.showPackages = Weave.linkableChild(_this169, new LinkableBoolean(true));
                    _this169.showGroups = Weave.linkableChild(_this169, new LinkableBoolean(true));
                    _this169.showTags = Weave.linkableChild(_this169, new LinkableBoolean(true));
                    _this169.useDataStore = Weave.linkableChild(_this169, new LinkableBoolean(true));
                    /**
                     * url -> IDataSource
                     */
                    _this169._dataSourceCache = {};
                    return _this169;
                }

                _createClass(CKANDataSource, [{
                    key: "validateApiVersion",
                    value: function validateApiVersion(value) {
                        return [1, 2, 3].indexOf(value) >= 0;
                    }
                    /**
                     * This gets called when callbacks are triggered.
                     */

                }, {
                    key: "initialize",
                    value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        // TODO handle url change
                        _get(CKANDataSource.prototype.__proto__ || Object.getPrototypeOf(CKANDataSource.prototype), "initialize", this).call(this, forceRefresh);
                    }
                }, {
                    key: "refreshHierarchy",
                    value: function refreshHierarchy() {
                        Weave.getCallbacks(this).delayCallbacks();
                        for (var url in this._dataSourceCache) {
                            var ds = this._dataSourceCache[url];
                            ds.hierarchyRefresh.triggerCallbacks();
                        }
                        _get(CKANDataSource.prototype.__proto__ || Object.getPrototypeOf(CKANDataSource.prototype), "refreshHierarchy", this).call(this);
                        Weave.getCallbacks(this).resumeCallbacks();
                    }
                    /**
                     * Gets the root node of the attribute hierarchy.
                     */

                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        if (!Weave.IS(this._rootNode, CKANAction)) this._rootNode = new CKANAction(this);
                        return this._rootNode;
                    }
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (!metadata) return null;
                        var ds = this.getChildDataSource(metadata);
                        if (!ds) return null;
                        var node;
                        if (metadata.ckan_format == CKANDataSource.DATASTORE_FORMAT) {
                            node = new CKANAction(this);
                            node.no_action = CKANAction.GET_COLUMN;
                            node.params = {
                                ckan_id: metadata.ckan_id,
                                ckan_url: metadata.ckan_url,
                                ckan_format: metadata.ckan_format,
                                ckan_field: metadata.ckan_field
                            };
                            return node;
                        }
                        var search = JS.copyObject(metadata);
                        delete search.ckan_id;
                        delete search.ckan_url;
                        delete search.ckan_format;
                        var internalNode = ds.findHierarchyNode(search);
                        if (!internalNode) return null;
                        node = new CKANAction(this);
                        node.action = CKANAction.GET_COLUMN;
                        node.params = {};
                        node.params.ckan_id = metadata.ckan_id;
                        node.params.ckan_url = metadata.ckan_url;
                        node.params.ckan_format = metadata.ckan_format;
                        node.internalNode = internalNode;
                        return node;
                    }
                    /**
                     * @inheritDoc
                     */

                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var metadata = proxyColumn.getProxyMetadata();
                        var dataSource = this.getChildDataSource(metadata);
                        if (dataSource) {
                            if (metadata.ckan_format == CKANDataSource.DATASTORE_FORMAT) metadata = metadata.ckan_field;
                            proxyColumn.setInternalColumn(dataSource.generateNewAttributeColumn(metadata));
                        } else proxyColumn.dataUnavailable();
                    }
                }, {
                    key: "getBaseURL",
                    value: function getBaseURL() {
                        var baseurl = this.url.value || '';
                        var i = baseurl.lastIndexOf('/api');
                        baseurl = baseurl.substr(0, i);
                        if (baseurl.charAt(baseurl.length - 1) != '/') baseurl += '/';
                        return baseurl;
                    }
                }, {
                    key: "getFullURL",
                    value: function getFullURL(relativeURL) {
                        return this.getBaseURL() + relativeURL;
                    }
                    /**
                     * @private
                     */

                }, {
                    key: "getChildDataSource",
                    value: function getChildDataSource(params) {
                        var url = params.ckan_url;
                        if (!url) return null;
                        var dataSource = this._dataSourceCache[url];
                        if (!dataSource) {
                            var format = String(params.ckan_format).toLowerCase();
                            if (format == 'csv') {
                                var csv = new source_2.CSVDataSource();
                                csv.url.value = url;
                                csv.keyType.value = url;
                                dataSource = csv;
                            }
                            //				if (format == 'xls')
                            //				{
                            //					var xls:XLSDataSource = new XLSDataSource();
                            //					xls.url.value = url;
                            //					xls.keyType.value = url;
                            //					dataSource = xls;
                            //				}
                            //				if (format == 'wfs')
                            //				{
                            //					var wfs:WFSDataSource = new WFSDataSource();
                            //					wfs.url.value = url;
                            //					dataSource = wfs;
                            //				}
                            if (format == CKANDataSource.DATASTORE_FORMAT) {
                                var datastore = new source_2.CSVDataSource();
                                datastore.url.value = this.getFullURL('datastore/dump/' + params.ckan_id);
                                var node = new CKANAction(this);
                                node.action = CKANAction.DATASTORE_SEARCH;
                                node.params = { resource_id: params.ckan_id, limit: 1 };
                                node.resultHandler = function (result) {
                                    datastore.metadata.setSessionState(result.fields.map(function (field) {
                                        var type = field.type;
                                        if (type == 'numeric' || type == 'int4' || type == 'int' || type == 'float' || type == 'double') type = DataTypes.NUMBER;
                                        if (type == 'text') type = DataTypes.STRING;
                                        if (type == 'timestamp') type = DataTypes.DATE;
                                        var meta = {};
                                        meta.dataType = type; // TODO fix this type
                                        meta.title = field.id;
                                        meta.csvColumn = field.id;
                                        return meta;
                                    }));
                                };
                                node.result; // will cause resultHandler to be called later
                                dataSource = datastore;
                            }
                        }
                        // cache now if not cached
                        if (dataSource && !this._dataSourceCache[url]) this._dataSourceCache[url] = Weave.linkableChild(this, dataSource);
                        return dataSource;
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return false;
                    }
                }]);

                return CKANDataSource;
            }(source_2.AbstractDataSource);

            CKANDataSource.WEAVE_INFO = Weave.setClassInfo(CKANDataSource, {
                id: "weavejs.data.source.CKANDataSource",
                interfaces: [IDataSource],
                label: "CKAN Server"
            });
            CKANDataSource.PARAMS_CKAN_ID = 'ckan_id';
            CKANDataSource.PARAMS_CKAN_URL = 'ckan_url';
            CKANDataSource.PARAMS_CKAN_FORMAT = 'ckan_format';
            CKANDataSource.PARAMS_CKAN_FIELD = 'ckan_field';
            CKANDataSource.DATASTORE_FORMAT = 'ckan_datastore';
            source_2.CKANDataSource = CKANDataSource;
            var IColumnReference = weavejs.api.data.IColumnReference;
            var IExternalLink = weavejs.api.data.IExternalLink;
            var IWeaveTreeNodeWithPathFinding = weavejs.api.data.IWeaveTreeNodeWithPathFinding;
            var ResponseType = weavejs.net.ResponseType;
            var Servlet = weavejs.net.Servlet;
            var URLRequest = weavejs.net.URLRequest;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var ResquestMethod = weavejs.net.RequestMethod;

            var CKANAction = function () {
                function CKANAction(source) {
                    _classCallCheck(this, CKANAction);

                    this._result = {};
                    /**
                     * This function will be passed the result when it is downloaded.
                     */
                    this.resultHandler = null;
                    this._childNodes = [];
                    this.source = source;
                }
                /**
                 * The result received from the RPC
                 */


                _createClass(CKANAction, [{
                    key: "getURLRequest",
                    value: function getURLRequest() {
                        // append api command to url
                        var request;
                        if (this.apiVersion3) {
                            request = new URLRequest(this.source.getFullURL("api/3/action/" + this.action));
                            if (this.params) {
                                if (this.source.useHttpPost.value) {
                                    request.method = ResquestMethod.POST;
                                    request.requestHeaders = { "Content-Type": "application/json; charset=utf-8" };
                                    request.data = JSON.stringify(this.params);
                                } else {
                                    request.url = Servlet.buildUrlWithParams(request.url, this.params);
                                }
                            }
                        } else {
                            var cmd = 'api/' + this.source.apiVersion.value + '/rest/' + this.action.split('_')[0];
                            if (this.params && this.params.hasOwnProperty('id')) cmd += '/' + this.params.id;
                            request = new URLRequest(this.source.getFullURL(cmd));
                        }
                        request.responseType = ResponseType.JSON;
                        return request;
                    }
                }, {
                    key: "handleResponse",
                    value: function handleResponse(placeholder, response) {
                        // ignore old results
                        if (this._result != placeholder) return;
                        //response = JSON.parse(response as string);
                        if (this.apiVersion3 && response && response.hasOwnProperty('success') && response.success) {
                            this._result = response.result;
                        } else if (!this.apiVersion3 && response) {
                            this._result = response;
                        } else {
                            var error = response && response.hasOwnProperty('error') ? response.error : response;
                            JS.error("CKANaction failed", this, error);
                        }
                        // hack to support DKAN
                        if (this.action == CKANAction.PACKAGE_SHOW && Weave.IS(this._result, Array) && this._result.length == 1) this._result = this._result[0];
                        if (this.resultHandler != null) this.resultHandler(this._result);
                    }
                }, {
                    key: "equals",
                    value: function equals(other) {
                        var that = Weave.AS(other, CKANAction);
                        if (!that) return false;
                        if (this.internalNode && that.internalNode) return this.source && that.source && this.internalNode.equals(that.internalNode);
                        return !this.internalNode == !that.internalNode && this.source == that.source && this.action == that.action && StandardLib.compare(this.params, that.params) == 0;
                    }
                }, {
                    key: "getLabel",
                    value: function getLabel() {
                        if (this.internalNode) return this.internalNode.getLabel();
                        if (!this.action) return this.source.getLabel();
                        if (this.action == CKANAction.PACKAGE_LIST) return Weave.lang("Packages");
                        if (this.action == CKANAction.GROUP_LIST) return Weave.lang("Groups");
                        if (this.action == CKANAction.TAG_LIST) return Weave.lang("Tags");
                        if (this.action == CKANAction.PACKAGE_SHOW || this.action == CKANAction.GROUP_SHOW || this.action == CKANAction.GROUP_PACKAGE_SHOW || this.action == CKANAction.TAG_SHOW) return this.metadata.display_name || this.metadata.name || this.metadata.title || this.metadata.description || this.metadata.url || (Weave.IS(this.result, String) ? this.result : this.result.title || this.result.display_name || this.result.name) || this.params.id;
                        if (this.action == CKANAction.GET_DATASOURCE || this.action == CKANAction.DATASTORE_SEARCH) {
                            var str = this.metadata.name || this.metadata.title || this.metadata.description || this.metadata.url || this.metadata.id;
                            // hack to support DKAN
                            if (!this.metadata.format && this.metadata.mimetype == 'text/csv') this.metadata.format = 'csv';
                            // also display the format
                            if (this.metadata.format) str = StandardLib.substitute("{0} ({1})", str, this.metadata.format);
                            return str;
                        }
                        if (this.action == CKANAction.GET_COLUMN) return this.params.ckan_field;
                        return this.toString();
                    }
                }, {
                    key: "isBranch",
                    value: function isBranch() {
                        if (this.internalNode) return this.internalNode.isBranch();
                        if (this.action == CKANAction.GET_DATASOURCE || this.action == CKANAction.DATASTORE_SEARCH) return true;
                        return this.action != CKANAction.NO_ACTION && this.action != CKANAction.GET_COLUMN;
                    }
                }, {
                    key: "hasChildBranches",
                    value: function hasChildBranches() {
                        if (this.internalNode) return this.internalNode.hasChildBranches();
                        if (this.action == CKANAction.PACKAGE_SHOW || this.action == CKANAction.GROUP_PACKAGE_SHOW) return this.getChildren().length > 0;
                        if (this.action == CKANAction.GROUP_SHOW || this.action == CKANAction.TAG_SHOW) {
                            var metapkg = this.metadata.packages;
                            if (Weave.IS(metapkg, Number)) return Number(metapkg) > 0;
                            if (Weave.IS(metapkg, Array)) return Weave.AS(metapkg, Array).length > 0;
                            return this.getChildren().length > 0;
                        }
                        return this.action != CKANAction.GET_DATASOURCE && this.action != CKANAction.DATASTORE_SEARCH && this.action != CKANAction.NO_ACTION;
                    }
                    /**
                     * @param input The input metadata items for generating child nodes
                     * @param child Action The action property of the child nodes
                     * @param updater A function like function(node:CKANAction, item:Object):void which receives the child node and its corresponding input metadata item.
                     * @return The updated _childNodes Array.
                     */

                }, {
                    key: "updateChildren",
                    value: function updateChildren(input) {
                        var updater = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                        var nodeType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

                        if (!nodeType) nodeType = CKANAction;
                        var outputIndex = 0;
                        var _iteratorNormalCompletion118 = true;
                        var _didIteratorError118 = false;
                        var _iteratorError118 = undefined;

                        try {
                            for (var _iterator118 = (input || [])[Symbol.iterator](), _step118; !(_iteratorNormalCompletion118 = (_step118 = _iterator118.next()).done); _iteratorNormalCompletion118 = true) {
                                var item = _step118.value;

                                var node = this._childNodes[outputIndex];
                                if (!node || Object(node).constructor != nodeType) this._childNodes[outputIndex] = node = new nodeType(source);
                                var oldAction = node.action;
                                var oldParams = node.params;
                                updater(node, item);
                                // if something changed, clear the previous result
                                if (oldAction != node.action || StandardLib.compare(oldParams, node.params)) node._result = null;
                                outputIndex++;
                            }
                        } catch (err) {
                            _didIteratorError118 = true;
                            _iteratorError118 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion118 && _iterator118.return) {
                                    _iterator118.return();
                                }
                            } finally {
                                if (_didIteratorError118) {
                                    throw _iteratorError118;
                                }
                            }
                        }

                        this._childNodes.length = outputIndex;
                        return this._childNodes;
                    }
                }, {
                    key: "getChildren",
                    value: function getChildren() {
                        var _this170 = this;

                        if (this.internalNode) return this.internalNode.getChildren();
                        if (!this.action) {
                            var list = [];
                            if (this.source.showPackages.value) list.push([CKANAction.PACKAGE_LIST, null]);
                            if (this.source.showGroups.value) list.push([CKANAction.GROUP_LIST, { "all_fields": true }]);
                            if (this.source.showTags.value) list.push([CKANAction.TAG_LIST, { "all_fields": true }]);
                            return this.updateChildren(list, function (node, actionAndParams) {
                                node.action = actionAndParams[0];
                                node.params = actionAndParams[1];
                                node.metadata = null;
                            });
                        }
                        // handle all situations where result is just an array of IDs
                        if (StandardLib.getArrayType(Weave.AS(this.result, Array)) == String) return this.updateChildren(Weave.AS(this.result, Array), function (node, id) {
                            if (_this170.action == CKANAction.PACKAGE_LIST || _this170.action == CKANAction.TAG_SHOW) node.action = CKANAction.PACKAGE_SHOW;
                            if (_this170.action == CKANAction.GROUP_LIST) node.action = CKANAction.GROUP_PACKAGE_SHOW;
                            if (_this170.action == CKANAction.TAG_LIST) node.action = CKANAction.TAG_SHOW;
                            node.metadata = node.params = { id: id };
                        });
                        if (this.action == CKANAction.GROUP_LIST || this.action == CKANAction.TAG_LIST) return this.updateChildren(Weave.AS(this.result, Array), function (node, meta) {
                            if (_this170.action == CKANAction.GROUP_LIST) node.action = CKANAction.GROUP_PACKAGE_SHOW;
                            if (_this170.action == CKANAction.TAG_LIST) node.action = CKANAction.TAG_SHOW;
                            node.metadata = meta;
                            // hack to support DKAN
                            if (!meta.id && meta.uuid) meta.id = meta.uuid;
                            node.params = { "id": meta.id };
                        });
                        if (this.result && (this.action == CKANAction.GROUP_SHOW || this.action == CKANAction.GROUP_PACKAGE_SHOW || this.action == CKANAction.TAG_SHOW)) return this.updateChildren(Weave.AS(this.result, Array) || this.result.packages, function (node, pkg) {
                            if (Weave.IS(pkg, String)) pkg = { "id": pkg };
                            node.action = CKANAction.PACKAGE_SHOW;
                            node.metadata = pkg;
                            node.params = { "id": pkg.id };
                        });
                        if (this.action == CKANAction.PACKAGE_SHOW && this.result.hasOwnProperty('resources')) {
                            return this.updateChildren(this.result.resources, function (node, resource) {
                                if (_this170.source.useDataStore.value && resource.datastore_active) {
                                    node.action = CKANAction.DATASTORE_SEARCH;
                                    node.metadata = resource;
                                    node.params = {
                                        resource_id: resource.id,
                                        limit: 1
                                    };
                                } else {
                                    node.action = CKANAction.GET_DATASOURCE;
                                    node.metadata = resource;
                                    node.params = {};
                                    node.params.ckan_id = resource.id;
                                    node.params.ckan_url = resource.url;
                                    node.params.ckan_format = resource.format;
                                }
                            });
                        }
                        if (this.action == CKANAction.DATASTORE_SEARCH) {
                            return this.updateChildren(this.result.fields, function (node, field) {
                                node.action = CKANAction.GET_COLUMN;
                                node.metadata = field;
                                node.params = {};
                                node.params.ckan_id = _this170.metadata.id;
                                node.params.ckan_url = CKANDataSource.DATASTORE_FORMAT + "://" + _this170.metadata.id;
                                node.params.ckan_format = CKANDataSource.DATASTORE_FORMAT;
                                node.params.ckan_field = field.id;
                            });
                        }
                        if (this.action == CKANAction.GET_DATASOURCE) {
                            var ds = this.source.getChildDataSource(this.params);
                            if (ds) {
                                var root = ds.getHierarchyRoot();
                                return this.updateChildren(root.getChildren(), function (node, otherNode) {
                                    node.action = CKANAction.GET_COLUMN;
                                    node.internalNode = otherNode;
                                    node.params = _this170.params; // copy params from parent
                                });
                            } else {
                                var keys = JS.objectKeys(this.metadata);
                                keys = keys.filter(function (key) {
                                    return _this170.metadata[key] != null && _this170.metadata[key] != '';
                                });
                                keys.sort(this.keyCompare);
                                return this.updateChildren(keys, function (node, key) {
                                    node.metadata = _this170.metadata;
                                    node.params = key;
                                }, MetadataNode);
                            }
                        }
                        this._childNodes.length = 0;
                        return this._childNodes;
                    }
                }, {
                    key: "keyCompare",
                    value: function keyCompare(a, b) {
                        var order = CKANAction._KEY_ORDER;
                        var ia = order.indexOf(a);
                        var ib = order.indexOf(b);
                        if (ia >= 0 && ib >= 0) return StandardLib.numericCompare(ia, ib);
                        if (ia >= 0) return -1;
                        if (ib >= 0) return 1;
                        return StandardLib.stringCompare(a, b, true);
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        return this.source;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        if (Weave.IS(this.internalNode, IColumnReference)) {
                            var meta = this.internalNode.getColumnMetadata();
                            meta.ckan_id = this.params.ckan_id;
                            meta.ckan_format = this.params.ckan_format;
                            meta.ckan_url = this.params.ckan_url;
                            return meta;
                        }
                        if (this.action == CKANAction.GET_COLUMN) return JS.copyObject(this.params);
                        return null;
                    }
                }, {
                    key: "findPathToNode",
                    value: function findPathToNode(descendant) {
                        if (!descendant) return null;
                        if (this.equals(descendant)) return [this];
                        // search cached children only
                        var _iteratorNormalCompletion119 = true;
                        var _didIteratorError119 = false;
                        var _iteratorError119 = undefined;

                        try {
                            for (var _iterator119 = (this._childNodes || [])[Symbol.iterator](), _step119; !(_iteratorNormalCompletion119 = (_step119 = _iterator119.next()).done); _iteratorNormalCompletion119 = true) {
                                var child = _step119.value;

                                var path = child.findPathToNode(descendant);
                                if (path) {
                                    path.unshift(this);
                                    return path;
                                }
                            }
                        } catch (err) {
                            _didIteratorError119 = true;
                            _iteratorError119 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion119 && _iterator119.return) {
                                    _iterator119.return();
                                }
                            } finally {
                                if (_didIteratorError119) {
                                    throw _iteratorError119;
                                }
                            }
                        }

                        return null;
                    }
                }, {
                    key: "toString",
                    value: function toString() {
                        if (!this.action && !this.params) return Weave.stringify(this.metadata);
                        return Weave.stringify({ "action": this.action, "params": this.params });
                    }
                }, {
                    key: "result",
                    get: function get() {
                        if (Weave.detectChange(this, this.source.url, this.source.apiVersion, this.source.useHttpPost)) {
                            if ([CKANAction.PACKAGE_LIST, CKANAction.PACKAGE_SHOW, CKANAction.GROUP_LIST, CKANAction.GROUP_SHOW, CKANAction.GROUP_PACKAGE_SHOW, CKANAction.TAG_LIST, CKANAction.TAG_SHOW, CKANAction.DATASTORE_SEARCH].indexOf(this.action) >= 0) {
                                // make CKAN API request
                                this._result = {};
                                var handler = this.handleResponse.bind(this, this._result);
                                WeaveAPI.URLRequestUtils.request(source, this.getURLRequest()).then(handler, handler);
                            }
                        }
                        return this._result || {};
                    }
                }, {
                    key: "apiVersion3",
                    get: function get() {
                        return this.source.apiVersion.value == 3;
                    }
                }]);

                return CKANAction;
            }();

            CKANAction.WEAVE_INFO = Weave.setClassInfo(CKANAction, {
                id: "weavejs.data.source.CKANAction",
                interfaces: [IWeaveTreeNode, IColumnReference, IWeaveTreeNodeWithPathFinding]
            });
            CKANAction.PACKAGE_LIST = 'package_list';
            CKANAction.PACKAGE_SHOW = 'package_show';
            CKANAction.GROUP_LIST = 'group_list';
            CKANAction.GROUP_SHOW = 'group_show';
            CKANAction.GROUP_PACKAGE_SHOW = 'group_package_show';
            CKANAction.TAG_LIST = 'tag_list';
            CKANAction.TAG_SHOW = 'tag_show';
            CKANAction.DATASTORE_SEARCH = 'datastore_search';
            CKANAction.GET_DATASOURCE = 'get_datasource';
            CKANAction.GET_COLUMN = 'get_column';
            CKANAction.NO_ACTION = 'no_action';
            CKANAction._KEY_ORDER = ['title', 'display_name', 'name', 'description', 'format', 'resource_type', 'mimetype', 'url', 'url_type', 'created', 'publish-date', 'last_modified', 'revision_timestamp'];
            /**
             * No CKANAction is associated with this type of node.
             * Uses the 'params' property as a key for the 'metadata' object.
             */

            var MetadataNode = function (_CKANAction) {
                _inherits(MetadataNode, _CKANAction);

                function MetadataNode(source) {
                    _classCallCheck(this, MetadataNode);

                    var _this171 = _possibleConstructorReturn(this, (MetadataNode.__proto__ || Object.getPrototypeOf(MetadataNode)).call(this, source));

                    _this171.action = CKANAction.NO_ACTION;
                    return _this171;
                }

                _createClass(MetadataNode, [{
                    key: "getURL",
                    value: function getURL() {
                        return this.params == 'url' ? this.metadata.url : null;
                    }
                }, {
                    key: "toString",
                    value: function toString() {
                        return Weave.lang("{0}: {1}", this.params, Weave.stringify(this.metadata[this.params]));
                    }
                }]);

                return MetadataNode;
            }(CKANAction);

            MetadataNode.WEAVE_INFO = Weave.setClassInfo(MetadataNode, {
                id: "weavejs.data.source.MetadataNode",
                interfaces: [IWeaveTreeNode, IColumnReference, IWeaveTreeNodeWithPathFinding, IExternalLink]
            });
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source) {
            var IDataSource = weavejs.api.data.IDataSource;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;

            var CachedDataSource = function (_source$AbstractDataS) {
                _inherits(CachedDataSource, _source$AbstractDataS);

                function CachedDataSource() {
                    var _ref14;

                    _classCallCheck(this, CachedDataSource);

                    for (var _len10 = arguments.length, args = Array(_len10), _key11 = 0; _key11 < _len10; _key11++) {
                        args[_key11] = arguments[_key11];
                    }

                    var _this172 = _possibleConstructorReturn(this, (_ref14 = CachedDataSource.__proto__ || Object.getPrototypeOf(CachedDataSource)).call.apply(_ref14, [this].concat(args)));

                    _this172.type = Weave.linkableChild(_this172, LinkableString);
                    _this172.state = Weave.linkableChild(_this172, LinkableVariable);
                    return _this172;
                }
                /* override */

                _createClass(CachedDataSource, [{
                    key: "refreshHierarchy",

                    /* override */value: function refreshHierarchy() {
                        var root = Weave.getRoot(this);
                        var names = root.getNames();
                        var name = root.getName(this);
                        var classDef = Weave.getDefinition(this.type.value);
                        var state = this.state.state;
                        var dataSource = root.requestObject(name, classDef, false);
                        Weave.setState(dataSource, state);
                        root.setNameOrder(names);
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return true;
                    }
                }]);

                return CachedDataSource;
            }(source.AbstractDataSource);

            CachedDataSource.WEAVE_INFO = Weave.setClassInfo(CachedDataSource, {
                id: "weavejs.data.source.CachedDataSource",
                label: "Cached Data Source",
                interfaces: [IDataSource]
            });
            source.CachedDataSource = CachedDataSource;
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var Aggregation = weavejs.api.data.Aggregation;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IBaseColumn = weavejs.api.data.IBaseColumn;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
            var IQualifiedKey = weavejs.api.data.IQualifiedKey;
            var Dictionary2D = weavejs.util.Dictionary2D;
            var StandardLib = weavejs.util.StandardLib;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var JS = weavejs.util.JS;
            /**
             * @author adufilie
             */
            var NumberColumn_1 = void 0;
            var NumberColumn = NumberColumn_1 = function (_column$AbstractAttri7) {
                _inherits(NumberColumn, _column$AbstractAttri7);

                function NumberColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, NumberColumn);

                    var _this173 = _possibleConstructorReturn(this, (NumberColumn.__proto__ || Object.getPrototypeOf(NumberColumn)).call(this, metadata));

                    _this173.numberToStringFunction = null;
                    _this173.dataTask = new column.ColumnDataTask(_this173, isFinite, function () {
                        return _this173.asyncComplete();
                    });
                    _this173.dataCache = new Dictionary2D();
                    return _this173;
                }
                /* override */

                _createClass(NumberColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (propertyName == ColumnMetadata.DATA_TYPE) return DataTypes.NUMBER;
                        return _get(NumberColumn.prototype.__proto__ || Object.getPrototypeOf(NumberColumn.prototype), "getMetadata", this).call(this, propertyName);
                    }
                }, {
                    key: "setRecords",
                    value: function setRecords(keys, numericData) {
                        var _this174 = this;

                        this.dataTask.begin(keys, numericData);
                        this.numberToStringFunction = null;
                        // compile the string format function from the metadata
                        var stringFormat = this.getMetadata(ColumnMetadata.STRING);
                        if (stringFormat) {
                            try {
                                this.numberToStringFunction = JS.compile(stringFormat, [ColumnMetadata.NUMBER, 'array'], function (e) {
                                    return _this174.errorHandler(e);
                                });
                            } catch (e) {
                                this.errorHandler(e);
                            }
                        }
                    }
                }, {
                    key: "asyncComplete",
                    value: function asyncComplete() {
                        // cache needs to be cleared after async task completes because some values may have been cached while the task was busy
                        this.dataCache.map.clear();
                        this.triggerCallbacks();
                    }
                }, {
                    key: "errorHandler",
                    value: function errorHandler(e) {
                        var str = Weave.IS(e, Error) ? e.message : String(e);
                        str = StandardLib.substitute("Error in script for attribute column {0}:\n{1}", Weave.stringify(this._metadata), str);
                        if (this._lastError != str) {
                            this._lastError = str;
                            console.error(e);
                        }
                    }
                    /**
                     * Get a string value for a given number.
                     */

                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(number) {
                        if (this.numberToStringFunction != null) return StandardLib.asString(this.numberToStringFunction(number, [number]));
                        return StandardLib.formatNumber(number);
                    }
                    /* override */
                }, {
                    key: "generateValue",
                    value: function generateValue(key, dataType) {
                        var array = this.dataTask.map_key_arrayData.get(key);
                        if (dataType === Number) return NumberColumn_1.aggregate(array, this._metadata ? this._metadata[ColumnMetadata.AGGREGATION] : null);
                        if (dataType === String) {
                            var number = this.getValueFromKey(key, Number);
                            if (this.numberToStringFunction != null) {
                                return StandardLib.asString(this.numberToStringFunction(number, array));
                            }
                            if (isNaN(number) && array && array.length > 1) {
                                var aggregation = this._metadata && Weave.AS(this._metadata[ColumnMetadata.AGGREGATION], String) || Aggregation.DEFAULT;
                                if (aggregation == Aggregation.SAME) return Weave.lang(Aggregation.AMBIGUOUS_DATA);
                            }
                            return StandardLib.formatNumber(number);
                        }
                        if (dataType === IQualifiedKey) return WeaveAPI.QKeyManager.getQKey(DataTypes.NUMBER, this.getValueFromKey(key, Number));
                        return null;
                    }
                    /**
                     * Aggregates an Array of Numbers into a single Number.
                     * @param numbers An Array of Numbers.
                     * @param aggregation One of the constants in weave.api.data.Aggregation.
                     * @return An aggregated Number.
                     * @see weave.api.data.Aggregation
                     */

                }], [{
                    key: "aggregate",
                    value: function aggregate(numbers, aggregation) {
                        if (!numbers) return NaN;
                        if (!aggregation) aggregation = Aggregation.DEFAULT;
                        switch (aggregation) {
                            case Aggregation.SAME:
                                var first = numbers[0];
                                var _iteratorNormalCompletion120 = true;
                                var _didIteratorError120 = false;
                                var _iteratorError120 = undefined;

                                try {
                                    for (var _iterator120 = (numbers || [])[Symbol.iterator](), _step120; !(_iteratorNormalCompletion120 = (_step120 = _iterator120.next()).done); _iteratorNormalCompletion120 = true) {
                                        var value = _step120.value;

                                        if (value != first) return NaN;
                                    }
                                } catch (err) {
                                    _didIteratorError120 = true;
                                    _iteratorError120 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion120 && _iterator120.return) {
                                            _iterator120.return();
                                        }
                                    } finally {
                                        if (_didIteratorError120) {
                                            throw _iteratorError120;
                                        }
                                    }
                                }

                                return first;
                            case Aggregation.FIRST:
                                return numbers[0];
                            case Aggregation.LAST:
                                return numbers[numbers.length - 1];
                            case Aggregation.COUNT:
                                return numbers.length;
                            case Aggregation.MEAN:
                                return StandardLib.mean(numbers);
                            case Aggregation.SUM:
                                return StandardLib.sum(numbers);
                            case Aggregation.MIN:
                                return Math.min.apply(null, numbers);
                            case Aggregation.MAX:
                                return Math.max.apply(null, numbers);
                            default:
                                return NaN;
                        }
                    }
                }]);

                return NumberColumn;
            }(column.AbstractAttributeColumn);
            NumberColumn = NumberColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.NumberColumn", interfaces: [IPrimitiveColumn, IBaseColumn, ICallbackCollection, IAttributeColumn] })], NumberColumn);
            column.NumberColumn = NumberColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_6) {
        var source;
        (function (source) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IDataSource = weavejs.api.data.IDataSource;
            var AbstractDataSource = weavejs.data.source.AbstractDataSource;
            var LinkableFile = weavejs.core.LinkableFile;
            var LinkableString = weavejs.core.LinkableString;
            var GeometryColumn = weavejs.data.column.GeometryColumn;
            var NumberColumn = weavejs.data.column.NumberColumn;
            var StringColumn = weavejs.data.column.StringColumn;
            var GeneralizedGeometry = weavejs.geom.GeneralizedGeometry;
            var GeoJSON = weavejs.geom.GeoJSON;
            var ResponseType = weavejs.net.ResponseType;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var JS = weavejs.util.JS;
            var GeoJSONDataSource_1 = void 0;
            var GeoJSONDataSource = GeoJSONDataSource_1 = function (_AbstractDataSource) {
                _inherits(GeoJSONDataSource, _AbstractDataSource);

                function GeoJSONDataSource() {
                    var _ref15;

                    _classCallCheck(this, GeoJSONDataSource);

                    for (var _len11 = arguments.length, args = Array(_len11), _key12 = 0; _key12 < _len11; _key12++) {
                        args[_key12] = arguments[_key12];
                    }

                    var _this175 = _possibleConstructorReturn(this, (_ref15 = GeoJSONDataSource.__proto__ || Object.getPrototypeOf(GeoJSONDataSource)).call.apply(_ref15, [this].concat(args)));

                    _this175.url = Weave.linkableChild(_this175, new LinkableFile(null, null, ResponseType.JSON), _this175.handleFile);
                    _this175.keyType = Weave.linkableChild(_this175, LinkableString);
                    _this175.keyProperty = Weave.linkableChild(_this175, LinkableString);
                    /**
                     * overrides the projection specified in the GeoJSON object.
                     */
                    _this175.projection = Weave.linkableChild(_this175, LinkableString);
                    /**
                     * The GeoJSON data.
                     */
                    _this175.jsonData = null;
                    _this175.initializeObserver = {};
                    return _this175;
                }
                /*override*/

                _createClass(GeoJSONDataSource, [{
                    key: "getLabel",

                    /*override*/value: function getLabel() {
                        return this.label.value || (this.url.value || '').split('/').pop() || _get(GeoJSONDataSource.prototype.__proto__ || Object.getPrototypeOf(GeoJSONDataSource.prototype), "getLabel", this).call(this);
                    }
                    /**
                     * Gets the projection metadata used in the geometry column.
                     */

                }, {
                    key: "getProjection",
                    value: function getProjection() {
                        return this.projection.value || (this.jsonData ? this.jsonData.projection : null) || "EPSG:4326";
                    }
                    /**
                     * Gets the keyType metadata used in the columns.
                     */

                }, {
                    key: "getPropertyNames",
                    value: function getPropertyNames() {
                        return this.jsonData && this.jsonData.propertyNames ? [].concat(this.jsonData.propertyNames) : [];
                    }
                }, {
                    key: "getKeyType",
                    value: function getKeyType() {
                        var kt = this.keyType.value;
                        if (!kt) {
                            kt = this.url.value;
                            if (this.keyProperty.value) kt += "#" + this.keyProperty.value;
                        }
                        return kt;
                    }
                    /*override*/
                }, {
                    key: "initialize",

                    /**
                     * This gets called as a grouped callback.
                     */
                    /*override*/value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        this._rootNode = null;
                        if (Weave.detectChange(this.initializeObserver, this.keyType, this.keyProperty)) {
                            if (this.jsonData) this.jsonData.resetQKeys(this.getKeyType(), this.keyProperty.value);
                        }
                        // recalculate all columns previously requested because data may have changed.
                        _get(GeoJSONDataSource.prototype.__proto__ || Object.getPrototypeOf(GeoJSONDataSource.prototype), "initialize", this).call(this, true);
                    }
                }, {
                    key: "handleFile",
                    value: function handleFile() {
                        if (Weave.isBusy(this.url)) return;
                        this.jsonData = null;
                        if (!this.url.result) {
                            this.hierarchyRefresh.triggerCallbacks();
                            if (this.url.error) JS.error(this.url.error);
                            return;
                        }
                        try {
                            var obj = this.url.result;
                            // make sure it's valid GeoJSON
                            if (!GeoJSON.isGeoJSONObject(obj)) throw new Error("Invalid GeoJSON file: " + this.url.value);
                            // parse data
                            this.jsonData = new source.GeoJSONDataSourceData(obj, this.getKeyType(), this.keyProperty.value);
                            this.hierarchyRefresh.triggerCallbacks();
                        } catch (e) {
                            JS.error(e);
                        }
                    }
                    /**
                     * Gets the root node of the attribute hierarchy.
                     */
                    /*override*/
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        var _this176 = this;

                        if (!Weave.IS(this._rootNode, source.GeoJSONDataSourceNode)) {
                            var meta = {};
                            meta.title = this.getLabel();
                            var rootChildren = [];
                            if (this.jsonData) {
                                // include empty string for the geometry column
                                rootChildren = [''].concat(this.jsonData.propertyNames).map(function (n, i, a) {
                                    return _this176.generateHierarchyNode(n);
                                }).filter(function (n, i, a) {
                                    return n != null;
                                });
                            }
                            this._rootNode = new source.GeoJSONDataSourceNode(this, meta, rootChildren);
                        }
                        return this._rootNode;
                    }
                    /*override*/
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (metadata == null || !this.jsonData) return null;
                        if (Weave.IS(metadata, String)) {
                            var str = metadata;
                            metadata = {};
                            metadata[GeoJSONDataSource_1.GEOJSON_PROPERTY_NAME] = str;
                        }
                        if (metadata && metadata.hasOwnProperty(GeoJSONDataSource_1.GEOJSON_PROPERTY_NAME)) {
                            metadata = this.getMetadataForProperty(metadata[GeoJSONDataSource_1.GEOJSON_PROPERTY_NAME]);
                            return new source.GeoJSONDataSourceNode(this, metadata, null, [GeoJSONDataSource_1.GEOJSON_PROPERTY_NAME]);
                        }
                        return null;
                    }
                    /*override*/
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var _this177 = this;

                        var propertyName = proxyColumn.getMetadata(GeoJSONDataSource_1.GEOJSON_PROPERTY_NAME);
                        var metadata = this.getMetadataForProperty(propertyName);
                        if (!metadata || !this.jsonData || propertyName && this.jsonData.propertyNames.indexOf(propertyName) < 0) {
                            proxyColumn.dataUnavailable();
                            return;
                        }
                        proxyColumn.setMetadata(metadata);
                        var dataType = metadata[ColumnMetadata.DATA_TYPE];
                        if (dataType == DataTypes.GEOMETRY) {
                            var qkeys = [];
                            var geoms = [];
                            var i = 0;
                            var initGeoms = function initGeoms(stopTime) {
                                if (!_this177.jsonData) {
                                    proxyColumn.dataUnavailable();
                                    return 1;
                                }
                                for (; i < _this177.jsonData.qkeys.length; i++) {
                                    if (Date.now() > stopTime) return i / _this177.jsonData.qkeys.length;
                                    var geomsFromJson = GeneralizedGeometry.fromGeoJson(_this177.jsonData.geometries[i]);
                                    var _iteratorNormalCompletion121 = true;
                                    var _didIteratorError121 = false;
                                    var _iteratorError121 = undefined;

                                    try {
                                        for (var _iterator121 = geomsFromJson[Symbol.iterator](), _step121; !(_iteratorNormalCompletion121 = (_step121 = _iterator121.next()).done); _iteratorNormalCompletion121 = true) {
                                            var geom = _step121.value;

                                            qkeys.push(_this177.jsonData.qkeys[i]);
                                            geoms.push(geom);
                                        }
                                    } catch (err) {
                                        _didIteratorError121 = true;
                                        _iteratorError121 = err;
                                    } finally {
                                        try {
                                            if (!_iteratorNormalCompletion121 && _iterator121.return) {
                                                _iterator121.return();
                                            }
                                        } finally {
                                            if (_didIteratorError121) {
                                                throw _iteratorError121;
                                            }
                                        }
                                    }
                                }
                                return 1;
                            };
                            var setGeoms = function setGeoms() {
                                var gc = new GeometryColumn(metadata);
                                gc.setRecords(qkeys, geoms);
                                proxyColumn.setInternalColumn(gc);
                            };
                            // high priority because not much can be done without data
                            WeaveAPI.Scheduler.startTask(proxyColumn, initGeoms, WeaveAPI.TASK_PRIORITY_HIGH, setGeoms);
                        } else {
                            var data = ArrayUtils.pluck(this.jsonData.properties, propertyName);
                            var type = this.jsonData.propertyTypes[propertyName];
                            if (type == 'number') {
                                var nc = new NumberColumn(metadata);
                                nc.setRecords(this.jsonData.qkeys, data);
                                proxyColumn.setInternalColumn(nc);
                            } else {
                                var sc = new StringColumn(metadata);
                                sc.setRecords(this.jsonData.qkeys, data);
                                proxyColumn.setInternalColumn(sc);
                            }
                        }
                    }
                }, {
                    key: "getMetadataForProperty",
                    value: function getMetadataForProperty(propertyName) {
                        if (!this.jsonData) return null;
                        var meta = null;
                        if (!propertyName) {
                            meta = {};
                            meta[GeoJSONDataSource_1.GEOJSON_PROPERTY_NAME] = '';
                            meta[ColumnMetadata.TITLE] = this.getGeomColumnTitle();
                            meta[ColumnMetadata.KEY_TYPE] = this.getKeyType();
                            meta[ColumnMetadata.DATA_TYPE] = DataTypes.GEOMETRY;
                            meta[ColumnMetadata.PROJECTION] = this.getProjection();
                        } else if (this.jsonData.propertyNames.indexOf(propertyName) >= 0) {
                            meta = {};
                            meta[GeoJSONDataSource_1.GEOJSON_PROPERTY_NAME] = propertyName;
                            meta[ColumnMetadata.TITLE] = propertyName;
                            meta[ColumnMetadata.KEY_TYPE] = this.getKeyType();
                            if (propertyName == this.keyProperty.value) meta[ColumnMetadata.DATA_TYPE] = this.getKeyType();else meta[ColumnMetadata.DATA_TYPE] = this.jsonData.propertyTypes[propertyName];
                        }
                        return meta;
                    }
                }, {
                    key: "getGeomColumnTitle",
                    value: function getGeomColumnTitle() {
                        return Weave.lang("{0} geometry", this.getLabel());
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return this.url.isLocal;
                    }
                }, {
                    key: "initializationComplete",
                    get: function get() {
                        return _get(GeoJSONDataSource.prototype.__proto__ || Object.getPrototypeOf(GeoJSONDataSource.prototype), "initializationComplete", this) && !Weave.isBusy(this.url) && !!this.jsonData;
                    }
                }]);

                return GeoJSONDataSource;
            }(AbstractDataSource);
            GeoJSONDataSource.GEOJSON_PROPERTY_NAME = 'geoJsonPropertyName';
            GeoJSONDataSource = GeoJSONDataSource_1 = __decorate([Weave.classInfo({ id: "weavejs.data.source.GeoJSONDataSource", label: "GeoJSON file", interfaces: [IDataSource] })], GeoJSONDataSource);
            source.GeoJSONDataSource = GeoJSONDataSource;
        })(source = data_6.source || (data_6.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var column;
        (function (column) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var DateFormat = weavejs.api.data.DateFormat;
            var IBaseColumn = weavejs.api.data.IBaseColumn;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
            var DateUtils = weavejs.util.DateUtils;
            var StandardLib = weavejs.util.StandardLib;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var JS = weavejs.util.JS;
            var ICallbackCollection = weavejs.api.core.ICallbackCollection;
            /**
             * @author adufilie
             */
            var DateColumn_1 = void 0;
            var DateColumn = DateColumn_1 = function (_column$AbstractAttri8) {
                _inherits(DateColumn, _column$AbstractAttri8);

                function DateColumn() {
                    var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

                    _classCallCheck(this, DateColumn);

                    var _this178 = _possibleConstructorReturn(this, (DateColumn.__proto__ || Object.getPrototypeOf(DateColumn)).call(this, metadata));

                    _this178._uniqueKeys = [];
                    _this178.map_key_data = new Map();
                    // variables that do not get reset after async task
                    _this178._stringToNumberFunction = null;
                    _this178._numberToStringFunction = null;
                    _this178._dateFormat = null;
                    _this178._dateDisplayFormat = null;
                    _this178._durationMode = false;
                    _this178._fakeData = false;
                    return _this178;
                }
                /* override */

                _createClass(DateColumn, [{
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        if (propertyName == ColumnMetadata.DATA_TYPE) return DataTypes.DATE;
                        if (propertyName == ColumnMetadata.DATE_FORMAT) return this._dateFormat || _get(DateColumn.prototype.__proto__ || Object.getPrototypeOf(DateColumn.prototype), "getMetadata", this).call(this, propertyName);
                        return _get(DateColumn.prototype.__proto__ || Object.getPrototypeOf(DateColumn.prototype), "getMetadata", this).call(this, propertyName);
                    }
                    /* override */
                }, {
                    key: "containsKey",

                    /* override */value: function containsKey(key) {
                        return this.map_key_data.has(key);
                    }
                }, {
                    key: "setRecords",
                    value: function setRecords(qkeys, dates) {
                        if (this.keys.length > dates.length) {
                            console.error("Array lengths differ");
                            return;
                        }
                        this._fakeData = !!this.getMetadata("fakeData");
                        // read dateFormat metadata
                        this._dateFormat = this.getMetadata(ColumnMetadata.DATE_FORMAT);
                        if (!this._dateFormat) {
                            var possibleFormats = DateColumn_1.detectDateFormats(dates);
                            StandardLib.sortOn(possibleFormats, 'length');
                            this._dateFormat = possibleFormats.pop();
                        }
                        this._dateFormat = DateFormat.convertDateFormat_c_to_moment(this._dateFormat);
                        // read dateDisplayFormat metadata
                        this._dateDisplayFormat = this.getMetadata(ColumnMetadata.DATE_DISPLAY_FORMAT);
                        if (this._dateDisplayFormat) {
                            this._dateDisplayFormat = DateFormat.convertDateFormat_c_to_moment(this._dateDisplayFormat);
                        }
                        // compile the number format function from the metadata
                        this._stringToNumberFunction = null;
                        var numberFormat = this.getMetadata(ColumnMetadata.NUMBER);
                        if (numberFormat) {
                            try {
                                this._stringToNumberFunction = JS.compile(numberFormat, [ColumnMetadata.STRING]);
                            } catch (e) {
                                console.error(e);
                            }
                        }
                        // compile the string format function from the metadata
                        this._numberToStringFunction = null;
                        var stringFormat = this.getMetadata(ColumnMetadata.STRING);
                        if (stringFormat) {
                            try {
                                this._numberToStringFunction = JS.compile(stringFormat, [ColumnMetadata.NUMBER]);
                            } catch (e) {
                                console.error(e);
                            }
                        }
                        this._i = 0;
                        this._keys = qkeys;
                        this._dates = dates;
                        this.map_key_data = new Map();
                        this._uniqueKeys.length = 0;
                        this._reportedError = false;
                        /*if (!_dateFormat && _keys.length)
                        {
                            _reportedError = true;
                            JS.error(lang('No common date format could be determined from the column values. Attribute Column: {0}', Compiler.stringify(_metadata)));
                        }*/
                        // high priority because not much can be done without data
                        WeaveAPI.Scheduler.startTask(this, this._asyncIterate, WeaveAPI.TASK_PRIORITY_HIGH, this._asyncComplete);
                    }
                }, {
                    key: "errorHandler",
                    value: function errorHandler(e) {
                        return; // do nothing
                    }
                }, {
                    key: "_asyncComplete",
                    value: function _asyncComplete() {
                        this._keys = null;
                        this._dates = null;
                        this.triggerCallbacks();
                    }
                }, {
                    key: "parseDate",
                    value: function parseDate(string) {
                        return DateUtils.parse(string, this._dateFormat);
                    }
                    /* When formatting date, default to input format if no display format specified. */

                }, {
                    key: "formatDate",
                    value: function formatDate(value) {
                        if (this._durationMode) return DateUtils.formatDuration(value);
                        return DateUtils.format(value, this._dateDisplayFormat || this._dateFormat);
                    }
                }, {
                    key: "_asyncIterate",
                    value: function _asyncIterate(stopTime) {
                        for (; this._i < this._keys.length; this._i++) {
                            if (Date.now() > stopTime) return this._i / this._keys.length;
                            // get values for this iteration
                            var key = this._keys[this._i];
                            var input = this._dates[this._i];
                            var value;
                            var fakeTime = this._fakeData ? StandardLib.asNumber(input) : NaN;
                            if (Weave.IS(input, Date)) {
                                value = input;
                            } else if (this._fakeData && isFinite(fakeTime)) {
                                var d = new Date();
                                var oneDay = 24 * 60 * 60 * 1000;
                                d.setTime(d.getTime() - d.getTime() % oneDay + fakeTime * oneDay);
                                value = d;
                            } else if (this._stringToNumberFunction != null) {
                                var number = this._stringToNumberFunction(input);
                                if (this._numberToStringFunction != null) {
                                    input = this._numberToStringFunction(number);
                                    if (!input) continue;
                                    value = this.parseDate(input);
                                } else {
                                    if (!isFinite(number)) continue;
                                    value = number;
                                }
                            } else {
                                try {
                                    if (!input) continue;
                                    value = this.parseDate(input);
                                    if (Weave.IS(value, Date) && isNaN(Weave.AS(value, Date).getTime())) value = Number(input);
                                } catch (e) {
                                    if (!this._reportedError) {
                                        this._reportedError = true;
                                        var err = StandardLib.substitute('Warning: Unable to parse this value as a date: "{0}"' + ' (only the first error for this column is reported).', input);
                                        console.error(err, 'Attribute column:', this._metadata, e);
                                    }
                                    continue;
                                }
                            }
                            // keep track of unique keys
                            if (!this.map_key_data.has(key)) {
                                this._durationMode = Weave.IS(value, Number);
                                this._uniqueKeys.push(key);
                                // save key-to-data mapping
                                this.map_key_data.set(key, value);
                            } else if (!this._reportedError) {
                                this._reportedError = true;
                                var fmt = 'Warning: Key column values are not unique.  Record dropped due to duplicate key ({0}) (only reported for first duplicate).  Attribute column:';
                                console.log(StandardLib.substitute(fmt, key.localName), this._metadata);
                            }
                        }
                        return 1;
                    }
                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(number) {
                        if (this._numberToStringFunction != null) return this._numberToStringFunction(number);
                        return this.formatDate(number);
                    }
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        var number;
                        var string;
                        var value;
                        if (dataType == Number) {
                            number = Number(this.map_key_data.get(key));
                            return number;
                        }
                        if (dataType == String) {
                            if (this._numberToStringFunction != null) {
                                number = Number(this.map_key_data.get(key));
                                return this._numberToStringFunction(number);
                            }
                            value = this.map_key_data.get(key);
                            if (value === undefined) return '';
                            if (this._dateDisplayFormat || this._dateFormat) string = this.formatDate(value);else string = value.toString();
                            return string;
                        }
                        value = this.map_key_data.get(key);
                        if (!dataType || dataType == Array) return value != null ? [value] : null;
                        if (dataType) return Weave.AS(value, dataType);
                        return value;
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this._uniqueKeys;
                    }
                }], [{
                    key: "detectDateFormats",
                    value: function detectDateFormats(dates) {
                        var convertedFormats = DateFormat.FOR_AUTO_DETECT.map(DateFormat.convertDateFormat_c_to_moment);
                        return DateUtils.detectFormats(dates, convertedFormats);
                    }
                }]);

                return DateColumn;
            }(column.AbstractAttributeColumn);
            DateColumn.SECOND = 1000;
            DateColumn.MINUTE = 60 * 1000;
            DateColumn.HOUR = 60 * 60 * 1000;
            DateColumn = DateColumn_1 = __decorate([Weave.classInfo({ id: "weavejs.data.column.DateColumn", interfaces: [IAttributeColumn, IPrimitiveColumn, IBaseColumn, ICallbackCollection] })], DateColumn);
            column.DateColumn = DateColumn;
        })(column = data.column || (data.column = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source_3) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IDataSource = weavejs.api.data.IDataSource;
            var IDataSourceWithAuthentication = weavejs.api.data.IDataSourceWithAuthentication;
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var ColumnUtils = weavejs.data.ColumnUtils;
            var DateColumn = weavejs.data.column.DateColumn;
            var GeometryColumn = weavejs.data.column.GeometryColumn;
            var NumberColumn = weavejs.data.column.NumberColumn;
            var SecondaryKeyNumColumn = weavejs.data.column.SecondaryKeyNumColumn;
            var StreamedGeometryColumn = weavejs.data.column.StreamedGeometryColumn;
            var StringColumn = weavejs.data.column.StringColumn;
            var EntityNode = weavejs.data.hierarchy.EntityNode;
            var QKeyManager = weavejs.data.key.QKeyManager;
            var EntityCache = weavejs.net.EntityCache;
            var WeaveDataServlet = weavejs.net.WeaveDataServlet;
            var AttributeColumnData = weavejs.net.beans.AttributeColumnData;
            var DebugUtils = weavejs.util.DebugUtils;
            var JS = weavejs.util.JS;
            var StandardLib = weavejs.util.StandardLib;
            var WeavePromise = weavejs.util.WeavePromise;
            var AbstractDataSource = weavejs.data.source.AbstractDataSource;
            var EntityType = weavejs.api.data.EntityType;
            var BLGTreeUtils = weavejs.geom.BLGTreeUtils;
            var GeneralizedGeometry = weavejs.geom.GeneralizedGeometry;
            var GeometryType = weavejs.geom.GeometryType;
            /**
             * WeaveDataSource is an interface for retrieving columns from Weave data servlets.
             *
             * @author adufilie
             */
            var WeaveDataSource_1 = void 0;
            var WeaveDataSource = WeaveDataSource_1 = function (_AbstractDataSource2) {
                _inherits(WeaveDataSource, _AbstractDataSource2);

                function WeaveDataSource() {
                    _classCallCheck(this, WeaveDataSource);

                    var _this179 = _possibleConstructorReturn(this, (WeaveDataSource.__proto__ || Object.getPrototypeOf(WeaveDataSource)).call(this));

                    _this179._service = null;
                    _this179._entityCache = null;
                    _this179.url = Weave.linkableChild(_this179, LinkableString);
                    _this179.hierarchyURL = Weave.linkableChild(_this179, LinkableString);
                    _this179.rootId = Weave.linkableChild(_this179, LinkableVariable);
                    /**
                     * This is an Array of public metadata field names that should be used to uniquely identify columns when querying the server.
                     */
                    _this179._idFields = Weave.linkableChild(_this179, new LinkableVariable(Array, _this179.verifyStringArray));
                    _this179.getHierarchyRootObserver = {};
                    _this179.url.addImmediateCallback(_this179, _this179.handleURLChange, true);
                    return _this179;
                }
                /* override */

                _createClass(WeaveDataSource, [{
                    key: "handleDeprecatedIdFields",
                    value: function handleDeprecatedIdFields() {
                        // if session state is set to some array, use it as an override for the server setting. otherwise, ignore it.
                        var state = Weave.AS(this._overrideIdFields.getSessionState(), Array);
                        if (state) this._idFields.setSessionState(state);
                    }
                    /**
                     * @inheritDoc
                     */

                }, {
                    key: "authenticate",

                    /**
                     * @inheritDoc
                     */
                    value: function authenticate(user, pass) {
                        this._service.authenticate(user, pass);
                    }
                }, {
                    key: "verifyStringArray",
                    value: function verifyStringArray(array) {
                        return !array || StandardLib.getArrayType(array) == String;
                    }
                    /* override */
                }, {
                    key: "refreshHierarchy",
                    value: function refreshHierarchy() {
                        _get(WeaveDataSource.prototype.__proto__ || Object.getPrototypeOf(WeaveDataSource.prototype), "refreshHierarchy", this).call(this);
                        this.entityCache.invalidateAll();
                        if (Weave.IS(this._rootNode, RootNode_TablesAndGeoms)) this._rootNode.refresh(); // TODO bypassing type checking because not compatible with column reference
                    }
                    /**
                     * Gets the root node of the attribute hierarchy.
                     */
                    /* override */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        var _this180 = this;

                        var id = this.rootId.getSessionState();
                        if (typeof id == 'string') id = StandardLib.asNumber(id);
                        var isNumber = typeof id == 'number' && isFinite(Weave.AS(id, Number));
                        var isObject = id != null && (typeof id === "undefined" ? "undefined" : _typeof(id)) == 'object';
                        if (!isNumber && !isObject) {
                            // no valid id specified
                            if (!Weave.IS(this._rootNode, RootNode_TablesAndGeoms)) this._rootNode = new RootNode_TablesAndGeoms(this); // TODO bypassing type checking because it's not compatible with IColumnReference
                            return this._rootNode;
                        }
                        var node = Weave.AS(this._rootNode, EntityNode);
                        if (!node) this._rootNode = node = new EntityNode();
                        node.setEntityCache(this.entityCache);
                        if (isNumber) {
                            node.id = Weave.AS(id, Number);
                        } else if (Weave.detectChange(this.getHierarchyRootObserver, this.rootId)) {
                            node.id = -1;
                            this._service.findEntityIds(id, null).then(function (result) {
                                return _this180.handleRootId(_this180.rootId.triggerCounter, result);
                            });
                        }
                        return this._rootNode;
                    }
                }, {
                    key: "handleRootId",
                    value: function handleRootId(triggerCount, result) {
                        var node = Weave.AS(this.getHierarchyRoot(), EntityNode);
                        if (!node || this.rootId.triggerCounter != triggerCount) return;
                        var ids = result || [];
                        if (!ids.length) {
                            console.error("No entity matches specified rootId: " + Weave.stringify(this.rootId.getSessionState()));
                            return;
                        }
                        if (ids.length > 1) console.error("Multiple entities (" + ids.length + ") match specified rootId: " + Weave.stringify(this.rootId.getSessionState()));
                        node.id = ids[0];
                        Weave.getCallbacks(this).triggerCallbacks();
                    }
                    /* override */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (!metadata) return null;
                        // NOTE - this code won't work if idFields are specified and EntityNodes are used in the hierarchy.
                        // This function would have to be made asynchronous in order to support that.
                        var id;
                        if ((typeof metadata === "undefined" ? "undefined" : _typeof(metadata)) != 'object') {
                            id = StandardLib.asNumber(metadata);
                        } else if (metadata.hasOwnProperty(WeaveDataSource_1.ENTITY_ID)) {
                            id = metadata.weaveEntityId;
                        } else {
                            return _get(WeaveDataSource.prototype.__proto__ || Object.getPrototypeOf(WeaveDataSource.prototype), "generateHierarchyNode", this).call(this, metadata);
                        }
                        var node = new EntityNode(this.entityCache);
                        node.id = id;
                        return node;
                    }
                    /**
                     * This function prevents url.value from being null.
                     */

                }, {
                    key: "handleURLChange",
                    value: function handleURLChange() {
                        this.url.delayCallbacks();
                        var _arr5 = ['/OpenIndicatorsDataServices', '/OpenIndicatorsDataService'];
                        for (var _i5 = 0; _i5 < _arr5.length; _i5++) {
                            var deprecatedBaseURL = _arr5[_i5];
                            if (this.url.value == deprecatedBaseURL || this.url.value == deprecatedBaseURL + WeaveDataSource_1.DEFAULT_SERVLET_NAME) this.url.value = null;
                        } // backwards compatibility -- if url ends in default base url, append default servlet name
                        if (this.url.value && this.url.value.split('/').pop() == WeaveDataSource_1.DEFAULT_BASE_URL.split('/').pop()) this.url.value += WeaveDataSource_1.DEFAULT_SERVLET_NAME;
                        // replace old service
                        Weave.dispose(this._service);
                        Weave.dispose(this._entityCache);
                        this._service = Weave.linkableChild(this, new WeaveDataServlet(this.url.value), this.setIdFields);
                        this._entityCache = Weave.linkableChild(this._service, new EntityCache(this._service));
                        this._tablePromiseCache = {};
                        this.map_proxy_promise = new WeakMap();
                        this.refreshAllProxyColumns();
                        this.url.resumeCallbacks();
                    }
                }, {
                    key: "setIdFields",
                    value: function setIdFields() {
                        // if deprecated idFields state has been set to an array, ignore server setting
                        if (this._overrideIdFields && this._overrideIdFields.getSessionState()) return;
                        var info = this._service.getServerInfo();
                        this._idFields.setSessionState(info ? Weave.AS(info['idFields'], Array) : null);
                    }
                    /**
                     * This gets called as a grouped callback when the session state changes.
                     */
                    /* override */
                }, {
                    key: "initialize",
                    value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        _get(WeaveDataSource.prototype.__proto__ || Object.getPrototypeOf(WeaveDataSource.prototype), "initialize", this).call(this, forceRefresh);
                    }
                    /* override */
                }, {
                    key: "generateNewAttributeColumn",

                    /* override */value: function generateNewAttributeColumn(metadata) {
                        if ((typeof metadata === "undefined" ? "undefined" : _typeof(metadata)) != 'object') {
                            var meta;
                            var id = StandardLib.asNumber(metadata);
                            if (isFinite(id)) meta = JS.copyObject(this.entityCache.getEntity(id).publicMetadata);else meta = {};
                            meta.weaveEntityId = metadata;
                            metadata = meta;
                        }
                        return _get(WeaveDataSource.prototype.__proto__ || Object.getPrototypeOf(WeaveDataSource.prototype), "generateNewAttributeColumn", this).call(this, metadata);
                    }
                    /**
                     * @inheritDoc
                     */
                    /* override */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        // get metadata properties from XML attributes
                        var params = this.getMetadata(proxyColumn, [WeaveDataSource_1.ENTITY_ID, ColumnMetadata.MIN, ColumnMetadata.MAX, WeaveDataSource_1.SQLPARAMS], false);
                        var query;
                        var idFieldsArray = this._idFields.getSessionState();
                        if (idFieldsArray || params.weaveEntityId) {
                            var id = idFieldsArray ? this.getMetadata(proxyColumn, idFieldsArray, true) : StandardLib.asNumber(params[WeaveDataSource_1.ENTITY_ID]);
                            var sqlParams = this.parseSqlParams(params[WeaveDataSource_1.SQLPARAMS]);
                            query = this._service.getColumn(id, params[ColumnMetadata.MIN], params[ColumnMetadata.MAX], sqlParams);
                        } else {
                            this.getMetadata(proxyColumn, [ColumnMetadata.DATA_TYPE, 'dataTable', 'name', 'year', 'sqlParams'], false, params);
                            // dataType is only used for backwards compatibility with geometry collections
                            if (params[ColumnMetadata.DATA_TYPE] != DataTypes.GEOMETRY) delete params[ColumnMetadata.DATA_TYPE];
                            query = this._service.getColumnFromMetadata(params);
                        }
                        query.then(this.handleGetColumn.bind(this, proxyColumn), this.handleGetColumnFault.bind(this, proxyColumn));
                        WeaveAPI.ProgressIndicator.addTask(query, proxyColumn, "Requesting column from server: " + Weave.stringify(params));
                    }
                    /**
                     * @param column An attribute column.
                     * @param propertyNames A list of metadata property names.
                     * @param forUniqueId If true, missing property values will be set to empty strings.
                     *                    If false, missing property values will be omitted.
                     * @param output An object to store the values.
                     * @return An object containing the metadata values.
                     */

                }, {
                    key: "getMetadata",
                    value: function getMetadata(column, propertyNames, forUniqueId) {
                        var output = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

                        if (!output) output = {};
                        var found = false;
                        var _iteratorNormalCompletion122 = true;
                        var _didIteratorError122 = false;
                        var _iteratorError122 = undefined;

                        try {
                            for (var _iterator122 = (propertyNames || [])[Symbol.iterator](), _step122; !(_iteratorNormalCompletion122 = (_step122 = _iterator122.next()).done); _iteratorNormalCompletion122 = true) {
                                var name = _step122.value;

                                var value = column.getMetadata(name);
                                if (value) {
                                    found = true;
                                    output[name] = value;
                                }
                            }
                        } catch (err) {
                            _didIteratorError122 = true;
                            _iteratorError122 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion122 && _iterator122.return) {
                                    _iterator122.return();
                                }
                            } finally {
                                if (_didIteratorError122) {
                                    throw _iteratorError122;
                                }
                            }
                        }

                        if (!found && forUniqueId) {
                            var _iteratorNormalCompletion123 = true;
                            var _didIteratorError123 = false;
                            var _iteratorError123 = undefined;

                            try {
                                for (var _iterator123 = (propertyNames || [])[Symbol.iterator](), _step123; !(_iteratorNormalCompletion123 = (_step123 = _iterator123.next()).done); _iteratorNormalCompletion123 = true) {
                                    var name = _step123.value;

                                    output[name] = '';
                                }
                            } catch (err) {
                                _didIteratorError123 = true;
                                _iteratorError123 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion123 && _iterator123.return) {
                                        _iterator123.return();
                                    }
                                } finally {
                                    if (_didIteratorError123) {
                                        throw _iteratorError123;
                                    }
                                }
                            }
                        }return output;
                    }
                }, {
                    key: "handleGetColumnFault",
                    value: function handleGetColumnFault(column, error) {
                        if (column.wasDisposed) return;
                        JS.error(error, "Error retrieving column:", column.getProxyMetadata(), column);
                        column.dataUnavailable();
                    }
                    //		private function handleGetColumn(event:ResultEvent, token:Object = null):void
                    //		{
                    //			DebugUtils.callLater(5000, handleGetColumn2, arguments);
                    //		}

                }, {
                    key: "parseSqlParams",
                    value: function parseSqlParams(sqlParams) {
                        var result;
                        try {
                            result = Weave.AS(JSON.parse(sqlParams), Array);
                        } catch (e) {}
                        if (!Weave.IS(result, Array)) {
                            result = WeaveAPI.CSVParser.parseCSVRow(sqlParams);
                            if (result && result.length == 0) result = null;
                        }
                        return result;
                    }
                }, {
                    key: "handleGetColumn",
                    value: function handleGetColumn(proxyColumn, result) {
                        if (proxyColumn.wasDisposed) return;
                        var metadata = proxyColumn.getProxyMetadata();
                        try {
                            if (!result) {
                                JS.error("Did not receive any data from service for attribute column:", metadata);
                                return;
                            }
                            //trace("handleGetColumn",pathInHierarchy.toXMLString());
                            // fill in metadata
                            for (var metadataName in result.metadata) {
                                var metadataValue = result.metadata[metadataName];
                                if (metadataValue) metadata[metadataName] = metadataValue;
                            }
                            metadata.weaveEntityId = result.id;
                            proxyColumn.setMetadata(metadata);
                            // special case for geometry column
                            var dataType = ColumnUtils.getDataType(proxyColumn);
                            var isGeom = StandardLib.stringCompare(dataType, DataTypes.GEOMETRY, true) == 0;
                            if (isGeom && result.data == null) {
                                var tileService = this._service.createTileService(result.id);
                                proxyColumn.setInternalColumn(new StreamedGeometryColumn(result.metadataTileDescriptors, result.geometryTileDescriptors, tileService, metadata));
                                return;
                            }
                            var setRecords = function setRecords(qkeys) {
                                if (result.data == null) {
                                    proxyColumn.dataUnavailable();
                                    return;
                                }
                                if (!dataType) dataType = DataTypes.getDataTypeFromData(result.data);
                                if (isGeom) {
                                    var geometriesVector = [];
                                    var createGeomColumn = function createGeomColumn() {
                                        var newGeometricColumn = new GeometryColumn(metadata);
                                        newGeometricColumn.setRecords(qkeys, geometriesVector);
                                        proxyColumn.setInternalColumn(newGeometricColumn);
                                    };
                                    var pgGeomTask = PGGeomUtil.newParseTask(result.data, geometriesVector);
                                    // high priority because not much can be done without data
                                    WeaveAPI.Scheduler.startTask(proxyColumn, pgGeomTask, WeaveAPI.TASK_PRIORITY_HIGH, createGeomColumn);
                                } else if (result.thirdColumn != null) {
                                    // hack for dimension slider
                                    var newColumn = new SecondaryKeyNumColumn(metadata);
                                    newColumn.baseTitle = metadata['baseTitle'];
                                    newColumn.updateRecords(qkeys, result.thirdColumn, result.data);
                                    proxyColumn.setInternalColumn(newColumn);
                                    proxyColumn.setMetadata(null); // this will allow SecondaryKeyNumColumn to use its getMetadata() code
                                } else if (StandardLib.stringCompare(dataType, DataTypes.NUMBER, true) == 0) {
                                    var newNumericColumn = new NumberColumn(metadata);
                                    newNumericColumn.setRecords(qkeys, result.data);
                                    proxyColumn.setInternalColumn(newNumericColumn);
                                } else if (StandardLib.stringCompare(dataType, DataTypes.DATE, true) == 0) {
                                    var newDateColumn = new DateColumn(metadata);
                                    newDateColumn.setRecords(qkeys, result.data);
                                    proxyColumn.setInternalColumn(newDateColumn);
                                } else {
                                    var newStringColumn = new StringColumn(metadata);
                                    newStringColumn.setRecords(qkeys, result.data);
                                    proxyColumn.setInternalColumn(newStringColumn);
                                }
                                //trace("column downloaded: ",proxyColumn);
                            };
                            var keyType = ColumnUtils.getKeyType(proxyColumn);
                            if (result.data != null) {
                                Weave.AS(WeaveAPI.QKeyManager, QKeyManager).getQKeysPromise(proxyColumn, keyType, result.keys).then(setRecords);
                            } else {
                                if (!result.tableField || result.tableId == AttributeColumnData.NO_TABLE_ID) {
                                    proxyColumn.dataUnavailable();
                                    return;
                                }
                                // if table not cached, request table, store in cache, and await data
                                var sqlParams = this.parseSqlParams(proxyColumn.getMetadata(WeaveDataSource_1.SQLPARAMS));
                                var hash = Weave.stringify([result.tableId, sqlParams]);
                                var promise = this._tablePromiseCache[hash];
                                if (!promise) {
                                    var getTablePromise = new WeavePromise(this._service).setResult(this._service.getTable(result.tableId, sqlParams));
                                    var keyStrings;
                                    promise = getTablePromise.then(function (tableData) {
                                        if (WeaveDataSource_1.debug) JS.log('received', DebugUtils.debugId(tableData), hash);
                                        if (!tableData.keyColumns) tableData.keyColumns = [];
                                        if (!tableData.columns) tableData.columns = {};
                                        var name;
                                        var _iteratorNormalCompletion124 = true;
                                        var _didIteratorError124 = false;
                                        var _iteratorError124 = undefined;

                                        try {
                                            for (var _iterator124 = tableData.keyColumns[Symbol.iterator](), _step124; !(_iteratorNormalCompletion124 = (_step124 = _iterator124.next()).done); _iteratorNormalCompletion124 = true) {
                                                name = _step124.value;

                                                if (!tableData.columns.hasOwnProperty(name)) throw new Error(Weave.lang('Table {0} is missing key column "{1}"', tableData.id, name));
                                            }
                                        } catch (err) {
                                            _didIteratorError124 = true;
                                            _iteratorError124 = err;
                                        } finally {
                                            try {
                                                if (!_iteratorNormalCompletion124 && _iterator124.return) {
                                                    _iterator124.return();
                                                }
                                            } finally {
                                                if (_didIteratorError124) {
                                                    throw _iteratorError124;
                                                }
                                            }
                                        }

                                        if (tableData.keyColumns.length == 1) {
                                            keyStrings = tableData.columns[tableData.keyColumns[0]];
                                            return tableData;
                                        }
                                        // generate compound keys
                                        var nCol = tableData.keyColumns.length;
                                        var iCol,
                                            iRow,
                                            nRow = 0;
                                        for (iCol = 0; iCol < nCol; iCol++) {
                                            var keyCol = tableData.columns[tableData.keyColumns[iCol]];
                                            if (iCol == 0) keyStrings = new Array(keyCol.length);
                                            nRow = keyStrings.length;
                                            for (iRow = 0; iRow < nRow; iRow++) {
                                                if (iCol == 0) keyStrings[iRow] = new Array(nCol);
                                                keyStrings[iRow][iCol] = keyCol[iRow];
                                            }
                                        }
                                        for (iRow = 0; iRow < nRow; iRow++) {
                                            keyStrings[iRow] = WeaveAPI.CSVParser.createCSVRow(keyStrings[iRow]);
                                        } // if no key columns were specified, generate keys
                                        if (!keyStrings) {
                                            for (var key in tableData.columns || []) {
                                                break;
                                            }keyStrings = tableData.columns[key].map(function (v, i) {
                                                return 'row' + i;
                                            });
                                        }
                                        return tableData;
                                    }).then(function (tableData) {
                                        if (WeaveDataSource_1.debug) console.log('promising QKeys', DebugUtils.debugId(tableData), hash);
                                        return WeaveAPI.QKeyManager.getQKeysPromise(getTablePromise, keyType, keyStrings).then(function (qkeys) {
                                            if (WeaveDataSource_1.debug) JS.log('got QKeys', DebugUtils.debugId(tableData), hash);
                                            tableData.derived_qkeys = qkeys;
                                            return tableData;
                                        });
                                    });
                                    this._tablePromiseCache[hash] = promise;
                                }
                                // when the promise returns, set column data
                                promise.then(function (tableData) {
                                    result.data = tableData.columns[result.tableField];
                                    if (result.data == null) {
                                        proxyColumn.dataUnavailable(Weave.lang('(Missing column: {0})', result.tableField));
                                        return;
                                    }
                                    setRecords(tableData.derived_qkeys);
                                });
                                // make proxyColumn busy while table promise is busy
                                if (!promise.getResult()) WeaveAPI.SessionManager.assignBusyTask(promise, proxyColumn);
                            }
                        } catch (e) {
                            JS.error(e, "handleGetColumn", metadata);
                        }
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return false;
                    }
                    /**
                     * Provided for backwards compatibility - setting this will override the server setting.
                     * @deprecated
                     */

                }, {
                    key: "idFields",
                    get: function get() {
                        if (!this._overrideIdFields) this._overrideIdFields = Weave.linkableChild(this._idFields, new LinkableVariable(Array, this.verifyStringArray), this.handleDeprecatedIdFields);
                        return this._overrideIdFields;
                    }
                }, {
                    key: "authenticationSupported",
                    get: function get() {
                        return this._service.authenticationSupported;
                    }
                    /**
                     * @inheritDoc
                     */

                }, {
                    key: "authenticationRequired",
                    get: function get() {
                        return this._service.authenticationRequired;
                    }
                    /**
                     * @inheritDoc
                     */

                }, {
                    key: "authenticatedUser",
                    get: function get() {
                        return this._service.authenticatedUser;
                    }
                }, {
                    key: "entityCache",
                    get: function get() {
                        return this._entityCache;
                    }
                }, {
                    key: "serverVersion",
                    get: function get() {
                        var info = this._service.getServerInfo();
                        return info ? info['version'] : null;
                    }
                }, {
                    key: "initializationComplete",
                    get: function get() {
                        return _get(WeaveDataSource.prototype.__proto__ || Object.getPrototypeOf(WeaveDataSource.prototype), "initializationComplete", this) && this._service.entityServiceInitialized;
                    }
                }]);

                return WeaveDataSource;
            }(AbstractDataSource);
            WeaveDataSource.SQLPARAMS = 'sqlParams';
            WeaveDataSource.debug = false;
            WeaveDataSource.DEFAULT_BASE_URL = '/WeaveServices';
            WeaveDataSource.DEFAULT_SERVLET_NAME = '/DataService';
            WeaveDataSource.NO_RESULT_ERROR = "Received null result from Weave server.";
            WeaveDataSource.ENTITY_ID = 'weaveEntityId';
            WeaveDataSource = WeaveDataSource_1 = __decorate([Weave.classInfo({
                id: "weavejs.data.source.WeaveDataSource",
                interfaces: [IDataSource, IDataSourceWithAuthentication],
                label: "Weave server"
            })], WeaveDataSource);
            source_3.WeaveDataSource = WeaveDataSource;
            /**
             * Static functions for retrieving values from PGGeom objects coming from servlet.
             */
            var PGGeomUtil = function () {
                function PGGeomUtil() {
                    _classCallCheck(this, PGGeomUtil);
                }

                _createClass(PGGeomUtil, null, [{
                    key: "newParseTask",

                    /**
                     * This will generate an asynchronous task function for use with IScheduler.startTask().
                     * @param pgGeoms An Array of PGGeom beans from a Weave data service.
                     * @param output An Array to store GeneralizedGeometry objects created from the pgGeoms input.
                     * @return A new Function.
                     * @see weavejs.api.core.IScheduler
                     */
                    value: function newParseTask(pgGeoms, output) {
                        var i = 0;
                        var n = pgGeoms.length;
                        output.length = n;
                        return function (returnTime) {
                            for (; i < n; i++) {
                                if (Date.now() > returnTime) return i / n;
                                var item = pgGeoms[i];
                                var geomType = GeometryType.fromPostGISType(item.type);
                                var geometry = new GeneralizedGeometry(geomType);
                                geometry.setCoordinates(item.xyCoords, BLGTreeUtils.METHOD_SAMPLE);
                                output[i] = geometry;
                            }
                            return 1;
                        };
                    }
                }]);

                return PGGeomUtil;
            }();
            PGGeomUtil = __decorate([Weave.classInfo({ id: "weavejs.data.source.PGGeomUtil" })], PGGeomUtil);
            /**
             * Has two children: "Data Tables" and "Geometry Collections"
             */
            var RootNode_TablesAndGeoms = function () {
                function RootNode_TablesAndGeoms(source) {
                    _classCallCheck(this, RootNode_TablesAndGeoms);

                    this.source = source;
                    this.tableList = new EntityNode(null, EntityType.TABLE);
                    this.geomList = new GeomListNode(source);
                    this.children = [this.tableList, this.geomList];
                }

                _createClass(RootNode_TablesAndGeoms, [{
                    key: "getDataSource",
                    value: function getDataSource() {
                        return this.source;
                    }
                }, {
                    key: "refresh",
                    value: function refresh() {
                        this.geomList.children = null;
                    }
                }, {
                    key: "equals",
                    value: function equals(other) {
                        return other == this;
                    }
                }, {
                    key: "getLabel",
                    value: function getLabel() {
                        return this.source.getLabel();
                    }
                }, {
                    key: "isBranch",
                    value: function isBranch() {
                        return true;
                    }
                }, {
                    key: "hasChildBranches",
                    value: function hasChildBranches() {
                        return true;
                    }
                }, {
                    key: "getChildren",
                    value: function getChildren() {
                        this.tableList.setEntityCache(this.source.entityCache);
                        var str = Weave.lang("Data Tables");
                        if (this.tableList.getChildren().length) str = Weave.lang("{0} ({1})", str, this.tableList.getChildren().length);
                        this.tableList._overrideLabel = str;
                        return this.children;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        return null;
                    }
                }]);

                return RootNode_TablesAndGeoms;
            }();
            RootNode_TablesAndGeoms = __decorate([Weave.classInfo({ id: "weavejs.data.source.RootNode_TablesAndGeoms", interfaces: [IWeaveTreeNode] })], RootNode_TablesAndGeoms);
            /**
             * Makes an RPC to find geometry columns for its children
             */
            var GeomListNode = function () {
                function GeomListNode(source) {
                    _classCallCheck(this, GeomListNode);

                    this.source = source;
                }

                _createClass(GeomListNode, [{
                    key: "equals",
                    value: function equals(other) {
                        return other == this;
                    }
                }, {
                    key: "getLabel",
                    value: function getLabel() {
                        var label = Weave.lang("Geometry Collections");
                        this.getChildren();
                        if (this.children && this.children.length) return Weave.lang("{0} ({1})", label, this.children.length);
                        return label;
                    }
                }, {
                    key: "isBranch",
                    value: function isBranch() {
                        return true;
                    }
                }, {
                    key: "hasChildBranches",
                    value: function hasChildBranches() {
                        return false;
                    }
                }, {
                    key: "getChildren",
                    value: function getChildren() {
                        if (!this.children || this.cache != this.source.entityCache) {
                            this.cache = this.source.entityCache;
                            this.children = [];
                            var meta = {};
                            meta.entityType = EntityType.COLUMN;
                            meta.dataType = DataTypes.GEOMETRY; // TODO fix this type
                            this.cache.getHierarchyInfo(meta).then(this.handleHierarchyInfo.bind(this, this.children));
                        }
                        return this.children;
                    }
                }, {
                    key: "handleHierarchyInfo",
                    value: function handleHierarchyInfo(children, result) {
                        // ignore old results
                        if (this.children != children) return;
                        var _iteratorNormalCompletion125 = true;
                        var _didIteratorError125 = false;
                        var _iteratorError125 = undefined;

                        try {
                            for (var _iterator125 = (result || [])[Symbol.iterator](), _step125; !(_iteratorNormalCompletion125 = (_step125 = _iterator125.next()).done); _iteratorNormalCompletion125 = true) {
                                var info = _step125.value;

                                var node = new GeomColumnNode(this.source.entityCache);
                                node.id = info.id;
                                children.push(node);
                            }
                        } catch (err) {
                            _didIteratorError125 = true;
                            _iteratorError125 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion125 && _iterator125.return) {
                                    _iterator125.return();
                                }
                            } finally {
                                if (_didIteratorError125) {
                                    throw _iteratorError125;
                                }
                            }
                        }

                        Weave.getCallbacks(this.source).triggerCallbacks();
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        return this.source;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        return null;
                    }
                }]);

                return GeomListNode;
            }();
            GeomListNode = __decorate([Weave.classInfo({ id: "weavejs.data.source.GeomListNode", interfaces: [IWeaveTreeNode] })], GeomListNode);
            var GeomColumnNode = function (_EntityNode) {
                _inherits(GeomColumnNode, _EntityNode);

                function GeomColumnNode(cache) {
                    _classCallCheck(this, GeomColumnNode);

                    return _possibleConstructorReturn(this, (GeomColumnNode.__proto__ || Object.getPrototypeOf(GeomColumnNode)).call(this, cache));
                }
                /* override */

                _createClass(GeomColumnNode, [{
                    key: "getLabel",
                    value: function getLabel() {
                        var title = _get(GeomColumnNode.prototype.__proto__ || Object.getPrototypeOf(GeomColumnNode.prototype), "getLabel", this).call(this);
                        var cache = this.getEntityCache();
                        var entity = this.getEntity();
                        var _iteratorNormalCompletion126 = true;
                        var _didIteratorError126 = false;
                        var _iteratorError126 = undefined;

                        try {
                            for (var _iterator126 = (entity.parentIds || [])[Symbol.iterator](), _step126; !(_iteratorNormalCompletion126 = (_step126 = _iterator126.next()).done); _iteratorNormalCompletion126 = true) {
                                var parentId = _step126.value;

                                var info = cache.getBranchInfo(parentId);
                                if (info && info.title && info.title != title) return title + " (" + info.title + ")";
                            }
                        } catch (err) {
                            _didIteratorError126 = true;
                            _iteratorError126 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion126 && _iterator126.return) {
                                    _iterator126.return();
                                }
                            } finally {
                                if (_didIteratorError126) {
                                    throw _iteratorError126;
                                }
                            }
                        }

                        return title;
                    }
                }]);

                return GeomColumnNode;
            }(EntityNode);
            GeomColumnNode = __decorate([Weave.classInfo({ id: "weavejs.data.source.GeomColumnNode" })], GeomColumnNode);
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_7) {
        var source;
        (function (source_4) {
            var DbfField = org.vanrijkom.dbf.DbfField;
            var DbfHeader = org.vanrijkom.dbf.DbfHeader;
            var DbfTools = org.vanrijkom.dbf.DbfTools;
            var WeaveAPI = weavejs.WeaveAPI;
            var IColumnReference = weavejs.api.data.IColumnReference;
            var DataTypes = weavejs.api.data.DataTypes;
            var IDataSource = weavejs.api.data.IDataSource;
            var IWeaveTreeNode = weavejs.api.data.IWeaveTreeNode;
            var LinkableString = weavejs.core.LinkableString;
            var DateColumn = weavejs.data.column.DateColumn;
            var GeometryColumn = weavejs.data.column.GeometryColumn;
            var NumberColumn = weavejs.data.column.NumberColumn;
            var StringColumn = weavejs.data.column.StringColumn;
            var ShpFileReader = weavejs.geom.ShpFileReader;
            var URLRequest = weavejs.net.URLRequest;
            var URLRequestUtils = weavejs.net.URLRequestUtils;
            var JSByteArray = weavejs.util.JSByteArray;
            var StandardLib = weavejs.util.StandardLib;
            /**
             * @author adufilie
             */

            var DBFDataSource = function (_source_4$AbstractDat) {
                _inherits(DBFDataSource, _source_4$AbstractDat);

                function DBFDataSource() {
                    var _ref16;

                    _classCallCheck(this, DBFDataSource);

                    for (var _len12 = arguments.length, args = Array(_len12), _key13 = 0; _key13 < _len12; _key13++) {
                        args[_key13] = arguments[_key13];
                    }

                    var _this182 = _possibleConstructorReturn(this, (_ref16 = DBFDataSource.__proto__ || Object.getPrototypeOf(DBFDataSource)).call.apply(_ref16, [this].concat(args)));

                    _this182.uninitializeObserver = {};
                    _this182.initializeObserver = {};
                    _this182.keyType = Weave.linkableChild(_this182, LinkableString);
                    _this182.keyColName = Weave.linkableChild(_this182, LinkableString);
                    _this182.dbfUrl = Weave.linkableChild(_this182, LinkableString);
                    _this182.shpUrl = Weave.linkableChild(_this182, LinkableString);
                    _this182.projection = Weave.linkableChild(_this182, LinkableString);
                    _this182.dbfData = null;
                    _this182.dbfHeader = null;
                    _this182.shpfile = null;
                    return _this182;
                }
                /**
                 * Hack until dbfUrl and shpUrl are turned into LinkableFiles;
                 */


                _createClass(DBFDataSource, [{
                    key: "hack_urlIsLocal",
                    value: function hack_urlIsLocal(url) {
                        if (Weave.IS(url, String)) return url.startsWith(URLRequestUtils.LOCAL_FILE_URL_SCHEME);
                        return !url;
                    }
                    /* override */
                }, {
                    key: "getLabel",

                    /* override */value: function getLabel() {
                        return this.label.value || (this.shpUrl.value || this.dbfUrl.value || '').split('/').pop() || _get(DBFDataSource.prototype.__proto__ || Object.getPrototypeOf(DBFDataSource.prototype), "getLabel", this).call(this);
                    }
                    /* override */
                }, {
                    key: "uninitialize",

                    /* override */value: function uninitialize() {
                        _get(DBFDataSource.prototype.__proto__ || Object.getPrototypeOf(DBFDataSource.prototype), "uninitialize", this).call(this);
                        if (Weave.detectChange(this.uninitializeObserver, this.dbfUrl)) {
                            this.dbfData = null;
                            this.dbfHeader = null;
                        }
                        if (Weave.detectChange(this.uninitializeObserver, this.shpUrl)) {
                            if (this.shpfile) Weave.dispose(this.shpfile);
                            this.shpfile = null;
                        }
                    }
                    /* override */
                }, {
                    key: "initialize",
                    value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        if (Weave.detectChange(this.initializeObserver, this.dbfUrl) && this.dbfUrl.value) WeaveAPI.URLRequestUtils.request(this, new URLRequest(this.dbfUrl.value)).then(this.handleDBFDownload.bind(this, this.dbfUrl.value), this.handleDBFDownloadError.bind(this, this.dbfUrl.value));
                        if (Weave.detectChange(this.initializeObserver, this.shpUrl) && this.shpUrl.value) WeaveAPI.URLRequestUtils.request(this, new URLRequest(this.shpUrl.value)).then(this.handleShpDownload.bind(this, this.shpUrl.value), this.handleShpDownloadError.bind(this, this.shpUrl.value));
                        // recalculate all columns previously requested because data may have changed.
                        _get(DBFDataSource.prototype.__proto__ || Object.getPrototypeOf(DBFDataSource.prototype), "initialize", this).call(this, true);
                    }
                }, {
                    key: "getGeomColumnTitle",
                    value: function getGeomColumnTitle() {
                        return Weave.lang("{0} geometry", this.getLabel());
                    }
                    /**
                     * Called when the DBF file is downloaded from the URL
                     */

                }, {
                    key: "handleDBFDownload",
                    value: function handleDBFDownload(url, result) {
                        // ignore outdated results
                        if (Weave.wasDisposed(this) || url != this.dbfUrl.value) return;
                        this.dbfData = new JSByteArray(result);
                        if (this.dbfData.length == 0) {
                            this.dbfData = null;
                            console.error("Zero-byte DBF: " + this.dbfUrl.value);
                        } else {
                            try {
                                this.dbfData.position = 0;
                                this.dbfHeader = new DbfHeader(this.dbfData);
                            } catch (e) {
                                this.dbfData = null;
                                console.error(e);
                            }
                        }
                        Weave.getCallbacks(this).triggerCallbacks();
                    }
                    /**
                     * Gets the root node of the attribute hierarchy.
                     */
                    /* override */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        if (!Weave.IS(this._rootNode, DBFColumnNode)) this._rootNode = new DBFColumnNode(this);
                        return this._rootNode;
                    }
                    /* override */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (!metadata) return null;
                        var root = Weave.AS(this.getHierarchyRoot, DBFColumnNode);
                        if (!root) return _get(DBFDataSource.prototype.__proto__ || Object.getPrototypeOf(DBFDataSource.prototype), "generateHierarchyNode", this).call(this, metadata);
                        if (metadata.name) return new DBFColumnNode(this, metadata.name);
                        return null;
                    }
                    /**
                     * Called when the Shp file is downloaded from the URL
                     */

                }, {
                    key: "handleShpDownload",
                    value: function handleShpDownload(url, result) {
                        // ignore outdated results
                        if (Weave.wasDisposed(this) || url != this.shpUrl.value) return;
                        //debugTrace(this, 'shp download complete', shpUrl.value);
                        if (this.shpfile) {
                            Weave.dispose(this.shpfile);
                            this.shpfile = null;
                        }
                        var bytes = new JSByteArray(result);
                        if (bytes.length == 0) {
                            console.error("Zero-byte ShapeFile: " + this.shpUrl.value);
                        } else {
                            try {
                                bytes.position = 0;
                                this.shpfile = Weave.linkableChild(this, new ShpFileReader(bytes));
                            } catch (e) {
                                console.error(e);
                            }
                        }
                        Weave.getCallbacks(this).triggerCallbacks();
                    }
                    /**
                     * Called when the DBF file fails to download from the URL
                     */

                }, {
                    key: "handleDBFDownloadError",
                    value: function handleDBFDownloadError(url, error) {
                        if (Weave.wasDisposed(this)) return;
                        // ignore outdated results
                        if (url != this.dbfUrl.value) return;
                        console.error(error);
                        Weave.getCallbacks(this).triggerCallbacks();
                    }
                    /**
                     * Called when the DBF file fails to download from the URL
                     */

                }, {
                    key: "handleShpDownloadError",
                    value: function handleShpDownloadError(url, error) {
                        if (Weave.wasDisposed(this)) return;
                        // ignore outdated results
                        if (url != this.shpUrl.value) return;
                        console.error(error);
                        Weave.getCallbacks(this).triggerCallbacks();
                    }
                    /**
                     * @inheritDoc
                     */
                    /* override */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var metadata = proxyColumn.getProxyMetadata();
                        // get column name from proxy metadata
                        var columnName = metadata.name;
                        // /* override */ proxy metadata
                        metadata = this.getColumnMetadata(columnName);
                        if (!metadata) {
                            proxyColumn.dataUnavailable();
                            return;
                        }
                        proxyColumn.setMetadata(metadata);
                        var qkeys = WeaveAPI.QKeyManager.getQKeys(this.getKeyType(), this.getColumnValues(this.keyColName.value));
                        var data = this.getColumnValues(columnName);
                        var newColumn;
                        var dataType = metadata.dataType;
                        if (dataType == DataTypes.GEOMETRY) {
                            newColumn = new GeometryColumn(metadata);
                            if (this.shpfile) newColumn.setRecords(qkeys, data);
                        } else if (dataType == DataTypes.DATE) {
                            newColumn = new DateColumn(metadata);
                            newColumn.setRecords(qkeys, data);
                        } else if (dataType == DataTypes.NUMBER) {
                            newColumn = new NumberColumn(metadata);
                            data.forEach(function (str) {
                                return StandardLib.asNumber(str);
                            });
                            newColumn.setRecords(qkeys, data);
                        } else {
                            newColumn = new StringColumn(metadata);
                            Weave.AS(newColumn, StringColumn).setRecords(qkeys, data);
                        }
                        proxyColumn.setInternalColumn(newColumn);
                    }
                }, {
                    key: "getKeyType",
                    value: function getKeyType() {
                        return this.keyType.value || this.getLabel();
                    }
                }, {
                    key: "getColumnNames",
                    value: function getColumnNames() {
                        var names = [];
                        if (this.shpfile) names.push(DBFDataSource.THE_GEOM_COLUMN);
                        if (this.dbfHeader) for (var i = 0; i < this.dbfHeader.fields.length; i++) {
                            names.push(Weave.AS(this.dbfHeader.fields[i], DbfField).name);
                        }return names;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata(columnName) {
                        if (!columnName) return null;
                        var meta = {};
                        meta.name = columnName;
                        meta.keyType = this.getKeyType();
                        meta.projection = this.projection.value;
                        if (columnName == DBFDataSource.THE_GEOM_COLUMN) {
                            meta.title = this.getGeomColumnTitle();
                            meta.dataType = DataTypes.GEOMETRY; // TODO;
                            return meta;
                        } else if (this.dbfHeader) {
                            meta.title = columnName;
                            var _iteratorNormalCompletion127 = true;
                            var _didIteratorError127 = false;
                            var _iteratorError127 = undefined;

                            try {
                                for (var _iterator127 = this.dbfHeader.fields[Symbol.iterator](), _step127; !(_iteratorNormalCompletion127 = (_step127 = _iterator127.next()).done); _iteratorNormalCompletion127 = true) {
                                    var field = _step127.value;

                                    if (field.name == columnName) {
                                        var typeChar = String.fromCharCode(field.type);
                                        var dataType = DBFDataSource.FIELD_TYPE_LOOKUP[typeChar];
                                        if (dataType) meta.dataType = dataType;
                                        if (dataType == DataTypes.DATE) meta.dateFormat = "YYYYMMDD";
                                        return meta;
                                    }
                                }
                            } catch (err) {
                                _didIteratorError127 = true;
                                _iteratorError127 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion127 && _iterator127.return) {
                                        _iterator127.return();
                                    }
                                } finally {
                                    if (_didIteratorError127) {
                                        throw _iteratorError127;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                }, {
                    key: "getColumnValues",
                    value: function getColumnValues(columnName) {
                        var values = [];
                        if (columnName == DBFDataSource.THE_GEOM_COLUMN) return this.shpfile ? this.shpfile.geoms : [];
                        if (!this.dbfHeader) return values;
                        var record = null;
                        for (var i = 0; i < this.dbfHeader.recordCount; i++) {
                            if (columnName) {
                                record = DbfTools.getRecord(this.dbfData, this.dbfHeader, i);
                                var value = record.map_field_value.get(columnName);
                                values.push(value);
                            } else values.push(String(i + 1));
                        }
                        return values;
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return this.hack_urlIsLocal(this.dbfUrl.value) && this.hack_urlIsLocal(this.shpUrl.value);
                    }
                }, {
                    key: "initializationComplete",
                    get: function get() {
                        // make sure everything is ready before column requests get handled.
                        return _get(DBFDataSource.prototype.__proto__ || Object.getPrototypeOf(DBFDataSource.prototype), "initializationComplete", this) && this.dbfData && (!this.shpfile || this.shpfile.geomsReady);
                    }
                }]);

                return DBFDataSource;
            }(source_4.AbstractDataSource);

            DBFDataSource.WEAVE_INFO = Weave.setClassInfo(DBFDataSource, {
                id: "weavejs.data.source.DBFDataSource",
                label: "SHP/DBF files",
                interfaces: [IDataSource]
            });
            DBFDataSource.THE_GEOM_COLUMN = "the_geom";
            DBFDataSource.FIELD_TYPE_LOOKUP = {
                "C": DataTypes.STRING,
                "D": DataTypes.DATE,
                "F": DataTypes.NUMBER,
                "N": DataTypes.NUMBER,
                "2": DataTypes.NUMBER,
                "4": DataTypes.NUMBER,
                "8": DataTypes.NUMBER,
                "L": "boolean",
                "M": null,
                "B": null,
                "G": null,
                "P": null,
                "I": null,
                "0": null,
                "@": null,
                "+": null
            };
            source_4.DBFDataSource = DBFDataSource;

            var DBFColumnNode = function () {
                function DBFColumnNode() {
                    var source = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
                    var columnName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                    _classCallCheck(this, DBFColumnNode);

                    this.source = source;
                    this.columnName = columnName;
                }

                _createClass(DBFColumnNode, [{
                    key: "equals",
                    value: function equals(other) {
                        var that = Weave.AS(other, DBFColumnNode);
                        return !!that && this.source == that.source && this.columnName == that.columnName;
                    }
                }, {
                    key: "getLabel",
                    value: function getLabel() {
                        if (!this.columnName) return this.source.getLabel();
                        return this.columnName;
                    }
                }, {
                    key: "isBranch",
                    value: function isBranch() {
                        return !this.columnName;
                    }
                }, {
                    key: "hasChildBranches",
                    value: function hasChildBranches() {
                        return false;
                    }
                }, {
                    key: "getChildren",
                    value: function getChildren() {
                        if (this.columnName) return null;
                        if (!this.children) this.children = [];
                        var names = this.source.getColumnNames();
                        for (var i = 0; i < names.length; i++) {
                            if (this.children[i]) Weave.AS(this.children[i], DBFColumnNode).columnName = names[i];else this.children[i] = new DBFColumnNode(this.source, names[i]);
                        }
                        this.children.length = names.length;
                        return this.children;
                    }
                }, {
                    key: "getDataSource",
                    value: function getDataSource() {
                        return this.source;
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata() {
                        return this.source.getColumnMetadata(this.columnName);
                    }
                }]);

                return DBFColumnNode;
            }();

            DBFColumnNode.CLASS_INFO = Weave.setClassInfo(DBFColumnNode, {
                id: "weavejs.data.source.DBFColumnNode",
                interfaces: [IWeaveTreeNode, IColumnReference]
            });
        })(source = data_7.source || (data_7.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_8) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ColumnMetadata = weavejs.api.data.ColumnMetadata;
        var ColumnUtils = weavejs.data.ColumnUtils;
        var DataTypes = weavejs.api.data.DataTypes;
        var IAttributeColumn = weavejs.api.data.IAttributeColumn;
        var IQualifiedKey = weavejs.api.data.IQualifiedKey;
        var DateColumn = weavejs.data.column.DateColumn;
        var NumberColumn = weavejs.data.column.NumberColumn;
        var StringColumn = weavejs.data.column.StringColumn;
        var StandardLib = weavejs.util.StandardLib;

        var DataSourceUtils = function () {
            function DataSourceUtils() {
                _classCallCheck(this, DataSourceUtils);
            }

            _createClass(DataSourceUtils, null, [{
                key: "guessDataType",
                value: function guessDataType(data) {
                    var dateFormats = DateColumn.detectDateFormats(data);
                    if (dateFormats.length) return DataTypes.DATE;
                    var _iteratorNormalCompletion128 = true;
                    var _didIteratorError128 = false;
                    var _iteratorError128 = undefined;

                    try {
                        for (var _iterator128 = data[Symbol.iterator](), _step128; !(_iteratorNormalCompletion128 = (_step128 = _iterator128.next()).done); _iteratorNormalCompletion128 = true) {
                            var value = _step128.value;

                            if (value != null && !(typeof value == "number") && !DataSourceUtils.numberRegex.test(value)) return DataTypes.STRING;
                        }
                    } catch (err) {
                        _didIteratorError128 = true;
                        _iteratorError128 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion128 && _iterator128.return) {
                                _iterator128.return();
                            }
                        } finally {
                            if (_didIteratorError128) {
                                throw _iteratorError128;
                            }
                        }
                    }

                    return DataTypes.NUMBER;
                }
                /**
                 * Determine whether a datasource that uses columns from other datasources that are remote.
                 * @param  dataSource The datasource to test.
                 * @return            True if a remote column is used by the datasource; false otherwise.
                 */

            }, {
                key: "hasRemoteColumnDependencies",
                value: function hasRemoteColumnDependencies(dataSource) {
                    /* Possibly cache this and check for changes? */
                    var _iteratorNormalCompletion129 = true;
                    var _didIteratorError129 = false;
                    var _iteratorError129 = undefined;

                    try {
                        for (var _iterator129 = Weave.getDescendants(dataSource, IAttributeColumn)[Symbol.iterator](), _step129; !(_iteratorNormalCompletion129 = (_step129 = _iterator129.next()).done); _iteratorNormalCompletion129 = true) {
                            var column = _step129.value;
                            var _iteratorNormalCompletion130 = true;
                            var _didIteratorError130 = false;
                            var _iteratorError130 = undefined;

                            try {
                                for (var _iterator130 = ColumnUtils.getDataSources(column)[Symbol.iterator](), _step130; !(_iteratorNormalCompletion130 = (_step130 = _iterator130.next()).done); _iteratorNormalCompletion130 = true) {
                                    var columnDataSource = _step130.value;

                                    if (columnDataSource === dataSource) continue;
                                    var isLocal;
                                    if (Weave.detectChange(DataSourceUtils._weakMap_dataSource_isLocal, columnDataSource)) {
                                        isLocal = columnDataSource.isLocal;
                                        DataSourceUtils._weakMap_dataSource_isLocal.set(columnDataSource, isLocal);
                                    } else {
                                        isLocal = DataSourceUtils._weakMap_dataSource_isLocal.has(columnDataSource) ? DataSourceUtils._weakMap_dataSource_isLocal.get(columnDataSource) : true;
                                    }
                                    if (!isLocal) return true;
                                }
                            } catch (err) {
                                _didIteratorError130 = true;
                                _iteratorError130 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion130 && _iterator130.return) {
                                        _iterator130.return();
                                    }
                                } finally {
                                    if (_didIteratorError130) {
                                        throw _iteratorError130;
                                    }
                                }
                            }
                        }
                    } catch (err) {
                        _didIteratorError129 = true;
                        _iteratorError129 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion129 && _iterator129.return) {
                                _iterator129.return();
                            }
                        } finally {
                            if (_didIteratorError129) {
                                throw _iteratorError129;
                            }
                        }
                    }

                    return false;
                }
                /**
                 * Fills a ProxyColumn with an appropriate internal column containing the given keys and data.
                 * @param proxyColumn A column, pre-filled with metadata
                 * @param keys An Array of either IQualifiedKeys or Strings
                 * @param data An Array of data values corresponding to the keys.
                 */

            }, {
                key: "initColumn",
                value: function initColumn(proxyColumn, keys, data) {
                    var asyncCallback = function asyncCallback() {
                        var newColumn;
                        if (dataType == DataTypes.NUMBER) {
                            newColumn = new NumberColumn(metadata);
                            newColumn.setRecords(qkeys, data);
                        } else if (dataType == DataTypes.DATE) {
                            newColumn = new DateColumn(metadata);
                            newColumn.setRecords(qkeys, data);
                        } else {
                            newColumn = new StringColumn(metadata);
                            newColumn.setRecords(qkeys, data);
                        }
                        proxyColumn.setInternalColumn(newColumn);
                    };
                    var metadata = proxyColumn.getProxyMetadata();
                    var dataType = metadata[ColumnMetadata.DATA_TYPE];
                    if (!dataType && StandardLib.getArrayType(data) === Number) dataType = DataTypes.NUMBER;
                    if (!dataType) {
                        dataType = DataSourceUtils.guessDataType(data);
                        metadata[ColumnMetadata.DATA_TYPE] = dataType;
                        proxyColumn.setMetadata(metadata);
                    }
                    var qkeys;
                    if (StandardLib.arrayIsType(keys, IQualifiedKey)) {
                        qkeys = keys;
                        asyncCallback();
                    } else {
                        qkeys = [];
                        WeaveAPI.QKeyManager.getQKeysAsync(proxyColumn, metadata[ColumnMetadata.KEY_TYPE], keys, asyncCallback, qkeys);
                    }
                }
            }]);

            return DataSourceUtils;
        }();

        DataSourceUtils.numberRegex = /^(0|0?\\.[0-9]+|[1-9][0-9]*(\\.[0-9]+)?)([eE][-+]?[0-9]+)?$/;
        DataSourceUtils._weakMap_dataSource_isLocal = new WeakMap();
        data_8.DataSourceUtils = DataSourceUtils;
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_9) {
        var source;
        (function (source) {
            var Aggregation = weavejs.api.data.Aggregation;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IDataSource = weavejs.api.data.IDataSource;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var LinkableNumber = weavejs.core.LinkableNumber;
            var ColumnTreeNode = weavejs.data.hierarchy.ColumnTreeNode;
            var DataSourceUtils = weavejs.data.DataSourceUtils;
            var WebSocketDataSource_1 = void 0;
            var WebSocketDataSource = WebSocketDataSource_1 = function (_source$AbstractDataS2) {
                _inherits(WebSocketDataSource, _source$AbstractDataS2);

                function WebSocketDataSource() {
                    var _ref17;

                    _classCallCheck(this, WebSocketDataSource);

                    for (var _len13 = arguments.length, args = Array(_len13), _key14 = 0; _key14 < _len13; _key14++) {
                        args[_key14] = arguments[_key14];
                    }

                    var _this183 = _possibleConstructorReturn(this, (_ref17 = WebSocketDataSource.__proto__ || Object.getPrototypeOf(WebSocketDataSource)).call.apply(_ref17, [this].concat(args)));

                    _this183.keyType = Weave.linkableChild(_this183, LinkableString);
                    _this183.keyProperty = Weave.linkableChild(_this183, LinkableString);
                    _this183.keepLast = Weave.linkableChild(_this183, LinkableNumber, _this183.onKeepLastChange);
                    _this183.url = Weave.linkableChild(_this183, LinkableString, _this183.onUrlChange);
                    _this183._socket = null;
                    _this183.timeoutId = 0;
                    _this183.onClose = function (event) {
                        _this183._socket = null;
                        if (_this183.url.value && event.code == 1006 /* CLOSE_ABNORMAL */) {
                                _this183.timeoutId = setTimeout(_this183.reconnect, 1500);
                            }
                    };
                    _this183.onError = function (event) {
                        console.error(event);
                        /* Should we automatically retry here? */
                        _this183._socket = null;
                    };
                    _this183.onMessage = function (event) {
                        var str = event.data;
                        var message = JSON.parse(str);
                        if (Weave.IS(message, Array)) {
                            Weave.AS(message, Array).forEach(function (message) {
                                return _this183.addRecord(message);
                            });
                        } else {
                            _this183.addRecord(message);
                        }
                        Weave.getCallbacks(_this183).triggerCallbacks();
                    };
                    /**
                     * The session state maps a column name in dataColumns hash map to a value for its "aggregation" metadata.
                     */
                    _this183.aggregationModes = Weave.linkableChild(_this183, new LinkableVariable(null, _this183.typeofIsObject));
                    _this183.records = [];
                    _this183.propertyNames = new Set();
                    return _this183;
                }
                /* override */

                _createClass(WebSocketDataSource, [{
                    key: "initialize",
                    value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        // recalculate all columns previously requested because CSV data may have changed.
                        _get(WebSocketDataSource.prototype.__proto__ || Object.getPrototypeOf(WebSocketDataSource.prototype), "initialize", this).call(this, true);
                    }
                }, {
                    key: "sendMessage",
                    value: function sendMessage(payload) {
                        if (this._socket && this._socket.readyState == 1) {
                            this._socket.send(JSON.stringify(payload));
                        }
                    }
                }, {
                    key: "onUrlChange",
                    value: function onUrlChange() {
                        this.reconnect();
                        this.records = [];
                        this.propertyNames.clear();
                    }
                }, {
                    key: "reconnect",
                    value: function reconnect() {
                        clearTimeout(this.timeoutId);
                        if (this._socket && this._socket.readyState < 2) {
                            this._socket.close(1000, "No longer needed.");
                            this._socket = null;
                        }
                        try {
                            this._socket = new WebSocket(this.url.value);
                            this._socket.onmessage = this.onMessage;
                            this._socket.onclose = this.onClose;
                            this._socket.onerror = this.onError;
                        } catch (e) {
                            console.error(e);
                        }
                    }
                }, {
                    key: "addRecord",
                    value: function addRecord(record) {
                        if (this.records.length == this.keepLast.value && this.keepLast.value > 0) {
                            this.records.shift();
                        }
                        this.records.push(record);
                        /* Update set of property names */
                        var _iteratorNormalCompletion131 = true;
                        var _didIteratorError131 = false;
                        var _iteratorError131 = undefined;

                        try {
                            for (var _iterator131 = Object.keys(record)[Symbol.iterator](), _step131; !(_iteratorNormalCompletion131 = (_step131 = _iterator131.next()).done); _iteratorNormalCompletion131 = true) {
                                var key = _step131.value;

                                this.propertyNames.add(key);
                            }
                        } catch (err) {
                            _didIteratorError131 = true;
                            _iteratorError131 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion131 && _iterator131.return) {
                                    _iterator131.return();
                                }
                            } finally {
                                if (_didIteratorError131) {
                                    throw _iteratorError131;
                                }
                            }
                        }
                    }
                }, {
                    key: "getPropertyNames",
                    value: function getPropertyNames() {
                        return [].concat(_toConsumableArray(this.propertyNames));
                    }
                }, {
                    key: "onKeepLastChange",
                    value: function onKeepLastChange() {
                        var diff = this.records.length - this.keepLast.value;
                        if (diff > 0) {
                            this.records = this.records.slice(diff);
                        }
                    }
                }, {
                    key: "typeofIsObject",
                    value: function typeofIsObject(value) {
                        return (typeof value === "undefined" ? "undefined" : _typeof(value)) == 'object';
                    }
                    /* override */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        var _this184 = this;

                        if (!this._rootNode) this._rootNode = new ColumnTreeNode({
                            cacheSettings: { "label": false },
                            dataSource: this,
                            dependency: this,
                            data: this,
                            label: function label() {
                                return _this184.getLabel();
                            },
                            hasChildBranches: false,
                            children: function children() {
                                return [].concat(_toConsumableArray(_this184.propertyNames)).map(function (columnName) {
                                    var meta = {};
                                    meta.jsonPropertyName = columnName;
                                    return _this184.generateHierarchyNode(meta);
                                });
                            }
                        });
                        return this._rootNode;
                    }
                    /* override */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (!metadata) return null;
                        metadata = this.getColumnMetadata(metadata.jsonPropertyName);
                        if (!metadata) return null;
                        return new ColumnTreeNode({
                            dataSource: this,
                            idFields: [WebSocketDataSource_1.DATA_COLUMNNAME_META],
                            data: metadata
                        });
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata(dataColumnName) {
                        var metadata = {};
                        metadata.keyType = this.keyType.value || DataTypes.STRING;
                        metadata.jsonPropertyName = dataColumnName;
                        metadata.title = dataColumnName;
                        var aggState = this.aggregationModes.getSessionState();
                        var aggregation = aggState ? aggState[dataColumnName] : null;
                        aggregation = aggregation || Aggregation.LAST; /* Keep the last value by default, this makes more sense in streaming applications. */
                        metadata[ColumnMetadata.AGGREGATION] = aggregation;
                        if (aggregation != Aggregation.SAME) metadata[ColumnMetadata.TITLE] = Weave.lang("{0} ({1})", metadata[ColumnMetadata.TITLE], aggregation);
                        return metadata;
                    }
                    /* override */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var columnName = proxyColumn.getMetadata(WebSocketDataSource_1.DATA_COLUMNNAME_META);
                        var keys;
                        var data = _.map(this.records, columnName); /*.map(
                                                                    function (d:*,i:int,a:Array):*
                                                                    {
                                                                    return d !== undefined ? d : null;
                                                                    }
                                                                    );*/
                        if (this.keyProperty.value) {
                            keys = _.map(this.records, this.keyProperty.value);
                        } else {
                            keys = _.range(data.length).map(String);
                        }
                        var metadata = this.getColumnMetadata(columnName);
                        var dataType = DataSourceUtils.guessDataType(data);
                        metadata.dataType = dataType; //TODO fix dataType
                        proxyColumn.setMetadata(metadata);
                        DataSourceUtils.initColumn(proxyColumn, keys, data);
                    }
                }]);

                return WebSocketDataSource;
            }(source.AbstractDataSource);
            WebSocketDataSource.DATA_COLUMNNAME_META = "jsonPropertyName";
            WebSocketDataSource = WebSocketDataSource_1 = __decorate([Weave.classInfo({ id: "weavejs.data.source.WebSocketDataSource", interfaces: [IDataSource], label: "WebSocket Data Source" })], WebSocketDataSource);
            source.WebSocketDataSource = WebSocketDataSource;
        })(source = data_9.source || (data_9.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source) {
            var Aggregation = weavejs.api.data.Aggregation;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IDataSource = weavejs.api.data.IDataSource;
            var ISelectableAttributes = weavejs.api.data.ISelectableAttributes;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var DynamicColumn = weavejs.data.column.DynamicColumn;
            var ColumnTreeNode = weavejs.data.hierarchy.ColumnTreeNode;
            var DataSourceUtils = weavejs.data.DataSourceUtils;

            var GroupedDataTransform = function (_source$AbstractDataS3) {
                _inherits(GroupedDataTransform, _source$AbstractDataS3);

                function GroupedDataTransform() {
                    var _ref18;

                    _classCallCheck(this, GroupedDataTransform);

                    for (var _len14 = arguments.length, args = Array(_len14), _key15 = 0; _key15 < _len14; _key15++) {
                        args[_key15] = arguments[_key15];
                    }

                    var _this185 = _possibleConstructorReturn(this, (_ref18 = GroupedDataTransform.__proto__ || Object.getPrototypeOf(GroupedDataTransform)).call.apply(_ref18, [this].concat(args)));

                    _this185.groupByColumn = Weave.linkableChild(_this185, DynamicColumn);
                    _this185.groupKeyType = Weave.linkableChild(_this185, LinkableString);
                    _this185.dataColumns = Weave.linkableChild(_this185, new LinkableHashMap(IAttributeColumn));
                    /**
                     * The session state maps a column name in dataColumns hash map to a value for its "aggregation" metadata.
                     */
                    _this185.aggregationModes = Weave.linkableChild(_this185, new LinkableVariable(null, _this185.typeofIsObject));
                    _this185.getGroupKeysObserver = {};
                    return _this185;
                }
                /* override */

                _createClass(GroupedDataTransform, [{
                    key: "initialize",

                    /* override */value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        _get(GroupedDataTransform.prototype.__proto__ || Object.getPrototypeOf(GroupedDataTransform.prototype), "initialize", this).call(this, true);
                    }
                }, {
                    key: "typeofIsObject",
                    value: function typeofIsObject(value) {
                        return (typeof value === "undefined" ? "undefined" : _typeof(value)) == 'object';
                    }
                    /* override */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        var _this186 = this;

                        if (!this._rootNode) this._rootNode = new ColumnTreeNode({
                            cacheSettings: { "label": false },
                            dataSource: this,
                            dependency: this.dataColumns.childListCallbacks,
                            data: this,
                            "label": function label() {
                                return _this186.getLabel();
                            },
                            hasChildBranches: false,
                            children: function children() {
                                return _this186.dataColumns.getNames().map(function (columnName) {
                                    var meta = {};
                                    meta[GroupedDataTransform.DATA_COLUMNNAME_META] = columnName;
                                    return _this186.generateHierarchyNode(meta);
                                });
                            }
                        });
                        return this._rootNode;
                    }
                    /* override */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (!metadata) return null;
                        metadata = this.getColumnMetadata(metadata[GroupedDataTransform.DATA_COLUMNNAME_META]);
                        if (!metadata) return null;
                        return new ColumnTreeNode({
                            dataSource: this,
                            idFields: [GroupedDataTransform.DATA_COLUMNNAME_META],
                            data: metadata
                        });
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata(dataColumnName) {
                        var column = this.dataColumns.getObject(dataColumnName);
                        if (!column) return null;
                        var metadata = ColumnMetadata.getAllMetadata(column);
                        metadata[ColumnMetadata.KEY_TYPE] = this.groupKeyType.value || this.groupByColumn.getMetadata(ColumnMetadata.DATA_TYPE);
                        metadata[GroupedDataTransform.DATA_COLUMNNAME_META] = dataColumnName;
                        var aggState = this.aggregationModes.getSessionState();
                        var aggregation = aggState ? aggState[dataColumnName] : null;
                        aggregation = aggregation || Aggregation.DEFAULT;
                        metadata[ColumnMetadata.AGGREGATION] = aggregation;
                        if (aggregation != Aggregation.SAME) metadata[ColumnMetadata.TITLE] = Weave.lang("{0} ({1})", metadata[ColumnMetadata.TITLE], aggregation);
                        return metadata;
                    }
                    /* override */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var columnName = proxyColumn.getMetadata(GroupedDataTransform.DATA_COLUMNNAME_META);
                        var metadata = this.getColumnMetadata(columnName);
                        if (!metadata) {
                            proxyColumn.dataUnavailable();
                            return;
                        }
                        proxyColumn.setMetadata(metadata);
                        var dataColumn = Weave.AS(this.dataColumns.getObject(columnName), IAttributeColumn);
                        var aggregateColumn = Weave.AS(proxyColumn.getInternalColumn(), AggregateColumn) || new AggregateColumn(this);
                        aggregateColumn.setup(metadata, dataColumn, this.getGroupKeys());
                        proxyColumn.setInternalColumn(aggregateColumn);
                    }
                }, {
                    key: "getGroupKeys",
                    value: function getGroupKeys() {
                        if (Weave.detectChange(this.getGroupKeysObserver, this.groupByColumn, this.groupKeyType)) {
                            this._groupKeys = [];
                            var stringLookup = {};
                            var keyType = this.groupKeyType.value || this.groupByColumn.getMetadata(ColumnMetadata.DATA_TYPE);
                            var _iteratorNormalCompletion132 = true;
                            var _didIteratorError132 = false;
                            var _iteratorError132 = undefined;

                            try {
                                for (var _iterator132 = this.groupByColumn.keys[Symbol.iterator](), _step132; !(_iteratorNormalCompletion132 = (_step132 = _iterator132.next()).done); _iteratorNormalCompletion132 = true) {
                                    var key = _step132.value;

                                    var localName;
                                    // if the foreign key column is numeric, avoid using the formatted strings as keys
                                    if (this.groupByColumn.getMetadata(ColumnMetadata.DATA_TYPE) == DataTypes.NUMBER) localName = this.groupByColumn.getValueFromKey(key, Number);else localName = this.groupByColumn.getValueFromKey(key, String);
                                    if (!stringLookup[localName]) {
                                        stringLookup[localName] = true;
                                        var groupKey = weavejs.WeaveAPI.QKeyManager.getQKey(keyType, localName);
                                        this._groupKeys.push(groupKey);
                                    }
                                }
                            } catch (err) {
                                _didIteratorError132 = true;
                                _iteratorError132 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion132 && _iterator132.return) {
                                        _iterator132.return();
                                    }
                                } finally {
                                    if (_didIteratorError132) {
                                        throw _iteratorError132;
                                    }
                                }
                            }
                        }
                        return this._groupKeys;
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return !DataSourceUtils.hasRemoteColumnDependencies(this);
                    }
                }, {
                    key: "selectableAttributes",
                    get: function get() {
                        return new Map().set("Group by", this.groupByColumn).set("Data to transform", this.dataColumns);
                    }
                    /* override */
                }, {
                    key: "initializationComplete",
                    get: function get() {
                        return _get(GroupedDataTransform.prototype.__proto__ || Object.getPrototypeOf(GroupedDataTransform.prototype), "initializationComplete", this) && !Weave.isBusy(this.groupByColumn) && !Weave.isBusy(this.dataColumns);
                    }
                }]);

                return GroupedDataTransform;
            }(source.AbstractDataSource);

            GroupedDataTransform.WEAVE_INFO = Weave.setClassInfo(GroupedDataTransform, {
                id: "weavejs.data.source.GroupedDataTransform",
                label: "Grouped data transform",
                interfaces: [IDataSource, ISelectableAttributes]
            });
            GroupedDataTransform.DATA_COLUMNNAME_META = "__GroupedDataColumnName__";
            source.GroupedDataTransform = GroupedDataTransform;
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
var WeaveAPI = weavejs.WeaveAPI;
var Aggregation = weavejs.api.data.Aggregation;
var ColumnMetadata = weavejs.api.data.ColumnMetadata;
var DataTypes = weavejs.api.data.DataTypes;
var IAttributeColumn = weavejs.api.data.IAttributeColumn;
var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;
var IQualifiedKey = weavejs.api.data.IQualifiedKey;
var SessionManager = weavejs.core.SessionManager;
var ColumnUtils = weavejs.data.ColumnUtils;
var EquationColumnLib = weavejs.data.EquationColumnLib;
var AbstractAttributeColumn = weavejs.data.column.AbstractAttributeColumn;
var NumberColumn = weavejs.data.column.NumberColumn;
var StringColumn = weavejs.data.column.StringColumn;
var GroupedDataTransform = weavejs.data.source.GroupedDataTransform;
var ArrayUtils = weavejs.util.ArrayUtils;
var Dictionary2D = weavejs.util.Dictionary2D;
var StandardLib = weavejs.util.StandardLib;

var AggregateColumn = function (_AbstractAttributeCol2) {
    _inherits(AggregateColumn, _AbstractAttributeCol2);

    function AggregateColumn(source) {
        _classCallCheck(this, AggregateColumn);

        var _this187 = _possibleConstructorReturn(this, (AggregateColumn.__proto__ || Object.getPrototypeOf(AggregateColumn)).call(this));

        _this187._cacheTriggerCounter = 0;
        Weave.linkableChild(_this187, source);
        _this187._groupByColumn = source.groupByColumn;
        return _this187;
    }

    _createClass(AggregateColumn, [{
        key: "setup",
        value: function setup(metadata, dataColumn, keys) {
            if (this._dataColumn && this._dataColumn != dataColumn) WeaveAPI.SessionManager.unregisterLinkableChild(this, this._dataColumn);
            this._metadata = AggregateColumn.copyValues(metadata);
            this._dataColumn = dataColumn && Weave.linkableChild(this, dataColumn);
            this._keys = keys;
            this._cacheTriggerCounter = 0;
            this.triggerCallbacks();
        }
        /* override */
    }, {
        key: "getMetadata",
        value: function getMetadata(propertyName) {
            return _get(AggregateColumn.prototype.__proto__ || Object.getPrototypeOf(AggregateColumn.prototype), "getMetadata", this).call(this, propertyName) || (this._dataColumn ? this._dataColumn.getMetadata(propertyName) : null);
        }
        /* override */
    }, {
        key: "getMetadataPropertyNames",
        value: function getMetadataPropertyNames() {
            if (this._dataColumn) return ArrayUtils.union(_get(AggregateColumn.prototype.__proto__ || Object.getPrototypeOf(AggregateColumn.prototype), "getMetadataPropertyNames", this).call(this), this._dataColumn.getMetadataPropertyNames());
            return _get(AggregateColumn.prototype.__proto__ || Object.getPrototypeOf(AggregateColumn.prototype), "getMetadataPropertyNames", this).call(this);
        }
        /**
         * @inheritDoc
         */
        /* override */
    }, {
        key: "containsKey",

        /**
         * @inheritDoc
         */
        /* override */value: function containsKey(key) {
            return this._dataColumn && this._dataColumn.containsKey(key);
        }
    }, {
        key: "deriveStringFromNumber",
        value: function deriveStringFromNumber(value) {
            return ColumnUtils.deriveStringFromNumber(this._dataColumn, value);
        }
        /**
         * @inheritDoc
         */
        /* override */
    }, {
        key: "getValueFromKey",
        value: function getValueFromKey(groupKey) {
            var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

            if (this.triggerCounter != this._cacheTriggerCounter) {
                this._cacheTriggerCounter = this.triggerCounter;
                this.dataCache = new Dictionary2D();
            }
            if (!dataType) dataType = Array;
            var value = this.dataCache.get(dataType, groupKey);
            if (value === undefined) {
                value = this.getAggregateValue(groupKey, dataType);
                this.dataCache.set(dataType, groupKey, value === undefined ? AggregateColumn.UNDEFINED : value);
            } else if (value === AggregateColumn.UNDEFINED) {
                value = undefined;
            }
            return value;
        }
        /**
         * Computes an aggregated value.
         * @param groupKey A key that references a String value and is associated with a set of input keys.
         * @param dataType The dataType parameter passed to the EquationColumn.
         */

    }, {
        key: "getAggregateValue",
        value: function getAggregateValue(groupKey, dataType) {
            if (groupKey.keyType != this.getMetadata(ColumnMetadata.KEY_TYPE)) return undefined;
            if (!dataType) dataType = Array;
            // get input keys from groupKey
            var tempKeys = EquationColumnLib.getAssociatedKeys(this._groupByColumn, groupKey, true);
            var meta_dataType = this._dataColumn ? this._dataColumn.getMetadata(ColumnMetadata.DATA_TYPE) : null;
            var inputType = DataTypes.getClass(meta_dataType);
            if (dataType === Array) {
                // We want a flat Array of values, not a nested Array, so we request the original input type
                // in case they need to be pre-aggregated.
                return AggregateColumn.getValues(this._dataColumn, tempKeys, inputType);
            }
            var meta_aggregation = this.getMetadata(ColumnMetadata.AGGREGATION) || Aggregation.DEFAULT;
            if (inputType === Number || inputType === Date) {
                var array = Weave.AS(this.getValueFromKey(groupKey, Array), Array);
                var number = NumberColumn.aggregate(array, meta_aggregation);
                if (dataType === Number) return number;
                if (dataType === Date) return new Date(number);
                if (dataType === String) {
                    if (isNaN(number) && array && array.length > 1 && meta_aggregation == Aggregation.SAME) return Aggregation.AMBIGUOUS_DATA;
                    return ColumnUtils.deriveStringFromNumber(this._dataColumn, number) || StandardLib.formatNumber(number);
                }
                return undefined;
            }
            if (inputType === String) {
                // get a list of values of the requested type, then treat them as Strings and aggregate the Strings
                var values = AggregateColumn.getValues(this._dataColumn, tempKeys, dataType);
                var string = StringColumn.aggregate(values, meta_aggregation);
                if (dataType === Number) return StandardLib.asNumber(string);
                if (dataType === String) return string;
                return undefined;
            }
            if (meta_dataType === DataTypes.GEOMETRY) {
                if (dataType === String) return this.containsKey(groupKey) ? 'Geometry(' + groupKey.keyType + '#' + groupKey.localName + ')' : '';
            }
            return undefined;
        }
        /**
         * Gets an Array of values from a column, excluding missing data.
         * Flattens Arrays.
         */

    }, {
        key: "keys",
        get: function get() {
            return this._keys;
        }
    }], [{
        key: "getValues",
        value: function getValues(column, keys, dataType) {
            var values = [];
            if (!column) return values;
            var _iteratorNormalCompletion133 = true;
            var _didIteratorError133 = false;
            var _iteratorError133 = undefined;

            try {
                for (var _iterator133 = keys[Symbol.iterator](), _step133; !(_iteratorNormalCompletion133 = (_step133 = _iterator133.next()).done); _iteratorNormalCompletion133 = true) {
                    var key = _step133.value;

                    if (!column.containsKey(key)) continue;
                    var value = column.getValueFromKey(key, dataType);
                    if (Array.isArray(value)) values.push.apply(values, value);else values.push(value);
                }
            } catch (err) {
                _didIteratorError133 = true;
                _iteratorError133 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion133 && _iterator133.return) {
                        _iterator133.return();
                    }
                } finally {
                    if (_didIteratorError133) {
                        throw _iteratorError133;
                    }
                }
            }

            return values;
        }
    }]);

    return AggregateColumn;
}(AbstractAttributeColumn);

AggregateColumn.UNDEFINED = {}; // used as a placeholder for undefined values in dataCache
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source_5) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IAttributeColumn = weavejs.api.data.IAttributeColumn;
            var IDataSource = weavejs.api.data.IDataSource;
            var ISelectableAttributes = weavejs.api.data.ISelectableAttributes;
            var LinkableHashMap = weavejs.core.LinkableHashMap;
            var DynamicColumn = weavejs.data.column.DynamicColumn;
            var ColumnTreeNode = weavejs.data.hierarchy.ColumnTreeNode;
            var DataSourceUtils = weavejs.data.DataSourceUtils;
            var IPrimitiveColumn = weavejs.api.data.IPrimitiveColumn;

            var ForeignDataMappingTransform = function (_source_5$AbstractDat) {
                _inherits(ForeignDataMappingTransform, _source_5$AbstractDat);

                function ForeignDataMappingTransform() {
                    var _ref19;

                    _classCallCheck(this, ForeignDataMappingTransform);

                    for (var _len15 = arguments.length, args = Array(_len15), _key16 = 0; _key16 < _len15; _key16++) {
                        args[_key16] = arguments[_key16];
                    }

                    var _this188 = _possibleConstructorReturn(this, (_ref19 = ForeignDataMappingTransform.__proto__ || Object.getPrototypeOf(ForeignDataMappingTransform)).call.apply(_ref19, [this].concat(args)));

                    _this188.keyColumn = Weave.linkableChild(_this188, DynamicColumn);
                    _this188.dataColumns = Weave.linkableChild(_this188, new LinkableHashMap(IAttributeColumn));
                    return _this188;
                }
                /* override */

                _createClass(ForeignDataMappingTransform, [{
                    key: "initialize",

                    /* override */value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        // recalculate all columns previously requested
                        _get(ForeignDataMappingTransform.prototype.__proto__ || Object.getPrototypeOf(ForeignDataMappingTransform.prototype), "initialize", this).call(this, true);
                    }
                    /* override */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        var _this189 = this;

                        if (!this._rootNode) this._rootNode = new ColumnTreeNode({
                            cacheSettings: { "label": false },
                            dataSource: this,
                            dependency: this.dataColumns,
                            data: this,
                            label: function label() {
                                return _this189.getLabel();
                            },
                            hasChildBranches: false,
                            children: function children() {
                                return _this189.dataColumns.getNames().map(function (dataColumnName) {
                                    var column = Weave.AS(_this189.dataColumns.getObject(dataColumnName), IAttributeColumn);
                                    var title = column.getMetadata(ColumnMetadata.TITLE);
                                    var metadata = {};
                                    metadata.title = title;
                                    metadata.dataColumnName = dataColumnName;
                                    return _this189.generateHierarchyNode(metadata);
                                });
                            }
                        });
                        return this._rootNode;
                    }
                    /* override */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (!metadata) return null;
                        var name = metadata.dataColumnName;
                        metadata = this.getColumnMetadata(name);
                        if (!metadata) return null;
                        return new ColumnTreeNode({
                            dataSource: this,
                            idFields: [ForeignDataMappingTransform.DATA_COLUMNNAME_META],
                            data: metadata
                        });
                    }
                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata(dataColumnName) {
                        var includeSourceColumnMetadata = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

                        var column = Weave.AS(this.dataColumns.getObject(dataColumnName), IAttributeColumn);
                        if (!column) return null;
                        var metadata = includeSourceColumnMetadata ? ColumnMetadata.getAllMetadata(column) : {};
                        metadata.keyType = this.keyColumn.getMetadata(ColumnMetadata.KEY_TYPE);
                        metadata.dataColumnName = dataColumnName;
                        return metadata;
                    }
                    /* override */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var dataColumnName = proxyColumn.getMetadata(ForeignDataMappingTransform.DATA_COLUMNNAME_META);
                        var metadata = this.getColumnMetadata(dataColumnName, false);
                        if (!metadata) {
                            proxyColumn.dataUnavailable();
                            return;
                        }
                        proxyColumn.setMetadata(metadata);
                        var dataColumn = Weave.AS(this.dataColumns.getObject(dataColumnName), IAttributeColumn);
                        var foreignDataColumn = Weave.AS(proxyColumn.getInternalColumn(), ForeignDataColumn) || new ForeignDataColumn(this);
                        foreignDataColumn.setup(metadata, dataColumn);
                        proxyColumn.setInternalColumn(foreignDataColumn);
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return !DataSourceUtils.hasRemoteColumnDependencies(this);
                    }
                }, {
                    key: "selectableAttributes",
                    get: function get() {
                        return new Map().set("Foreign key mapping", this.keyColumn).set("Data to transform", this.dataColumns);
                    }
                    /* override */
                }, {
                    key: "initializationComplete",
                    get: function get() {
                        return _get(ForeignDataMappingTransform.prototype.__proto__ || Object.getPrototypeOf(ForeignDataMappingTransform.prototype), "initializationComplete", this) && !Weave.isBusy(this.keyColumn) && !Weave.isBusy(this.dataColumns);
                    }
                }]);

                return ForeignDataMappingTransform;
            }(source_5.AbstractDataSource);

            ForeignDataMappingTransform.WEAVE_INFO = Weave.setClassInfo(ForeignDataMappingTransform, {
                id: "weavejs.data.source.ForeignDataMappingTransform",
                label: "Foreign data mapping",
                interfaces: [IDataSource, ISelectableAttributes]
            });
            ForeignDataMappingTransform.DATA_COLUMNNAME_META = "dataColumnName";
            source_5.ForeignDataMappingTransform = ForeignDataMappingTransform;

            var ForeignDataColumn = function (_AbstractAttributeCol3) {
                _inherits(ForeignDataColumn, _AbstractAttributeCol3);

                function ForeignDataColumn(source) {
                    _classCallCheck(this, ForeignDataColumn);

                    var _this190 = _possibleConstructorReturn(this, (ForeignDataColumn.__proto__ || Object.getPrototypeOf(ForeignDataColumn)).call(this));

                    Weave.linkableChild(_this190, source);
                    _this190._keyColumn = source.keyColumn;
                    return _this190;
                }

                _createClass(ForeignDataColumn, [{
                    key: "setup",
                    value: function setup(metadata, dataColumn) {
                        if (this._dataColumn && this._dataColumn != dataColumn) Weave.AS(WeaveAPI.SessionManager, SessionManager).unregisterLinkableChild(this, this._dataColumn);
                        this._metadata = AbstractAttributeColumn.copyValues(metadata);
                        this._dataColumn = Weave.linkableChild(this, dataColumn);
                        this._keyType = dataColumn.getMetadata(ColumnMetadata.KEY_TYPE);
                        this.triggerCallbacks();
                    }
                    /* override */
                }, {
                    key: "getMetadata",
                    value: function getMetadata(propertyName) {
                        return _get(ForeignDataColumn.prototype.__proto__ || Object.getPrototypeOf(ForeignDataColumn.prototype), "getMetadata", this).call(this, propertyName) || this._dataColumn.getMetadata(propertyName);
                    }
                    /* override */
                }, {
                    key: "getMetadataPropertyNames",
                    value: function getMetadataPropertyNames() {
                        if (this._dataColumn) return ArrayUtils.union(_get(ForeignDataColumn.prototype.__proto__ || Object.getPrototypeOf(ForeignDataColumn.prototype), "getMetadataPropertyNames", this).call(this), this._dataColumn.getMetadataPropertyNames());
                        return _get(ForeignDataColumn.prototype.__proto__ || Object.getPrototypeOf(ForeignDataColumn.prototype), "getMetadataPropertyNames", this).call(this);
                    }
                    /* override */
                }, {
                    key: "containsKey",

                    /* override */value: function containsKey(key) {
                        return this._dataColumn.containsKey(key);
                    }
                }, {
                    key: "deriveStringFromNumber",
                    value: function deriveStringFromNumber(value) {
                        return data.ColumnUtils.deriveStringFromNumber(this._dataColumn, value);
                    }
                    /* override */
                }, {
                    key: "getValueFromKey",
                    value: function getValueFromKey(key) {
                        var dataType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        //TODO - this should be cached
                        var localName;
                        // if the foreign key column is numeric, avoid using the formatted strings as keys
                        if (this._keyColumn.getMetadata(ColumnMetadata.DATA_TYPE) == DataTypes.NUMBER) localName = String(this._keyColumn.getValueFromKey(key, Number));else localName = this._keyColumn.getValueFromKey(key, String);
                        var foreignKey = WeaveAPI.QKeyManager.getQKey(this._keyType, localName);
                        return this._dataColumn.getValueFromKey(foreignKey, dataType);
                    }
                }, {
                    key: "keys",
                    get: function get() {
                        return this._keyColumn.keys;
                    }
                }]);

                return ForeignDataColumn;
            }(AbstractAttributeColumn);

            ForeignDataColumn.WEAVE_INFO = Weave.setClassInfo(ForeignDataColumn, {
                id: "weavejs.data.source.ForeignDataColumn",
                interfaces: [IPrimitiveColumn]
            });
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_10) {
        var source;
        (function (source) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var IDataSource = weavejs.api.data.IDataSource;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var DataSourceUtils = weavejs.data.DataSourceUtils;
            var ColumnTreeNode = weavejs.data.hierarchy.ColumnTreeNode;
            var StandardLib = weavejs.util.StandardLib;
            var WeavePromise = weavejs.util.WeavePromise;

            var CensusDataSource = function (_source$AbstractDataS4) {
                _inherits(CensusDataSource, _source$AbstractDataS4);

                function CensusDataSource() {
                    var _ref20;

                    _classCallCheck(this, CensusDataSource);

                    for (var _len16 = arguments.length, args = Array(_len16), _key17 = 0; _key17 < _len16; _key17++) {
                        args[_key17] = arguments[_key17];
                    }

                    var _this191 = _possibleConstructorReturn(this, (_ref20 = CensusDataSource.__proto__ || Object.getPrototypeOf(CensusDataSource)).call.apply(_ref20, [this].concat(args)));

                    _this191.keyType = Weave.linkableChild(_this191, LinkableString);
                    _this191.apiKey = Weave.linkableChild(_this191, new LinkableString(""));
                    _this191.dataSet = Weave.linkableChild(_this191, new LinkableString("http://api.census.gov/data/id/ACSSF2014"));
                    _this191.geographicScope = Weave.linkableChild(_this191, new LinkableString("040"));
                    _this191.geographicFilters = Weave.linkableChild(_this191, new LinkableVariable(Object));
                    _this191.api = Weave.linkableChild(_this191, source.CensusApi);
                    return _this191;
                }
                /* override */

                _createClass(CensusDataSource, [{
                    key: "initialize",

                    /* override */value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        // recalculate all columns previously requested
                        //forceRefresh = true;
                        _get(CensusDataSource.prototype.__proto__ || Object.getPrototypeOf(CensusDataSource.prototype), "initialize", this).call(this, forceRefresh);
                    }
                }, {
                    key: "getAPI",
                    value: function getAPI() {
                        return this.api;
                    }
                }, {
                    key: "createDataSetNode",
                    value: function createDataSetNode() {
                        var _this192 = this;

                        var _ds = this;
                        var name = this.getLabel();
                        var data = {};
                        var ctn = new ColumnTreeNode({
                            dataSource: this,
                            data: data,
                            label: function label() {
                                return _this192.dataSet.value || name;
                            },
                            hasChildBranches: true,
                            children: function children(node) {
                                var children = [];
                                _this192.api.getVariables(_this192.dataSet.value).then(function (result) {
                                    var concept_nodes = new Map();
                                    var concept_node;
                                    for (var variableId in result) {
                                        var variableInfo = result[variableId];
                                        concept_node = concept_nodes.get(variableInfo.concept);
                                        if (!concept_node) {
                                            var concept_label = variableInfo.concept;
                                            if (!concept_label) concept_label = Weave.lang("No Concept");
                                            concept_node = {
                                                dataSource: _ds,
                                                data: _.clone(data),
                                                label: concept_label,
                                                idFields: ["concept"],
                                                hasChildBranches: false,
                                                children: []
                                            };
                                            concept_node.data.concept = variableInfo.concept;
                                            children.push(concept_node);
                                            concept_nodes.set(variableInfo.concept, concept_node);
                                        }
                                        var variable_descriptor = {
                                            dataSource: _ds,
                                            data: _.clone(concept_node.data),
                                            label: variableInfo.title,
                                            idFields: ["concept", "variableId"],
                                            children: null
                                        };
                                        variable_descriptor.data.variableId = variableId;
                                        concept_node.children.push(variable_descriptor);
                                    }
                                    var _iteratorNormalCompletion134 = true;
                                    var _didIteratorError134 = false;
                                    var _iteratorError134 = undefined;

                                    try {
                                        for (var _iterator134 = concept_nodes[Symbol.iterator](), _step134; !(_iteratorNormalCompletion134 = (_step134 = _iterator134.next()).done); _iteratorNormalCompletion134 = true) {
                                            var _step134$value = _slicedToArray(_step134.value, 2),
                                                key = _step134$value[0],
                                                concept_node = _step134$value[1];

                                            StandardLib.sortOn(concept_node.children, function (obj) {
                                                return obj.data.variableId;
                                            });
                                        }
                                    } catch (err) {
                                        _didIteratorError134 = true;
                                        _iteratorError134 = err;
                                    } finally {
                                        try {
                                            if (!_iteratorNormalCompletion134 && _iterator134.return) {
                                                _iterator134.return();
                                            }
                                        } finally {
                                            if (_didIteratorError134) {
                                                throw _iteratorError134;
                                            }
                                        }
                                    }

                                    StandardLib.sortOn(children, function (obj) {
                                        return obj.data.concept;
                                    });
                                });
                                return children;
                            }
                        });
                        this.api.getDatasets().then(function (datasetsInfo) {
                            var _iteratorNormalCompletion135 = true;
                            var _didIteratorError135 = false;
                            var _iteratorError135 = undefined;

                            try {
                                for (var _iterator135 = datasetsInfo.dataset[Symbol.iterator](), _step135; !(_iteratorNormalCompletion135 = (_step135 = _iterator135.next()).done); _iteratorNormalCompletion135 = true) {
                                    var dataset = _step135.value;

                                    if (dataset.identifier == _this192.dataSet.value) {
                                        ctn.label = dataset.title;
                                        return;
                                    }
                                }
                            } catch (err) {
                                _didIteratorError135 = true;
                                _iteratorError135 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion135 && _iterator135.return) {
                                        _iterator135.return();
                                    }
                                } finally {
                                    if (_didIteratorError135) {
                                        throw _iteratorError135;
                                    }
                                }
                            }

                            ctn.label = _this192.dataSet.value;
                        });
                        return ctn;
                    }
                    /* override */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        if (!this._rootNode) this._rootNode = this.createDataSetNode();
                        return this._rootNode;
                    }
                    /* override */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        if (!metadata) return null;
                        var idFields = ["concept", "variableId"];
                        var ctn = new ColumnTreeNode({ dataSource: this, idFields: idFields, data: metadata });
                        return ctn;
                    }
                    /* override */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var _this193 = this;

                        var metadata = ColumnMetadata.getAllMetadata(proxyColumn);
                        this.getColumn(metadata).then(function (columnInfo) {
                            if (!columnInfo) return;
                            if (_this193.keyType.value) columnInfo.metadata[ColumnMetadata.KEY_TYPE] = _this193.keyType.value;
                            proxyColumn.setMetadata(columnInfo.metadata);
                            DataSourceUtils.initColumn(proxyColumn, columnInfo.keys, columnInfo.data);
                        });
                    }
                    /**
                     *
                     * @param metadata
                     * @return An object containing three fields, "keys," "data," and "metadata"
                     */

                }, {
                    key: "getColumn",
                    value: function getColumn(metadata) {
                        var _this194 = this;

                        var dataset_name;
                        var geography_id;
                        var geography_filters;
                        var api_key;
                        var variable_name = metadata["variableId"];
                        var params = {};
                        var title = null;
                        var access_url = null;
                        var filters = [];
                        var requires = null;
                        return new WeavePromise(this).setResult(this).depend(this.dataSet).then(function () {
                            dataset_name = _this194.dataSet.value;
                            return _this194.api.getDatasetPromise(dataset_name);
                        }).then(function (datasetInfo) {
                            if (datasetInfo && datasetInfo.distribution && datasetInfo.distribution[0]) {
                                access_url = datasetInfo.distribution[0].accessURL;
                            }
                            if (!access_url) {
                                throw new Error("Dataset distribution information malformed.");
                            }
                            return _this194.api.getVariables(dataset_name);
                        }).then(function (variableInfo) {
                            if (variableInfo && variableInfo[variable_name]) title = variableInfo[variable_name].title;
                            return _this194.api.getGeographies(dataset_name);
                        }).depend(this.geographicScope, this.apiKey, this.geographicFilters).then(function (geographyInfo) {
                            if (geographyInfo == null) return null;
                            geography_id = _this194.geographicScope.value;
                            geography_filters = _this194.geographicFilters.getSessionState();
                            api_key = _this194.apiKey.value;
                            requires = ArrayUtils.copy(geographyInfo[geography_id].requires || []);
                            requires.push(geographyInfo[geography_id].name);
                            filters = [];
                            for (var key in geography_filters) {
                                filters.push(key + ":" + geography_filters[key]);
                            }
                            params.get = variable_name;
                            params.for = geographyInfo[geography_id].name + ":*";
                            if (filters.length != 0) params.in = filters.join(",");
                            if (api_key) params.key = api_key;
                            return _this194.api.getJsonCachePromise(access_url, params);
                        }).then(function (dataResult) {
                            if (dataResult == null) return null;
                            var idx;
                            var columns = Weave.AS(dataResult[0], Array);
                            var rows = Weave.AS(dataResult, Array);
                            var data_column = new Array(rows.length - 1);
                            var key_column = new Array(rows.length - 1);
                            var key_column_indices = new Array(columns.length);
                            var data_column_index = columns.indexOf(variable_name);
                            var tmp_key_type = WeaveAPI.CSVParser.createCSVRow(requires);
                            metadata[ColumnMetadata.KEY_TYPE] = tmp_key_type;
                            metadata[ColumnMetadata.TITLE] = title;
                            for (idx = 0; idx < requires.length; idx++) {
                                key_column_indices[idx] = columns.indexOf(requires[idx]);
                            }
                            for (var row_idx = 0; row_idx < data_column.length; row_idx++) {
                                var row = rows[row_idx + 1];
                                var key_values = new Array(key_column_indices.length);
                                for (idx = 0; idx < key_column_indices.length; idx++) {
                                    key_values[idx] = row[key_column_indices[idx]];
                                }
                                key_column[row_idx] = key_values.join("");
                                data_column[row_idx] = row[data_column_index];
                            }
                            return {
                                keys: key_column,
                                data: data_column,
                                metadata: metadata
                            };
                        });
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return false;
                    }
                }]);

                return CensusDataSource;
            }(source.AbstractDataSource);

            CensusDataSource.WEAVE_INFO = Weave.setClassInfo(CensusDataSource, {
                id: "weavejs.data.source.CensusDataSource",
                label: "Census.gov",
                interfaces: [IDataSource]
            });
            CensusDataSource.baseUrl = "http://api.census.gov/";
            source.CensusDataSource = CensusDataSource;
        })(source = data_10.source || (data_10.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data_11) {
        var WeaveAPI = weavejs.WeaveAPI;
        var ColumnMetadata = weavejs.api.data.ColumnMetadata;
        var DataTypes = weavejs.api.data.DataTypes;
        var IAttributeColumn = weavejs.api.data.IAttributeColumn;
        var IAttributeColumnCache = weavejs.api.data.IAttributeColumnCache;
        var IDataSource = weavejs.api.data.IDataSource;
        var DateColumn = weavejs.data.column.DateColumn;
        var GeometryColumn = weavejs.data.column.GeometryColumn;
        var NumberColumn = weavejs.data.column.NumberColumn;
        var StringColumn = weavejs.data.column.StringColumn;
        var CachedDataSource = weavejs.data.source.CachedDataSource;
        var GeneralizedGeometry = weavejs.geom.GeneralizedGeometry;
        var Dictionary2D = weavejs.util.Dictionary2D;
        var WeavePromise = weavejs.util.WeavePromise;
        var AttributeColumnCache = function () {
            function AttributeColumnCache() {
                _classCallCheck(this, AttributeColumnCache);

                this.d2d_dataSource_metadataHash_column = new Dictionary2D();
                // TEMPORARY SOLUTION for WeaveArchive to access this cache data
                this.map_root_saveCache = new WeakMap();
            }

            _createClass(AttributeColumnCache, [{
                key: "getColumn",
                value: function getColumn(dataSource, metadata) {
                    var _this195 = this;

                    // null means no column
                    if (dataSource == null || metadata == null) return null;
                    // Get the column pointer associated with the hash value.
                    var hashCode = Weave.stringify(metadata);
                    var column = this.d2d_dataSource_metadataHash_column.get(dataSource, hashCode);
                    if (!column) {
                        // if this is the first time we've seen this data source, add dispose callback
                        if (!this.d2d_dataSource_metadataHash_column.map.has(dataSource)) Weave.getCallbacks(dataSource).addDisposeCallback(this, function () {
                            _this195.d2d_dataSource_metadataHash_column.map['delete'](dataSource);
                        });
                        // If no column is associated with this hash value, request the
                        // column from its data source and save the column pointer.
                        column = dataSource.generateNewAttributeColumn(metadata);
                        if (column) column.addDisposeCallback(this, function () {
                            _this195.d2d_dataSource_metadataHash_column.remove(dataSource, hashCode);
                        });
                        this.d2d_dataSource_metadataHash_column.set(dataSource, hashCode, column);
                    }
                    return column;
                }
                /**
                 * Creates a cache dump and modifies the session state so data sources are non-functional.
                 * @return A WeavePromise that returns a cache dump that can later be passed to restoreCache();
                 */

            }, {
                key: "convertToCachedDataSources",
                value: function convertToCachedDataSources(root) {
                    var _this196 = this;

                    var promise = new WeavePromise(root).setResult(root);
                    var dispose = function dispose() {
                        return promise.dispose();
                    };
                    var promiseThen = promise.then(function (root) {
                        // request data from every column
                        var column;
                        var columns = Weave.getDescendants(root, IAttributeColumn);
                        var _iteratorNormalCompletion136 = true;
                        var _didIteratorError136 = false;
                        var _iteratorError136 = undefined;

                        try {
                            for (var _iterator136 = columns[Symbol.iterator](), _step136; !(_iteratorNormalCompletion136 = (_step136 = _iterator136.next()).done); _iteratorNormalCompletion136 = true) {
                                column = _step136.value;

                                // simply requesting the keys will cause the data to be requested
                                if (column.keys.length) column.getValueFromKey(column.keys[0]);
                                // wait for the column to finish any async tasks
                                promise.depend(column);
                            }
                        } catch (err) {
                            _didIteratorError136 = true;
                            _iteratorError136 = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion136 && _iterator136.return) {
                                    _iterator136.return();
                                }
                            } finally {
                                if (_didIteratorError136) {
                                    throw _iteratorError136;
                                }
                            }
                        }

                        return root;
                    }).then(function (root) {
                        return _this196._convertToCachedDataSources(root);
                    });
                    promiseThen.then(dispose, dispose);
                    return promiseThen;
                }
            }, {
                key: "_convertToCachedDataSources",
                value: function _convertToCachedDataSources(root) {
                    //cache data from AttributeColumnCache
                    var output = [];
                    var dataSource;
                    var dataSources = this.d2d_dataSource_metadataHash_column.primaryKeys();
                    var _iteratorNormalCompletion137 = true;
                    var _didIteratorError137 = false;
                    var _iteratorError137 = undefined;

                    try {
                        for (var _iterator137 = dataSources[Symbol.iterator](), _step137; !(_iteratorNormalCompletion137 = (_step137 = _iterator137.next()).done); _iteratorNormalCompletion137 = true) {
                            var dataSource = _step137.value;

                            // skip local data sources
                            if (dataSource.isLocal) continue;
                            var dataSourceName = root.getName(dataSource);
                            // skip disposed data sources and global columns (EquationColumn, CSVColumn)
                            if (!dataSourceName) continue;
                            var metadataHashes = this.d2d_dataSource_metadataHash_column.secondaryKeys(dataSource);
                            var _iteratorNormalCompletion139 = true;
                            var _didIteratorError139 = false;
                            var _iteratorError139 = undefined;

                            try {
                                for (var _iterator139 = metadataHashes[Symbol.iterator](), _step139; !(_iteratorNormalCompletion139 = (_step139 = _iterator139.next()).done); _iteratorNormalCompletion139 = true) {
                                    var metadataHash = _step139.value;

                                    var column = this.d2d_dataSource_metadataHash_column.get(dataSource, metadataHash);
                                    if (!column || Weave.wasDisposed(column)) continue;
                                    var metadata = ColumnMetadata.getAllMetadata(column);
                                    var dataType = column.getMetadata(ColumnMetadata.DATA_TYPE);
                                    var keys = [];
                                    var data = [];
                                    var _iteratorNormalCompletion140 = true;
                                    var _didIteratorError140 = false;
                                    var _iteratorError140 = undefined;

                                    try {
                                        for (var _iterator140 = column.keys[Symbol.iterator](), _step140; !(_iteratorNormalCompletion140 = (_step140 = _iterator140.next()).done); _iteratorNormalCompletion140 = true) {
                                            var key = _step140.value;

                                            var values = column.getValueFromKey(key, Array);
                                            // special case if column misbehaves and does not actually return an array when one is requested (not sure if this occurs)
                                            if (values != null && !Array.isArray(values)) values = [values];
                                            var _iteratorNormalCompletion141 = true;
                                            var _didIteratorError141 = false;
                                            var _iteratorError141 = undefined;

                                            try {
                                                for (var _iterator141 = values[Symbol.iterator](), _step141; !(_iteratorNormalCompletion141 = (_step141 = _iterator141.next()).done); _iteratorNormalCompletion141 = true) {
                                                    var value = _step141.value;

                                                    if (dataType == DataTypes.GEOMETRY) {
                                                        keys.push(key.localName);
                                                        data.push(value.toGeoJson());
                                                    } else {
                                                        keys.push(key.localName);
                                                        data.push(value);
                                                    }
                                                }
                                            } catch (err) {
                                                _didIteratorError141 = true;
                                                _iteratorError141 = err;
                                            } finally {
                                                try {
                                                    if (!_iteratorNormalCompletion141 && _iterator141.return) {
                                                        _iterator141.return();
                                                    }
                                                } finally {
                                                    if (_didIteratorError141) {
                                                        throw _iteratorError141;
                                                    }
                                                }
                                            }
                                        }
                                        // output a set of arguments to addToColumnCache()
                                    } catch (err) {
                                        _didIteratorError140 = true;
                                        _iteratorError140 = err;
                                    } finally {
                                        try {
                                            if (!_iteratorNormalCompletion140 && _iterator140.return) {
                                                _iterator140.return();
                                            }
                                        } finally {
                                            if (_didIteratorError140) {
                                                throw _iteratorError140;
                                            }
                                        }
                                    }

                                    output.push([dataSourceName, metadataHash, metadata, keys, data]);
                                }
                            } catch (err) {
                                _didIteratorError139 = true;
                                _iteratorError139 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion139 && _iterator139.return) {
                                        _iterator139.return();
                                    }
                                } finally {
                                    if (_didIteratorError139) {
                                        throw _iteratorError139;
                                    }
                                }
                            }
                        }
                        // stub out data sources
                    } catch (err) {
                        _didIteratorError137 = true;
                        _iteratorError137 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion137 && _iterator137.return) {
                                _iterator137.return();
                            }
                        } finally {
                            if (_didIteratorError137) {
                                throw _iteratorError137;
                            }
                        }
                    }

                    dataSources = root.getObjects(IDataSource);
                    var _iteratorNormalCompletion138 = true;
                    var _didIteratorError138 = false;
                    var _iteratorError138 = undefined;

                    try {
                        for (var _iterator138 = dataSources[Symbol.iterator](), _step138; !(_iteratorNormalCompletion138 = (_step138 = _iterator138.next()).done); _iteratorNormalCompletion138 = true) {
                            var dataSource = _step138.value;

                            // skip local data sources
                            if (dataSource.isLocal) continue;
                            var type = Weave.className(dataSource);
                            var state = Weave.getState(dataSource);
                            var cds = root.requestObject(root.getName(dataSource), CachedDataSource, false);
                            cds.label.value = Weave.lang('{0} (Cached)', dataSource.getLabel());
                            cds.type.value = type;
                            cds.state.state = state;
                        }
                        // repopulate cache for newly created data sources
                    } catch (err) {
                        _didIteratorError138 = true;
                        _iteratorError138 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion138 && _iterator138.return) {
                                _iterator138.return();
                            }
                        } finally {
                            if (_didIteratorError138) {
                                throw _iteratorError138;
                            }
                        }
                    }

                    this.restoreCache(root, output);
                    // TEMPORARY SOLUTION
                    this.map_root_saveCache.set(root, output);
                    return output;
                }
                /**
                 * Restores the cache from a dump created by convertToLocalDataSources().
                 * @param cacheData The cache dump.
                 */

            }, {
                key: "restoreCache",
                value: function restoreCache(root, cacheData) {
                    this.map_root_saveCache.set(root, cacheData);
                    var _iteratorNormalCompletion142 = true;
                    var _didIteratorError142 = false;
                    var _iteratorError142 = undefined;

                    try {
                        for (var _iterator142 = (cacheData || [])[Symbol.iterator](), _step142; !(_iteratorNormalCompletion142 = (_step142 = _iterator142.next()).done); _iteratorNormalCompletion142 = true) {
                            var _step142$value = _slicedToArray(_step142.value, 5),
                                dataSourceName = _step142$value[0],
                                metadataHash = _step142$value[1],
                                metadata = _step142$value[2],
                                keyStrings = _step142$value[3],
                                data = _step142$value[4];

                            this.addToColumnCache(root, dataSourceName, metadataHash, metadata, keyStrings, data);
                        }
                    } catch (err) {
                        _didIteratorError142 = true;
                        _iteratorError142 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion142 && _iterator142.return) {
                                _iterator142.return();
                            }
                        } finally {
                            if (_didIteratorError142) {
                                throw _iteratorError142;
                            }
                        }
                    }
                }
            }, {
                key: "addToColumnCache",
                value: function addToColumnCache(root, dataSourceName, metadataHash, metadata, keyStrings, data) {
                    // create the column object
                    var dataSource = Weave.AS(root.getObject(dataSourceName), IDataSource);
                    if (!dataSource) {
                        if (dataSourceName) console.error("Data source not found: " + dataSourceName);
                        return;
                    }
                    var column;
                    var keyType = metadata[ColumnMetadata.KEY_TYPE];
                    var dataType = metadata[ColumnMetadata.DATA_TYPE];
                    if (dataType == DataTypes.GEOMETRY) column = Weave.disposableChild(dataSource, column = new GeometryColumn(metadata));else if (dataType == DataTypes.DATE) column = Weave.disposableChild(dataSource, column = new DateColumn(metadata));else if (dataType == DataTypes.NUMBER) column = Weave.disposableChild(dataSource, column = new NumberColumn(metadata));else column = Weave.disposableChild(dataSource, column = new StringColumn(metadata));
                    WeaveAPI.QKeyManager.getQKeysPromise(column, keyType, keyStrings).then(function (keys) {
                        if (Weave.IS(column, GeometryColumn)) {
                            var geomKeys = [];
                            var geoms = [];
                            for (var i = 0; i < data.length; i++) {
                                var geomsFromGeoJson = GeneralizedGeometry.fromGeoJson(data[i]);
                                var _iteratorNormalCompletion143 = true;
                                var _didIteratorError143 = false;
                                var _iteratorError143 = undefined;

                                try {
                                    for (var _iterator143 = geomsFromGeoJson[Symbol.iterator](), _step143; !(_iteratorNormalCompletion143 = (_step143 = _iterator143.next()).done); _iteratorNormalCompletion143 = true) {
                                        var geom = _step143.value;

                                        geomKeys.push(keys[i]);
                                        geoms.push(geom);
                                    }
                                } catch (err) {
                                    _didIteratorError143 = true;
                                    _iteratorError143 = err;
                                } finally {
                                    try {
                                        if (!_iteratorNormalCompletion143 && _iterator143.return) {
                                            _iterator143.return();
                                        }
                                    } finally {
                                        if (_didIteratorError143) {
                                            throw _iteratorError143;
                                        }
                                    }
                                }
                            }
                            keys = geomKeys;
                            data = geoms;
                        }
                        column.setRecords(keys, data);
                    });
                    // insert into cache
                    this.d2d_dataSource_metadataHash_column.set(dataSource, metadataHash, column);
                }
                /**
                 * Restores a session state to what it was before calling convertToCachedDataSources().
                 */

            }, {
                key: "restoreFromCachedDataSources",
                value: function restoreFromCachedDataSources(root) {
                    var _iteratorNormalCompletion144 = true;
                    var _didIteratorError144 = false;
                    var _iteratorError144 = undefined;

                    try {
                        for (var _iterator144 = root.getObjects(CachedDataSource)[Symbol.iterator](), _step144; !(_iteratorNormalCompletion144 = (_step144 = _iterator144.next()).done); _iteratorNormalCompletion144 = true) {
                            var cds = _step144.value;

                            this.d2d_dataSource_metadataHash_column.removeAllPrimary(cds);
                            cds.hierarchyRefresh.triggerCallbacks();
                        }
                    } catch (err) {
                        _didIteratorError144 = true;
                        _iteratorError144 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion144 && _iterator144.return) {
                                _iterator144.return();
                            }
                        } finally {
                            if (_didIteratorError144) {
                                throw _iteratorError144;
                            }
                        }
                    }
                }
            }]);

            return AttributeColumnCache;
        }();
        AttributeColumnCache = __decorate([Weave.classInfo({ id: "weavejs.data.AttributeColumnCache", interfaces: [IAttributeColumnCache] })], AttributeColumnCache);
        data_11.AttributeColumnCache = AttributeColumnCache;
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
var weavejs;
(function (weavejs) {
    var core;
    (function (core) {
        var WeaveAPI = weavejs.WeaveAPI;
        var URLRequest = weavejs.net.URLRequest;
        var BackwardsCompatibility = weavejs.util.BackwardsCompatibility;
        var JSByteArray = weavejs.util.JSByteArray;
        var WeavePromise = weavejs.util.WeavePromise;
        var WeaveArchive_1 = void 0;
        var WeaveArchive = WeaveArchive_1 = function () {
            /*private*/function WeaveArchive(weave) {
                _classCallCheck(this, WeaveArchive);

                this.files = new Map();
                this.objects = new Map();
                if (weave) {
                    var _iteratorNormalCompletion145 = true;
                    var _didIteratorError145 = false;
                    var _iteratorError145 = undefined;

                    try {
                        for (var _iterator145 = WeaveAPI.URLRequestUtils.getLocalFileNames(weave.root)[Symbol.iterator](), _step145; !(_iteratorNormalCompletion145 = (_step145 = _iterator145.next()).done); _iteratorNormalCompletion145 = true) {
                            var fileName = _step145.value;

                            this.files.set(fileName, WeaveAPI.URLRequestUtils.getLocalFile(weave.root, fileName));
                        }
                    } catch (err) {
                        _didIteratorError145 = true;
                        _iteratorError145 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion145 && _iterator145.return) {
                                _iterator145.return();
                            }
                        } finally {
                            if (_didIteratorError145) {
                                throw _iteratorError145;
                            }
                        }
                    }

                    this.objects.set(WeaveArchive_1.ARCHIVE_HISTORY_JSON, weave.history.getSessionState());
                    var columnCache = WeaveAPI.AttributeColumnCache.map_root_saveCache.get(weave.root);
                    if (columnCache) this.objects.set(WeaveArchive_1.ARCHIVE_COLUMN_CACHE_JSON, columnCache);
                }
            }

            _createClass(WeaveArchive, [{
                key: "jsonOnFulfilled",
                value: function jsonOnFulfilled(fileName, result) {
                    this.objects.set(fileName, JSON.parse(result));
                }
            }, {
                key: "amfOnFulfilled",
                value: function amfOnFulfilled(fileName, result) {
                    this.objects.set(fileName, new JSByteArray(result).readObject());
                }
            }, {
                key: "fileOnFulfilled",
                value: function fileOnFulfilled(fileName, result) {
                    this.files.set(fileName, result);
                }
            }, {
                key: "deserialize",
                value: function deserialize(byteArray, updateCallback) {
                    var _this197 = this;

                    return new JSZip().loadAsync(byteArray, {}).then(function (zip) {
                        var promises = [];

                        var _loop = function _loop(filePath) {
                            var file = zip.files[filePath];
                            if (file.dir) return "continue";
                            var fileName = filePath.substr(filePath.indexOf('/') + 1);
                            var promise = void 0;
                            var updateCallbackWrapper = updateCallback ? function (meta) {
                                meta.currentFile = fileName;updateCallback(meta);
                            } : null;
                            if (filePath.indexOf(WeaveArchive_1.FOLDER_JSON + '/') == 0) {
                                promise = file.async("string", updateCallbackWrapper).then(function (result) {
                                    return _this197.jsonOnFulfilled(fileName, result);
                                });
                            } else if (filePath.indexOf(WeaveArchive_1.FOLDER_AMF + '/') == 0) {
                                promise = file.async("Uint8Array", updateCallbackWrapper).then(function (result) {
                                    return _this197.amfOnFulfilled(fileName, result);
                                });
                            } else {
                                promise = file.async("Uint8Array", updateCallbackWrapper).then(function (result) {
                                    return _this197.fileOnFulfilled(fileName, result);
                                });
                            }
                            promises.push(promise);
                        };

                        for (var filePath in zip.files) {
                            var _ret = _loop(filePath);

                            if (_ret === "continue") continue;
                        }
                        return Promise.all(promises).then(function () {
                            return _this197;
                        });
                    });
                }
            }, {
                key: "serialize",
                value: function serialize(updateCallback) {
                    var zip = new JSZip();
                    var name = void 0;
                    var folder = void 0;
                    folder = zip.folder(WeaveArchive_1.FOLDER_FILES);
                    var _iteratorNormalCompletion146 = true;
                    var _didIteratorError146 = false;
                    var _iteratorError146 = undefined;

                    try {
                        for (var _iterator146 = this.files[Symbol.iterator](), _step146; !(_iteratorNormalCompletion146 = (_step146 = _iterator146.next()).done); _iteratorNormalCompletion146 = true) {
                            var _step146$value = _slicedToArray(_step146.value, 2),
                                _name = _step146$value[0],
                                content = _step146$value[1];

                            folder.file(_name, content);
                        }
                    } catch (err) {
                        _didIteratorError146 = true;
                        _iteratorError146 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion146 && _iterator146.return) {
                                _iterator146.return();
                            }
                        } finally {
                            if (_didIteratorError146) {
                                throw _iteratorError146;
                            }
                        }
                    }

                    folder = zip.folder(WeaveArchive_1.FOLDER_JSON);
                    var _iteratorNormalCompletion147 = true;
                    var _didIteratorError147 = false;
                    var _iteratorError147 = undefined;

                    try {
                        for (var _iterator147 = this.objects[Symbol.iterator](), _step147; !(_iteratorNormalCompletion147 = (_step147 = _iterator147.next()).done); _iteratorNormalCompletion147 = true) {
                            var _step147$value = _slicedToArray(_step147.value, 2),
                                _name2 = _step147$value[0],
                                object = _step147$value[1];

                            folder.file(_name2, JSON.stringify(object, null, '\t'));
                        }
                    } catch (err) {
                        _didIteratorError147 = true;
                        _iteratorError147 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion147 && _iterator147.return) {
                                _iterator147.return();
                            }
                        } finally {
                            if (_didIteratorError147) {
                                throw _iteratorError147;
                            }
                        }
                    }

                    return zip.generateAsync({ compression: "DEFLATE", type: 'uint8array' }, updateCallback);
                }
            }, {
                key: "setSessionFromArchive",
                value: function setSessionFromArchive(weave) {
                    var historyJSON = this.objects.get(WeaveArchive_1.ARCHIVE_HISTORY_JSON);
                    var historyAMF = this.objects.get(WeaveArchive_1.ARCHIVE_HISTORY_AMF);
                    if (historyJSON) weave.history.setSessionState(historyJSON);else if (historyAMF) weave.history.setSessionState(BackwardsCompatibility.updateSessionState(historyAMF));else throw new Error("No session history found.");
                    var columnCache = this.objects.get(WeaveArchive_1.ARCHIVE_COLUMN_CACHE_AMF) || this.objects.get(WeaveArchive_1.ARCHIVE_COLUMN_CACHE_JSON);
                    WeaveAPI.AttributeColumnCache.restoreCache(weave.root, columnCache);
                    var _iteratorNormalCompletion148 = true;
                    var _didIteratorError148 = false;
                    var _iteratorError148 = undefined;

                    try {
                        for (var _iterator148 = this.files[Symbol.iterator](), _step148; !(_iteratorNormalCompletion148 = (_step148 = _iterator148.next()).done); _iteratorNormalCompletion148 = true) {
                            var _step148$value = _slicedToArray(_step148.value, 2),
                                name = _step148$value[0],
                                content = _step148$value[1];

                            WeaveAPI.URLRequestUtils.saveLocalFile(weave.root, name, content);
                        }
                    } catch (err) {
                        _didIteratorError148 = true;
                        _iteratorError148 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion148 && _iterator148.return) {
                                _iterator148.return();
                            }
                        } finally {
                            if (_didIteratorError148) {
                                throw _iteratorError148;
                            }
                        }
                    }

                    var _iteratorNormalCompletion149 = true;
                    var _didIteratorError149 = false;
                    var _iteratorError149 = undefined;

                    try {
                        for (var _iterator149 = WeaveAPI.URLRequestUtils.getLocalFileNames(weave.root)[Symbol.iterator](), _step149; !(_iteratorNormalCompletion149 = (_step149 = _iterator149.next()).done); _iteratorNormalCompletion149 = true) {
                            var _fileName = _step149.value;

                            if (!this.files.has(_fileName)) {
                                WeaveAPI.URLRequestUtils.removeLocalFile(weave.root, _fileName);
                            }
                        }
                    } catch (err) {
                        _didIteratorError149 = true;
                        _iteratorError149 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion149 && _iterator149.return) {
                                _iterator149.return();
                            }
                        } finally {
                            if (_didIteratorError149) {
                                throw _iteratorError149;
                            }
                        }
                    }
                }
            }], [{
                key: "deserialize",
                value: function deserialize(byteArray, updateCallback) {
                    var archive = new WeaveArchive_1();
                    return archive.deserialize(byteArray, updateCallback);
                }
            }, {
                key: "serialize",
                value: function serialize(weave, updateCallback) {
                    var promise = new WeaveArchive_1(weave).serialize(updateCallback);
                    var weavePromise = new WeavePromise(weave.root);
                    promise.then(function (data) {
                        return weavePromise.setResult(data);
                    }, function (error) {
                        return weavePromise.setError(error);
                    });
                    return weavePromise;
                }
            }, {
                key: "setSessionFromUrl",
                value: function setSessionFromUrl(weave, url) {
                    return WeaveAPI.URLRequestUtils.request(weave.root, new URLRequest(url)).then(WeaveArchive_1.deserialize).then(function (archive) {
                        archive.setSessionFromArchive(weave);
                        return archive;
                    });
                }
            }]);

            return WeaveArchive;
        }();
        WeaveArchive.FOLDER_AMF = "weave-amf";
        WeaveArchive.FOLDER_JSON = "weave-json";
        WeaveArchive.FOLDER_FILES = "weave-files";
        WeaveArchive.ARCHIVE_HISTORY_AMF = "history.amf";
        WeaveArchive.ARCHIVE_HISTORY_JSON = "history.json";
        WeaveArchive.ARCHIVE_COLUMN_CACHE_AMF = "column-cache.amf";
        WeaveArchive.ARCHIVE_COLUMN_CACHE_JSON = "column-cache.json";
        WeaveArchive = WeaveArchive_1 = __decorate([Weave.classInfo({ id: "weavejs.core.WeaveArchive" })], WeaveArchive);
        core.WeaveArchive = WeaveArchive;
    })(core = weavejs.core || (weavejs.core = {}));
})(weavejs || (weavejs = {}));
/* ***** BEGIN LICENSE BLOCK *****
 *
 * This file is part of Weave.
 *
 * The Initial Developer of Weave is the Institute for Visualization
 * and Perception Research at the University of Massachusetts Lowell.
 * Portions created by the Initial Developer are Copyright (C) 2008-2015
 * the Initial Developer. All Rights Reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * ***** END LICENSE BLOCK ***** */
var weavejs;
(function (weavejs) {
    var data;
    (function (data) {
        var source;
        (function (source) {
            var WeaveAPI = weavejs.WeaveAPI;
            var ILinkableHashMap = weavejs.api.core.ILinkableHashMap;
            var ILinkableObjectWithNewProperties = weavejs.api.core.ILinkableObjectWithNewProperties;
            var ColumnMetadata = weavejs.api.data.ColumnMetadata;
            var DataTypes = weavejs.api.data.DataTypes;
            var IDataSource = weavejs.api.data.IDataSource;
            var CallbackCollection = weavejs.core.CallbackCollection;
            var LinkableFile = weavejs.core.LinkableFile;
            var LinkableString = weavejs.core.LinkableString;
            var LinkableVariable = weavejs.core.LinkableVariable;
            var CSVParser = weavejs.data.CSVParser;
            var DateColumn = weavejs.data.column.DateColumn;
            var NumberColumn = weavejs.data.column.NumberColumn;
            var ReferencedColumn = weavejs.data.column.ReferencedColumn;
            var StringColumn = weavejs.data.column.StringColumn;
            var ColumnTreeNode = weavejs.data.hierarchy.ColumnTreeNode;
            var ResponseType = weavejs.net.ResponseType;
            var ArrayUtils = weavejs.util.ArrayUtils;
            var StandardLib = weavejs.util.StandardLib;
            /**
             *
             * @author adufilie
             * @author skolman
             */
            var CSVDataSource_1 = void 0;
            var CSVDataSource = CSVDataSource_1 = function (_source$AbstractDataS5) {
                _inherits(CSVDataSource, _source$AbstractDataS5);

                function CSVDataSource() {
                    _classCallCheck(this, CSVDataSource);

                    var _this198 = _possibleConstructorReturn(this, (CSVDataSource.__proto__ || Object.getPrototypeOf(CSVDataSource)).call(this));

                    _this198.csvData = Weave.linkableChild(_this198, new LinkableVariable(Array, _this198.verifyRows), _this198.handleCSVDataChange);
                    _this198.keyType = Weave.linkableChild(_this198, LinkableString, _this198.updateKeys);
                    _this198.keyColumn = Weave.linkableChild(_this198, new LinkableVariable(null, _this198.verifyKeyColumnId), _this198.updateKeys);
                    _this198.metadata = Weave.linkableChild(_this198, new LinkableVariable(null, _this198.verifyMetadata));
                    _this198.url = Weave.linkableChild(_this198, new LinkableFile(null, null, ResponseType.TEXT), _this198.parseRawData);
                    _this198.delimiter = Weave.linkableChild(_this198, new LinkableString(',', _this198.verifyDelimiter), _this198.parseRawData);
                    _this198.parseRawDataObserver = {};
                    _this198.cachedDataTypes = {}; // TODO repace by DataType
                    _this198.columnIds = [];
                    _this198.keysCallbacks = Weave.linkableChild(_this198, CallbackCollection);
                    _this198.updateKeysObserver = {};
                    _this198._keysAreUnique = true;
                    _this198.nullValues = [null, "", "null", "\\N", "NaN"];
                    Weave.linkableChild(_this198.hierarchyRefresh, _this198.metadata);
                    return _this198;
                }
                /* override */

                _createClass(CSVDataSource, [{
                    key: "getLabel",

                    /* override */value: function getLabel() {
                        return this.label.value || (this.url.value || '').split('/').pop() || _get(CSVDataSource.prototype.__proto__ || Object.getPrototypeOf(CSVDataSource.prototype), "getLabel", this).call(this);
                    }
                }, {
                    key: "verifyRows",
                    value: function verifyRows(rows) {
                        return StandardLib.arrayIsType(rows, Array);
                    }
                }, {
                    key: "verifyKeyColumnId",
                    value: function verifyKeyColumnId(value) {
                        return Weave.IS(value, Number) || Weave.IS(value, String) || value == null;
                    }
                }, {
                    key: "verifyMetadata",
                    value: function verifyMetadata(value) {
                        return (typeof value === "undefined" ? "undefined" : _typeof(value)) == 'object';
                    }
                }, {
                    key: "verifyDelimiter",
                    value: function verifyDelimiter(value) {
                        return value && value.length == 1 && value != '"';
                    }
                }, {
                    key: "parseRawData",
                    value: function parseRawData() {
                        if (!this.url.value) {
                            this.handleCSVDataChange();
                            return;
                        }
                        if (this.url.error) console.error(this.url.error);
                        if (Weave.detectChange(this.parseRawDataObserver, this.delimiter)) {
                            if (this.csvParser) Weave.dispose(this.csvParser);
                            this.csvParser = Weave.linkableChild(this, new CSVParser(true, this.delimiter.value), this.handleCSVParser);
                        }
                        /*if (linkableObjectIsBusy(rawDataPromise))
                            return;*/
                        this.csvParser.parseCSV(String(this.url.result || ''));
                    }
                    /**
                     * Called when csv parser finishes its task
                     */

                }, {
                    key: "handleCSVParser",
                    value: function handleCSVParser() {
                        // when csv parser finishes, handle the result
                        if (this.url.value) {
                            // when using url, we don't want to set session state of csvData
                            this.handleParsedRows(this.csvParser.parseResult);
                        } else {
                            this.csvData.setSessionState(this.csvParser.parseResult);
                        }
                    }
                    /**
                     * Called when csvData session state changes
                     */

                }, {
                    key: "handleCSVDataChange",
                    value: function handleCSVDataChange() {
                        // save parsedRows only if csvData has non-null session state
                        var rows = this.csvData.getSessionState();
                        // clear url value when we specify csvData session state
                        if (this.url.value && rows != null && rows.length) this.url.value = null;
                        if (!this.url.value) this.handleParsedRows(rows);
                    }
                }, {
                    key: "handleParsedRows",
                    value: function handleParsedRows(rows) {
                        if (!rows) rows = [];
                        this.cachedDataTypes = {};
                        this.parsedRows = rows;
                        this.columnIds = Weave.IS(rows[0], Array) ? Weave.AS(rows[0], Array).concat() : [];
                        // make sure column names are unique - if not, use index values for columns with duplicate names
                        var nameLookup = {};
                        for (var i = 0; i < this.columnIds.length; i++) {
                            if (!this.columnIds[i] || nameLookup.hasOwnProperty(this.columnIds[i])) this.columnIds[i] = i;else nameLookup[this.columnIds[i]] = true;
                        }
                        this.updateKeys(true);
                        this.hierarchyRefresh.triggerCallbacks();
                    }
                }, {
                    key: "updateKeys",
                    value: function updateKeys() {
                        var _this199 = this;

                        var forced = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        var changed = Weave.detectChange(this.updateKeysObserver, this.keyType, this.keyColumn);
                        if (this.parsedRows && (forced || changed)) {
                            var colNames = this.parsedRows[0] || [];
                            // getColumnValues supports columnIndex -1
                            var keyColIndex = -1;
                            if (Weave.IS(this.keyColumn.state, String) && this.keyColumn.state != '') {
                                keyColIndex = colNames.indexOf(Weave.AS(this.keyColumn.state, String));
                                // treat invalid key column name as an error
                                if (keyColIndex < 0) keyColIndex = -2;
                            }
                            if (Weave.IS(this.keyColumn.state, Number)) {
                                keyColIndex = Weave.AS(this.keyColumn.state, Number);
                            }
                            var keyStrings = this.getColumnValues(this.parsedRows, keyColIndex, []);
                            var keyTypeString = this.keyType.value;
                            this.keysArray = [];
                            WeaveAPI.QKeyManager.getQKeysAsync(this.keysCallbacks, this.keyType.value, keyStrings, function () {
                                return _this199.handleUpdatedKeys();
                            }, this.keysArray);
                        }
                    }
                }, {
                    key: "handleUpdatedKeys",
                    value: function handleUpdatedKeys() {
                        this._keysAreUnique = ArrayUtils.union(this.keysArray).length == this.keysArray.length;
                    }
                }, {
                    key: "setCSVData",

                    /**
                     * Convenience function for setting session state of csvData.
                     * @param rows
                     */
                    value: function setCSVData(rows) {
                        if (!this.verifyRows(rows)) throw new Error("Invalid data format. Expecting nested Arrays.");
                        this.csvData.setSessionState(rows);
                    }
                }, {
                    key: "getCSVData",
                    value: function getCSVData() {
                        return this.csvData.getSessionState();
                    }
                    /**
                     * Convenience function for setting session state of csvData.
                     * @param csvDataString CSV string using comma as a delimiter.
                     */

                }, {
                    key: "setCSVDataString",
                    value: function setCSVDataString(csvDataString) {
                        this.csvData.setSessionState(WeaveAPI.CSVParser.parseCSV(csvDataString));
                    }
                    /**
                     * This will get a list of column names in the data, which are taken directly from the header row and not guaranteed to be unique.
                     */

                }, {
                    key: "getColumnNames",
                    value: function getColumnNames() {
                        var _this200 = this;

                        return this.getColumnIds().map(function (value) {
                            return _this200.asString(value);
                        });
                    }
                }, {
                    key: "asString",
                    value: function asString(value) {
                        return Weave.AS(value, String);
                    }
                    /**
                     * A unique list of identifiers for columns which may be a mix of Strings and Numbers, depending on the uniqueness of column names.
                     */

                }, {
                    key: "getColumnIds",
                    value: function getColumnIds() {
                        return this.columnIds.concat();
                    }
                    /**
                     * Gets whatever is stored in the "metadata" session state for the specified id.
                     */

                }, {
                    key: "getColumnMetadata",
                    value: function getColumnMetadata(id) {
                        try {
                            if (Weave.IS(id, Number)) id = this.columnIds[id];
                            var meta = this.metadata.getSessionState();
                            if (Weave.IS(meta, Array)) {
                                var array = Weave.AS(meta, Array);
                                for (var i = 0; i < array.length; i++) {
                                    var item = array[i];
                                    var itemId = item.csvColumn || item.csvColumnIndex;
                                    if (itemId === undefined) itemId = this.columnIds[i];
                                    if (itemId === id) return item;
                                }
                                return null;
                            } else if (meta) return meta[id];
                        } catch (e) {
                            console.error(e);
                        }
                        return null;
                    }
                }, {
                    key: "getColumnTitle",
                    value: function getColumnTitle(id) {
                        var meta = this.getColumnMetadata(id);
                        var title = meta ? meta.title : null;
                        if (!title && typeof id == 'number' && this.parsedRows && this.parsedRows.length) title = this.parsedRows[0][id];
                        if (!title) {
                            if (typeof id == 'number') title = Weave.lang("Column {0}", id);else title = String(id);
                        }
                        return title;
                    }
                }, {
                    key: "generateMetadataForColumnId",
                    value: function generateMetadataForColumnId(id) {
                        var metadata = {};
                        metadata.title = this.getColumnTitle(id);
                        metadata.keyType = this.keyType.value || DataTypes.STRING;
                        if (this.cachedDataTypes[id]) metadata.dataType = this.cachedDataTypes[id];
                        // get column metadata from session state
                        var meta = this.getColumnMetadata(id);
                        for (var key in meta) {
                            metadata[key] = meta[key];
                        } // overwrite identifying property
                        if (typeof id == 'number') metadata.csvColumnIndex = String(id); // TODO check this
                        else metadata.csvColumn = String(id);
                        return metadata;
                    }
                    /* override */
                }, {
                    key: "generateNewAttributeColumn",
                    value: function generateNewAttributeColumn(metadata) {
                        if ((typeof metadata === "undefined" ? "undefined" : _typeof(metadata)) != 'object') metadata = this.generateMetadataForColumnId(metadata);
                        return _get(CSVDataSource.prototype.__proto__ || Object.getPrototypeOf(CSVDataSource.prototype), "generateNewAttributeColumn", this).call(this, metadata);
                    }
                    /**
                     * This function will get a column by name or index.
                     * @param columnNameOrIndex The name or index of the CSV column to get.
                     * @return The column.
                     */

                }, {
                    key: "getColumnById",
                    value: function getColumnById(columnNameOrIndex) {
                        return WeaveAPI.AttributeColumnCache.getColumn(this, columnNameOrIndex);
                    }
                    /**
                     * This function will create a column in an ILinkableHashMap that references a column from this CSVDataSource.
                     * @param columnNameOrIndex Either a column name or zero-based column index.
                     * @param destinationHashMap The hash map to put the column in.
                     * @return The column that was created in the hash map.
                     */

                }, {
                    key: "putColumnInHashMap",
                    value: function putColumnInHashMap(columnNameOrIndex, destinationHashMap) {
                        var sourceOwner = Weave.AS(Weave.getOwner(this), ILinkableHashMap);
                        if (!sourceOwner) return null;
                        Weave.getCallbacks(destinationHashMap).delayCallbacks();
                        var refCol = destinationHashMap.requestObject(null, ReferencedColumn, false);
                        refCol.setColumnReference(this, this.generateMetadataForColumnId(columnNameOrIndex));
                        Weave.getCallbacks(destinationHashMap).resumeCallbacks();
                        return refCol;
                    }
                    /**
                     * This will modify a column object in the session state to refer to a column in this CSVDataSource.
                     * @param columnNameOrIndex Either a column name or zero-based column index.
                     * @param dynamicColumn A DynamicColumn.
                     * @return A value of true if successful, false if not.
                     * @see weave.api.IExternalSessionStateInterface
                     */

                }, {
                    key: "putColumn",
                    value: function putColumn(columnNameOrIndex, dynamicColumn) {
                        var sourceOwner = Weave.AS(Weave.getOwner(this), ILinkableHashMap);
                        if (!sourceOwner || !dynamicColumn) return false;
                        dynamicColumn.delayCallbacks();
                        var refCol = dynamicColumn.requestLocalObject(ReferencedColumn, false);
                        refCol.setColumnReference(this, this.generateMetadataForColumnId(columnNameOrIndex));
                        dynamicColumn.resumeCallbacks();
                        return true;
                    }
                    /* override */
                }, {
                    key: "initialize",

                    /**
                     * This gets called as a grouped callback.
                     */
                    /* override */value: function initialize() {
                        var forceRefresh = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        // if url is specified, do not use csvDataString
                        if (this.url.value) this.csvData.setSessionState(null);
                        // recalculate all columns previously requested because CSV data may have changed.
                        _get(CSVDataSource.prototype.__proto__ || Object.getPrototypeOf(CSVDataSource.prototype), "initialize", this).call(this, true);
                    }
                    /**
                     * Gets the root node of the attribute hierarchy.
                     */
                    /* override */
                }, {
                    key: "getHierarchyRoot",
                    value: function getHierarchyRoot() {
                        var _this201 = this;

                        if (!this._rootNode) this._rootNode = new ColumnTreeNode({
                            cacheSettings: { "label": false },
                            dataSource: this,
                            label: function label() {
                                return _this201.getLabel();
                            },
                            children: function children(root) {
                                var items = Weave.AS(_this201.metadata.getSessionState(), Array);
                                if (!items) items = _this201.getColumnIds(); //TODO fix this type
                                var children = [];
                                for (var i = 0; i < items.length; i++) {
                                    var item = items[i];
                                    children[i] = _this201.generateHierarchyNode(item) || _this201.generateHierarchyNode(i);
                                }
                                return children;
                            }
                        });
                        return this._rootNode;
                    }
                    /* override */
                }, {
                    key: "generateHierarchyNode",
                    value: function generateHierarchyNode(metadata) {
                        var _this202 = this;

                        if ((typeof metadata === "undefined" ? "undefined" : _typeof(metadata)) != 'object') metadata = this.generateMetadataForColumnId(metadata);
                        if (!metadata) return null;
                        if (metadata.hasOwnProperty(CSVDataSource_1.METADATA_COLUMN_INDEX) || metadata.hasOwnProperty(CSVDataSource_1.METADATA_COLUMN_NAME)) {
                            return new ColumnTreeNode({
                                dataSource: this,
                                label: function label(node) {
                                    return _this202.getColumnNodeLabel(node);
                                },
                                idFields: [CSVDataSource_1.METADATA_COLUMN_INDEX, CSVDataSource_1.METADATA_COLUMN_NAME],
                                data: metadata
                            });
                        }
                        return null;
                    }
                }, {
                    key: "getColumnNodeLabel",
                    value: function getColumnNodeLabel(node) {
                        var title = node.data[ColumnMetadata.TITLE] || node.data[CSVDataSource_1.METADATA_COLUMN_NAME];
                        if (!title && node.data['name']) {
                            title = node.data['name'];
                            if (node.data['year']) title = StandardLib.substitute("{0} ({1})", title, node.data['year']);
                        }
                        return title;
                    }
                    /* override */
                }, {
                    key: "requestColumnFromSource",
                    value: function requestColumnFromSource(proxyColumn) {
                        var metadata = proxyColumn.getProxyMetadata();
                        // get column id from metadata
                        var columnId = metadata.csvColumnIndex;
                        if (columnId != null) {
                            columnId = Number(columnId);
                        } else {
                            columnId = metadata.csvColumn;
                            if (!columnId) {
                                // support for time slider
                                for (var i = 0; i < this.columnIds.length; i++) {
                                    var meta = this.getColumnMetadata(this.columnIds[i]);
                                    if (!meta) continue;
                                    var found = 0;
                                    for (var key in metadata) {
                                        if (meta[key] != metadata[key]) {
                                            found = 0;
                                            break;
                                        }
                                        found++;
                                    }
                                    if (found) {
                                        columnId = i;
                                        break;
                                    }
                                }
                                // backwards compatibility
                                if (!columnId) columnId = metadata["name"];
                            }
                        }
                        // get column name and index from id
                        var colNames = this.parsedRows[0] || [];
                        var colIndex, colName;
                        if (typeof columnId == 'number') {
                            colIndex = Number(columnId);
                            colName = colNames[columnId];
                        } else {
                            colIndex = colNames.indexOf(columnId);
                            colName = String(columnId);
                        }
                        if (colIndex < 0) {
                            proxyColumn.dataUnavailable(Weave.lang("No such column: {0}", columnId));
                            return;
                        }
                        metadata = this.generateMetadataForColumnId(columnId);
                        proxyColumn.setMetadata(metadata);
                        var strings = this.getColumnValues(this.parsedRows, colIndex, []);
                        var numbers = null;
                        var dateFormats = null;
                        if (!this.keysArray || strings.length != this.keysArray.length) {
                            proxyColumn.setInternalColumn(null);
                            return;
                        }
                        var dataType = metadata.dataType;
                        if (dataType == null || dataType == DataTypes.NUMBER) {
                            numbers = this.stringsToNumbers(strings, dataType == DataTypes.NUMBER);
                        }
                        if (!numbers && dataType == null || dataType == DataTypes.DATE) {
                            dateFormats = DateColumn.detectDateFormats(strings);
                        }
                        var newColumn;
                        if (numbers) {
                            newColumn = new NumberColumn(metadata);
                            Weave.AS(newColumn, NumberColumn).setRecords(this.keysArray, numbers);
                        } else {
                            if (dataType == DataTypes.DATE || dateFormats && dateFormats.length > 0) {
                                newColumn = new DateColumn(metadata);
                                newColumn.setRecords(this.keysArray, strings);
                            } else {
                                newColumn = new StringColumn(metadata);
                                newColumn.setRecords(this.keysArray, strings);
                            }
                        }
                        this.cachedDataTypes[columnId] = newColumn.getMetadata(ColumnMetadata.DATA_TYPE);
                        proxyColumn.setInternalColumn(newColumn);
                    }
                    /**
                     * @param rows The rows to get values from.
                     * @param columnIndex If this is -1, record index values will be returned.  Otherwise, this specifies which column to get values from.
                     * @param outputArray Output Array to store the values from the specified column, excluding the first row, which is the header.
                     * @return outputArray
                     */

                }, {
                    key: "getColumnValues",
                    value: function getColumnValues(rows, columnIndex, outputArray) {
                        outputArray.length = Math.max(0, rows.length - 1);
                        var i;
                        if (columnIndex == -1) {
                            // generate keys 0,1,2,3,...
                            for (i = 1; i < rows.length; i++) {
                                outputArray[i - 1] = String(i);
                            }
                        } else {
                            // get column value from each row
                            for (i = 1; i < rows.length; i++) {
                                outputArray[i - 1] = rows[i][columnIndex];
                            }
                        }
                        return outputArray;
                    }
                    /**
                     * Attempts to convert a list of Strings to Numbers. If successful, returns the Numbers.
                     * @param strings The String values.
                     * @param forced Always return an Array of Numbers, whether or not the Strings look like Numbers.
                     * @return Either an Array of Numbers or null
                     */

                }, {
                    key: "stringsToNumbers",
                    value: function stringsToNumbers(strings, forced) {
                        var nonNumber = null;
                        var foundNumber = forced;
                        var numbers = new Array(strings.length);
                        var i = strings.length;
                        outerLoop: while (i--) {
                            var string = StandardLib.trim(String(strings[i]));
                            var _iteratorNormalCompletion150 = true;
                            var _didIteratorError150 = false;
                            var _iteratorError150 = undefined;

                            try {
                                for (var _iterator150 = this.nullValues[Symbol.iterator](), _step150; !(_iteratorNormalCompletion150 = (_step150 = _iterator150.next()).done); _iteratorNormalCompletion150 = true) {
                                    var nullValue = _step150.value;

                                    var a = nullValue && nullValue.toLocaleLowerCase();
                                    var b = string && string.toLocaleLowerCase();
                                    if (a == b) {
                                        numbers[i] = NaN;
                                        continue outerLoop;
                                    }
                                }
                                // if a string is 2 characters or more and begins with a '0', treat it as a string.
                            } catch (err) {
                                _didIteratorError150 = true;
                                _iteratorError150 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion150 && _iterator150.return) {
                                        _iterator150.return();
                                    }
                                } finally {
                                    if (_didIteratorError150) {
                                        throw _iteratorError150;
                                    }
                                }
                            }

                            if (!forced && string.length > 1 && string.charAt(0) == '0' && string.charAt(1) != '.') return null;
                            if (string.indexOf(',') >= 0) string = string.split(',').join('');
                            var number = Number(string);
                            if (forced || isFinite(number)) {
                                foundNumber = true;
                            } else {
                                // only allow one non-number
                                if (nonNumber && nonNumber != string) return null;else nonNumber = string;
                            }
                            numbers[i] = number;
                        }
                        return foundNumber ? numbers : null;
                    }
                }, {
                    key: "getColumnByName",

                    // backwards compatibility
                    /**
                     * @deprecated("replacement getColumnById")
                     */
                    value: function getColumnByName(name) {
                        return this.getColumnById(name);
                    }
                }, {
                    key: "isLocal",
                    get: function get() {
                        return !!this.csvData.state || this.url.isLocal;
                    }
                }, {
                    key: "keysAreUnique",
                    get: function get() {
                        return this._keysAreUnique;
                    }
                }, {
                    key: "initializationComplete",
                    get: function get() {
                        // make sure csv data is set before column requests are handled.
                        return _get(CSVDataSource.prototype.__proto__ || Object.getPrototypeOf(CSVDataSource.prototype), "initializationComplete", this) && this.parsedRows && this.keysArray && !Weave.isBusy(this.keysCallbacks);
                    }
                }, {
                    key: "deprecatedStateMapping",
                    get: function get() {
                        return {
                            keyColName: this.keyColumn,
                            csvDataString: this.setCSVDataString
                        };
                    }
                }]);

                return CSVDataSource;
            }(source.AbstractDataSource);
            CSVDataSource.METADATA_COLUMN_INDEX = 'csvColumnIndex';
            CSVDataSource.METADATA_COLUMN_NAME = 'csvColumn';
            CSVDataSource = CSVDataSource_1 = __decorate([Weave.classInfo({ id: "weavejs.data.source.CSVDataSource", label: "CSV file", interfaces: [IDataSource, ILinkableObjectWithNewProperties] })], CSVDataSource);
            source.CSVDataSource = CSVDataSource;
        })(source = data.source || (data.source = {}));
    })(data = weavejs.data || (weavejs.data = {}));
})(weavejs || (weavejs = {}));
var CSVDataSource = weavejs.data.source.CSVDataSource;

var WeaveTSTest = function () {
    function WeaveTSTest() {
        _classCallCheck(this, WeaveTSTest);
    }

    _createClass(WeaveTSTest, null, [{
        key: "test",
        value: function test(weave) {
            weave.path('csv').request(CSVDataSource).state('csvData', [['a', 'b'], [1, "one"], [2, "two"]]).addCallback(null, function () {
                console.log(this + "");
                var csv = this.getObject();
                var ids = csv.getColumnIds();
                var _iteratorNormalCompletion151 = true;
                var _didIteratorError151 = false;
                var _iteratorError151 = undefined;

                try {
                    for (var _iterator151 = ids[Symbol.iterator](), _step151; !(_iteratorNormalCompletion151 = (_step151 = _iterator151.next()).done); _iteratorNormalCompletion151 = true) {
                        var id = _step151.value;

                        var col = csv.getColumnById(id);
                        col.addGroupedCallback(col, print, true);
                    }
                } catch (err) {
                    _didIteratorError151 = true;
                    _iteratorError151 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion151 && _iterator151.return) {
                            _iterator151.return();
                        }
                    } finally {
                        if (_didIteratorError151) {
                            throw _iteratorError151;
                        }
                    }
                }
            });
        }
    }]);

    return WeaveTSTest;
}();
/// <reference path="./_lib-references.ts"/>
/// <reference path="./weavejs/as.ts"/>
/// <reference path="./weavejs/core/LinkableSynchronizer.ts"/>
/// <reference path="./weavejs/geom/BLGTree.ts"/>
/// <reference path="./weavejs/geom/KDNode.ts"/>
/// <reference path="./weavejs/geom/NumericRange.ts"/>
/// <reference path="./weavejs/geom/Range.ts"/>
/// <reference path="./weavejs/geom/VertexChainLink.ts"/>
/// <reference path="./weavejs/ui/CenteredIcon.tsx"/>
/// <reference path="./weavejs/ui/DynamicComponent.tsx"/>
/// <reference path="./weavejs/ui/FileInput.tsx"/>
/// <reference path="./weavejs/ui/Input.tsx"/>
/// <reference path="./weavejs/ui/LinkableDynamicComponent.tsx"/>
/// <reference path="./weavejs/ui/LogComponent.tsx"/>
/// <reference path="./weavejs/ui/PanelOverlay.tsx"/>
/// <reference path="./weavejs/ui/ProgressBar.tsx"/>
/// <reference path="./weavejs/ui/StatefulRangeSlider.tsx"/>
/// <reference path="./weavejs/ui/flexbox/BoxProps.tsx"/>
/// <reference path="./weavejs/ui/flexbox/Label.tsx"/>
/// <reference path="./weavejs/ui/flexbox/Section.tsx"/>
/// <reference path="./weavejs/util/MiscUtils.ts"/>
/// <reference path="./weavejs/util/WeaveReactUtils.ts"/>
/// <reference path="./weavejs/util/polyfill.tsx"/>
/// <reference path="./weavejs/ui/layout/DirectionTypes.ts"/>
/// <reference path="./weavejs/ui/Button.tsx"/>
/// <reference path="./weavejs/css/prefixer.ts"/>
/// <reference path="./weavejs/ui/layout/Resizer.tsx"/>
/// <reference path="./weavejs/ui/Div.tsx"/>
/// <reference path="./weavejs/util/MouseUtils.ts"/>
/// <reference path="./weavejs/util/KeyboardUtils.ts"/>
/// <reference path="./weavejs/ui/flexbox/VBox.tsx"/>
/// <reference path="./weavejs/ui/flexbox/HBox.tsx"/>
/// <reference path="./weavejs/ui/Tabs.tsx"/>
/// <reference path="./weavejs/ui/HDividedBox.tsx"/>
/// <reference path="./weavejs/ui/CheckBoxList.tsx"/>
/// <reference path="./weavejs/util/DOMUtils.ts"/>
/// <reference path="./weavejs/util/ReactUtils.tsx"/>
/// <reference path="./weavejs/ui/layout/ResizerOverlay.tsx"/>
/// <reference path="./weavejs/ui/layout/FlexibleLayout.tsx"/>
/// <reference path="./weavejs/ui/ResizingDiv.tsx"/>
/// <reference path="./weavejs/ui/List.tsx"/>
/// <reference path="./weavejs/ui/HelpIcon.tsx"/>
/// <reference path="./weavejs/ui/Popup.tsx"/>
/// <reference path="./weavejs/ui/menu/Menu.tsx"/>
/// <reference path="./weavejs/ui/StatefulTextField.tsx"/>
/// <reference path="./weavejs/ui/StatefulTextArea.tsx"/>
/// <reference path="./weavejs/ui/menu/ContextMenu.tsx"/>
/// <reference path="./weavejs/ui/SmartComponent.tsx"/>
/// <reference path="./weavejs/ui/WeaveComponentRenderer.tsx"/>
/// <reference path="./weavejs/ui/IconButton.tsx"/>
/// <reference path="./weavejs/ui/SideBar.tsx"/>
/// <reference path="./weavejs/ui/SideBarContainer.tsx"/>
/// <reference path="./weavejs/ui/FloatingDiv.tsx"/>
/// <reference path="./weavejs/ui/EditableTextCell.tsx"/>
/// <reference path="./weavejs/ui/Dropdown.tsx"/>
/// <reference path="./weavejs/ui/menu/MenuButton.tsx"/>
/// <reference path="./weavejs/ui/menu/MenuBar.tsx"/>
/// <reference path="./weavejs/ui/ComboBox.tsx"/>
/// <reference path="./weavejs/ui/Checkbox.tsx"/>
/// <reference path="./weavejs/ui/Accordion.tsx"/>
/// <reference path="./weavejs/net/beans/ConnectionInfo.ts"/>
/// <reference path="./weavejs/net/beans/WeaveFileInfo.ts"/>
/// <reference path="./weavejs/net/beans/DatabaseConfigInfo.ts"/>
/// <reference path="./weavejs/net/beans/GeometryStreamMetadata.ts"/>
/// <reference path="./weavejs/net/beans/TableData.ts"/>
/// <reference path="./weavejs/net/beans/AttributeColumnData.ts"/>
/// <reference path="./weavejs/net/JsonCache.ts"/>
/// <reference path="./weavejs/net/Protocol.ts"/>
/// <reference path="./weavejs/api/net/IAsyncService.ts"/>
/// <reference path="./weavejs/net/Servlet.ts"/>
/// <reference path="./weavejs/net/AMF3Servlet.ts"/>
/// <reference path="./weavejs/net/AsyncInvocationQueue.ts"/>
/// <reference path="./weavejs/api/data/IExternalLink.ts"/>
/// <reference path="./weavejs/api/data/IKeySetCallbackInterface.ts"/>
/// <reference path="./weavejs/data/key/KeySetCallbackInterface.ts"/>
/// <reference path="./weavejs/api/data/IDynamicKeySet.ts"/>
/// <reference path="./weavejs/api/ui/IObjectWithDescription.ts"/>
/// <reference path="./weavejs/util/CallbackUtils.ts"/>
/// <reference path="./weavejs/api/data/EntityType.ts"/>
/// <reference path="./weavejs/geom/GeometryType.ts"/>
/// <reference path="./weavejs/geom/ZoomBounds.ts"/>
/// <reference path="./weavejs/geom/KDTree.ts"/>
/// <reference path="./weavejs/api/net/IWeaveGeometryTileService.ts"/>
/// <reference path="./weavejs/api/data/IFilteredKeySet.ts"/>
/// <reference path="./weavejs/api/data/IDynamicKeyFilter.ts"/>
/// <reference path="./weavejs/api/data/IStatisticsCache.ts"/>
/// <reference path="./weavejs/geom/GeoJSON.ts"/>
/// <reference path="./weavejs/geom/BLGNode.ts"/>
/// <reference path="./weavejs/api/data/IColumnStatistics.ts"/>
/// <reference path="./weavejs/api/data/ISimpleGeometry.ts"/>
/// <reference path="./weavejs/geom/SimpleGeometry.ts"/>
/// <reference path="./weavejs/geom/GeneralizedGeometry.ts"/>
/// <reference path="./weavejs/api/net/beans/EntityHierarchyInfo.ts"/>
/// <reference path="./weavejs/api/data/IBinClassifier.ts"/>
/// <reference path="./weavejs/data/bin/StringClassifier.ts"/>
/// <reference path="./weavejs/data/bin/SingleValueClassifier.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpType.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpObject.ts"/>
/// <reference path="./weavejs/geom/Point.ts"/>
/// <reference path="./weavejs/geom/Bounds2D.ts"/>
/// <reference path="./weavejs/ui/DraggableDiv.tsx"/>
/// <reference path="./weavejs/ui/PopupWindow.tsx"/>
/// <reference path="./weavejs/geom/LinkableBounds2D.ts"/>
/// <reference path="./weavejs/geom/BLGTreeUtils.ts"/>
/// <reference path="./weavejs/api/net/IWMSService.ts"/>
/// <reference path="./weavejs/api/data/IProjector.ts"/>
/// <reference path="./weavejs/geom/Rectangle.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpError.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpPoint.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpPolygon.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpPolyline.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpPointZ.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpRecord.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpTools.ts"/>
/// <reference path="./org/vanrijkom/shp/ShpHeader.ts"/>
/// <reference path="./weavejs/geom/ShpFileReader.ts"/>
/// <reference path="./org/vanrijkom/dbf/DbfError.ts"/>
/// <reference path="./org/vanrijkom/dbf/DbfRecord.ts"/>
/// <reference path="./org/vanrijkom/dbf/DbfTools.ts"/>
/// <reference path="./org/vanrijkom/dbf/DbfField.ts"/>
/// <reference path="./org/vanrijkom/dbf/DbfHeader.ts"/>
/// <reference path="./org/vanrijkom/dbf/DbfFilter.ts"/>
/// <reference path="./weavejs/api/data/IQualifiedKeyManager.ts"/>
/// <reference path="./weavejs/api/data/DataType.ts"/>
/// <reference path="./weavejs/api/data/IKeyFilter.ts"/>
/// <reference path="./weavejs/data/key/DynamicKeyFilter.ts"/>
/// <reference path="./weavejs/api/data/IKeySet.ts"/>
/// <reference path="./weavejs/data/key/DynamicKeySet.ts"/>
/// <reference path="./weavejs/api/data/Aggregation.ts"/>
/// <reference path="./weavejs/api/data/IQualifiedKey.ts"/>
/// <reference path="./weavejs/data/source/GeoJSONDataSourceData.ts"/>
/// <reference path="./weavejs/data/key/QKey.ts"/>
/// <reference path="./weavejs/data/key/KeySet.ts"/>
/// <reference path="./weavejs/data/key/KeyFilter.ts"/>
/// <reference path="./weavejs/geom/GeometryStreamDecoder.ts"/>
/// <reference path="./weavejs/data/key/KeySetUnion.ts"/>
/// <reference path="./weavejs/api/data/DateFormat.ts"/>
/// <reference path="./weavejs/api/data/ICSVParser.ts"/>
/// <reference path="./weavejs/net/RequestMethod.ts"/>
/// <reference path="./weavejs/api/data/IColumnReference.ts"/>
/// <reference path="./weavejs/api/data/IColumnMetadata.ts"/>
/// <reference path="./weavejs/net/ResponseType.ts"/>
/// <reference path="./weavejs/net/URLRequest.ts"/>
/// <reference path="./weavejs/core/Locale.ts"/>
/// <reference path="./weavejs/api/net/IURLRequestUtils.ts"/>
/// <reference path="./weavejs/net/URLRequestUtils.ts"/>
/// <reference path="./weavejs/data/CSVParser.ts"/>
/// <reference path="./weavejs/data/key/QKeyManager.ts"/>
/// <reference path="./weavejs/core/LinkableFile.ts"/>
/// <reference path="./weavejs/api/data/IWeaveTreeNode.ts"/>
/// <reference path="./weavejs/api/data/IWeaveTreeNodeWithEditableChildren.ts"/>
/// <reference path="./weavejs/api/data/IWeaveTreeNodeWithPathFinding.ts"/>
/// <reference path="./weavejs/api/data/IDataSource.ts"/>
/// <reference path="./weavejs/api/data/IDataSourceWithAuthentication.ts"/>
/// <reference path="./weavejs/data/hierarchy/WeaveTreeDescriptorNode.ts"/>
/// <reference path="./weavejs/data/hierarchy/WeaveRootDataTreeNode.ts"/>
/// <reference path="./weavejs/data/hierarchy/HierarchyUtils.ts"/>
/// <reference path="./weavejs/api/data/IAttributeColumn.ts"/>
/// <reference path="./weavejs/ui/ToolTip.tsx"/>
/// <reference path="./weavejs/data/column/StringLookup.ts"/>
/// <reference path="./weavejs/data/key/SortedKeySet.ts"/>
/// <reference path="./weavejs/data/key/FilteredKeySet.ts"/>
/// <reference path="./weavejs/data/column/ColumnDataTask.ts"/>
/// <reference path="./weavejs/data/StatisticsCache.ts"/>
/// <reference path="./weavejs/path/ExternalTool.ts"/>
/// <reference path="./weavejs/util/BackwardsCompatibility.ts"/>
/// <reference path="./weavejs/api/data/IBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/ExplicitBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/AbstractBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/QuantileBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/EqualIntervalBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/CategoryBinningDefinition.ts"/>
/// <reference path="./weavejs/api/data/IAttributeColumnCache.ts"/>
/// <reference path="./weavejs/api/data/IColumnWrapper.ts"/>
/// <reference path="./weavejs/data/column/ExtendedDynamicColumn.ts"/>
/// <reference path="./weavejs/data/column/SortedColumn.ts"/>
/// <reference path="./weavejs/data/column/NormalizedColumn.ts"/>
/// <reference path="./weavejs/api/data/ISelectableAttributes.ts"/>
/// <reference path="./weavejs/data/column/DynamicColumn.ts"/>
/// <reference path="./weavejs/api/data/IPrimitiveColumn.ts"/>
/// <reference path="./weavejs/data/column/SortedIndexColumn.ts"/>
/// <reference path="./weavejs/api/data/IBaseColumn.ts"/>
/// <reference path="./weavejs/api/data/ColumnMetadata.ts"/>
/// <reference path="./weavejs/data/source/GeoJSONDataSourceNode.ts"/>
/// <reference path="./weavejs/data/source/CensusApi.ts"/>
/// <reference path="./weavejs/data/column/ColorColumn.ts"/>
/// <reference path="./weavejs/data/bin/DynamicBinningDefinition.ts"/>
/// <reference path="./weavejs/data/ColumnStatistics.ts"/>
/// <reference path="./weavejs/api/net/beans/EntityMetadata.ts"/>
/// <reference path="./weavejs/api/net/beans/Entity.ts"/>
/// <reference path="./weavejs/net/Admin.ts"/>
/// <reference path="./weavejs/api/net/IWeaveEntityService.ts"/>
/// <reference path="./weavejs/net/WeaveDataServlet.ts"/>
/// <reference path="./weavejs/api/net/IWeaveEntityManagementService.ts"/>
/// <reference path="./weavejs/net/WeaveAdminService.ts"/>
/// <reference path="./weavejs/net/EntityCache.ts"/>
/// <reference path="./weavejs/data/hierarchy/EntityNodeSearch.ts"/>
/// <reference path="./weavejs/data/hierarchy/EntityNode.ts"/>
/// <reference path="./weavejs/data/hierarchy/ColumnTreeNode.ts"/>
/// <reference path="./weavejs/data/EquationColumnLib.ts"/>
/// <reference path="./weavejs/data/column/FilteredColumn.ts"/>
/// <reference path="./weavejs/data/column/AlwaysDefinedColumn.ts"/>
/// <reference path="./weavejs/data/column/AbstractAttributeColumn.ts"/>
/// <reference path="./weavejs/data/column/StreamedGeometryColumn.ts"/>
/// <reference path="./weavejs/data/column/KeyColumn.ts"/>
/// <reference path="./weavejs/data/column/SecondaryKeyNumColumn.ts"/>
/// <reference path="./weavejs/data/column/GeometryColumn.ts"/>
/// <reference path="./weavejs/data/column/StringColumn.ts"/>
/// <reference path="./weavejs/data/column/EquationColumn.ts"/>
/// <reference path="./weavejs/data/column/CSVColumn.ts"/>
/// <reference path="./weavejs/data/hierarchy/GlobalColumnDataSource.ts"/>
/// <reference path="./weavejs/data/column/ReferencedColumn.ts"/>
/// <reference path="./weavejs/data/ColumnUtils.ts"/>
/// <reference path="./weavejs/data/key/ColumnDataFilter.ts"/>
/// <reference path="./weavejs/data/column/CombinedColumn.ts"/>
/// <reference path="./weavejs/data/bin/SimpleBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/NaturalJenksBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/NumberClassifier.ts"/>
/// <reference path="./weavejs/data/column/BinnedColumn.ts"/>
/// <reference path="./weavejs/data/bin/StandardDeviationBinningDefinition.ts"/>
/// <reference path="./weavejs/data/bin/CustomSplitBinningDefinition.ts"/>
/// <reference path="./weavejs/data/column/ProxyColumn.ts"/>
/// <reference path="./weavejs/data/source/AbstractDataSource.ts"/>
/// <reference path="./weavejs/data/source/CKANDataSource.ts"/>
/// <reference path="./weavejs/data/source/CachedDataSource.ts"/>
/// <reference path="./weavejs/data/column/NumberColumn.ts"/>
/// <reference path="./weavejs/data/source/GeoJSONDataSource.ts"/>
/// <reference path="./weavejs/data/column/DateColumn.ts"/>
/// <reference path="./weavejs/data/source/WeaveDataSource.ts"/>
/// <reference path="./weavejs/data/source/DBFDataSource.ts"/>
/// <reference path="./weavejs/data/DataSourceUtils.ts"/>
/// <reference path="./weavejs/data/source/WebSocketDataSource.ts"/>
/// <reference path="./weavejs/data/source/GroupedDataTransform.ts"/>
/// <reference path="./weavejs/data/source/ForeignDataMappingTransform.ts"/>
/// <reference path="./weavejs/data/source/CensusDataSource.ts"/>
/// <reference path="./weavejs/data/AttributeColumnCache.ts"/>
/// <reference path="./weavejs/core/WeaveArchive.tsx"/>
/// <reference path="./weavejs/data/source/CSVDataSource.ts"/>
/// <reference path="./WeaveTest.ts"/>

  WEAVE.weavejs = weavejs;
  WEAVE.weavejs.Weave = Weave;

  return WEAVE.weavejs;
}));

},{"classnames":137,"jszip":"jszip","lodash":"lodash","moment":"moment","pixi.js":"pixi.js","react":"react","react-addons-update":"react-addons-update","react-dom":"react-dom"}],137:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"dup":135}]},{},[1])
//# sourceMappingURL=weave-app.bundle.js.map
